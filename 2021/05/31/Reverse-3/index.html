<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
<meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_icon.svg">
  <link rel="mask-icon" href="/images/logo_icon.svg" color="#222">
  <link rel="manifest" href="/images/logo_icon.svg">
  <meta name="msapplication-config" content="/images/logo_icon.svg">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoloyolo.top","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="随缘刷题">
<meta property="og:type" content="article">
<meta property="og:title" content="Reverse_3">
<meta property="og:url" content="https://yoloyolo.top/2021/05/31/Reverse-3/index.html">
<meta property="og:site_name" content="xXxYOLOxXx">
<meta property="og:description" content="随缘刷题">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-05-31T09:16:43.000Z">
<meta property="article:modified_time" content="2023-07-16T09:02:45.079Z">
<meta property="article:author" content="xXxYOLOxXx">
<meta property="article:tag" content="Reverse">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://yoloyolo.top/2021/05/31/Reverse-3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Reverse_3 | xXxYOLOxXx</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="xXxYOLOxXx" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xXxYOLOxXx</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">xXxYOLOxXx</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="links fa-fw"></i>Links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://yoloyolo.top/2021/05/31/Reverse-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xXxYOLOxXx">
      <meta itemprop="description" content="Explorer for unknown.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xXxYOLOxXx">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Reverse_3
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-05-31 17:16:43" itemprop="dateCreated datePublished" datetime="2021-05-31T17:16:43+08:00">2021-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-16 17:02:45" itemprop="dateModified" datetime="2023-07-16T17:02:45+08:00">2023-07-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Study/" itemprop="url" rel="index"><span itemprop="name">Study</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>随缘刷题</p>
<a id="more"></a>
<h1 id="网鼎杯-2020-青龙组singal"><a class="markdownIt-Anchor" href="#网鼎杯-2020-青龙组singal"></a> [网鼎杯 2020 青龙组]singal</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E9%9D%92%E9%BE%99%E7%BB%84%5Dsingal">https://buuoj.cn/challenges#[网鼎杯 2020 青龙组]singal</a></p>
<p>EXE 32</p>
<p>IDA中 <strong>_main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4[<span class="number">117</span>]; <span class="comment">// [esp+18h] [ebp-1D4h] BYREF</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  qmemcpy(v4, dword_403040, <span class="number">456u</span>);</span><br><span class="line">  vm_operad(v4, <span class="number">114</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good,The answer format is:flag &#123;&#125;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里<code>dword_403040</code>只运算最低一字节</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dword_403040 = [</span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x04</span>, <span class="number">0x10</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x20</span>, <span class="number">0x08</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x0B</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x21</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x08</span>, <span class="number">0x0B</span>, </span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x51</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x08</span>, <span class="number">0x0B</span>, </span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x08</span>, <span class="number">0x02</span>, <span class="number">0x25</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x36</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x20</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x02</span>, <span class="number">0x25</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x08</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x07</span>, <span class="number">0x22</span>, <span class="number">0x07</span>, <span class="number">0x3F</span>, <span class="number">0x07</span>, <span class="number">0x34</span>, <span class="number">0x07</span>, <span class="number">0x32</span>, <span class="number">0x07</span>, <span class="number">0x72</span>, <span class="number">0x07</span>, <span class="number">0x33</span>, </span><br><span class="line"><span class="number">0x07</span>, <span class="number">0x18</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, <span class="number">0x07</span>, <span class="number">0x31</span>, <span class="number">0x07</span>, <span class="number">0xF1</span>, <span class="number">0x07</span>, <span class="number">0x28</span>, <span class="number">0x07</span>, <span class="number">0x84</span>, <span class="number">0x07</span>, <span class="number">0xC1</span>, <span class="number">0x07</span>, <span class="number">0x1E</span>, </span><br><span class="line"><span class="number">0x07</span>, <span class="number">0x7A</span>]</span><br></pre></td></tr></table></figure>
<p>跟进到 <strong>vm_operad</strong> 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">vm_operad</span><span class="params">(<span class="keyword">int</span> *a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> Str[<span class="number">200</span>]; <span class="comment">// [esp+13h] [ebp-E5h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+DBh] [ebp-1Dh]</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// [esp+DCh] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+E0h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+E4h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+E8h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [esp+ECh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v9;</span><br><span class="line">    <span class="keyword">if</span> ( v9 &gt;= a2 )</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    <span class="keyword">switch</span> ( a1[v9] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        Str[v6 + <span class="number">100</span>] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v6;</span><br><span class="line">        ++v8;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] + Str[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        v4 = Str[v8] - LOBYTE(a1[v9 + <span class="number">1</span>]);</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] ^ Str[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        v4 = a1[v9 + <span class="number">1</span>] * Str[v8];</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> ( Str[v7 + <span class="number">100</span>] != a1[v9 + <span class="number">1</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;what a shame...&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ++v7;</span><br><span class="line">        v9 += <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        Str[v5] = v4;</span><br><span class="line">        ++v9;</span><br><span class="line">        ++v5;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">        read(Str);</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">11</span>:</span><br><span class="line">        v4 = Str[v8] - <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>:</span><br><span class="line">        v4 = Str[v8] + <span class="number">1</span>;</span><br><span class="line">        ++v9;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据这里的switch语句来分析<br />
switch里对于各个数值的操作有些与CPU指令相似<br />
<s>原来这就是虚拟机逆向啊</s></p>
<ul>
<li><code>0x01</code>和<code>0x08</code>分别决定计算结果的存储位置</li>
<li><code>0x02</code>计算加法, <code>0x03</code>计算减法, <code>0x04</code>计算异或, <code>0x05</code>计算乘法</li>
<li><code>0x0B</code>自增, <code>0x1C</code>自减</li>
<li><code>0x0A</code>输入, <code>0x07</code>用于校验加密后的结果</li>
</ul>
<p>然后照着代码把虚拟机函数反着写一遍即可获得flag</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">a1 = [</span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x04</span>, <span class="number">0x10</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x20</span>, <span class="number">0x08</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x03</span>, <span class="number">0x02</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x0B</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x04</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x21</span>, <span class="number">0x01</span>, <span class="number">0x0B</span>, <span class="number">0x08</span>, <span class="number">0x0B</span>, </span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x51</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x24</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x08</span>, <span class="number">0x0B</span>, </span><br><span class="line"><span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x02</span>, <span class="number">0x08</span>, <span class="number">0x02</span>, <span class="number">0x25</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x36</span>, <span class="number">0x08</span>, <span class="number">0x04</span>, <span class="number">0x41</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x20</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x05</span>, <span class="number">0x01</span>, <span class="number">0x01</span>, <span class="number">0x05</span>, <span class="number">0x03</span>, <span class="number">0x08</span>, <span class="number">0x02</span>, <span class="number">0x25</span>, <span class="number">0x01</span>, <span class="number">0x04</span>, <span class="number">0x09</span>, <span class="number">0x08</span>, <span class="number">0x03</span>, <span class="number">0x20</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x08</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>]</span><br><span class="line">a1.reverse()</span><br><span class="line">a2 = [</span><br><span class="line"><span class="number">0x07</span>, <span class="number">0x22</span>, <span class="number">0x07</span>, <span class="number">0x3F</span>, <span class="number">0x07</span>, <span class="number">0x34</span>, <span class="number">0x07</span>, <span class="number">0x32</span>, <span class="number">0x07</span>, <span class="number">0x72</span>, <span class="number">0x07</span>, <span class="number">0x33</span>, <span class="number">0x07</span>, <span class="number">0x18</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, </span><br><span class="line"><span class="number">0x07</span>, <span class="number">0x31</span>, <span class="number">0x07</span>, <span class="number">0xF1</span>, <span class="number">0x07</span>, <span class="number">0x28</span>, <span class="number">0x07</span>, <span class="number">0x84</span>, <span class="number">0x07</span>, <span class="number">0xC1</span>, <span class="number">0x07</span>, <span class="number">0x1E</span>, <span class="number">0x07</span>, <span class="number">0x7A</span>]</span><br><span class="line">cipher = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a2)):</span><br><span class="line">	<span class="keyword">if</span> a2[_] == <span class="number">0x07</span>:</span><br><span class="line">		cipher.append(a2[_+<span class="number">1</span>])</span><br><span class="line">cipher.reverse()</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">v4 = <span class="number">0</span></span><br><span class="line">v6 = <span class="number">0</span></span><br><span class="line">v8 = <span class="number">0</span></span><br><span class="line">v9 = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> v9 &lt; <span class="built_in">len</span>(a1)-<span class="number">1</span>:</span><br><span class="line">	<span class="keyword">if</span> a1[v9] == <span class="number">0x01</span>:</span><br><span class="line">		v4 = cipher[v6]</span><br><span class="line">		v6 += <span class="number">1</span></span><br><span class="line">		v8 += <span class="number">1</span></span><br><span class="line">		v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> a1[v9+<span class="number">1</span>] == <span class="number">0x02</span>:</span><br><span class="line">			v8 = v4 - a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x03</span>:</span><br><span class="line">			v8 = v4 + a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x04</span>:</span><br><span class="line">			v8 = v4 ^ a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x05</span>:</span><br><span class="line">			v8 = v4 // a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x06</span>:</span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x0B</span>:</span><br><span class="line">			v8 = v4 + <span class="number">1</span></span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x0C</span>:</span><br><span class="line">			v8 = v4 - <span class="number">1</span></span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">	<span class="keyword">elif</span> a1[v9] == <span class="number">0x08</span>:</span><br><span class="line">		v4 = v8</span><br><span class="line">		v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">if</span> a1[v9+<span class="number">1</span>] == <span class="number">0x02</span>:</span><br><span class="line">			v8 = v4 - a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x03</span>:</span><br><span class="line">			v8 = v4 + a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x04</span>:</span><br><span class="line">			v8 = v4 ^ a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9+<span class="number">1</span>] == <span class="number">0x05</span>:</span><br><span class="line">			v8 = v4 // a1[v9]</span><br><span class="line">			v9 += <span class="number">2</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x06</span>:</span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x0B</span>:</span><br><span class="line">			v8 = v4 + <span class="number">1</span></span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">		<span class="keyword">elif</span> a1[v9] == <span class="number">0x0C</span>:</span><br><span class="line">			v8 = v4 - <span class="number">1</span></span><br><span class="line">			v9 += <span class="number">1</span></span><br><span class="line">		flag += <span class="built_in">chr</span>(v8)</span><br><span class="line">print(<span class="string">&quot;flag&#123;&quot;</span> + flag[::-<span class="number">1</span>] + <span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{757515121f3d478}</strong></p>
</blockquote>
<hr />
<h1 id="gxyctf2019simple-cpp"><a class="markdownIt-Anchor" href="#gxyctf2019simple-cpp"></a> [GXYCTF2019]simple CPP</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BGXYCTF2019%5Dsimple%20CPP">https://buuoj.cn/challenges#[GXYCTF2019]simple CPP</a></p>
<p>EXE 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">bool</span> v3; <span class="comment">// si</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  __int64 v6; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v7; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v8; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// er10</span></span><br><span class="line">  __int64 v10; <span class="comment">// r11</span></span><br><span class="line">  <span class="keyword">void</span> **v11; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">void</span> **v12; <span class="comment">// r8</span></span><br><span class="line">  __int64 v13; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v14; <span class="comment">// r15</span></span><br><span class="line">  __int64 v15; <span class="comment">// r12</span></span><br><span class="line">  __int64 v16; <span class="comment">// rbp</span></span><br><span class="line">  <span class="keyword">int</span> v17; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 *v18; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v19; <span class="comment">// rdi</span></span><br><span class="line">  __int64 *v20; <span class="comment">// r14</span></span><br><span class="line">  __int64 v21; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v22; <span class="comment">// r13</span></span><br><span class="line">  __int64 *v23; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v24; <span class="comment">// r8</span></span><br><span class="line">  __int64 v25; <span class="comment">// r12</span></span><br><span class="line">  __int64 v26; <span class="comment">// r15</span></span><br><span class="line">  __int64 v27; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v28; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v29; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v30; <span class="comment">// rbp</span></span><br><span class="line">  __int64 v31; <span class="comment">// r10</span></span><br><span class="line">  __int64 v32; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v33; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">bool</span> v34; <span class="comment">// dl</span></span><br><span class="line">  __int64 v35; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">void</span> **v36; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v37; <span class="comment">// rax</span></span><br><span class="line">  __int64 v38; <span class="comment">// r8</span></span><br><span class="line">  __int64 v39; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">void</span> *v40; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v42; <span class="comment">// [rsp+20h] [rbp-68h]</span></span><br><span class="line">  <span class="keyword">void</span> *Block[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-58h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v44; <span class="comment">// [rsp+40h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v45; <span class="comment">// [rsp+48h] [rbp-40h]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v44 = <span class="number">0</span>i64;</span><br><span class="line">  v45 = <span class="number">15</span>i64;</span><br><span class="line">  LOBYTE(Block[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  v4 = sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;I&#x27;m a first timer of Logic algebra , how about you?&quot;</span>, envp);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, sub_7FF69CF51B90);</span><br><span class="line">  sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Let&#x27;s start our game,Please input your flag:&quot;</span>, v5);</span><br><span class="line">  sub_7FF69CF51DE0(<span class="built_in">std</span>::<span class="built_in">cin</span>, Block);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">cout</span>, sub_7FF69CF51B90);</span><br><span class="line">  <span class="keyword">if</span> ( v44 - <span class="number">5</span> &gt; <span class="number">0x19</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v39 = sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong input ,no GXY&#123;&#125; in input words&quot;</span>, v6);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v39, sub_7FF69CF51B90);</span><br><span class="line">    <span class="keyword">goto</span> LABEL_43;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = (<span class="keyword">unsigned</span> __int8 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">  v8 = v7;</span><br><span class="line">  <span class="keyword">if</span> ( v7 )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_QWORD *)v7 = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">1</span>) = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">2</span>) = <span class="number">0</span>i64;</span><br><span class="line">    *((_QWORD *)v7 + <span class="number">3</span>) = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v8 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v44 )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = Block;</span><br><span class="line">      <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">        v11 = (<span class="keyword">void</span> **)Block[<span class="number">0</span>];</span><br><span class="line">      v12 = &amp;qword_7FF69CF56048;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)qword_7FF69CF56060 &gt;= <span class="number">0x10</span> )</span><br><span class="line">        v12 = (<span class="keyword">void</span> **)qword_7FF69CF56048;</span><br><span class="line">      v8[v10] = *((byte_0 *)v11 + v10) ^ *((byte_0 *)v12 + v9 % <span class="number">27</span>);</span><br><span class="line">      ++v9;</span><br><span class="line">      ++v10;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 &lt; v44 );</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = <span class="number">0</span>i64;</span><br><span class="line">  v14 = <span class="number">0</span>i64;</span><br><span class="line">  v15 = <span class="number">0</span>i64;</span><br><span class="line">  v16 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)v44 &gt; <span class="number">30</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">int</span>)v44 &lt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_27;</span><br><span class="line">  v18 = v8;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v19 = *v18 + v13;</span><br><span class="line">    ++v17;</span><br><span class="line">    ++v18;</span><br><span class="line">    <span class="keyword">switch</span> ( v17 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">        v16 = v19;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">        v15 = v19;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">24</span>:</span><br><span class="line">        v14 = v19;</span><br><span class="line">LABEL_23:</span><br><span class="line">        v19 = <span class="number">0</span>i64;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">        sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;ERRO,out of range&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v44);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v13 = v19 &lt;&lt; <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v17 &lt; (<span class="keyword">int</span>)v44 );</span><br><span class="line">  <span class="keyword">if</span> ( v16 )</span><br><span class="line">  &#123;</span><br><span class="line">    v20 = (__int64 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">    *v20 = v16;</span><br><span class="line">    v20[<span class="number">1</span>] = v15;</span><br><span class="line">    v20[<span class="number">2</span>] = v14;</span><br><span class="line">    v20[<span class="number">3</span>] = v13;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_28;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_27:</span><br><span class="line">  v20 = <span class="number">0</span>i64;</span><br><span class="line">LABEL_28:</span><br><span class="line">  v42 = v20[<span class="number">2</span>];</span><br><span class="line">  v21 = v20[<span class="number">1</span>];</span><br><span class="line">  v22 = *v20;</span><br><span class="line">  v23 = (__int64 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">0x20</span>ui64);</span><br><span class="line">  <span class="keyword">if</span> ( IsDebuggerPresent() )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Hi , DO not debug me !&quot;</span>, v24);</span><br><span class="line">    Sleep(<span class="number">0x7D0</span>u);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v25 = v21 &amp; v22;</span><br><span class="line">  *v23 = v21 &amp; v22;</span><br><span class="line">  v26 = v42 &amp; ~v22;</span><br><span class="line">  v23[<span class="number">1</span>] = v26;</span><br><span class="line">  v27 = ~v21;</span><br><span class="line">  v28 = v42 &amp; v27;</span><br><span class="line">  v23[<span class="number">2</span>] = v42 &amp; v27;</span><br><span class="line">  v29 = v22 &amp; v27;</span><br><span class="line">  v23[<span class="number">3</span>] = v29;</span><br><span class="line">  <span class="keyword">if</span> ( v26 != <span class="number">0x11204161012</span>i64 )</span><br><span class="line">  &#123;</span><br><span class="line">    v23[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v26 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v30 = v26 | v25 | v28 | v29;</span><br><span class="line">  v31 = v20[<span class="number">1</span>];</span><br><span class="line">  v32 = v20[<span class="number">2</span>];</span><br><span class="line">  v33 = v28 &amp; *v20 | v32 &amp; (v25 | v31 &amp; ~*v20 | ~(v31 | *v20));</span><br><span class="line">  v34 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v33 == <span class="number">0x8020717153E3013</span>i64 )</span><br><span class="line">    v34 = v30 == <span class="number">0x3E3A4717373E7F1F</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( (v30 ^ v20[<span class="number">3</span>]) == <span class="number">0x3E3A4717050F791F</span>i64 )</span><br><span class="line">    v3 = v34;</span><br><span class="line">  <span class="keyword">if</span> ( (v26 | v25 | v31 &amp; v32) == (~*v20 &amp; v32 | <span class="number">0xC00020130082C0C</span>i64) &amp;&amp; v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    v35 = sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Congratulations!flag is GXY&#123;&quot;</span>, v33);</span><br><span class="line">    v36 = Block;</span><br><span class="line">    <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">      v36 = (<span class="keyword">void</span> **)Block[<span class="number">0</span>];</span><br><span class="line">    v37 = sub_7FF69CF51FD0(v35, v36, v44);</span><br><span class="line">    sub_7FF69CF519C0(v37, <span class="string">&quot;&#125;&quot;</span>, v38);</span><br><span class="line">    j_j_free(v8);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF69CF519C0(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong answer!try again&quot;</span>, v33);</span><br><span class="line">    j_j_free(v8);</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_43:</span><br><span class="line">  <span class="keyword">if</span> ( v45 &gt;= <span class="number">0x10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v40 = Block[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> ( v45 + <span class="number">1</span> &gt;= <span class="number">0x1000</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v40 = (<span class="keyword">void</span> *)*((_QWORD *)Block[<span class="number">0</span>] - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)(Block[<span class="number">0</span>] - v40 - <span class="number">8</span>) &gt; <span class="number">0x1F</span> )</span><br><span class="line">        invalid_parameter_noinfo_noreturn();</span><br><span class="line">    &#125;</span><br><span class="line">    j_j_free(v40);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>主函数一堆的运算过程看起来有点无从下手<br />
仔细分析一遍之后可以得出下面的流程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">v12 &#x3D; &quot;i_will_check_is_debug_or_not&quot;</span><br><span class="line">v8 &#x3D; plain ^ v12</span><br><span class="line">v16 &#x3D; v8[:8]</span><br><span class="line">v15 &#x3D; v8[8:16]</span><br><span class="line">v14 &#x3D; v8[16:24]</span><br><span class="line">v13 &#x3D; v8[24:]</span><br><span class="line">v25 &#x3D; v15 &amp; v16</span><br><span class="line">v26 &#x3D; v14 &amp; ~v16</span><br><span class="line">v27 &#x3D; ~v15</span><br><span class="line">v28 &#x3D; v14 &amp; ~v15</span><br><span class="line">v29 &#x3D; v16 &amp; ~v15</span><br><span class="line">v23[0] &#x3D; v15 &amp; v16</span><br><span class="line">v23[1] &#x3D; v14 &amp; ~v16</span><br><span class="line">v23[2] &#x3D; v14 &amp; ~v15</span><br><span class="line">v23[3] &#x3D; v16 &amp; ~v15</span><br><span class="line">v14 &amp; ~v16 &#x3D;&#x3D; 0x11204161012</span><br><span class="line">v30 &#x3D; v25 | v26 | v28 | v29 &#x3D;&#x3D; 0x3E3A4717373E7F1F</span><br><span class="line">v31 &#x3D; v15</span><br><span class="line">v32 &#x3D; v14</span><br><span class="line">v33 &#x3D; v28 &amp; v16 | v32 &amp; (v25 | v31 &amp; ~v16 | ~(v31 | v16)) &#x3D;&#x3D; 0x8020717153E3013</span><br><span class="line">v30 ^ v13 &#x3D;&#x3D; 0x3E3A4717050F791F</span><br><span class="line">(v26 | v25 | v31 &amp; v32) &#x3D;&#x3D; (~v16 &amp; v32 | 0xC00020130082C0C)</span><br></pre></td></tr></table></figure>
<p>其中v12需要使用动调来获得内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v8[v10] = *((byte_0 *)v11 + v10) ^ *((byte_0 *)v12 + v9 % <span class="number">27</span>);</span><br></pre></td></tr></table></figure>
<p>同时我们可以根据这条代码来推测flag内容的长度应该为27</p>
<p>Z3解方程组</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">v13, v14, v15, v16 = BitVecs(<span class="string">&quot;v13 v14 v15 v16&quot;</span>, <span class="number">64</span>)</span><br><span class="line">s = Solver()</span><br><span class="line">s.add(v14 &amp; ~v16 == <span class="number">0x11204161012</span>)</span><br><span class="line">s.add((v15 &amp; v16)|(v14 &amp; ~v16)|(v14 &amp; ~v15)|(v16 &amp; ~v15) == <span class="number">0x3E3A4717373E7F1F</span>)</span><br><span class="line">s.add(((v14 &amp; ~v15) &amp; v16)| (v14 &amp; (v15 &amp; v16 | v15 &amp; ~v16 | ~(v15 | v16))) == <span class="number">0x8020717153E3013</span>)</span><br><span class="line">s.add(<span class="number">0x3E3A4717373E7F1F</span> ^ v13 == <span class="number">0x3E3A4717050F791F</span>)</span><br><span class="line">s.add(((v14 &amp; ~v16) | (v15 &amp; v16) | (v15 &amp; v14)) == (~v16 &amp; v14 | <span class="number">0xC00020130082C0C</span>))</span><br><span class="line">s.check()</span><br><span class="line">m = s.model()</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">print(m)</span></span><br><span class="line"><span class="string">[v13 = 842073600,</span></span><br><span class="line"><span class="string"> v16 = 4483973367147818765,</span></span><br><span class="line"><span class="string"> v14 = 577031497978884115,</span></span><br><span class="line"><span class="string"> v15 = 864693882343402508]</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">cipher = <span class="string">b&quot;&quot;</span></span><br><span class="line">v12 = <span class="string">&quot;i_will_check_is_debug_or_no&quot;</span></span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span></span><br><span class="line">m = [<span class="number">4483973367147818765</span>, <span class="number">864693882343402508</span>, <span class="number">577031497978884115</span>, <span class="number">842073600</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> m:</span><br><span class="line">  cipher += long_tobyte_0s(_)</span><br><span class="line">print(cipher)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">  flag += <span class="built_in">chr</span>(cipher[_] ^ <span class="built_in">ord</span>(v12[_]))</span><br><span class="line">flag += <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p>貌似是因为多解的原因<br />
导致最后得到的flag不正确<br />
所以比赛时给出了flag的第二部分<code>&quot;e!P0or_a&quot;</code></p>
<blockquote>
<p><strong>flag{We1l_D0ne!P0or_algebra_am_i}</strong></p>
</blockquote>
<hr />
<h1 id="wustctf2020level4"><a class="markdownIt-Anchor" href="#wustctf2020level4"></a> [WUSTCTF2020]level4</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BWUSTCTF2020%5Dlevel4">https://buuoj.cn/challenges#[WUSTCTF2020]level4</a></p>
<p>ELF 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Practice my Data Structure code.....&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Typing....Struct.....char....*left....*right............emmmmm...OK!&quot;</span>);</span><br><span class="line">  init(<span class="string">&quot;Typing....Struct.....char....*left....*right............emmmmm...OK!&quot;</span>, argv);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Traversal!&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Traversal type 1:&quot;</span>);</span><br><span class="line">  type1(&amp;unk_601290);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nTraversal type 2:&quot;</span>);</span><br><span class="line">  type2(&amp;unk_601290);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nTraversal type 3:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;    //type3(&amp;x[22]);   No way!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_400A37);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二叉树中序遍历</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">type1</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type1(*((_QWORD *)a1 + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">putchar</span>(*a1);</span><br><span class="line">    result = type1(*((_QWORD *)a1 + <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二叉树后序遍历</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">type2</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    type2(*((_QWORD *)a1 + <span class="number">1</span>));</span><br><span class="line">    type2(*((_QWORD *)a1 + <span class="number">2</span>));</span><br><span class="line">    result = <span class="built_in">putchar</span>(*a1);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结合输出结果来看<br />
先序遍历的输出结果应该就是flag</p>
<p>这里不会写转换脚本<br />
直接在IDA里面<strong>动调</strong>看<code>unk_601290</code>的数据结构了</p>
<p><code>数据+8Byte</code> 是左子节点的地址<br />
<code>数据+16Byte</code> 是右子节点的地址</p>
<blockquote>
<p><strong>flag{This_IS_A_7reE}</strong></p>
</blockquote>
<hr />
<h1 id="guet-ctf2019number_game"><a class="markdownIt-Anchor" href="#guet-ctf2019number_game"></a> [GUET-CTF2019]number_game</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BGUET-CTF2019%5Dnumber_game">https://buuoj.cn/challenges#[GUET-CTF2019]number_game</a></p>
<p>ELF 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *v4; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  __int16 v6; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+20h] [rbp-20h] BYREF</span></span><br><span class="line">  __int16 v8; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [rsp+2Ah] [rbp-16h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = <span class="number">0LL</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0LL</span>;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_4006D6((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v5) )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = sub_400758((__int64)&amp;v5, <span class="number">0</span>, <span class="number">0xA</span>u);</span><br><span class="line">    sub_400807((__int64)v4, (__int64)&amp;v7);</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    sub_400881((<span class="keyword">char</span> *)&amp;v7);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_400917() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;TQL!&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;flag&#123;&quot;</span>);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v5);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;your are cxk!!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_4006D6</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(a1) == <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a1[i] &gt; <span class="number">52</span> || a1[i] &lt;= <span class="number">47</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_2;</span><br><span class="line">    &#125;</span><br><span class="line">    result = <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_2:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数<code>sub_4006D6</code>要求输入的字符串长度为10且字符集为&quot;01234&quot;<br />
通过控制输入, 动态调试<code>sub_400807</code>得到重新排序之后的字符串<br />
<s>因为实在懒得看代码了, 曲线救国</s></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0123401234</span><br><span class="line">2331440021</span><br><span class="line"></span><br><span class="line">0011223344</span><br><span class="line">3140420213</span><br></pre></td></tr></table></figure>
<p>根据两组输入输出则可以得出解密序列为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seq = [<span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_400881</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  byte_601062 = *a1;</span><br><span class="line">  byte_601067 = a1[<span class="number">1</span>];</span><br><span class="line">  byte_601069 = a1[<span class="number">2</span>];</span><br><span class="line">  byte_60106B = a1[<span class="number">3</span>];</span><br><span class="line">  byte_60106E = a1[<span class="number">4</span>];</span><br><span class="line">  byte_60106F = a1[<span class="number">5</span>];</span><br><span class="line">  byte_601071 = a1[<span class="number">6</span>];</span><br><span class="line">  byte_601072 = a1[<span class="number">7</span>];</span><br><span class="line">  byte_601076 = a1[<span class="number">8</span>];</span><br><span class="line">  result = (<span class="keyword">unsigned</span> __int8)a1[<span class="number">9</span>];</span><br><span class="line">  byte_601077 = a1[<span class="number">9</span>];</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">.data:0000000000601060 unk_601060      db  31h ; 1</span><br><span class="line">.data:0000000000601061                 db  34h ; 4</span><br><span class="line">.data:0000000000601062 byte_601062     db 23h                  ; DATA XREF: sub_400881+F↑w</span><br><span class="line">.data:0000000000601063                 db  32h ; 2</span><br><span class="line">.data:0000000000601064                 db  33h ; 3</span><br><span class="line">.data:0000000000601065                 db  33h ; 3</span><br><span class="line">.data:0000000000601066                 db  30h ; 0</span><br><span class="line">.data:0000000000601067 byte_601067     db 23h                  ; DATA XREF: sub_400881+1D↑w</span><br><span class="line">.data:0000000000601068                 db  31h ; 1</span><br><span class="line">.data:0000000000601069 byte_601069     db 23h                  ; DATA XREF: sub_400881+2B↑w</span><br><span class="line">.data:000000000060106A                 db  30h ; 0</span><br><span class="line">.data:000000000060106B byte_60106B     db 23h                  ; DATA XREF: sub_400881+39↑w</span><br><span class="line">.data:000000000060106C                 db  32h ; 2</span><br><span class="line">.data:000000000060106D                 db  33h ; 3</span><br><span class="line">.data:000000000060106E byte_60106E     db 23h                  ; DATA XREF: sub_400881+47↑w</span><br><span class="line">.data:000000000060106F byte_60106F     db 23h                  ; DATA XREF: sub_400881+55↑w</span><br><span class="line">.data:0000000000601070                 db  33h ; 3</span><br><span class="line">.data:0000000000601071 byte_601071     db 23h                  ; DATA XREF: sub_400881+63↑w</span><br><span class="line">.data:0000000000601072 byte_601072     db 23h                  ; DATA XREF: sub_400881+71↑w</span><br><span class="line">.data:0000000000601073                 db  30h ; 0</span><br><span class="line">.data:0000000000601074                 db  34h ; 4</span><br><span class="line">.data:0000000000601075                 db  32h ; 2</span><br><span class="line">.data:0000000000601076 byte_601076     db 23h                  ; DATA XREF: sub_400881+7F↑w</span><br><span class="line">.data:0000000000601077 byte_601077     db 23h                  ; DATA XREF: sub_400881+8D↑w</span><br><span class="line">.data:0000000000601078                 db  31h ; 1</span><br></pre></td></tr></table></figure>
<p>可以看到通过v7赋值的地址都是恰好是空值的位置, 则这里是在填空</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_400917</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// [rsp+0h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> k; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v1 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">4</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = j + <span class="number">1</span>; k &lt;= <span class="number">4</span>; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((byte_0 *)&amp;unk_601060 + <span class="number">5</span> * i + j) == *((byte_0 *)&amp;unk_601060 + <span class="number">5</span> * i + k) )</span><br><span class="line">          v1 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ( *((byte_0 *)&amp;unk_601060 + <span class="number">5</span> * j + i) == *((byte_0 *)&amp;unk_601060 + <span class="number">5</span> * k + i) )</span><br><span class="line">          v1 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到这里就差不多明白了<br />
横纵不能出现相同的数字, 那么这个程序就是个数独游戏了<br />
且数独的布局如下</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudoku = [</span><br><span class="line"><span class="number">1</span>, <span class="number">4</span>, X, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line"><span class="number">3</span>, <span class="number">0</span>, X, <span class="number">1</span>, X,</span><br><span class="line"><span class="number">0</span>, X, <span class="number">2</span>, <span class="number">3</span>, X,</span><br><span class="line">X, <span class="number">3</span>, X, X, <span class="number">0</span>,</span><br><span class="line"><span class="number">4</span>, <span class="number">2</span>, X, X, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>解出后得出序列为</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">0</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">cipher = [<span class="number">0</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>]</span><br><span class="line">seq = [<span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>]</span><br><span class="line">flag = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">  flag[_] = <span class="built_in">str</span>(cipher[seq[_]])</span><br><span class="line">print(<span class="string">&quot;flag&#123;&quot;</span>+<span class="string">&quot;&quot;</span>.join(flag)+<span class="string">&quot;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{1134240024}</strong></p>
</blockquote>
<hr />
<h1 id="gwctf-2019re3"><a class="markdownIt-Anchor" href="#gwctf-2019re3"></a> [GWCTF 2019]re3</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BGWCTF%202019%5Dre3">https://buuoj.cn/challenges#[GWCTF 2019]re3</a></p>
<p>ELF 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-48h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">40</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%39s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">strlen</span>(s) != <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  mprotect(&amp;dword_400000, <span class="number">0xF000</span>uLL, <span class="number">7</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">223</span>; ++i )</span><br><span class="line">    *((byte_0 *)sub_402219 + i) ^= <span class="number">0x99</span>u;</span><br><span class="line">  sub_40207B(&amp;unk_603170);</span><br><span class="line">  sub_402219(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">223</span>; ++i )</span><br><span class="line">  *((byte_0 *)sub_402219 + i) ^= <span class="number">0x99</span>u;</span><br></pre></td></tr></table></figure>
<p>注意看着一段代码<br />
这里在对函数<code>sub_402219</code>的内容进行异或运算</p>
<p>而<code>sub_402219</code>的内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000402219 sub_402219      proc near               ; CODE XREF: main+CA↑p</span><br><span class="line">.text:0000000000402219                                         ; DATA XREF: main:loc_40217C↑o</span><br><span class="line">.text:0000000000402219 ; __unwind &#123;</span><br><span class="line">.text:0000000000402219                 int     3               ; Trap to Debugger</span><br><span class="line">.text:0000000000402219 sub_402219      endp</span><br><span class="line">.text:0000000000402219</span><br><span class="line">.text:0000000000402219 ; ---------------------------------------------------------------------------</span><br><span class="line">.text:000000000040221A                 dw 10D1h, 0D17Ch, 7518h</span><br><span class="line">.text:0000000000402220                 dq 812410D199999969h, 0BC9D12D1FD666666h, 61DC10D1999999B1h</span><br><span class="line">.text:0000000000402220                 dq 6666A91C14D159A8h, 10D199F9A8E92766h, 12D1666671BA715Eh</span><br><span class="line">.text:0000000000402220                 dq 1C14D1666666810Ch, 0D14F10D1666666A9h, 0D166666E9E715E10h</span><br><span class="line">.text:0000000000402220                 dq 14D1666666811C12h, 6666A91C14D189C9h, 715E10D14F10D166h</span><br><span class="line">.text:0000000000402220                 dq 66B11C5E66666F73h, 1C5E999999986666h, 99999999666666B5h</span><br><span class="line">.text:0000000000402220                 dq 666666B51C12A372h, 66811C12D149FAD1h, 892F964998D16666h</span><br><span class="line">.text:0000000000402220                 dq 1D1666666B51C12h, 0A199F9A939192F96h, 6666B11C5E93ED5Bh</span><br><span class="line">.text:0000000000402220                 dq 0B51C1A9999999966h, 66B5241A98666666h, 0B11C1224E7866666h</span><br><span class="line">.text:0000000000402220                 dq 0FD61D412D1666666h, 999999B1BC95AAD1h, 5066667AC0719CEDh</span><br><span class="line">.text:0000000000402220                 dq 801F0F5Ah</span><br><span class="line">.text:0000000000402300</span><br></pre></td></tr></table></figure>
<p>那么可以看到函数中内容无法被IDA解析, 所以被认为是数据<br />
所以我们需要使用IDC脚本来对这部分数据进行还原</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;idc.idc&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> addr = <span class="number">0x402219</span>;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">223</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        PatchByte(addr+i, Byte(addr+i)^<span class="number">0x99</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先全部转为数据, 再强制转为代码, 最后再创建函数, 且<code>main</code>函数里<code>nop</code>掉那段循环异或的代码<br />
同时main函数需要包含<code>loc_402205</code>, <code>loc_40220F</code>这两段代码, 操作同上</p>
<p>还原之后的函数<code>main</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">40</span>]; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%39s&quot;</span>, s);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="built_in">strlen</span>(s) != <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  mprotect(&amp;dword_400000, <span class="number">0xF000</span>uLL, <span class="number">7</span>);</span><br><span class="line">  sub_40207B((__int64)&amp;unk_603170);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)sub_402219((__int64)s) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先分析函数<code>sub_40207B</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 __fastcall <span class="title">sub_40207B</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2[<span class="number">16</span>]; <span class="comment">// [rsp+10h] [rbp-50h] BYREF</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+30h] [rbp-30h] BYREF</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+40h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v6; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_401CF9(&amp;BASE64_table_603120, <span class="number">0x40</span>uLL, (__int64)v2);</span><br><span class="line">  sub_401CF9(&amp;CRC32_table_603100, <span class="number">0x14</span>uLL, (__int64)&amp;v3);</span><br><span class="line">  sub_401CF9(&amp;Prime_Constants_char_6030C0, <span class="number">0x35</span>uLL, (__int64)&amp;v4);</span><br><span class="line">  sub_401CF9(MD5_Constants_4025C0, <span class="number">0x100</span>uLL, (__int64)&amp;v5);</span><br><span class="line">  sub_401CF9(v2, <span class="number">0x40</span>uLL, a1);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BASE64_table_603120</code>经过函数<code>sub_401CF9</code>的运行之后结果保存于<code>v2</code><br />
<code>v2</code>经过函数<code>sub_401CF9</code>的运行之后结果保存于<code>a1</code>, 即<code>unk_603170</code></p>
<p>代码过于复杂, 动调得到<code>unk_603170</code>的内容</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_603170 = [</span><br><span class="line"><span class="number">0xCB</span>, <span class="number">0x8D</span>, <span class="number">0x49</span>, <span class="number">0x35</span>, <span class="number">0x21</span>, <span class="number">0xB4</span>, <span class="number">0x7A</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0xC1</span>, <span class="number">0xAE</span>, <span class="number">0x7E</span>, <span class="number">0x62</span>, <span class="number">0x22</span>, <span class="number">0x92</span>, <span class="number">0x66</span>, <span class="number">0xCE</span>]</span><br></pre></td></tr></table></figure>
<p>分析<code>sub_402219</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_402219</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v2; <span class="comment">// [rsp+18h] [rbp-D8h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-D4h]</span></span><br><span class="line">  <span class="keyword">char</span> v4[<span class="number">200</span>]; <span class="comment">// [rsp+20h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+E8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  sub_400A71((__int64)v4, (__int64)&amp;unk_603170);</span><br><span class="line">  sub_40196E((__int64)v4, a1);</span><br><span class="line">  sub_40196E((__int64)v4, a1 + <span class="number">16</span>);</span><br><span class="line">  v2 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(byte_0 *)(i + a1) != qword_6030A0[i] )</span><br><span class="line">      v2 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_400A71</code>处理<code>unk_603170</code><br />
继续跟进看到一个名为<code>RijnDael_AES_LONG_4023A0</code>数据段, 那么基本可以判断这是一个AES加密程序了<br />
<code>sub_40196E</code>也就是用于加密用户所输入的字符串, 且加密模式为ECB(32字节的数据分两次单独加密), 最后的密文存于<code>qword_6030A0</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">_6030A0 = [</span><br><span class="line"><span class="number">0xBC</span>, <span class="number">0x0A</span>, <span class="number">0xAD</span>, <span class="number">0xC0</span>, <span class="number">0x14</span>, <span class="number">0x7C</span>, <span class="number">0x5E</span>, <span class="number">0xCC</span>, </span><br><span class="line"><span class="number">0xE0</span>, <span class="number">0xB1</span>, <span class="number">0x40</span>, <span class="number">0xBC</span>, <span class="number">0x9C</span>, <span class="number">0x51</span>, <span class="number">0xD5</span>, <span class="number">0x2B</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0xB2</span>, <span class="number">0xB9</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0xE5</span>, <span class="number">0x32</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0xAD</span>, <span class="number">0x7F</span>, <span class="number">0xB4</span>, <span class="number">0xB3</span>, <span class="number">0x9C</span>, <span class="number">0xDB</span>, <span class="number">0x4B</span>, <span class="number">0x5B</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">_603170 = [</span><br><span class="line"><span class="number">0xCB</span>, <span class="number">0x8D</span>, <span class="number">0x49</span>, <span class="number">0x35</span>, <span class="number">0x21</span>, <span class="number">0xB4</span>, <span class="number">0x7A</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0xC1</span>, <span class="number">0xAE</span>, <span class="number">0x7E</span>, <span class="number">0x62</span>, <span class="number">0x22</span>, <span class="number">0x92</span>, <span class="number">0x66</span>, <span class="number">0xCE</span>]</span><br><span class="line">_6030A0 = [</span><br><span class="line"><span class="number">0xBC</span>, <span class="number">0x0A</span>, <span class="number">0xAD</span>, <span class="number">0xC0</span>, <span class="number">0x14</span>, <span class="number">0x7C</span>, <span class="number">0x5E</span>, <span class="number">0xCC</span>, </span><br><span class="line"><span class="number">0xE0</span>, <span class="number">0xB1</span>, <span class="number">0x40</span>, <span class="number">0xBC</span>, <span class="number">0x9C</span>, <span class="number">0x51</span>, <span class="number">0xD5</span>, <span class="number">0x2B</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0xB2</span>, <span class="number">0xB9</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0xE5</span>, <span class="number">0x32</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0xAD</span>, <span class="number">0x7F</span>, <span class="number">0xB4</span>, <span class="number">0xB3</span>, <span class="number">0x9C</span>, <span class="number">0xDB</span>, <span class="number">0x4B</span>, <span class="number">0x5B</span>]</span><br><span class="line">cipher = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> _6030A0:</span><br><span class="line">  cipher += <span class="built_in">chr</span>(_)</span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> _603170:</span><br><span class="line">  key += <span class="built_in">chr</span>(_)</span><br><span class="line">aes = AES.new(key.encode(<span class="string">&quot;ISO-8859-1&quot;</span>), AES.MODE_ECB)</span><br><span class="line">print(aes.decrypt(cipher.encode(<span class="string">&quot;ISO-8859-1&quot;</span>)).decode())</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{924a9ab2163d390410d0a1f670}</strong></p>
</blockquote>
<hr />
<h1 id="2019红帽杯xx"><a class="markdownIt-Anchor" href="#2019红帽杯xx"></a> [2019红帽杯]xx</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5B2019%E7%BA%A2%E5%B8%BD%E6%9D%AF%5Dxx">https://buuoj.cn/challenges#[2019红帽杯]xx</a></p>
<p>EXE 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int128 *v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// r11</span></span><br><span class="line">  __int128 *v7; <span class="comment">// r14</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// edi</span></span><br><span class="line">  __int128 *v9; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// edx</span></span><br><span class="line">  __int64 v12; <span class="comment">// r8</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v13; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v14; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v15; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 i; <span class="comment">// rax</span></span><br><span class="line">  __int64 v17; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">size_t</span> v18; <span class="comment">// rsi</span></span><br><span class="line">  _BYTE *v19; <span class="comment">// rbx</span></span><br><span class="line">  _BYTE *v20; <span class="comment">// r9</span></span><br><span class="line">  <span class="keyword">int</span> v21; <span class="comment">// er11</span></span><br><span class="line">  <span class="keyword">char</span> *v22; <span class="comment">// r8</span></span><br><span class="line">  __int64 v23; <span class="comment">// rcx</span></span><br><span class="line">  <span class="keyword">char</span> v24; <span class="comment">// al</span></span><br><span class="line">  __int64 v25; <span class="comment">// r9</span></span><br><span class="line">  __int64 v26; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v27; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">size_t</span> Size; <span class="comment">// [rsp+20h] [rbp-48h] BYREF</span></span><br><span class="line">  __int128 v30; <span class="comment">// [rsp+28h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v31; <span class="comment">// [rsp+38h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">int</span> v32; <span class="comment">// [rsp+3Ch] [rbp-2Ch]</span></span><br><span class="line">  <span class="keyword">int</span> Code[<span class="number">4</span>]; <span class="comment">// [rsp+40h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v34; <span class="comment">// [rsp+50h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  *(_OWORD *)Code = <span class="number">0</span>i64;</span><br><span class="line">  v34 = <span class="number">0</span>;</span><br><span class="line">  sub_1400018C0(<span class="built_in">std</span>::<span class="built_in">cin</span>, argv, Code);</span><br><span class="line">  v3 = <span class="number">-1</span>i64;</span><br><span class="line">  v4 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v4;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)Code + v4) );</span><br><span class="line">  <span class="keyword">if</span> ( v4 != <span class="number">19</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_140001620(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;error\n&quot;</span>);</span><br><span class="line">    _exit((<span class="keyword">int</span>)Code);</span><br><span class="line">  &#125;</span><br><span class="line">  v5 = (__int128 *)<span class="keyword">operator</span> <span class="keyword">new</span>(<span class="number">5u</span>i64);</span><br><span class="line">  v6 = *(_QWORD *)&amp;::Code;</span><br><span class="line">  v7 = v5;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = v5;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10 = *((_BYTE *)v9 + (<span class="keyword">char</span> *)Code - (<span class="keyword">char</span> *)v5);</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    *(_BYTE *)v9 = v10;</span><br><span class="line">    v12 = <span class="number">0</span>i64;</span><br><span class="line">    v13 = <span class="number">-1</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      ++v13;</span><br><span class="line">    <span class="keyword">while</span> ( *(_BYTE *)(v6 + v13) );</span><br><span class="line">    <span class="keyword">if</span> ( v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v10 == *(_BYTE *)(v6 + v12) )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v11;</span><br><span class="line">        ++v12;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v11 &lt; v13 );</span><br><span class="line">    &#125;</span><br><span class="line">    v14 = <span class="number">-1</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      ++v14;</span><br><span class="line">    <span class="keyword">while</span> ( *(_BYTE *)(v6 + v14) );</span><br><span class="line">    <span class="keyword">if</span> ( v11 == v14 )</span><br><span class="line">      _exit(v6);</span><br><span class="line">    v9 = (__int128 *)((<span class="keyword">char</span> *)v9 + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="keyword">char</span> *)v9 - (<span class="keyword">char</span> *)v5 &lt; <span class="number">4</span> );</span><br><span class="line">  *((_BYTE *)v5 + <span class="number">4</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v3;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)Code + v3) );</span><br><span class="line">  v15 = <span class="number">0</span>i64;</span><br><span class="line">  v30 = *v7;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)&amp;v30 + v15) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_BYTE *)&amp;v30 + v15 + <span class="number">1</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      ++v15;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_BYTE *)&amp;v30 + v15 + <span class="number">2</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v15 += <span class="number">2</span>i64;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_BYTE *)&amp;v30 + v15 + <span class="number">3</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v15 += <span class="number">3</span>i64;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v15 += <span class="number">4</span>i64;</span><br><span class="line">    <span class="keyword">if</span> ( v15 &gt;= <span class="number">0x10</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = v15 + <span class="number">1</span>; i &lt; <span class="number">0x10</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;v30 + i) = <span class="number">0</span>;</span><br><span class="line">  v17 = (__int64)sub_140001AB0((__int64)Code, v3, (<span class="keyword">unsigned</span> __int8 *)&amp;v30, &amp;Size);</span><br><span class="line">  v18 = Size;</span><br><span class="line">  v19 = (_BYTE *)v17;</span><br><span class="line">  v20 = <span class="keyword">operator</span> <span class="keyword">new</span>(Size);</span><br><span class="line">  v21 = <span class="number">1</span>;</span><br><span class="line">  *v20 = v19[<span class="number">2</span>];</span><br><span class="line">  v22 = v20 + <span class="number">1</span>;</span><br><span class="line">  v20[<span class="number">1</span>] = *v19;</span><br><span class="line">  v20[<span class="number">2</span>] = v19[<span class="number">3</span>];</span><br><span class="line">  v20[<span class="number">3</span>] = v19[<span class="number">1</span>];</span><br><span class="line">  v20[<span class="number">4</span>] = v19[<span class="number">6</span>];</span><br><span class="line">  v20[<span class="number">5</span>] = v19[<span class="number">4</span>];</span><br><span class="line">  v20[<span class="number">6</span>] = v19[<span class="number">7</span>];</span><br><span class="line">  v20[<span class="number">7</span>] = v19[<span class="number">5</span>];</span><br><span class="line">  v20[<span class="number">8</span>] = v19[<span class="number">10</span>];</span><br><span class="line">  v20[<span class="number">9</span>] = v19[<span class="number">8</span>];</span><br><span class="line">  v20[<span class="number">10</span>] = v19[<span class="number">11</span>];</span><br><span class="line">  v20[<span class="number">11</span>] = v19[<span class="number">9</span>];</span><br><span class="line">  v20[<span class="number">12</span>] = v19[<span class="number">14</span>];</span><br><span class="line">  v20[<span class="number">13</span>] = v19[<span class="number">12</span>];</span><br><span class="line">  v20[<span class="number">14</span>] = v19[<span class="number">15</span>];</span><br><span class="line">  v20[<span class="number">15</span>] = v19[<span class="number">13</span>];</span><br><span class="line">  v20[<span class="number">16</span>] = v19[<span class="number">18</span>];</span><br><span class="line">  v20[<span class="number">17</span>] = v19[<span class="number">16</span>];</span><br><span class="line">  v20[<span class="number">18</span>] = v19[<span class="number">19</span>];</span><br><span class="line">  v20[<span class="number">19</span>] = v19[<span class="number">17</span>];</span><br><span class="line">  v20[<span class="number">20</span>] = v19[<span class="number">22</span>];</span><br><span class="line">  v20[<span class="number">21</span>] = v19[<span class="number">20</span>];</span><br><span class="line">  v20[<span class="number">22</span>] = v19[<span class="number">23</span>];</span><br><span class="line">  <span class="keyword">for</span> ( v20[<span class="number">23</span>] = v19[<span class="number">21</span>]; v21 &lt; v18; ++v22 )</span><br><span class="line">  &#123;</span><br><span class="line">    v23 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">if</span> ( v21 / <span class="number">3</span> &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v24 = *v22;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v24 ^= v20[v23++];</span><br><span class="line">        *v22 = v24;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v23 &lt; v21 / <span class="number">3</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    ++v21;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;v30 = <span class="number">0xC0953A7C6B40BCCE</span>ui64;</span><br><span class="line">  v25 = v20 - (_BYTE *)&amp;v30;</span><br><span class="line">  *((_QWORD *)&amp;v30 + <span class="number">1</span>) = <span class="number">0x3502F79120209BEF</span>i64;</span><br><span class="line">  v26 = <span class="number">0</span>i64;</span><br><span class="line">  v31 = <span class="number">0xC8021823</span>;</span><br><span class="line">  v32 = <span class="number">0xFA5656E7</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *((_BYTE *)&amp;v30 + v26) != *((_BYTE *)&amp;v30 + v26 + v25) )</span><br><span class="line">      _exit(v8 * v8);</span><br><span class="line">    ++v8;</span><br><span class="line">    ++v26;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v26 &lt; <span class="number">24</span> );</span><br><span class="line">  v27 = sub_140001620(<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;You win!&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v27, sub_1400017F0);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>IDA中使用插件<code>FindCrypt</code>可以看到程序使用了TEA加密<br />
结合题目可以猜出是XXTEA加密<br />
<s>这题基本是看着别人的WP做出来的</s></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000140001C4B  global  TEA_DELTA_140001C4B $c0 b&#39;\xb9y7\x9e&#39;</span><br></pre></td></tr></table></figure>
<p>从上往下分析</p>
<ul>
<li>用户输入字符串, 长度为19</li>
<li>前四个字符在字符集&quot;qwertyuiopasdfghjklzxcvbnm1234567890&quot;中</li>
<li>取前四字节为密钥</li>
<li>加密结果乱序</li>
<li>迭代异或</li>
<li>校验加密结果</li>
</ul>
<p>迭代异或的方式如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cipher[3] &#x3D; cipher[3] ^ cipher[0]</span><br><span class="line">cipher[4] &#x3D; cipher[4] ^ cipher[0]</span><br><span class="line">cipher[5] &#x3D; cipher[5] ^ cipher[0]</span><br><span class="line">cipher[6] &#x3D; cipher[6] ^ cipher[0] ^ cipher[1]</span><br><span class="line">cipher[7] &#x3D; cipher[7] ^ cipher[0] ^ cipher[1]</span><br><span class="line">cipher[8] &#x3D; cipher[8] ^ cipher[0] ^ cipher[1]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>密文如下(大端赋值, 之后需要转为小端的字符串)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*(_QWORD *)&amp;v30 &#x3D; 0xC0953A7C6B40BCCEui64;</span><br><span class="line">*((_QWORD *)&amp;v30 + 1) &#x3D; 0x3502F79120209BEFi64;</span><br><span class="line">v31 &#x3D; 0xC8021823;</span><br><span class="line">v32 &#x3D; 0xFA5656E7;</span><br></pre></td></tr></table></figure>
<p>且这三个变量的内存分布如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__int128 v30; &#x2F;&#x2F; [rsp+28h] [rbp-40h] BYREF</span><br><span class="line">int v31; &#x2F;&#x2F; [rsp+38h] [rbp-30h]</span><br><span class="line">int v32; &#x2F;&#x2F; [rsp+3Ch] [rbp-2Ch]</span><br></pre></td></tr></table></figure>
<p>所以四个数据的整体才是密文部分</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> xxtea</span><br><span class="line">cipher = [</span><br><span class="line"><span class="number">0xC0953A7C6B40BCCE</span>, </span><br><span class="line"><span class="number">0x3502F79120209BEF</span>, </span><br><span class="line"><span class="number">0xC8021823</span>, </span><br><span class="line"><span class="number">0xFA5656E7</span>]</span><br><span class="line"><span class="comment"># 转小端字节串</span></span><br><span class="line">_byte = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> cipher:</span><br><span class="line">  _byte += binascii.unhexlify(<span class="built_in">hex</span>(_)[<span class="number">2</span>:].encode(<span class="string">&quot;ISO-8859-1&quot;</span>))[::-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># 迭代异或</span></span><br><span class="line">__byte = [_ <span class="keyword">for</span> _ <span class="keyword">in</span> _byte]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(__byte)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">  <span class="keyword">for</span> __ <span class="keyword">in</span> <span class="built_in">range</span>(_//<span class="number">3</span>):</span><br><span class="line">    __byte[_] = __byte[_] ^ __byte[__]</span><br><span class="line"><span class="comment"># 异或结果转为字节串</span></span><br><span class="line">___byte = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> __byte:</span><br><span class="line">  ___byte += <span class="built_in">chr</span>(_)</span><br><span class="line">___byte = ___byte.encode(<span class="string">&quot;ISO-8859-1&quot;</span>)</span><br><span class="line"><span class="comment"># 还原顺序</span></span><br><span class="line">seq_enc = [<span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">18</span>, <span class="number">16</span>, <span class="number">19</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">20</span>, <span class="number">23</span>, <span class="number">21</span>]</span><br><span class="line">seq_dec = [-<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> seq_enc]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(seq_enc)):</span><br><span class="line">  seq_dec[_] = seq_enc.index(_)</span><br><span class="line">____byte = <span class="string">b&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(___byte)):</span><br><span class="line">  ____byte += <span class="built_in">chr</span>(___byte[seq_dec[_]]).encode(<span class="string">&quot;ISO-8859-1&quot;</span>)</span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">key = <span class="string">&quot;flag&quot;</span></span><br><span class="line">flag = xxtea.decrypt(____byte, key).decode()</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{CXX_and_++tea}</strong></p>
</blockquote>
<hr />
<h1 id="findkey"><a class="markdownIt-Anchor" href="#findkey"></a> findKey</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#findKey">https://buuoj.cn/challenges#findKey</a></p>
<p>EXE 32</p>
<p>一开始没找到主函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.rdata:00423028 aFlag           db &#39;flag&#123;&#125;&#39;,0           ; DATA XREF: .text:00401A3A↑o</span><br></pre></td></tr></table></figure>
<p>找到这样的一个字符串<br />
搜索文本之后找到位置<code>loc_401A37</code><br />
但是这里并没有被定义成函数<br />
粗略看下有一段疑似插入了花指令的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.text:0040191D loc_40191D:                             ; CODE XREF: .text:0040193D↓j</span><br><span class="line">.text:0040191D                 push    offset byte_428C54</span><br><span class="line">.text:00401922                 call    _strlen</span><br><span class="line">.text:00401927                 add     esp, 4</span><br><span class="line">.text:0040192A                 push    eax</span><br><span class="line">.text:0040192B                 push    offset byte_428C54</span><br><span class="line">.text:00401930                 call    sub_40101E</span><br><span class="line">.text:00401935                 add     esp, 0Ch</span><br><span class="line">.text:00401938                 nop</span><br><span class="line">.text:00401939                 jz      short loc_401948</span><br><span class="line">.text:0040193B                 jnz     short loc_401948</span><br><span class="line">.text:0040193D                 jmp     short near ptr loc_40191D+2</span><br></pre></td></tr></table></figure>
<p><s>根据我做的那些逆向题目的经验</s><br />
按理说jz的前一条指令是能够对ZF产生影响的, 例如cmp, test<br />
更奇怪的是后面跟了一条jnz和一条jmp</p>
<p>把这三条nop掉就可以定义为函数了<br />
反编译后了下伪代码, 感觉差不多就是<strong>main</strong>函数了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">size_t</span> v5; <span class="comment">// eax</span></span><br><span class="line">  DWORD v6; <span class="comment">// eax</span></span><br><span class="line">  HWND v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">const</span> CHAR *v10; <span class="comment">// [esp+0h] [ebp-44Ch]</span></span><br><span class="line">  <span class="keyword">const</span> CHAR *v11; <span class="comment">// [esp+4h] [ebp-448h]</span></span><br><span class="line">  UINT v12; <span class="comment">// [esp+8h] [ebp-444h]</span></span><br><span class="line">  CHAR v13[<span class="number">256</span>]; <span class="comment">// [esp+54h] [ebp-3F8h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v14[<span class="number">7</span>]; <span class="comment">// [esp+154h] [ebp-2F8h] BYREF</span></span><br><span class="line">  __int16 v15; <span class="comment">// [esp+15Bh] [ebp-2F1h]</span></span><br><span class="line">  <span class="keyword">char</span> v16; <span class="comment">// [esp+15Dh] [ebp-2EFh]</span></span><br><span class="line">  <span class="keyword">char</span> Str[<span class="number">33</span>]; <span class="comment">// [esp+160h] [ebp-2ECh] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v18[<span class="number">220</span>]; <span class="comment">// [esp+181h] [ebp-2CBh] BYREF</span></span><br><span class="line">  __int16 v19; <span class="comment">// [esp+25Dh] [ebp-1EFh]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+25Fh] [ebp-1EDh]</span></span><br><span class="line">  CHAR v21[<span class="number">256</span>]; <span class="comment">// [esp+260h] [ebp-1ECh] BYREF</span></span><br><span class="line">  CHAR String[<span class="number">4</span>]; <span class="comment">// [esp+360h] [ebp-ECh] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v23; <span class="comment">// [esp+364h] [ebp-E8h]</span></span><br><span class="line">  __int16 v24; <span class="comment">// [esp+368h] [ebp-E4h]</span></span><br><span class="line">  CHAR Text[<span class="number">32</span>]; <span class="comment">// [esp+36Ch] [ebp-E0h] BYREF</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tagRECT</span> <span class="title">Rect</span>;</span> <span class="comment">// [esp+38Ch] [ebp-C0h] BYREF</span></span><br><span class="line">  CHAR Buffer[<span class="number">100</span>]; <span class="comment">// [esp+39Ch] [ebp-B0h] BYREF</span></span><br><span class="line">  HDC hdc; <span class="comment">// [esp+400h] [ebp-4Ch]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tagPAINTSTRUCT</span> <span class="title">Paint</span>;</span> <span class="comment">// [esp+404h] [ebp-48h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// [esp+444h] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v31; <span class="comment">// [esp+448h] [ebp-4h]</span></span><br><span class="line">  LPARAM lParam; <span class="comment">// [esp+460h] [ebp+14h]</span></span><br><span class="line"></span><br><span class="line">  LoadStringA(hInstance, <span class="number">0x6A</span>u, Buffer, <span class="number">0x64</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)argv &gt; <span class="number">0x111</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( argv == (<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="number">517</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)String1) &gt; <span class="number">6</span> )</span><br><span class="line">        ExitProcess(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)String1) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="keyword">sizeof</span>(v21));</span><br><span class="line">        v5 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)String1);</span><br><span class="line">        <span class="built_in">memcpy</span>(v21, String1, v5);</span><br><span class="line">        v6 = <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)String1);</span><br><span class="line">        v7 = (HWND)sub_40101E(String1, v6, (LPSTR)String1);</span><br><span class="line">        MessageBoxA(v7, v10, v11, v12);</span><br><span class="line">        <span class="built_in">strcpy</span>(Str, <span class="string">&quot;0kk`d1a`55k222k2a776jbfgd`06cjjb&quot;</span>);</span><br><span class="line">        <span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="keyword">sizeof</span>(v18));</span><br><span class="line">        v19 = <span class="number">0</span>;</span><br><span class="line">        v20 = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">strcpy</span>(v14, <span class="string">&quot;SS&quot;</span>);</span><br><span class="line">        *(_DWORD *)&amp;v14[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">        v15 = <span class="number">0</span>;</span><br><span class="line">        v16 = <span class="number">0</span>;</span><br><span class="line">        v8 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">        sub_401005(v14, (<span class="keyword">int</span>)Str, v8);</span><br><span class="line">        <span class="keyword">if</span> ( _strcmpi((<span class="keyword">const</span> <span class="keyword">char</span> *)String1, Str) )</span><br><span class="line">        &#123;</span><br><span class="line">          SetWindowTextA((HWND)argc, <span class="string">&quot;flag&#123;&#125;&quot;</span>);</span><br><span class="line">          MessageBoxA((HWND)argc, <span class="string">&quot;Are you kidding me?&quot;</span>, <span class="string">&quot;^_^&quot;</span>, <span class="number">0</span>);</span><br><span class="line">          ExitProcess(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memcpy</span>(v13, &amp;unk_423030, <span class="number">0x32</span>u);</span><br><span class="line">        v9 = <span class="built_in">strlen</span>(v13);</span><br><span class="line">        sub_401005(v21, (<span class="keyword">int</span>)v13, v9);</span><br><span class="line">        MessageBoxA((HWND)argc, v13, <span class="number">0</span>, <span class="number">0x32</span>u);</span><br><span class="line">      &#125;</span><br><span class="line">      ++dword_428D54;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( argv != (<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="number">520</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcA((HWND)argc, (UINT)argv, (WPARAM)envp, lParam);</span><br><span class="line">      <span class="keyword">if</span> ( dword_428D54 == <span class="number">16</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">strcpy</span>(String, <span class="string">&quot;ctf&quot;</span>);</span><br><span class="line">        v23 = <span class="number">0</span>;</span><br><span class="line">        v24 = <span class="number">0</span>;</span><br><span class="line">        SetWindowTextA((HWND)argc, String);</span><br><span class="line">        <span class="built_in">strcpy</span>(Text, <span class="string">&quot;Are you kidding me?&quot;</span>);</span><br><span class="line">        MessageBoxA((HWND)argc, Text, Buffer, <span class="number">0</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ++dword_428D54;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( argv == (<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="number">273</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v31 = (<span class="keyword">unsigned</span> __int16)envp;</span><br><span class="line">    v30 = HIWORD(envp);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int16)envp == <span class="number">104</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      DialogBoxParamA(hInstance, (LPCSTR)<span class="number">0x67</span>, (HWND)argc, (DLGPROC)DialogFunc, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int16)envp != <span class="number">105</span> )</span><br><span class="line">        <span class="keyword">return</span> DefWindowProcA((HWND)argc, (UINT)argv, (WPARAM)envp, lParam);</span><br><span class="line">      DestroyWindow((HWND)argc);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( argv == (<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    PostQuitMessage(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( argv != (<span class="keyword">const</span> <span class="keyword">char</span> **)<span class="number">15</span> )</span><br><span class="line">      <span class="keyword">return</span> DefWindowProcA((HWND)argc, (UINT)argv, (WPARAM)envp, lParam);</span><br><span class="line">    hdc = BeginPaint((HWND)argc, &amp;Paint);</span><br><span class="line">    GetClientRect((HWND)argc, &amp;Rect);</span><br><span class="line">    v4 = <span class="built_in">strlen</span>(Buffer);</span><br><span class="line">    DrawTextA(hdc, Buffer, v4, &amp;Rect, <span class="number">1u</span>);</span><br><span class="line">    EndPaint((HWND)argc, &amp;Paint);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>先跟进<code>sub_40101E</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( CryptCreateHash(phProv, <span class="number">0x8003</span>u, <span class="number">0</span>, <span class="number">0</span>, &amp;phHash) )</span><br></pre></td></tr></table></figure>
<p>看到这句就知道是md5加密了</p>
<p>再跟进<code>sub_401005</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">int</span> __cdecl <span class="title">sub_401590</span><span class="params">(LPCSTR lpString, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> i; <span class="comment">// [esp+4Ch] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v5; <span class="comment">// [esp+54h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = lstrlenA(lpString);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a3 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a2) ^= lpString[i % v5];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的异或</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub_401005(v14, (<span class="keyword">int</span>)Str, v8);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>v14 = &quot;SS&quot;</code></li>
<li><code>Str = &quot;0kk`d1a`55k222k2a776jbfgd`06cjjb&quot;</code></li>
<li><code>v8 = 32</code></li>
</ul>
<p>也就是说<code>Str</code>在异或之后与<code>String1</code>的md5结果比较</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">xor = <span class="string">&quot;0kk`d1a`55k222k2a776jbfgd`06cjjb&quot;</span></span><br><span class="line">dexor = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xor:</span><br><span class="line">  dexor += <span class="built_in">chr</span>(<span class="built_in">ord</span>(_) ^ <span class="built_in">ord</span>(<span class="string">&quot;S&quot;</span>))</span><br><span class="line">print(dexor)</span><br></pre></td></tr></table></figure>
<p>得到<code>c8837b23ff8aaa8a2dde915473ce0991</code><br />
md5解密结果为<code>123321</code></p>
<p>再跟进函数<code>DialogFunc</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __stdcall <span class="title">sub_401B20</span><span class="params">(HWND hDlg, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x110</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x111</span>:</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int16)a3 != <span class="number">1</span> &amp;&amp; (<span class="keyword">unsigned</span> __int16)a3 != <span class="number">2</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      EndDialog(hDlg, (<span class="keyword">unsigned</span> __int16)a3);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x202</span>:</span><br><span class="line">LABEL_6:</span><br><span class="line">      String1[dword_428C50++] = <span class="number">49</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x205</span>:</span><br><span class="line">      String1[dword_428C50++] = <span class="number">51</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x208</span>:</span><br><span class="line">      <span class="keyword">if</span> ( dword_428D58 &lt; <span class="number">3</span> )</span><br><span class="line">        ++dword_428D5C;</span><br><span class="line">      String1[dword_428C50++] = <span class="number">50</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的<code>a2</code>一开始没太懂<br />
后来看了别人的wp才知道貌似是Windows Message</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_LBUTTONUP                    0x0202</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_MBUTTONUP                    0x0208</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> WM_RBUTTONUP                    0x0205</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-lbuttonup">https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-lbuttonup</a><br />
<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-mbuttonup">https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-mbuttonup</a><br />
<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-rbuttonup">https://docs.microsoft.com/en-us/windows/win32/inputdev/wm-rbuttonup</a></p>
</blockquote>
<p>那么也就是按<code>鼠标左键, 鼠标中键, 鼠标右键, 鼠标右键, 鼠标中键, 鼠标左键</code></p>
<p>值得一提的是, 调用函数<code>DialogFunc</code>代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DialogBoxParamA(hInstance, (LPCSTR)<span class="number">103</span>, (HWND)argc, (DLGPROC)DialogFunc, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>在<code>Resource Hacker</code>中可以看到编号<code>103</code>对应着<code>About</code>对话框<br />
也就是说需要在About对话框中按上述顺序点击鼠标<br />
<s>不是做这道题我都不会意识到我的鼠标中键已经报废了, 最后动调改<code>String1</code>的值</s></p>
<blockquote>
<p><strong>flag{n0_Zu0_n0_die}</strong></p>
</blockquote>
<hr />
<h1 id="flareon5minesweeper-championship-registration"><a class="markdownIt-Anchor" href="#flareon5minesweeper-championship-registration"></a> [FlareOn5]Minesweeper Championship Registration</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BFlareOn5%5DMinesweeper%20Championship%20Registration">https://buuoj.cn/challenges#[FlareOn5]Minesweeper Championship Registration</a></p>
<p>Java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.JOptionPane;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InviteValidator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    String response = JOptionPane.showInputDialog(<span class="keyword">null</span>, <span class="string">&quot;Enter your invitation code:&quot;</span>, <span class="string">&quot;Minesweeper Championship 2018&quot;</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="keyword">if</span> (response.equals(<span class="string">&quot;GoldenTicket2018@flare-on.com&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">      JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">&quot;Welcome to the Minesweeper Championship 2018!\nPlease enter the following code to the ctfd.flare-on.com website to compete:\n\n&quot;</span> + response, <span class="string">&quot;Success!&quot;</span>, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      JOptionPane.showMessageDialog(<span class="keyword">null</span>, <span class="string">&quot;Incorrect invitation code. Please try again next year.&quot;</span>, <span class="string">&quot;Failure&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag写脸上了</p>
<blockquote>
<p><strong>flag{GoldenTicket2018@flare-on.com}</strong></p>
</blockquote>
<hr />
<h1 id="网鼎杯-2020-青龙组jocker"><a class="markdownIt-Anchor" href="#网鼎杯-2020-青龙组jocker"></a> [网鼎杯 2020 青龙组]jocker</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5B%E7%BD%91%E9%BC%8E%E6%9D%AF%202020%20%E9%9D%92%E9%BE%99%E7%BB%84%5Djocker">https://buuoj.cn/challenges#[网鼎杯 2020 青龙组]jocker</a></p>
<p>EXE 32</p>
<p>主函数看到对函数进行异或就知道不对劲了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;idc.idc&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> addr = <span class="number">0x00401500</span>;</span><br><span class="line">    <span class="keyword">auto</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= <span class="number">186</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        PatchByte(addr+i, Byte(addr+i)^<span class="number">0x41</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>具体步骤参照这里<br />
<a href="http://yoloyolo.top/2021/05/31/Reverse-3/#gwctf-2019re3">http://yoloyolo.top/2021/05/31/Reverse-3/#gwctf-2019re3</a><br />
函数<code>finally</code>的前一部分也有被异或过, 需要重新定义为函数</p>
<p>函数<strong>main</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> Str[<span class="number">50</span>]; <span class="comment">// [esp+12h] [ebp-96h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> Destination[<span class="number">80</span>]; <span class="comment">// [esp+44h] [ebp-64h] BYREF</span></span><br><span class="line">  DWORD flOldProtect; <span class="comment">// [esp+94h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="keyword">size_t</span> v7; <span class="comment">// [esp+98h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  __main();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input you flag:&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !VirtualProtect(encrypt, <span class="number">0xC8</span>u, <span class="number">4u</span>, &amp;flOldProtect) )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%40s&quot;</span>, Str);</span><br><span class="line">  v7 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  <span class="keyword">if</span> ( v7 != <span class="number">24</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(Destination, Str);</span><br><span class="line">  wrong(Str);</span><br><span class="line">  omg(Str);</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( encrypt(Destination) )</span><br><span class="line">    finally(Destination);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>跟进函数<code>wrong</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">wrong</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+Ch] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = &amp;a1[i];</span><br><span class="line">    <span class="keyword">if</span> ( (i &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      a1[i] -= i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      a1[i] ^= i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>简单的加密<br />
继续看函数<code>omg</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">omg</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v2[<span class="number">24</span>]; <span class="comment">// [esp+18h] [ebp-80h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+78h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+7Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">1</span>;</span><br><span class="line">  qmemcpy(v2, dword_4030C0, <span class="keyword">sizeof</span>(v2));</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">23</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1[i] != v2[i] )</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;hahahaha_do_you_find_me?&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;wrong ~~ But seems a little program&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">_4030C0 = [</span><br><span class="line"><span class="number">0x66</span>, <span class="number">0x6B</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x7F</span>, <span class="number">0x61</span>, <span class="number">0x67</span>, <span class="number">0x64</span>, </span><br><span class="line"><span class="number">0x3B</span>, <span class="number">0x56</span>, <span class="number">0x6B</span>, <span class="number">0x61</span>, <span class="number">0x7B</span>, <span class="number">0x26</span>, <span class="number">0x3B</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x5F</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x71</span>, <span class="number">0x0C</span>, <span class="number">0x37</span>, <span class="number">0x66</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(_4030C0)):</span><br><span class="line">  <span class="keyword">if</span> _ % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">    flag += <span class="built_in">chr</span>(_4030C0[_] ^ _)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    flag += <span class="built_in">chr</span>(_4030C0[_] + _)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p>得到<code>flag&#123;fak3_alw35_sp_me!!&#125;</code><br />
然而是个假flag</p>
<p>继续看函数<code>encrypt</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">encrypt</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2[<span class="number">19</span>]; <span class="comment">// [esp+1Ch] [ebp-6Ch] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [esp+68h] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [esp+6Ch] [ebp-1Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">1</span>;</span><br><span class="line">  qmemcpy(v2, dword_403040, <span class="keyword">sizeof</span>(v2));</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">18</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">char</span>)(a1[i] ^ Buffer[i]) != v2[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;wrong ~&quot;</span>);</span><br><span class="line">      v3 = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;come here&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line">_buffer = <span class="string">&quot;hahahaha_do_you_find_me?&quot;</span></span><br><span class="line">_403040 = [</span><br><span class="line"><span class="number">0x0E</span>, <span class="number">0x0D</span>, <span class="number">0x09</span>, <span class="number">0x06</span>, <span class="number">0x13</span>, <span class="number">0x05</span>, <span class="number">0x58</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x3E</span>, <span class="number">0x06</span>, <span class="number">0x0C</span>, <span class="number">0x3C</span>, <span class="number">0x1F</span>, <span class="number">0x57</span>, <span class="number">0x14</span>, <span class="number">0x6B</span>, </span><br><span class="line"><span class="number">0x57</span>, <span class="number">0x59</span>, <span class="number">0x0D</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(_403040)):</span><br><span class="line">  flag += <span class="built_in">chr</span>(_403040[_] ^ <span class="built_in">ord</span>(_buffer[_]))</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p>得到<code>flag&#123;d07abccf8a410c</code><br />
缺了五个字符</p>
<p>看函数<code>finally</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">finally</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v3[<span class="number">9</span>]; <span class="comment">// [esp+13h] [ebp-15h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(v3, <span class="string">&quot;%tp&amp;:&quot;</span>);</span><br><span class="line">  v1 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v1);</span><br><span class="line">  v4 = rand() % <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v3[*(_DWORD *)&amp;v3[<span class="number">5</span>]] != a1[*(_DWORD *)&amp;v3[<span class="number">5</span>]]) == v4 )</span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;Really??? Did you find it?OMG!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    result = <span class="built_in">puts</span>(<span class="string">&quot;I hide the last part, you will not succeed!!!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看着有点发蒙, 感觉也没有在做什么正经的运算<br />
v3的赋值算是给了一点点提示吧<br />
奇奇怪怪的脑洞</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">hex</span>(<span class="built_in">ord</span>(<span class="string">&quot;:&quot;</span>)^<span class="built_in">ord</span>(<span class="string">&#x27;&#125;&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;0x47&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">key = <span class="number">0x47</span></span><br><span class="line">flag = <span class="string">&quot;flag&#123;d07abccf8a410c&quot;</span></span><br><span class="line">v3 = <span class="string">&quot;%tp&amp;:&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> v3:</span><br><span class="line">  flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(_) ^ key)</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{d07abccf8a410cb37a}</strong></p>
</blockquote>
<hr />
<h1 id="equation"><a class="markdownIt-Anchor" href="#equation"></a> equation</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#equation">https://buuoj.cn/challenges#equation</a></p>
<p>Javascript</p>
<p>看着这道题莫名地会想到&quot;高明的黑客&quot;<br />
没啥好说的, 直接放代码</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line">raw = <span class="built_in">open</span>(<span class="string">&quot;equation.html&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">data = re.findall(<span class="string">&quot;if\((.*)\)&quot;</span>, raw)[<span class="number">0</span>]</span><br><span class="line">data_list = data.split(<span class="string">&quot;&amp;&amp;&quot;</span>)</span><br><span class="line">exp_sum = []</span><br><span class="line">res_sum = []</span><br><span class="line"><span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_list)):</span><br><span class="line">  test = data_list[cnt].split(<span class="string">&quot;==&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">  equ = data_list[cnt].split(<span class="string">&quot;==&quot;</span>)[<span class="number">1</span>]</span><br><span class="line">  res = [<span class="built_in">int</span>(execjs.<span class="built_in">eval</span>(equ))]</span><br><span class="line">  res_sum.append(res)</span><br><span class="line">  symbol = []</span><br><span class="line">  <span class="keyword">if</span> test.startswith(<span class="string">&quot;-&quot;</span>):</span><br><span class="line">    symbol.append(<span class="string">&quot;-&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    symbol.append(<span class="string">&quot;+&quot;</span>)</span><br><span class="line">  test = re.sub(<span class="string">&quot;\]\+l\[&quot;</span>, <span class="string">&quot; + &quot;</span>, test)</span><br><span class="line">  test = re.sub(<span class="string">&quot;\]\-l\[&quot;</span>, <span class="string">&quot; - &quot;</span>, test)</span><br><span class="line">  test = test.replace(<span class="string">&quot;l[&quot;</span>, <span class="string">&quot;&quot;</span>)[:-<span class="number">1</span>]</span><br><span class="line">  symbol_temp = re.findall(<span class="string">&quot; ([\+\-]) &quot;</span>, test)</span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> symbol_temp:</span><br><span class="line">    symbol.append(_)</span><br><span class="line">  test = re.sub(<span class="string">&quot; [\+\-] &quot;</span>, <span class="string">&quot; &quot;</span>,test)</span><br><span class="line">  jscode = test.split(<span class="string">&quot; &quot;</span>)</span><br><span class="line">  exp = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>)]</span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(jscode)):</span><br><span class="line">    seq = <span class="built_in">int</span>(execjs.<span class="built_in">eval</span>(jscode[_]))</span><br><span class="line">    <span class="keyword">if</span> symbol[_] == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">      exp[seq] = <span class="number">1</span></span><br><span class="line">    <span class="keyword">elif</span> symbol[_] == <span class="string">&quot;-&quot;</span>:</span><br><span class="line">      exp[seq] = -<span class="number">1</span></span><br><span class="line">  exp_sum.append(exp)</span><br><span class="line">b = Matrix(res_sum)</span><br><span class="line">x = Matrix(exp_sum)</span><br><span class="line">out = x.solve_right(b)</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> out:</span><br><span class="line">  flag += <span class="built_in">chr</span>(_[<span class="number">0</span>])</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<p><code>execjs.eval()</code>运行的速度好慢, 也懒得找能够代替这个函数的函数了<br />
100次17s, 1638个字符串, 5分钟左右</p>
<hr />
<h1 id="flareon5ultimate-minesweeper"><a class="markdownIt-Anchor" href="#flareon5ultimate-minesweeper"></a> [FlareOn5]Ultimate Minesweeper</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BFlareOn5%5DUltimate%20Minesweeper">https://buuoj.cn/challenges#[FlareOn5]Ultimate Minesweeper</a></p>
<p>.NET</p>
<p>先放IDA里看看<br />
看到字符串<code>&quot;Congratulations!&quot;</code></p>
<p>查看引用这个字符串的函数, 然后用dnspy看这些函数</p>
<p><code>MainForm::SquareRevealedCallback</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UltimateMinesweeper.MainForm</span></span><br><span class="line"><span class="comment">// Token: 0x0600000C RID: 12 RVA: 0x00002348 File Offset: 0x00000548</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SquareRevealedCallback</span>(<span class="params">uint column, uint row</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.MineField.BombRevealed)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>.stopwatch.Stop();</span><br><span class="line">    Application.DoEvents();</span><br><span class="line">    Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">new</span> FailurePopup().ShowDialog();</span><br><span class="line">    Application.Exit();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.RevealedCells.Add(row * MainForm.VALLOC_NODE_LIMIT + column);</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.MineField.TotalUnrevealedEmptySquares == <span class="number">0</span>)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>.stopwatch.Stop();</span><br><span class="line">    Application.DoEvents();</span><br><span class="line">    Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">new</span> SuccessPopup(<span class="keyword">this</span>.GetKey(<span class="keyword">this</span>.RevealedCells)).ShowDialog();</span><br><span class="line">    Application.Exit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把判断失败的代码删掉再保存程序<br />
找出三个点就能够进入过关的逻辑<br />
但是flag的内容应该是与点击的格子相关<br />
而且点的位置不是随机生成的<br />
记下位置再玩一遍就能得到flag</p>
<blockquote>
<p><strong>flag{Ch3aters_Alw4ys_W1n@flare-on.com}</strong></p>
</blockquote>
<hr />
<h1 id="2019红帽杯childre"><a class="markdownIt-Anchor" href="#2019红帽杯childre"></a> [2019红帽杯]childRE</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5B2019%E7%BA%A2%E5%B8%BD%E6%9D%AF%5DchildRE">https://buuoj.cn/challenges#[2019红帽杯]childRE</a></p>
<p>EXE 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">const</span> CHAR *v5; <span class="comment">// r11</span></span><br><span class="line">  __int64 v6; <span class="comment">// r10</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// er9</span></span><br><span class="line">  <span class="keyword">const</span> CHAR *v8; <span class="comment">// r10</span></span><br><span class="line">  __int64 v9; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// ecx</span></span><br><span class="line">  __int64 v13; <span class="comment">// r9</span></span><br><span class="line">  __int128 v14[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-38h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v14[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v14[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">  sub_140001080(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">  v3 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v3;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)v14 + v3) );</span><br><span class="line">  <span class="keyword">if</span> ( v3 != <span class="number">31</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      Sleep(<span class="number">0x3E8</span>u);</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = sub_140001280(v14);</span><br><span class="line">  v5 = name;</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_1400015C0(*(_QWORD *)(v4 + <span class="number">8</span>));</span><br><span class="line">    sub_1400015C0(*(_QWORD *)(v6 + <span class="number">16</span>));</span><br><span class="line">    v7 = dword_1400057E0;</span><br><span class="line">    v5[dword_1400057E0] = *v8;</span><br><span class="line">    dword_1400057E0 = v7 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  UnDecorateSymbolName(v5, outputString, <span class="number">0x100</span>u, <span class="number">0</span>);</span><br><span class="line">  v9 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v9;</span><br><span class="line">  <span class="keyword">while</span> ( outputString[v9] );</span><br><span class="line">  <span class="keyword">if</span> ( v9 == <span class="number">62</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    v13 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a1234567890Qwer[outputString[v13] % <span class="number">23</span>] != *(_BYTE *)(v13 + <span class="number">0x140003478</span>i64) )</span><br><span class="line">        _exit(v12);</span><br><span class="line">      <span class="keyword">if</span> ( a1234567890Qwer[outputString[v13] / <span class="number">23</span>] != *(_BYTE *)(v13 + <span class="number">0x140003438</span>i64) )</span><br><span class="line">        _exit(v12 * v12);</span><br><span class="line">      ++v12;</span><br><span class="line">      ++v13;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v12 &lt; <span class="number">0x3E</span> );</span><br><span class="line">    sub_140001020(<span class="string">&quot;flag&#123;MD5(your input)&#125;\n&quot;</span>);</span><br><span class="line">    result = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v10 = sub_1400018A0(<span class="built_in">std</span>::<span class="built_in">cout</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v10, sub_140001A60);</span><br><span class="line">    result = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>0x140003478i64</code>即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.rdata:0000000140003478 a46200860044218 db &#39;(_@4620!08!6_0*0442!@186%%0@3&#x3D;66!!974*3234&#x3D;&amp;0^3&amp;1@&#x3D;&amp;0908!6_0*&amp;&#39;,0</span><br></pre></td></tr></table></figure>
<p>先还原出outputString</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">_003478 = <span class="string">&quot;(_@4620!08!6_0*0442!@186%%0@3=66!!974*3234=&amp;0^3&amp;1@=&amp;0908!6_0*&amp;&quot;</span></span><br><span class="line">_003438 = <span class="string">&quot;55565653255552225565565555243466334653663544426565555525555222&quot;</span></span><br><span class="line">_0033A0 = <span class="string">&quot;1234567890-=!@#$%^&amp;*()_+qwertyuiop[]QWERTYUIOP&#123;&#125;asdfghjkl;&#x27;ASDFGHJKL:\&quot;ZXCVBNM&lt;&gt;?zxcvbnm,./&quot;</span></span><br><span class="line">output = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> _003478]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(_003478)):</span><br><span class="line">  b = _0033A0.index(_003478[_])</span><br><span class="line">  a = _0033A0.index(_003438[_])</span><br><span class="line">  output[_] = <span class="built_in">chr</span>(<span class="number">23</span> * a + b)</span><br><span class="line">cipher = <span class="string">&quot;&quot;</span>.join(output)</span><br><span class="line">print(cipher)</span><br></pre></td></tr></table></figure>
<p>得到结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private: char * __thiscall R0Pxx::My_Aut0_PWN(unsigned char *)Traceback (most recent call last)</span><br></pre></td></tr></table></figure>
<p>然后是C++名字修饰<br />
在一块实在没怎么了解过</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.freesion.com/article/6515734088/">https://www.freesion.com/article/6515734088/</a></p>
</blockquote>
<p>中间的函数貌似有替换字符串顺序<br />
断点下到<code>UnDecorateSymbolName(v5, outputString, 0x100u, 0);</code>就能在寄存器看到替换顺序之后字符串</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line">decorate = <span class="string">&quot;?My_Aut0_PWN@R0Pxx@@AAEPADPAE@Z&quot;</span></span><br><span class="line">seq1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_&quot;</span></span><br><span class="line">seq2 = <span class="string">&quot;PQHRSIDTUJVWKEBXYLZ[MF\\]N^_OGCA&quot;</span></span><br><span class="line">cipher = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> decorate]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">  cipher[_] = decorate[seq2.index(seq1[_])]</span><br><span class="line">print(<span class="string">&quot;&quot;</span>.join(cipher))</span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.md5(<span class="string">&quot;&quot;</span>.join(cipher).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{63b148e750fed3a33419168ac58083f5}</strong></p>
</blockquote>
<hr />
<h1 id="actf新生赛2020soullike"><a class="markdownIt-Anchor" href="#actf新生赛2020soullike"></a> [ACTF新生赛2020]SoulLike</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BACTF%E6%96%B0%E7%94%9F%E8%B5%9B2020%5DSoulLike">https://buuoj.cn/challenges#[ACTF新生赛2020]SoulLike</a></p>
<p>ELF 64</p>
<p>IDA中 <strong>main</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">main</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v5; <span class="comment">// [rsp+7h] [rbp-B9h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+8h] [rbp-B8h]</span></span><br><span class="line">  <span class="keyword">int</span> j; <span class="comment">// [rsp+Ch] [rbp-B4h]</span></span><br><span class="line">  <span class="keyword">int</span> v8[<span class="number">14</span>]; <span class="comment">// [rsp+10h] [rbp-B0h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v9[<span class="number">110</span>]; <span class="comment">// [rsp+4Ah] [rbp-76h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v10; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;input flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, &amp;v9[<span class="number">6</span>]);  <span class="built_in">strcpy</span>(v9, <span class="string">&quot;actf&#123;&quot;</span>);</span><br><span class="line">  v5 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v9[i] != v9[i + <span class="number">6</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v5 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">LABEL_6:</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">11</span>; ++j )</span><br><span class="line">    v8[j] = v9[j + <span class="number">11</span>];</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)sub_83A(v8) &amp;&amp; v9[<span class="number">23</span>] == <span class="number">125</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s true! flag is %s&quot;</span>, &amp;v9[<span class="number">6</span>]);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">LABEL_16:</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Try another time...&quot;</span>);</span><br><span class="line">    result = <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数<code>sub_83A</code>代码过长<br />
IDA无法反编译<br />
需要修改文件<code>hexrays.cfg</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MAX_FUNCSIZE            &#x3D; 64        &#x2F;&#x2F; Functions over 64K are not decompiled</span><br></pre></td></tr></table></figure>
<p>这个数值改大点就行</p>
<p>反编译了<code>sub_83A</code>就知道该干嘛了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;r&quot;</span>).read().replace(<span class="string">&quot;  &quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;u;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;;&quot;</span>, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;*a1&quot;</span>, <span class="string">&quot;a1[0]&quot;</span>)</span><br><span class="line">data = re.sub(<span class="string">&quot;\+\+(.*)&quot;</span>, <span class="string">&quot;\\1 -= 1&quot;</span>, data).split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">write = <span class="built_in">open</span>(<span class="string">&quot;data_re.py&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">write.write(<span class="string">&quot;a1 = [126, 50, 37, 88, 89, 107, 53, 110, 0, 19, 30, 56]\n&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> data[::-<span class="number">1</span>]:</span><br><span class="line">  write.write(_+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">write.write(<span class="string">&quot;&quot;&quot;flag = &quot;flag&#123;&quot;</span></span><br><span class="line"><span class="string">for _ in a1:</span></span><br><span class="line"><span class="string">  flag += chr(_)</span></span><br><span class="line"><span class="string">flag += &quot;&#125;&quot;</span></span><br><span class="line"><span class="string">print(flag)&quot;&quot;&quot;</span>)</span><br><span class="line">write.close()</span><br><span class="line">os.system(<span class="string">&quot;python3 data_re.py&quot;</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{b0Nf|Re_LiT!}</strong></p>
</blockquote>
<hr />
<h1 id="mrctf2020pixelshooter"><a class="markdownIt-Anchor" href="#mrctf2020pixelshooter"></a> [MRCTF2020]PixelShooter</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BMRCTF2020%5DPixelShooter">https://buuoj.cn/challenges#[MRCTF2020]PixelShooter</a></p>
<p>Android</p>
<p>貌似是用了U3D, 改成zip解压, 找到<code>Assembly-CSharp.dll</code><br />
在IDA里看字符串就行</p>
<blockquote>
<p><strong>flag{Unity_1S_Fun_233}</strong></p>
</blockquote>
<hr />
<h1 id="安洵杯-2019crackme"><a class="markdownIt-Anchor" href="#安洵杯-2019crackme"></a> [安洵杯 2019]crackMe</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5B%E5%AE%89%E6%B4%B5%E6%9D%AF%202019%5DcrackMe">https://buuoj.cn/challenges#[安洵杯 2019]crackMe</a></p>
<p>EXE 32</p>
<p>IDA中 <strong>_main_0</strong> 函数反编译结果如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main_0</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> (__cdecl *v3)(_DWORD *); <span class="comment">// [esp-4h] [ebp-D0h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please Input the flag:\n&quot;</span>);</span><br><span class="line">  scanf_s(<span class="string">&quot;%s&quot;</span>, &amp;unk_41A1E4);</span><br><span class="line">  MessageBoxW(<span class="number">0</span>, <span class="string">L&quot;Exception&quot;</span>, <span class="string">L&quot;Warning&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  v3 = sub_41100F;</span><br><span class="line">  MEMORY[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">  sub_411136(HIWORD(v3));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行的时候回弹一个&quot;hooked&quot;的窗口<br />
动调发现函数<code>MessageBoxW</code>被hook到了<code>sub_412AB0</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __stdcall <span class="title">sub_412AB0</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3, <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> i; <span class="comment">// [esp+D8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; j_strlen(Str); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] &lt;= <span class="number">122</span> &amp;&amp; Str[i] &gt;= <span class="number">97</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      Str[i] -= <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( Str[i] &lt;= <span class="number">90</span> &amp;&amp; Str[i] &gt;= <span class="number">65</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      Str[i] += <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  MessageBoxA(<span class="number">0</span>, <span class="string">&quot;hooked&quot;</span>, <span class="string">&quot;successed&quot;</span>, <span class="number">0</span>);</span><br><span class="line">  AddVectoredExceptionHandler(<span class="number">0</span>, Handler);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>做了一个VEH的异常处理</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __stdcall <span class="title">Handler_0</span><span class="params">(_DWORD **a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2[<span class="number">20</span>]; <span class="comment">// [esp+D0h] [ebp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( **a1 == <span class="number">-1073741819</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    qmemcpy(v2, <span class="string">&quot;where_are_u_now?&quot;</span>, <span class="number">16</span>);</span><br><span class="line">    sub_411172(&amp;unk_41A218, v2);</span><br><span class="line">    SetUnhandledExceptionFilter(TopLevelExceptionFilter);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>VEH异常处理又套了一个SEH异常处理<br />
运行完函数<code>sub_41100F</code>之后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov dword ptr [eax], 1</span><br></pre></td></tr></table></figure>
<p>这条语句会触发异常<br />
从而进入VEH的异常处理函数</p>
<p>理一遍顺序</p>
<ul>
<li>Base64表内容变换</li>
<li>函数<code>sub_411172</code>使用SM4加密输入内容(搜一下<code>0xA3B1BAC6</code>)</li>
<li>Str2顺序变换</li>
<li>函数<code>sub_4110FF</code>变换Base64表顺序</li>
<li>Str2与Base64编码结果比较</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> pysm4</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&quot;1UTAOIkpyOSWGv/mOYFY4R!!&quot;</span></span><br><span class="line">cipher_list = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> cipher ]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(cipher_list), <span class="number">2</span>): <span class="comment"># 换位</span></span><br><span class="line">  cipher_list[_] = cipher[_+<span class="number">1</span>]</span><br><span class="line">  cipher_list[_+<span class="number">1</span>] = cipher[_]</span><br><span class="line">cipher = <span class="string">&quot;&quot;</span>.join(cipher_list).replace(<span class="string">&quot;!&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">base64_table = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span> </span><br><span class="line">base64_table_re = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> base64_table]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(base64_table_re)): <span class="comment"># 换Base64表</span></span><br><span class="line">  <span class="keyword">if</span> <span class="number">97</span> &lt;= <span class="built_in">ord</span>(base64_table[(_+<span class="number">24</span>)%<span class="number">64</span>]) &lt;= <span class="number">122</span>:</span><br><span class="line">    base64_table_re[_] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(base64_table[(_+<span class="number">24</span>)%<span class="number">64</span>])-<span class="number">32</span>)</span><br><span class="line">  <span class="keyword">elif</span> <span class="number">65</span> &lt;= <span class="built_in">ord</span>(base64_table[(_+<span class="number">24</span>)%<span class="number">64</span>]) &lt;= <span class="number">90</span>:</span><br><span class="line">    base64_table_re[_] = <span class="built_in">chr</span>(<span class="built_in">ord</span>(base64_table[(_+<span class="number">24</span>)%<span class="number">64</span>])+<span class="number">32</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    base64_table_re[_] = base64_table[(_+<span class="number">24</span>)%<span class="number">64</span>]</span><br><span class="line">base64_table_re = <span class="string">&quot;&quot;</span>.join(base64_table_re)</span><br><span class="line"></span><br><span class="line">cipher_list = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> cipher]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)): <span class="comment"># Base64换表解码</span></span><br><span class="line">  cipher_list[_] = base64_table[base64_table_re.index(cipher[_])]</span><br><span class="line">cipher = <span class="string">&quot;&quot;</span>.join(cipher_list)</span><br><span class="line">cipher = base64.b64decode(cipher+<span class="string">&quot;==&quot;</span>)</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;where_are_u_now?&quot;</span> <span class="comment"># SM4解密</span></span><br><span class="line">flag = pysm4.decrypt(<span class="built_in">int</span>(binascii.hexlify(cipher).decode(), <span class="number">16</span>), (<span class="built_in">int</span>(binascii.hexlify(key).decode(), <span class="number">16</span>)))</span><br><span class="line">print(binascii.unhexlify(<span class="built_in">hex</span>(flag)[<span class="number">2</span>:].encode()))</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>flag{SM4foRExcepioN?!}</strong></p>
</blockquote>
<hr />
<h1 id="flareon1bob-doge"><a class="markdownIt-Anchor" href="#flareon1bob-doge"></a> [FlareOn1]Bob Doge</h1>
<p>链接: <a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#%5BFlareOn1%5DBob%20Doge">https://buuoj.cn/challenges#[FlareOn1]Bob Doge</a></p>
<p>EXE 64</p>
<p>下载下来是一个安装程序<br />
得到<code>Challenge1.exe</code><br />
丢进dnspy64<br />
在函数<code>btnDecode_Click</code>里打断点看字符串<br />
可以看到flag</p>
<blockquote>
<p><strong>flag{3rmahg3rd.b0b.d0ge@flare-on.com}</strong></p>
</blockquote>
<hr />
<p>EOF</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>xXxYOLOxXx
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://yoloyolo.top/2021/05/31/Reverse-3/" title="Reverse_3">https://yoloyolo.top/2021/05/31/Reverse-3/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Reverse/" rel="tag"># Reverse</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/05/24/Reverse-PEB/" rel="prev" title="Reverse_PEB">
      <i class="fa fa-chevron-left"></i> Reverse_PEB
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/04/CISCN-SE-Semifinal/" rel="next" title="CISCN-SE_Semifinal">
      CISCN-SE_Semifinal <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84singal"><span class="nav-number">1.</span> <span class="nav-text"> [网鼎杯 2020 青龙组]singal</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#gxyctf2019simple-cpp"><span class="nav-number">2.</span> <span class="nav-text"> [GXYCTF2019]simple CPP</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#wustctf2020level4"><span class="nav-number">3.</span> <span class="nav-text"> [WUSTCTF2020]level4</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#guet-ctf2019number_game"><span class="nav-number">4.</span> <span class="nav-text"> [GUET-CTF2019]number_game</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#gwctf-2019re3"><span class="nav-number">5.</span> <span class="nav-text"> [GWCTF 2019]re3</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AFxx"><span class="nav-number">6.</span> <span class="nav-text"> [2019红帽杯]xx</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#findkey"><span class="nav-number">7.</span> <span class="nav-text"> findKey</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flareon5minesweeper-championship-registration"><span class="nav-number">8.</span> <span class="nav-text"> [FlareOn5]Minesweeper Championship Registration</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E9%9D%92%E9%BE%99%E7%BB%84jocker"><span class="nav-number">9.</span> <span class="nav-text"> [网鼎杯 2020 青龙组]jocker</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#equation"><span class="nav-number">10.</span> <span class="nav-text"> equation</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flareon5ultimate-minesweeper"><span class="nav-number">11.</span> <span class="nav-text"> [FlareOn5]Ultimate Minesweeper</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2019%E7%BA%A2%E5%B8%BD%E6%9D%AFchildre"><span class="nav-number">12.</span> <span class="nav-text"> [2019红帽杯]childRE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#actf%E6%96%B0%E7%94%9F%E8%B5%9B2020soullike"><span class="nav-number">13.</span> <span class="nav-text"> [ACTF新生赛2020]SoulLike</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mrctf2020pixelshooter"><span class="nav-number">14.</span> <span class="nav-text"> [MRCTF2020]PixelShooter</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019crackme"><span class="nav-number">15.</span> <span class="nav-text"> [安洵杯 2019]crackMe</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#flareon1bob-doge"><span class="nav-number">16.</span> <span class="nav-text"> [FlareOn1]Bob Doge</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xXxYOLOxXx</p>
  <div class="site-description" itemprop="description">Explorer for unknown.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/monster414" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;monster414" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yolo-yolo@qq.com" title="E-Mail → mailto:yolo-yolo@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=302397927" title="CloudMisuc → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;302397927" rel="noopener" target="_blank"><i class=" fa-fw"></i>CloudMisuc</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/id/Purple_Miracle/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;Purple_Miracle&#x2F;" rel="noopener" target="_blank"><i class=" fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yoloyolo.top/atom.xml" title="RSS → https:&#x2F;&#x2F;yoloyolo.top&#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xXxYOLOxXx</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
